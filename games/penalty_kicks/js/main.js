var s_iOffsetX=0,s_iOffsetY=0,s_fInverseScaling=0;
(function(k){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(k)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(k.substr(0,4))})(navigator.userAgent||
navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(k){console.log(k)}function isIOS(){for(var k="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");k.length;)if(navigator.platform===k.pop())return s_bIsIphone=!0;return s_bIsIphone=!1}window.addEventListener("orientationchange",onOrientationChange);
function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}
function getSize(k){var c=k.toLowerCase(),e=window.document,l=e.documentElement;if(void 0===window["inner"+k])k=l["client"+k];else if(window["inner"+k]!=l["client"+k]){var a=e.createElement("body");a.id="vpw-test-b";a.style.cssText="overflow:scroll";var f=e.createElement("div");f.id="vpw-test-d";f.style.cssText="position:absolute;top:-1000px";f.innerHTML="<style>@media("+c+":"+l["client"+k]+"px){body#vpw-test-b div#vpw-test-d{"+c+":7px!important}}</style>";a.appendChild(f);l.insertBefore(a,e.head);
k=7==f["offset"+k]?l["client"+k]:window["inner"+k];l.removeChild(a)}else k=window["inner"+k];return k}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}function getHeightOfIOSToolbars(){var k=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<k?k:0}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var k;k=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?getIOSWindowHeight():getSize("Height");var c=getSize("Width");_checkOrientation(c,k);s_iScaleFactor=Math.min(k/CANVAS_HEIGHT,c/CANVAS_WIDTH);var e=CANVAS_WIDTH*s_iScaleFactor,l=CANVAS_HEIGHT*s_iScaleFactor,a;l<k?(a=k-l,l+=a,e+=CANVAS_WIDTH/CANVAS_HEIGHT*a):e<c&&(a=c-e,e+=a,l+=CANVAS_HEIGHT/CANVAS_WIDTH*a);a=k/2-l/2;var f=c/2-e/2,d=CANVAS_WIDTH/e;if(f*d<-EDGEBOARD_X||a*d<-EDGEBOARD_Y)s_iScaleFactor=
Math.min(k/(CANVAS_HEIGHT-2*EDGEBOARD_Y),c/(CANVAS_WIDTH-2*EDGEBOARD_X)),e=CANVAS_WIDTH*s_iScaleFactor,l=CANVAS_HEIGHT*s_iScaleFactor,a=(k-l)/2,f=(c-e)/2,d=CANVAS_WIDTH/e;s_fInverseScaling=d;s_iOffsetX=-1*f*d;s_iOffsetY=-1*a*d;0<=a&&(s_iOffsetY=0);0<=f&&(s_iOffsetX=0);null!==s_oInterface&&s_oInterface.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);$("#canvas").css("width",e+"px");$("#canvas").css("height",l+"px");0>a?($("#canvas").css("top",
a+"px"),s_iCanvasOffsetHeight=a):($("#canvas").css("top","0px"),s_iCanvasOffsetHeight=0);$("#canvas").css("left",f+"px");resizeCanvas3D();s_iCanvasResizeWidth=e;s_iCanvasResizeHeight=l;s_iCanvasOffsetWidth=f}}
function _checkOrientation(k,c){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(k>c?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),
s_oMain.stopUpdate()))}function createBitmap(k,c,e){var l=new createjs.Bitmap(k),a=new createjs.Shape;c&&e?a.graphics.beginFill("#fff").drawRect(-c/2,-e/2,c,e):a.graphics.beginFill("#ff0").drawRect(0,0,k.width,k.height);l.hitArea=a;return l}function createSprite(k,c,e,l,a,f){k=null!==c?new createjs.Sprite(k,c):new createjs.Sprite(k);c=new createjs.Shape;c.graphics.beginFill("#000000").drawRect(-e,-l,a,f);k.hitArea=c;return k}
function randomFloatBetween(k,c,e){"undefined"===typeof e&&(e=2);return parseFloat(Math.min(k+Math.random()*(c-k),c).toFixed(e))}function shuffle(k){for(var c=k.length,e,l;0!==c;)l=Math.floor(Math.random()*c),--c,e=k[c],k[c]=k[l],k[l]=e;return k}function formatTime(k){k/=1E3;var c=Math.floor(k/60);k=parseFloat(k-60*c).toFixed(1);var e="",e=10>c?e+("0"+c+":"):e+(c+":");return 10>k?e+("0"+k):e+k}function degreesToRadians(k){return k*Math.PI/180}
function checkRectCollision(k,c){var e,l;e=getBounds(k,.9);l=getBounds(c,.98);return calculateIntersection(e,l)}function calculateIntersection(k,c){var e,l,a,f,d,m,g,n;e=k.x+(a=k.width/2);l=k.y+(f=k.height/2);d=c.x+(m=c.width/2);g=c.y+(n=c.height/2);e=Math.abs(e-d)-(a+m);l=Math.abs(l-g)-(f+n);return 0>e&&0>l?(e=Math.min(Math.min(k.width,c.width),-e),l=Math.min(Math.min(k.height,c.height),-l),{x:Math.max(k.x,c.x),y:Math.max(k.y,c.y),width:e,height:l,rect1:k,rect2:c}):null}
function getBounds(k,c){var e={x:Infinity,y:Infinity,width:0,height:0};if(k instanceof createjs.Container){e.x2=-Infinity;e.y2=-Infinity;var l=k.children,a=l.length,f,d;for(d=0;d<a;d++)f=getBounds(l[d],1),f.x<e.x&&(e.x=f.x),f.y<e.y&&(e.y=f.y),f.x+f.width>e.x2&&(e.x2=f.x+f.width),f.y+f.height>e.y2&&(e.y2=f.y+f.height);Infinity==e.x&&(e.x=0);Infinity==e.y&&(e.y=0);Infinity==e.x2&&(e.x2=0);Infinity==e.y2&&(e.y2=0);e.width=e.x2-e.x;e.height=e.y2-e.y;delete e.x2;delete e.y2}else{var m,g;k instanceof createjs.Bitmap?
(a=k.sourceRect||k.image,d=a.width*c,m=a.height*c):k instanceof createjs.Sprite?k.spriteSheet._frames&&k.spriteSheet._frames[k.currentFrame]&&k.spriteSheet._frames[k.currentFrame].image?(a=k.spriteSheet.getFrame(k.currentFrame),d=a.rect.width,m=a.rect.height,l=a.regX,g=a.regY):(e.x=k.x||0,e.y=k.y||0):(e.x=k.x||0,e.y=k.y||0);l=l||0;d=d||0;g=g||0;m=m||0;e.regX=l;e.regY=g;a=k.localToGlobal(0-l,0-g);f=k.localToGlobal(d-l,m-g);d=k.localToGlobal(d-l,0-g);l=k.localToGlobal(0-l,m-g);e.x=Math.min(Math.min(Math.min(a.x,
f.x),d.x),l.x);e.y=Math.min(Math.min(Math.min(a.y,f.y),d.y),l.y);e.width=Math.max(Math.max(Math.max(a.x,f.x),d.x),l.x)-e.x;e.height=Math.max(Math.max(Math.max(a.y,f.y),d.y),l.y)-e.y}return e}function NoClickDelay(k){this.element=k;window.Touch&&this.element.addEventListener("touchstart",this,!1)}
NoClickDelay.prototype={handleEvent:function(k){switch(k.type){case "touchstart":this.onTouchStart(k);break;case "touchmove":this.onTouchMove(k);break;case "touchend":this.onTouchEnd(k)}},onTouchStart:function(k){k.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(k){this.moved=!0},onTouchEnd:function(k){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){k=document.elementFromPoint(k.changedTouches[0].clientX,k.changedTouches[0].clientY);3==k.nodeType&&(k=k.parentNode);var c=document.createEvent("MouseEvents");c.initEvent("click",!0,!0);k.dispatchEvent(c)}}};
(function(){function k(k){var e={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};k=k||window.event;k.type in e?document.body.className=e[k.type]:(document.body.className=this[c]?"hidden":"visible","hidden"===document.body.className?s_oMain.stopUpdate():s_oMain.startUpdate())}var c="hidden";c in document?document.addEventListener("visibilitychange",k):(c="mozHidden")in document?document.addEventListener("mozvisibilitychange",k):(c="webkitHidden")in
document?document.addEventListener("webkitvisibilitychange",k):(c="msHidden")in document?document.addEventListener("msvisibilitychange",k):"onfocusin"in document?document.onfocusin=document.onfocusout=k:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=k})();function playSound(k,c,e){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?createjs.Sound.play(k,{loop:e,volume:c}):null}function stopSound(k){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||k.stop()}
function setVolume(k,c){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)k.volume=c}function setMute(k,c){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||k.setMute(c)}function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}function getParamValue(k){for(var c=window.location.search.substring(1).split("&"),e=0;e<c.length;e++){var l=c[e].split("=");if(l[0]==k)return l[1]}}
function rotateVector2D(k,c){return{x:c.x*Math.cos(k)+c.y*Math.sin(k),y:c.x*-Math.sin(k)+c.y*Math.cos(k)}}function normalize(k,c){0<c&&(k.x/=c,k.y/=c);return k}function length(k){return Math.sqrt(k.x*k.x+k.y*k.y)}function findNearestIntersectingObject(k,c,e,l){var a=CANVAS_RESIZE_WIDTH+2*OFFSET_WIDTH,f=CANVAS_RESIZE_HEIGHT+2*OFFSET_HEIGHT,d=new THREE.Raycaster,m=new THREE.Vector3;m.x=k/a*2-1;m.y=2*-(c/f)+1;m.z=.5;d.setFromCamera(m,e);k=d.intersectObjects(l,!0);c=!1;0<k.length&&(c=k[0]);return c}
function distance(k,c,e,l){k-=e;c-=l;return Math.sqrt(k*k+c*c)}function distance2(k,c,e,l){k-=e;c-=l;return k*k+c*c}function resizeCanvas3D(){$("canvas").each(function(){"#canvas"!=$(this).attr("id")&&($(this).css("width",$("#canvas").css("width")),$(this).css("height",$("#canvas").css("height")),$(this).css("position",$("#canvas").css("position")),$(this).css("left",$("#canvas").css("left")),$(this).css("top",$("#canvas").css("top")))})}
function createOrthoGraphicCamera(){var k=new THREE.PerspectiveCamera(FOV,CANVAS_WIDTH/CANVAS_HEIGHT,NEAR,FAR);k.rotation.x=Math.PI/180*88.6;k.rotation.y=Math.PI/180*.03;k.position.set(CAMERA_POSITION.x,CAMERA_POSITION.y,CAMERA_POSITION.z);k.updateProjectionMatrix();k.updateMatrixWorld();return k}function rotateVector2D(k,c){return{x:c.x*Math.cos(k)+c.y*Math.sin(k),y:c.x*-Math.sin(k)+c.y*Math.cos(k),z:0}}Math.radians=function(k){return k*Math.PI/180};Math.degrees=function(k){return 180*k/Math.PI};
function distanceV3(k,c,e,l,a,f){k-=l;c-=a;e-=f;return Math.sqrt(k*k+c*c+e*e)}function distanceV2(k,c){var e=k.x-c.x,l=k.y-c.y;return Math.sqrt(e*e+l*l)}function saveItem(k,c){localStorage.setItem(k,c)}function getItem(k){return localStorage.getItem(k)}function clearAllItem(){localStorage.clear()}function inIframe(){try{return window.self!==window.top}catch(k){return!0}}
function CSpriteLibrary(){var k,c,e,l,a,f;this.init=function(d,m,g){e=c=0;l=d;a=m;f=g;k={}};this.addSprite=function(a,f){k.hasOwnProperty(a)||(k[a]={szPath:f,oSprite:new Image},c++)};this.getSprite=function(a){return k.hasOwnProperty(a)?k[a].oSprite:null};this._onSpritesLoaded=function(){a.call(f)};this._onSpriteLoaded=function(){l.call(f);++e==c&&this._onSpritesLoaded()};this.loadSprites=function(){for(var a in k)k[a].oSprite.oSpriteLibrary=this,k[a].oSprite.onload=function(){this.oSpriteLibrary._onSpriteLoaded()},
k[a].oSprite.src=k[a].szPath};this.getNumSprites=function(){return c}}
var CANVAS_WIDTH=1360,CANVAS_HEIGHT=640,CANVAS_WIDTH_HALF=.5*CANVAS_WIDTH,CANVAS_HEIGHT_HALF=.5*CANVAS_HEIGHT,EDGEBOARD_X=250,EDGEBOARD_Y=20,DISABLE_SOUND_MOBILE=!1,FONT_GAME="blackplotanregular",SECONDARY_FONT="blackplotanregular",FPS=30,FPS_DESKTOP=60,FPS_TIME=1/FPS,ROLL_BALL_RATE=60/FPS,STATE_LOADING=0,STATE_MENU=1,STATE_HELP=1,STATE_GAME=3,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,ON_TWEEN_ENDED=6,ON_BUT_NO_DOWN=7,ON_BUT_YES_DOWN=8,STEP_RATE=1.5,
TEXT_SIZE=[80,100,130],LOCAL_BEST_SCORE=0,START_HAND_SWIPE_POS={x:CANVAS_WIDTH_HALF,y:CANVAS_HEIGHT_HALF+200},END_HAND_SWIPE_POS=[{x:CANVAS_WIDTH_HALF-250,y:CANVAS_HEIGHT_HALF-200},{x:CANVAS_WIDTH_HALF,y:CANVAS_HEIGHT_HALF-200},{x:CANVAS_WIDTH_HALF+250,y:CANVAS_HEIGHT_HALF-200}],MS_TIME_SWIPE_END=1E3,MS_TIME_SWIPE_START=3E3,MS_TIME_FADE_HELP_TEXT=500,LOCALSTORAGE_STRING=["penalty_best_score"],TEXT_EXCELLENT_COLOR=["#fff","#5d96fe"],TEXT_COLOR="#ffffff",TEXT_COLOR_1="#ff2222",TEXT_COLOR_STROKE="#002a59",
OUTLINE_WIDTH=1.5,TIME_INTERVAL_STROBE=.2,PHYSICS_ACCURACY=3,MOBILE_OFFSET_GLOVES_X=-100,BALL_VELOCITY_MULTIPLIER=1,PHYSICS_STEP=1/(FPS*STEP_RATE),MS_WAIT_SHOW_GAME_OVER_PANEL=250,STATE_INIT=0,STATE_PLAY=1,STATE_FINISH=2,STATE_PAUSE=3,IDLE=0,RIGHT=1,LEFT=2,CENTER_DOWN=3,CENTER_UP=4,LEFT_DOWN=5,RIGHT_DOWN=6,ANIM_GOAL_KEEPER_FAIL=[LEFT,RIGHT,CENTER_DOWN,CENTER_UP,LEFT_DOWN,RIGHT_DOWN],ANIM_GOAL_KEEPER_FAIL_ALT=[LEFT,RIGHT,LEFT_DOWN,RIGHT_DOWN],NUM_SPRITE_PLAYER=31,SPRITE_NAME_GOALKEEPER="gk_idle_ gk_save_right_ gk_save_left_ gk_save_center_down_ gk_save_center_up_ gk_save_down_left_ gk_save_down_right".split(" "),
NUM_SPRITE_GOALKEEPER=[24,34,34,51,25,34,34],OFFSET_CONTAINER_GOALKEEPER=[{x:0,y:0},{x:15,y:-29},{x:-360,y:-29},{x:-15,y:-15},{x:-20,y:-85},{x:-355,y:20},{x:21,y:20}],BALL_MASS=.5,BALL_RADIUS=.64,BALL_LINEAR_DAMPING=.2,OBJECT,TIME_TRY_TO_SHOT_BALL_OPPONENT=.7,START_POS_FLAG={x:277,y:268},FLAG_ADDED_POS={x:61,y:69},FLAG_LIMIT_POS_X=690,TOT_TEAM=32,MIN_BALL_VEL_ROTATION=.1,TIME_RESET_AFTER_GOAL=1E3,SHOOT_FRAME=7,HAND_KEEPER_ANGLE_RATE=.15,TIME_POLE_COLLISION_RESET=1E3,LIMIT_HAND_RANGE_POS={x:16.8,zMax:3.1,
zMin:-8.5},BACK_WALL_GOAL_SIZE={width:20.5,depth:1,height:7.5},LEFT_RIGHT_WALL_GOAL_SIZE={width:.1,depth:25,height:7.5},UP_WALL_GOAL_SIZE={width:20.5,depth:25,height:.1},BACK_WALL_GOAL_POSITION={x:0,y:155,z:-2.7},GOAL_LINE_POS={x:0,y:BACK_WALL_GOAL_POSITION.y-UP_WALL_GOAL_SIZE.depth+2,z:BACK_WALL_GOAL_POSITION.z},POSITION_BALL={x:.05,y:15.4,z:-9+BALL_RADIUS},NUM_AREA_GOAL={h:3,w:5},AREA_GOALS_ANIM=[LEFT,LEFT,CENTER_UP,RIGHT,RIGHT,LEFT,LEFT,CENTER_UP,RIGHT,RIGHT,LEFT_DOWN,LEFT_DOWN,CENTER_DOWN,RIGHT_DOWN,
RIGHT_DOWN],GOAL_SPRITE_SWAP_Y=GOAL_LINE_POS.y,GOAL_SPRITE_SWAP_Z=BACK_WALL_GOAL_POSITION.z+LEFT_RIGHT_WALL_GOAL_SIZE.height,BALL_OUT_Y=BACK_WALL_GOAL_POSITION.y+3,BUFFER_ANIM_PLAYER=FPS,MS_EFFECT_ADD=1500,MS_ROLLING_SCORE=500,MAX_PERCENT_PROBABILITY=100,GOAL_KEEPER_TOLLERANCE_LEFT=-4,GOAL_KEEPER_TOLLERANCE_RIGHT=4,TIME_RESET_AFTER_BALL_OUT=250,TIME_RESET_AFTER_SAVE=500,AREA_GOAL_PROPERTIES={width:4,depth:1,height:2.4},FIRST_AREA_GOAL_POS={x:-14-.5*AREA_GOAL_PROPERTIES.width,y:BACK_WALL_GOAL_POSITION.y-
UP_WALL_GOAL_SIZE.depth+1.1,z:3.1-.5*AREA_GOAL_PROPERTIES.height},GOAL_KEEPER_DEPTH_Y=BACK_WALL_GOAL_POSITION.y-UP_WALL_GOAL_SIZE.depth,POLE_UP_SIZE={radius_top:.5,radius_bottom:.5,height:40.5,segments:10},POLE_RIGHT_LEFT_SIZE={radius_top:.5,radius_bottom:.5,height:15,segments:10},COLOR_AREA_GOAL=[16711680,65280,255,16776960,16711935,65535,15790320,986895,16759705,16777215,5675280,10083618,1056896,8392736,9017449],OFFSET_FIELD_Y=35,OFFSET_FIELD_X=35,HIT_BALL_MAX_FORCE=130,HIT_BALL_MIN_FORCE=5,FORCE_RATE=
.0014,SHOW_AREAS_GOAL=!1,FORCE_MULTIPLIER_AXIS={x:.12,y:.4,z:.08},FORCE_MAX=.5,FIELD_POSITION,MAX_FORCE_Y=66,MIN_FORCE_Y=50,CALCULATE_PROBABILITY=[{xMax:-7,xMin:-11,zMax:11,zMin:8},{xMax:-3.6,xMin:-7,zMax:11,zMin:8},{xMax:3.6,xMin:-3.6,zMax:11,zMin:8},{xMax:7,xMin:3.6,zMax:11,zMin:8},{xMax:11,xMin:7,zMax:11,zMin:8},{xMax:-7,xMin:-7,zMax:8,zMin:5},{xMax:-3.6,xMin:-7,zMax:8,zMin:5},{xMax:3.6,xMin:-3.6,zMax:8,zMin:5},{xMax:7,xMin:3.6,zMax:8,zMin:5},{xMax:11,xMin:7,zMax:8,zMin:5},{xMax:-7,xMin:-11,zMax:5,
zMin:0},{xMax:-3.6,xMin:-7,zMax:5,zMin:0},{xMax:3.6,xMin:-3.6,zMax:5,zMin:0},{xMax:7,xMin:3.6,zMax:5,zMin:0},{xMax:11,xMin:7,zMax:5,zMin:0}],SHOW_3D_RENDER=!1,CAMERA_TEST_TRACKBALL=!1,CAMERA_TEST_TRANSFORM=!1,CANVAS_3D_OPACITY=.5,MOUSE_SENSIBILTY=.03,CAMERA_TEST_LOOK_AT={x:0,y:-500,z:-100},BALL_SCALE_FACTOR=.07,SHADOWN_FACTOR=1.1,INTENSITY_DISPLAY_SHOCK=[{x:10,y:7.5,time:50},{x:20,y:9,time:50},{x:30,y:12,time:50},{x:33,y:15,time:50}],FORCE_BALL_DISPLAY_SHOCK=[{max:55,min:MIN_FORCE_Y-1},{max:58,min:55},
{max:62,min:58},{max:MAX_FORCE_Y,min:62}],CAMERA_POSITION={x:0,y:0,z:-7},FOV=15,NEAR=1,FAR=2E3,ENABLE_FULLSCREEN,ENABLE_CHECK_ORIENTATION,TIME_SWIPE;TEXT_GAMEOVER="GAME OVER";TEXT_OF="/";TEXT_SCORE="SCORE";TEXT_BEST_SCORE="BEST SCORE";TEXT_MULTIPLIER="x";TEXT_BALLS="BALLS";TEXT_LAUNCH="KICK";TEXT_GOAL="GOAL!";TEXT_ARE_SURE="ARE YOU SURE?";TEXT_BALL_OUT="OUT";TEXT_PAUSE="PAUSE";TEXT_HOW_TO_PLAY="HOW TO PLAY";TEXT_CONGRATULATION=["GOOD!","GREAT!","EXCELLENT!!!"];TEXT_SAVED="SAVED";TEXT_HELP="SWIPE TO KICK THE BALL";
TEXT_SHARE_IMAGE="200x200.jpg";TEXT_SHARE_TITLE="Congratulations!";TEXT_SHARE_MSG1="You collected <strong>";TEXT_SHARE_MSG2=" points</strong>!<br><br>Share your score with your friends!";TEXT_SHARE_SHARE1="My score is ";TEXT_SHARE_SHARE2=" points! Can you do better?";
function CPreloader(){var k,c,e,l,a,f,d,m;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png");s_oSpriteLibrary.loadSprites();m=new createjs.Container;s_oStage.addChild(m)};this.unload=function(){m.removeAllChildren()};this.hide=function(){var a=this;setTimeout(function(){createjs.Tween.get(d).to({alpha:1},500).call(function(){a.unload();
s_oMain.gotoMenu()})},1E3)};this._onImagesLoaded=function(){};this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};this.attachSprites=function(){var g=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));m.addChild(g);g=s_oSpriteLibrary.getSprite("progress_bar");a=createBitmap(g);a.x=CANVAS_WIDTH/2-g.width/2;a.y=CANVAS_HEIGHT-200;m.addChild(a);k=g.width;c=g.height;f=new createjs.Shape;f.graphics.beginFill("rgba(255,255,255,0.01)").drawRect(a.x,a.y,1,c);m.addChild(f);a.mask=
f;e=new createjs.Text("","30px "+FONT_GAME,"#fff");e.x=CANVAS_WIDTH/2;e.y=CANVAS_HEIGHT-200;e.textBaseline="alphabetic";e.textAlign="center";m.addChild(e);l=new createjs.Text("","30px "+SECONDARY_FONT,"#fff");l.x=CANVAS_WIDTH+200;l.y=CANVAS_HEIGHT+200;l.textBaseline="alphabetic";l.textAlign="center";m.addChild(l);d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);d.alpha=0;m.addChild(d)};this.refreshLoader=function(d){e.text=d+"%";l.text=d+"%";f.graphics.clear();
d=Math.floor(d*k/100);f.graphics.beginFill("rgba(255,255,255,0.01)").drawRect(a.x,a.y,d,c)};this._init()}
function CMain(k){var c,e=0,l=0,a=STATE_LOADING,f,d,m;this.initContainer=function(){var a=document.getElementById("canvas");s_oStage=new createjs.Stage(a);createjs.Touch.enable(s_oStage);s_oStage.preventSelection=!1;s_bMobile=jQuery.browser.mobile;!1===s_bMobile?(s_oStage.enableMouseOver(20),$("body").on("contextmenu","#canvas",function(a){return!1}),FPS=FPS_DESKTOP,FPS_TIME=1/FPS,PHYSICS_STEP=1/(FPS*STEP_RATE),ROLL_BALL_RATE=60/FPS):BALL_VELOCITY_MULTIPLIER=.8;s_iPrevTime=(new Date).getTime();createjs.Ticker.addEventListener("tick",
this._update);createjs.Ticker.setFPS(FPS);navigator.userAgent.match(/Windows Phone/i)&&(DISABLE_SOUND_MOBILE=!0);s_oSpriteLibrary=new CSpriteLibrary;d=new CPreloader;c=!0};this.soundLoaded=function(){e++;d.refreshLoader(Math.floor(e/l*100));e===l&&this._onRemovePreloader()};this._initSounds=function(){createjs.Sound.initializeDefaultPlugins()&&(0<navigator.userAgent.indexOf("Opera")||0<navigator.userAgent.indexOf("OPR")?(createjs.Sound.alternateExtensions=["mp3"],createjs.Sound.addEventListener("fileload",
createjs.proxy(this.soundLoaded,this)),createjs.Sound.registerSound("./sounds/click.ogg","click"),createjs.Sound.registerSound("./sounds/drop_bounce_grass.ogg","drop_bounce_grass"),createjs.Sound.registerSound("./sounds/soundtrack.ogg","soundtrack"),createjs.Sound.registerSound("./sounds/goal.ogg","goal"),createjs.Sound.registerSound("./sounds/ball_saved.ogg","ball_saved"),createjs.Sound.registerSound("./sounds/kick.ogg","kick"),createjs.Sound.registerSound("./sounds/pole.ogg","pole")):(createjs.Sound.alternateExtensions=
["ogg"],createjs.Sound.addEventListener("fileload",createjs.proxy(this.soundLoaded,this)),createjs.Sound.registerSound("./sounds/click.mp3","click"),createjs.Sound.registerSound("./sounds/drop_bounce_grass.mp3","drop_bounce_grass"),createjs.Sound.registerSound("./sounds/soundtrack.mp3","soundtrack"),createjs.Sound.registerSound("./sounds/goal.mp3","goal"),createjs.Sound.registerSound("./sounds/ball_saved.mp3","ball_saved"),createjs.Sound.registerSound("./sounds/kick.mp3","kick"),createjs.Sound.registerSound("./sounds/pole.mp3",
"pole")),l+=7)};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("but_play","./sprites/but_play.png");s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png");s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("bg_game","./sprites/bg_game.jpg");s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png");s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png");s_oSpriteLibrary.addSprite("but_home",
"./sprites/but_home.png");s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png");s_oSpriteLibrary.addSprite("but_fullscreen","./sprites/but_fullscreen.png");s_oSpriteLibrary.addSprite("ball","./sprites/ball.png");s_oSpriteLibrary.addSprite("but_level","./sprites/but_level.png");s_oSpriteLibrary.addSprite("bg_game","./sprites/bg_game.jpg");s_oSpriteLibrary.addSprite("but_continue","./sprites/but_continue.png");s_oSpriteLibrary.addSprite("but_yes","./sprites/but_yes.png");s_oSpriteLibrary.addSprite("but_no",
"./sprites/but_no.png");s_oSpriteLibrary.addSprite("but_info","./sprites/but_info.png");s_oSpriteLibrary.addSprite("logo_ctl","./sprites/logo_ctl.png");s_oSpriteLibrary.addSprite("but_pause","./sprites/but_pause.png");s_oSpriteLibrary.addSprite("arrow_right","./sprites/arrow_right.png");s_oSpriteLibrary.addSprite("arrow_left","./sprites/arrow_left.png");s_oSpriteLibrary.addSprite("ball_shadow","./sprites/ball_shadow.png");s_oSpriteLibrary.addSprite("start_ball","./sprites/start_ball.png");s_oSpriteLibrary.addSprite("hand_touch",
"./sprites/hand_touch.png");s_oSpriteLibrary.addSprite("cursor","./sprites/cursor.png");s_oSpriteLibrary.addSprite("shot_left","./sprites/shot_left.png");s_oSpriteLibrary.addSprite("goal","./sprites/goal.png");for(var a=0;a<NUM_SPRITE_PLAYER;a++)s_oSpriteLibrary.addSprite("player_"+a,"./sprites/player/player_"+a+".png");for(a=0;a<NUM_SPRITE_GOALKEEPER[IDLE];a++)s_oSpriteLibrary.addSprite(SPRITE_NAME_GOALKEEPER[IDLE]+a,"./sprites/goalkeeper_idle/gk_idle_"+a+".png");for(a=0;a<NUM_SPRITE_GOALKEEPER[RIGHT];a++)s_oSpriteLibrary.addSprite(SPRITE_NAME_GOALKEEPER[RIGHT]+
a,"./sprites/goalkeeper_save_right/gk_save_right_"+a+".png");for(a=0;a<NUM_SPRITE_GOALKEEPER[LEFT];a++)s_oSpriteLibrary.addSprite(SPRITE_NAME_GOALKEEPER[LEFT]+a,"./sprites/goalkeeper_save_left/gk_save_left_"+a+".png");for(a=0;a<NUM_SPRITE_GOALKEEPER[CENTER_DOWN];a++)s_oSpriteLibrary.addSprite(SPRITE_NAME_GOALKEEPER[CENTER_DOWN]+a,"./sprites/goalkeeper_save_center_down/gk_save_center_down_"+a+".png");for(a=0;a<NUM_SPRITE_GOALKEEPER[CENTER_UP];a++)s_oSpriteLibrary.addSprite(SPRITE_NAME_GOALKEEPER[CENTER_UP]+
a,"./sprites/goalkeeper_save_center_up/gk_save_center_up_"+a+".png");for(a=0;a<NUM_SPRITE_GOALKEEPER[LEFT_DOWN];a++)s_oSpriteLibrary.addSprite(SPRITE_NAME_GOALKEEPER[LEFT_DOWN]+a,"./sprites/goalkeeper_save_down_left/gk_save_down_left_"+a+".png");for(a=0;a<NUM_SPRITE_GOALKEEPER[RIGHT_DOWN];a++)s_oSpriteLibrary.addSprite(SPRITE_NAME_GOALKEEPER[RIGHT_DOWN]+a,"./sprites/goalkeeper_save_down_right/gk_save_down_right_"+a+".png");l+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=
function(){e++;d.refreshLoader(Math.floor(e/l*100));e===l&&this._onRemovePreloader()};this._onAllImagesLoaded=function(){};this.onAllPreloaderImagesLoaded=function(){this._loadImages()};this.preloaderReady=function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||this._initSounds();this._loadImages();c=!0};this._onRemovePreloader=function(){d.unload();isIOS()||!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(s_oSoundTrack=createjs.Sound.play("soundtrack",{loop:-1}));this.gotoMenu()};this.gotoMenu=function(){new CMenu;
a=STATE_MENU};this.gotoGame=function(){m=new CGame(f);a=STATE_GAME};this.gotoHelp=function(){new CHelp;a=STATE_HELP};this.stopUpdate=function(){c=!1;createjs.Ticker.paused=!0;$("#block_game").css("display","block");createjs.Sound.setMute(!0)};this.startUpdate=function(){s_iPrevTime=(new Date).getTime();c=!0;createjs.Ticker.paused=!1;$("#block_game").css("display","none");s_bAudioActive&&createjs.Sound.setMute(!1)};this._update=function(d){if(!1!==c){var k=(new Date).getTime();s_iTimeElaps=k-s_iPrevTime;
s_iCntTime+=s_iTimeElaps;s_iCntFps++;s_iPrevTime=k;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);a===STATE_GAME&&m.update();s_oStage.update(d)}};s_oMain=this;f=k;ENABLE_CHECK_ORIENTATION=k.check_orientation;this.initContainer()}
var s_bMobile,s_bAudioActive=!0,s_bFullscreen=!1,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_oPhysicsController,s_iCanvasResizeHeight,s_iCanvasResizeWidth,s_iCanvasOffsetHeight,s_iCanvasOffsetWidth,s_iAdsLevel=1,s_iBestScore=0,s_oDrawLayer,s_oStage,s_oMain,s_oSpriteLibrary,s_oSoundTrack=null;
function CTextButton(k,c,e,l,a,f,d){var m,g,n;this._init=function(a,d,k,f,c,e,l){m=[];g=[];var p=createBitmap(k),u=Math.ceil(l/20),q=new createjs.Text(f,"bold "+l+"px "+c,"#000000");q.textAlign="center";q.textBaseline="alphabetic";var t=q.getBounds();q.x=k.width/2+u;q.y=Math.floor(k.height/2)+t.height/3+u;f=new createjs.Text(f,"bold "+l+"px "+c,e);f.textAlign="center";f.textBaseline="alphabetic";t=f.getBounds();f.x=k.width/2;f.y=Math.floor(k.height/2)+t.height/3;n=new createjs.Container;n.x=a;n.y=
d;n.regX=k.width/2;n.regY=k.height/2;n.addChild(p,q,f);s_bMobile||(n.cursor="pointer");s_oStage.addChild(n);this._initListener()};this.unload=function(){n.off("mousedown");n.off("pressup");s_oStage.removeChild(n)};this.setVisible=function(a){n.visible=a};this._initListener=function(){oParent=this;n.on("mousedown",this.buttonDown);n.on("pressup",this.buttonRelease)};this.addEventListener=function(a,d,k){m[a]=d;g[a]=k};this.buttonRelease=function(){n.scaleX=1;n.scaleY=1;playSound("click",1,0);m[ON_MOUSE_UP]&&
m[ON_MOUSE_UP].call(g[ON_MOUSE_UP])};this.buttonDown=function(){n.scaleX=.9;n.scaleY=.9;m[ON_MOUSE_DOWN]&&m[ON_MOUSE_DOWN].call(g[ON_MOUSE_DOWN])};this.setPosition=function(a,d){n.x=a;n.y=d};this.setX=function(a){n.x=a};this.setY=function(a){n.y=a};this.getButtonImage=function(){return n};this.getX=function(){return n.x};this.getY=function(){return n.y};this._init(k,c,e,l,a,f,d);return this}
function CToggle(k,c,e,l,a){var f,d,m,g,n;this._init=function(a,k,c,e,l){n=void 0!==l?l:s_oStage;d=[];m=[];l=new createjs.SpriteSheet({images:[c],frames:{width:c.width/2,height:c.height,regX:c.width/2/2,regY:c.height/2},animations:{state_true:[0],state_false:[1]}});f=e;g=createSprite(l,"state_"+f,c.width/2/2,c.height/2,c.width/2,c.height);g.x=a;g.y=k;g.stop();s_bMobile||(g.cursor="pointer");n.addChild(g);this._initListener()};this.unload=function(){g.off("mousedown",this.buttonDown);g.off("pressup",
this.buttonRelease);n.removeChild(g)};this._initListener=function(){g.on("mousedown",this.buttonDown);g.on("pressup",this.buttonRelease)};this.addEventListener=function(a,k,g){d[a]=k;m[a]=g};this.setCursorType=function(a){g.cursor=a};this.setActive=function(a){f=a;g.gotoAndStop("state_"+f)};this.buttonRelease=function(){g.scaleX=1;g.scaleY=1;playSound("click",1,0);f=!f;g.gotoAndStop("state_"+f);d[ON_MOUSE_UP]&&d[ON_MOUSE_UP].call(m[ON_MOUSE_UP],f)};this.buttonDown=function(){g.scaleX=.9;g.scaleY=
.9;d[ON_MOUSE_DOWN]&&d[ON_MOUSE_DOWN].call(m[ON_MOUSE_DOWN])};this.setPosition=function(a,d){g.x=a;g.y=d};this._init(k,c,e,l,a)}
function CGfxButton(k,c,e,l){var a,f,d,m,g,n,p,u=!1,q;this._init=function(k,c,e){a=[];f=[];m=[];d=createBitmap(e);d.x=k;d.y=c;n=g=1;d.regX=e.width/2;d.regY=e.height/2;s_bMobile||(d.cursor="pointer");q.addChild(d);this._initListener()};this.unload=function(){d.off("mousedown",this.buttonDown);d.off("pressup",this.buttonRelease);q.removeChild(d)};this.setVisible=function(a){d.visible=a};this.setCursorType=function(a){d.cursor=a};this._initListener=function(){d.on("mousedown",this.buttonDown);d.on("pressup",
this.buttonRelease)};this.addEventListener=function(d,k,g){a[d]=k;f[d]=g};this.addEventListenerWithParams=function(d,k,g,c){a[d]=k;f[d]=g;m[d]=c};this.buttonRelease=function(){u||(d.scaleX=0<g?1:-1,d.scaleY=1,playSound("click",1,0),a[ON_MOUSE_UP]&&a[ON_MOUSE_UP].call(f[ON_MOUSE_UP],m[ON_MOUSE_UP]))};this.buttonDown=function(){u||(d.scaleX=0<g?.9:-.9,d.scaleY=.9,a[ON_MOUSE_DOWN]&&a[ON_MOUSE_DOWN].call(f[ON_MOUSE_DOWN],m[ON_MOUSE_DOWN]))};this.rotation=function(a){d.rotation=a};this.getButton=function(){return d};
this.setPosition=function(a,k){d.x=a;d.y=k};this.setX=function(a){d.x=a};this.setY=function(a){d.y=a};this.getButtonImage=function(){return d};this.block=function(a){u=a;d.scaleX=g;d.scaleY=n};this.setScaleX=function(a){g=d.scaleX=a};this.getX=function(){return d.x};this.getY=function(){return d.y};this.pulseAnimation=function(){createjs.Tween.get(d).to({scaleX:.9*g,scaleY:.9*n},850,createjs.Ease.quadOut).to({scaleX:g,scaleY:n},650,createjs.Ease.quadIn).call(function(){p.pulseAnimation()})};this.trebleAnimation=
function(){createjs.Tween.get(d).to({rotation:5},75,createjs.Ease.quadOut).to({rotation:-5},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750).call(function(){p.trebleAnimation()})};this.removeAllTweens=function(){createjs.Tween.removeTweens(d)};q=void 0!==l?l:s_oStage;this._init(k,c,e);p=this;return this}
function CMenu(){var k,c,e,l,a,f,d,m,g,n,p,u,q,t,y=null,w=null;this._init=function(){g=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(g);var C=s_oSpriteLibrary.getSprite("but_play");a=CANVAS_WIDTH/2+110;f=CANVAS_HEIGHT-130;n=new CGfxButton(a,f,C);n.addEventListener(ON_MOUSE_UP,this._onButPlayRelease,this);n.pulseAnimation();s_iBestScore=getItem(LOCALSTORAGE_STRING[LOCAL_BEST_SCORE]);null===s_iBestScore&&(s_iBestScore=0);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)C=s_oSpriteLibrary.getSprite("audio_icon"),
d=CANVAS_WIDTH-C.height/2-10,m=C.height/2+10,q=new CToggle(d,m,C,s_bAudioActive),q.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);var C=window.document,x=C.documentElement;y=x.requestFullscreen||x.mozRequestFullScreen||x.webkitRequestFullScreen||x.msRequestFullscreen;w=C.exitFullscreen||C.mozCancelFullScreen||C.webkitExitFullscreen||C.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(y=!1);C=s_oSpriteLibrary.getSprite("but_info");e=C.height/2+10;l=C.height/2+10;p=new CGfxButton(e,l,C,s_oStage);p.addEventListener(ON_MOUSE_UP,
this._onButInfoRelease,this);y&&!1===inIframe()&&(C=s_oSpriteLibrary.getSprite("but_fullscreen"),k=e+C.width/2+10,c=C.height/2+10,t=new CToggle(k,c,C,s_bFullscreen,s_oStage),t.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));u=new createjs.Shape;u.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(u);createjs.Tween.get(u).to({alpha:0},1E3).call(function(){u.visible=!1});this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.refreshButtonPos=function(a,
g){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||q.setPosition(d-a,g+m);y&&!1===inIframe()&&t.setPosition(k+a,c+g);p.setPosition(e+a,l+g)};this.unload=function(){n.unload();n=null;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)q.unload(),q=null;y&&!1===inIframe()&&t.unload();s_oStage.removeAllChildren();s_oMenu=null};this._onButPlayRelease=function(){this.unload();if(isIOS()&&null===s_oSoundTrack){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)s_oSoundTrack=createjs.Sound.play("soundtrack",{loop:-1})}else playSound("click",
1,0);s_oMain.gotoGame()};this._onAudioToggle=function(){createjs.Sound.setMute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onButInfoRelease=function(){new CCreditsPanel};this._onFullscreenRelease=function(){s_bFullscreen?(w.call(window.document),s_bFullscreen=!1):(y.call(window.document.documentElement),s_bFullscreen=!0);sizeHandler()};s_oMenu=this;this._init()}var s_oMenu=null;
function CGame(k){var c,e,l,a,f,d=null,m,g,n,p,u,q=null,t,y,w=!1,C=!1,x=!1,B=!1,G=!1,E=!1,R=!1,I=!1,K=!1,N,D,Z=0,fa=0,ja=0,ga,T,ca,W,z,V,J=STATE_INIT,ea=null;this._init=function(){$(s_oMain).trigger("start_session");this.pause(!0);$(s_oMain).trigger("start_level",1);N=0;W=1;z=[];m=new createjs.Container;s_oStage.addChild(m);e=createBitmap(s_oSpriteLibrary.getSprite("bg_game"));e.cache(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);m.addChild(e);l=new CScenario(1);ea=SHOW_3D_RENDER?camera:createOrthoGraphicCamera();
var k=s_oSpriteLibrary.getSprite("goal");y=new CGoal(291,28,k,m);d=new CGoalKeeper(CANVAS_WIDTH_HALF-100,CANVAS_HEIGHT_HALF-225,m);z.push(d);k=s_oSpriteLibrary.getSprite("ball");a=new CBall(0,0,k,l.ballBody(),m);z.push(a);this.ballPosition();a.setVisible(!1);ca=MS_TIME_SWIPE_START;f=new CStartBall(CANVAS_WIDTH_HALF+55,CANVAS_HEIGHT_HALF+168,m);u=new CPlayer(CANVAS_WIDTH_HALF-150,CANVAS_HEIGHT_HALF-320,m);u.setVisible(!1);k="cursor";s_bMobile?(k="hand_touch",TIME_SWIPE=650):TIME_SWIPE=500;t=new CHandSwipeAnim(START_HAND_SWIPE_POS,
END_HAND_SWIPE_POS,s_oSpriteLibrary.getSprite(k),s_oStage);t.animAllSwipe();resizeCanvas3D();setVolume(s_oSoundTrack,.35);c=new CInterface;c.refreshTextScoreBoard(0,0,0,!1);c.refreshLaunchBoard(Z,NUM_OF_PENALTY);V=new CANNON.Vec3(0,0,0);this.onExitHelp()};this.createControl=function(){SHOW_3D_RENDER?(window.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mousemove",this.onPressMove),window.addEventListener("mouseup",this.onPressUp)):(p=new createjs.Shape,p.graphics.beginFill("rgba(255,0,0,0.01)").drawRect(0,
0,CANVAS_WIDTH,CANVAS_HEIGHT),m.addChild(p),p.on("mousedown",this.onMouseDown),p.on("pressmove",this.onPressMove),p.on("pressup",this.onPressUp))};this.sortDepth=function(a,d){a.getDepthPos()>d.getDepthPos()?m.getChildIndex(a.getObject())>m.getChildIndex(d.getObject())&&m.swapChildren(a.getObject(),d.getObject()):a.getDepthPos()<d.getDepthPos()&&m.getChildIndex(d.getObject())>m.getChildIndex(a.getObject())&&m.swapChildren(d.getObject(),a.getObject())};this.onExitHelp=function(){this.createControl();
this.pause(!1)};this.poleCollide=function(){T=TIME_POLE_COLLISION_RESET;K=!0;playSound("pole",.4,0)};this.fieldCollision=function(){if(null===q&&C&&(q=playSound("drop_bounce_grass",.3,0),null!==q))q.on("complete",function(){q.removeAllEventListeners();q=null})};this.ballPosition=function(){var d=l.ballBody(),k=this.convert3dPosTo2dScreen(d.position,ea),g=k.z*(BALL_SCALE_FACTOR-a.getStartScale())+a.getStartScale();a.setPosition(k.x,k.y);a.scale(g);this.refreshShadowCast(a,d,g)};this.onMouseDown=function(a){C||
(ca=MS_TIME_SWIPE_START,t.removeTweens(),t.setVisible(!1),g={x:s_oStage.mouseX,y:s_oStage.mouseY})};this.onPressMove=function(){n={x:s_oStage.mouseX,y:s_oStage.mouseY};ja+=s_iTimeElaps};this.onPressUp=function(){if(!(C||g.y<n.y||0===n.x&&0===n.y)){var a=Math.ceil(distanceV2(g,n))*FORCE_RATE;a>FORCE_MAX&&(a=FORCE_MAX);if(ja>TIME_SWIPE)ja=0;else{var d=new CVector2(g.x-n.x,g.y-n.y);d.scalarProduct(a);a=d.length();a>HIT_BALL_MIN_FORCE&&(a>HIT_BALL_MAX_FORCE&&(d.normalize(),d.scalarProduct(HIT_BALL_MAX_FORCE)),
G=!0,u.setVisible(!0),a=ja/10,a>MAX_FORCE_Y?a=MAX_FORCE_Y:a<MIN_FORCE_Y&&(a=MIN_FORCE_Y),V.set(-d.getX()*FORCE_MULTIPLIER_AXIS.x,a,d.getY()*FORCE_MULTIPLIER_AXIS.z),I=s_oGame.goalProbability());n.x=0;n.y=0}}};this.refreshShadowCast=function(a,d,k){var g=l.getFieldBody();if(d.position.z<g.position.z)a.scaleShadow(0);else{var f=this.convert3dPosTo2dScreen({x:d.position.x,y:d.position.y,z:g.position.z},ea);d=(d.position.z-BALL_RADIUS)*(g.position.z-SHADOWN_FACTOR-g.position.z)+g.position.z;k*=d;a.scaleShadow(k);
0>k||(a.setAlphaByHeight(d),a.setPositionShadow(f.x,f.y))}};this.addScore=function(a,d){N+=a;c.refreshTextScoreBoard(N,W.toFixed(1),d,!0)};this.getLevel=function(){return 1};this.unload=function(){s_oStage.removeAllChildren();c.unload();p.removeAllEventListeners();l.destroyWorld();l=null};this.resetValues=function(){N=0;c.refreshTextScoreBoard(0,0,0,!1);Z=0;W=1;c.refreshLaunchBoard(Z,NUM_OF_PENALTY)};this.wallSoundCollision=function(){playSound("ball_collision",1,0)};this.areaGoal=function(){w||R||
(I?(w=!0,ga=TIME_RESET_AFTER_GOAL,this.textGoal(),this.calculateScore(),playSound("goal",1,0)):this.goalKeeperSave())};this.goalKeeperSave=function(){R=!0;ga=TIME_RESET_AFTER_SAVE;c.createAnimText(TEXT_SAVED,80,!1,TEXT_COLOR_1,TEXT_COLOR_STROKE);playSound("ball_saved",1,0);this.rejectBall();W=1;fa=0};this.rejectBall=function(){a.getPhysics().velocity.negate(a.getPhysics().velocity);switch(D){case 12:a.getPhysics().velocity=a.getPhysics().velocity.vadd(new CANNON.Vec3(.4*a.getPhysics().velocity.x,
.4*a.getPhysics().velocity.y,.4*a.getPhysics().velocity.z));break;default:a.getPhysics().velocity.vsub(new CANNON.Vec3(0,50,0))}};this.calculateScore=function(){var a=MAX_PERCENT_PROBABILITY-(MAX_PERCENT_PROBABILITY-AREAS_INFO[D].probability);this.addScore(a*W,a);W+=MULTIPLIER_STEP};this.goalProbability=function(){D=-1;for(var a=0;a<CALCULATE_PROBABILITY.length;a++)V.z<CALCULATE_PROBABILITY[a].zMax&&V.z>CALCULATE_PROBABILITY[a].zMin&&V.x<CALCULATE_PROBABILITY[a].xMax&&V.x>CALCULATE_PROBABILITY[a].xMin&&
(D=a);if(-1===D)return!1;for(var d=[],a=0;a<MAX_PERCENT_PROBABILITY;a++)d.push(!1);for(a=0;a<AREAS_INFO[D].probability;a++)d[a]=!0;return d[Math.floor(Math.random()*d.length)]};this.addImpulseToBall=function(d){if(!C&&J===STATE_PLAY){var k=l.ballBody();l.addImpulse(k,d);l.setElementAngularVelocity(k,{x:0,y:0,z:0});C=!0;a.setVisible(!0);f.setVisible(!1);this.chooseDirectionGoalKeeper(d);playSound("kick",1,0)}};this.chooseDirectionGoalKeeper=function(a){if(I)switch(a=d.getAnimType(),D){case 2:case 7:case 12:this.chooseWrongDirGK(ANIM_GOAL_KEEPER_FAIL_ALT);
break;default:this.chooseWrongDirGK(ANIM_GOAL_KEEPER_FAIL,a)}else switch(D){case -1:a.x<GOAL_KEEPER_TOLLERANCE_LEFT?d.runAnim(LEFT):a.y>GOAL_KEEPER_TOLLERANCE_RIGHT&&d.runAnim(RIGHT);break;default:d.runAnim(AREA_GOALS_ANIM[D])}E=!0};this.chooseWrongDirGK=function(a){for(var k=Math.floor(Math.random()*a.length);k===AREA_GOALS_ANIM[D];)k=Math.floor(Math.random()*a.length);d.runAnim(a[k])};this.pause=function(a){J=a?STATE_PAUSE:STATE_PLAY;createjs.Ticker.paused=a};this.onExit=function(){this.unload();
$(s_oMain).trigger("show_interlevel_ad");$(s_oMain).trigger("end_session");setVolume(s_oSoundTrack,1);s_oMain.gotoMenu()};this.restartLevel=function(){this.resetValues();this.resetScene();J=STATE_PLAY;this.startOpponentShot();$(s_oMain).trigger("restart_level",1)};this.resetBallPosition=function(){var d=l.ballBody();d.position.set(POSITION_BALL.x,POSITION_BALL.y,POSITION_BALL.z);l.setElementVelocity(d,{x:0,y:0,z:0});l.setElementAngularVelocity(d,{x:0,y:0,z:0});a.fadeAnimation(1,500,0);a.setVisible(!1);
f.setVisible(!0);f.setAlpha(0);f.fadeAnim(1,500,0)};this.ballFadeForReset=function(){R&&w&&x&&!B&&(a.fadeAnimation(0,300,10),B=!0)};this._updateInit=function(){l.update();this._updateBall2DPosition();J=STATE_PLAY};this.convert2dScreenPosTo3d=function(a){a=new THREE.Vector3(a.x/s_iCanvasResizeWidth*2-1,2*-(a.y/s_iCanvasResizeHeight)+1,-1);a.unproject(ea);a.sub(ea.position);a.normalize();a.multiply(new THREE.Vector3(0,1,0));return a};this.convert3dPosTo2dScreen=function(a,d){var k=(new THREE.Vector3(a.x,
a.y,a.z)).project(d),g=.5*Math.floor(s_iCanvasResizeWidth),f=.5*Math.floor(s_iCanvasResizeHeight);k.x=(k.x*g+g)*s_fInverseScaling;k.y=(-(k.y*f)+f)*s_fInverseScaling;return k};this.timeReset=function(){0<ga?ga-=s_iTimeElaps:this.endTurn()};this.restartGame=function(){this.resetValues();this.resetScene();J=STATE_PLAY;C=!1};this.endTurn=function(){Z++;c.refreshLaunchBoard(Z,NUM_OF_PENALTY);Z<NUM_OF_PENALTY?(this.resetScene(),C=!1,ca=MS_TIME_SWIPE_START):(J=STATE_FINISH,N>s_iBestScore&&(s_iBestScore=
Math.floor(N),saveItem(LOCALSTORAGE_STRING[LOCAL_BEST_SCORE],Math.floor(N))),c.createWinPanel(Math.floor(N)),$(s_oMain).trigger("end_level",1))};this.textGoal=function(){if(fa<TEXT_CONGRATULATION.length){var a=!1;fa>=TEXT_CONGRATULATION.length-1&&(a=!0);c.createAnimText(TEXT_CONGRATULATION[fa],TEXT_SIZE[fa],a,TEXT_COLOR,TEXT_COLOR_STROKE);fa++}else{var a=!1,d=Math.floor(Math.random()*(TEXT_CONGRATULATION.length-1))+1;d>=TEXT_CONGRATULATION.length-1&&(a=!0);c.createAnimText(TEXT_CONGRATULATION[d],
TEXT_SIZE[d],a,TEXT_COLOR,TEXT_COLOR_STROKE)}};this.goalAnimation=function(a){a>FORCE_BALL_DISPLAY_SHOCK[0].min&&a<FORCE_BALL_DISPLAY_SHOCK[0].max?this.displayShock(INTENSITY_DISPLAY_SHOCK[0].time,INTENSITY_DISPLAY_SHOCK[0].x,INTENSITY_DISPLAY_SHOCK[0].y):a>FORCE_BALL_DISPLAY_SHOCK[1].min&&a<FORCE_BALL_DISPLAY_SHOCK[1].max?this.displayShock(INTENSITY_DISPLAY_SHOCK[1].time,INTENSITY_DISPLAY_SHOCK[1].x,INTENSITY_DISPLAY_SHOCK[1].y):a>FORCE_BALL_DISPLAY_SHOCK[2].min&&a<FORCE_BALL_DISPLAY_SHOCK[2].max?
this.displayShock(INTENSITY_DISPLAY_SHOCK[2].time,INTENSITY_DISPLAY_SHOCK[2].x,INTENSITY_DISPLAY_SHOCK[2].y):a>FORCE_BALL_DISPLAY_SHOCK[3].min&&this.displayShock(INTENSITY_DISPLAY_SHOCK[3].time,INTENSITY_DISPLAY_SHOCK[3].x,INTENSITY_DISPLAY_SHOCK[3].y)};this.displayShock=function(a,d,k){createjs.Tween.get(m).to({x:Math.round(Math.random()*d),y:Math.round(Math.random()*k)},a).call(function(){createjs.Tween.get(m).to({x:Math.round(Math.random()*d*.8),y:-Math.round(Math.random()*k*.8)},a).call(function(){createjs.Tween.get(m).to({x:Math.round(Math.random()*
d*.6),y:Math.round(Math.random()*k*.6)},a).call(function(){createjs.Tween.get(m).to({x:Math.round(Math.random()*d*.4),y:-Math.round(Math.random()*k*.4)},a).call(function(){createjs.Tween.get(m).to({x:Math.round(Math.random()*d*.2),y:Math.round(Math.random()*k*.2)},a).call(function(){createjs.Tween.get(m).to({y:0,x:0},a).call(function(){})})})})})})};this.resetScene=function(){B=K=I=R=x=w=!1;d.setAlpha(0);d.fadeAnimation(1);d.runAnim(IDLE);this.resetBallPosition();this.sortDepth(a,y)};this._onEnd=
function(){this.onExit()};this.swapChildrenIndex=function(){for(var a=0;a<z.length-1;a++)for(var d=a+1;d<z.length;d++)z[a].getObject().visible&&z[d].getObject().visible&&this.sortDepth(z[a],z[d])};this.ballOut=function(){if(!x&&!w&&!R){var d=a.getPhysics().position;if(d.y>BALL_OUT_Y||d.x>BACK_WALL_GOAL_SIZE.width||d.x<-BACK_WALL_GOAL_SIZE.width)x=!0,ga=TIME_RESET_AFTER_BALL_OUT,c.createAnimText(TEXT_BALL_OUT,90,!1,TEXT_COLOR_1,TEXT_COLOR_STROKE),playSound("ball_saved",1,0),W=1,fa=0}};this.animPlayer=
function(){G?(G=u.animPlayer(),u.getFrame()===SHOOT_FRAME&&(this.addImpulseToBall({x:V.x,y:V.y,z:V.z}),ja=0,this.goalAnimation(V.y),c.unloadHelpText())):u.setVisible(!1)};this.animGoalKeeper=function(){C?E&&(E=d.update(),E||(d.viewFrame(d.getAnimArray(),d.getAnimArray().length-1),d.hideFrame(d.getAnimArray(),0),d.fadeAnimation(0))):d.update()};this.resetPoleCollision=function(){0<T?T-=s_iTimeElaps:w&&R||(c.createAnimText(TEXT_BALL_OUT,80,!1,TEXT_COLOR_1,TEXT_COLOR_STROKE),W=1,fa=0,playSound("ball_saved",
1,0),this.endTurn(),T=TIME_POLE_COLLISION_RESET)};this.handSwipeAnim=function(){t.isAnimate()||C||(0<ca?ca-=s_iTimeElaps:(t.animAllSwipe(),t.setVisible(!0),ca=MS_TIME_SWIPE_START))};this.swapGoal=function(){a.getPhysics().position.z>GOAL_SPRITE_SWAP_Z&&this.sortDepth(a,y)};this._updatePlay=function(){for(var a=0;a<PHYSICS_ACCURACY;a++)l.update();this.ballOut();w||x||R?this.timeReset():K&&this.resetPoleCollision();this.animGoalKeeper();this.animPlayer();this._updateBall2DPosition();this.handSwipeAnim();
this.swapChildrenIndex();this.swapGoal()};this.update=function(){switch(J){case STATE_INIT:this._updateInit();break;case STATE_PLAY:this._updatePlay()}};this._updateBall2DPosition=function(){this.ballPosition();a.rolls();ea.updateProjectionMatrix();ea.updateMatrixWorld()};s_oGame=this;AREAS_INFO=k.area_goal;NUM_OF_PENALTY=k.num_of_penalty;MULTIPLIER_STEP=k.multiplier_step;NUM_LEVEL_FOR_ADS=k.num_levels_for_ads;ENABLE_FULLSCREEN=k.fullscreen;this._init()}var s_oGame;
function CInterface(){var k,c,e,l,a,f,d,m,g,n,p,u,q=null,t,y,w,C,x,B=null,G=null;this._init=function(){var q=s_oSpriteLibrary.getSprite("but_exit");e=CANVAS_WIDTH-q.height/2-10;l=q.height/2+10;g=new CGfxButton(e,l,q);g.addEventListener(ON_MOUSE_UP,this._onExit,this);q=s_oSpriteLibrary.getSprite("but_pause");k=e-q.height-10;c=l;n=new CGfxButton(k,c,q);n.addEventListener(ON_MOUSE_UP,this.onButPauseRelease,this);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)q=s_oSpriteLibrary.getSprite("audio_icon"),
d=k-q.height-10,m=l,u=new CToggle(d,m,q,s_bAudioActive),u.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);var q=window.document,t=q.documentElement;B=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen;G=q.exitFullscreen||q.mozCancelFullScreen||q.webkitExitFullscreen||q.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(B=!1);B&&!inIframe()&&(q=s_oSpriteLibrary.getSprite("but_fullscreen"),a=q.width/4+10,f=q.height/2+10,p=new CToggle(a,f,q,s_bFullscreen,s_oStage),
p.addEventListener(ON_MOUSE_UP,this._onFullscreen,this));y=new CScoreBoard(s_oStage);w=new CLaunchBoard(s_oStage);C=new CHelpText(s_oStage);C.fadeAnim(1,null);this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.refreshButtonPos=function(q,t){g.setPosition(e-q,t+l);n.setPosition(k-q,t+c);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||u.setPosition(d-q,t+m);var C=y.getStartPosScore();y.setPosScore(C.x+q,C.y-t);C=w.getStartPos();w.setPos(C.x-q,C.y-t);B&&!inIframe()&&p.setPosition(a+q,f+t)};this.unloadHelpText=
function(){null!==C&&(C.fadeAnim(0,C.unload),C=null)};this.unload=function(){g.unload();g=null;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)u.unload(),u=null;B&&!inIframe()&&(p.unload(),p=null);s_oInterface=null};this.createWinPanel=function(a){q=new CWinPanel(s_oSpriteLibrary.getSprite("msg_box"));q.show(a)};this.refreshTextScoreBoard=function(a,d,k,g){y.refreshTextScore(a);g&&y.effectAddScore(k,d)};this._onFullscreen=function(){s_bFullscreen?(G.call(window.document),s_bFullscreen=!1):(B.call(window.document.documentElement),
s_bFullscreen=!0);sizeHandler()};this.createAnimText=function(a,d,k,g,f){var c=new createjs.Container,n=new createjs.Text(a,d+"px "+SECONDARY_FONT,f);n.x=0;n.y=0;n.textAlign="center";n.outline=4;c.addChild(n);var e=new createjs.Text(n.text,d+"px "+SECONDARY_FONT,g);e.x=0;e.y=0;e.textAlign="center";c.addChild(e);c.x=CANVAS_WIDTH_HALF;c.y=-n.getBounds().height;k&&s_oInterface.strobeText(e);s_oStage.addChild(c);createjs.Tween.get(c).to({y:CANVAS_HEIGHT_HALF},500,createjs.Ease.cubicOut).call(function(){createjs.Tween.get(c).wait(250).to({y:CANVAS_HEIGHT+
n.getBounds().height},500,createjs.Ease.cubicIn).call(function(){k&&createjs.Tween.removeTweens(e);s_oStage.removeChild(c)})})};this.strobeText=function(a){createjs.Tween.get(a).wait(30).call(function(){x<TEXT_EXCELLENT_COLOR.length-1?x++:x=0;a.color=TEXT_EXCELLENT_COLOR[x];s_oInterface.strobeText(a)})};this.refreshLaunchBoard=function(a,d){w.refreshTextLaunch(a,d)};this._onAudioToggle=function(){createjs.Sound.setMute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){(new CAreYouSurePanel(s_oStage)).show()};
this.unloadPause=function(){t.unload();t=null};this.onButPauseRelease=function(){playSound("click",1,0);t=new CPause};s_oInterface=this;this._init();return this}var s_oInterface=null;
!function(k){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=k();else{var c;"undefined"!=typeof window?c=window:"undefined"!=typeof global?c=global:"undefined"!=typeof self&&(c=self);c.CANNON=k()}}(function(){return function c(e,l,a){function f(g,n){if(!l[g]){if(!e[g]){var m="function"==typeof require&&require;if(!n&&m)return m(g,!0);if(d)return d(g,!0);throw Error("Cannot find module '"+g+"'");}m=l[g]={exports:{}};e[g][0].call(m.exports,function(a){var d=e[g][1][a];return f(d?
d:a)},m,m.exports,c,e,l,a)}return l[g].exports}for(var d="function"==typeof require&&require,m=0;m<a.length;m++)f(a[m]);return f}({1:[function(c,e,l){e.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},
bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(c,e,l){e.exports={version:c("../package.json").version,AABB:c("./collision/AABB"),ArrayCollisionMatrix:c("./collision/ArrayCollisionMatrix"),
Body:c("./objects/Body"),Box:c("./shapes/Box"),Broadphase:c("./collision/Broadphase"),Constraint:c("./constraints/Constraint"),ContactEquation:c("./equations/ContactEquation"),Narrowphase:c("./world/Narrowphase"),ConeTwistConstraint:c("./constraints/ConeTwistConstraint"),ContactMaterial:c("./material/ContactMaterial"),ConvexPolyhedron:c("./shapes/ConvexPolyhedron"),Cylinder:c("./shapes/Cylinder"),DistanceConstraint:c("./constraints/DistanceConstraint"),Equation:c("./equations/Equation"),EventTarget:c("./utils/EventTarget"),
FrictionEquation:c("./equations/FrictionEquation"),GSSolver:c("./solver/GSSolver"),GridBroadphase:c("./collision/GridBroadphase"),Heightfield:c("./shapes/Heightfield"),HingeConstraint:c("./constraints/HingeConstraint"),LockConstraint:c("./constraints/LockConstraint"),Mat3:c("./math/Mat3"),Material:c("./material/Material"),NaiveBroadphase:c("./collision/NaiveBroadphase"),ObjectCollisionMatrix:c("./collision/ObjectCollisionMatrix"),Pool:c("./utils/Pool"),Particle:c("./shapes/Particle"),Plane:c("./shapes/Plane"),
PointToPointConstraint:c("./constraints/PointToPointConstraint"),Quaternion:c("./math/Quaternion"),Ray:c("./collision/Ray"),RaycastVehicle:c("./objects/RaycastVehicle"),RaycastResult:c("./collision/RaycastResult"),RigidVehicle:c("./objects/RigidVehicle"),RotationalEquation:c("./equations/RotationalEquation"),RotationalMotorEquation:c("./equations/RotationalMotorEquation"),SAPBroadphase:c("./collision/SAPBroadphase"),SPHSystem:c("./objects/SPHSystem"),Shape:c("./shapes/Shape"),Solver:c("./solver/Solver"),
Sphere:c("./shapes/Sphere"),SplitSolver:c("./solver/SplitSolver"),Spring:c("./objects/Spring"),Trimesh:c("./shapes/Trimesh"),Vec3:c("./math/Vec3"),Vec3Pool:c("./utils/Vec3Pool"),World:c("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,
"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,
"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(c,e,l){function a(a){a=a||{};
this.lowerBound=new f;a.lowerBound&&this.lowerBound.copy(a.lowerBound);this.upperBound=new f;a.upperBound&&this.upperBound.copy(a.upperBound)}var f=c("../math/Vec3");c("../utils/Utils");e.exports=a;var d=new f;a.prototype.setFromPoints=function(a,f,c,e){var g=this.lowerBound,n=this.upperBound;g.copy(a[0]);c&&c.vmult(g,g);n.copy(g);for(var m=1;m<a.length;m++){var p=a[m];c&&(c.vmult(p,d),p=d);p.x>n.x&&(n.x=p.x);p.x<g.x&&(g.x=p.x);p.y>n.y&&(n.y=p.y);p.y<g.y&&(g.y=p.y);p.z>n.z&&(n.z=p.z);p.z<g.z&&(g.z=
p.z)}f&&(f.vadd(g,g),f.vadd(n,n));e&&(g.x-=e,g.y-=e,g.z-=e,n.x+=e,n.y+=e,n.z+=e);return this};a.prototype.copy=function(a){this.lowerBound.copy(a.lowerBound);this.upperBound.copy(a.upperBound);return this};a.prototype.clone=function(){return(new a).copy(this)};a.prototype.extend=function(a){var d=a.lowerBound.x;this.lowerBound.x>d&&(this.lowerBound.x=d);d=a.upperBound.x;this.upperBound.x<d&&(this.upperBound.x=d);d=a.lowerBound.y;this.lowerBound.y>d&&(this.lowerBound.y=d);d=a.upperBound.y;this.upperBound.y<
d&&(this.upperBound.y=d);d=a.lowerBound.z;this.lowerBound.z>d&&(this.lowerBound.z=d);d=a.upperBound.z;this.upperBound.z<d&&(this.upperBound.z=d)};a.prototype.overlaps=function(a){var d=this.lowerBound,g=this.upperBound,f=a.lowerBound;a=a.upperBound;return(f.x<=g.x&&g.x<=a.x||d.x<=a.x&&a.x<=g.x)&&(f.y<=g.y&&g.y<=a.y||d.y<=a.y&&a.y<=g.y)&&(f.z<=g.z&&g.z<=a.z||d.z<=a.z&&a.z<=g.z)};a.prototype.contains=function(a){var d=this.lowerBound,g=this.upperBound,f=a.lowerBound;a=a.upperBound;return d.x<=f.x&&
g.x>=a.x&&d.y<=f.y&&g.y>=a.y&&d.z<=f.z&&g.z>=a.z};a.prototype.getCorners=function(a,d,f,c,e,m,l,w){var g=this.lowerBound,n=this.upperBound;a.copy(g);d.set(n.x,g.y,g.z);f.set(n.x,n.y,g.z);c.set(g.x,n.y,n.z);e.set(n.x,g.y,g.z);m.set(g.x,n.y,g.z);l.set(g.x,g.y,n.z);w.copy(n)};var m=[new f,new f,new f,new f,new f,new f,new f,new f];a.prototype.toLocalFrame=function(a,d){this.getCorners(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7]);for(var g=0;8!==g;g++){var f=m[g];a.pointToLocal(f,f)}return d.setFromPoints(m)};
a.prototype.toWorldFrame=function(a,d){this.getCorners(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7]);for(var g=0;8!==g;g++){var f=m[g];a.pointToWorld(f,f)}return d.setFromPoints(m)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(c,e,l){function a(){this.matrix=[]}e.exports=a;a.prototype.get=function(a,d){a=a.index;d=d.index;if(d>a){var f=d;d=a;a=f}return this.matrix[(a*(a+1)>>1)+d-1]};a.prototype.set=function(a,d,c){a=a.index;d=d.index;if(d>a){var g=d;d=a;a=g}this.matrix[(a*(a+1)>>1)+d-1]=c?1:0};
a.prototype.reset=function(){for(var a=0,d=this.matrix.length;a!==d;a++)this.matrix[a]=0};a.prototype.setNumObjects=function(a){this.matrix.length=a*(a-1)>>1}},{}],5:[function(c,e,l){function a(){this.world=null;this.useBoundingBoxes=!1;this.dirty=!0}var f=c("../objects/Body");l=c("../math/Vec3");var d=c("../math/Quaternion");c("../shapes/Shape");c("../shapes/Plane");e.exports=a;a.prototype.collisionPairs=function(a,d,g){throw Error("collisionPairs not implemented for this BroadPhase class!");};var m=
f.STATIC|f.KINEMATIC;a.prototype.needBroadphaseCollision=function(a,d){return 0!==(a.collisionFilterGroup&d.collisionFilterMask)&&0!==(d.collisionFilterGroup&a.collisionFilterMask)&&(0===(a.type&m)&&a.sleepState!==f.SLEEPING||0===(d.type&m)&&d.sleepState!==f.SLEEPING)?!0:!1};a.prototype.intersectionTest=function(a,d,g,f){this.useBoundingBoxes?this.doBoundingBoxBroadphase(a,d,g,f):this.doBoundingSphereBroadphase(a,d,g,f)};var g=new l;new l;new d;new l;a.prototype.doBoundingSphereBroadphase=function(a,
d,f,c){d.position.vsub(a.position,g);var n=Math.pow(a.boundingRadius+d.boundingRadius,2);g.norm2()<n&&(f.push(a),c.push(d))};a.prototype.doBoundingBoxBroadphase=function(a,d,g,f){a.aabbNeedsUpdate&&a.computeAABB();d.aabbNeedsUpdate&&d.computeAABB();a.aabb.overlaps(d.aabb)&&(g.push(a),f.push(d))};var n={keys:[]},p=[],u=[];a.prototype.makePairsUnique=function(a,d){for(var g=a.length,f=0;f!==g;f++)p[f]=a[f],u[f]=d[f];a.length=0;for(f=d.length=0;f!==g;f++){var c=p[f].id,e=u[f].id,c=c<e?c+","+e:e+","+
c;n[c]=f;n.keys.push(c)}for(f=0;f!==n.keys.length;f++)c=n.keys.pop(),g=n[c],a.push(p[g]),d.push(u[g]),delete n[c]};a.prototype.setWorld=function(a){};var q=new l;a.boundingSphereCheck=function(a,d){a.position.vsub(d.position,q);return Math.pow(a.shape.boundingSphereRadius+d.shape.boundingSphereRadius,2)>q.norm2()};a.prototype.aabbQuery=function(a,d,g){console.warn(".aabbQuery is not implemented in this Broadphase subclass.");return[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,
"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(c,e,l){function a(a,g,c,e,m){f.apply(this);this.nx=c||10;this.ny=e||10;this.nz=m||10;this.aabbMin=a||new d(100,100,100);this.aabbMax=g||new d(-100,-100,-100);a=this.nx*this.ny*this.nz;if(0>=a)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[];this.binLengths=[];this.bins.length=a;this.binLengths.length=a;for(g=0;g<a;g++)this.bins[g]=[],this.binLengths[g]=0}e.exports=a;var f=c("./Broadphase"),d=c("../math/Vec3"),m=c("../shapes/Shape");
a.prototype=new f;a.prototype.constructor=a;var g=new d;new d;a.prototype.collisionPairs=function(a,d,f){function c(a,d,g,f,c,n,e){a=(a-N)*fa|0;d=(d-D)*ja|0;g=(g-Z)*ga|0;f=ea((f-N)*fa);c=ea((c-D)*ja);n=ea((n-Z)*ga);0>a?a=0:a>=u&&(a=u-1);0>d?d=0:d>=l&&(d=l-1);0>g?g=0:g>=B&&(g=B-1);0>f?f=0:f>=u&&(f=u-1);0>c?c=0:c>=l&&(c=l-1);0>n?n=0:n>=B&&(n=B-1);a*=G;d*=E;g*=1;f*=G;c*=E;for(n*=1;a<=f;a+=G)for(var m=d;m<=c;m+=E)for(var p=g;p<=n;p+=1){var q=a+m+p;V[q][J[q]++]=e}}var n=a.numObjects();a=a.bodies;for(var e=
this.aabbMax,p=this.aabbMin,u=this.nx,l=this.ny,B=this.nz,G=l*B,E=B,R=e.x,I=e.y,K=e.z,N=p.x,D=p.y,Z=p.z,fa=u/(R-N),ja=l/(I-D),ga=B/(K-Z),R=(R-N)/u,T=(I-D)/l,K=(K-Z)/B,ca=.5*Math.sqrt(R*R+T*T+K*K),I=m.types,W=I.SPHERE,z=I.PLANE,V=this.bins,J=this.binLengths,I=this.bins.length,p=0;p!==I;p++)J[p]=0;for(var ea=Math.ceil,p=Math.min,e=Math.max,p=0;p!==n;p++){var e=a[p],S=e.shape;switch(S.type){case W:var xa=e.position.x,qa=e.position.y,Ra=e.position.z,S=S.radius;c(xa-S,qa-S,Ra-S,xa+S,qa+S,Ra+S,e);break;
case z:S.worldNormalNeedsUpdate&&S.computeWorldNormal(e.quaternion);var Ra=S.worldNormal,S=D+.5*T-e.position.y,oa=Z+.5*K-e.position.z,O=g;O.set(N+.5*R-e.position.x,S,oa);for(var Na=xa=0;xa!==u;xa++,Na+=G,O.y=S,O.x+=R)for(var Wa=qa=0;qa!==l;qa++,Wa+=E,O.z=oa,O.y+=T)for(var db=0,aa=0;db!==B;db++,aa+=1,O.z+=K)if(O.dot(Ra)<ca){var Ba=Na+Wa+aa;V[Ba][J[Ba]++]=e}break;default:e.aabbNeedsUpdate&&e.computeAABB(),c(e.aabb.lowerBound.x,e.aabb.lowerBound.y,e.aabb.lowerBound.z,e.aabb.upperBound.x,e.aabb.upperBound.y,
e.aabb.upperBound.z,e)}}for(p=0;p!==I;p++)if(n=J[p],1<n)for(a=V[p],xa=0;xa!==n;xa++)for(e=a[xa],qa=0;qa!==xa;qa++)R=a[qa],this.needBroadphaseCollision(e,R)&&this.intersectionTest(e,R,d,f);this.makePairsUnique(d,f)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(c,e,l){function a(){f.apply(this)}e.exports=a;var f=c("./Broadphase");c=c("./AABB");a.prototype=new f;a.prototype.constructor=a;a.prototype.collisionPairs=function(a,f,g){a=a.bodies;var d=a.length,c,e,m,t;for(c=0;c!==
d;c++)for(e=0;e!==c;e++)m=a[c],t=a[e],this.needBroadphaseCollision(m,t)&&this.intersectionTest(m,t,f,g)};new c;a.prototype.aabbQuery=function(a,f,g){g=g||[];for(var d=0;d<a.bodies.length;d++){var c=a.bodies[d];c.aabbNeedsUpdate&&c.computeAABB();c.aabb.overlaps(f)&&g.push(c)}return g}},{"./AABB":3,"./Broadphase":5}],8:[function(c,e,l){function a(){this.matrix={}}e.exports=a;a.prototype.get=function(a,d){a=a.id;d=d.id;if(d>a){var f=d;d=a;a=f}return a+"-"+d in this.matrix};a.prototype.set=function(a,
d,c){a=a.id;d=d.id;if(d>a){var g=d;d=a;a=g}c?this.matrix[a+"-"+d]=!0:delete this.matrix[a+"-"+d]};a.prototype.reset=function(){this.matrix={}};a.prototype.setNumObjects=function(a){}},{}],9:[function(c,e,l){function a(c,f){this.from=c?c.clone():new d;this.to=f?f.clone():new d;this._direction=new d;this.precision=1E-4;this.checkCollisionResponse=!0;this.skipBackfaces=!1;this.collisionFilterGroup=this.collisionFilterMask=-1;this.mode=a.ANY;this.result=new g;this.hasHit=!1;this.callback=function(a){}}
function f(a,d,g,c){c.vsub(d,W);g.vsub(d,u);a.vsub(d,q);a=W.dot(W);d=W.dot(u);g=W.dot(q);c=u.dot(u);var f=u.dot(q),n,e;return 0<=(n=c*g-d*f)&&0<=(e=a*f-d*g)&&n+e<a*c-d*d}e.exports=a;var d=c("../math/Vec3");e=c("../math/Quaternion");var m=c("../math/Transform");c("../shapes/ConvexPolyhedron");c("../shapes/Box");var g=c("../collision/RaycastResult");l=c("../shapes/Shape");c=c("../collision/AABB");a.prototype.constructor=a;a.CLOSEST=1;a.ANY=2;a.ALL=4;var n=new c,p=[];a.prototype.intersectWorld=function(d,
c){this.mode=c.mode||a.ANY;this.result=c.result||new g;this.skipBackfaces=!!c.skipBackfaces;this.collisionFilterMask="undefined"!==typeof c.collisionFilterMask?c.collisionFilterMask:-1;this.collisionFilterGroup="undefined"!==typeof c.collisionFilterGroup?c.collisionFilterGroup:-1;c.from&&this.from.copy(c.from);c.to&&this.to.copy(c.to);this.callback=c.callback||function(){};this.hasHit=!1;this.result.reset();this._updateDirection();this.getAABB(n);p.length=0;d.broadphase.aabbQuery(d,n,p);this.intersectBodies(p);
return this.hasHit};var u=new d,q=new d;a.pointInTriangle=f;var t=new d,y=new e;a.prototype.intersectBody=function(a,d){d&&(this.result=d,this._updateDirection());var g=this.checkCollisionResponse;if((!g||a.collisionResponse)&&0!==(this.collisionFilterGroup&a.collisionFilterMask)&&0!==(a.collisionFilterGroup&this.collisionFilterMask))for(var c=0,f=a.shapes.length;c<f;c++){var n=a.shapes[c];if(!g||n.collisionResponse)if(a.quaternion.mult(a.shapeOrientations[c],y),a.quaternion.vmult(a.shapeOffsets[c],
t),t.vadd(a.position,t),this.intersectShape(n,y,t,a),this.result._shouldStop)break}};a.prototype.intersectBodies=function(a,d){d&&(this.result=d,this._updateDirection());for(var g=0,c=a.length;!this.result._shouldStop&&g<c;g++)this.intersectBody(a[g])};a.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction);this._direction.normalize()};a.prototype.intersectShape=function(a,d,g,c){var f=this.from,n=this._direction;g.vsub(f,W);var e=W.dot(n);n.mult(e,z);z.vadd(f,z);g.distanceTo(z)>
a.boundingSphereRadius||(f=this[a.type])&&f.call(this,a,d,g,c)};new d;new d;var w=new d,C=new d,x=new d,B=new d;new d;new g;a.prototype.intersectBox=function(a,d,g,c){return this.intersectConvex(a.convexPolyhedronRepresentation,d,g,c)};a.prototype[l.types.BOX]=a.prototype.intersectBox;a.prototype.intersectPlane=function(a,g,c,f){var n=this.from,e=this.to,m=this._direction,p=new d(0,0,1);g.vmult(p,p);var q=new d;n.vsub(c,q);g=q.dot(p);e.vsub(c,q);q=q.dot(p);if(!(0<g*q||n.distanceTo(e)<g||(q=p.dot(m),
Math.abs(q)<this.precision))){var u=new d,e=new d;g=new d;n.vsub(c,u);c=-p.dot(u)/q;m.scale(c,e);n.vadd(e,g);this.reportIntersection(p,g,a,f,-1)}};a.prototype[l.types.PLANE]=a.prototype.intersectPlane;a.prototype.getAABB=function(a){var d=this.to,g=this.from;a.lowerBound.x=Math.min(d.x,g.x);a.lowerBound.y=Math.min(d.y,g.y);a.lowerBound.z=Math.min(d.z,g.z);a.upperBound.x=Math.max(d.x,g.x);a.upperBound.y=Math.max(d.y,g.y);a.upperBound.z=Math.max(d.z,g.z)};var G={faceList:[0]};a.prototype.intersectHeightfield=
function(g,c,f,n){var e=new d,p=new a(this.from,this.to);m.pointToLocalFrame(f,c,p.from,p.from);m.pointToLocalFrame(f,c,p.to,p.to);var q=[],u=null,t=null,l=null,w=null,y=g.getIndexOfPosition(p.from.x,p.from.y,q,!1);y&&(u=q[0],t=q[1],l=q[0],w=q[1]);if(y=g.getIndexOfPosition(p.to.x,p.to.y,q,!1)){if(null===u||q[0]<u)u=q[0];if(null===l||q[0]>l)l=q[0];if(null===t||q[1]<t)t=q[1];if(null===w||q[1]>w)w=q[1]}if(null!==u)for(g.getRectMinMax(u,t,l,w,[]),p=u;p<=l;p++)for(q=t;q<=w;q++){if(this.result._shouldStop)return;
g.getConvexTrianglePillar(p,q,!1);m.pointToWorldFrame(f,c,g.pillarOffset,e);this.intersectConvex(g.pillarConvex,c,e,n,G);if(this.result._shouldStop)return;g.getConvexTrianglePillar(p,q,!0);m.pointToWorldFrame(f,c,g.pillarOffset,e);this.intersectConvex(g.pillarConvex,c,e,n,G)}};a.prototype[l.types.HEIGHTFIELD]=a.prototype.intersectHeightfield;var E=new d,R=new d;a.prototype.intersectSphere=function(a,d,g,c){d=this.from;var f=this.to,n=Math.pow(f.x-d.x,2)+Math.pow(f.y-d.y,2)+Math.pow(f.z-d.z,2),e=2*
((f.x-d.x)*(d.x-g.x)+(f.y-d.y)*(d.y-g.y)+(f.z-d.z)*(d.z-g.z)),m=Math.pow(e,2)-4*n*(Math.pow(d.x-g.x,2)+Math.pow(d.y-g.y,2)+Math.pow(d.z-g.z,2)-Math.pow(a.radius,2));if(!(0>m))if(0===m)d.lerp(f,m,E),E.vsub(g,R),R.normalize(),this.reportIntersection(R,E,a,c,-1);else{var p=(-e-Math.sqrt(m))/(2*n),n=(-e+Math.sqrt(m))/(2*n);0<=p&&1>=p&&(d.lerp(f,p,E),E.vsub(g,R),R.normalize(),this.reportIntersection(R,E,a,c,-1));!this.result._shouldStop&&0<=n&&1>=n&&(d.lerp(f,n,E),E.vsub(g,R),R.normalize(),this.reportIntersection(R,
E,a,c,-1))}};a.prototype[l.types.SPHERE]=a.prototype.intersectSphere;var I=new d;new d;new d;var K=new d;a.prototype.intersectConvex=function(a,d,g,c,n){n=n&&n.faceList||null;for(var e=a.faces,m=a.vertices,p=a.faceNormals,q=this._direction,u=this.from,t=u.distanceTo(this.to),l=n?n.length:e.length,y=this.result,z=0;!y._shouldStop&&z<l;z++){var J=n?n[z]:z,ea=e[J],S=p[J],D=d,V=g;K.copy(m[ea[0]]);D.vmult(K,K);K.vadd(V,K);K.vsub(u,K);D.vmult(S,I);S=q.dot(I);if(!(Math.abs(S)<this.precision||(S=I.dot(K)/
S,0>S)))for(q.mult(S,w),w.vadd(u,w),C.copy(m[ea[0]]),D.vmult(C,C),V.vadd(C,C),S=1;!y._shouldStop&&S<ea.length-1;S++){x.copy(m[ea[S]]);B.copy(m[ea[S+1]]);D.vmult(x,x);D.vmult(B,B);V.vadd(x,x);V.vadd(B,B);var Z=w.distanceTo(u);!f(w,C,x,B)&&!f(w,x,C,B)||Z>t||this.reportIntersection(I,w,a,c,J)}}};a.prototype[l.types.CONVEXPOLYHEDRON]=a.prototype.intersectConvex;var N=new d,D=new d,Z=new d,fa=new d,ja=new d,ga=new d;new c;var T=[],ca=new m;a.prototype.intersectTrimesh=function(a,d,g,c,n){n=a.indices;var e=
this.from,p=this.to,q=this._direction;ca.position.copy(g);ca.quaternion.copy(d);m.vectorToLocalFrame(g,d,q,D);m.pointToLocalFrame(g,d,e,Z);m.pointToLocalFrame(g,d,p,fa);e=Z.distanceSquared(fa);a.tree.rayQuery(this,ca,T);p=0;for(q=T.length;!this.result._shouldStop&&p!==q;p++){var u=T[p];a.getNormal(u,N);a.getVertex(n[3*u],C);C.vsub(Z,K);var t=D.dot(N),t=N.dot(K)/t;0>t||(D.scale(t,w),w.vadd(Z,w),a.getVertex(n[3*u+1],x),a.getVertex(n[3*u+2],B),t=w.distanceSquared(Z),!f(w,x,C,B)&&!f(w,C,x,B)||t>e||(m.vectorToWorldFrame(d,
N,ja),m.pointToWorldFrame(g,d,w,ga),this.reportIntersection(ja,ga,a,c,u)))}T.length=0};a.prototype[l.types.TRIMESH]=a.prototype.intersectTrimesh;a.prototype.reportIntersection=function(d,g,c,f,n){var e=this.from,m=this.to,p=e.distanceTo(g),q=this.result;if(!(this.skipBackfaces&&0<d.dot(this._direction)))switch(q.hitFaceIndex="undefined"!==typeof n?n:-1,this.mode){case a.ALL:this.hasHit=!0;q.set(e,m,d,g,c,f,p);q.hasHit=!0;this.callback(q);break;case a.CLOSEST:if(p<q.distance||!q.hasHit)this.hasHit=
!0,q.hasHit=!0,q.set(e,m,d,g,c,f,p);break;case a.ANY:this.hasHit=!0,q.hasHit=!0,q.set(e,m,d,g,c,f,p),q._shouldStop=!0}};var W=new d,z=new d},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(c,e,l){function a(){this.rayFromWorld=new f;this.rayToWorld=new f;this.hitNormalWorld=new f;this.hitPointWorld=new f;this.hasHit=!1;this.body=this.shape=
null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1}var f=c("../math/Vec3");e.exports=a;a.prototype.reset=function(){this.rayFromWorld.setZero();this.rayToWorld.setZero();this.hitNormalWorld.setZero();this.hitPointWorld.setZero();this.hasHit=!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1};a.prototype.abort=function(){this._shouldStop=!0};a.prototype.set=function(a,c,g,f,e,u,q){this.rayFromWorld.copy(a);this.rayToWorld.copy(c);this.hitNormalWorld.copy(g);
this.hitPointWorld.copy(f);this.shape=e;this.body=u;this.distance=q}},{"../math/Vec3":30}],11:[function(c,e,l){function a(a){f.apply(this);this.axisList=[];this.world=null;this.axisIndex=0;var d=this.axisList;this._addBodyHandler=function(a){d.push(a.body)};this._removeBodyHandler=function(a){a=d.indexOf(a.body);-1!==a&&d.splice(a,1)};a&&this.setWorld(a)}c("../shapes/Shape");var f=c("../collision/Broadphase");e.exports=a;a.prototype=new f;a.prototype.setWorld=function(a){for(var d=this.axisList.length=
0;d<a.bodies.length;d++)this.axisList.push(a.bodies[d]);a.removeEventListener("addBody",this._addBodyHandler);a.removeEventListener("removeBody",this._removeBodyHandler);a.addEventListener("addBody",this._addBodyHandler);a.addEventListener("removeBody",this._removeBodyHandler);this.world=a;this.dirty=!0};a.insertionSortX=function(a){for(var d=1,g=a.length;d<g;d++){for(var c=a[d],f=d-1;0<=f&&!(a[f].aabb.lowerBound.x<=c.aabb.lowerBound.x);f--)a[f+1]=a[f];a[f+1]=c}return a};a.insertionSortY=function(a){for(var d=
1,g=a.length;d<g;d++){for(var c=a[d],f=d-1;0<=f&&!(a[f].aabb.lowerBound.y<=c.aabb.lowerBound.y);f--)a[f+1]=a[f];a[f+1]=c}return a};a.insertionSortZ=function(a){for(var d=1,g=a.length;d<g;d++){for(var c=a[d],f=d-1;0<=f&&!(a[f].aabb.lowerBound.z<=c.aabb.lowerBound.z);f--)a[f+1]=a[f];a[f+1]=c}return a};a.prototype.collisionPairs=function(d,c,g){d=this.axisList;var f=d.length,e=this.axisIndex,m,q;this.dirty&&(this.sortList(),this.dirty=!1);for(m=0;m!==f;m++){var t=d[m];for(q=m+1;q<f;q++){var l=d[q];if(this.needBroadphaseCollision(t,
l)){if(!a.checkBounds(t,l,e))break;this.intersectionTest(t,l,c,g)}}}};a.prototype.sortList=function(){for(var d=this.axisList,c=this.axisIndex,g=d.length,f=0;f!==g;f++){var e=d[f];e.aabbNeedsUpdate&&e.computeAABB()}0===c?a.insertionSortX(d):1===c?a.insertionSortY(d):2===c&&a.insertionSortZ(d)};a.checkBounds=function(a,c,g){var d,f;0===g?(d=a.position.x,f=c.position.x):1===g?(d=a.position.y,f=c.position.y):2===g&&(d=a.position.z,f=c.position.z);return f-c.boundingRadius<d+a.boundingRadius};a.prototype.autoDetectAxis=
function(){for(var a=0,c=0,g=0,f=0,e=0,u=0,q=this.axisList,t=q.length,l=1/t,w=0;w!==t;w++)var C=q[w],x=C.position.x,a=a+x,c=c+x*x,x=C.position.y,g=g+x,f=f+x*x,C=C.position.z,e=e+C,u=u+C*C;a=c-a*a*l;g=f-g*g*l;e=u-e*e*l;this.axisIndex=a>g?a>e?0:2:g>e?1:2};a.prototype.aabbQuery=function(a,c,g){g=g||[];this.dirty&&(this.sortList(),this.dirty=!1);a=this.axisList;for(var d=0;d<a.length;d++){var f=a[d];f.aabbNeedsUpdate&&f.computeAABB();f.aabb.overlaps(c)&&g.push(f)}return g}},{"../collision/Broadphase":5,
"../shapes/Shape":43}],12:[function(c,e,l){function a(a,c,e){e=e||{};var n="undefined"!==typeof e.maxForce?e.maxForce:1E6,p=e.pivotA?e.pivotA.clone():new g,u=e.pivotB?e.pivotB.clone():new g;this.axisA=e.axisA?e.axisA.clone():new g;this.axisB=e.axisB?e.axisB.clone():new g;f.call(this,a,p,c,u,n);this.collideConnected=!!e.collideConnected;this.angle="undefined"!==typeof e.angle?e.angle:0;p=this.coneEquation=new d(a,c,e);a=this.twistEquation=new m(a,c,e);this.twistAngle="undefined"!==typeof e.twistAngle?
e.twistAngle:0;p.maxForce=0;p.minForce=-n;a.maxForce=0;a.minForce=-n;this.equations.push(p,a)}e.exports=a;c("./Constraint");var f=c("./PointToPointConstraint"),d=c("../equations/ConeEquation"),m=c("../equations/RotationalEquation");c("../equations/ContactEquation");var g=c("../math/Vec3");a.prototype=new f;a.constructor=a;new g;new g;a.prototype.update=function(){var a=this.bodyA,d=this.bodyB,g=this.coneEquation,c=this.twistEquation;f.prototype.update.call(this);a.vectorToWorldFrame(this.axisA,g.axisA);
d.vectorToWorldFrame(this.axisB,g.axisB);this.axisA.tangents(c.axisA,c.axisA);a.vectorToWorldFrame(c.axisA,c.axisA);this.axisB.tangents(c.axisB,c.axisB);d.vectorToWorldFrame(c.axisB,c.axisB);g.angle=this.angle;c.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(c,e,l){function a(d,c,g){g=f.defaults(g,{collideConnected:!0,wakeUpBodies:!0});
this.equations=[];this.bodyA=d;this.bodyB=c;this.id=a.idCounter++;this.collideConnected=g.collideConnected;g.wakeUpBodies&&(d&&d.wakeUp(),c&&c.wakeUp())}e.exports=a;var f=c("../utils/Utils");a.prototype.update=function(){throw Error("method update() not implmemented in this Constraint subclass!");};a.prototype.enable=function(){for(var a=this.equations,c=0;c<a.length;c++)a[c].enabled=!0};a.prototype.disable=function(){for(var a=this.equations,c=0;c<a.length;c++)a[c].enabled=!1};a.idCounter=0},{"../utils/Utils":53}],
14:[function(c,e,l){function a(a,g,c,e){f.call(this,a,g);"undefined"===typeof c&&(c=a.position.distanceTo(g.position));"undefined"===typeof e&&(e=1E6);this.distance=c;a=this.distanceEquation=new d(a,g);this.equations.push(a);a.minForce=-e;a.maxForce=e}e.exports=a;var f=c("./Constraint"),d=c("../equations/ContactEquation");a.prototype=new f;a.prototype.update=function(){var a=this.distanceEquation,d=.5*this.distance,c=a.ni;this.bodyB.position.vsub(this.bodyA.position,c);c.normalize();c.mult(d,a.ri);
c.mult(-d,a.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(c,e,l){function a(a,c,e){e=e||{};var n="undefined"!==typeof e.maxForce?e.maxForce:1E6,q=e.pivotA?e.pivotA.clone():new g,p=e.pivotB?e.pivotB.clone():new g;f.call(this,a,q,c,p,n);(this.axisA=e.axisA?e.axisA.clone():new g(1,0,0)).normalize();(this.axisB=e.axisB?e.axisB.clone():new g(1,0,0)).normalize();q=this.rotationalEquation1=new d(a,c,e);e=this.rotationalEquation2=new d(a,c,e);a=this.motorEquation=new m(a,c,n);
a.enabled=!1;this.equations.push(q,e,a)}e.exports=a;c("./Constraint");var f=c("./PointToPointConstraint"),d=c("../equations/RotationalEquation"),m=c("../equations/RotationalMotorEquation");c("../equations/ContactEquation");var g=c("../math/Vec3");a.prototype=new f;a.constructor=a;a.prototype.enableMotor=function(){this.motorEquation.enabled=!0};a.prototype.disableMotor=function(){this.motorEquation.enabled=!1};a.prototype.setMotorSpeed=function(a){this.motorEquation.targetVelocity=a};a.prototype.setMotorMaxForce=
function(a){this.motorEquation.maxForce=a;this.motorEquation.minForce=-a};var n=new g,p=new g;a.prototype.update=function(){var a=this.bodyA,d=this.bodyB,g=this.motorEquation,c=this.rotationalEquation1,e=this.rotationalEquation2,m=this.axisA,l=this.axisB;f.prototype.update.call(this);a.quaternion.vmult(m,n);d.quaternion.vmult(l,p);n.tangents(c.axisA,e.axisA);c.axisB.copy(p);e.axisB.copy(p);this.motorEquation.enabled&&(a.quaternion.vmult(this.axisA,g.axisA),d.quaternion.vmult(this.axisB,g.axisB))}},
{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(c,e,l){function a(a,c,e){e=e||{};var g="undefined"!==typeof e.maxForce?e.maxForce:1E6,n=new m,p=new m,l=new m;a.position.vadd(c.position,l);l.scale(.5,l);c.pointToLocalFrame(l,p);a.pointToLocalFrame(l,n);f.call(this,a,n,c,p,g);g=this.rotationalEquation1=new d(a,c,e);n=this.rotationalEquation2=new d(a,c,e);
a=this.rotationalEquation3=new d(a,c,e);this.equations.push(g,n,a)}e.exports=a;c("./Constraint");var f=c("./PointToPointConstraint"),d=c("../equations/RotationalEquation");c("../equations/RotationalMotorEquation");c("../equations/ContactEquation");var m=c("../math/Vec3");a.prototype=new f;a.constructor=a;new m;new m;a.prototype.update=function(){var a=this.bodyA,d=this.bodyB,c=this.rotationalEquation1,e=this.rotationalEquation2,q=this.rotationalEquation3;f.prototype.update.call(this);a.vectorToWorldFrame(m.UNIT_X,
c.axisA);d.vectorToWorldFrame(m.UNIT_Y,c.axisB);a.vectorToWorldFrame(m.UNIT_Y,e.axisA);d.vectorToWorldFrame(m.UNIT_Z,e.axisB);a.vectorToWorldFrame(m.UNIT_Z,q.axisA);d.vectorToWorldFrame(m.UNIT_X,q.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(c,e,l){function a(a,c,e,u,q){f.call(this,a,e);q="undefined"!==typeof q?q:1E6;this.pivotA=c?c.clone():
new m;this.pivotB=u?u.clone():new m;c=this.equationX=new d(a,e);u=this.equationY=new d(a,e);a=this.equationZ=new d(a,e);this.equations.push(c,u,a);c.minForce=u.minForce=a.minForce=-q;c.maxForce=u.maxForce=a.maxForce=q;c.ni.set(1,0,0);u.ni.set(0,1,0);a.ni.set(0,0,1)}e.exports=a;var f=c("./Constraint"),d=c("../equations/ContactEquation"),m=c("../math/Vec3");a.prototype=new f;a.prototype.update=function(){var a=this.bodyB,d=this.equationX,c=this.equationY,f=this.equationZ;this.bodyA.quaternion.vmult(this.pivotA,
d.ri);a.quaternion.vmult(this.pivotB,d.rj);c.ri.copy(d.ri);c.rj.copy(d.rj);f.ri.copy(d.ri);f.rj.copy(d.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(c,e,l){function a(a,g,c){c=c||{};var e="undefined"!==typeof c.maxForce?c.maxForce:1E6;d.call(this,a,g,-e,e);this.axisA=c.axisA?c.axisA.clone():new f(1,0,0);this.axisB=c.axisB?c.axisB.clone():new f(0,1,0);this.angle="undefined"!==typeof c.angle?c.angle:0}e.exports=a;var f=c("../math/Vec3");c("../math/Mat3");
var d=c("./Equation");a.prototype=new d;a.prototype.constructor=a;var m=new f,g=new f;a.prototype.computeB=function(a){var d=this.a,c=this.b,f=this.axisA,e=this.axisB,n=this.jacobianElementA,l=this.jacobianElementB;f.cross(e,m);e.cross(f,g);n.rotational.copy(g);l.rotational.copy(m);f=Math.cos(this.angle)-f.dot(e);e=this.computeGW();n=this.computeGiMf();return-f*d-e*c-a*n}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(c,e,l){function a(a,g,c){f.call(this,a,g,0,"undefined"!==
typeof c?c:1E6);this.restitution=0;this.ri=new d;this.rj=new d;this.ni=new d}e.exports=a;var f=c("./Equation"),d=c("../math/Vec3");c("../math/Mat3");a.prototype=new f;a.prototype.constructor=a;var m=new d,g=new d,n=new d;a.prototype.computeB=function(a){var d=this.a,c=this.b,f=this.bi,e=this.bj,q=this.ri,p=this.rj,l=f.velocity,u=f.angularVelocity,t=e.velocity,w=e.angularVelocity,y=this.jacobianElementA,fa=this.jacobianElementB,ja=this.ni;q.cross(ja,m);p.cross(ja,g);ja.negate(y.spatial);m.negate(y.rotational);
fa.spatial.copy(ja);fa.rotational.copy(g);n.copy(e.position);n.vadd(p,n);n.vsub(f.position,n);n.vsub(q,n);f=ja.dot(n);e=this.restitution+1;l=e*t.dot(ja)-e*l.dot(ja)+w.dot(g)-u.dot(m);u=this.computeGiMf();return-f*d-l*c-a*u};var p=new d,u=new d,q=new d,t=new d,y=new d;a.prototype.getImpactVelocityAlongNormal=function(){this.bi.position.vadd(this.ri,q);this.bj.position.vadd(this.rj,t);this.bi.getVelocityAtWorldPoint(q,p);this.bj.getVelocityAtWorldPoint(t,u);p.vsub(u,y);return this.ni.dot(y)}},{"../math/Mat3":27,
"../math/Vec3":30,"./Equation":20}],20:[function(c,e,l){function a(d,g,c,e){this.id=a.id++;this.minForce="undefined"===typeof c?-1E6:c;this.maxForce="undefined"===typeof e?1E6:e;this.bi=d;this.bj=g;this.eps=this.b=this.a=0;this.jacobianElementA=new f;this.jacobianElementB=new f;this.enabled=!0;this.setSpookParams(1E7,4,1/60)}e.exports=a;var f=c("../math/JacobianElement");c=c("../math/Vec3");a.prototype.constructor=a;a.id=0;a.prototype.setSpookParams=function(a,d,g){this.a=4/(g*(1+4*d));this.b=4*d/
(1+4*d);this.eps=4/(g*g*a*(1+4*d))};a.prototype.computeB=function(a,d,g){var c=this.computeGW(),f=this.computeGq(),e=this.computeGiMf();return-f*a-c*d-e*g};a.prototype.computeGq=function(){var a=this.jacobianElementB,d=this.bj.position;return this.jacobianElementA.spatial.dot(this.bi.position)+a.spatial.dot(d)};var d=new c;a.prototype.computeGW=function(){var a=this.jacobianElementB,g=this.bi,c=this.bj,f=c.velocity,c=c.angularVelocity||d;return this.jacobianElementA.multiplyVectors(g.velocity,g.angularVelocity||
d)+a.multiplyVectors(f,c)};a.prototype.computeGWlambda=function(){var a=this.jacobianElementB,g=this.bi,c=this.bj,f=c.vlambda,c=c.wlambda||d;return this.jacobianElementA.multiplyVectors(g.vlambda,g.wlambda||d)+a.multiplyVectors(f,c)};var m=new c,g=new c,n=new c,p=new c;a.prototype.computeGiMf=function(){var a=this.jacobianElementA,d=this.jacobianElementB,c=this.bi,f=this.bj,e=c.force,q=c.torque,l=f.force,u=f.torque,R=c.invMassSolve,I=f.invMassSolve;c.invInertiaWorldSolve?c.invInertiaWorldSolve.vmult(q,
n):n.set(0,0,0);f.invInertiaWorldSolve?f.invInertiaWorldSolve.vmult(u,p):p.set(0,0,0);e.mult(R,m);l.mult(I,g);return a.multiplyVectors(m,n)+d.multiplyVectors(g,p)};var u=new c;a.prototype.computeGiMGt=function(){var a=this.jacobianElementA,d=this.jacobianElementB,g=this.bi,c=this.bj,f=g.invInertiaWorldSolve,e=c.invInertiaWorldSolve,g=g.invMassSolve+c.invMassSolve;f&&(f.vmult(a.rotational,u),g+=u.dot(a.rotational));e&&(e.vmult(d.rotational,u),g+=u.dot(d.rotational));return g};var q=new c;new c;new c;
new c;new c;new c;a.prototype.addToWlambda=function(a){var d=this.jacobianElementA,g=this.jacobianElementB,c=this.bi,f=this.bj;d.spatial.mult(c.invMassSolve*a,q);c.vlambda.vadd(q,c.vlambda);g.spatial.mult(f.invMassSolve*a,q);f.vlambda.vadd(q,f.vlambda);c.invInertiaWorldSolve&&(c.invInertiaWorldSolve.vmult(d.rotational,q),q.mult(a,q),c.wlambda.vadd(q,c.wlambda));f.invInertiaWorldSolve&&(f.invInertiaWorldSolve.vmult(g.rotational,q),q.mult(a,q),f.wlambda.vadd(q,f.wlambda))};a.prototype.computeC=function(){return this.computeGiMGt()+
this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(c,e,l){function a(a,g,c){f.call(this,a,g,-c,c);this.ri=new d;this.rj=new d;this.t=new d}e.exports=a;var f=c("./Equation"),d=c("../math/Vec3");c("../math/Mat3");a.prototype=new f;a.prototype.constructor=a;var m=new d,g=new d;a.prototype.computeB=function(a){var d=this.b,c=this.rj,f=this.t;this.ri.cross(f,m);c.cross(f,g);var c=this.jacobianElementA,e=this.jacobianElementB;f.negate(c.spatial);m.negate(c.rotational);e.spatial.copy(f);
e.rotational.copy(g);f=this.computeGW();c=this.computeGiMf();return-f*d-a*c}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(c,e,l){function a(a,c,g){g=g||{};var e="undefined"!==typeof g.maxForce?g.maxForce:1E6;d.call(this,a,c,-e,e);this.axisA=g.axisA?g.axisA.clone():new f(1,0,0);this.axisB=g.axisB?g.axisB.clone():new f(0,1,0);this.maxAngle=Math.PI/2}e.exports=a;var f=c("../math/Vec3");c("../math/Mat3");var d=c("./Equation");a.prototype=new d;a.prototype.constructor=a;var m=new f,
g=new f;a.prototype.computeB=function(a){var d=this.a,c=this.b,f=this.axisA,e=this.axisB,n=this.jacobianElementA,l=this.jacobianElementB;f.cross(e,m);e.cross(f,g);n.rotational.copy(g);l.rotational.copy(m);f=Math.cos(this.maxAngle)-f.dot(e);e=this.computeGW();n=this.computeGiMf();return-f*d-e*c-a*n}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(c,e,l){function a(a,c,e){e="undefined"!==typeof e?e:1E6;d.call(this,a,c,-e,e);this.axisA=new f;this.axisB=new f;this.targetVelocity=
0}e.exports=a;var f=c("../math/Vec3");c("../math/Mat3");var d=c("./Equation");a.prototype=new d;a.prototype.constructor=a;a.prototype.computeB=function(a){var d=this.b,c=this.axisB,f=this.jacobianElementB;this.jacobianElementA.rotational.copy(this.axisA);c.negate(f.rotational);c=this.computeGW()-this.targetVelocity;f=this.computeGiMf();return-c*d-a*f}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(c,e,l){function a(d,c,g){g=f.defaults(g,{friction:.3,restitution:.3,contactEquationStiffness:1E7,
contactEquationRelaxation:3,frictionEquationStiffness:1E7,frictionEquationRelaxation:3});this.id=a.idCounter++;this.materials=[d,c];this.friction=g.friction;this.restitution=g.restitution;this.contactEquationStiffness=g.contactEquationStiffness;this.contactEquationRelaxation=g.contactEquationRelaxation;this.frictionEquationStiffness=g.frictionEquationStiffness;this.frictionEquationRelaxation=g.frictionEquationRelaxation}var f=c("../utils/Utils");e.exports=a;a.idCounter=0},{"../utils/Utils":53}],25:[function(c,
e,l){function a(c){var d="";c=c||{};"string"===typeof c?(d=c,c={}):"object"===typeof c&&(d="");this.name=d;this.id=a.idCounter++;this.friction="undefined"!==typeof c.friction?c.friction:-1;this.restitution="undefined"!==typeof c.restitution?c.restitution:-1}e.exports=a;a.idCounter=0},{}],26:[function(c,e,l){function a(){this.spatial=new f;this.rotational=new f}e.exports=a;var f=c("./Vec3");a.prototype.multiplyElement=function(a){return a.spatial.dot(this.spatial)+a.rotational.dot(this.rotational)};
a.prototype.multiplyVectors=function(a,c){return a.dot(this.spatial)+c.dot(this.rotational)}},{"./Vec3":30}],27:[function(c,e,l){function a(a){this.elements=a?a:[0,0,0,0,0,0,0,0,0]}e.exports=a;var f=c("./Vec3");a.prototype.identity=function(){var a=this.elements;a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1};a.prototype.setZero=function(){var a=this.elements;a[0]=0;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=0;a[6]=0;a[7]=0;a[8]=0};a.prototype.setTrace=function(a){var d=this.elements;d[0]=a.x;
d[4]=a.y;d[8]=a.z};a.prototype.getTrace=function(a){a=a||new f;var d=this.elements;a.x=d[0];a.y=d[4];a.z=d[8]};a.prototype.vmult=function(a,c){c=c||new f;var d=this.elements,e=a.x,m=a.y,l=a.z;c.x=d[0]*e+d[1]*m+d[2]*l;c.y=d[3]*e+d[4]*m+d[5]*l;c.z=d[6]*e+d[7]*m+d[8]*l;return c};a.prototype.smult=function(a){for(var d=0;d<this.elements.length;d++)this.elements[d]*=a};a.prototype.mmult=function(d,c){for(var g=c||new a,f=0;3>f;f++)for(var e=0;3>e;e++){for(var m=0,q=0;3>q;q++)m+=d.elements[f+3*q]*this.elements[q+
3*e];g.elements[f+3*e]=m}return g};a.prototype.scale=function(d,c){c=c||new a;for(var g=this.elements,f=c.elements,e=0;3!==e;e++)f[3*e+0]=d.x*g[3*e+0],f[3*e+1]=d.y*g[3*e+1],f[3*e+2]=d.z*g[3*e+2];return c};a.prototype.solve=function(a,c){c=c||new f;for(var d=[],e=0;12>e;e++)d.push(0);for(var m,e=0;3>e;e++)for(m=0;3>m;m++)d[e+4*m]=this.elements[e+3*m];d[3]=a.x;d[7]=a.y;d[11]=a.z;var l=3,q=l,t,y;do{e=q-l;if(0===d[e+4*e])for(m=e+1;m<q;m++)if(0!==d[e+4*m]){t=4;do y=4-t,d[y+4*e]+=d[y+4*m];while(--t);break}if(0!==
d[e+4*e])for(m=e+1;m<q;m++){var w=d[e+4*m]/d[e+4*e];t=4;do y=4-t,d[y+4*m]=y<=e?0:d[y+4*m]-d[y+4*e]*w;while(--t)}}while(--l);c.z=d[11]/d[10];c.y=(d[7]-d[6]*c.z)/d[5];c.x=(d[3]-d[2]*c.z-d[1]*c.y)/d[0];if(isNaN(c.x)||isNaN(c.y)||isNaN(c.z)||Infinity===c.x||Infinity===c.y||Infinity===c.z)throw"Could not solve equation! Got x=["+c.toString()+"], b=["+a.toString()+"], A=["+this.toString()+"]";return c};a.prototype.e=function(a,c,g){if(void 0===g)return this.elements[c+3*a];this.elements[c+3*a]=g};a.prototype.copy=
function(a){for(var d=0;d<a.elements.length;d++)this.elements[d]=a.elements[d];return this};a.prototype.toString=function(){for(var a="",c=0;9>c;c++)a+=this.elements[c]+",";return a};a.prototype.reverse=function(d){d=d||new a;for(var c=[],g=0;18>g;g++)c.push(0);for(var f,g=0;3>g;g++)for(f=0;3>f;f++)c[g+6*f]=this.elements[g+3*f];c[3]=1;c[9]=0;c[15]=0;c[4]=0;c[10]=1;c[16]=0;c[5]=0;c[11]=0;c[17]=1;var e=3,l=e,q,t;do{g=l-e;if(0===c[g+6*g])for(f=g+1;f<l;f++)if(0!==c[g+6*f]){q=6;do t=6-q,c[t+6*g]+=c[t+
6*f];while(--q);break}if(0!==c[g+6*g])for(f=g+1;f<l;f++){var y=c[g+6*f]/c[g+6*g];q=6;do t=6-q,c[t+6*f]=t<=g?0:c[t+6*f]-c[t+6*g]*y;while(--q)}}while(--e);g=2;do{f=g-1;do{y=c[g+6*f]/c[g+6*g];q=6;do t=6-q,c[t+6*f]-=c[t+6*g]*y;while(--q)}while(f--)}while(--g);g=2;do{y=1/c[g+6*g];q=6;do t=6-q,c[t+6*g]*=y;while(--q)}while(g--);g=2;do{f=2;do{t=c[3+f+6*g];if(isNaN(t)||Infinity===t)throw"Could not reverse! A=["+this.toString()+"]";d.e(g,f,t)}while(f--)}while(g--);return d};a.prototype.setRotationFromQuaternion=
function(a){var d=a.x,c=a.y,f=a.z,e=a.w,l=d+d,q=c+c,t=f+f;a=d*l;var y=d*q,d=d*t,w=c*q,c=c*t,f=f*t,l=e*l,q=e*q,e=e*t,t=this.elements;t[0]=1-(w+f);t[1]=y-e;t[2]=d+q;t[3]=y+e;t[4]=1-(a+f);t[5]=c-l;t[6]=d-q;t[7]=c+l;t[8]=1-(a+w);return this};a.prototype.transpose=function(d){d=d||new a;for(var c=d.elements,g=this.elements,f=0;3!==f;f++)for(var e=0;3!==e;e++)c[3*f+e]=g[3*e+f];return d}},{"./Vec3":30}],28:[function(c,e,l){function a(a,d,c,f){this.x=void 0!==a?a:0;this.y=void 0!==d?d:0;this.z=void 0!==c?
c:0;this.w=void 0!==f?f:1}e.exports=a;var f=c("./Vec3");a.prototype.set=function(a,d,c,f){this.x=a;this.y=d;this.z=c;this.w=f};a.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w};a.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]};a.prototype.setFromAxisAngle=function(a,d){var c=Math.sin(.5*d);this.x=a.x*c;this.y=a.y*c;this.z=a.z*c;this.w=Math.cos(.5*d)};a.prototype.toAxisAngle=function(a){a=a||new f;this.normalize();var d=2*Math.acos(this.w),c=Math.sqrt(1-
this.w*this.w);.001>c?(a.x=this.x,a.y=this.y,a.z=this.z):(a.x=this.x/c,a.y=this.y/c,a.z=this.z/c);return[a,d]};var d=new f,m=new f;a.prototype.setFromVectors=function(a,c){if(a.isAntiparallelTo(c))a.tangents(d,m),this.setFromAxisAngle(d,Math.PI);else{var f=a.cross(c);this.x=f.x;this.y=f.y;this.z=f.z;this.w=Math.sqrt(Math.pow(a.norm(),2)*Math.pow(c.norm(),2))+a.dot(c);this.normalize()}};var g=new f,n=new f,p=new f;a.prototype.mult=function(d,c){c=c||new a;var f=this.w;g.set(this.x,this.y,this.z);n.set(d.x,
d.y,d.z);c.w=f*d.w-g.dot(n);g.cross(n,p);c.x=f*n.x+d.w*g.x+p.x;c.y=f*n.y+d.w*g.y+p.y;c.z=f*n.z+d.w*g.z+p.z;return c};a.prototype.inverse=function(d){var c=this.x,f=this.y,g=this.z,e=this.w;d=d||new a;this.conjugate(d);c=1/(c*c+f*f+g*g+e*e);d.x*=c;d.y*=c;d.z*=c;d.w*=c;return d};a.prototype.conjugate=function(d){d=d||new a;d.x=-this.x;d.y=-this.y;d.z=-this.z;d.w=this.w;return d};a.prototype.normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===a?this.w=this.z=
this.y=this.x=0:(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a)};a.prototype.normalizeFast=function(){var a=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===a?this.w=this.z=this.y=this.x=0:(this.x*=a,this.y*=a,this.z*=a,this.w*=a)};a.prototype.vmult=function(a,d){d=d||new f;var c=a.x,g=a.y,e=a.z,n=this.x,l=this.y,q=this.z,m=this.w,p=m*c+l*e-q*g,u=m*g+q*c-n*e,I=m*e+n*g-l*c,c=-n*c-l*g-q*e;d.x=p*m+c*-n+u*-q-I*-l;d.y=u*m+c*-l+I*-n-p*-q;d.z=I*m+c*-q+p*-l-u*-n;return d};a.prototype.copy=
function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this};a.prototype.toEuler=function(a,d){d=d||"YZX";var c,f,g,e=this.x,n=this.y,l=this.z,q=this.w;switch(d){case "YZX":var m=e*n+l*q;.499<m&&(c=2*Math.atan2(e,q),f=Math.PI/2,g=0);-.499>m&&(c=-2*Math.atan2(e,q),f=-Math.PI/2,g=0);isNaN(c)&&(g=l*l,c=Math.atan2(2*n*q-2*e*l,1-2*n*n-2*g),f=Math.asin(2*m),g=Math.atan2(2*e*q-2*n*l,1-2*e*e-2*g));break;default:throw Error("Euler order "+d+" not supported yet.");}a.y=c;a.z=f;a.x=g};a.prototype.setFromEuler=
function(a,d,c,f){f=f||"XYZ";var g=Math.cos(a/2),e=Math.cos(d/2),n=Math.cos(c/2);a=Math.sin(a/2);d=Math.sin(d/2);c=Math.sin(c/2);"XYZ"===f?(this.x=a*e*n+g*d*c,this.y=g*d*n-a*e*c,this.z=g*e*c+a*d*n,this.w=g*e*n-a*d*c):"YXZ"===f?(this.x=a*e*n+g*d*c,this.y=g*d*n-a*e*c,this.z=g*e*c-a*d*n,this.w=g*e*n+a*d*c):"ZXY"===f?(this.x=a*e*n-g*d*c,this.y=g*d*n+a*e*c,this.z=g*e*c+a*d*n,this.w=g*e*n-a*d*c):"ZYX"===f?(this.x=a*e*n-g*d*c,this.y=g*d*n+a*e*c,this.z=g*e*c-a*d*n,this.w=g*e*n+a*d*c):"YZX"===f?(this.x=a*
e*n+g*d*c,this.y=g*d*n+a*e*c,this.z=g*e*c-a*d*n,this.w=g*e*n-a*d*c):"XZY"===f&&(this.x=a*e*n-g*d*c,this.y=g*d*n-a*e*c,this.z=g*e*c+a*d*n,this.w=g*e*n+a*d*c);return this};a.prototype.clone=function(){return new a(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(c,e,l){function a(a){a=a||{};this.position=new f;a.position&&this.position.copy(a.position);this.quaternion=new d;a.quaternion&&this.quaternion.copy(a.quaternion)}var f=c("./Vec3"),d=c("./Quaternion");e.exports=a;var m=new d;a.pointToLocalFrame=
function(a,d,c,e){e=e||new f;c.vsub(a,e);d.conjugate(m);m.vmult(e,e);return e};a.prototype.pointToLocal=function(d,c){return a.pointToLocalFrame(this.position,this.quaternion,d,c)};a.pointToWorldFrame=function(a,d,c,e){e=e||new f;d.vmult(c,e);e.vadd(a,e);return e};a.prototype.pointToWorld=function(d,c){return a.pointToWorldFrame(this.position,this.quaternion,d,c)};a.prototype.vectorToWorldFrame=function(a,d){d=d||new f;this.quaternion.vmult(a,d);return d};a.vectorToWorldFrame=function(a,d,c){a.vmult(d,
c);return c};a.vectorToLocalFrame=function(a,d,c,e){e=e||new f;d.w*=-1;d.vmult(c,e);d.w*=-1;return e}},{"./Quaternion":28,"./Vec3":30}],30:[function(c,e,l){function a(a,d,c){this.x=a||0;this.y=d||0;this.z=c||0}e.exports=a;var f=c("./Mat3");a.ZERO=new a(0,0,0);a.UNIT_X=new a(1,0,0);a.UNIT_Y=new a(0,1,0);a.UNIT_Z=new a(0,0,1);a.prototype.cross=function(d,c){var f=d.x,g=d.y,e=d.z,n=this.x,l=this.y,m=this.z;c=c||new a;c.x=l*e-m*g;c.y=m*f-n*e;c.z=n*g-l*f;return c};a.prototype.set=function(a,d,c){this.x=
a;this.y=d;this.z=c;return this};a.prototype.setZero=function(){this.x=this.y=this.z=0};a.prototype.vadd=function(d,c){if(c)c.x=d.x+this.x,c.y=d.y+this.y,c.z=d.z+this.z;else return new a(this.x+d.x,this.y+d.y,this.z+d.z)};a.prototype.vsub=function(d,c){if(c)c.x=this.x-d.x,c.y=this.y-d.y,c.z=this.z-d.z;else return new a(this.x-d.x,this.y-d.y,this.z-d.z)};a.prototype.crossmat=function(){return new f([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])};a.prototype.normalize=function(){var a=this.x,
d=this.y,c=this.z,a=Math.sqrt(a*a+d*d+c*c);0<a?(d=1/a,this.x*=d,this.y*=d,this.z*=d):this.z=this.y=this.x=0;return a};a.prototype.unit=function(d){d=d||new a;var c=this.x,f=this.y,g=this.z,e=Math.sqrt(c*c+f*f+g*g);0<e?(e=1/e,d.x=c*e,d.y=f*e,d.z=g*e):(d.x=1,d.y=0,d.z=0);return d};a.prototype.norm=function(){var a=this.x,d=this.y,c=this.z;return Math.sqrt(a*a+d*d+c*c)};a.prototype.length=a.prototype.norm;a.prototype.norm2=function(){return this.dot(this)};a.prototype.lengthSquared=a.prototype.norm2;
a.prototype.distanceTo=function(a){var d=this.x,c=this.y,f=this.z,g=a.x,e=a.y;a=a.z;return Math.sqrt((g-d)*(g-d)+(e-c)*(e-c)+(a-f)*(a-f))};a.prototype.distanceSquared=function(a){var d=this.x,c=this.y,f=this.z,g=a.x,e=a.y;a=a.z;return(g-d)*(g-d)+(e-c)*(e-c)+(a-f)*(a-f)};a.prototype.mult=function(d,c){c=c||new a;var f=this.y,g=this.z;c.x=d*this.x;c.y=d*f;c.z=d*g;return c};a.prototype.scale=a.prototype.mult;a.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};a.prototype.isZero=function(){return 0===
this.x&&0===this.y&&0===this.z};a.prototype.negate=function(d){d=d||new a;d.x=-this.x;d.y=-this.y;d.z=-this.z;return d};var d=new a,m=new a;a.prototype.tangents=function(a,c){var f=this.norm();0<f?(f=1/f,d.set(this.x*f,this.y*f,this.z*f),.9>Math.abs(d.x)?m.set(1,0,0):m.set(0,1,0),d.cross(m,a),d.cross(a,c)):(a.set(1,0,0),c.set(0,1,0))};a.prototype.toString=function(){return this.x+","+this.y+","+this.z};a.prototype.toArray=function(){return[this.x,this.y,this.z]};a.prototype.copy=function(a){this.x=
a.x;this.y=a.y;this.z=a.z;return this};a.prototype.lerp=function(a,d,c){var f=this.x,g=this.y,e=this.z;c.x=f+(a.x-f)*d;c.y=g+(a.y-g)*d;c.z=e+(a.z-e)*d};a.prototype.almostEquals=function(a,d){void 0===d&&(d=1E-6);return Math.abs(this.x-a.x)>d||Math.abs(this.y-a.y)>d||Math.abs(this.z-a.z)>d?!1:!0};a.prototype.almostZero=function(a){void 0===a&&(a=1E-6);return Math.abs(this.x)>a||Math.abs(this.y)>a||Math.abs(this.z)>a?!1:!0};var g=new a;a.prototype.isAntiparallelTo=function(a,d){this.negate(g);return g.almostEquals(a,
d)};a.prototype.clone=function(){return new a(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(c,e,l){function a(c){c=c||{};f.apply(this);this.id=a.idCounter++;this.postStep=this.preStep=this.world=null;this.vlambda=new d;this.collisionFilterGroup="number"===typeof c.collisionFilterGroup?c.collisionFilterGroup:1;this.collisionFilterMask="number"===typeof c.collisionFilterMask?c.collisionFilterMask:1;this.collisionResponse=!0;this.position=new d;c.position&&this.position.copy(c.position);this.previousPosition=
new d;this.initPosition=new d;this.velocity=new d;c.velocity&&this.velocity.copy(c.velocity);this.initVelocity=new d;this.force=new d;var e="number"===typeof c.mass?c.mass:0;this.mass=e;this.invMass=0<e?1/e:0;this.material=c.material||null;this.linearDamping="number"===typeof c.linearDamping?c.linearDamping:.01;this.type=0>=e?a.STATIC:a.DYNAMIC;typeof c.type===typeof a.STATIC&&(this.type=c.type);this.allowSleep="undefined"!==typeof c.allowSleep?c.allowSleep:!0;this.sleepState=0;this.sleepSpeedLimit=
"undefined"!==typeof c.sleepSpeedLimit?c.sleepSpeedLimit:.1;this.sleepTimeLimit="undefined"!==typeof c.sleepTimeLimit?c.sleepTimeLimit:1;this.timeLastSleepy=0;this._wakeUpAfterNarrowphase=!1;this.torque=new d;this.quaternion=new g;c.quaternion&&this.quaternion.copy(c.quaternion);this.initQuaternion=new g;this.angularVelocity=new d;c.angularVelocity&&this.angularVelocity.copy(c.angularVelocity);this.initAngularVelocity=new d;this.interpolatedPosition=new d;this.interpolatedQuaternion=new g;this.shapes=
[];this.shapeOffsets=[];this.shapeOrientations=[];this.inertia=new d;this.invInertia=new d;this.invInertiaWorld=new m;this.invMassSolve=0;this.invInertiaSolve=new d;this.invInertiaWorldSolve=new m;this.fixedRotation="undefined"!==typeof c.fixedRotation?c.fixedRotation:!1;this.angularDamping="undefined"!==typeof c.angularDamping?c.angularDamping:.01;this.userData="undefined"!==typeof c.userData?c.userData:null;this.aabb=new n;this.aabbNeedsUpdate=!0;this.wlambda=new d;c.shape&&this.addShape(c.shape);
this.updateMassProperties()}e.exports=a;var f=c("../utils/EventTarget");c("../shapes/Shape");var d=c("../math/Vec3"),m=c("../math/Mat3"),g=c("../math/Quaternion");c("../material/Material");var n=c("../collision/AABB"),p=c("../shapes/Box");a.prototype=new f;a.prototype.constructor=a;a.DYNAMIC=1;a.STATIC=2;a.KINEMATIC=4;a.AWAKE=0;a.SLEEPY=1;a.SLEEPING=2;a.idCounter=0;a.prototype.wakeUp=function(){var d=this.sleepState;this.sleepState=0;d===a.SLEEPING&&this.dispatchEvent({type:"wakeup"})};a.prototype.sleep=
function(){this.sleepState=a.SLEEPING;this.velocity.set(0,0,0);this.angularVelocity.set(0,0,0)};a.sleepyEvent={type:"sleepy"};a.sleepEvent={type:"sleep"};a.prototype.sleepTick=function(d){if(this.allowSleep){var c=this.sleepState,f=this.velocity.norm2()+this.angularVelocity.norm2(),g=Math.pow(this.sleepSpeedLimit,2);c===a.AWAKE&&f<g?(this.sleepState=a.SLEEPY,this.timeLastSleepy=d,this.dispatchEvent(a.sleepyEvent)):c===a.SLEEPY&&f>g?this.wakeUp():c===a.SLEEPY&&d-this.timeLastSleepy>this.sleepTimeLimit&&
(this.sleep(),this.dispatchEvent(a.sleepEvent))}};a.prototype.updateSolveMassProperties=function(){this.sleepState===a.SLEEPING||this.type===a.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))};a.prototype.pointToLocalFrame=function(a,c){c=c||new d;a.vsub(this.position,c);this.quaternion.conjugate().vmult(c,c);return c};a.prototype.vectorToLocalFrame=
function(a,c){c=c||new d;this.quaternion.conjugate().vmult(a,c);return c};a.prototype.pointToWorldFrame=function(a,c){c=c||new d;this.quaternion.vmult(a,c);c.vadd(this.position,c);return c};a.prototype.vectorToWorldFrame=function(a,c){c=c||new d;this.quaternion.vmult(a,c);return c};var u=new d,q=new g;a.prototype.addShape=function(a,c,f){var e=new d,l=new g;c&&e.copy(c);f&&l.copy(f);this.shapes.push(a);this.shapeOffsets.push(e);this.shapeOrientations.push(l);this.updateMassProperties();this.updateBoundingRadius();
this.aabbNeedsUpdate=!0;return this};a.prototype.updateBoundingRadius=function(){for(var a=this.shapes,d=this.shapeOffsets,c=a.length,f=0,g=0;g!==c;g++){var e=a[g];e.updateBoundingSphereRadius();var l=d[g].norm(),e=e.boundingSphereRadius;l+e>f&&(f=l+e)}this.boundingRadius=f};var t=new n;a.prototype.computeAABB=function(){for(var a=this.shapes,d=this.shapeOffsets,c=this.shapeOrientations,f=a.length,g=this.quaternion,e=this.aabb,l=0;l!==f;l++){var n=a[l];c[l].mult(g,q);q.vmult(d[l],u);u.vadd(this.position,
u);n.calculateWorldAABB(u,q,t.lowerBound,t.upperBound);0===l?e.copy(t):e.extend(t)}this.aabbNeedsUpdate=!1};var y=new m,w=new m;new m;a.prototype.updateInertiaWorld=function(a){var d=this.invInertia;if(d.x!==d.y||d.y!==d.z||a)y.setRotationFromQuaternion(this.quaternion),y.transpose(w),y.scale(d,y),y.mmult(w,this.invInertiaWorld)};var C=new d,x=new d;a.prototype.applyForce=function(d,c){this.type===a.DYNAMIC&&(c.vsub(this.position,C),C.cross(d,x),this.force.vadd(d,this.force),this.torque.vadd(x,this.torque))};
var B=new d,G=new d;a.prototype.applyLocalForce=function(d,c){this.type===a.DYNAMIC&&(this.vectorToWorldFrame(d,B),this.pointToWorldFrame(c,G),this.applyForce(B,G))};var E=new d,R=new d,I=new d;a.prototype.applyImpulse=function(d,c){this.type===a.DYNAMIC&&(c.vsub(this.position,E),R.copy(d),R.mult(this.invMass,R),this.velocity.vadd(R,this.velocity),E.cross(d,I),this.invInertiaWorld.vmult(I,I),this.angularVelocity.vadd(I,this.angularVelocity))};var K=new d,N=new d;a.prototype.applyLocalImpulse=function(d,
c){this.type===a.DYNAMIC&&(this.vectorToWorldFrame(d,K),this.pointToWorldFrame(c,N),this.applyImpulse(K,N))};var D=new d;a.prototype.updateMassProperties=function(){this.invMass=0<this.mass?1/this.mass:0;var a=this.inertia,d=this.fixedRotation;this.computeAABB();D.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2);p.calculateInertia(D,this.mass,a);this.invInertia.set(0<a.x&&!d?1/a.x:0,0<a.y&&!d?
1/a.y:0,0<a.z&&!d?1/a.z:0);this.updateInertiaWorld(!0)};a.prototype.getVelocityAtWorldPoint=function(a,c){var f=new d;a.vsub(this.position,f);this.angularVelocity.cross(f,c);this.velocity.vadd(c,c);return c}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(c,e,l){function a(a){this.chassisBody=a.chassisBody;this.wheelInfos=[];this.sliding=!1;this.world=null;
this.indexRightAxis="undefined"!==typeof a.indexRightAxis?a.indexRightAxis:1;this.indexForwardAxis="undefined"!==typeof a.indexForwardAxis?a.indexForwardAxis:0;this.indexUpAxis="undefined"!==typeof a.indexUpAxis?a.indexUpAxis:2}function f(a,d,c){var f=R,e=I,g=K,l=N;d.vsub(a.position,f);f.cross(c,e);a.invInertiaWorld.vmult(e,l);l.cross(f,g);return a.invMass+c.dot(g)}c("./Body");var d=c("../math/Vec3"),m=c("../math/Quaternion");c("../collision/RaycastResult");l=c("../collision/Ray");var g=c("../objects/WheelInfo");
e.exports=a;new d;new d;new d;var n=new d,p=new d,u=new d;new l;a.prototype.addWheel=function(a){a=a||{};a=new g(a);var d=this.wheelInfos.length;this.wheelInfos.push(a);return d};a.prototype.setSteeringValue=function(a,d){this.wheelInfos[d].steering=a};new d;a.prototype.applyEngineForce=function(a,d){this.wheelInfos[d].engineForce=a};a.prototype.setBrake=function(a,d){this.wheelInfos[d].brake=a};a.prototype.addToWorld=function(a){a.add(this.chassisBody);var d=this;this.preStepCallback=function(){d.updateVehicle(a.dt)};
a.addEventListener("preStep",this.preStepCallback);this.world=a};a.prototype.getVehicleAxisWorld=function(a,d){d.set(0===a?1:0,1===a?1:0,2===a?1:0);this.chassisBody.vectorToWorldFrame(d,d)};a.prototype.updateVehicle=function(a){for(var c=this.wheelInfos,f=c.length,e=this.chassisBody,g=0;g<f;g++)this.updateWheelTransform(g);this.currentVehicleSpeedKmHour=3.6*e.velocity.norm();g=new d;this.getVehicleAxisWorld(this.indexForwardAxis,g);0>g.dot(e.velocity)&&(this.currentVehicleSpeedKmHour*=-1);for(g=0;g<
f;g++)this.castRay(c[g]);this.updateSuspension(a);for(var l=new d,n=new d,g=0;g<f;g++){var m=c[g],q=m.suspensionForce;q>m.maxSuspensionForce&&(q=m.maxSuspensionForce);m.raycastResult.hitNormalWorld.scale(q*a,l);m.raycastResult.hitPointWorld.vsub(e.position,n);e.applyImpulse(l,m.raycastResult.hitPointWorld)}this.updateFriction(a);l=new d;n=new d;q=new d;for(g=0;g<f;g++){m=c[g];e.getVelocityAtWorldPoint(m.chassisConnectionPointWorld,q);var p=1;switch(this.indexUpAxis){case 1:p=-1}if(m.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,
n);var t=n.dot(m.raycastResult.hitNormalWorld);m.raycastResult.hitNormalWorld.scale(t,l);n.vsub(l,n);t=n.dot(q);m.deltaRotation=p*t*a/m.radius}!m.sliding&&m.isInContact||0===m.engineForce||!m.useCustomSlidingRotationalSpeed||(m.deltaRotation=(0<m.engineForce?1:-1)*m.customSlidingRotationalSpeed*a);Math.abs(m.brake)>Math.abs(m.engineForce)&&(m.deltaRotation=0);m.rotation+=m.deltaRotation;m.deltaRotation*=.99}};a.prototype.updateSuspension=function(a){a=this.chassisBody.mass;for(var d=this.wheelInfos,
c=d.length,f=0;f<c;f++){var g=d[f];if(g.isInContact){var e;e=g.suspensionStiffness*(g.suspensionRestLength-g.suspensionLength)*g.clippedInvContactDotSuspension;var l=g.suspensionRelativeVelocity;e-=(0>l?g.dampingCompression:g.dampingRelaxation)*l;g.suspensionForce=e*a;0>g.suspensionForce&&(g.suspensionForce=0)}else g.suspensionForce=0}};a.prototype.removeFromWorld=function(a){a.remove(this.chassisBody);a.removeEventListener("preStep",this.preStepCallback);this.world=null};var q=new d,t=new d;a.prototype.castRay=
function(a){this.updateWheelTransformWorld(a);var c=this.chassisBody,f=-1;a.directionWorld.scale(a.suspensionRestLength+a.radius,q);var g=a.chassisConnectionPointWorld;g.vadd(q,t);var e=a.raycastResult;e.reset();var l=c.collisionResponse;c.collisionResponse=!1;this.world.rayTest(g,t,e);c.collisionResponse=l;g=e.body;a.raycastResult.groundObject=0;g?(f=e.distance,a.raycastResult.hitNormalWorld=e.hitNormalWorld,a.isInContact=!0,a.suspensionLength=e.distance-a.radius,e=a.suspensionRestLength-a.maxSuspensionTravel,
g=a.suspensionRestLength+a.maxSuspensionTravel,a.suspensionLength<e&&(a.suspensionLength=e),a.suspensionLength>g&&(a.suspensionLength=g,a.raycastResult.reset()),e=a.raycastResult.hitNormalWorld.dot(a.directionWorld),g=new d,c.getVelocityAtWorldPoint(a.raycastResult.hitPointWorld,g),c=a.raycastResult.hitNormalWorld.dot(g),-.1<=e?(a.suspensionRelativeVelocity=0,a.clippedInvContactDotSuspension=10):(e=-1/e,a.suspensionRelativeVelocity=c*e,a.clippedInvContactDotSuspension=e)):(a.suspensionLength=a.suspensionRestLength+
0*a.maxSuspensionTravel,a.suspensionRelativeVelocity=0,a.directionWorld.scale(-1,a.raycastResult.hitNormalWorld),a.clippedInvContactDotSuspension=1);return f};a.prototype.updateWheelTransformWorld=function(a){a.isInContact=!1;var d=this.chassisBody;d.pointToWorldFrame(a.chassisConnectionPointLocal,a.chassisConnectionPointWorld);d.vectorToWorldFrame(a.directionLocal,a.directionWorld);d.vectorToWorldFrame(a.axleLocal,a.axleWorld)};a.prototype.updateWheelTransform=function(a){a=this.wheelInfos[a];this.updateWheelTransformWorld(a);
a.directionLocal.scale(-1,n);p.copy(a.axleLocal);n.cross(p,u);u.normalize();p.normalize();var d=a.steering,c=new m;c.setFromAxisAngle(n,d);d=new m;d.setFromAxisAngle(p,a.rotation);var g=a.worldTransform.quaternion;this.chassisBody.quaternion.mult(c,g);g.mult(d,g);g.normalize();c=a.worldTransform.position;c.copy(a.directionWorld);c.scale(a.suspensionLength,c);c.vadd(a.chassisConnectionPointWorld,c)};var y=[new d(1,0,0),new d(0,1,0),new d(0,0,1)];a.prototype.getWheelTransformWorld=function(a){return this.wheelInfos[a].worldTransform};
var w=new d,C=[],x=[];a.prototype.updateFriction=function(a){for(var c=this.wheelInfos,g=c.length,e=this.chassisBody,l=0,m=0;m<g;m++){var n=c[m],q=n.raycastResult.body;q&&l++;n.sideImpulse=0;n.forwardImpulse=0;x[m]||(x[m]=new d);C[m]||(C[m]=new d)}for(m=0;m<g;m++)if(n=c[m],q=n.raycastResult.body){var p=C[m];this.getWheelTransformWorld(m).vectorToWorldFrame(y[this.indexRightAxis],p);var l=n.raycastResult.hitNormalWorld,t=p.dot(l);l.scale(t,w);p.vsub(w,p);p.normalize();l.cross(p,x[m]);x[m].normalize();
l=n;var t=e,u=n.raycastResult.hitPointWorld,K=n.raycastResult.hitPointWorld;if(1.1<p.norm2())q=0;else{var N=D,oa=Z,O=fa;t.getVelocityAtWorldPoint(u,N);q.getVelocityAtWorldPoint(K,oa);N.vsub(oa,O);q=-.2*p.dot(O)*(1/(t.invMass+q.invMass))}l.sideImpulse=q;n.sideImpulse*=1}this.sliding=!1;for(m=0;m<g;m++){n=c[m];q=n.raycastResult.body;t=0;n.slipInfo=1;if(q){var l=n.brake?n.brake:0,N=e,u=q,K=n.raycastResult.hitPointWorld,p=x[m],t=l,oa=K,O=B,I=G,Wa=E;N.getVelocityAtWorldPoint(oa,O);u.getVelocityAtWorldPoint(oa,
I);O.vsub(I,Wa);oa=p.dot(Wa);N=f(N,K,p);u=f(u,K,p);u=1/(N+u)*-oa;t<u&&(u=t);u<-t&&(u=-t);t=u;t+=n.engineForce*a;l/=t;n.slipInfo*=l}n.forwardImpulse=0;n.skidInfo=1;q&&(n.skidInfo=1,q=n.suspensionForce*a*n.frictionSlip,l=q*q,n.forwardImpulse=t,t=.5*n.forwardImpulse,u=1*n.sideImpulse,t=t*t+u*u,n.sliding=!1,t>l&&(this.sliding=!0,n.sliding=!0,l=q/Math.sqrt(t),n.skidInfo*=l))}if(this.sliding)for(m=0;m<g;m++)n=c[m],0!==n.sideImpulse&&1>n.skidInfo&&(n.forwardImpulse*=n.skidInfo,n.sideImpulse*=n.skidInfo);
for(m=0;m<g;m++)n=c[m],a=new d,a.copy(n.raycastResult.hitPointWorld),0!==n.forwardImpulse&&(q=new d,x[m].scale(n.forwardImpulse,q),e.applyImpulse(q,a)),0!==n.sideImpulse&&(q=n.raycastResult.body,l=new d,l.copy(n.raycastResult.hitPointWorld),t=new d,C[m].scale(n.sideImpulse,t),e.pointToLocalFrame(a,a),a["xyz"[this.indexUpAxis]]*=n.rollInfluence,e.pointToWorldFrame(a,a),e.applyImpulse(t,a),t.scale(-1,t),q.applyImpulse(t,l))};var B=new d,G=new d,E=new d,R=new d,I=new d,K=new d,N=new d,D=new d,Z=new d,
fa=new d},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(c,e,l){function a(a){this.wheelBodies=[];this.coordinateSystem="undefined"===typeof a.coordinateSystem?new g(1,2,3):a.coordinateSystem.clone();this.chassisBody=a.chassisBody;this.chassisBody||(a=new m(new g(5,2,.5)),this.chassisBody=new f(1,a));this.constraints=[];this.wheelAxes=[];this.wheelForces=[]}var f=c("./Body"),d=c("../shapes/Sphere"),
m=c("../shapes/Box"),g=c("../math/Vec3"),n=c("../constraints/HingeConstraint");e.exports=a;a.prototype.addWheel=function(a){a=a||{};var c=a.body;c||(c=new f(1,new d(1.2)));this.wheelBodies.push(c);this.wheelForces.push(0);new g;var e="undefined"!==typeof a.position?a.position.clone():new g,l=new g;this.chassisBody.pointToWorldFrame(e,l);c.position.set(l.x,l.y,l.z);a="undefined"!==typeof a.axis?a.axis.clone():new g(0,1,0);this.wheelAxes.push(a);c=new n(this.chassisBody,c,{pivotA:e,axisA:a,pivotB:g.ZERO,
axisB:a,collideConnected:!1});this.constraints.push(c);return this.wheelBodies.length-1};a.prototype.setSteeringValue=function(a,d){var c=this.wheelAxes[d],g=Math.cos(a),f=Math.sin(a),e=c.x,c=c.y;this.constraints[d].axisA.set(g*e-f*c,f*e+g*c,0)};a.prototype.setMotorSpeed=function(a,d){var c=this.constraints[d];c.enableMotor();c.motorTargetVelocity=a};a.prototype.disableMotor=function(a){this.constraints[a].disableMotor()};var p=new g;a.prototype.setWheelForce=function(a,d){this.wheelForces[d]=a};
a.prototype.applyWheelForce=function(a,d){var c=this.wheelBodies[d],g=c.torque;this.wheelAxes[d].scale(a,p);c.vectorToWorldFrame(p,p);g.vadd(p,g)};a.prototype.addToWorld=function(a){for(var d=this.constraints,c=this.wheelBodies.concat([this.chassisBody]),g=0;g<c.length;g++)a.add(c[g]);for(g=0;g<d.length;g++)a.addConstraint(d[g]);a.addEventListener("preStep",this._update.bind(this))};a.prototype._update=function(){for(var a=this.wheelForces,d=0;d<a.length;d++)this.applyWheelForce(a[d],d)};a.prototype.removeFromWorld=
function(a){for(var d=this.constraints,c=this.wheelBodies.concat([this.chassisBody]),g=0;g<c.length;g++)a.remove(c[g]);for(g=0;g<d.length;g++)a.removeConstraint(d[g])};var u=new g;a.prototype.getWheelSpeed=function(a){var d=this.wheelBodies[a].angularVelocity;this.chassisBody.vectorToWorldFrame(this.wheelAxes[a],u);return d.dot(u)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(c,e,l){function a(){this.particles=[];this.speedOfSound=
this.smoothingRadius=this.density=1;this.viscosity=.01;this.eps=1E-6;this.pressures=[];this.densities=[];this.neighbors=[]}e.exports=a;c("../shapes/Shape");e=c("../math/Vec3");c("../math/Quaternion");c("../shapes/Particle");c("../objects/Body");c("../material/Material");a.prototype.add=function(a){this.particles.push(a);this.neighbors.length<this.particles.length&&this.neighbors.push([])};a.prototype.remove=function(a){a=this.particles.indexOf(a);-1!==a&&(this.particles.splice(a,1),this.neighbors.length>
this.particles.length&&this.neighbors.pop())};var f=new e;a.prototype.getNeighbors=function(a,d){for(var c=this.particles.length,g=a.id,e=this.smoothingRadius*this.smoothingRadius,l=0;l!==c;l++){var n=this.particles[l];n.position.vsub(a.position,f);g!==n.id&&f.norm2()<e&&d.push(n)}};var d=new e,m=new e,g=new e,n=new e,p=new e,u=new e;a.prototype.update=function(){for(var a=this.particles.length,c=this.speedOfSound,f=this.eps,e=0;e!==a;e++){var l=this.particles[e],x=this.neighbors[e];x.length=0;this.getNeighbors(l,
x);x.push(this.particles[e]);for(var B=x.length,G=0,E=0;E!==B;E++){l.position.vsub(x[E].position,d);var R=d.norm(),R=this.w(R),G=G+x[E].mass*R}this.densities[e]=G;this.pressures[e]=c*c*(this.densities[e]-this.density)}for(e=0;e!==a;e++){c=this.particles[e];m.set(0,0,0);g.set(0,0,0);x=this.neighbors[e];B=x.length;for(E=0;E!==B;E++)G=x[E],c.position.vsub(G.position,p),R=p.norm(),l=-G.mass*(this.pressures[e]/(this.densities[e]*this.densities[e]+f)+this.pressures[E]/(this.densities[E]*this.densities[E]+
f)),this.gradw(p,n),n.mult(l,n),m.vadd(n,m),G.velocity.vsub(c.velocity,u),u.mult(1/(1E-4+this.densities[e]*this.densities[E])*this.viscosity*G.mass,u),l=this.nablaw(R),u.mult(l,u),g.vadd(u,g);g.mult(c.mass,g);m.mult(c.mass,m);c.force.vadd(g,c.force);c.force.vadd(m,c.force)}};a.prototype.w=function(a){var d=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(d,9))*Math.pow(d*d-a*a,3)};a.prototype.gradw=function(a,d){var c=a.norm(),g=this.smoothingRadius;a.mult(945/(32*Math.PI*Math.pow(g,9))*Math.pow(g*
g-c*c,2),d)};a.prototype.nablaw=function(a){var d=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(d,9))*(d*d-a*a)*(7*a*a-3*d*d)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(c,e,l){function a(a,d,c){c=c||{};this.restLength="number"===typeof c.restLength?c.restLength:1;this.stiffness=c.stiffness||100;this.damping=c.damping||1;this.bodyA=a;this.bodyB=d;this.localAnchorA=new f;this.localAnchorB=
new f;c.localAnchorA&&this.localAnchorA.copy(c.localAnchorA);c.localAnchorB&&this.localAnchorB.copy(c.localAnchorB);c.worldAnchorA&&this.setWorldAnchorA(c.worldAnchorA);c.worldAnchorB&&this.setWorldAnchorB(c.worldAnchorB)}var f=c("../math/Vec3");e.exports=a;a.prototype.setWorldAnchorA=function(a){this.bodyA.pointToLocalFrame(a,this.localAnchorA)};a.prototype.setWorldAnchorB=function(a){this.bodyB.pointToLocalFrame(a,this.localAnchorB)};a.prototype.getWorldAnchorA=function(a){this.bodyA.pointToWorldFrame(this.localAnchorA,
a)};a.prototype.getWorldAnchorB=function(a){this.bodyB.pointToWorldFrame(this.localAnchorB,a)};var d=new f,m=new f,g=new f,n=new f,p=new f,u=new f,q=new f,t=new f,y=new f,w=new f,C=new f;a.prototype.applyForce=function(){var a=this.stiffness,c=this.damping,e=this.restLength,f=this.bodyA,l=this.bodyB;this.getWorldAnchorA(p);this.getWorldAnchorB(u);p.vsub(f.position,q);u.vsub(l.position,t);u.vsub(p,d);var I=d.norm();m.copy(d);m.normalize();l.velocity.vsub(f.velocity,g);l.angularVelocity.cross(t,C);
g.vadd(C,g);f.angularVelocity.cross(q,C);g.vsub(C,g);m.mult(-a*(I-e)-c*g.dot(m),n);f.force.vsub(n,f.force);l.force.vadd(n,l.force);q.cross(n,y);t.cross(n,w);f.torque.vsub(y,f.torque);l.torque.vadd(w,l.torque)}},{"../math/Vec3":30}],36:[function(c,e,l){function a(a){a=g.defaults(a,{chassisConnectionPointLocal:new f,chassisConnectionPointWorld:new f,directionLocal:new f,directionWorld:new f,axleLocal:new f,axleWorld:new f,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,
dampingCompression:10,dampingRelaxation:10,frictionSlip:1E4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1});this.maxSuspensionTravel=a.maxSuspensionTravel;this.customSlidingRotationalSpeed=a.customSlidingRotationalSpeed;this.useCustomSlidingRotationalSpeed=
a.useCustomSlidingRotationalSpeed;this.sliding=!1;this.chassisConnectionPointLocal=a.chassisConnectionPointLocal.clone();this.chassisConnectionPointWorld=a.chassisConnectionPointWorld.clone();this.directionLocal=a.directionLocal.clone();this.directionWorld=a.directionWorld.clone();this.axleLocal=a.axleLocal.clone();this.axleWorld=a.axleWorld.clone();this.suspensionRestLength=a.suspensionRestLength;this.suspensionMaxLength=a.suspensionMaxLength;this.radius=a.radius;this.suspensionStiffness=a.suspensionStiffness;
this.dampingCompression=a.dampingCompression;this.dampingRelaxation=a.dampingRelaxation;this.frictionSlip=a.frictionSlip;this.deltaRotation=this.rotation=this.steering=0;this.rollInfluence=a.rollInfluence;this.maxSuspensionForce=a.maxSuspensionForce;this.brake=this.engineForce=0;this.isFrontWheel=a.isFrontWheel;this.clippedInvContactDotSuspension=1;this.forwardImpulse=this.sideImpulse=this.suspensionLength=this.skidInfo=this.suspensionForce=this.suspensionRelativeVelocity=0;this.raycastResult=new m;
this.worldTransform=new d;this.isInContact=!1}var f=c("../math/Vec3"),d=c("../math/Transform"),m=c("../collision/RaycastResult"),g=c("../utils/Utils");e.exports=a;var n=new f,p=new f,n=new f;a.prototype.updateWheel=function(a){var d=this.raycastResult;if(this.isInContact){var c=d.hitNormalWorld.dot(d.directionWorld);d.hitPointWorld.vsub(a.position,p);a.getVelocityAtWorldPoint(p,n);a=d.hitNormalWorld.dot(n);-.1<=c?(this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10):(c=-1/c,this.suspensionRelativeVelocity=
a*c,this.clippedInvContactDotSuspension=c)}else d.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,d.directionWorld.scale(-1,d.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(c,e,l){function a(a){f.call(this);this.type=f.types.BOX;this.halfExtents=a;this.convexPolyhedronRepresentation=null;this.updateConvexPolyhedronRepresentation();this.updateBoundingSphereRadius()}
e.exports=a;var f=c("./Shape"),d=c("../math/Vec3"),m=c("./ConvexPolyhedron");a.prototype=new f;a.prototype.constructor=a;a.prototype.updateConvexPolyhedronRepresentation=function(){var a=this.halfExtents.x,c=this.halfExtents.y,g=this.halfExtents.z,a=[new d(-a,-c,-g),new d(a,-c,-g),new d(a,c,-g),new d(-a,c,-g),new d(-a,-c,g),new d(a,-c,g),new d(a,c,g),new d(-a,c,g)];new d(0,0,1);new d(0,1,0);new d(1,0,0);this.convexPolyhedronRepresentation=a=new m(a,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,
3],[1,2,6,5]]);a.material=this.material};a.prototype.calculateLocalInertia=function(c,g){g=g||new d;a.calculateInertia(this.halfExtents,c,g);return g};a.calculateInertia=function(a,d,c){c.x=1/12*d*(4*a.y*a.y+4*a.z*a.z);c.y=1/12*d*(4*a.x*a.x+4*a.z*a.z);c.z=1/12*d*(4*a.y*a.y+4*a.x*a.x)};a.prototype.getSideNormals=function(a,d){var c=this.halfExtents;a[0].set(c.x,0,0);a[1].set(0,c.y,0);a[2].set(0,0,c.z);a[3].set(-c.x,0,0);a[4].set(0,-c.y,0);a[5].set(0,0,-c.z);if(void 0!==d)for(c=0;c!==a.length;c++)d.vmult(a[c],
a[c]);return a};a.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z};a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var g=new d;new d;a.prototype.forEachWorldCorner=function(a,d,c){for(var e=this.halfExtents,e=[[e.x,e.y,e.z],[-e.x,e.y,e.z],[-e.x,-e.y,e.z],[-e.x,-e.y,-e.z],[e.x,-e.y,-e.z],[e.x,e.y,-e.z],[-e.x,e.y,-e.z],[e.x,-e.y,e.z]],f=0;f<e.length;f++)g.set(e[f][0],e[f][1],e[f][2]),d.vmult(g,g),a.vadd(g,
g),c(g.x,g.y,g.z)};var n=[new d,new d,new d,new d,new d,new d,new d,new d];a.prototype.calculateWorldAABB=function(a,d,c,g){var e=this.halfExtents;n[0].set(e.x,e.y,e.z);n[1].set(-e.x,e.y,e.z);n[2].set(-e.x,-e.y,e.z);n[3].set(-e.x,-e.y,-e.z);n[4].set(e.x,-e.y,-e.z);n[5].set(e.x,e.y,-e.z);n[6].set(-e.x,e.y,-e.z);n[7].set(e.x,-e.y,e.z);var f=n[0];d.vmult(f,f);a.vadd(f,f);g.copy(f);c.copy(f);for(e=1;8>e;e++){f=n[e];d.vmult(f,f);a.vadd(f,f);var l=f.x,m=f.y,f=f.z;l>g.x&&(g.x=l);m>g.y&&(g.y=m);f>g.z&&(g.z=
f);l<c.x&&(c.x=l);m<c.y&&(c.y=m);f<c.z&&(c.z=f)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(c,e,l){function a(a,d,c){f.call(this);this.type=f.types.CONVEXPOLYHEDRON;this.vertices=a||[];this.worldVertices=[];this.worldVerticesNeedsUpdate=!0;this.faces=d||[];this.faceNormals=[];this.computeNormals();this.worldFaceNormalsNeedsUpdate=!0;this.worldFaceNormals=[];this.uniqueEdges=[];this.uniqueAxes=c?c.slice():null;this.computeEdges();this.updateBoundingSphereRadius()}e.exports=
a;var f=c("./Shape"),d=c("../math/Vec3");c("../math/Quaternion");var m=c("../math/Transform");a.prototype=new f;a.prototype.constructor=a;var g=new d;a.prototype.computeEdges=function(){for(var a=this.faces,d=this.vertices,c=this.uniqueEdges,e=c.length=0;e!==a.length;e++)for(var f=a[e],l=f.length,n=0;n!==l;n++){d[f[n]].vsub(d[f[(n+1)%l]],g);g.normalize();for(var m=!1,q=0;q!==c.length;q++)if(c[q].almostEquals(g)||c[q].almostEquals(g)){m=!0;break}m||c.push(g.clone())}};a.prototype.computeNormals=function(){this.faceNormals.length=
this.faces.length;for(var a=0;a<this.faces.length;a++){for(var c=0;c<this.faces[a].length;c++)if(!this.vertices[this.faces[a][c]])throw Error("Vertex "+this.faces[a][c]+" not found!");c=this.faceNormals[a]||new d;this.getFaceNormal(a,c);c.negate(c);this.faceNormals[a]=c;if(0>c.dot(this.vertices[this.faces[a][0]]))for(console.error(".faceNormals["+a+"] = Vec3("+c.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),
c=0;c<this.faces[a].length;c++)console.warn(".vertices["+this.faces[a][c]+"] = Vec3("+this.vertices[this.faces[a][c]].toString()+")")}};var n=new d,p=new d;a.computeNormal=function(a,d,c,e){d.vsub(a,p);c.vsub(d,n);n.cross(p,e);e.isZero()||e.normalize()};a.prototype.getFaceNormal=function(d,c){var e=this.faces[d];return a.computeNormal(this.vertices[e[0]],this.vertices[e[1]],this.vertices[e[2]],c)};var u=new d;a.prototype.clipAgainstHull=function(a,c,e,g,f,l,n,m,q){for(var p=-1,t=-Number.MAX_VALUE,
w=0;w<e.faces.length;w++){u.copy(e.faceNormals[w]);f.vmult(u,u);var z=u.dot(l);z>t&&(t=z,p=w)}for(var t=[],w=e.faces[p],z=w.length,y=0;y<z;y++){var C=e.vertices[w[y]],D=new d;D.copy(C);f.vmult(D,D);g.vadd(D,D);t.push(D)}0<=p&&this.clipFaceAgainstHull(l,a,c,t,n,m,q)};var q=new d,t=new d,y=new d,w=new d,C=new d,x=new d;a.prototype.findSeparatingAxis=function(a,d,c,e,g,f,l,n){var m=Number.MAX_VALUE,p=0;if(this.uniqueAxes)for(z=0;z!==this.uniqueAxes.length;z++){c.vmult(this.uniqueAxes[z],q);D=this.testSepAxis(q,
a,d,c,e,g);if(!1===D)return!1;D<m&&(m=D,f.copy(q))}else for(var u=l?l.length:this.faces.length,z=0;z<u;z++){D=l?l[z]:z;q.copy(this.faceNormals[D]);c.vmult(q,q);var D=this.testSepAxis(q,a,d,c,e,g);if(!1===D)return!1;D<m&&(m=D,f.copy(q))}if(a.uniqueAxes)for(z=0;z!==a.uniqueAxes.length;z++){g.vmult(a.uniqueAxes[z],t);p++;D=this.testSepAxis(t,a,d,c,e,g);if(!1===D)return!1;D<m&&(m=D,f.copy(t))}else for(l=n?n.length:a.faces.length,z=0;z<l;z++){D=n?n[z]:z;t.copy(a.faceNormals[D]);g.vmult(t,t);p++;D=this.testSepAxis(t,
a,d,c,e,g);if(!1===D)return!1;D<m&&(m=D,f.copy(t))}for(n=0;n!==this.uniqueEdges.length;n++)for(c.vmult(this.uniqueEdges[n],w),p=0;p!==a.uniqueEdges.length;p++)if(g.vmult(a.uniqueEdges[p],C),w.cross(C,x),!x.almostZero()){x.normalize();z=this.testSepAxis(x,a,d,c,e,g);if(!1===z)return!1;z<m&&(m=z,f.copy(x))}e.vsub(d,y);0<y.dot(f)&&f.negate(f);return!0};var B=[],G=[];a.prototype.testSepAxis=function(d,c,e,g,f,l){a.project(this,d,e,g,B);a.project(c,d,f,l,G);e=B[0];d=B[1];c=G[0];g=G[1];if(e<g||c<d)return!1;
e-=g;d=c-d;return e<d?e:d};var E=new d,R=new d;a.prototype.calculateLocalInertia=function(a,d){this.computeLocalAABB(E,R);var c=R.x-E.x,e=R.y-E.y,g=R.z-E.z;d.x=1/12*a*(4*e*e+4*g*g);d.y=1/12*a*(4*c*c+4*g*g);d.z=1/12*a*(4*e*e+4*c*c)};a.prototype.getPlaneConstantOfFace=function(a){return-this.faceNormals[a].dot(this.vertices[this.faces[a][0]])};var I=new d,K=new d,N=new d,D=new d,Z=new d,fa=new d,ja=new d,ga=new d;a.prototype.clipFaceAgainstHull=function(a,d,c,e,g,f,l){for(var n=[],m=-1,q=Number.MAX_VALUE,
p=0;p<this.faces.length;p++){I.copy(this.faceNormals[p]);c.vmult(I,I);var t=I.dot(a);t<q&&(q=t,m=p)}if(!(0>m)){a=this.faces[m];a.connectedFaces=[];for(q=0;q<this.faces.length;q++)for(p=0;p<this.faces[q].length;p++)-1!==a.indexOf(this.faces[q][p])&&q!==m&&-1===a.connectedFaces.indexOf(q)&&a.connectedFaces.push(q);q=a.length;for(p=0;p<q;p++){t=this.vertices[a[p]];t.vsub(this.vertices[a[(p+1)%q]],K);N.copy(K);c.vmult(N,N);d.vadd(N,N);D.copy(this.faceNormals[m]);c.vmult(D,D);d.vadd(D,D);N.cross(D,Z);
Z.negate(Z);fa.copy(t);c.vmult(fa,fa);d.vadd(fa,fa);fa.dot(Z);t=a.connectedFaces[p];ja.copy(this.faceNormals[t]);t=this.getPlaneConstantOfFace(t);ga.copy(ja);c.vmult(ga,ga);t-=ga.dot(d);for(this.clipFaceAgainstPlane(e,n,ga,t);e.length;)e.shift();for(;n.length;)e.push(n.shift())}ja.copy(this.faceNormals[m]);t=this.getPlaneConstantOfFace(m);ga.copy(ja);c.vmult(ga,ga);t-=ga.dot(d);for(q=0;q<e.length;q++)d=ga.dot(e[q])+t,d<=g&&(console.log("clamped: depth="+d+" to minDist="+(g+"")),d=g),d<=f&&(c=e[q],
0>=d&&l.push({point:c,normal:ga,depth:d}))}};a.prototype.clipFaceAgainstPlane=function(a,c,e,g){var f,l,m=a.length;if(2>m)return c;var n=a[a.length-1],q;f=e.dot(n)+g;for(var p=0;p<m;p++){q=a[p];l=e.dot(q)+g;if(0>f){if(0>l){var t=new d;t.copy(q)}else t=new d,n.lerp(q,f/(f-l),t);c.push(t)}else 0>l&&(t=new d,n.lerp(q,f/(f-l),t),c.push(t),c.push(q));n=q;f=l}return c};a.prototype.computeWorldVertices=function(a,c){for(var e=this.vertices.length;this.worldVertices.length<e;)this.worldVertices.push(new d);
for(var g=this.vertices,f=this.worldVertices,l=0;l!==e;l++)c.vmult(g[l],f[l]),a.vadd(f[l],f[l]);this.worldVerticesNeedsUpdate=!1};new d;a.prototype.computeLocalAABB=function(a,d){var c=this.vertices.length,e=this.vertices;a.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);d.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var g=0;g<c;g++){var f=e[g];f.x<a.x?a.x=f.x:f.x>d.x&&(d.x=f.x);f.y<a.y?a.y=f.y:f.y>d.y&&(d.y=f.y);f.z<a.z?a.z=f.z:f.z>d.z&&(d.z=f.z)}};a.prototype.computeWorldFaceNormals=
function(a){for(var c=this.faceNormals.length;this.worldFaceNormals.length<c;)this.worldFaceNormals.push(new d);for(var e=this.faceNormals,g=this.worldFaceNormals,f=0;f!==c;f++)a.vmult(e[f],g[f]);this.worldFaceNormalsNeedsUpdate=!1};a.prototype.updateBoundingSphereRadius=function(){for(var a=0,d=this.vertices,c=0,e=d.length;c!==e;c++){var g=d[c].norm2();g>a&&(a=g)}this.boundingSphereRadius=Math.sqrt(a)};var T=new d;a.prototype.calculateWorldAABB=function(a,d,c,e){for(var g=this.vertices.length,f=
this.vertices,l,m,n,q,p,t,u=0;u<g;u++){T.copy(f[u]);d.vmult(T,T);a.vadd(T,T);var z=T;if(z.x<l||void 0===l)l=z.x;else if(z.x>q||void 0===q)q=z.x;if(z.y<m||void 0===m)m=z.y;else if(z.y>p||void 0===p)p=z.y;if(z.z<n||void 0===n)n=z.z;else if(z.z>t||void 0===t)t=z.z}c.set(l,m,n);e.set(q,p,t)};a.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};a.prototype.getAveragePointLocal=function(a){a=a||new d;for(var c=this.vertices.length,e=this.vertices,g=0;g<c;g++)a.vadd(e[g],a);a.mult(1/
c,a);return a};a.prototype.transformAllPoints=function(a,d){var c=this.vertices.length,e=this.vertices;if(d){for(var g=0;g<c;g++){var f=e[g];d.vmult(f,f)}for(g=0;g<this.faceNormals.length;g++)f=this.faceNormals[g],d.vmult(f,f)}if(a)for(g=0;g<c;g++)f=e[g],f.vadd(a,f)};var ca=new d,W=new d,z=new d;a.prototype.pointIsInside=function(a){var d,c=this.vertices,e=this.faces,g=this.faceNormals,f=this.faces.length;this.getAveragePointLocal(ca);for(var l=0;l<f;l++){d=g[l];var m=c[e[l][0]],n=W;a.vsub(m,n);var n=
d.dot(n),q=z;ca.vsub(m,q);d=d.dot(q);if(0>n&&0<d||0<n&&0>d)return!1}return-1};new d;var V=new d,J=new d;a.project=function(a,d,c,e,g){var f=a.vertices.length;a=a.vertices;J.setZero();m.vectorToLocalFrame(c,e,d,V);m.pointToLocalFrame(c,e,J,J);e=J.dot(V);c=d=a[0].dot(V);for(var l=1;l<f;l++){var n=a[l].dot(V);n>d&&(d=n);n<c&&(c=n)}c-=e;d-=e;c>d&&(f=c,c=d,d=f);g[0]=d;g[1]=c}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(c,e,l){function a(a,c,e,l){var g=
[],n=[],p=[],u=[],C=[],x=Math.cos,B=Math.sin;g.push(new d(c*x(0),c*B(0),.5*-e));u.push(0);g.push(new d(a*x(0),a*B(0),.5*e));C.push(1);for(var G=0;G<l;G++){var E=2*Math.PI/l*(G+1),R=2*Math.PI/l*(G+.5);G<l-1?(g.push(new d(c*x(E),c*B(E),.5*-e)),u.push(2*G+2),g.push(new d(a*x(E),a*B(E),.5*e)),C.push(2*G+3),p.push([2*G+2,2*G+3,2*G+1,2*G])):p.push([0,1,2*G+1,2*G]);(1===l%2||G<l/2)&&n.push(new d(x(R),B(R),0))}p.push(C);n.push(new d(0,0,1));a=[];for(G=0;G<u.length;G++)a.push(u[u.length-G-1]);p.push(a);this.type=
f.types.CONVEXPOLYHEDRON;m.call(this,g,p,n)}e.exports=a;var f=c("./Shape"),d=c("../math/Vec3");c("../math/Quaternion");var m=c("./ConvexPolyhedron");a.prototype=new m},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(c,e,l){function a(a,c){c=g.defaults(c,{maxValue:null,minValue:null,elementSize:1});this.data=a;this.maxValue=c.maxValue;this.minValue=c.minValue;this.elementSize=c.elementSize;null===c.minValue&&this.updateMinValue();null===c.maxValue&&this.updateMaxValue();
this.cacheEnabled=!0;f.call(this);this.pillarConvex=new d;this.pillarOffset=new m;this.type=f.types.HEIGHTFIELD;this.updateBoundingSphereRadius();this._cachedPillars={}}var f=c("./Shape"),d=c("./ConvexPolyhedron"),m=c("../math/Vec3"),g=c("../utils/Utils");e.exports=a;a.prototype=new f;a.prototype.update=function(){this._cachedPillars={}};a.prototype.updateMinValue=function(){for(var a=this.data,d=a[0][0],c=0;c!==a.length;c++)for(var e=0;e!==a[c].length;e++){var g=a[c][e];g<d&&(d=g)}this.minValue=
d};a.prototype.updateMaxValue=function(){for(var a=this.data,d=a[0][0],c=0;c!==a.length;c++)for(var e=0;e!==a[c].length;e++){var g=a[c][e];g>d&&(d=g)}this.maxValue=d};a.prototype.setHeightValueAtIndex=function(a,d,c){this.data[a][d]=c;this.clearCachedConvexTrianglePillar(a,d,!1);0<a&&(this.clearCachedConvexTrianglePillar(a-1,d,!0),this.clearCachedConvexTrianglePillar(a-1,d,!1));0<d&&(this.clearCachedConvexTrianglePillar(a,d-1,!0),this.clearCachedConvexTrianglePillar(a,d-1,!1));0<d&&0<a&&this.clearCachedConvexTrianglePillar(a-
1,d-1,!0)};a.prototype.getRectMinMax=function(a,d,c,e,g){g=g||[];for(var f=this.data,l=this.minValue;a<=c;a++)for(var m=d;m<=e;m++){var n=f[a][m];n>l&&(l=n)}g[0]=this.minValue;g[1]=l};a.prototype.getIndexOfPosition=function(a,d,c,e){var g=this.elementSize,f=this.data;a=Math.floor(a/g);d=Math.floor(d/g);c[0]=a;c[1]=d;e&&(0>a&&(a=0),0>d&&(d=0),a>=f.length-1&&(a=f.length-1),d>=f[0].length-1&&(d=f[0].length-1));return 0>a||0>d||a>=f.length-1||d>=f[0].length-1?!1:!0};a.prototype.getHeightAt=function(a,
d,c){var e=[];this.getIndexOfPosition(a,d,e,c);a=[];this.getRectMinMax(e[0],e[1]+1,e[0],e[1]+1,a);return(a[0]+a[1])/2};a.prototype.getCacheConvexTrianglePillarKey=function(a,d,c){return a+"_"+d+"_"+(c?1:0)};a.prototype.getCachedConvexTrianglePillar=function(a,d,c){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(a,d,c)]};a.prototype.setCachedConvexTrianglePillar=function(a,d,c,e,g){this._cachedPillars[this.getCacheConvexTrianglePillarKey(a,d,c)]={convex:e,offset:g}};a.prototype.clearCachedConvexTrianglePillar=
function(a,d,c){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(a,d,c)]};a.prototype.getConvexTrianglePillar=function(a,c,e){var g=this.pillarConvex,f=this.pillarOffset;if(this.cacheEnabled){var l=this.getCachedConvexTrianglePillar(a,c,e);if(l){this.pillarConvex=l.convex;this.pillarOffset=l.offset;return}g=new d;f=new m;this.pillarConvex=g;this.pillarOffset=f}var l=this.data,n=this.elementSize,p=g.faces;g.vertices.length=6;for(var u=0;6>u;u++)g.vertices[u]||(g.vertices[u]=new m);p.length=
5;for(u=0;5>u;u++)p[u]||(p[u]=[]);var u=g.vertices,B=(Math.min(l[a][c],l[a+1][c],l[a][c+1],l[a+1][c+1])-this.minValue)/2+this.minValue;e?(f.set((a+.75)*n,(c+.75)*n,B),u[0].set(.25*n,.25*n,l[a+1][c+1]-B),u[1].set(-.75*n,.25*n,l[a][c+1]-B),u[2].set(.25*n,-.75*n,l[a+1][c]-B),u[3].set(.25*n,.25*n,-B-1),u[4].set(-.75*n,.25*n,-B-1),u[5].set(.25*n,-.75*n,-B-1),p[0][0]=0,p[0][1]=1,p[0][2]=2,p[1][0]=5,p[1][1]=4,p[1][2]=3,p[2][0]=2,p[2][1]=5,p[2][2]=3,p[2][3]=0,p[3][0]=3,p[3][1]=4,p[3][2]=1,p[3][3]=0,p[4][0]=
1,p[4][1]=4,p[4][2]=5,p[4][3]=2):(f.set((a+.25)*n,(c+.25)*n,B),u[0].set(-.25*n,-.25*n,l[a][c]-B),u[1].set(.75*n,-.25*n,l[a+1][c]-B),u[2].set(-.25*n,.75*n,l[a][c+1]-B),u[3].set(-.25*n,-.25*n,-B-1),u[4].set(.75*n,-.25*n,-B-1),u[5].set(-.25*n,.75*n,-B-1),p[0][0]=0,p[0][1]=1,p[0][2]=2,p[1][0]=5,p[1][1]=4,p[1][2]=3,p[2][0]=0,p[2][1]=2,p[2][2]=5,p[2][3]=3,p[3][0]=1,p[3][1]=0,p[3][2]=3,p[3][3]=4,p[4][0]=4,p[4][1]=5,p[4][2]=2,p[4][3]=1);g.computeNormals();g.computeEdges();g.updateBoundingSphereRadius();this.setCachedConvexTrianglePillar(a,
c,e,g,f)};a.prototype.calculateLocalInertia=function(a,d){d=d||new m;d.set(0,0,0);return d};a.prototype.volume=function(){return Number.MAX_VALUE};a.prototype.calculateWorldAABB=function(a,d,c,e){c.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};a.prototype.updateBoundingSphereRadius=function(){var a=this.data,d=this.elementSize;this.boundingSphereRadius=(new m(a.length*d,a[0].length*d,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue)))).norm()}},
{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(c,e,l){function a(){f.call(this);this.type=f.types.PARTICLE}e.exports=a;var f=c("./Shape"),d=c("../math/Vec3");a.prototype=new f;a.prototype.constructor=a;a.prototype.calculateLocalInertia=function(a,c){c=c||new d;c.set(0,0,0);return c};a.prototype.volume=function(){return 0};a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0};a.prototype.calculateWorldAABB=function(a,d,c,e){c.copy(a);
e.copy(a)}},{"../math/Vec3":30,"./Shape":43}],42:[function(c,e,l){function a(){f.call(this);this.type=f.types.PLANE;this.worldNormal=new d;this.worldNormalNeedsUpdate=!0;this.boundingSphereRadius=Number.MAX_VALUE}e.exports=a;var f=c("./Shape"),d=c("../math/Vec3");a.prototype=new f;a.prototype.constructor=a;a.prototype.computeWorldNormal=function(a){var d=this.worldNormal;d.set(0,0,1);a.vmult(d,d);this.worldNormalNeedsUpdate=!1};a.prototype.calculateLocalInertia=function(a,c){return c=c||new d};a.prototype.volume=
function(){return Number.MAX_VALUE};var m=new d;a.prototype.calculateWorldAABB=function(a,d,c,e){m.set(0,0,1);d.vmult(m,m);d=Number.MAX_VALUE;c.set(-d,-d,-d);e.set(d,d,d);1===m.x&&(e.x=a.x);1===m.y&&(e.y=a.y);1===m.z&&(e.z=a.z);-1===m.x&&(c.x=a.x);-1===m.y&&(c.y=a.y);-1===m.z&&(c.z=a.z)};a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(c,e,l){function a(){this.id=a.idCounter++;this.boundingSphereRadius=this.type=
0;this.collisionResponse=!0;this.material=null}e.exports=a;a=c("./Shape");c("../math/Vec3");c("../math/Quaternion");c("../material/Material");a.prototype.constructor=a;a.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type;};a.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type;};a.prototype.calculateLocalInertia=function(a,d){throw"calculateLocalInertia() not implemented for shape type "+this.type;
};a.idCounter=0;a.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(c,e,l){function a(a){f.call(this);this.radius=void 0!==a?Number(a):1;this.type=f.types.SPHERE;if(0>this.radius)throw Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}e.exports=a;var f=c("./Shape"),d=c("../math/Vec3");a.prototype=new f;a.prototype.constructor=
a;a.prototype.calculateLocalInertia=function(a,c){c=c||new d;var e=2*a*this.radius*this.radius/5;c.x=e;c.y=e;c.z=e;return c};a.prototype.volume=function(){return 4*Math.PI*this.radius/3};a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius};a.prototype.calculateWorldAABB=function(a,d,c,e){d=this.radius;for(var g=["x","y","z"],f=0;f<g.length;f++){var l=g[f];c[l]=a[l]-d;e[l]=a[l]+d}}},{"../math/Vec3":30,"./Shape":43}],45:[function(c,e,l){function a(a,c){f.call(this);
this.type=f.types.TRIMESH;this.vertices=new Float32Array(a);this.indices=new Int16Array(c);this.normals=new Float32Array(c.length);this.aabb=new g;this.edges=null;this.scale=new d(1,1,1);this.tree=new n;this.updateEdges();this.updateNormals();this.updateAABB();this.updateBoundingSphereRadius();this.updateTree()}e.exports=a;var f=c("./Shape"),d=c("../math/Vec3");c("../math/Quaternion");var m=c("../math/Transform"),g=c("../collision/AABB"),n=c("../utils/Octree");a.prototype=new f;a.prototype.constructor=
a;var p=new d;a.prototype.updateTree=function(){var a=this.tree;a.reset();a.aabb.copy(this.aabb);var c=this.scale;a.aabb.lowerBound.x*=1/c.x;a.aabb.lowerBound.y*=1/c.y;a.aabb.lowerBound.z*=1/c.z;a.aabb.upperBound.x*=1/c.x;a.aabb.upperBound.y*=1/c.y;a.aabb.upperBound.z*=1/c.z;for(var c=new g,e=new d,f=new d,l=new d,m=[e,f,l],n=0;n<this.indices.length/3;n++){var q=3*n;this._getUnscaledVertex(this.indices[q],e);this._getUnscaledVertex(this.indices[q+1],f);this._getUnscaledVertex(this.indices[q+2],l);
c.setFromPoints(m);a.insert(c,n)}a.removeEmptyNodes()};var u=new g;a.prototype.getTrianglesInAABB=function(a,d){u.copy(a);var c=this.scale,e=c.x,g=c.y,c=c.z,f=u.lowerBound,l=u.upperBound;f.x/=e;f.y/=g;f.z/=c;l.x/=e;l.y/=g;l.z/=c;return this.tree.aabbQuery(u,d)};a.prototype.setScale=function(a){var d=a.x===a.y===a.z;this.scale.x===this.scale.y===this.scale.z&&d||this.updateNormals();this.scale.copy(a);this.updateAABB();this.updateBoundingSphereRadius()};a.prototype.updateNormals=function(){for(var d=
this.normals,c=0;c<this.indices.length/3;c++){var e=3*c,f=this.indices[e+1],g=this.indices[e+2];this.getVertex(this.indices[e],C);this.getVertex(f,x);this.getVertex(g,B);a.computeNormal(x,C,B,p);d[e]=p.x;d[e+1]=p.y;d[e+2]=p.z}};a.prototype.updateEdges=function(){for(var a={},d=function(d,c){a[f<g?f+"_"+g:g+"_"+f]=!0},c=0;c<this.indices.length/3;c++){var e=3*c,f=this.indices[e],g=this.indices[e+1],e=this.indices[e+2];d(f,g);d(g,e);d(e,f)}d=Object.keys(a);this.edges=new Int16Array(2*d.length);for(c=
0;c<d.length;c++)e=d[c].split("_"),this.edges[2*c]=parseInt(e[0],10),this.edges[2*c+1]=parseInt(e[1],10)};a.prototype.getEdgeVertex=function(a,d,c){this.getVertex(this.edges[2*a+(d?1:0)],c)};var q=new d,t=new d;a.prototype.getEdgeVector=function(a,d){this.getEdgeVertex(a,0,q);this.getEdgeVertex(a,1,t);t.vsub(q,d)};var y=new d,w=new d;a.computeNormal=function(a,d,c,e){d.vsub(a,w);c.vsub(d,y);y.cross(w,e);e.isZero()||e.normalize()};var C=new d,x=new d,B=new d;a.prototype.getVertex=function(a,d){var c=
this.scale;this._getUnscaledVertex(a,d);d.x*=c.x;d.y*=c.y;d.z*=c.z;return d};a.prototype._getUnscaledVertex=function(a,d){var c=3*a,e=this.vertices;return d.set(e[c],e[c+1],e[c+2])};a.prototype.getWorldVertex=function(a,d,c,e){this.getVertex(a,e);m.pointToWorldFrame(d,c,e,e);return e};a.prototype.getTriangleVertices=function(a,d,c,e){a*=3;this.getVertex(this.indices[a],d);this.getVertex(this.indices[a+1],c);this.getVertex(this.indices[a+2],e)};a.prototype.getNormal=function(a,d){var c=3*a;return d.set(this.normals[c],
this.normals[c+1],this.normals[c+2])};var G=new g;a.prototype.calculateLocalInertia=function(a,d){this.computeLocalAABB(G);var c=G.upperBound.x-G.lowerBound.x,e=G.upperBound.y-G.lowerBound.y,f=G.upperBound.z-G.lowerBound.z;return d.set(1/12*a*(4*e*e+4*f*f),1/12*a*(4*c*c+4*f*f),1/12*a*(4*e*e+4*c*c))};var E=new d;a.prototype.computeLocalAABB=function(a){var d=a.lowerBound;a=a.upperBound;var c=this.vertices.length;this.getVertex(0,E);d.copy(E);a.copy(E);for(var e=0;e!==c;e++)this.getVertex(e,E),E.x<
d.x?d.x=E.x:E.x>a.x&&(a.x=E.x),E.y<d.y?d.y=E.y:E.y>a.y&&(a.y=E.y),E.z<d.z?d.z=E.z:E.z>a.z&&(a.z=E.z)};a.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)};a.prototype.updateBoundingSphereRadius=function(){for(var a=0,c=this.vertices,e=new d,f=0,c=c.length/3;f!==c;f++){this.getVertex(f,e);var g=e.norm2();g>a&&(a=g)}this.boundingSphereRadius=Math.sqrt(a)};new d;var R=new m,I=new g;a.prototype.calculateWorldAABB=function(a,d,c,e){R.position=a;R.quaternion=d;this.aabb.toWorldFrame(R,I);
c.copy(I.lowerBound);e.copy(I.upperBound)};a.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};a.createTorus=function(d,c,e,f,g){d=d||1;c=c||.5;e=e||8;f=f||6;g=g||2*Math.PI;for(var l=[],m=[],n=0;n<=e;n++)for(var q=0;q<=f;q++){var p=q/f*g,t=n/e*Math.PI*2;l.push((d+c*Math.cos(t))*Math.cos(p),(d+c*Math.cos(t))*Math.sin(p),c*Math.sin(t))}for(n=1;n<=e;n++)for(q=1;q<=f;q++)d=(f+1)*(n-1)+q-1,c=(f+1)*(n-1)+q,g=(f+1)*n+q,m.push((f+1)*n+q-1,d,g),m.push(d,c,g);return new a(l,m)}},{"../collision/AABB":3,
"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(c,e,l){function a(){f.call(this);this.iterations=10;this.tolerance=1E-7}e.exports=a;c("../math/Vec3");c("../math/Quaternion");var f=c("./Solver");a.prototype=new f;var d=[],m=[],g=[];a.prototype.solve=function(a,c){var e=0,f=this.iterations,l=this.tolerance*this.tolerance,n=this.equations,p=n.length,C=c.bodies,x=C.length,B,G,E,R,I;if(0!==p)for(E=0;E!==x;E++)C[E].updateSolveMassProperties();
m.length=p;g.length=p;d.length=p;for(E=0;E!==p;E++){var K=n[E];d[E]=0;g[E]=K.computeB(a);m[E]=1/K.computeC()}if(0!==p){for(E=0;E!==x;E++)K=C[E],e=K.wlambda,K.vlambda.set(0,0,0),e&&e.set(0,0,0);for(e=0;e!==f;e++){for(var N=E=0;N!==p;N++)K=n[N],B=g[N],G=m[N],I=d[N],R=K.computeGWlambda(),B=G*(B-R-K.eps*I),I+B<K.minForce?B=K.minForce-I:I+B>K.maxForce&&(B=K.maxForce-I),d[N]+=B,E+=0<B?B:-B,K.addToWlambda(B);if(E*E<l)break}for(E=0;E!==x;E++)K=C[E],f=K.velocity,l=K.angularVelocity,f.vadd(K.vlambda,f),l&&
l.vadd(K.wlambda,l)}return e}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(c,e,l){function a(){this.equations=[]}e.exports=a;a.prototype.solve=function(a,d){return 0};a.prototype.addEquation=function(a){a.enabled&&this.equations.push(a)};a.prototype.removeEquation=function(a){var d=this.equations;a=d.indexOf(a);-1!==a&&d.splice(a,1)};a.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(c,e,l){function a(a,d,c){g.call(this);this.iterations=
d;this.tolerance=c;this.subsolver=a;this.nodes=[];for(this.nodePool=[];128>this.nodePool.length;)this.nodePool.push(this.createNode())}function f(a){for(var d=a.length,c=0;c!==d;c++){var e=a[c];if(!(e.visited||e.body.type&q))return e}return!1}function d(a,d,c){d.push(a.body);d=a.eqs.length;for(var e=0;e!==d;e++){var f=a.eqs[e];-1===c.indexOf(f)&&c.push(f)}}function m(a,d){return d.id-a.id}e.exports=a;c("../math/Vec3");c("../math/Quaternion");var g=c("./Solver");c=c("../objects/Body");a.prototype=
new g;var n=[],p=[],u={bodies:[]},q=c.STATIC,t=[];a.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}};a.prototype.solve=function(a,c){for(var e=this.nodePool,g=c.bodies,l=this.equations,q=l.length,w=g.length,y=this.subsolver;e.length<w;)e.push(this.createNode());n.length=w;for(var I=0;I<w;I++)n[I]=e[I];for(I=0;I!==w;I++)e=n[I],e.body=g[I],e.children.length=0,e.eqs.length=0,e.visited=!1;for(w=0;w!==q;w++){var e=l[w],I=g.indexOf(e.bi),K=g.indexOf(e.bj),I=n[I],K=n[K];I.children.push(K);
I.eqs.push(e);K.children.push(I);K.eqs.push(e)}g=0;l=p;y.tolerance=this.tolerance;for(y.iterations=this.iterations;I=f(n);){l.length=0;u.bodies.length=0;e=I;I=d;q=u.bodies;w=l;t.push(e);e.visited=!0;for(I(e,q,w);t.length;)for(e=t.pop();K=f(e.children);)K.visited=!0,I(K,q,w),t.push(K);q=l.length;l=l.sort(m);for(I=0;I!==q;I++)y.addEquation(l[I]);y.solve(a,u);y.removeAllEquations();g++}return g}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(c,e,l){c=function(){};
e.exports=c;c.prototype={constructor:c,addEventListener:function(a,c){void 0===this._listeners&&(this._listeners={});var d=this._listeners;void 0===d[a]&&(d[a]=[]);-1===d[a].indexOf(c)&&d[a].push(c);return this},hasEventListener:function(a,c){if(void 0===this._listeners)return!1;var d=this._listeners;return void 0!==d[a]&&-1!==d[a].indexOf(c)?!0:!1},removeEventListener:function(a,c){if(void 0===this._listeners)return this;var d=this._listeners;if(void 0===d[a])return this;var e=d[a].indexOf(c);-1!==
e&&d[a].splice(e,1);return this},dispatchEvent:function(a){if(void 0===this._listeners)return this;var c=this._listeners[a.type];if(void 0!==c){a.target=this;for(var d=0,e=c.length;d<e;d++)c[d].call(this,a)}return this}}},{}],50:[function(c,e,l){function a(a){a=a||{};this.root=a.root||null;this.aabb=a.aabb?a.aabb.clone():new d;this.data=[];this.children=[]}function f(c,d){d=d||{};d.root=null;d.aabb=c;a.call(this,d);this.maxDepth="undefined"!==typeof d.maxDepth?d.maxDepth:8}var d=c("../collision/AABB"),
m=c("../math/Vec3");e.exports=f;f.prototype=new a;a.prototype.reset=function(a,c){this.children.length=this.data.length=0};a.prototype.insert=function(a,c,d){var e=this.data;d=d||0;if(!this.aabb.contains(a))return!1;var g=this.children;if(d<(this.maxDepth||this.root.maxDepth)){var f=!1;g.length||(this.subdivide(),f=!0);for(var l=0;8!==l;l++)if(g[l].insert(a,c,d+1))return!0;f&&(g.length=0)}e.push(c);return!0};var g=new m;a.prototype.subdivide=function(){var c=this.aabb,e=c.lowerBound,f=c.upperBound,
c=this.children;c.push(new a({aabb:new d({lowerBound:new m(0,0,0)})}),new a({aabb:new d({lowerBound:new m(1,0,0)})}),new a({aabb:new d({lowerBound:new m(1,1,0)})}),new a({aabb:new d({lowerBound:new m(1,1,1)})}),new a({aabb:new d({lowerBound:new m(0,1,1)})}),new a({aabb:new d({lowerBound:new m(0,0,1)})}),new a({aabb:new d({lowerBound:new m(1,0,1)})}),new a({aabb:new d({lowerBound:new m(0,1,0)})}));f.vsub(e,g);g.scale(.5,g);for(var f=this.root||this,l=0;8!==l;l++){var n=c[l];n.root=f;var w=n.aabb.lowerBound;
w.x*=g.x;w.y*=g.y;w.z*=g.z;w.vadd(e,w);w.vadd(g,n.aabb.upperBound)}};a.prototype.aabbQuery=function(a,c){for(var d=[this];d.length;){var e=d.pop();e.aabb.overlaps(a)&&Array.prototype.push.apply(c,e.data);Array.prototype.push.apply(d,e.children)}return c};var n=new d;a.prototype.rayQuery=function(a,c,d){a.getAABB(n);n.toLocalFrame(c,n);this.aabbQuery(n,d);return d};a.prototype.removeEmptyNodes=function(){for(var a=[this];a.length;){for(var c=a.pop(),d=c.children.length-1;0<=d;d--)c.children[d].data.length||
c.children.splice(d,1);Array.prototype.push.apply(a,c.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(c,e,l){function a(){this.objects=[];this.type=Object}e.exports=a;a.prototype.release=function(){for(var a=arguments.length,c=0;c!==a;c++)this.objects.push(arguments[c])};a.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()};a.prototype.constructObject=function(){throw Error("constructObject() not implemented in this Pool subclass yet!");
}},{}],52:[function(c,e,l){function a(){this.data={keys:[]}}e.exports=a;a.prototype.get=function(a,c){if(a>c){var d=c;c=a;a=d}return this.data[a+"-"+c]};a.prototype.set=function(a,c,e){if(a>c){var d=c;c=a;a=d}d=a+"-"+c;this.get(a,c)||this.data.keys.push(d);this.data[d]=e};a.prototype.reset=function(){for(var a=this.data,c=a.keys;0<c.length;){var e=c.pop();delete a[e]}}},{}],53:[function(c,e,l){function a(){}e.exports=a;a.defaults=function(a,c){a=a||{};for(var d in c)d in a||(a[d]=c[d]);return a}},
{}],54:[function(c,e,l){function a(){d.call(this);this.type=f}e.exports=a;var f=c("../math/Vec3"),d=c("./Pool");a.prototype=new d;a.prototype.constructObject=function(){return new f}},{"../math/Vec3":30,"./Pool":51}],55:[function(c,e,l){function a(a){this.contactPointPool=[];this.frictionEquationPool=[];this.result=[];this.frictionResult=[];this.v3pool=new n;this.world=a;this.currentContactMaterial=null;this.enableFrictionReduction=!1}e.exports=a;e=c("../collision/AABB");l=c("../shapes/Shape");var f=
c("../collision/Ray"),d=c("../math/Vec3"),m=c("../math/Transform");c("../shapes/ConvexPolyhedron");var g=c("../math/Quaternion");c("../solver/Solver");var n=c("../utils/Vec3Pool"),p=c("../equations/ContactEquation"),u=c("../equations/FrictionEquation");a.prototype.createContactEquation=function(a,c,d,e,g,f){var l;this.contactPointPool.length?(l=this.contactPointPool.pop(),l.bi=a,l.bj=c):l=new p(a,c);l.enabled=a.collisionResponse&&c.collisionResponse&&d.collisionResponse&&e.collisionResponse;var m=
this.currentContactMaterial;l.restitution=m.restitution;l.setSpookParams(m.contactEquationStiffness,m.contactEquationRelaxation,this.world.dt);a=d.material||a.material;c=e.material||c.material;a&&c&&0<=a.restitution&&0<=c.restitution&&(l.restitution=a.restitution*c.restitution);l.si=g||d;l.sj=f||e;return l};a.prototype.createFrictionEquationsFromContact=function(a,c){var d=a.bi,e=a.bj,g=this.world,f=this.currentContactMaterial,l=f.friction,m=a.si.material||d.material,n=a.sj.material||e.material;m&&
n&&0<=m.friction&&0<=n.friction&&(l=m.friction*n.friction);if(0<l){l*=g.gravity.length();m=d.invMass+e.invMass;0<m&&(m=1/m);var q=this.frictionEquationPool,n=q.length?q.pop():new u(d,e,l*m),q=q.length?q.pop():new u(d,e,l*m);n.bi=q.bi=d;n.bj=q.bj=e;n.minForce=q.minForce=-l*m;n.maxForce=q.maxForce=l*m;n.ri.copy(a.ri);n.rj.copy(a.rj);q.ri.copy(a.ri);q.rj.copy(a.rj);a.ni.tangents(n.t,q.t);n.setSpookParams(f.frictionEquationStiffness,f.frictionEquationRelaxation,g.dt);q.setSpookParams(f.frictionEquationStiffness,
f.frictionEquationRelaxation,g.dt);n.enabled=q.enabled=a.enabled;c.push(n,q);return!0}return!1};var q=new d,t=new d,y=new d;a.prototype.createFrictionFromAverage=function(a){var c=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(c,this.frictionResult)&&1!==a){var d=this.frictionResult[this.frictionResult.length-2],e=this.frictionResult[this.frictionResult.length-1];q.setZero();t.setZero();y.setZero();for(var g=c.bi,f=0;f!==a;f++)c=this.result[this.result.length-1-f],c.bodyA!==
g?(q.vadd(c.ni,q),t.vadd(c.ri,t),y.vadd(c.rj,y)):(q.vsub(c.ni,q),t.vadd(c.rj,t),y.vadd(c.ri,y));a=1/a;t.scale(a,d.ri);y.scale(a,d.rj);e.ri.copy(d.ri);e.rj.copy(d.rj);q.normalize();q.tangents(d.t,e.t)}};var w=new d,C=new d,x=new g,B=new g;a.prototype.getContacts=function(a,c,d,e,g,f,l){this.contactPointPool=g;this.frictionEquationPool=l;this.result=e;this.frictionResult=f;e=0;for(g=a.length;e!==g;e++){f=a[e];l=c[e];var m=null;f.material&&l.material&&(m=d.getContactMaterial(f.material,l.material)||
null);for(var n=0;n<f.shapes.length;n++){f.quaternion.mult(f.shapeOrientations[n],x);f.quaternion.vmult(f.shapeOffsets[n],w);w.vadd(f.position,w);for(var q=f.shapes[n],p=0;p<l.shapes.length;p++){l.quaternion.mult(l.shapeOrientations[p],B);l.quaternion.vmult(l.shapeOffsets[p],C);C.vadd(l.position,C);var t=l.shapes[p];if(!(w.distanceTo(C)>q.boundingSphereRadius+t.boundingSphereRadius)){var u=null;q.material&&t.material&&(u=d.getContactMaterial(q.material,t.material)||null);this.currentContactMaterial=
u||m||d.defaultContactMaterial;(u=this[q.type|t.type])&&(q.type<t.type?u.call(this,q,t,w,C,x,B,f,l,q,t):u.call(this,t,q,C,w,B,x,l,f,q,t))}}}}};a.prototype[l.types.BOX|l.types.BOX]=a.prototype.boxBox=function(a,c,d,e,g,f,l,m){a.convexPolyhedronRepresentation.material=a.material;c.convexPolyhedronRepresentation.material=c.material;a.convexPolyhedronRepresentation.collisionResponse=a.collisionResponse;c.convexPolyhedronRepresentation.collisionResponse=c.collisionResponse;this.convexConvex(a.convexPolyhedronRepresentation,
c.convexPolyhedronRepresentation,d,e,g,f,l,m,a,c)};a.prototype[l.types.BOX|l.types.CONVEXPOLYHEDRON]=a.prototype.boxConvex=function(a,c,d,e,g,f,l,m){a.convexPolyhedronRepresentation.material=a.material;a.convexPolyhedronRepresentation.collisionResponse=a.collisionResponse;this.convexConvex(a.convexPolyhedronRepresentation,c,d,e,g,f,l,m,a,c)};a.prototype[l.types.BOX|l.types.PARTICLE]=a.prototype.boxParticle=function(a,c,d,e,g,f,l,m){a.convexPolyhedronRepresentation.material=a.material;a.convexPolyhedronRepresentation.collisionResponse=
a.collisionResponse;this.convexParticle(a.convexPolyhedronRepresentation,c,d,e,g,f,l,m,a,c)};a.prototype[l.types.SPHERE]=a.prototype.sphereSphere=function(a,c,d,e,g,f,l,m){g=this.createContactEquation(l,m,a,c);e.vsub(d,g.ni);g.ni.normalize();g.ri.copy(g.ni);g.rj.copy(g.ni);g.ri.mult(a.radius,g.ri);g.rj.mult(-c.radius,g.rj);g.ri.vadd(d,g.ri);g.ri.vsub(l.position,g.ri);g.rj.vadd(e,g.rj);g.rj.vsub(m.position,g.rj);this.result.push(g);this.createFrictionEquationsFromContact(g,this.frictionResult)};var G=
new d,E=new d,R=new d;a.prototype[l.types.PLANE|l.types.TRIMESH]=a.prototype.planeTrimesh=function(a,c,e,g,f,l,n,q){var p=new d;G.set(0,0,1);f.vmult(G,G);for(f=0;f<c.vertices.length/3;f++){c.getVertex(f,p);var t=new d;t.copy(p);m.pointToWorldFrame(g,l,t,p);t=E;p.vsub(e,t);if(0>=G.dot(t)){var u=this.createContactEquation(n,q,a,c);u.ni.copy(G);var z=R;G.scale(t.dot(G),z);p.vsub(z,z);u.ri.copy(z);u.ri.vsub(n.position,u.ri);u.rj.copy(p);u.rj.vsub(q.position,u.rj);this.result.push(u);this.createFrictionEquationsFromContact(u,
this.frictionResult)}}};var I=new d,K=new d;new d;var N=new d,D=new d,Z=new d,fa=new d,ja=new d,ga=new d,T=new d,ca=new d,W=new d,z=new d,V=new d,J=new e,ea=[];a.prototype[l.types.SPHERE|l.types.TRIMESH]=a.prototype.sphereTrimesh=function(a,c,d,e,g,l,n,q){m.pointToLocalFrame(e,l,d,T);g=a.radius;J.lowerBound.set(T.x-g,T.y-g,T.z-g);J.upperBound.set(T.x+g,T.y+g,T.z+g);c.getTrianglesInAABB(J,ea);var p=a.radius*a.radius;for(g=0;g<ea.length;g++)for(var t=0;3>t;t++)if(c.getVertex(c.indices[3*ea[g]+t],N),
N.vsub(T,K),K.norm2()<=p){D.copy(N);m.pointToWorldFrame(e,l,D,N);N.vsub(d,K);var u=this.createContactEquation(n,q,a,c);u.ni.copy(K);u.ni.normalize();u.ri.copy(u.ni);u.ri.scale(a.radius,u.ri);u.ri.vadd(d,u.ri);u.ri.vsub(n.position,u.ri);u.rj.copy(N);u.rj.vsub(q.position,u.rj);this.result.push(u);this.createFrictionEquationsFromContact(u,this.frictionResult)}for(g=0;g<ea.length;g++)for(t=0;3>t;t++)c.getVertex(c.indices[3*ea[g]+t],Z),c.getVertex(c.indices[3*ea[g]+(t+1)%3],fa),fa.vsub(Z,ja),T.vsub(fa,
ca),d=ca.dot(ja),T.vsub(Z,ca),u=ca.dot(ja),0<u&&0>d&&(T.vsub(Z,ca),ga.copy(ja),ga.normalize(),u=ca.dot(ga),ga.scale(u,ca),ca.vadd(Z,ca),d=ca.distanceTo(T),d<a.radius&&(u=this.createContactEquation(n,q,a,c),ca.vsub(T,u.ni),u.ni.normalize(),u.ni.scale(a.radius,u.ri),m.pointToWorldFrame(e,l,ca,ca),ca.vsub(q.position,u.rj),m.vectorToWorldFrame(l,u.ni,u.ni),m.vectorToWorldFrame(l,u.ri,u.ri),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult)));g=0;for(t=ea.length;g!==t;g++)c.getTriangleVertices(ea[g],
W,z,V),c.getNormal(ea[g],I),T.vsub(W,ca),d=ca.dot(I),I.scale(d,ca),T.vsub(ca,ca),d=ca.distanceTo(T),f.pointInTriangle(ca,W,z,V)&&d<a.radius&&(u=this.createContactEquation(n,q,a,c),ca.vsub(T,u.ni),u.ni.normalize(),u.ni.scale(a.radius,u.ri),m.pointToWorldFrame(e,l,ca,ca),ca.vsub(q.position,u.rj),m.vectorToWorldFrame(l,u.ni,u.ni),m.vectorToWorldFrame(l,u.ri,u.ri),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult));ea.length=0};var S=new d,xa=new d;a.prototype[l.types.SPHERE|
l.types.PLANE]=a.prototype.spherePlane=function(a,c,d,e,g,f,l,m){c=this.createContactEquation(l,m,a,c);c.ni.set(0,0,1);f.vmult(c.ni,c.ni);c.ni.negate(c.ni);c.ni.normalize();c.ni.mult(a.radius,c.ri);d.vsub(e,S);c.ni.mult(c.ni.dot(S),xa);S.vsub(xa,c.rj);-S.dot(c.ni)<=a.radius&&(a=c.ri,f=c.rj,a.vadd(d,a),a.vsub(l.position,a),f.vadd(e,f),f.vsub(m.position,f),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult))};var qa=new d,Ra=new d,oa=new d,O=new d,Na=new d,Wa=new d,db=
new d,aa=[new d,new d,new d,new d,new d,new d],Ba=new d,Aa=new d,ra=new d,Oa=new d;a.prototype[l.types.SPHERE|l.types.BOX]=a.prototype.sphereBox=function(a,c,d,e,g,f,l,m){g=this.v3pool;d.vsub(e,O);c.getSideNormals(aa,f);f=a.radius;for(var n=!1,q=null,p=0,t=0,u=0,z=null,w=0,y=aa.length;w!==y&&!1===n;w++){var J=Na;J.copy(aa[w]);var D=J.norm();J.normalize();var x=O.dot(J);if(x<D+f&&0<x){var B=Wa,C=db;B.copy(aa[(w+1)%3]);C.copy(aa[(w+2)%3]);var V=B.norm(),E=C.norm();B.normalize();C.normalize();var G=
O.dot(B),T=O.dot(C);G<V&&G>-V&&T<E&&T>-E&&(x=Math.abs(x-D-f),null===z||x<z)&&(z=x,t=G,u=T,q=D,Aa.copy(J),ra.copy(B),Oa.copy(C),p++)}}p&&(n=!0,p=this.createContactEquation(l,m,a,c),Aa.mult(-f,p.ri),p.ni.copy(Aa),p.ni.negate(p.ni),Aa.mult(q,Aa),ra.mult(t,ra),Aa.vadd(ra,Aa),Oa.mult(u,Oa),Aa.vadd(Oa,p.rj),p.ri.vadd(d,p.ri),p.ri.vsub(l.position,p.ri),p.rj.vadd(e,p.rj),p.rj.vsub(m.position,p.rj),this.result.push(p),this.createFrictionEquationsFromContact(p,this.frictionResult));x=g.get();for(q=0;2!==q&&
!n;q++)for(t=0;2!==t&&!n;t++)for(u=0;2!==u&&!n;u++)x.set(0,0,0),q?x.vadd(aa[0],x):x.vsub(aa[0],x),t?x.vadd(aa[1],x):x.vsub(aa[1],x),u?x.vadd(aa[2],x):x.vsub(aa[2],x),e.vadd(x,Ba),Ba.vsub(d,Ba),Ba.norm2()<f*f&&(n=!0,p=this.createContactEquation(l,m,a,c),p.ri.copy(Ba),p.ri.normalize(),p.ni.copy(p.ri),p.ri.mult(f,p.ri),p.rj.copy(x),p.ri.vadd(d,p.ri),p.ri.vsub(l.position,p.ri),p.rj.vadd(e,p.rj),p.rj.vsub(m.position,p.rj),this.result.push(p),this.createFrictionEquationsFromContact(p,this.frictionResult));
g.release(x);z=g.get();w=g.get();p=g.get();y=g.get();x=g.get();J=aa.length;for(q=0;q!==J&&!n;q++)for(t=0;t!==J&&!n;t++)if(q%3!==t%3){aa[t].cross(aa[q],z);z.normalize();aa[q].vadd(aa[t],w);p.copy(d);p.vsub(w,p);p.vsub(e,p);D=p.dot(z);z.mult(D,y);for(u=0;u===q%3||u===t%3;)u++;x.copy(d);x.vsub(y,x);x.vsub(w,x);x.vsub(e,x);D=Math.abs(D);B=x.norm();D<aa[u].norm()&&B<f&&(n=!0,u=this.createContactEquation(l,m,a,c),w.vadd(y,u.rj),u.rj.copy(u.rj),x.negate(u.ni),u.ni.normalize(),u.ri.copy(u.rj),u.ri.vadd(e,
u.ri),u.ri.vsub(d,u.ri),u.ri.normalize(),u.ri.mult(f,u.ri),u.ri.vadd(d,u.ri),u.ri.vsub(l.position,u.ri),u.rj.vadd(e,u.rj),u.rj.vsub(m.position,u.rj),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult))}g.release(z,w,p,y,x)};var La=new d,Ma=new d,yb=new d,ad=new d,fb=new d,gb=new d,Tb=new d,X=new d,lb=new d,Qa=new d;a.prototype[l.types.SPHERE|l.types.CONVEXPOLYHEDRON]=a.prototype.sphereConvex=function(a,c,d,e,g,f,l,m){g=this.v3pool;d.vsub(e,La);for(var n=c.faceNormals,
q=c.faces,p=c.vertices,t=a.radius,u=0;u!==p.length;u++){var z=fb;f.vmult(p[u],z);e.vadd(z,z);var w=ad;z.vsub(d,w);if(w.norm2()<t*t){a=this.createContactEquation(l,m,a,c);a.ri.copy(w);a.ri.normalize();a.ni.copy(a.ri);a.ri.mult(t,a.ri);z.vsub(e,a.rj);a.ri.vadd(d,a.ri);a.ri.vsub(l.position,a.ri);a.rj.vadd(e,a.rj);a.rj.vsub(m.position,a.rj);this.result.push(a);this.createFrictionEquationsFromContact(a,this.frictionResult);return}}u=0;for(z=q.length;u!==z;u++){var w=q[u],y=gb;f.vmult(n[u],y);var x=Tb;
f.vmult(p[w[0]],x);x.vadd(e,x);var J=X;y.mult(-t,J);d.vadd(J,J);var D=lb;J.vsub(x,D);J=D.dot(y);D=Qa;d.vsub(x,D);if(0>J&&0<D.dot(y)){for(var x=[],D=0,B=w.length;D!==B;D++){var C=g.get();f.vmult(p[w[D]],C);e.vadd(C,C);x.push(C)}a:{for(var D=x,B=y,C=d,V=null,E=D.length,G=0;G!==E;G++){var T=D[G],W=qa;D[(G+1)%E].vsub(T,W);var ea=Ra;W.cross(B,ea);W=oa;C.vsub(T,W);T=ea.dot(W);if(null===V||0<T&&!0===V||0>=T&&!1===V)null===V&&(V=0<T);else{D=!1;break a}}D=!0}if(D){a=this.createContactEquation(l,m,a,c);y.mult(-t,
a.ri);y.negate(a.ni);c=g.get();y.mult(-J,c);f=g.get();y.mult(-t,f);d.vsub(e,a.rj);a.rj.vadd(f,a.rj);a.rj.vadd(c,a.rj);a.rj.vadd(e,a.rj);a.rj.vsub(m.position,a.rj);a.ri.vadd(d,a.ri);a.ri.vsub(l.position,a.ri);g.release(c);g.release(f);this.result.push(a);this.createFrictionEquationsFromContact(a,this.frictionResult);D=0;for(w=x.length;D!==w;D++)g.release(x[D]);break}else for(D=0;D!==w.length;D++){y=g.get();J=g.get();f.vmult(p[w[(D+1)%w.length]],y);f.vmult(p[w[(D+2)%w.length]],J);e.vadd(y,y);e.vadd(J,
J);E=Ma;J.vsub(y,E);V=yb;E.unit(V);B=g.get();C=g.get();d.vsub(y,C);G=C.dot(V);V.mult(G,B);B.vadd(y,B);V=g.get();B.vsub(d,V);if(0<G&&G*G<E.norm2()&&V.norm2()<t*t){a=this.createContactEquation(l,m,a,c);B.vsub(e,a.rj);B.vsub(d,a.ni);a.ni.normalize();a.ni.mult(t,a.ri);a.rj.vadd(e,a.rj);a.rj.vsub(m.position,a.rj);a.ri.vadd(d,a.ri);a.ri.vsub(l.position,a.ri);this.result.push(a);this.createFrictionEquationsFromContact(a,this.frictionResult);D=0;for(w=x.length;D!==w;D++)g.release(x[D]);g.release(y);g.release(J);
g.release(B);g.release(V);g.release(C);return}g.release(y);g.release(J);g.release(B);g.release(V);g.release(C)}D=0;for(w=x.length;D!==w;D++)g.release(x[D])}}};new d;new d;a.prototype[l.types.PLANE|l.types.BOX]=a.prototype.planeBox=function(a,c,d,e,g,f,l,m){c.convexPolyhedronRepresentation.material=c.material;c.convexPolyhedronRepresentation.collisionResponse=c.collisionResponse;this.planeConvex(a,c.convexPolyhedronRepresentation,d,e,g,f,l,m)};var sa=new d,Pa=new d,P=new d,bd=new d;a.prototype[l.types.PLANE|
l.types.CONVEXPOLYHEDRON]=a.prototype.planeConvex=function(a,c,d,e,g,f,l,m){Pa.set(0,0,1);g.vmult(Pa,Pa);for(var n=g=0;n!==c.vertices.length;n++)if(sa.copy(c.vertices[n]),f.vmult(sa,sa),e.vadd(sa,sa),sa.vsub(d,P),0>=Pa.dot(P)){var q=this.createContactEquation(l,m,a,c),p=bd;Pa.mult(Pa.dot(P),p);sa.vsub(p,p);p.vsub(d,q.ri);q.ni.copy(Pa);sa.vsub(e,q.rj);q.ri.vadd(d,q.ri);q.ri.vsub(l.position,q.ri);q.rj.vadd(e,q.rj);q.rj.vsub(m.position,q.rj);this.result.push(q);g++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(q,
this.frictionResult)}this.enableFrictionReduction&&g&&this.createFrictionFromAverage(g)};var Wb=new d,Ja=new d;a.prototype[l.types.CONVEXPOLYHEDRON]=a.prototype.convexConvex=function(a,c,d,e,g,f,l,m,n,q,p,t){if(!(d.distanceTo(e)>a.boundingSphereRadius+c.boundingSphereRadius)&&a.findSeparatingAxis(c,d,g,e,f,Wb,p,t)){p=[];a.clipAgainstHull(d,g,c,e,f,Wb,-100,100,p);for(f=g=0;f!==p.length;f++){t=this.createContactEquation(l,m,a,c,n,q);var u=t.ri,z=t.rj;Wb.negate(t.ni);p[f].normal.negate(Ja);Ja.mult(p[f].depth,
Ja);p[f].point.vadd(Ja,u);z.copy(p[f].point);u.vsub(d,u);z.vsub(e,z);u.vadd(d,u);u.vsub(l.position,u);z.vadd(e,z);z.vsub(m.position,z);this.result.push(t);g++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(t,this.frictionResult)}this.enableFrictionReduction&&g&&this.createFrictionFromAverage(g)}};var ha=new d,wc=new d,ia=new d;a.prototype[l.types.PLANE|l.types.PARTICLE]=a.prototype.planeParticle=function(a,c,d,e,g,f,l,m){ha.set(0,0,1);l.quaternion.vmult(ha,ha);e.vsub(l.position,
wc);0>=ha.dot(wc)&&(a=this.createContactEquation(m,l,c,a),a.ni.copy(ha),a.ni.negate(a.ni),a.ri.set(0,0,0),ha.mult(ha.dot(e),ia),e.vsub(ia,ia),a.rj.copy(ia),this.result.push(a),this.createFrictionEquationsFromContact(a,this.frictionResult))};var Da=new d;a.prototype[l.types.PARTICLE|l.types.SPHERE]=a.prototype.sphereParticle=function(a,c,d,e,g,f,l,m){Da.set(0,0,1);e.vsub(d,Da);Da.norm2()<=a.radius*a.radius&&(c=this.createContactEquation(m,l,c,a),Da.normalize(),c.rj.copy(Da),c.rj.mult(a.radius,c.rj),
c.ni.copy(Da),c.ni.negate(c.ni),c.ri.set(0,0,0),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult))};var hb=new g,ab=new d;new d;var za=new d,Sa=new d,eb=new d;a.prototype[l.types.PARTICLE|l.types.CONVEXPOLYHEDRON]=a.prototype.convexParticle=function(a,c,d,e,g,f,l,m){var n=-1;f=null;var q=0;ab.copy(e);ab.vsub(d,ab);g.conjugate(hb);hb.vmult(ab,ab);if(a.pointIsInside(ab)){a.worldVerticesNeedsUpdate&&a.computeWorldVertices(d,g);a.worldFaceNormalsNeedsUpdate&&a.computeWorldFaceNormals(g);
g=0;for(var p=a.faces.length;g!==p;g++){var t=a.worldFaceNormals[g];e.vsub(a.worldVertices[a.faces[g][0]],Sa);var u=-t.dot(Sa);if(null===f||Math.abs(u)<Math.abs(f))f=u,n=g,za.copy(t),q++}-1!==n?(a=this.createContactEquation(m,l,c,a),za.mult(f,eb),eb.vadd(e,eb),eb.vsub(d,eb),a.rj.copy(eb),za.negate(a.ni),a.ri.set(0,0,0),c=a.ri,f=a.rj,c.vadd(e,c),c.vsub(m.position,c),f.vadd(d,f),f.vsub(l.position,f),this.result.push(a),this.createFrictionEquationsFromContact(a,this.frictionResult)):console.warn("Point found inside convex, but did not find penetrating face!")}};
a.prototype[l.types.BOX|l.types.HEIGHTFIELD]=a.prototype.boxHeightfield=function(a,c,d,e,g,f,l,m){a.convexPolyhedronRepresentation.material=a.material;a.convexPolyhedronRepresentation.collisionResponse=a.collisionResponse;this.convexHeightfield(a.convexPolyhedronRepresentation,c,d,e,g,f,l,m)};var mb=new d,tb=new d,cd=[0];a.prototype[l.types.CONVEXPOLYHEDRON|l.types.HEIGHTFIELD]=a.prototype.convexHeightfield=function(a,c,d,e,g,f,l,n){var q=c.data,p=c.elementSize,t=a.boundingSphereRadius;m.pointToLocalFrame(e,
f,d,mb);var u=Math.floor((mb.x-t)/p)-1,z=Math.ceil((mb.x+t)/p)+1,w=Math.floor((mb.y-t)/p)-1,p=Math.ceil((mb.y+t)/p)+1;if(!(0>z||0>p||u>q.length||w>q[0].length)){0>u&&(u=0);0>z&&(z=0);0>w&&(w=0);0>p&&(p=0);u>=q.length&&(u=q.length-1);z>=q.length&&(z=q.length-1);p>=q[0].length&&(p=q[0].length-1);w>=q[0].length&&(w=q[0].length-1);q=[];c.getRectMinMax(u,w,z,p,q);var y=q[0];if(!(mb.z-t>q[1]||mb.z+t<y))for(t=u;t<z;t++)for(u=w;u<p;u++)c.getConvexTrianglePillar(t,u,!1),m.pointToWorldFrame(e,f,c.pillarOffset,
tb),d.distanceTo(tb)<c.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&this.convexConvex(a,c.pillarConvex,d,tb,g,f,l,n,null,null,cd,null),c.getConvexTrianglePillar(t,u,!0),m.pointToWorldFrame(e,f,c.pillarOffset,tb),d.distanceTo(tb)<c.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&this.convexConvex(a,c.pillarConvex,d,tb,g,f,l,n,null,null,cd,null)}};var nb=new d,ob=new d;a.prototype[l.types.SPHERE|l.types.HEIGHTFIELD]=a.prototype.sphereHeightfield=function(a,c,d,e,g,f,l,n){var q=
c.data,p=a.radius,t=c.elementSize;m.pointToLocalFrame(e,f,d,nb);var u=Math.floor((nb.x-p)/t)-1,z=Math.ceil((nb.x+p)/t)+1,w=Math.floor((nb.y-p)/t)-1,t=Math.ceil((nb.y+p)/t)+1;if(!(0>z||0>t||u>q.length||t>q[0].length)){0>u&&(u=0);0>z&&(z=0);0>w&&(w=0);0>t&&(t=0);u>=q.length&&(u=q.length-1);z>=q.length&&(z=q.length-1);t>=q[0].length&&(t=q[0].length-1);w>=q[0].length&&(w=q[0].length-1);q=[];c.getRectMinMax(u,w,z,t,q);var y=q[0];if(!(nb.z-p>q[1]||nb.z+p<y))for(p=this.result;u<z;u++)for(q=w;q<t;q++)if(y=
p.length,c.getConvexTrianglePillar(u,q,!1),m.pointToWorldFrame(e,f,c.pillarOffset,ob),d.distanceTo(ob)<c.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&this.sphereConvex(a,c.pillarConvex,d,ob,g,f,l,n),c.getConvexTrianglePillar(u,q,!0),m.pointToWorldFrame(e,f,c.pillarOffset,ob),d.distanceTo(ob)<c.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&this.sphereConvex(a,c.pillarConvex,d,ob,g,f,l,n),2<p.length-y)return}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,
"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(c,e,l){function a(){g.apply(this);this.dt=-1;this.allowSleep=!1;this.contacts=[];this.frictionEquations=[];this.quatNormalizeSkip=0;this.quatNormalizeFast=!1;this.stepnumber=this.time=0;this.default_dt=1/60;this.nextId=0;this.gravity=new f;this.broadphase=new C;this.bodies=[];this.solver=
new d;this.constraints=[];this.narrowphase=new m(this);this.collisionMatrix=new n;this.collisionMatrixPrevious=new n;this.materials=[];this.contactmaterials=[];this.contactMaterialTable=new t;this.defaultMaterial=new p("default");this.defaultContactMaterial=new u(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0});this.doProfiling=!1;this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0};this.subsystems=[];this.addBodyEvent={type:"addBody",body:null};
this.removeBodyEvent={type:"removeBody",body:null}}e.exports=a;c("../shapes/Shape");var f=c("../math/Vec3");e=c("../math/Quaternion");var d=c("../solver/GSSolver");c("../utils/Vec3Pool");c("../equations/ContactEquation");c("../equations/FrictionEquation");var m=c("./Narrowphase"),g=c("../utils/EventTarget"),n=c("../collision/ArrayCollisionMatrix"),p=c("../material/Material"),u=c("../material/ContactMaterial"),q=c("../objects/Body"),t=c("../utils/TupleDictionary"),y=c("../collision/RaycastResult");
l=c("../collision/AABB");var w=c("../collision/Ray"),C=c("../collision/NaiveBroadphase");a.prototype=new g;new l;var x=new w;a.prototype.getContactMaterial=function(a,c){return this.contactMaterialTable.get(a.id,c.id)};a.prototype.numObjects=function(){return this.bodies.length};a.prototype.collisionMatrixTick=function(){var a=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix;this.collisionMatrix=a;this.collisionMatrix.reset()};a.prototype.add=a.prototype.addBody=function(a){-1===
this.bodies.indexOf(a)&&(a.index=this.bodies.length,this.bodies.push(a),a.world=this,a.initPosition.copy(a.position),a.initVelocity.copy(a.velocity),a.timeLastSleepy=this.time,a instanceof q&&(a.initAngularVelocity.copy(a.angularVelocity),a.initQuaternion.copy(a.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=a,this.dispatchEvent(this.addBodyEvent))};a.prototype.addConstraint=function(a){this.constraints.push(a)};a.prototype.removeConstraint=function(a){a=
this.constraints.indexOf(a);-1!==a&&this.constraints.splice(a,1)};a.prototype.rayTest=function(a,c,d){d instanceof y?this.raycastClosest(a,c,{skipBackfaces:!0},d):this.raycastAll(a,c,{skipBackfaces:!0},d)};a.prototype.raycastAll=function(a,c,d,e){d.mode=w.ALL;d.from=a;d.to=c;d.callback=e;return x.intersectWorld(this,d)};a.prototype.raycastAny=function(a,c,d,e){d.mode=w.ANY;d.from=a;d.to=c;d.result=e;return x.intersectWorld(this,d)};a.prototype.raycastClosest=function(a,c,d,e){d.mode=w.CLOSEST;d.from=
a;d.to=c;d.result=e;return x.intersectWorld(this,d)};a.prototype.remove=function(a){a.world=null;var c=this.bodies.length-1,d=this.bodies,e=d.indexOf(a);if(-1!==e){d.splice(e,1);for(e=0;e!==d.length;e++)d[e].index=e;this.collisionMatrix.setNumObjects(c);this.removeBodyEvent.body=a;this.dispatchEvent(this.removeBodyEvent)}};a.prototype.removeBody=a.prototype.remove;a.prototype.addMaterial=function(a){this.materials.push(a)};a.prototype.addContactMaterial=function(a){this.contactmaterials.push(a);this.contactMaterialTable.set(a.materials[0].id,
a.materials[1].id,a)};"undefined"===typeof performance&&(performance={});if(!performance.now){var B=Date.now();performance.timing&&performance.timing.navigationStart&&(B=performance.timing.navigationStart);performance.now=function(){return Date.now()-B}}var G=new f;a.prototype.step=function(a,c,d){d=d||10;c=c||0;if(0===c)this.internalStep(a),this.time+=a;else{var e=Math.floor((this.time+c)/a)-Math.floor(this.time/a),e=Math.min(e,d);d=performance.now();for(var g=0;g!==e&&!(this.internalStep(a),performance.now()-
d>1E3*a);g++);this.time+=c;a=this.time%a/a;c=this.bodies;for(e=0;e!==c.length;e++)d=c[e],d.type!==q.STATIC&&d.sleepState!==q.SLEEPING?(d.position.vsub(d.previousPosition,G),G.scale(a,G),d.position.vadd(G,d.interpolatedPosition)):(d.interpolatedPosition.copy(d.position),d.interpolatedQuaternion.copy(d.quaternion))}};var E={type:"postStep"},R={type:"preStep"},I={type:"collide",body:null,contact:null},K=[],N=[],D=[],Z=[];new f;new f;new f;new f;new f;new f;new f;new f;new f;new e;var fa=new e,ja=new e,
ga=new f;a.prototype.internalStep=function(a){this.dt=a;var c=this.contacts,d=this.numObjects(),e=this.bodies,g=this.solver,f=this.gravity,l=this.doProfiling,m=this.profile,n=q.DYNAMIC,p,t=this.constraints;f.norm();var u=f.x,w=f.y,y=f.z;l&&(p=performance.now());for(f=0;f!==d;f++){var x=e[f];if(x.type&n){var B=x.force,x=x.mass;B.x+=x*u;B.y+=x*w;B.z+=x*y}}f=0;for(x=this.subsystems.length;f!==x;f++)this.subsystems[f].update();l&&(p=performance.now());D.length=0;Z.length=0;this.broadphase.collisionPairs(this,
D,Z);l&&(m.broadphase=performance.now()-p);x=t.length;for(f=0;f!==x;f++)if(u=t[f],!u.collideConnected)for(w=D.length-1;0<=w;--w)if(u.bodyA===D[w]&&u.bodyB===Z[w]||u.bodyB===D[w]&&u.bodyA===Z[w])D.splice(w,1),Z.splice(w,1);this.collisionMatrixTick();l&&(p=performance.now());x=c.length;for(f=0;f!==x;f++)K.push(c[f]);c.length=0;x=this.frictionEquations.length;for(f=0;f!==x;f++)N.push(this.frictionEquations[f]);this.frictionEquations.length=0;this.narrowphase.getContacts(D,Z,this,c,K,this.frictionEquations,
N);l&&(m.narrowphase=performance.now()-p);l&&(p=performance.now());for(f=0;f<this.frictionEquations.length;f++)g.addEquation(this.frictionEquations[f]);f=c.length;for(w=0;w!==f;w++)u=c[w],x=u.bi,y=u.bj,x.material&&y.material&&this.getContactMaterial(x.material,y.material),x.material&&y.material&&0<=x.material.restitution&&0<=y.material.restitution&&(u.restitution=x.material.restitution*y.material.restitution),g.addEquation(u),x.allowSleep&&x.type===q.DYNAMIC&&x.sleepState===q.SLEEPING&&y.sleepState===
q.AWAKE&&y.type!==q.STATIC&&y.velocity.norm2()+y.angularVelocity.norm2()>=2*Math.pow(y.sleepSpeedLimit,2)&&(x._wakeUpAfterNarrowphase=!0),y.allowSleep&&y.type===q.DYNAMIC&&y.sleepState===q.SLEEPING&&x.sleepState===q.AWAKE&&x.type!==q.STATIC&&x.velocity.norm2()+x.angularVelocity.norm2()>=2*Math.pow(x.sleepSpeedLimit,2)&&(y._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(x,y,!0),this.collisionMatrixPrevious.get(x,y)||(I.body=y,I.contact=u,x.dispatchEvent(I),I.body=x,y.dispatchEvent(I));l&&(m.makeContactConstraints=
performance.now()-p,p=performance.now());for(f=0;f!==d;f++)x=e[f],x._wakeUpAfterNarrowphase&&(x.wakeUp(),x._wakeUpAfterNarrowphase=!1);x=t.length;for(f=0;f!==x;f++)for(u=t[f],u.update(),w=0,c=u.equations.length;w!==c;w++)g.addEquation(u.equations[w]);g.solve(a,this);l&&(m.solve=performance.now()-p);g.removeAllEquations();g=Math.pow;for(f=0;f!==d;f++)if(x=e[f],x.type&n&&(t=g(1-x.linearDamping,a),c=x.velocity,c.mult(t,c),t=x.angularVelocity))c=g(1-x.angularDamping,a),t.mult(c,t);this.dispatchEvent(R);
for(f=0;f!==d;f++)x=e[f],x.preStep&&x.preStep.call(x);l&&(p=performance.now());n=q.DYNAMIC|q.KINEMATIC;g=0===this.stepnumber%(this.quatNormalizeSkip+1);t=this.quatNormalizeFast;c=.5*a;for(f=0;f!==d;f++)if(x=e[f],u=x.force,w=x.torque,x.type&n&&x.sleepState!==q.SLEEPING){var y=x.velocity,B=x.angularVelocity,C=x.position,G=x.quaternion,Aa=x.invMass,ra=x.invInertiaWorld;y.x+=u.x*Aa*a;y.y+=u.y*Aa*a;y.z+=u.z*Aa*a;x.angularVelocity&&(ra.vmult(w,ga),ga.mult(a,ga),ga.vadd(B,B));C.x+=y.x*a;C.y+=y.y*a;C.z+=
y.z*a;x.angularVelocity&&(fa.set(B.x,B.y,B.z,0),fa.mult(G,ja),G.x+=c*ja.x,G.y+=c*ja.y,G.z+=c*ja.z,G.w+=c*ja.w,g&&(t?G.normalizeFast():G.normalize()));x.aabb&&(x.aabbNeedsUpdate=!0);x.updateInertiaWorld&&x.updateInertiaWorld()}this.clearForces();this.broadphase.dirty=!0;l&&(m.integrate=performance.now()-p);this.time+=a;this.stepnumber+=1;this.dispatchEvent(E);for(f=0;f!==d;f++)x=e[f],(a=x.postStep)&&a.call(x);if(this.allowSleep)for(f=0;f!==d;f++)e[f].sleepTick(this.time)};a.prototype.clearForces=function(){for(var a=
this.bodies,c=a.length,d=0;d!==c;d++){var e=a[d];e.force.set(0,0,0);e.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,
"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)});CANNON=CANNON||{};var camera,scene,renderer,controls=null,s_oRender;
CANNON.Demo=function(k){function c(){if(E){for(var a in E.__controllers)E.__controllers[a].updateDisplay();for(var c in E.__folders)for(a in E.__folders[c].__controllers)E.__folders[c].__controllers[a].updateDisplay()}}function e(a){function c(a,d){a.material&&(a.material=d);for(var e=0;e<a.children.length;e++)c(a.children[e],d)}if(-1===xa.indexOf(a))throw Error("Render mode "+a+" not found!");switch(a){case "solid":t.currentMaterial=D;qa.intensity=1;Ra.color.setHex(2236962);break;case "wireframe":t.currentMaterial=
Z,qa.intensity=0,Ra.color.setHex(16777215)}for(var d=0;d<B.length;d++)c(B[d],t.currentMaterial);w.rendermode=a}function l(){for(var a=x.length,c=0;c<a;c++){var d=x[c];d.position.copy(d.initPosition);d.velocity.copy(d.initVelocity);d.initAngularVelocity&&(d.angularVelocity.copy(d.initAngularVelocity),d.quaternion.copy(d.initQuaternion))}}function a(a){0===a.x&&(a.x=1E-6);0===a.y&&(a.y=1E-6);0===a.z&&(a.z=1E-6)}function f(){for(var c=x.length,d=0;d<c;d++){var e=x[d],g=B[d];g.position.copy(e.position);
e.quaternion&&g.quaternion.copy(e.quaternion)}ja.restart();if(w.contacts)for(d=0;d<S.contacts.length;d++)for(c=0;2>c;c++){var g=ja.request(),f=S.contacts[d],e=0===c?f.bi:f.bj,k=0===c?f.ri:f.rj;g.position.set(e.position.x+k.x,e.position.y+k.y,e.position.z+k.z)}ja.hideCached();ga.restart();if(w.cm2contact)for(d=0;d<S.contacts.length;d++)for(c=0;2>c;c++)g=ga.request(),f=S.contacts[d],e=0===c?f.bi:f.bj,k=0===c?f.ri:f.rj,g.scale.set(k.x,k.y,k.z),a(g.scale),g.position.copy(e.position);ga.hideCached();z.restart();
V.restart();if(w.constraints){for(d=0;d<S.constraints.length;d++)f=S.constraints[d],f instanceof CANNON.DistanceConstraint&&(e=f.equations.normal,c=e.bi,e=e.bj,g=z.request(),e=e.position?e.position:e,g.scale.set(e.x-c.position.x,e.y-c.position.y,e.z-c.position.z),a(g.scale),g.position.copy(c.position));for(d=0;d<S.constraints.length;d++)if(f=S.constraints[d],f instanceof CANNON.PointToPointConstraint){var k=f.equations.normal,c=k.bi,e=k.bj,g=V.request(),f=V.request(),l=V.request();g.scale.set(k.ri.x,
k.ri.y,k.ri.z);f.scale.set(k.rj.x,k.rj.y,k.rj.z);l.scale.set(-k.penetrationVec.x,-k.penetrationVec.y,-k.penetrationVec.z);a(g.scale);a(f.scale);a(l.scale);g.position.copy(c.position);f.position.copy(e.position);k.bj.position.vadd(k.rj,l.position)}}V.hideCached();z.hideCached();J.restart();if(w.normals)for(d=0;d<S.contacts.length;d++)f=S.contacts[d],c=f.bi,g=J.request(),k=f.ni,e=c,g.scale.set(k.x,k.y,k.z),a(g.scale),g.position.copy(e.position),f.ri.vadd(g.position,g.position);J.hideCached();ea.restart();
if(w.axes)for(c=0;c<x.length;c++)e=x[c],g=ea.request(),g.position.copy(e.position),e.quaternion&&g.quaternion.copy(e.quaternion);ea.hideCached();W.restart();if(w.aabbs)for(d=0;d<x.length;d++)e=x[d],e.computeAABB&&(e.aabbNeedsUpdate&&e.computeAABB(),isFinite(e.aabb.lowerBound.x)&&isFinite(e.aabb.lowerBound.y)&&isFinite(e.aabb.lowerBound.z)&&isFinite(e.aabb.upperBound.x)&&isFinite(e.aabb.upperBound.y)&&isFinite(e.aabb.upperBound.z)&&0!=e.aabb.lowerBound.x-e.aabb.upperBound.x&&0!=e.aabb.lowerBound.y-
e.aabb.upperBound.y&&0!=e.aabb.lowerBound.z-e.aabb.upperBound.z&&(g=W.request(),g.scale.set(e.aabb.lowerBound.x-e.aabb.upperBound.x,e.aabb.lowerBound.y-e.aabb.upperBound.y,e.aabb.lowerBound.z-e.aabb.upperBound.z),g.position.set(.5*(e.aabb.lowerBound.x+e.aabb.upperBound.x),.5*(e.aabb.lowerBound.y+e.aabb.upperBound.y),.5*(e.aabb.lowerBound.z+e.aabb.upperBound.z))));W.hideCached()}function d(){requestAnimationFrame(d);w.paused||f();n();oa.update()}function m(a){mouseX=a.clientX-aa;mouseY=a.clientY-Ba}
function g(a){Na=s_iCanvasResizeWidth+2*s_iCanvasOffsetWidth;Wa=s_iCanvasResizeHeight+2*s_iCanvasOffsetHeight;CAMERA_TEST_TRACKBALL&&(controls.screen.width=Na,controls.screen.height=Wa)}function n(){(CAMERA_TEST_TRACKBALL||CAMERA_TEST_TRANSFORM&&null!==controls)&&controls.update();renderer.clear();renderer.render(t.scene,camera)}function p(a){t.dispatchEvent({type:"destroy"});w.paused=!1;c();u(a)}function u(a){for(var d=B.length,e=0;e<d;e++){S.remove(x.pop());var g=B.pop();t.scene.remove(g)}for(;S.constraints.length;)S.removeConstraint(S.constraints[0]);
G[a]();w.iterations=S.solver.iterations;w.gx=S.gravity.x+0;w.gy=S.gravity.y+0;w.gz=S.gravity.z+0;w.quatNormalizeSkip=S.quatNormalizeSkip;w.quatNormalizeFast=S.quatNormalizeFast;c();ja.restart();ja.hideCached();ga.restart();ga.hideCached();z.restart();z.hideCached();J.restart();J.hideCached()}function q(a){var c=[],d=[];this.request=function(){geo=c.length?c.pop():a();scene.add(geo);d.push(geo);return geo};this.restart=function(){for(;d.length;)c.push(d.pop())};this.hideCached=function(){for(var a=
0;a<c.length;a++)scene.remove(c[a])}}var t=this;this.addScene=function(a,c){if("string"!==typeof a)throw Error("1st argument of Demo.addScene(title,initfunc) must be a string!");if("function"!==typeof c)throw Error("2nd argument of Demo.addScene(title,initfunc) must be a function!");G.push(c);var d=G.length-1;K[a]=function(){p(d)};y.add(K,a)};this.restartCurrentScene=l;this.changeScene=p;this.start=function(){u(0)};var y,w=this.settings={stepFrequency:60,quatNormalizeSkip:2,quatNormalizeFast:!0,gx:0,
gy:0,gz:0,iterations:3,tolerance:1E-4,k:1E6,d:3,scene:0,paused:!1,rendermode:"solid",constraints:!1,contacts:!1,cm2contact:!1,normals:!1,axes:!1,particleSize:.1,shadows:!1,aabbs:!1,profiling:!1,maxSubSteps:3};k=k||{};for(var C in k)C in w&&(w[C]=k[C]);if(0!==w.stepFrequency%60)throw Error("stepFrequency must be a multiple of 60.");var x=this.bodies=[],B=this.visuals=[],G=[],E=null,R=null,I=null,K={},N=new THREE.SphereGeometry(.1,6,6);this.particleGeo=new THREE.SphereGeometry(1,16,8);var D=new THREE.MeshPhongMaterial({color:11184810,
specular:1118481,shininess:50}),Z=new THREE.MeshLambertMaterial({color:16777215,wireframe:!0});this.currentMaterial=D;var fa=new THREE.MeshPhongMaterial({color:16711680});this.particleMaterial=new THREE.MeshLambertMaterial({color:16711680});var ja=new q(function(){return new THREE.Mesh(N,fa)}),ga=new q(function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:16711680}))}),T=new THREE.BoxGeometry(1,
1,1),ca=new THREE.MeshBasicMaterial({color:11184810,wireframe:!0}),W=new q(function(){return new THREE.Mesh(T,ca)}),z=new q(function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:16711680}))}),V=new q(function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:16711680}))}),
J=new q(function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:65280}))}),ea=new q(function(){var a=new THREE.Object3D,c=new THREE.Vector3(0,0,0),d=new THREE.Geometry,e=new THREE.Geometry,g=new THREE.Geometry;d.vertices.push(c);e.vertices.push(c);g.vertices.push(c);d.vertices.push(new THREE.Vector3(1,0,0));e.vertices.push(new THREE.Vector3(0,1,0));g.vertices.push(new THREE.Vector3(0,
0,1));c=new THREE.Line(d,new THREE.LineBasicMaterial({color:16711680}));e=new THREE.Line(e,new THREE.LineBasicMaterial({color:65280}));g=new THREE.Line(g,new THREE.LineBasicMaterial({color:255}));a.add(c);a.add(e);a.add(g);return a}),S=this.world=new CANNON.World;S.broadphase=new CANNON.NaiveBroadphase;var xa=["solid","wireframe"],qa,Ra,oa,O;Detector.webgl||Detector.addGetWebGLMessage();var Na=s_iCanvasResizeWidth+s_iCanvasOffsetWidth,Wa=s_iCanvasResizeHeight+s_iCanvasOffsetHeight,db,aa=Na/2,Ba=Wa/
2;(function(){db=document.createElement("div");document.body.appendChild(db);CAMERA_TEST_TRACKBALL?(NEAR=1,camera=new THREE.PerspectiveCamera(45,Na/Wa,NEAR,FAR),camera.lookAt(new THREE.Vector3(CAMERA_TEST_LOOK_AT.x,CAMERA_TEST_LOOK_AT.y,CAMERA_TEST_LOOK_AT.z)),camera.position.set(0,500,500),camera.up.set(0,0,1)):camera=createOrthoGraphicCamera();scene=t.scene=new THREE.Scene;scene.fog=new THREE.Fog(8306926,.5*FAR,FAR);Ra=new THREE.AmbientLight(4473924);scene.add(Ra);qa=new THREE.DirectionalLight(16777181,
1);qa.position.set(180,0,180);qa.target.position.set(0,0,0);qa.castShadow=!0;qa.shadow.camera.near=10;qa.shadow.camera.far=100;qa.shadow.camera.fov=FOV;qa.shadowMapBias=.0139;qa.shadowMapDarkness=.1;qa.shadow.mapSize.width=1024;qa.shadow.mapSize.height=1024;new THREE.CameraHelper(qa.shadow.camera);scene.add(qa);scene.add(camera);renderer=SHOW_3D_RENDER?new THREE.WebGLRenderer({clearColor:0,clearAlpha:.5,antialias:!0,alpha:!0}):new THREE.CanvasRenderer({clearColor:0,clearAlpha:.5,antialias:!1,alpha:!0});
renderer.setSize(Na,Wa);renderer.domElement.style.position="relative";renderer.domElement.style.top="0px";renderer.domElement.style.opacity=CANVAS_3D_OPACITY;db.appendChild(renderer.domElement);O=document.createElement("div");O.style.position="absolute";O.style.top="10px";O.style.width="100%";O.style.textAlign="center";O.innerHTML='<a href="http://github.com/schteppe/cannon.js">cannon.js</a> - javascript 3d physics';db.appendChild(O);document.addEventListener("mousemove",m);window.addEventListener("resize",
g);renderer.setClearColor(scene.fog.color,1);renderer.autoClear=!1;I=document.createElement("canvas");I.width=Na;I.height=Wa;I.style.opacity=.5;I.style.position="absolute";I.style.top="0px";I.style.zIndex=90;db.appendChild(I);R=new SmoothieChart({labelOffsetY:50,maxDataSetLength:100,millisPerPixel:2,grid:{strokeStyle:"none",fillStyle:"none",lineWidth:1,millisPerLine:250,verticalSections:6},labels:{fillStyle:"rgb(180, 180, 180)"}});R.streamTo(I);var a={},c=[[255,0,0],[0,255,0],[0,0,255],[255,255,0],
[255,0,255],[0,255,255]],d=0,f;for(f in S.profile){var k=c[d%c.length];a[f]=new TimeSeries({label:f,fillStyle:"rgb("+k[0]+","+k[1]+","+k[2]+")",maxDataLength:500});d++}S.addEventListener("postStep",function(c){for(var d in S.profile)a[d].append(1E3*S.time,S.profile[d])});d=0;for(f in S.profile)k=c[d%c.length],R.addTimeSeries(a[f],{strokeStyle:"rgb("+k[0]+","+k[1]+","+k[2]+")",lineWidth:2}),d++;S.doProfiling=!1;R.stop();I.style.display="none";oa=new Stats;oa.domElement.style.position="absolute";oa.domElement.style.top=
"0px";oa.domElement.style.zIndex=100;db.appendChild(oa.domElement);void 0!=window.dat&&(E=new dat.GUI,E.domElement.parentNode.style.zIndex=120,c=E.addFolder("Rendering"),c.add(w,"rendermode",{Solid:"solid",Wireframe:"wireframe"}).onChange(function(a){e(a)}),c.add(w,"contacts"),c.add(w,"cm2contact"),c.add(w,"normals"),c.add(w,"constraints"),c.add(w,"axes"),c.add(w,"particleSize").min(0).max(1).onChange(function(a){for(var c=0;c<B.length;c++)x[c]instanceof CANNON.Particle&&B[c].scale.set(a,a,a)}),c.add(w,
"shadows").onChange(function(a){a?renderer.shadowMapAutoUpdate=!0:(renderer.shadowMapAutoUpdate=!1,renderer.clearTarget(qa.shadowMap))}),c.add(w,"aabbs"),c.add(w,"profiling").onChange(function(a){a?(S.doProfiling=!0,R.start(),I.style.display="block"):(S.doProfiling=!1,R.stop(),I.style.display="none")}),c=E.addFolder("World"),c.add(w,"paused").onChange(function(a){}),c.add(w,"stepFrequency",60,600).step(60),c.add(w,"gx",-100,100).onChange(function(a){isNaN(a)||S.gravity.set(a,w.gy,w.gz)}),c.add(w,
"gy",-100,100).onChange(function(a){isNaN(a)||S.gravity.set(w.gx,a,w.gz)}),c.add(w,"gz",-100,100).onChange(function(a){isNaN(a)||S.gravity.set(w.gx,w.gy,a)}),c.add(w,"quatNormalizeSkip",0,50).step(1).onChange(function(a){isNaN(a)||(S.quatNormalizeSkip=a)}),c.add(w,"quatNormalizeFast").onChange(function(a){S.quatNormalizeFast=!!a}),c=E.addFolder("Solver"),c.add(w,"iterations",1,50).step(1).onChange(function(a){S.solver.iterations=a}),c.add(w,"k",10,1E7).onChange(function(a){t.setGlobalSpookParams(w.k,
w.d,1/w.stepFrequency)}),c.add(w,"d",0,20).step(.1).onChange(function(a){t.setGlobalSpookParams(w.k,w.d,1/w.stepFrequency)}),c.add(w,"tolerance",0,10).step(.01).onChange(function(a){S.solver.tolerance=a}),y=E.addFolder("Scenes"),y.open());CAMERA_TEST_TRACKBALL&&(controls=new THREE.TrackballControls(camera,renderer.domElement),controls.rotateSpeed=1,controls.zoomSpeed=1.2,controls.panSpeed=.2,controls.noZoom=!1,controls.noPan=!1,controls.staticMoving=!1,controls.dynamicDampingFactor=.3,controls.minDistance=
0,controls.maxDistance=1E5,controls.keys=[65,83,68],controls.screen.width=Na,controls.screen.height=Wa)})();d();s_oRender=n;document.addEventListener("keypress",function(a){if(a.keyCode)switch(a.keyCode){case 32:l();break;case 104:"none"==oa.domElement.style.display?(oa.domElement.style.display="block",O.style.display="block"):(oa.domElement.style.display="none",O.style.display="none");break;case 97:w.aabbs=!w.aabbs;c();break;case 99:w.constraints=!w.constraints;c();break;case 112:w.paused=!w.paused;
c();break;case 115:S.step(1/w.stepFrequency);f();break;case 109:a=xa.indexOf(w.rendermode);a++;a%=xa.length;e(xa[a]);c();break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:G.length>a.keyCode-49&&!document.activeElement.localName.match(/input/)&&p(a.keyCode-49)}})};CANNON.Demo.prototype=new CANNON.EventTarget;CANNON.Demo.constructor=CANNON.Demo;
CANNON.Demo.prototype.setGlobalSpookParams=function(k,c,e){for(var l=this.world,a=0;a<l.constraints.length;a++)for(var f=l.constraints[a],d=0;d<f.equations.length;d++)f.equations[d].setSpookParams(k,c,e);for(a=0;a<l.contactmaterials.length;a++)e=l.contactmaterials[a],e.contactEquationStiffness=k,e.frictionEquationStiffness=k,e.contactEquationRelaxation=c,e.frictionEquationRelaxation=c;l.defaultContactMaterial.contactEquationStiffness=k;l.defaultContactMaterial.frictionEquationStiffness=k;l.defaultContactMaterial.contactEquationRelaxation=
c;l.defaultContactMaterial.frictionEquationRelaxation=c};
CANNON.Demo.prototype.createTransformControl=function(k,c){controls=new THREE.TransformControls(camera,renderer.domElement);scene.add(k);controls.attach(k,c);scene.add(controls);console.log("CREATE");window.addEventListener("keydown",function(c){switch(c.keyCode){case 81:controls.setSpace("local"===controls.space?"world":"local");break;case 17:controls.setTranslationSnap(100);controls.setRotationSnap(THREE.Math.degToRad(15));break;case 87:controls.setMode("translate");break;case 69:controls.setMode("rotate");
break;case 82:controls.setMode("scale");break;case 187:case 107:controls.setSize(controls.size+.1);break;case 189:case 109:controls.setSize(Math.max(controls.size-.1,.1))}});window.addEventListener("keyup",function(c){switch(c.keyCode){case 17:controls.setTranslationSnap(null),controls.setRotationSnap(null)}})};CANNON.Demo.prototype.getWorld=function(){return this.world};
CANNON.Demo.prototype.addVisual=function(k,c){var e;k instanceof CANNON.Body&&(e=this.shape2mesh(k,c));e&&(this.bodies.push(k),this.visuals.push(e),k.visualref=e,k.visualref.visualId=this.bodies.length-1,this.scene.add(e));return e};CANNON.Demo.prototype.addVisuals=function(k){for(var c=0;c<k.length;c++)this.addVisual(k[c])};
CANNON.Demo.prototype.removeVisual=function(k){if(k.visualref){for(var c=this.bodies,e=this.visuals,l=[],a=[],f=c.length,d=0;d<f;d++)l.unshift(c.pop()),a.unshift(e.pop());for(var f=k.visualref.visualId,m=0;m<l.length;m++)m!==f&&(d=m>f?m-1:m,c[d]=l[m],e[d]=a[m],c[d].visualref=l[m].visualref,c[d].visualref.visualId=d);k.visualref.visualId=null;this.scene.remove(k.visualref);k.visualref=null}};CANNON.Demo.prototype.removeAllVisuals=function(){for(;this.bodies.length;)this.removeVisual(this.bodies[0])};
CANNON.Demo.prototype.shape2mesh=function(k,c){for(var e=new THREE.Object3D,l=0;l<k.shapes.length;l++){var a=k.shapes[l];switch(a.type){case CANNON.Shape.types.SPHERE:var f=new THREE.SphereGeometry(a.radius,8,8),a=void 0===c?new THREE.Mesh(f,this.currentMaterial):new THREE.Mesh(f,c);a.castShadow=!0;break;case CANNON.Shape.types.PARTICLE:a=new THREE.Mesh(this.particleGeo,this.particleMaterial);f=this.settings;a.scale.set(f.particleSize,f.particleSize,f.particleSize);break;case CANNON.Shape.types.PLANE:var d=
new THREE.PlaneGeometry(10,10,4,4),a=new THREE.Object3D,f=new THREE.Object3D,d=void 0===c?new THREE.Mesh(d,this.currentMaterial):new THREE.Mesh(d,c);d.scale.set(100,100,100);f.add(d);d.castShadow=!1;d.receiveShadow=!0;a.add(f);break;case CANNON.Shape.types.BOX:f=new THREE.BoxGeometry(2*a.halfExtents.x,2*a.halfExtents.y,2*a.halfExtents.z);a=void 0===c?new THREE.Mesh(f,this.currentMaterial):new THREE.Mesh(f,c);break;case CANNON.Shape.types.CONVEXPOLYHEDRON:d=new THREE.Geometry;for(f=0;f<a.vertices.length;f++){var m=
a.vertices[f];d.vertices.push(new THREE.Vector3(m.x,m.y,m.z))}for(f=0;f<a.faces.length;f++)for(var g=a.faces[f],n=g[0],m=1;m<g.length-1;m++)d.faces.push(new THREE.Face3(n,g[m],g[m+1]));d.computeBoundingSphere();d.computeFaceNormals();a=void 0===c?new THREE.Mesh(d,this.currentMaterial):new THREE.Mesh(d,c);break;case CANNON.Shape.types.HEIGHTFIELD:for(var d=new THREE.Geometry,g=new CANNON.Vec3,n=new CANNON.Vec3,p=new CANNON.Vec3,m=0;m<a.data.length-1;m++)for(var u=0;u<a.data[m].length-1;u++)for(var q=
0;2>q;q++)a.getConvexTrianglePillar(m,u,0===q),g.copy(a.pillarConvex.vertices[0]),n.copy(a.pillarConvex.vertices[1]),p.copy(a.pillarConvex.vertices[2]),g.vadd(a.pillarOffset,g),n.vadd(a.pillarOffset,n),p.vadd(a.pillarOffset,p),d.vertices.push(new THREE.Vector3(g.x,g.y,g.z),new THREE.Vector3(n.x,n.y,n.z),new THREE.Vector3(p.x,p.y,p.z)),f=d.vertices.length-3,d.faces.push(new THREE.Face3(f,f+1,f+2));d.computeBoundingSphere();d.computeFaceNormals();a=void 0===c?new THREE.Mesh(d,this.currentMaterial):
new THREE.Mesh(d,c);break;case CANNON.Shape.types.TRIMESH:d=new THREE.Geometry;g=new CANNON.Vec3;n=new CANNON.Vec3;p=new CANNON.Vec3;for(f=0;f<a.indices.length/3;f++)a.getTriangleVertices(f,g,n,p),d.vertices.push(new THREE.Vector3(g.x,g.y,g.z),new THREE.Vector3(n.x,n.y,n.z),new THREE.Vector3(p.x,p.y,p.z)),m=d.vertices.length-3,d.faces.push(new THREE.Face3(m,m+1,m+2));d.computeBoundingSphere();d.computeFaceNormals();a=void 0===c?new THREE.Mesh(d,this.currentMaterial):new THREE.Mesh(d,c);break;default:throw"Visual type not recognized: "+
a.type;}a.receiveShadow=!0;a.castShadow=!0;if(a.children)for(f=0;f<a.children.length;f++)if(a.children[f].castShadow=!0,a.children[f].receiveShadow=!0,a.children[f])for(m=0;m<a.children[f].length;m++)a.children[f].children[m].castShadow=!0,a.children[f].children[m].receiveShadow=!0;f=k.shapeOffsets[l];d=k.shapeOrientations[l];a.position.set(f.x,f.y,f.z);a.quaternion.set(d.x,d.y,d.z,d.w);e.add(a)}this.camera=function(){return camera};this.getScene=function(){return scene};return e};
function CBall(k,c,e,l,a){var f,d,m,g,n,p=null,u=FOV*BALL_RADIUS,q=0,t=0;this._init=function(a,c,e){n=new createjs.Container;d.addChild(n);var k=new createjs.SpriteSheet({images:[e],frames:{width:e.width/7,height:e.height,regX:e.width/2/7,regY:e.height/2}});f=createSprite(k,0,e.width/2/7,e.height/2,e.width/7,e.height/2);f.stop();this.scale(u);e=s_oSpriteLibrary.getSprite("ball_shadow");g=createBitmap(e);g.x=a;g.y=c;g.regX=.5*e.width;g.regY=.5*e.height;this.scaleShadow(u);n.addChild(g,f)};this.rolls=
function(){f.rotation=Math.degrees(Math.sin(-(.15*m.velocity.x)));var a=Math.abs(m.angularVelocity.x),c=this._goToPrevFrame;0>m.angularVelocity.x&&(c=this._goToNextFrame);7<a?c():3<a?(q++,q>2/ROLL_BALL_RATE&&(c(),q=0)):1<a?(q++,q>3/ROLL_BALL_RATE&&(c(),q=0)):a>MIN_BALL_VEL_ROTATION&&(q++,q>4/ROLL_BALL_RATE&&(c(),q=0))};this._goToPrevFrame=function(){0===t?t=6:t--;f.gotoAndStop(t)};this._goToNextFrame=function(){7===t?t=1:t++;f.gotoAndStop(t)};this.unload=function(){f.removeAllEventListeners();d.removeChild(f)};
this.setVisible=function(a){n.visible=a};this.getStartScale=function(){return u};this.startPosShadowY=function(a){p=a};this.getStartShadowYPos=function(){return p};this.fadeAnimation=function(a,c,d){this.tweenFade(a,c,d)};this.tweenFade=function(a,c,d){createjs.Tween.get(n,{override:!0}).wait(d).to({alpha:a},c).call(function(){})};this.setPositionShadow=function(a,c){g.x=a;g.y=c};this.setPosition=function(a,c){f.x=a;f.y=c};this.getPhysics=function(){return m};this.setAngle=function(a){f.rotation=
a};this.getX=function(){return f.x};this.getY=function(){return f.y};this.getStartScale=function(){return u};this.scale=function(a){f.scaleX=a;f.scaleY=a};this.scaleShadow=function(a){.08<a?(g.scaleX=a,g.scaleY=a):(g.scaleX=.08,g.scaleY=.08)};this.setAlphaByHeight=function(a){g.alpha=a};this.getScale=function(){return f.scaleX};this.getObject=function(){return n};this.getDepthPos=function(){return m.position.y};m=l;d=a;this._init(k,c,e);return this}
function CScenario(){var k,c,e,l,a,f,d,m,g,n,p,u,q,t,y,w;if(SHOW_3D_RENDER)var C=new CANNON.Demo;this.getDemo=function(){return C};this._init=function(){k=SHOW_3D_RENDER?C.getWorld():new CANNON.World;k.gravity.set(0,0,-9.81);k.broadphase=new CANNON.NaiveBroadphase;k.solver.iterations=50;k.solver.tolerance=1E-5;c=new CANNON.Material;e=new CANNON.Material;l=new CANNON.Material;var a=new CANNON.ContactMaterial(e,l,{friction:.1,restitution:.01}),d=new CANNON.ContactMaterial(e,c,{friction:.2,restitution:.3});
k.addContactMaterial(a);k.addContactMaterial(d);s_oScenario._createBallBody();s_oScenario._createFieldBody();s_oScenario._createGoal();s_oScenario.createBackGoalWall();SHOW_AREAS_GOAL?s_oScenario.createAreasGoal():s_oScenario.createAreaGoal(GOAL_LINE_POS,BACK_WALL_GOAL_SIZE,COLOR_AREA_GOAL[0],null)};this.createAreasGoal=function(){for(var a=0,c=FIRST_AREA_GOAL_POS.x,d=FIRST_AREA_GOAL_POS.z,e=0;e<NUM_AREA_GOAL.h;e++){for(var g=0;g<NUM_AREA_GOAL.w;g++)s_oScenario.createAreaGoal({x:c,y:FIRST_AREA_GOAL_POS.y,
z:d},AREA_GOAL_PROPERTIES,COLOR_AREA_GOAL[a],AREAS_INFO[a]),c+=2*AREA_GOAL_PROPERTIES.width,a++;c=FIRST_AREA_GOAL_POS.x;d-=2*AREA_GOAL_PROPERTIES.height}};this._createFieldBody=function(){m=new CANNON.Plane;g=new CANNON.Body({mass:0,material:c});g.addShape(m);g.position.z=-9;g.addEventListener("collide",function(a){s_oScenario.fieldCollision()});k.addBody(g);if(SHOW_3D_RENDER){var a=new THREE.MeshPhongMaterial({color:5803568,specular:1118481,shininess:10});C.addVisual(g,a)}};this._createGoal=function(){n=
new CANNON.Cylinder(POLE_RIGHT_LEFT_SIZE.radius_top,POLE_RIGHT_LEFT_SIZE.radius_bottom,POLE_RIGHT_LEFT_SIZE.height,POLE_RIGHT_LEFT_SIZE.segments);u=new CANNON.Body({mass:0});p=new CANNON.Cylinder(POLE_UP_SIZE.radius_top,POLE_UP_SIZE.radius_bottom,POLE_UP_SIZE.height,POLE_UP_SIZE.segments);var a=new CANNON.Quaternion;a.setFromAxisAngle(new CANNON.Vec3(0,1,0),Math.PI/2);p.transformAllPoints(new CANNON.Vec3,a);u.addShape(n,new CANNON.Vec3(.5*POLE_UP_SIZE.height,0,0));u.addShape(n,new CANNON.Vec3(.5*
-POLE_UP_SIZE.height,0,0));u.addShape(p,new CANNON.Vec3(0,0,.5*POLE_RIGHT_LEFT_SIZE.height));u.position.set(BACK_WALL_GOAL_POSITION.x,BACK_WALL_GOAL_POSITION.y-UP_WALL_GOAL_SIZE.depth,BACK_WALL_GOAL_POSITION.z);u.addEventListener("collide",function(a){s_oScenario.poleCollision()});k.addBody(u);SHOW_3D_RENDER&&(a=new THREE.MeshPhongMaterial({color:16777215,specular:1118481,shininess:50}),C.addVisual(u,a))};this.createBackGoalWall=function(){q=new CANNON.Box(new CANNON.Vec3(BACK_WALL_GOAL_SIZE.width,
BACK_WALL_GOAL_SIZE.depth,BACK_WALL_GOAL_SIZE.height));t=new CANNON.Box(new CANNON.Vec3(LEFT_RIGHT_WALL_GOAL_SIZE.width,LEFT_RIGHT_WALL_GOAL_SIZE.depth,LEFT_RIGHT_WALL_GOAL_SIZE.height));y=new CANNON.Box(new CANNON.Vec3(UP_WALL_GOAL_SIZE.width,UP_WALL_GOAL_SIZE.depth,UP_WALL_GOAL_SIZE.height));w=new CANNON.Body({mass:0,material:l});w.addShape(q);w.addShape(t,new CANNON.Vec3(BACK_WALL_GOAL_SIZE.width,0,0));w.addShape(t,new CANNON.Vec3(-BACK_WALL_GOAL_SIZE.width,0,0));w.addShape(y,new CANNON.Vec3(0,
0,BACK_WALL_GOAL_SIZE.height));w.position.set(BACK_WALL_GOAL_POSITION.x,BACK_WALL_GOAL_POSITION.y,BACK_WALL_GOAL_POSITION.z);k.addBody(w);SHOW_3D_RENDER&&C.addVisual(w)};this.createAreaGoal=function(a,c,d,e){c=new CANNON.Box(new CANNON.Vec3(c.width,c.depth,c.height));e=new CANNON.Body({mass:0,userData:e});e.addShape(c);e.position.set(a.x,a.y,a.z);e.collisionResponse=0;e.addEventListener("collide",function(a){s_oScenario.lineGoalCollision(a)});k.addBody(e);SHOW_3D_RENDER&&(a=new THREE.MeshPhongMaterial({color:d,
specular:1118481,shininess:70}),C.addVisual(e,a));return e};this._createBallBody=function(){a=new CANNON.Sphere(BALL_RADIUS);f=new CANNON.Body({mass:BALL_MASS,material:e,linearDamping:BALL_LINEAR_DAMPING,angularDamping:2*BALL_LINEAR_DAMPING});var c=new CANNON.Vec3(POSITION_BALL.x,POSITION_BALL.y,POSITION_BALL.z);f.position.copy(c);f.addShape(a);k.add(f);SHOW_3D_RENDER&&(c=new THREE.MeshPhongMaterial({color:16777215,specular:1118481,shininess:70}),d=C.addVisual(f,c))};this.addImpulse=function(a,c){var d=
new CANNON.Vec3(0,0,BALL_RADIUS),e=new CANNON.Vec3(c.x,c.y,c.z);a.applyImpulse(e,d)};this.addForce=function(a,c){var d=new CANNON.Vec3(0,0,0),e=new CANNON.Vec3(c.x,c.y,c.z);a.applyForce(e,d)};this.getBodyVelocity=function(a){return a.velocity};this.ballBody=function(){return f};this.ballMesh=function(){return d};this.getCamera=function(){return C.camera()};this.fieldCollision=function(){s_oGame.fieldCollision();s_oGame.ballFadeForReset()};this.setElementAngularVelocity=function(a,c){a.angularVelocity.set(c.x,
c.y,c.z)};this.setElementVelocity=function(a,c){var d=new CANNON.Vec3(c.x,c.y,c.z);a.velocity=d};this.setElementLinearDamping=function(a,c){a.linearDamping=c};this.getFieldBody=function(){return g};this.lineGoalCollision=function(a){s_oGame.areaGoal(a.contact.bj.userData)};this.update=function(){k.step(PHYSICS_STEP)};this.getGoalBody=function(){return u};this.poleCollision=function(){s_oGame.poleCollide()};this.destroyWorld=function(){for(var a=k.bodies,c=0;c<a.length;c++)k.remove(a[c]);k=null};s_oScenario=
this;SHOW_3D_RENDER?(C.addScene("Test",this._init),C.start()):this._init()}var s_oScenario;
(function(k,c){"object"===typeof exports&&"undefined"!==typeof module?c(exports):"function"===typeof define&&define.amd?define(["exports"],c):c(k.THREE=k.THREE||{})})(this,function(k){function c(){}function e(b,h){this.x=b||0;this.y=h||0}function l(b,h,a,v,c,d,g,f,da,m){Object.defineProperty(this,"id",{value:je++});this.uuid=k.Math.generateUUID();this.sourceFile=this.name="";this.image=void 0!==b?b:l.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==h?h:l.DEFAULT_MAPPING;this.wrapS=void 0!==a?a:
1001;this.wrapT=void 0!==v?v:1001;this.magFilter=void 0!==c?c:1006;this.minFilter=void 0!==d?d:1008;this.anisotropy=void 0!==da?da:1;this.format=void 0!==g?g:1023;this.type=void 0!==f?f:1009;this.offset=new e(0,0);this.repeat=new e(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==m?m:3E3;this.version=0;this.onUpdate=null}function a(b,h,a,v){this.x=b||0;this.y=h||0;this.z=a||0;this.w=void 0!==v?v:1}function f(b,h,r){this.uuid=k.Math.generateUUID();
this.width=b;this.height=h;this.scissor=new a(0,0,b,h);this.scissorTest=!1;this.viewport=new a(0,0,b,h);r=r||{};void 0===r.minFilter&&(r.minFilter=1006);this.texture=new l(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding);this.depthBuffer=void 0!==r.depthBuffer?r.depthBuffer:!0;this.stencilBuffer=void 0!==r.stencilBuffer?r.stencilBuffer:!0;this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function d(b,h,a){f.call(this,b,h,a);this.activeMipMapLevel=
this.activeCubeFace=0}function m(b,h,a,v){this._x=b||0;this._y=h||0;this._z=a||0;this._w=void 0!==v?v:1}function g(b,h,a){this.x=b||0;this.y=h||0;this.z=a||0}function n(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function p(b,h,a,v,c,d,e,g,f,k){b=void 0!==b?b:[];l.call(this,b,void 0!==h?h:301,a,v,c,d,e,g,f,k);this.flipY=!1}function u(b,h,a){var r=b[0];if(0>=r||
0<r)return b;var c=h*a,d=ke[c];void 0===d&&(d=new Float32Array(c),ke[c]=d);if(0!==h)for(r.toArray(d,0),r=1,c=0;r!==h;++r)c+=a,b[r].toArray(d,c);return d}function q(b,h){var a=le[h];void 0===a&&(a=new Int32Array(h),le[h]=a);for(var c=0;c!==h;++c)a[c]=b.allocTextureUnit();return a}function t(b,h){b.uniform1f(this.addr,h)}function y(b,h){b.uniform1i(this.addr,h)}function w(b,h){void 0===h.x?b.uniform2fv(this.addr,h):b.uniform2f(this.addr,h.x,h.y)}function C(b,h){void 0!==h.x?b.uniform3f(this.addr,h.x,
h.y,h.z):void 0!==h.r?b.uniform3f(this.addr,h.r,h.g,h.b):b.uniform3fv(this.addr,h)}function x(b,h){void 0===h.x?b.uniform4fv(this.addr,h):b.uniform4f(this.addr,h.x,h.y,h.z,h.w)}function B(b,h){b.uniformMatrix2fv(this.addr,!1,h.elements||h)}function G(b,h){b.uniformMatrix3fv(this.addr,!1,h.elements||h)}function E(b,h){b.uniformMatrix4fv(this.addr,!1,h.elements||h)}function R(b,h,a){var r=a.allocTextureUnit();b.uniform1i(this.addr,r);a.setTexture2D(h||me,r)}function I(b,h,a){var r=a.allocTextureUnit();
b.uniform1i(this.addr,r);a.setTextureCube(h||ne,r)}function K(b,h){b.uniform2iv(this.addr,h)}function N(b,h){b.uniform3iv(this.addr,h)}function D(b,h){b.uniform4iv(this.addr,h)}function Z(b){switch(b){case 5126:return t;case 35664:return w;case 35665:return C;case 35666:return x;case 35674:return B;case 35675:return G;case 35676:return E;case 35678:return R;case 35680:return I;case 5124:case 35670:return y;case 35667:case 35671:return K;case 35668:case 35672:return N;case 35669:case 35673:return D}}
function fa(b,h){b.uniform1fv(this.addr,h)}function ja(b,h){b.uniform1iv(this.addr,h)}function ga(b,h){b.uniform2fv(this.addr,u(h,this.size,2))}function T(b,h){b.uniform3fv(this.addr,u(h,this.size,3))}function ca(b,h){b.uniform4fv(this.addr,u(h,this.size,4))}function W(b,h){b.uniformMatrix2fv(this.addr,!1,u(h,this.size,4))}function z(b,h){b.uniformMatrix3fv(this.addr,!1,u(h,this.size,9))}function V(b,h){b.uniformMatrix4fv(this.addr,!1,u(h,this.size,16))}function J(b,h,a){var r=h.length,c=q(a,r);b.uniform1iv(this.addr,
c);for(b=0;b!==r;++b)a.setTexture2D(h[b]||me,c[b])}function ea(b,h,a){var r=h.length,c=q(a,r);b.uniform1iv(this.addr,c);for(b=0;b!==r;++b)a.setTextureCube(h[b]||ne,c[b])}function S(b){switch(b){case 5126:return fa;case 35664:return ga;case 35665:return T;case 35666:return ca;case 35674:return W;case 35675:return z;case 35676:return V;case 35678:return J;case 35680:return ea;case 5124:case 35670:return ja;case 35667:case 35671:return K;case 35668:case 35672:return N;case 35669:case 35673:return D}}
function xa(b,h,a){this.id=b;this.addr=a;this.setValue=Z(h.type)}function qa(b,h,a){this.id=b;this.addr=a;this.size=h.size;this.setValue=S(h.type)}function Ra(b){this.id=b;this.seq=[];this.map={}}function oa(b,h,a){this.seq=[];this.map={};this.renderer=a;a=b.getProgramParameter(h,b.ACTIVE_UNIFORMS);for(var r=0;r!==a;++r){var c=b.getActiveUniform(h,r),d=b.getUniformLocation(h,c.name),e=this,g=c.name,f=g.length;for(Gd.lastIndex=0;;){var k=Gd.exec(g),l=Gd.lastIndex,m=k[1],n=k[3];"]"===k[2]&&(m|=0);if(void 0===
n||"["===n&&l+2===f){g=e;c=void 0===n?new xa(m,c,d):new qa(m,c,d);g.seq.push(c);g.map[c.id]=c;break}else n=e.map[m],void 0===n&&(n=new Ra(m),m=e,e=n,m.seq.push(e),m.map[e.id]=e),e=n}}}function O(b,h,a){return void 0===h&&void 0===a?this.set(b):this.setRGB(b,h,a)}function Na(b,h){this.min=void 0!==b?b:new e(Infinity,Infinity);this.max=void 0!==h?h:new e(-Infinity,-Infinity)}function Wa(b,h){var a,c,d,f,M,k,l,m,n,q,p=b.context,t=b.state,u,Ka,z,w,pa;this.render=function(r,v,A){if(0!==h.length){r=new g;
var F=A.w/A.z,Q=.5*A.z,da=.5*A.w,U=16/A.w,Ea=new e(U*F,U),na=new g(1,1,0),ta=new e(1,1),bb=new Na;bb.min.set(0,0);bb.max.set(A.z-16,A.w-16);if(void 0===z){var U=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),Y=new Uint16Array([0,1,2,0,2,3]);u=p.createBuffer();Ka=p.createBuffer();p.bindBuffer(p.ARRAY_BUFFER,u);p.bufferData(p.ARRAY_BUFFER,U,p.STATIC_DRAW);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,Ka);p.bufferData(p.ELEMENT_ARRAY_BUFFER,Y,p.STATIC_DRAW);w=p.createTexture();pa=p.createTexture();t.bindTexture(p.TEXTURE_2D,
w);p.texImage2D(p.TEXTURE_2D,0,p.RGB,16,16,0,p.RGB,p.UNSIGNED_BYTE,null);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST);t.bindTexture(p.TEXTURE_2D,pa);p.texImage2D(p.TEXTURE_2D,0,p.RGBA,16,16,0,p.RGBA,p.UNSIGNED_BYTE,null);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,
p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST);var U={vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},Y=p.createProgram(),L=p.createShader(p.FRAGMENT_SHADER),
x=p.createShader(p.VERTEX_SHADER),pb="precision "+b.getPrecision()+" float;\n";p.shaderSource(L,pb+U.fragmentShader);p.shaderSource(x,pb+U.vertexShader);p.compileShader(L);p.compileShader(x);p.attachShader(Y,L);p.attachShader(Y,x);p.linkProgram(Y);z=Y;n=p.getAttribLocation(z,"position");q=p.getAttribLocation(z,"uv");a=p.getUniformLocation(z,"renderType");c=p.getUniformLocation(z,"map");d=p.getUniformLocation(z,"occlusionMap");f=p.getUniformLocation(z,"opacity");M=p.getUniformLocation(z,"color");k=
p.getUniformLocation(z,"scale");l=p.getUniformLocation(z,"rotation");m=p.getUniformLocation(z,"screenPosition")}p.useProgram(z);t.initAttributes();t.enableAttribute(n);t.enableAttribute(q);t.disableUnusedAttributes();p.uniform1i(d,0);p.uniform1i(c,1);p.bindBuffer(p.ARRAY_BUFFER,u);p.vertexAttribPointer(n,2,p.FLOAT,!1,16,0);p.vertexAttribPointer(q,2,p.FLOAT,!1,16,8);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,Ka);t.disable(p.CULL_FACE);t.setDepthWrite(!1);Y=0;for(L=h.length;Y<L;Y++)if(U=16/A.w,Ea.set(U*F,
U),x=h[Y],r.set(x.matrixWorld.elements[12],x.matrixWorld.elements[13],x.matrixWorld.elements[14]),r.applyMatrix4(v.matrixWorldInverse),r.applyProjection(v.projectionMatrix),na.copy(r),ta.x=A.x+na.x*Q+Q-8,ta.y=A.y+na.y*da+da-8,!0===bb.containsPoint(ta)){t.activeTexture(p.TEXTURE0);t.bindTexture(p.TEXTURE_2D,null);t.activeTexture(p.TEXTURE1);t.bindTexture(p.TEXTURE_2D,w);p.copyTexImage2D(p.TEXTURE_2D,0,p.RGB,ta.x,ta.y,16,16,0);p.uniform1i(a,0);p.uniform2f(k,Ea.x,Ea.y);p.uniform3f(m,na.x,na.y,na.z);
t.disable(p.BLEND);t.enable(p.DEPTH_TEST);p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0);t.activeTexture(p.TEXTURE0);t.bindTexture(p.TEXTURE_2D,pa);p.copyTexImage2D(p.TEXTURE_2D,0,p.RGBA,ta.x,ta.y,16,16,0);p.uniform1i(a,1);t.disable(p.DEPTH_TEST);t.activeTexture(p.TEXTURE1);t.bindTexture(p.TEXTURE_2D,w);p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0);x.positionScreen.copy(na);x.customUpdateCallback?x.customUpdateCallback(x):x.updateLensFlares();p.uniform1i(a,2);t.enable(p.BLEND);for(var pb=0,ub=
x.lensFlares.length;pb<ub;pb++){var y=x.lensFlares[pb];.001<y.opacity&&.001<y.scale&&(na.x=y.x,na.y=y.y,na.z=y.z,U=y.size*y.scale/A.w,Ea.x=U*F,Ea.y=U,p.uniform3f(m,na.x,na.y,na.z),p.uniform2f(k,Ea.x,Ea.y),p.uniform1f(l,y.rotation),p.uniform1f(f,y.opacity),p.uniform3f(M,y.color.r,y.color.g,y.color.b),t.setBlending(y.blending,y.blendEquation,y.blendSrc,y.blendDst),b.setTexture2D(y.texture,1),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0))}}t.enable(p.CULL_FACE);t.enable(p.DEPTH_TEST);t.setDepthWrite(!0);
b.resetGLState()}}}function db(b,h){function a(b,h){return b.renderOrder!==h.renderOrder?b.renderOrder-h.renderOrder:b.z!==h.z?h.z-b.z:h.id-b.id}var c,d,e,f,k,da,n,p,q,t,u,Y,Ka,z,w,pa,x,L=b.context,y=b.state,D,ib,Fa,C,B=new g,J=new m,G=new g;this.render=function(r,v){if(0!==h.length){if(void 0===Fa){var A=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),g=new Uint16Array([0,1,2,0,2,3]);D=L.createBuffer();ib=L.createBuffer();L.bindBuffer(L.ARRAY_BUFFER,D);L.bufferData(L.ARRAY_BUFFER,
A,L.STATIC_DRAW);L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,ib);L.bufferData(L.ELEMENT_ARRAY_BUFFER,g,L.STATIC_DRAW);var A=L.createProgram(),g=L.createShader(L.VERTEX_SHADER),F=L.createShader(L.FRAGMENT_SHADER);L.shaderSource(g,["precision "+b.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));
L.shaderSource(F,["precision "+b.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));
L.compileShader(g);L.compileShader(F);L.attachShader(A,g);L.attachShader(A,F);L.linkProgram(A);Fa=A;pa=L.getAttribLocation(Fa,"position");x=L.getAttribLocation(Fa,"uv");c=L.getUniformLocation(Fa,"uvOffset");d=L.getUniformLocation(Fa,"uvScale");e=L.getUniformLocation(Fa,"rotation");f=L.getUniformLocation(Fa,"scale");k=L.getUniformLocation(Fa,"color");da=L.getUniformLocation(Fa,"map");n=L.getUniformLocation(Fa,"opacity");p=L.getUniformLocation(Fa,"modelViewMatrix");q=L.getUniformLocation(Fa,"projectionMatrix");
t=L.getUniformLocation(Fa,"fogType");u=L.getUniformLocation(Fa,"fogDensity");Y=L.getUniformLocation(Fa,"fogNear");Ka=L.getUniformLocation(Fa,"fogFar");z=L.getUniformLocation(Fa,"fogColor");w=L.getUniformLocation(Fa,"alphaTest");A=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");A.width=8;A.height=8;g=A.getContext("2d");g.fillStyle="white";g.fillRect(0,0,8,8);C=new l(A);C.needsUpdate=!0}L.useProgram(Fa);y.initAttributes();y.enableAttribute(pa);y.enableAttribute(x);y.disableUnusedAttributes();
y.disable(L.CULL_FACE);y.enable(L.BLEND);L.bindBuffer(L.ARRAY_BUFFER,D);L.vertexAttribPointer(pa,2,L.FLOAT,!1,16,0);L.vertexAttribPointer(x,2,L.FLOAT,!1,16,8);L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,ib);L.uniformMatrix4fv(q,!1,v.projectionMatrix.elements);y.activeTexture(L.TEXTURE0);L.uniform1i(da,0);g=A=0;(F=r.fog)?(L.uniform3f(z,F.color.r,F.color.g,F.color.b),F&&F.isFog?(L.uniform1f(Y,F.near),L.uniform1f(Ka,F.far),L.uniform1i(t,1),g=A=1):F&&F.isFogExp2&&(L.uniform1f(u,F.density),L.uniform1i(t,2),g=
A=2)):(L.uniform1i(t,0),g=A=0);for(var F=0,M=h.length;F<M;F++){var Q=h[F];Q.modelViewMatrix.multiplyMatrices(v.matrixWorldInverse,Q.matrixWorld);Q.z=-Q.modelViewMatrix.elements[14]}h.sort(a);for(var m=[],F=0,M=h.length;F<M;F++){var Q=h[F],U=Q.material;!1!==U.visible&&(L.uniform1f(w,U.alphaTest),L.uniformMatrix4fv(p,!1,Q.modelViewMatrix.elements),Q.matrixWorld.decompose(B,J,G),m[0]=G.x,m[1]=G.y,Q=0,r.fog&&U.fog&&(Q=g),A!==Q&&(L.uniform1i(t,Q),A=Q),null!==U.map?(L.uniform2f(c,U.map.offset.x,U.map.offset.y),
L.uniform2f(d,U.map.repeat.x,U.map.repeat.y)):(L.uniform2f(c,0,0),L.uniform2f(d,1,1)),L.uniform1f(n,U.opacity),L.uniform3f(k,U.color.r,U.color.g,U.color.b),L.uniform1f(e,U.rotation),L.uniform2fv(f,m),y.setBlending(U.blending,U.blendEquation,U.blendSrc,U.blendDst),y.setDepthTest(U.depthTest),y.setDepthWrite(U.depthWrite),U.map?b.setTexture2D(U.map,0):b.setTexture2D(C,0),L.drawElements(L.TRIANGLES,6,L.UNSIGNED_SHORT,0))}y.enable(L.CULL_FACE);b.resetGLState()}}}function aa(){Object.defineProperty(this,
"id",{value:oe++});this.uuid=k.Math.generateUUID();this.name="";this.type="Material";this.lights=this.fog=!0;this.blending=1;this.side=0;this.shading=2;this.vertexColors=0;this.opacity=1;this.transparent=!1;this.blendSrc=204;this.blendDst=205;this.blendEquation=100;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.depthFunc=3;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=!1;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.alphaTest=
this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.premultipliedAlpha=!1;this.overdraw=0;this._needsUpdate=this.visible=!0}function Ba(b){aa.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=
this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;void 0!==b&&(void 0!==b.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(b))}function Aa(b){aa.call(this);this.type="MeshDepthMaterial";this.depthPacking=3200;this.morphTargets=this.skinning=
!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.setValues(b)}function ra(b,h){this.min=void 0!==b?b:new g(Infinity,Infinity,Infinity);this.max=void 0!==h?h:new g(-Infinity,-Infinity,-Infinity)}function Oa(b,h){this.center=void 0!==b?b:new g;this.radius=void 0!==h?h:0}function La(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}
function Ma(b,h){this.normal=void 0!==b?b:new g(1,0,0);this.constant=void 0!==h?h:0}function yb(b,h,a,c,d,e){this.planes=[void 0!==b?b:new Ma,void 0!==h?h:new Ma,void 0!==a?a:new Ma,void 0!==c?c:new Ma,void 0!==d?d:new Ma,void 0!==e?e:new Ma]}function ad(b,h,r,c){function v(h,a,r,c){var v=h.geometry,d;d=z;var e=h.customDepthMaterial;r&&(d=w,e=h.customDistanceMaterial);e?d=e:(e=!1,a.morphTargets&&(v&&v.isBufferGeometry?e=v.morphAttributes&&v.morphAttributes.position&&0<v.morphAttributes.position.length:
v&&v.isGeometry&&(e=v.morphTargets&&0<v.morphTargets.length)),h=h.isSkinnedMesh&&a.skinning,v=0,e&&(v|=1),h&&(v|=2),d=d[v]);b.localClippingEnabled&&!0===a.clipShadows&&0!==a.clippingPlanes.length&&(v=d.uuid,e=a.uuid,h=pa[v],void 0===h&&(h={},pa[v]=h),v=h[e],void 0===v&&(v=d.clone(),h[e]=v),d=v);d.visible=a.visible;d.wireframe=a.wireframe;e=a.side;J.renderSingleSided&&2==e&&(e=0);J.renderReverseSided&&(0===e?e=1:1===e&&(e=0));d.side=e;d.clipShadows=a.clipShadows;d.clippingPlanes=a.clippingPlanes;d.wireframeLinewidth=
a.wireframeLinewidth;d.linewidth=a.linewidth;r&&void 0!==d.uniforms.lightPos&&d.uniforms.lightPos.value.copy(c);return d}function d(b,h,a){if(!1!==b.visible){0!==(b.layers.mask&h.layers.mask)&&(b.isMesh||b.isLine||b.isPoints)&&b.castShadow&&(!1===b.frustumCulled||!0===l.intersectsObject(b))&&!0===b.material.visible&&(b.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,b.matrixWorld),Ka.push(b));b=b.children;for(var r=0,c=b.length;r<c;r++)d(b[r],h,a)}}var M=b.context,Q=b.state,l=new yb,m=new n,
p=h.shadows,q=new e,t=new e(c.maxTextureSize,c.maxTextureSize),u=new g,Y=new g,Ka=[],z=Array(4),w=Array(4),pa={},x=[new g(1,0,0),new g(-1,0,0),new g(0,0,1),new g(0,0,-1),new g(0,1,0),new g(0,-1,0)],L=[new g(0,1,0),new g(0,1,0),new g(0,1,0),new g(0,1,0),new g(0,0,1),new g(0,0,-1)],y=[new a,new a,new a,new a,new a,new a];h=new Aa;h.depthPacking=3201;h.clipping=!0;c=Xb.distanceRGBA;for(var D=k.UniformsUtils.clone(c.uniforms),ib=0;4!==ib;++ib){var Fa=0!==(ib&1),C=0!==(ib&2),B=h.clone();B.morphTargets=
Fa;B.skinning=C;z[ib]=B;Fa=new Ba({defines:{USE_SHADOWMAP:""},uniforms:D,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,morphTargets:Fa,skinning:C,clipping:!0});w[ib]=Fa}var J=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=1;this.renderSingleSided=this.renderReverseSided=!0;this.render=function(h,a){if(!1!==J.enabled&&(!1!==J.autoUpdate||!1!==J.needsUpdate)&&0!==p.length){Q.clearColor(1,1,1,1);Q.disable(M.BLEND);Q.setDepthTest(!0);Q.setScissorTest(!1);for(var c,
e,A=0,g=p.length;A<g;A++){var F=p[A],k=F.shadow;if(void 0===k)console.warn("THREE.WebGLShadowMap:",F,"has no shadow.");else{var da=k.camera;q.copy(k.mapSize);q.min(t);if(F&&F.isPointLight){c=6;e=!0;var n=q.x,U=q.y;y[0].set(2*n,U,n,U);y[1].set(0,U,n,U);y[2].set(3*n,U,n,U);y[3].set(n,U,n,U);y[4].set(3*n,0,n,U);y[5].set(n,0,n,U);q.x*=4;q.y*=2}else c=1,e=!1;null===k.map&&(k.map=new f(q.x,q.y,{minFilter:1003,magFilter:1003,format:1023}),da.updateProjectionMatrix());k&&k.isSpotLightShadow&&k.update(F);
n=k.map;k=k.matrix;Y.setFromMatrixPosition(F.matrixWorld);da.position.copy(Y);b.setRenderTarget(n);b.clear();for(n=0;n<c;n++){e?(u.copy(da.position),u.add(x[n]),da.up.copy(L[n]),da.lookAt(u),Q.viewport(y[n])):(u.setFromMatrixPosition(F.target.matrixWorld),da.lookAt(u));da.updateMatrixWorld();da.matrixWorldInverse.getInverse(da.matrixWorld);k.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);k.multiply(da.projectionMatrix);k.multiply(da.matrixWorldInverse);m.multiplyMatrices(da.projectionMatrix,da.matrixWorldInverse);
l.setFromMatrix(m);Ka.length=0;d(h,a,da);for(var U=0,Ea=Ka.length;U<Ea;U++){var na=Ka[U],pa=r.update(na),ta=na.material;if(ta&&ta.isMultiMaterial)for(var bb=pa.groups,ta=ta.materials,z=0,w=bb.length;z<w;z++){var pb=bb[z],ub=ta[pb.materialIndex];!0===ub.visible&&(ub=v(na,ub,e,Y),b.renderBufferDirect(da,null,pa,ub,na,pb))}else ub=v(na,ta,e,Y),b.renderBufferDirect(da,null,pa,ub,na,null)}}}}c=b.getClearColor();e=b.getClearAlpha();b.setClearColor(c,e);J.needsUpdate=!1}}}function fb(b,h){this.origin=void 0!==
b?b:new g;this.direction=void 0!==h?h:new g}function gb(b,h,a,c){this._x=b||0;this._y=h||0;this._z=a||0;this._order=c||gb.DefaultOrder}function Tb(){this.mask=1}function X(){Object.defineProperty(this,"id",{value:pe++});this.uuid=k.Math.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=X.DefaultUp.clone();var b=new g,h=new gb,a=new m,c=new g(1,1,1);h.onChange(function(){a.setFromEuler(h,!1)});a.onChange(function(){h.setFromQuaternion(a,void 0,!1)});Object.defineProperties(this,
{position:{enumerable:!0,value:b},rotation:{enumerable:!0,value:h},quaternion:{enumerable:!0,value:a},scale:{enumerable:!0,value:c},modelViewMatrix:{value:new n},normalMatrix:{value:new La}});this.matrix=new n;this.matrixWorld=new n;this.matrixAutoUpdate=X.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new Tb;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={};this.onBeforeRender=null}function lb(b,h){this.start=void 0!==
b?b:new g;this.end=void 0!==h?h:new g}function Qa(b,h,a){this.a=void 0!==b?b:new g;this.b=void 0!==h?h:new g;this.c=void 0!==a?a:new g}function sa(b,h,a,c,d,e){this.a=b;this.b=h;this.c=a;this.normal=c&&c.isVector3?c:new g;this.vertexNormals=Array.isArray(c)?c:[];this.color=d&&d.isColor?d:new O;this.vertexColors=Array.isArray(d)?d:[];this.materialIndex=void 0!==e?e:0}function Pa(b){aa.call(this);this.type="MeshBasicMaterial";this.color=new O(16777215);this.aoMap=this.map=null;this.aoMapIntensity=1;
this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.lights=this.morphTargets=this.skinning=!1;this.setValues(b)}function P(b,h,a){if(Array.isArray(b))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=k.Math.generateUUID();this.array=b;this.itemSize=h;this.count=void 0!==b?b.length/h:0;this.normalized=!0===
a;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0}function bd(b,h){return new P(new Uint16Array(b),h)}function Wb(b,h){return new P(new Uint32Array(b),h)}function Ja(b,h){return new P(new Float32Array(b),h)}function ha(){Object.defineProperty(this,"id",{value:dd++});this.uuid=k.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=
[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function wc(){Object.defineProperty(this,"id",{value:dd++});this.uuid=k.Math.generateUUID();this.name="";this.type="DirectGeometry";this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=
[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function ia(){Object.defineProperty(this,"id",{value:dd++});this.uuid=k.Math.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity}}function Da(b,h){X.call(this);this.type=
"Mesh";this.geometry=void 0!==b?b:new ia;this.material=void 0!==h?h:new Pa({color:16777215*Math.random()});this.drawMode=0;this.updateMorphTargets()}function hb(b,h,a,c,d,e){function r(b,h,a,r,c,d,e,A,f,M,Q){var da=d/f,U=e/M,Ea=d/2,na=e/2,pa=A/2;e=f+1;for(var ta=M+1,bb=d=0,Y=new g,Ka=0;Ka<ta;Ka++)for(var z=Ka*U-na,L=0;L<e;L++)Y[b]=(L*da-Ea)*r,Y[h]=z*c,Y[a]=pa,k[n]=Y.x,k[n+1]=Y.y,k[n+2]=Y.z,Y[b]=0,Y[h]=0,Y[a]=0<A?1:-1,l[n]=Y.x,l[n+1]=Y.y,l[n+2]=Y.z,m[p]=L/f,m[p+1]=1-Ka/M,n+=3,p+=2,d+=1;for(Ka=0;Ka<
M;Ka++)for(L=0;L<f;L++)b=t+L+e*(Ka+1),h=t+(L+1)+e*(Ka+1),a=t+(L+1)+e*Ka,F[q]=t+L+e*Ka,F[q+1]=b,F[q+2]=a,F[q+3]=b,F[q+4]=h,F[q+5]=a,q+=6,bb+=6;v.addGroup(u,bb,Q);u+=bb;t+=d}ia.call(this);this.type="BoxBufferGeometry";this.parameters={width:b,height:h,depth:a,widthSegments:c,heightSegments:d,depthSegments:e};var v=this;c=Math.floor(c)||1;d=Math.floor(d)||1;e=Math.floor(e)||1;var A=0+(c+1)*(d+1)*2+(c+1)*(e+1)*2+(e+1)*(d+1)*2,f=6*(0+c*d*2+c*e*2+e*d*2),F=new (65535<f?Uint32Array:Uint16Array)(f),k=new Float32Array(3*
A),l=new Float32Array(3*A),m=new Float32Array(2*A),n=0,p=0,q=0,t=0,u=0;r("z","y","x",-1,-1,a,h,b,e,d,0);r("z","y","x",1,-1,a,h,-b,e,d,1);r("x","z","y",1,1,b,a,h,c,e,2);r("x","z","y",1,-1,b,a,-h,c,e,3);r("x","y","z",1,-1,b,h,a,c,d,4);r("x","y","z",-1,-1,b,h,-a,c,d,5);this.setIndex(new P(F,1));this.addAttribute("position",new P(k,3));this.addAttribute("normal",new P(l,3));this.addAttribute("uv",new P(m,2))}function ab(b,h,a,c){ia.call(this);this.type="PlaneBufferGeometry";this.parameters={width:b,height:h,
widthSegments:a,heightSegments:c};var r=b/2,v=h/2;a=Math.floor(a)||1;c=Math.floor(c)||1;var d=a+1,e=c+1,g=b/a,f=h/c;h=new Float32Array(d*e*3);b=new Float32Array(d*e*3);for(var k=new Float32Array(d*e*2),l=0,m=0,n=0;n<e;n++)for(var p=n*f-v,q=0;q<d;q++)h[l]=q*g-r,h[l+1]=-p,b[l+2]=1,k[m]=q/a,k[m+1]=1-n/c,l+=3,m+=2;l=0;r=new (65535<h.length/3?Uint32Array:Uint16Array)(a*c*6);for(n=0;n<c;n++)for(q=0;q<a;q++)v=q+d*(n+1),e=q+1+d*(n+1),g=q+1+d*n,r[l]=q+d*n,r[l+1]=v,r[l+2]=g,r[l+3]=v,r[l+4]=e,r[l+5]=g,l+=6;
this.setIndex(new P(r,1));this.addAttribute("position",new P(h,3));this.addAttribute("normal",new P(b,3));this.addAttribute("uv",new P(k,2))}function za(){X.call(this);this.type="Camera";this.matrixWorldInverse=new n;this.projectionMatrix=new n}function Sa(b,h,a,c){za.call(this);this.type="PerspectiveCamera";this.fov=void 0!==b?b:50;this.zoom=1;this.near=void 0!==a?a:.1;this.far=void 0!==c?c:2E3;this.focus=10;this.aspect=void 0!==h?h:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()}
function eb(b,h,a,c,d,e){za.call(this);this.type="OrthographicCamera";this.zoom=1;this.view=null;this.left=b;this.right=h;this.top=a;this.bottom=c;this.near=void 0!==d?d:.1;this.far=void 0!==e?e:2E3;this.updateProjectionMatrix()}function mb(b,h,a){var r,c,d;return{setMode:function(b){r=b},setIndex:function(a){a.array instanceof Uint32Array&&h.get("OES_element_index_uint")?(c=b.UNSIGNED_INT,d=4):(c=b.UNSIGNED_SHORT,d=2)},render:function(h,v){b.drawElements(r,v,c,h*d);a.calls++;a.vertices+=v;r===b.TRIANGLES&&
(a.faces+=v/3)},renderInstances:function(v,e,A){var g=h.get("ANGLE_instanced_arrays");null===g?console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):(g.drawElementsInstancedANGLE(r,A,c,e*d,v.maxInstancedCount),a.calls++,a.vertices+=A*v.maxInstancedCount,r===b.TRIANGLES&&(a.faces+=v.maxInstancedCount*A/3))}}}function tb(b,h,a){var r;return{setMode:function(b){r=b},render:function(h,c){b.drawArrays(r,h,c);a.calls++;
a.vertices+=c;r===b.TRIANGLES&&(a.faces+=c/3)},renderInstances:function(c){var v=h.get("ANGLE_instanced_arrays");if(null===v)console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{var d=c.attributes.position,d=d&&d.isInterleavedBufferAttribute?d.data.count:d.count;v.drawArraysInstancedANGLE(r,0,d,c.maxInstancedCount);a.calls++;a.vertices+=d*c.maxInstancedCount;r===b.TRIANGLES&&(a.faces+=c.maxInstancedCount*
d/3)}}}}function cd(){var b={};return{get:function(h){if(void 0!==b[h.id])return b[h.id];var a;switch(h.type){case "DirectionalLight":a={direction:new g,color:new O,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new e};break;case "SpotLight":a={position:new g,direction:new g,color:new O,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new e};break;case "PointLight":a={position:new g,color:new O,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,
shadowMapSize:new e};break;case "HemisphereLight":a={direction:new g,skyColor:new O,groundColor:new O}}return b[h.id]=a}}}function nb(b){b=b.split("\n");for(var h=0;h<b.length;h++)b[h]=h+1+": "+b[h];return b.join("\n")}function ob(b,h,a){var r=b.createShader(h);b.shaderSource(r,a);b.compileShader(r);!1===b.getShaderParameter(r,b.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");""!==b.getShaderInfoLog(r)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",h===b.VERTEX_SHADER?
"vertex":"fragment",b.getShaderInfoLog(r),nb(a));return r}function ge(b){switch(b){case 3E3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+b);}}function Cd(b,h){var a=ge(h);return"vec4 "+b+"( vec4 value ) { return "+
a[0]+"ToLinear"+a[1]+"; }"}function Ae(b,h){var a=ge(h);return"vec4 "+b+"( vec4 value ) { return LinearTo"+a[0]+a[1]+"; }"}function Be(b,h){var a;switch(h){case 1:a="Linear";break;case 2:a="Reinhard";break;case 3:a="Uncharted2";break;case 4:a="OptimizedCineon";break;default:throw Error("unsupported toneMapping: "+h);}return"vec3 "+b+"( vec3 color ) { return "+a+"ToneMapping( color ); }"}function Ce(b,h,a){b=b||{};return[b.derivatives||h.envMapCubeUV||h.bumpMap||h.normalMap||h.flatShading?"#extension GL_OES_standard_derivatives : enable":
"",(b.fragDepth||h.logarithmicDepthBuffer)&&a.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",b.drawBuffers&&a.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(b.shaderTextureLOD||h.envMap)&&a.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(uc).join("\n")}function De(b){var h=[],a;for(a in b){var c=b[a];!1!==c&&h.push("#define "+a+" "+c)}return h.join("\n")}function uc(b){return""!==b}function he(b,h){return b.replace(/NUM_DIR_LIGHTS/g,
h.numDirLights).replace(/NUM_SPOT_LIGHTS/g,h.numSpotLights).replace(/NUM_POINT_LIGHTS/g,h.numPointLights).replace(/NUM_HEMI_LIGHTS/g,h.numHemiLights)}function Dd(b){return b.replace(/#include +<([\w\d.]+)>/g,function(b,a){var h=ua[a];if(void 0===h)throw Error("Can not resolve #include <"+a+">");return Dd(h)})}function ie(b){return b.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(b,a,c,d){b="";for(a=parseInt(a);a<parseInt(c);a++)b+=d.replace(/\[ i \]/g,"[ "+
a+" ]");return b})}function Ee(b,h,a,c){var r=b.context,d=a.extensions,v=a.defines,e=a.__webglShader.vertexShader,g=a.__webglShader.fragmentShader,f="SHADOWMAP_TYPE_BASIC";1===c.shadowMapType?f="SHADOWMAP_TYPE_PCF":2===c.shadowMapType&&(f="SHADOWMAP_TYPE_PCF_SOFT");var k="ENVMAP_TYPE_CUBE",l="ENVMAP_MODE_REFLECTION",n="ENVMAP_BLENDING_MULTIPLY";if(c.envMap){switch(a.envMap.mapping){case 301:case 302:k="ENVMAP_TYPE_CUBE";break;case 306:case 307:k="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:k="ENVMAP_TYPE_EQUIREC";
break;case 305:k="ENVMAP_TYPE_SPHERE"}switch(a.envMap.mapping){case 302:case 304:l="ENVMAP_MODE_REFRACTION"}switch(a.combine){case 0:n="ENVMAP_BLENDING_MULTIPLY";break;case 1:n="ENVMAP_BLENDING_MIX";break;case 2:n="ENVMAP_BLENDING_ADD"}}var m=0<b.gammaFactor?b.gammaFactor:1,d=Ce(d,c,b.extensions),p=De(v),q=r.createProgram();a.isRawShaderMaterial?(v=[p,"\n"].filter(uc).join("\n"),f=[d,p,"\n"].filter(uc).join("\n")):(v=["precision "+c.precision+" float;","precision "+c.precision+" int;","#define SHADER_NAME "+
a.__webglShader.name,p,c.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+m,"#define MAX_BONES "+c.maxBones,c.map?"#define USE_MAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+l:"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.displacementMap&&c.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",c.specularMap?"#define USE_SPECULARMAP":
"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.vertexColors?"#define USE_COLOR":"",c.flatShading?"#define FLAT_SHADED":"",c.skinning?"#define USE_SKINNING":"",c.useVertexTexture?"#define BONE_TEXTURE":"",c.morphTargets?"#define USE_MORPHTARGETS":"",c.morphNormals&&!1===c.flatShading?"#define USE_MORPHNORMALS":"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+
c.numClippingPlanes,c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+f:"",c.sizeAttenuation?"#define USE_SIZEATTENUATION":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&b.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;",
"attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;",
"\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(uc).join("\n"),f=[d,"precision "+c.precision+" float;","precision "+c.precision+" int;","#define SHADER_NAME "+a.__webglShader.name,p,c.alphaTest?"#define ALPHATEST "+c.alphaTest:"","#define GAMMA_FACTOR "+m,c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp?"#define FOG_EXP2":"",c.map?"#define USE_MAP":
"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+k:"",c.envMap?"#define "+l:"",c.envMap?"#define "+n:"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.vertexColors?"#define USE_COLOR":
"",c.flatShading?"#define FLAT_SHADED":"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+c.numClippingPlanes,c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+f:"",c.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",c.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&b.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":
"",c.envMap&&b.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0!==c.toneMapping?"#define TONE_MAPPING":"",0!==c.toneMapping?ua.tonemapping_pars_fragment:"",0!==c.toneMapping?Be("toneMapping",c.toneMapping):"",c.outputEncoding||c.mapEncoding||c.envMapEncoding||c.emissiveMapEncoding?ua.encodings_pars_fragment:"",c.mapEncoding?Cd("mapTexelToLinear",c.mapEncoding):"",c.envMapEncoding?Cd("envMapTexelToLinear",c.envMapEncoding):
"",c.emissiveMapEncoding?Cd("emissiveMapTexelToLinear",c.emissiveMapEncoding):"",c.outputEncoding?Ae("linearToOutputTexel",c.outputEncoding):"",c.depthPacking?"#define DEPTH_PACKING "+a.depthPacking:"","\n"].filter(uc).join("\n"));e=Dd(e,c);e=he(e,c);g=Dd(g,c);g=he(g,c);a.isShaderMaterial||(e=ie(e),g=ie(g));g=f+g;e=ob(r,r.VERTEX_SHADER,v+e);g=ob(r,r.FRAGMENT_SHADER,g);r.attachShader(q,e);r.attachShader(q,g);void 0!==a.index0AttributeName?r.bindAttribLocation(q,0,a.index0AttributeName):!0===c.morphTargets&&
r.bindAttribLocation(q,0,"position");r.linkProgram(q);c=r.getProgramInfoLog(q);k=r.getShaderInfoLog(e);l=r.getShaderInfoLog(g);m=n=!0;if(!1===r.getProgramParameter(q,r.LINK_STATUS))n=!1,console.error("THREE.WebGLProgram: shader error: ",r.getError(),"gl.VALIDATE_STATUS",r.getProgramParameter(q,r.VALIDATE_STATUS),"gl.getProgramInfoLog",c,k,l);else if(""!==c)console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",c);else if(""===k||""===l)m=!1;m&&(this.diagnostics={runnable:n,material:a,programLog:c,
vertexShader:{log:k,prefix:v},fragmentShader:{log:l,prefix:f}});r.deleteShader(e);r.deleteShader(g);var t;this.getUniforms=function(){void 0===t&&(t=new oa(r,q,b));return t};var u;this.getAttributes=function(){if(void 0===u){for(var b={},h=r.getProgramParameter(q,r.ACTIVE_ATTRIBUTES),a=0;a<h;a++){var c=r.getActiveAttrib(q,a).name;b[c]=r.getAttribLocation(q,c)}u=b}return u};this.destroy=function(){r.deleteProgram(q);this.program=void 0};Object.defineProperties(this,{uniforms:{get:function(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");
return this.getUniforms()}},attributes:{get:function(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.id=Oe++;this.code=h;this.usedTimes=1;this.program=q;this.vertexShader=e;this.fragmentShader=g;return this}function Fe(b,h){function a(b,h){var a;b?b&&b.isTexture?a=b.encoding:b&&b.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),
a=b.texture.encoding):a=3E3;3E3===a&&h&&(a=3007);return a}var c=[],d={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},e="precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap displacementMap specularMap roughnessMap metalnessMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes depthPacking".split(" ");
this.getParameters=function(r,c,v,e,A){var g=d[r.type],f;h.floatVertexTextures&&A&&A.skeleton&&A.skeleton.useVertexTexture?f=1024:(f=Math.floor((h.maxVertexUniforms-20)/4),void 0!==A&&A&&A.isSkinnedMesh&&(f=Math.min(A.skeleton.bones.length,f),f<A.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+A.skeleton.bones.length+", this GPU supports just "+f+" (try OpenGL instead of ANGLE)")));var F=b.getPrecision();null!==r.precision&&(F=h.getMaxPrecision(r.precision),F!==r.precision&&
console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",F,"instead."));var M=b.getCurrentRenderTarget();return{shaderID:g,precision:F,supportsVertexTextures:h.vertexTextures,outputEncoding:a(M?M.texture:null,b.gammaOutput),map:!!r.map,mapEncoding:a(r.map,b.gammaInput),envMap:!!r.envMap,envMapMode:r.envMap&&r.envMap.mapping,envMapEncoding:a(r.envMap,b.gammaInput),envMapCubeUV:!!r.envMap&&(306===r.envMap.mapping||307===r.envMap.mapping),lightMap:!!r.lightMap,aoMap:!!r.aoMap,
emissiveMap:!!r.emissiveMap,emissiveMapEncoding:a(r.emissiveMap,b.gammaInput),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,combine:r.combine,vertexColors:r.vertexColors,fog:!!v,useFog:r.fog,fogExp:v&&v.isFogExp2,flatShading:1===r.shading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:h.logarithmicDepthBuffer,skinning:r.skinning,maxBones:f,useVertexTexture:h.floatVertexTextures&&
A&&A.skeleton&&A.skeleton.useVertexTexture,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:b.maxMorphTargets,maxMorphNormals:b.maxMorphNormals,numDirLights:c.directional.length,numPointLights:c.point.length,numSpotLights:c.spot.length,numHemiLights:c.hemi.length,numClippingPlanes:e,shadowMapEnabled:b.shadowMap.enabled&&A.receiveShadow&&0<c.shadows.length,shadowMapType:b.shadowMap.type,toneMapping:b.toneMapping,physicallyCorrectLights:b.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,
alphaTest:r.alphaTest,doubleSided:2===r.side,flipSided:1===r.side,depthPacking:void 0!==r.depthPacking?r.depthPacking:!1}};this.getProgramCode=function(b,h){var a=[];h.shaderID?a.push(h.shaderID):(a.push(b.fragmentShader),a.push(b.vertexShader));if(void 0!==b.defines)for(var r in b.defines)a.push(r),a.push(b.defines[r]);for(r=0;r<e.length;r++)a.push(h[e[r]]);return a.join()};this.acquireProgram=function(h,a,r){for(var d,v=0,e=c.length;v<e;v++){var A=c[v];if(A.code===r){d=A;++d.usedTimes;break}}void 0===
d&&(d=new Ee(b,r,h,a),c.push(d));return d};this.releaseProgram=function(b){if(0===--b.usedTimes){var h=c.indexOf(b);c[h]=c[c.length-1];c.pop();b.destroy()}};this.programs=c}function Ge(b,h,a){function r(b){var v=b.target;b=d[v.id];null!==b.index&&c(b.index);var e=b.attributes,A;for(A in e)c(e[A]);v.removeEventListener("dispose",r);delete d[v.id];A=h.get(v);A.wireframe&&c(A.wireframe);h["delete"](v);v=h.get(b);v.wireframe&&c(v.wireframe);h["delete"](b);a.memory.geometries--}function c(a){var r;r=a.isInterleavedBufferAttribute?
h.get(a.data).__webglBuffer:h.get(a).__webglBuffer;void 0!==r&&(b.deleteBuffer(r),a.isInterleavedBufferAttribute?h["delete"](a.data):h["delete"](a))}var d={};return{get:function(b){var h=b.geometry;if(void 0!==d[h.id])return d[h.id];h.addEventListener("dispose",r);var c;h.isBufferGeometry?c=h:h.isGeometry&&(void 0===h._bufferGeometry&&(h._bufferGeometry=(new ia).setFromObject(b)),c=h._bufferGeometry);d[h.id]=c;a.memory.geometries++;return c}}}function He(b,h,a){function r(a,r){var c=a.isInterleavedBufferAttribute?
a.data:a,d=h.get(c);void 0===d.__webglBuffer?(d.__webglBuffer=b.createBuffer(),b.bindBuffer(r,d.__webglBuffer),b.bufferData(r,c.array,c.dynamic?b.DYNAMIC_DRAW:b.STATIC_DRAW),d.version=c.version):d.version!==c.version&&(b.bindBuffer(r,d.__webglBuffer),!1===c.dynamic||-1===c.updateRange.count?b.bufferSubData(r,0,c.array):0===c.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):
(b.bufferSubData(r,c.updateRange.offset*c.array.BYTES_PER_ELEMENT,c.array.subarray(c.updateRange.offset,c.updateRange.offset+c.updateRange.count)),c.updateRange.count=0),d.version=c.version)}var c=new Ge(b,h,a);return{getAttributeBuffer:function(b){return b.isInterleavedBufferAttribute?h.get(b.data).__webglBuffer:h.get(b).__webglBuffer},getWireframeAttribute:function(a){var c=h.get(a);if(void 0!==c.wireframe)return c.wireframe;var d=[],v=a.index,e=a.attributes;a=e.position;if(null!==v)for(var v=v.array,
e=0,A=v.length;e<A;e+=3){var g=v[e+0],f=v[e+1],F=v[e+2];d.push(g,f,f,F,F,g)}else for(v=e.position.array,e=0,A=v.length/3-1;e<A;e+=3)g=e+0,f=e+1,F=e+2,d.push(g,f,f,F,F,g);d=new P(new (65535<a.count?Uint32Array:Uint16Array)(d),1);r(d,b.ELEMENT_ARRAY_BUFFER);return c.wireframe=d},update:function(h){var a=c.get(h);h.geometry.isGeometry&&a.updateFromObject(h);h=a.index;var d=a.attributes;null!==h&&r(h,b.ELEMENT_ARRAY_BUFFER);for(var v in d)r(d[v],b.ARRAY_BUFFER);h=a.morphAttributes;for(v in h)for(var d=
h[v],e=0,A=d.length;e<A;e++)r(d[e],b.ARRAY_BUFFER);return a}}}function Ie(b,h,a,c,d,e,g){function r(b,h){if(b.width>h||b.height>h){var a=h/Math.max(b.width,b.height),r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");r.width=Math.floor(b.width*a);r.height=Math.floor(b.height*a);r.getContext("2d").drawImage(b,0,0,b.width,b.height,0,0,r.width,r.height);console.warn("THREE.WebGLRenderer: image is too big ("+b.width+"x"+b.height+"). Resized to "+r.width+"x"+r.height,b);return r}return b}
function v(b){return k.Math.isPowerOfTwo(b.width)&&k.Math.isPowerOfTwo(b.height)}function A(h){return 1003===h||1004===h||1005===h?b.NEAREST:b.LINEAR}function f(h){h=h.target;h.removeEventListener("dispose",f);a:{var a=c.get(h);if(h.image&&a.__image__webglTextureCube)b.deleteTexture(a.__image__webglTextureCube);else{if(void 0===a.__webglInit)break a;b.deleteTexture(a.__webglTexture)}c["delete"](h)}p.textures--}function F(h){h=h.target;h.removeEventListener("dispose",F);var a=c.get(h),r=c.get(h.texture);
if(h){void 0!==r.__webglTexture&&b.deleteTexture(r.__webglTexture);h.depthTexture&&h.depthTexture.dispose();if(h&&h.isWebGLRenderTargetCube)for(r=0;6>r;r++)b.deleteFramebuffer(a.__webglFramebuffer[r]),a.__webglDepthbuffer&&b.deleteRenderbuffer(a.__webglDepthbuffer[r]);else b.deleteFramebuffer(a.__webglFramebuffer),a.__webglDepthbuffer&&b.deleteRenderbuffer(a.__webglDepthbuffer);c["delete"](h.texture);c["delete"](h)}p.textures--}function M(h,A){var g=c.get(h);if(0<h.version&&g.__version!==h.version){var F=
h.image;if(void 0===F)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",h);else if(!1===F.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",h);else{void 0===g.__webglInit&&(g.__webglInit=!0,h.addEventListener("dispose",f),g.__webglTexture=b.createTexture(),p.textures++);a.activeTexture(b.TEXTURE0+A);a.bindTexture(b.TEXTURE_2D,g.__webglTexture);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,h.flipY);b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
h.premultiplyAlpha);b.pixelStorei(b.UNPACK_ALIGNMENT,h.unpackAlignment);var M=r(h.image,d.maxTextureSize);if((1001!==h.wrapS||1001!==h.wrapT||1003!==h.minFilter&&1006!==h.minFilter)&&!1===v(M))if(F=M,F instanceof HTMLImageElement||F instanceof HTMLCanvasElement){var Q=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");Q.width=k.Math.nearestPowerOfTwo(F.width);Q.height=k.Math.nearestPowerOfTwo(F.height);Q.getContext("2d").drawImage(F,0,0,Q.width,Q.height);console.warn("THREE.WebGLRenderer: image is not power of two ("+
F.width+"x"+F.height+"). Resized to "+Q.width+"x"+Q.height,F);M=Q}else M=F;var F=v(M),Q=e(h.format),n=e(h.type);l(b.TEXTURE_2D,h,F);var m=h.mipmaps;if(h&&h.isDepthTexture){m=b.DEPTH_COMPONENT;if(1015===h.type){if(!q)throw Error("Float Depth Texture only supported in WebGL2.0");m=b.DEPTH_COMPONENT32F}else q&&(m=b.DEPTH_COMPONENT16);1027===h.format&&(m=b.DEPTH_STENCIL);a.texImage2D(b.TEXTURE_2D,0,m,M.width,M.height,0,Q,n,null)}else if(h&&h.isDataTexture)if(0<m.length&&F){for(var da=0,U=m.length;da<
U;da++)M=m[da],a.texImage2D(b.TEXTURE_2D,da,Q,M.width,M.height,0,Q,n,M.data);h.generateMipmaps=!1}else a.texImage2D(b.TEXTURE_2D,0,Q,M.width,M.height,0,Q,n,M.data);else if(h&&h.isCompressedTexture)for(da=0,U=m.length;da<U;da++)M=m[da],1023!==h.format&&1022!==h.format?-1<a.getCompressedTextureFormats().indexOf(Q)?a.compressedTexImage2D(b.TEXTURE_2D,da,Q,M.width,M.height,0,M.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):a.texImage2D(b.TEXTURE_2D,
da,Q,M.width,M.height,0,Q,n,M.data);else if(0<m.length&&F){da=0;for(U=m.length;da<U;da++)M=m[da],a.texImage2D(b.TEXTURE_2D,da,Q,Q,n,M);h.generateMipmaps=!1}else a.texImage2D(b.TEXTURE_2D,0,Q,Q,n,M);h.generateMipmaps&&F&&b.generateMipmap(b.TEXTURE_2D);g.__version=h.version;if(h.onUpdate)h.onUpdate(h);return}}a.activeTexture(b.TEXTURE0+A);a.bindTexture(b.TEXTURE_2D,g.__webglTexture)}function l(a,r,v){v?(b.texParameteri(a,b.TEXTURE_WRAP_S,e(r.wrapS)),b.texParameteri(a,b.TEXTURE_WRAP_T,e(r.wrapT)),b.texParameteri(a,
b.TEXTURE_MAG_FILTER,e(r.magFilter)),b.texParameteri(a,b.TEXTURE_MIN_FILTER,e(r.minFilter))):(b.texParameteri(a,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(a,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),1001===r.wrapS&&1001===r.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",r),b.texParameteri(a,b.TEXTURE_MAG_FILTER,A(r.magFilter)),b.texParameteri(a,b.TEXTURE_MIN_FILTER,A(r.minFilter)),1003!==r.minFilter&&
1006!==r.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",r));!(v=h.get("EXT_texture_filter_anisotropic"))||1015===r.type&&null===h.get("OES_texture_float_linear")||1016===r.type&&null===h.get("OES_texture_half_float_linear")||!(1<r.anisotropy||c.get(r).__currentAnisotropy)||(b.texParameterf(a,v.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r.anisotropy,d.getMaxAnisotropy())),c.get(r).__currentAnisotropy=
r.anisotropy)}function n(h,r,d,v){var A=e(r.texture.format),g=e(r.texture.type);a.texImage2D(v,0,A,r.width,r.height,0,A,g,null);b.bindFramebuffer(b.FRAMEBUFFER,h);b.framebufferTexture2D(b.FRAMEBUFFER,d,v,c.get(r.texture).__webglTexture,0);b.bindFramebuffer(b.FRAMEBUFFER,null)}function m(h,a){b.bindRenderbuffer(b.RENDERBUFFER,h);a.depthBuffer&&!a.stencilBuffer?(b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,a.width,a.height),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,
h)):a.depthBuffer&&a.stencilBuffer?(b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_STENCIL,a.width,a.height),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,h)):b.renderbufferStorage(b.RENDERBUFFER,b.RGBA4,a.width,a.height);b.bindRenderbuffer(b.RENDERBUFFER,null)}var p=g.memory,q="undefined"!==typeof WebGL2RenderingContext&&b instanceof WebGL2RenderingContext;this.setTexture2D=M;this.setTextureCube=function(h,A){var g=c.get(h);if(6===h.image.length)if(0<h.version&&
g.__version!==h.version){g.__image__webglTextureCube||(h.addEventListener("dispose",f),g.__image__webglTextureCube=b.createTexture(),p.textures++);a.activeTexture(b.TEXTURE0+A);a.bindTexture(b.TEXTURE_CUBE_MAP,g.__image__webglTextureCube);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,h.flipY);for(var F=h&&h.isCompressedTexture,k=h.image[0]&&h.image[0].isDataTexture,M=[],Q=0;6>Q;Q++)M[Q]=F||k?k?h.image[Q].image:h.image[Q]:r(h.image[Q],d.maxCubemapSize);var m=v(M[0]),n=e(h.format),da=e(h.type);l(b.TEXTURE_CUBE_MAP,
h,m);for(Q=0;6>Q;Q++)if(F)for(var q,U=M[Q].mipmaps,t=0,u=U.length;t<u;t++)q=U[t],1023!==h.format&&1022!==h.format?-1<a.getCompressedTextureFormats().indexOf(n)?a.compressedTexImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Q,t,n,q.width,q.height,0,q.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):a.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Q,t,n,q.width,q.height,0,n,da,q.data);else k?a.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Q,0,n,M[Q].width,
M[Q].height,0,n,da,M[Q].data):a.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Q,0,n,n,da,M[Q]);h.generateMipmaps&&m&&b.generateMipmap(b.TEXTURE_CUBE_MAP);g.__version=h.version;if(h.onUpdate)h.onUpdate(h)}else a.activeTexture(b.TEXTURE0+A),a.bindTexture(b.TEXTURE_CUBE_MAP,g.__image__webglTextureCube)};this.setTextureCubeDynamic=function(h,r){a.activeTexture(b.TEXTURE0+r);a.bindTexture(b.TEXTURE_CUBE_MAP,c.get(h).__webglTexture)};this.setupRenderTarget=function(h){var r=c.get(h),d=c.get(h.texture);h.addEventListener("dispose",
F);d.__webglTexture=b.createTexture();p.textures++;var e=h&&h.isWebGLRenderTargetCube,A=v(h);if(e){r.__webglFramebuffer=[];for(var g=0;6>g;g++)r.__webglFramebuffer[g]=b.createFramebuffer()}else r.__webglFramebuffer=b.createFramebuffer();if(e){a.bindTexture(b.TEXTURE_CUBE_MAP,d.__webglTexture);l(b.TEXTURE_CUBE_MAP,h.texture,A);for(g=0;6>g;g++)n(r.__webglFramebuffer[g],h,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+g);h.texture.generateMipmaps&&A&&b.generateMipmap(b.TEXTURE_CUBE_MAP);a.bindTexture(b.TEXTURE_CUBE_MAP,
null)}else a.bindTexture(b.TEXTURE_2D,d.__webglTexture),l(b.TEXTURE_2D,h.texture,A),n(r.__webglFramebuffer,h,b.COLOR_ATTACHMENT0,b.TEXTURE_2D),h.texture.generateMipmaps&&A&&b.generateMipmap(b.TEXTURE_2D),a.bindTexture(b.TEXTURE_2D,null);if(h.depthBuffer){r=c.get(h);d=h&&h.isWebGLRenderTargetCube;if(h.depthTexture){if(d)throw Error("target.depthTexture not supported in Cube render targets");if(h&&h.isWebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported!");b.bindFramebuffer(b.FRAMEBUFFER,
r.__webglFramebuffer);if(!h.depthTexture||!h.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");c.get(h.depthTexture).__webglTexture&&h.depthTexture.image.width===h.width&&h.depthTexture.image.height===h.height||(h.depthTexture.image.width=h.width,h.depthTexture.image.height=h.height,h.depthTexture.needsUpdate=!0);M(h.depthTexture,0);r=c.get(h.depthTexture).__webglTexture;if(1026===h.depthTexture.format)b.framebufferTexture2D(b.FRAMEBUFFER,
b.DEPTH_ATTACHMENT,b.TEXTURE_2D,r,0);else if(1027===h.depthTexture.format)b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,r,0);else throw Error("Unknown depthTexture format");}else if(d)for(r.__webglDepthbuffer=[],d=0;6>d;d++)b.bindFramebuffer(b.FRAMEBUFFER,r.__webglFramebuffer[d]),r.__webglDepthbuffer[d]=b.createRenderbuffer(),m(r.__webglDepthbuffer[d],h);else b.bindFramebuffer(b.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=b.createRenderbuffer(),m(r.__webglDepthbuffer,
h);b.bindFramebuffer(b.FRAMEBUFFER,null)}};this.updateRenderTargetMipmap=function(h){var r=h.texture;r.generateMipmaps&&v(h)&&1003!==r.minFilter&&1006!==r.minFilter&&(h=h&&h.isWebGLRenderTargetCube?b.TEXTURE_CUBE_MAP:b.TEXTURE_2D,r=c.get(r).__webglTexture,a.bindTexture(h,r),b.generateMipmap(h),a.bindTexture(h,null))}}function Je(){var b={};return{get:function(h){h=h.uuid;var a=b[h];void 0===a&&(a={},b[h]=a);return a},"delete":function(h){delete b[h.uuid]},clear:function(){b={}}}}function Ke(b,h,r){function c(h,
a,r){var c=new Uint8Array(4),d=b.createTexture();b.bindTexture(h,d);b.texParameteri(h,b.TEXTURE_MIN_FILTER,b.NEAREST);b.texParameteri(h,b.TEXTURE_MAG_FILTER,b.NEAREST);for(h=0;h<r;h++)b.texImage2D(a+h,0,b.RGBA,1,1,0,b.RGBA,b.UNSIGNED_BYTE,c);return d}function d(h){!0!==D[h]&&(b.enable(h),D[h]=!0)}function e(h){!1!==D[h]&&(b.disable(h),D[h]=!1)}function g(h,a,c,v,A,g,f,F){if(0!==h){d(b.BLEND);if(h!==B||F!==S)2===h?F?(b.blendEquationSeparate(b.FUNC_ADD,b.FUNC_ADD),b.blendFuncSeparate(b.ONE,b.ONE,b.ONE,
b.ONE)):(b.blendEquation(b.FUNC_ADD),b.blendFunc(b.SRC_ALPHA,b.ONE)):3===h?F?(b.blendEquationSeparate(b.FUNC_ADD,b.FUNC_ADD),b.blendFuncSeparate(b.ZERO,b.ZERO,b.ONE_MINUS_SRC_COLOR,b.ONE_MINUS_SRC_ALPHA)):(b.blendEquation(b.FUNC_ADD),b.blendFunc(b.ZERO,b.ONE_MINUS_SRC_COLOR)):4===h?F?(b.blendEquationSeparate(b.FUNC_ADD,b.FUNC_ADD),b.blendFuncSeparate(b.ZERO,b.SRC_COLOR,b.ZERO,b.SRC_ALPHA)):(b.blendEquation(b.FUNC_ADD),b.blendFunc(b.ZERO,b.SRC_COLOR)):F?(b.blendEquationSeparate(b.FUNC_ADD,b.FUNC_ADD),
b.blendFuncSeparate(b.ONE,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA)):(b.blendEquationSeparate(b.FUNC_ADD,b.FUNC_ADD),b.blendFuncSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA)),B=h,S=F;if(5===h){A=A||a;g=g||c;f=f||v;if(a!==J||A!==E)b.blendEquationSeparate(r(a),r(A)),J=a,E=A;if(c!==G||v!==V||g!==I||f!==ea)b.blendFuncSeparate(r(c),r(v),r(g),r(f)),G=c,V=v,I=g,ea=f}else ea=I=E=V=G=J=null}else e(b.BLEND),B=h}function f(b){u.setFunc(b)}function k(h){K!==h&&(h?b.frontFace(b.CW):
b.frontFace(b.CCW),K=h)}function l(h){0!==h?(d(b.CULL_FACE),h!==R&&(1===h?b.cullFace(b.BACK):2===h?b.cullFace(b.FRONT):b.cullFace(b.FRONT_AND_BACK))):e(b.CULL_FACE);R=h}function n(h){void 0===h&&(h=b.TEXTURE0+fa-1);ba!==h&&(b.activeTexture(h),ba=h)}function m(b,h,a,r){t.setClear(b,h,a,r)}function p(b){u.setClear(b)}function q(b){z.setClear(b)}var t=new function(){var h=!1,r=new a,c=null,d=new a;return{setMask:function(a){c===a||h||(b.colorMask(a,a,a,a),c=a)},setLocked:function(b){h=b},setClear:function(h,
a,c,v){r.set(h,a,c,v);!1===d.equals(r)&&(b.clearColor(h,a,c,v),d.copy(r))},reset:function(){h=!1;c=null;d.set(0,0,0,1)}}},u=new function(){var h=!1,a=null,r=null,c=null;return{setTest:function(h){h?d(b.DEPTH_TEST):e(b.DEPTH_TEST)},setMask:function(r){a===r||h||(b.depthMask(r),a=r)},setFunc:function(h){if(r!==h){if(h)switch(h){case 0:b.depthFunc(b.NEVER);break;case 1:b.depthFunc(b.ALWAYS);break;case 2:b.depthFunc(b.LESS);break;case 3:b.depthFunc(b.LEQUAL);break;case 4:b.depthFunc(b.EQUAL);break;case 5:b.depthFunc(b.GEQUAL);
break;case 6:b.depthFunc(b.GREATER);break;case 7:b.depthFunc(b.NOTEQUAL);break;default:b.depthFunc(b.LEQUAL)}else b.depthFunc(b.LEQUAL);r=h}},setLocked:function(b){h=b},setClear:function(h){c!==h&&(b.clearDepth(h),c=h)},reset:function(){h=!1;c=r=a=null}}},z=new function(){var h=!1,a=null,r=null,c=null,v=null,A=null,g=null,f=null,F=null;return{setTest:function(h){h?d(b.STENCIL_TEST):e(b.STENCIL_TEST)},setMask:function(r){a===r||h||(b.stencilMask(r),a=r)},setFunc:function(h,a,d){if(r!==h||c!==a||v!==
d)b.stencilFunc(h,a,d),r=h,c=a,v=d},setOp:function(h,a,r){if(A!==h||g!==a||f!==r)b.stencilOp(h,a,r),A=h,g=a,f=r},setLocked:function(b){h=b},setClear:function(h){F!==h&&(b.clearStencil(h),F=h)},reset:function(){h=!1;F=f=g=A=v=c=r=a=null}}},w=b.getParameter(b.MAX_VERTEX_ATTRIBS),pa=new Uint8Array(w),y=new Uint8Array(w),x=new Uint8Array(w),D={},C=null,B=null,J=null,G=null,V=null,E=null,I=null,ea=null,S=!1,K=null,R=null,O=null,Z=null,P=null,N=null,fa=b.getParameter(b.MAX_TEXTURE_IMAGE_UNITS),ba=null,
X={},W=new a,T=new a,aa={};aa[b.TEXTURE_2D]=c(b.TEXTURE_2D,b.TEXTURE_2D,1);aa[b.TEXTURE_CUBE_MAP]=c(b.TEXTURE_CUBE_MAP,b.TEXTURE_CUBE_MAP_POSITIVE_X,6);return{buffers:{color:t,depth:u,stencil:z},init:function(){m(0,0,0,1);p(1);q(0);d(b.DEPTH_TEST);f(3);k(!1);l(1);d(b.CULL_FACE);d(b.BLEND);g(1)},initAttributes:function(){for(var b=0,h=pa.length;b<h;b++)pa[b]=0},enableAttribute:function(a){pa[a]=1;0===y[a]&&(b.enableVertexAttribArray(a),y[a]=1);0!==x[a]&&(h.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(a,
0),x[a]=0)},enableAttributeAndDivisor:function(h,a,r){pa[h]=1;0===y[h]&&(b.enableVertexAttribArray(h),y[h]=1);x[h]!==a&&(r.vertexAttribDivisorANGLE(h,a),x[h]=a)},disableUnusedAttributes:function(){for(var h=0,a=y.length;h!==a;++h)y[h]!==pa[h]&&(b.disableVertexAttribArray(h),y[h]=0)},enable:d,disable:e,getCompressedTextureFormats:function(){if(null===C&&(C=[],h.get("WEBGL_compressed_texture_pvrtc")||h.get("WEBGL_compressed_texture_s3tc")||h.get("WEBGL_compressed_texture_etc1")))for(var a=b.getParameter(b.COMPRESSED_TEXTURE_FORMATS),
r=0;r<a.length;r++)C.push(a[r]);return C},setBlending:g,setColorWrite:function(b){t.setMask(b)},setDepthTest:function(b){u.setTest(b)},setDepthWrite:function(b){u.setMask(b)},setDepthFunc:f,setStencilTest:function(b){z.setTest(b)},setStencilWrite:function(b){z.setMask(b)},setStencilFunc:function(b,h,a){z.setFunc(b,h,a)},setStencilOp:function(b,h,a){z.setOp(b,h,a)},setFlipSided:k,setCullFace:l,setLineWidth:function(h){h!==O&&(b.lineWidth(h),O=h)},setPolygonOffset:function(h,a,r){if(h){if(d(b.POLYGON_OFFSET_FILL),
Z!==a||P!==r)b.polygonOffset(a,r),Z=a,P=r}else e(b.POLYGON_OFFSET_FILL)},getScissorTest:function(){return N},setScissorTest:function(h){(N=h)?d(b.SCISSOR_TEST):e(b.SCISSOR_TEST)},activeTexture:n,bindTexture:function(h,a){null===ba&&n();var r=X[ba];void 0===r&&(r={type:void 0,texture:void 0},X[ba]=r);if(r.type!==h||r.texture!==a)b.bindTexture(h,a||aa[h]),r.type=h,r.texture=a},compressedTexImage2D:function(){try{b.compressedTexImage2D.apply(b,arguments)}catch(Hd){console.error(Hd)}},texImage2D:function(){try{b.texImage2D.apply(b,
arguments)}catch(Hd){console.error(Hd)}},clearColor:m,clearDepth:p,clearStencil:q,scissor:function(h){!1===W.equals(h)&&(b.scissor(h.x,h.y,h.z,h.w),W.copy(h))},viewport:function(h){!1===T.equals(h)&&(b.viewport(h.x,h.y,h.z,h.w),T.copy(h))},reset:function(){for(var h=0;h<y.length;h++)1===y[h]&&(b.disableVertexAttribArray(h),y[h]=0);D={};ba=C=null;X={};R=K=B=null;t.reset();u.reset();z.reset()}}}function Le(b,h,a){function r(h){if("highp"===h){if(0<b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.HIGH_FLOAT).precision&&
0<b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.HIGH_FLOAT).precision)return"highp";h="mediump"}return"mediump"===h&&0<b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.MEDIUM_FLOAT).precision&&0<b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.MEDIUM_FLOAT).precision?"mediump":"lowp"}var c,d=void 0!==a.precision?a.precision:"highp",e=r(d);e!==d&&(console.warn("THREE.WebGLRenderer:",d,"not supported, using",e,"instead."),d=e);a=!0===a.logarithmicDepthBuffer&&!!h.get("EXT_frag_depth");var e=b.getParameter(b.MAX_TEXTURE_IMAGE_UNITS),
g=b.getParameter(b.MAX_VERTEX_TEXTURE_IMAGE_UNITS),f=b.getParameter(b.MAX_TEXTURE_SIZE),k=b.getParameter(b.MAX_CUBE_MAP_TEXTURE_SIZE),l=b.getParameter(b.MAX_VERTEX_ATTRIBS),n=b.getParameter(b.MAX_VERTEX_UNIFORM_VECTORS),m=b.getParameter(b.MAX_VARYING_VECTORS),p=b.getParameter(b.MAX_FRAGMENT_UNIFORM_VECTORS),q=0<g,t=!!h.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==c)return c;var a=h.get("EXT_texture_filter_anisotropic");return c=null!==a?b.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY_EXT):
0},getMaxPrecision:r,precision:d,logarithmicDepthBuffer:a,maxTextures:e,maxVertexTextures:g,maxTextureSize:f,maxCubemapSize:k,maxAttributes:l,maxVertexUniforms:n,maxVaryings:m,maxFragmentUniforms:p,vertexTextures:q,floatFragmentTextures:t,floatVertexTextures:q&&t}}function Me(b){var h={};return{get:function(a){if(void 0!==h[a])return h[a];var r;switch(a){case "WEBGL_depth_texture":r=b.getExtension("WEBGL_depth_texture")||b.getExtension("MOZ_WEBGL_depth_texture")||b.getExtension("WEBKIT_WEBGL_depth_texture");
break;case "EXT_texture_filter_anisotropic":r=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":r=b.getExtension("WEBGL_compressed_texture_s3tc")||b.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||b.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case "WEBGL_compressed_texture_pvrtc":r=b.getExtension("WEBGL_compressed_texture_pvrtc")||
b.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case "WEBGL_compressed_texture_etc1":r=b.getExtension("WEBGL_compressed_texture_etc1");break;default:r=b.getExtension(a)}null===r&&console.warn("THREE.WebGLRenderer: "+a+" extension not supported.");return h[a]=r}}}function Ne(){function b(){l.value!==c&&(l.value=c,l.needsUpdate=0<d);a.numPlanes=d}function h(b,h,r,c){var d=null!==b?b.length:0,v=null;if(0!==d){v=l.value;if(!0!==c||null===v){c=r+4*d;h=h.matrixWorldInverse;k.getNormalMatrix(h);
if(null===v||v.length<c)v=new Float32Array(c);for(c=0;c!==d;++c,r+=4)f.copy(b[c]).applyMatrix4(h,k),f.normal.toArray(v,r),v[r+3]=f.constant}l.value=v;l.needsUpdate=!0}a.numPlanes=d;return v}var a=this,c=null,d=0,e=!1,g=!1,f=new Ma,k=new La,l={value:null,needsUpdate:!1};this.uniform=l;this.numPlanes=0;this.init=function(b,a,r){var v=0!==b.length||a||0!==d||e;e=a;c=h(b,r,0);d=b.length;return v};this.beginShadows=function(){g=!0;h(null)};this.endShadows=function(){g=!1;b()};this.setState=function(a,
r,v,A,f){if(!e||null===a||0===a.length||g&&!r)g?h(null):b();else{r=g?0:d;var F=4*r,k=A.clippingState||null;l.value=k;k=h(a,v,F,f);for(a=0;a!==F;++a)k[a]=c[a];A.clippingState=k;this.numPlanes+=r}}}function Ed(b){function h(b,h,a,r){!0===J&&(b*=r,h*=r,a*=r);la.clearColor(b,h,a,r)}function r(){la.init();la.scissor(aa.copy(Na).multiplyScalar(ka));la.viewport(ga.copy(sa).multiplyScalar(ka));h(ca.r,ca.g,ca.b,ha)}function c(){T=N=null;W="";ba=-1;la.reset()}function d(b){b.preventDefault();c();r();wa.clear()}
function e(b){b=b.target;b.removeEventListener("dispose",e);f(b);wa["delete"](b)}function f(b){var h=wa.get(b).program;b.program=void 0;void 0!==h&&Qa.releaseProgram(h)}function l(b,h){return Math.abs(h[0])-Math.abs(b[0])}function m(b,h){return b.object.renderOrder!==h.object.renderOrder?b.object.renderOrder-h.object.renderOrder:b.material.program&&h.material.program&&b.material.program!==h.material.program?b.material.program.id-h.material.program.id:b.material.id!==h.material.id?b.material.id-h.material.id:
b.z!==h.z?b.z-h.z:b.id-h.id}function p(b,h){return b.object.renderOrder!==h.object.renderOrder?b.object.renderOrder-h.object.renderOrder:b.z!==h.z?h.z-b.z:b.id-h.id}function q(b,h,a,r,c){var d;a.transparent?(r=ea,d=++S):(r=E,d=++I);d=r[d];void 0!==d?(d.id=b.id,d.object=b,d.geometry=h,d.material=a,d.z=ra.z,d.group=c):(d={id:b.id,object:b,geometry:h,material:a,z:ra.z,group:c},r.push(d))}function t(b){if(!Ia.intersectsSphere(b))return!1;var h=va.numPlanes;if(0===h)return!0;var a=P.clippingPlanes,r=b.center;
b=-b.radius;var c=0;do if(a[c].distanceToPoint(r)<b)return!1;while(++c!==h);return!0}function u(b,h){if(!1!==b.visible){if(0!==(b.layers.mask&h.layers.mask))if(b.isLight)V.push(b);else if(b.isSprite){var a;(a=!1===b.frustumCulled)||(za.center.set(0,0,0),za.radius=.7071067811865476,za.applyMatrix4(b.matrixWorld),a=!0===t(za));a&&R.push(b)}else if(b.isLensFlare)Z.push(b);else if(b.isImmediateRenderObject)!0===P.sortObjects&&(ra.setFromMatrixPosition(b.matrixWorld),ra.applyProjection(Ha)),q(b,null,b.material,
ra.z,null);else if(b.isMesh||b.isLine||b.isPoints)if(b.isSkinnedMesh&&b.skeleton.update(),(a=!1===b.frustumCulled)||(a=b.geometry,null===a.boundingSphere&&a.computeBoundingSphere(),za.copy(a.boundingSphere).applyMatrix4(b.matrixWorld),a=!0===t(za)),a){var r=b.material;if(!0===r.visible)if(!0===P.sortObjects&&(ra.setFromMatrixPosition(b.matrixWorld),ra.applyProjection(Ha)),a=La.update(b),r.isMultiMaterial)for(var c=a.groups,d=r.materials,r=0,v=c.length;r<v;r++){var e=c[r],A=d[e.materialIndex];!0===
A.visible&&q(b,a,A,ra.z,e)}else q(b,a,r,ra.z,null)}a=b.children;r=0;for(v=a.length;r<v;r++)u(a[r],h)}}function ta(b,h,a,r){for(var c=0,d=b.length;c<d;c++){var v=b[c],e=v.object,A=v.geometry,g=void 0===r?v.material:r,v=v.group;e.modelViewMatrix.multiplyMatrices(h.matrixWorldInverse,e.matrixWorld);e.normalMatrix.getNormalMatrix(e.modelViewMatrix);if(e.isImmediateRenderObject){Y(g);var f=z(h,a,g,e);W="";e.render(function(b){P.renderBufferImmediate(b,f,g)})}else{if(null!==e.onBeforeRender)e.onBeforeRender();
P.renderBufferDirect(h,a,A,g,e,v)}}}function Y(b){2===b.side?la.disable(H.CULL_FACE):la.enable(H.CULL_FACE);la.setFlipSided(1===b.side);!0===b.transparent?la.setBlending(b.blending,b.blendEquation,b.blendSrc,b.blendDst,b.blendEquationAlpha,b.blendSrcAlpha,b.blendDstAlpha,b.premultipliedAlpha):la.setBlending(0);la.setDepthFunc(b.depthFunc);la.setDepthTest(b.depthTest);la.setDepthWrite(b.depthWrite);la.setColorWrite(b.colorWrite);la.setPolygonOffset(b.polygonOffset,b.polygonOffsetFactor,b.polygonOffsetUnits)}
function z(b,h,a,r){ja=0;var c=wa.get(a);Aa&&(Ja||b!==T)&&va.setState(a.clippingPlanes,a.clipShadows,b,c,b===T&&a.id===ba);!1===a.needsUpdate&&(void 0===c.program?a.needsUpdate=!0:a.fog&&c.fog!==h?a.needsUpdate=!0:a.lights&&c.lightsHash!==ma.hash?a.needsUpdate=!0:void 0!==c.numClippingPlanes&&c.numClippingPlanes!==va.numPlanes&&(a.needsUpdate=!0));if(a.needsUpdate){a:{var d=wa.get(a),v=Qa.getParameters(a,ma,h,va.numPlanes,r),A=Qa.getProgramCode(a,v),g=d.program,F=!0;if(void 0===g)a.addEventListener("dispose",
e);else if(g.code!==A)f(a);else if(void 0!==v.shaderID)break a;else F=!1;F&&(v.shaderID?(g=Xb[v.shaderID],d.__webglShader={name:a.type,uniforms:k.UniformsUtils.clone(g.uniforms),vertexShader:g.vertexShader,fragmentShader:g.fragmentShader}):d.__webglShader={name:a.type,uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader},a.__webglShader=d.__webglShader,g=Qa.acquireProgram(a,v,A),d.program=g,a.program=g);v=g.getAttributes();if(a.morphTargets)for(A=a.numSupportedMorphTargets=
0;A<P.maxMorphTargets;A++)0<=v["morphTarget"+A]&&a.numSupportedMorphTargets++;if(a.morphNormals)for(A=a.numSupportedMorphNormals=0;A<P.maxMorphNormals;A++)0<=v["morphNormal"+A]&&a.numSupportedMorphNormals++;v=d.__webglShader.uniforms;if(!a.isShaderMaterial&&!a.isRawShaderMaterial||!0===a.clipping)d.numClippingPlanes=va.numPlanes,v.clippingPlanes=va.uniform;d.fog=h;d.lightsHash=ma.hash;a.lights&&(v.ambientLightColor.value=ma.ambient,v.directionalLights.value=ma.directional,v.spotLights.value=ma.spot,
v.pointLights.value=ma.point,v.hemisphereLights.value=ma.hemi,v.directionalShadowMap.value=ma.directionalShadowMap,v.directionalShadowMatrix.value=ma.directionalShadowMatrix,v.spotShadowMap.value=ma.spotShadowMap,v.spotShadowMatrix.value=ma.spotShadowMatrix,v.pointShadowMap.value=ma.pointShadowMap,v.pointShadowMatrix.value=ma.pointShadowMatrix);A=d.program.getUniforms();A=oa.seqWithValue(A.seq,v);d.uniformsList=A;d.dynamicUniforms=oa.splitDynamic(A,v)}a.needsUpdate=!1}var M=!1,F=g=!1,d=c.program,
A=d.getUniforms(),v=c.__webglShader.uniforms;d.id!==N&&(H.useProgram(d.program),N=d.id,F=g=M=!0);a.id!==ba&&(ba=a.id,g=!0);if(M||b!==T){A.set(H,b,"projectionMatrix");ya.logarithmicDepthBuffer&&A.setValue(H,"logDepthBufFC",2/(Math.log(b.far+1)/Math.LN2));b!==T&&(T=b,F=g=!0);if(a.isShaderMaterial||a.isMeshPhongMaterial||a.isMeshStandardMaterial||a.envMap)M=A.map.cameraPosition,void 0!==M&&M.setValue(H,ra.setFromMatrixPosition(b.matrixWorld));(a.isMeshPhongMaterial||a.isMeshLambertMaterial||a.isMeshBasicMaterial||
a.isMeshStandardMaterial||a.isShaderMaterial||a.skinning)&&A.setValue(H,"viewMatrix",b.matrixWorldInverse);A.set(H,P,"toneMappingExposure");A.set(H,P,"toneMappingWhitePoint")}a.skinning&&(A.setOptional(H,r,"bindMatrix"),A.setOptional(H,r,"bindMatrixInverse"),M=r.skeleton)&&(ya.floatVertexTextures&&M.useVertexTexture?(A.set(H,M,"boneTexture"),A.set(H,M,"boneTextureWidth"),A.set(H,M,"boneTextureHeight")):A.setOptional(H,M,"boneMatrices"));if(g){a.lights&&(g=F,v.ambientLightColor.needsUpdate=g,v.directionalLights.needsUpdate=
g,v.pointLights.needsUpdate=g,v.spotLights.needsUpdate=g,v.hemisphereLights.needsUpdate=g);h&&a.fog&&(v.fogColor.value=h.color,h.isFog?(v.fogNear.value=h.near,v.fogFar.value=h.far):h.isFogExp2&&(v.fogDensity.value=h.density));if(a.isMeshBasicMaterial||a.isMeshLambertMaterial||a.isMeshPhongMaterial||a.isMeshStandardMaterial||a.isMeshDepthMaterial){v.opacity.value=a.opacity;v.diffuse.value=a.color;a.emissive&&v.emissive.value.copy(a.emissive).multiplyScalar(a.emissiveIntensity);v.map.value=a.map;v.specularMap.value=
a.specularMap;v.alphaMap.value=a.alphaMap;a.aoMap&&(v.aoMap.value=a.aoMap,v.aoMapIntensity.value=a.aoMapIntensity);var l;a.map?l=a.map:a.specularMap?l=a.specularMap:a.displacementMap?l=a.displacementMap:a.normalMap?l=a.normalMap:a.bumpMap?l=a.bumpMap:a.roughnessMap?l=a.roughnessMap:a.metalnessMap?l=a.metalnessMap:a.alphaMap?l=a.alphaMap:a.emissiveMap&&(l=a.emissiveMap);void 0!==l&&(l.isWebGLRenderTarget&&(l=l.texture),h=l.offset,l=l.repeat,v.offsetRepeat.value.set(h.x,h.y,l.x,l.y));v.envMap.value=
a.envMap;v.flipEnvMap.value=a.envMap&&a.envMap.isCubeTexture?-1:1;v.reflectivity.value=a.reflectivity;v.refractionRatio.value=a.refractionRatio}a.isLineBasicMaterial?(v.diffuse.value=a.color,v.opacity.value=a.opacity):a.isLineDashedMaterial?(v.diffuse.value=a.color,v.opacity.value=a.opacity,v.dashSize.value=a.dashSize,v.totalSize.value=a.dashSize+a.gapSize,v.scale.value=a.scale):a.isPointsMaterial?(v.diffuse.value=a.color,v.opacity.value=a.opacity,v.size.value=a.size*ka,v.scale.value=.5*pa.clientHeight,
v.map.value=a.map,null!==a.map&&(l=a.map.offset,h=a.map.repeat,v.offsetRepeat.value.set(l.x,l.y,h.x,h.y))):a.isMeshLambertMaterial?(a.lightMap&&(v.lightMap.value=a.lightMap,v.lightMapIntensity.value=a.lightMapIntensity),a.emissiveMap&&(v.emissiveMap.value=a.emissiveMap)):a.isMeshPhongMaterial?(v.specular.value=a.specular,v.shininess.value=Math.max(a.shininess,1E-4),a.lightMap&&(v.lightMap.value=a.lightMap,v.lightMapIntensity.value=a.lightMapIntensity),a.emissiveMap&&(v.emissiveMap.value=a.emissiveMap),
a.bumpMap&&(v.bumpMap.value=a.bumpMap,v.bumpScale.value=a.bumpScale),a.normalMap&&(v.normalMap.value=a.normalMap,v.normalScale.value.copy(a.normalScale)),a.displacementMap&&(v.displacementMap.value=a.displacementMap,v.displacementScale.value=a.displacementScale,v.displacementBias.value=a.displacementBias)):a.isMeshPhysicalMaterial?(v.clearCoat.value=a.clearCoat,v.clearCoatRoughness.value=a.clearCoatRoughness,w(v,a)):a.isMeshStandardMaterial?w(v,a):a.isMeshDepthMaterial?a.displacementMap&&(v.displacementMap.value=
a.displacementMap,v.displacementScale.value=a.displacementScale,v.displacementBias.value=a.displacementBias):a.isMeshNormalMaterial&&(v.opacity.value=a.opacity);oa.upload(H,c.uniformsList,v,P)}A.set(H,r,"modelViewMatrix");A.set(H,r,"normalMatrix");A.setValue(H,"modelMatrix",r.matrixWorld);c=c.dynamicUniforms;null!==c&&(oa.evalDynamic(c,v,r,a,b),oa.upload(H,c,v,P));return d}function w(b,h){b.roughness.value=h.roughness;b.metalness.value=h.metalness;h.roughnessMap&&(b.roughnessMap.value=h.roughnessMap);
h.metalnessMap&&(b.metalnessMap.value=h.metalnessMap);h.lightMap&&(b.lightMap.value=h.lightMap,b.lightMapIntensity.value=h.lightMapIntensity);h.emissiveMap&&(b.emissiveMap.value=h.emissiveMap);h.bumpMap&&(b.bumpMap.value=h.bumpMap,b.bumpScale.value=h.bumpScale);h.normalMap&&(b.normalMap.value=h.normalMap,b.normalScale.value.copy(h.normalScale));h.displacementMap&&(b.displacementMap.value=h.displacementMap,b.displacementScale.value=h.displacementScale,b.displacementBias.value=h.displacementBias);h.envMap&&
(b.envMapIntensity.value=h.envMapIntensity)}function y(b){var h;if(1E3===b)return H.REPEAT;if(1001===b)return H.CLAMP_TO_EDGE;if(1002===b)return H.MIRRORED_REPEAT;if(1003===b)return H.NEAREST;if(1004===b)return H.NEAREST_MIPMAP_NEAREST;if(1005===b)return H.NEAREST_MIPMAP_LINEAR;if(1006===b)return H.LINEAR;if(1007===b)return H.LINEAR_MIPMAP_NEAREST;if(1008===b)return H.LINEAR_MIPMAP_LINEAR;if(1009===b)return H.UNSIGNED_BYTE;if(1017===b)return H.UNSIGNED_SHORT_4_4_4_4;if(1018===b)return H.UNSIGNED_SHORT_5_5_5_1;
if(1019===b)return H.UNSIGNED_SHORT_5_6_5;if(1010===b)return H.BYTE;if(1011===b)return H.SHORT;if(1012===b)return H.UNSIGNED_SHORT;if(1013===b)return H.INT;if(1014===b)return H.UNSIGNED_INT;if(1015===b)return H.FLOAT;h=Ga.get("OES_texture_half_float");if(null!==h&&1016===b)return h.HALF_FLOAT_OES;if(1021===b)return H.ALPHA;if(1022===b)return H.RGB;if(1023===b)return H.RGBA;if(1024===b)return H.LUMINANCE;if(1025===b)return H.LUMINANCE_ALPHA;if(1026===b)return H.DEPTH_COMPONENT;if(1027===b)return H.DEPTH_STENCIL;
if(100===b)return H.FUNC_ADD;if(101===b)return H.FUNC_SUBTRACT;if(102===b)return H.FUNC_REVERSE_SUBTRACT;if(200===b)return H.ZERO;if(201===b)return H.ONE;if(202===b)return H.SRC_COLOR;if(203===b)return H.ONE_MINUS_SRC_COLOR;if(204===b)return H.SRC_ALPHA;if(205===b)return H.ONE_MINUS_SRC_ALPHA;if(206===b)return H.DST_ALPHA;if(207===b)return H.ONE_MINUS_DST_ALPHA;if(208===b)return H.DST_COLOR;if(209===b)return H.ONE_MINUS_DST_COLOR;if(210===b)return H.SRC_ALPHA_SATURATE;h=Ga.get("WEBGL_compressed_texture_s3tc");
if(null!==h){if(2001===b)return h.COMPRESSED_RGB_S3TC_DXT1_EXT;if(2002===b)return h.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(2003===b)return h.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(2004===b)return h.COMPRESSED_RGBA_S3TC_DXT5_EXT}h=Ga.get("WEBGL_compressed_texture_pvrtc");if(null!==h){if(2100===b)return h.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(2101===b)return h.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(2102===b)return h.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(2103===b)return h.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}h=Ga.get("WEBGL_compressed_texture_etc1");
if(null!==h&&2151===b)return h.COMPRESSED_RGB_ETC1_WEBGL;h=Ga.get("EXT_blend_minmax");if(null!==h){if(103===b)return h.MIN_EXT;if(104===b)return h.MAX_EXT}h=Ga.get("WEBGL_depth_texture");return null!==h&&1020===b?h.UNSIGNED_INT_24_8_WEBGL:0}console.log("THREE.WebGLRenderer","81");b=b||{};var pa=void 0!==b.canvas?b.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),x=void 0!==b.context?b.context:null,L=void 0!==b.alpha?b.alpha:!1,D=void 0!==b.depth?b.depth:!0,C=void 0!==b.stencil?
b.stencil:!0,B=void 0!==b.antialias?b.antialias:!1,J=void 0!==b.premultipliedAlpha?b.premultipliedAlpha:!0,G=void 0!==b.preserveDrawingBuffer?b.preserveDrawingBuffer:!1,V=[],E=[],I=-1,ea=[],S=-1,K=new Float32Array(8),R=[],Z=[];this.domElement=pa;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1;this.toneMappingWhitePoint=
this.toneMappingExposure=this.toneMapping=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var P=this,N=null,X=null,fa=null,ba=-1,W="",T=null,aa=new a,xa=null,ga=new a,ja=0,ca=new O(0),ha=0,Ra=pa.width,qa=pa.height,ka=1,Na=new a(0,0,Ra,qa),ua=!1,sa=new a(0,0,Ra,qa),Ia=new yb,va=new Ne,Aa=!1,Ja=!1,za=new Oa,Ha=new n,ra=new g,ma={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],point:[],pointShadowMap:[],pointShadowMatrix:[],
hemi:[],shadows:[]},Ca={calls:0,vertices:0,faces:0,points:0};this.info={render:Ca,memory:{geometries:0,textures:0},programs:null};var H;try{L={alpha:L,depth:D,stencil:C,antialias:B,premultipliedAlpha:J,preserveDrawingBuffer:G};H=x||pa.getContext("webgl",L)||pa.getContext("experimental-webgl",L);if(null===H){if(null!==pa.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";throw"Error creating WebGL context.";}void 0===H.getShaderPrecisionFormat&&(H.getShaderPrecisionFormat=
function(){return{rangeMin:1,rangeMax:1,precision:1}});pa.addEventListener("webglcontextlost",d,!1)}catch(Pe){console.error("THREE.WebGLRenderer: "+Pe)}var Ga=new Me(H);Ga.get("WEBGL_depth_texture");Ga.get("OES_texture_float");Ga.get("OES_texture_float_linear");Ga.get("OES_texture_half_float");Ga.get("OES_texture_half_float_linear");Ga.get("OES_standard_derivatives");Ga.get("ANGLE_instanced_arrays");Ga.get("OES_element_index_uint")&&(ia.MaxIndex=4294967296);var ya=new Le(H,Ga,b),la=new Ke(H,Ga,y),
wa=new Je,Ma=new Ie(H,Ga,la,wa,ya,y,this.info),La=new He(H,wa,this.info),Qa=new Fe(this,ya),Ua=new cd;this.info.programs=Qa.programs;var Ya=new tb(H,Ga,Ca),Za=new mb(H,Ga,Ca),$a=new eb(-1,1,1,-1,0,1),Va=new Sa,Xa=new Da(new ab(2,2),new Pa({depthTest:!1,depthWrite:!1,fog:!1}));b=Xb.cube;var Ta=new Da(new hb(5,5,5),new Ba({uniforms:b.uniforms,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}));r();this.context=H;this.capabilities=ya;this.extensions=
Ga;this.properties=wa;this.state=la;var cb=new ad(this,ma,La,ya);this.shadowMap=cb;var fb=new db(this,R),gb=new Wa(this,Z);this.getContext=function(){return H};this.getContextAttributes=function(){return H.getContextAttributes()};this.forceContextLoss=function(){Ga.get("WEBGL_lose_context").loseContext()};this.getMaxAnisotropy=function(){return ya.getMaxAnisotropy()};this.getPrecision=function(){return ya.precision};this.getPixelRatio=function(){return ka};this.setPixelRatio=function(b){void 0!==
b&&(ka=b,this.setSize(sa.z,sa.w,!1))};this.getSize=function(){return{width:Ra,height:qa}};this.setSize=function(b,h,a){Ra=b;qa=h;pa.width=b*ka;pa.height=h*ka;!1!==a&&(pa.style.width=b+"px",pa.style.height=h+"px");this.setViewport(0,0,b,h)};this.setViewport=function(b,h,a,r){la.viewport(sa.set(b,h,a,r))};this.setScissor=function(b,h,a,r){la.scissor(Na.set(b,h,a,r))};this.setScissorTest=function(b){la.setScissorTest(ua=b)};this.getClearColor=function(){return ca};this.setClearColor=function(b,a){ca.set(b);
ha=void 0!==a?a:1;h(ca.r,ca.g,ca.b,ha)};this.getClearAlpha=function(){return ha};this.setClearAlpha=function(b){ha=b;h(ca.r,ca.g,ca.b,ha)};this.clear=function(b,h,a){var r=0;if(void 0===b||b)r|=H.COLOR_BUFFER_BIT;if(void 0===h||h)r|=H.DEPTH_BUFFER_BIT;if(void 0===a||a)r|=H.STENCIL_BUFFER_BIT;H.clear(r)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.clearTarget=function(b,h,a,r){this.setRenderTarget(b);
this.clear(h,a,r)};this.resetGLState=c;this.dispose=function(){ea=[];S=-1;E=[];I=-1;pa.removeEventListener("webglcontextlost",d,!1)};this.renderBufferImmediate=function(b,h,a){la.initAttributes();var r=wa.get(b);b.hasPositions&&!r.position&&(r.position=H.createBuffer());b.hasNormals&&!r.normal&&(r.normal=H.createBuffer());b.hasUvs&&!r.uv&&(r.uv=H.createBuffer());b.hasColors&&!r.color&&(r.color=H.createBuffer());h=h.getAttributes();b.hasPositions&&(H.bindBuffer(H.ARRAY_BUFFER,r.position),H.bufferData(H.ARRAY_BUFFER,
b.positionArray,H.DYNAMIC_DRAW),la.enableAttribute(h.position),H.vertexAttribPointer(h.position,3,H.FLOAT,!1,0,0));if(b.hasNormals){H.bindBuffer(H.ARRAY_BUFFER,r.normal);if(!a.isMeshPhongMaterial&&!a.isMeshStandardMaterial&&1===a.shading)for(var c=0,d=3*b.count;c<d;c+=9){var v=b.normalArray,e=(v[c+0]+v[c+3]+v[c+6])/3,A=(v[c+1]+v[c+4]+v[c+7])/3,g=(v[c+2]+v[c+5]+v[c+8])/3;v[c+0]=e;v[c+1]=A;v[c+2]=g;v[c+3]=e;v[c+4]=A;v[c+5]=g;v[c+6]=e;v[c+7]=A;v[c+8]=g}H.bufferData(H.ARRAY_BUFFER,b.normalArray,H.DYNAMIC_DRAW);
la.enableAttribute(h.normal);H.vertexAttribPointer(h.normal,3,H.FLOAT,!1,0,0)}b.hasUvs&&a.map&&(H.bindBuffer(H.ARRAY_BUFFER,r.uv),H.bufferData(H.ARRAY_BUFFER,b.uvArray,H.DYNAMIC_DRAW),la.enableAttribute(h.uv),H.vertexAttribPointer(h.uv,2,H.FLOAT,!1,0,0));b.hasColors&&0!==a.vertexColors&&(H.bindBuffer(H.ARRAY_BUFFER,r.color),H.bufferData(H.ARRAY_BUFFER,b.colorArray,H.DYNAMIC_DRAW),la.enableAttribute(h.color),H.vertexAttribPointer(h.color,3,H.FLOAT,!1,0,0));la.disableUnusedAttributes();H.drawArrays(H.TRIANGLES,
0,b.count);b.count=0};this.renderBufferDirect=function(b,h,a,r,c,d){Y(r);var v=z(b,h,r,c),e=!1;b=a.id+"_"+v.id+"_"+r.wireframe;b!==W&&(W=b,e=!0);h=c.morphTargetInfluences;if(void 0!==h){var A=[];b=0;for(var g=h.length;b<g;b++)e=h[b],A.push([e,b]);A.sort(l);8<A.length&&(A.length=8);var f=a.morphAttributes;b=0;for(g=A.length;b<g;b++)e=A[b],K[b]=e[0],0!==e[0]?(h=e[1],!0===r.morphTargets&&f.position&&a.addAttribute("morphTarget"+b,f.position[h]),!0===r.morphNormals&&f.normal&&a.addAttribute("morphNormal"+
b,f.normal[h])):(!0===r.morphTargets&&a.removeAttribute("morphTarget"+b),!0===r.morphNormals&&a.removeAttribute("morphNormal"+b));b=A.length;for(h=K.length;b<h;b++)K[b]=0;v.getUniforms().setValue(H,"morphTargetInfluences",K);e=!0}h=a.index;g=a.attributes.position;A=1;!0===r.wireframe&&(h=La.getWireframeAttribute(a),A=2);null!==h?(b=Za,b.setIndex(h)):b=Ya;if(e){var e=void 0,F;if(a&&a.isInstancedBufferGeometry&&(F=Ga.get("ANGLE_instanced_arrays"),null===F))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");
else{void 0===e&&(e=0);la.initAttributes();var f=a.attributes,v=v.getAttributes(),k=r.defaultAttributeValues,M;for(M in v){var Q=v[M];if(0<=Q){var n=f[M];if(void 0!==n){var m=H.FLOAT,p=n.array,da=n.normalized;p instanceof Float32Array?m=H.FLOAT:p instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):p instanceof Uint16Array?m=H.UNSIGNED_SHORT:p instanceof Int16Array?m=H.SHORT:p instanceof Uint32Array?m=H.UNSIGNED_INT:p instanceof Int32Array?m=H.INT:p instanceof Int8Array?
m=H.BYTE:p instanceof Uint8Array&&(m=H.UNSIGNED_BYTE);var p=n.itemSize,q=La.getAttributeBuffer(n);if(n&&n.isInterleavedBufferAttribute){var U=n.data,t=U.stride,n=n.offset;U&&U.isInstancedInterleavedBuffer?(la.enableAttributeAndDivisor(Q,U.meshPerAttribute,F),void 0===a.maxInstancedCount&&(a.maxInstancedCount=U.meshPerAttribute*U.count)):la.enableAttribute(Q);H.bindBuffer(H.ARRAY_BUFFER,q);H.vertexAttribPointer(Q,p,m,da,t*U.array.BYTES_PER_ELEMENT,(e*t+n)*U.array.BYTES_PER_ELEMENT)}else n&&n.isInstancedBufferAttribute?
(la.enableAttributeAndDivisor(Q,n.meshPerAttribute,F),void 0===a.maxInstancedCount&&(a.maxInstancedCount=n.meshPerAttribute*n.count)):la.enableAttribute(Q),H.bindBuffer(H.ARRAY_BUFFER,q),H.vertexAttribPointer(Q,p,m,da,0,e*p*n.array.BYTES_PER_ELEMENT)}else if(void 0!==k&&(m=k[M],void 0!==m))switch(m.length){case 2:H.vertexAttrib2fv(Q,m);break;case 3:H.vertexAttrib3fv(Q,m);break;case 4:H.vertexAttrib4fv(Q,m);break;default:H.vertexAttrib1fv(Q,m)}}}la.disableUnusedAttributes()}null!==h&&H.bindBuffer(H.ELEMENT_ARRAY_BUFFER,
La.getAttributeBuffer(h))}F=0;null!==h?F=h.count:void 0!==g&&(F=g.count);h=a.drawRange.start*A;g=null!==d?d.start*A:0;M=Math.max(h,g);d=Math.max(0,Math.min(F,h+a.drawRange.count*A,g+(null!==d?d.count*A:Infinity))-1-M+1);if(0!==d){if(c.isMesh)if(!0===r.wireframe)la.setLineWidth(r.wireframeLinewidth*(null===X?ka:1)),b.setMode(H.LINES);else switch(c.drawMode){case 0:b.setMode(H.TRIANGLES);break;case 1:b.setMode(H.TRIANGLE_STRIP);break;case 2:b.setMode(H.TRIANGLE_FAN)}else c.isLine?(r=r.linewidth,void 0===
r&&(r=1),la.setLineWidth(r*(null===X?ka:1)),c.isLineSegments?b.setMode(H.LINES):b.setMode(H.LINE_STRIP)):c.isPoints&&b.setMode(H.POINTS);a&&a.isInstancedBufferGeometry?0<a.maxInstancedCount&&b.renderInstances(a,M,d):b.render(M,d)}};this.render=function(b,a,r,c){if(void 0!==a&&!0!==a.isCamera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var d=b.fog;W="";ba=-1;T=null;!0===b.autoUpdate&&b.updateMatrixWorld();null===a.parent&&a.updateMatrixWorld();a.matrixWorldInverse.getInverse(a.matrixWorld);
Ha.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse);Ia.setFromMatrix(Ha);V.length=0;S=I=-1;R.length=0;Z.length=0;Ja=this.localClippingEnabled;Aa=va.init(this.clippingPlanes,Ja,a);u(b,a);E.length=I+1;ea.length=S+1;!0===P.sortObjects&&(E.sort(m),ea.sort(p));Aa&&va.beginShadows();for(var v=V,e=0,A=0,g=v.length;A<g;A++){var f=v[A];f.castShadow&&(ma.shadows[e++]=f)}ma.shadows.length=e;cb.render(b,a);for(var v=V,F=f=0,k=0,M,l,Q,da,q=a.matrixWorldInverse,U=0,t=0,Ea=0,na=0,e=0,A=v.length;e<A;e++)if(g=
v[e],M=g.color,l=g.intensity,Q=g.distance,da=g.shadow&&g.shadow.map?g.shadow.map.texture:null,g.isAmbientLight)f+=M.r*l,F+=M.g*l,k+=M.b*l;else if(g.isDirectionalLight){var Y=Ua.get(g);Y.color.copy(g.color).multiplyScalar(g.intensity);Y.direction.setFromMatrixPosition(g.matrixWorld);ra.setFromMatrixPosition(g.target.matrixWorld);Y.direction.sub(ra);Y.direction.transformDirection(q);if(Y.shadow=g.castShadow)Y.shadowBias=g.shadow.bias,Y.shadowRadius=g.shadow.radius,Y.shadowMapSize=g.shadow.mapSize;ma.directionalShadowMap[U]=
da;ma.directionalShadowMatrix[U]=g.shadow.matrix;ma.directional[U++]=Y}else if(g.isSpotLight){Y=Ua.get(g);Y.position.setFromMatrixPosition(g.matrixWorld);Y.position.applyMatrix4(q);Y.color.copy(M).multiplyScalar(l);Y.distance=Q;Y.direction.setFromMatrixPosition(g.matrixWorld);ra.setFromMatrixPosition(g.target.matrixWorld);Y.direction.sub(ra);Y.direction.transformDirection(q);Y.coneCos=Math.cos(g.angle);Y.penumbraCos=Math.cos(g.angle*(1-g.penumbra));Y.decay=0===g.distance?0:g.decay;if(Y.shadow=g.castShadow)Y.shadowBias=
g.shadow.bias,Y.shadowRadius=g.shadow.radius,Y.shadowMapSize=g.shadow.mapSize;ma.spotShadowMap[Ea]=da;ma.spotShadowMatrix[Ea]=g.shadow.matrix;ma.spot[Ea++]=Y}else if(g.isPointLight){Y=Ua.get(g);Y.position.setFromMatrixPosition(g.matrixWorld);Y.position.applyMatrix4(q);Y.color.copy(g.color).multiplyScalar(g.intensity);Y.distance=g.distance;Y.decay=0===g.distance?0:g.decay;if(Y.shadow=g.castShadow)Y.shadowBias=g.shadow.bias,Y.shadowRadius=g.shadow.radius,Y.shadowMapSize=g.shadow.mapSize;ma.pointShadowMap[t]=
da;void 0===ma.pointShadowMatrix[t]&&(ma.pointShadowMatrix[t]=new n);ra.setFromMatrixPosition(g.matrixWorld).negate();ma.pointShadowMatrix[t].identity().setPosition(ra);ma.point[t++]=Y}else g.isHemisphereLight&&(Y=Ua.get(g),Y.direction.setFromMatrixPosition(g.matrixWorld),Y.direction.transformDirection(q),Y.direction.normalize(),Y.skyColor.copy(g.color).multiplyScalar(l),Y.groundColor.copy(g.groundColor).multiplyScalar(l),ma.hemi[na++]=Y);ma.ambient[0]=f;ma.ambient[1]=F;ma.ambient[2]=k;ma.directional.length=
U;ma.spot.length=Ea;ma.point.length=t;ma.hemi.length=na;ma.hash=U+","+t+","+Ea+","+na+","+ma.shadows.length;Aa&&va.endShadows();Ca.calls=0;Ca.vertices=0;Ca.faces=0;Ca.points=0;void 0===r&&(r=null);this.setRenderTarget(r);v=b.background;null===v?h(ca.r,ca.g,ca.b,ha):v&&v.isColor&&(h(v.r,v.g,v.b,1),c=!0);(this.autoClear||c)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);v&&v.isCubeTexture?(Va.projectionMatrix.copy(a.projectionMatrix),Va.matrixWorld.extractRotation(a.matrixWorld),
Va.matrixWorldInverse.getInverse(Va.matrixWorld),Ta.material.uniforms.tCube.value=v,Ta.modelViewMatrix.multiplyMatrices(Va.matrixWorldInverse,Ta.matrixWorld),La.update(Ta),P.renderBufferDirect(Va,null,Ta.geometry,Ta.material,Ta,null)):v&&v.isTexture&&(Xa.material.map=v,La.update(Xa),P.renderBufferDirect($a,null,Xa.geometry,Xa.material,Xa,null));b.overrideMaterial?(c=b.overrideMaterial,ta(E,a,d,c),ta(ea,a,d,c)):(la.setBlending(0),ta(E,a,d),ta(ea,a,d));fb.render(b,a);gb.render(b,a,ga);r&&Ma.updateRenderTargetMipmap(r);
la.setDepthTest(!0);la.setDepthWrite(!0);la.setColorWrite(!0)}};this.setFaceCulling=function(b,h){la.setCullFace(b);la.setFlipSided(0===h)};this.allocTextureUnit=function(){var b=ja;b>=ya.maxTextures&&console.warn("WebGLRenderer: trying to use "+b+" texture units while this GPU supports only "+ya.maxTextures);ja+=1;return b};this.setTexture2D=function(){var b=!1;return function(h,a){h&&h.isWebGLRenderTarget&&(b||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),
b=!0),h=h.texture);Ma.setTexture2D(h,a)}}();this.setTexture=function(){var b=!1;return function(h,a){b||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),b=!0);Ma.setTexture2D(h,a)}}();this.setTextureCube=function(){var b=!1;return function(h,a){h&&h.isWebGLRenderTargetCube&&(b||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),b=!0),h=h.texture);h&&h.isCubeTexture||Array.isArray(h.image)&&
6===h.image.length?Ma.setTextureCube(h,a):Ma.setTextureCubeDynamic(h,a)}}();this.getCurrentRenderTarget=function(){return X};this.setRenderTarget=function(b){(X=b)&&void 0===wa.get(b).__webglFramebuffer&&Ma.setupRenderTarget(b);var h=b&&b.isWebGLRenderTargetCube,a;b?(a=wa.get(b),a=h?a.__webglFramebuffer[b.activeCubeFace]:a.__webglFramebuffer,aa.copy(b.scissor),xa=b.scissorTest,ga.copy(b.viewport)):(a=null,aa.copy(Na).multiplyScalar(ka),xa=ua,ga.copy(sa).multiplyScalar(ka));fa!==a&&(H.bindFramebuffer(H.FRAMEBUFFER,
a),fa=a);la.scissor(aa);la.setScissorTest(xa);la.viewport(ga);h&&(h=wa.get(b.texture),H.framebufferTexture2D(H.FRAMEBUFFER,H.COLOR_ATTACHMENT0,H.TEXTURE_CUBE_MAP_POSITIVE_X+b.activeCubeFace,h.__webglTexture,b.activeMipMapLevel))};this.readRenderTargetPixels=function(b,h,a,r,c,d){if(!1===(b&&b.isWebGLRenderTarget))console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");else{var v=wa.get(b).__webglFramebuffer;if(v){var e=!1;v!==fa&&(H.bindFramebuffer(H.FRAMEBUFFER,
v),e=!0);try{var A=b.texture,g=A.format,f=A.type;1023!==g&&y(g)!==H.getParameter(H.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===f||y(f)===H.getParameter(H.IMPLEMENTATION_COLOR_READ_TYPE)||1015===f&&(Ga.get("OES_texture_float")||Ga.get("WEBGL_color_buffer_float"))||1016===f&&Ga.get("EXT_color_buffer_half_float")?H.checkFramebufferStatus(H.FRAMEBUFFER)===H.FRAMEBUFFER_COMPLETE?0<=h&&
h<=b.width-r&&0<=a&&a<=b.height-c&&H.readPixels(h,a,r,c,y(g),y(f),d):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{e&&H.bindFramebuffer(H.FRAMEBUFFER,fa)}}}}}function Ub(b,h){this.name="";this.color=new O(b);this.density=void 0!==h?h:2.5E-4}function Vb(b,h,a){this.name="";this.color=
new O(b);this.near=void 0!==h?h:1;this.far=void 0!==a?a:1E3}function zb(){X.call(this);this.type="Scene";this.overrideMaterial=this.fog=this.background=null;this.autoUpdate=!0}function Fd(b,h,a,c,d){X.call(this);this.lensFlares=[];this.positionScreen=new g;this.customUpdateCallback=void 0;void 0!==b&&this.add(b,h,a,c,d)}function Ab(b){aa.call(this);this.type="SpriteMaterial";this.color=new O(16777215);this.map=null;this.rotation=0;this.lights=this.fog=!1;this.setValues(b)}function vc(b){X.call(this);
this.type="Sprite";this.material=void 0!==b?b:new Ab}function xc(){X.call(this);this.type="LOD";Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Bb(b,h,a,c,d,e,g,f,k,n,m,p){l.call(this,null,e,g,f,k,n,c,d,m,p);this.image={data:b,width:h,height:a};this.magFilter=void 0!==k?k:1003;this.minFilter=void 0!==n?n:1003;this.generateMipmaps=this.flipY=!1}function ed(b,h,a){this.useVertexTexture=void 0!==a?a:!0;this.identityMatrix=new n;b=b||[];this.bones=b.slice(0);this.useVertexTexture?
(b=Math.sqrt(4*this.bones.length),b=k.Math.nextPowerOfTwo(Math.ceil(b)),this.boneTextureHeight=this.boneTextureWidth=Math.max(b,4),this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new Bb(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,1023,1015)):this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===h)this.calculateInverses();else if(this.bones.length===h.length)this.boneInverses=h.slice(0);else for(console.warn("THREE.Skeleton bonInverses is the wrong length."),
this.boneInverses=[],h=0,b=this.bones.length;h<b;h++)this.boneInverses.push(new n)}function fd(b){X.call(this);this.type="Bone";this.skin=b}function gd(b,h,a){Da.call(this,b,h);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new n;this.bindMatrixInverse=new n;b=[];if(this.geometry&&void 0!==this.geometry.bones){for(var r,c=0,d=this.geometry.bones.length;c<d;++c)r=this.geometry.bones[c],h=new fd(this),b.push(h),h.name=r.name,h.position.fromArray(r.pos),h.quaternion.fromArray(r.rotq),
void 0!==r.scl&&h.scale.fromArray(r.scl);c=0;for(d=this.geometry.bones.length;c<d;++c)r=this.geometry.bones[c],-1!==r.parent&&null!==r.parent&&void 0!==b[r.parent]?b[r.parent].add(b[c]):this.add(b[c])}this.normalizeSkinWeights();this.updateMatrixWorld(!0);this.bind(new ed(b,void 0,a),this.matrixWorld)}function Ha(b){aa.call(this);this.type="LineBasicMaterial";this.color=new O(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.lights=!1;this.setValues(b)}function qb(b,h,a){if(1===a)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),
new Ia(b,h);X.call(this);this.type="Line";this.geometry=void 0!==b?b:new ia;this.material=void 0!==h?h:new Ha({color:16777215*Math.random()})}function Ia(b,h){qb.call(this,b,h);this.type="LineSegments"}function Va(b){aa.call(this);this.type="PointsMaterial";this.color=new O(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.lights=!1;this.setValues(b)}function Yb(b,h){X.call(this);this.type="Points";this.geometry=void 0!==b?b:new ia;this.material=void 0!==h?h:new Va({color:16777215*
Math.random()})}function yc(){X.call(this);this.type="Group"}function hd(b,h,a,c,d,e,g,f,k){function r(){requestAnimationFrame(r);b.readyState>=b.HAVE_CURRENT_DATA&&(v.needsUpdate=!0)}l.call(this,b,h,a,c,d,e,g,f,k);this.generateMipmaps=!1;var v=this;r()}function Zb(b,h,a,c,d,e,g,f,k,n,m,p){l.call(this,null,e,g,f,k,n,c,d,m,p);this.image={width:h,height:a};this.mipmaps=b;this.generateMipmaps=this.flipY=!1}function id(b,h,a,c,d,e,g,f,k){l.call(this,b,h,a,c,d,e,g,f,k);this.needsUpdate=!0}function zc(b,
h,a,c,d,e,g,f,k,n){n=void 0!==n?n:1026;if(1026!==n&&1027!==n)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");l.call(this,null,c,d,e,g,f,n,a,k);this.image={width:b,height:h};this.type=void 0!==a?a:1012;this.magFilter=void 0!==g?g:1003;this.minFilter=void 0!==f?f:1003;this.generateMipmaps=this.flipY=!1}function $b(b){function h(b,h){return b-h}ia.call(this);var a=[0,0],c={},d=["a","b","c"];if(b&&b.isGeometry){var e=b.vertices,g=b.faces,f=0,k=new Uint32Array(6*
g.length);b=0;for(var l=g.length;b<l;b++)for(var n=g[b],m=0;3>m;m++){a[0]=n[d[m]];a[1]=n[d[(m+1)%3]];a.sort(h);var p=a.toString();void 0===c[p]&&(k[2*f]=a[0],k[2*f+1]=a[1],c[p]=!0,f++)}a=new Float32Array(6*f);b=0;for(l=f;b<l;b++)for(m=0;2>m;m++)c=e[k[2*b+m]],f=6*b+3*m,a[f+0]=c.x,a[f+1]=c.y,a[f+2]=c.z;this.addAttribute("position",new P(a,3))}else if(b&&b.isBufferGeometry){if(null!==b.index){l=b.index.array;e=b.attributes.position;d=b.groups;f=0;0===d.length&&b.addGroup(0,l.length);k=new Uint32Array(2*
l.length);g=0;for(n=d.length;g<n;++g){b=d[g];m=b.start;p=b.count;b=m;for(var q=m+p;b<q;b+=3)for(m=0;3>m;m++)a[0]=l[b+m],a[1]=l[b+(m+1)%3],a.sort(h),p=a.toString(),void 0===c[p]&&(k[2*f]=a[0],k[2*f+1]=a[1],c[p]=!0,f++)}a=new Float32Array(6*f);b=0;for(l=f;b<l;b++)for(m=0;2>m;m++)f=6*b+3*m,c=k[2*b+m],a[f+0]=e.getX(c),a[f+1]=e.getY(c),a[f+2]=e.getZ(c)}else for(e=b.attributes.position.array,f=e.length/3,k=f/3,a=new Float32Array(6*f),b=0,l=k;b<l;b++)for(m=0;3>m;m++)f=18*b+6*m,k=9*b+3*m,a[f+0]=e[k],a[f+
1]=e[k+1],a[f+2]=e[k+2],c=9*b+(m+1)%3*3,a[f+3]=e[c],a[f+4]=e[c+1],a[f+5]=e[c+2];this.addAttribute("position",new P(a,3))}}function Ac(b,h,a){ha.call(this);this.type="ParametricGeometry";this.parameters={func:b,slices:h,stacks:a};var r=this.vertices,c=this.faces,d=this.faceVertexUvs[0],g,f,k,l,m=h+1;for(g=0;g<=a;g++)for(l=g/a,f=0;f<=h;f++)k=f/h,k=b(k,l),r.push(k);var n,p,q,t;for(g=0;g<a;g++)for(f=0;f<h;f++)b=g*m+f,r=g*m+f+1,l=(g+1)*m+f+1,k=(g+1)*m+f,n=new e(f/h,g/a),p=new e((f+1)/h,g/a),q=new e((f+
1)/h,(g+1)/a),t=new e(f/h,(g+1)/a),c.push(new sa(b,r,k)),d.push([n,p,t]),c.push(new sa(r,l,k)),d.push([p.clone(),q,t.clone()]);this.computeFaceNormals();this.computeVertexNormals()}function Ya(b,h,a,c){function r(b){var h=b.normalize().clone();h.index=k.vertices.push(h)-1;h.uv=new e(Math.atan2(b.z,-b.x)/2/Math.PI+.5,1-(Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))/Math.PI+.5));return h}function d(b,h,a){var r=new sa(b.index,h.index,a.index,[b.clone(),h.clone(),a.clone()]);k.faces.push(r);z.copy(b).add(h).add(a).divideScalar(3);
r=Math.atan2(z.z,-z.x);k.faceVertexUvs[0].push([f(b.uv,b,r),f(h.uv,h,r),f(a.uv,a,r)])}function v(b,h){for(var a=Math.pow(2,h),c=r(k.vertices[b.a]),v=r(k.vertices[b.b]),e=r(k.vertices[b.c]),g=[],A=0;A<=a;A++){g[A]=[];for(var f=r(c.clone().lerp(e,A/a)),F=r(v.clone().lerp(e,A/a)),M=a-A,l=0;l<=M;l++)g[A][l]=0===l&&A===a?f:r(f.clone().lerp(F,l/M))}for(A=0;A<a;A++)for(l=0;l<2*(a-A)-1;l++)c=Math.floor(l/2),0===l%2?d(g[A][c+1],g[A+1][c],g[A][c]):d(g[A][c+1],g[A+1][c+1],g[A+1][c])}function f(b,h,a){0>a&&1===
b.x&&(b=new e(b.x-1,b.y));0===h.x&&0===h.z&&(b=new e(a/2/Math.PI+.5,b.y));return b.clone()}ha.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:b,indices:h,radius:a,detail:c};a=a||1;c=c||0;for(var k=this,l=0,m=b.length;l<m;l+=3)r(new g(b[l],b[l+1],b[l+2]));b=this.vertices;for(var n=[],p=l=0,m=h.length;l<m;l+=3,p++){var q=b[h[l]],t=b[h[l+1]],u=b[h[l+2]];n[p]=new sa(q.index,t.index,u.index,[q.clone(),t.clone(),u.clone()])}for(var z=new g,l=0,m=n.length;l<m;l++)v(n[l],c);l=0;for(m=
this.faceVertexUvs[0].length;l<m;l++)h=this.faceVertexUvs[0][l],c=h[0].x,b=h[1].x,n=h[2].x,p=Math.min(c,b,n),.9<Math.max(c,b,n)&&.1>p&&(.2>c&&(h[0].x+=1),.2>b&&(h[1].x+=1),.2>n&&(h[2].x+=1));l=0;for(m=this.vertices.length;l<m;l++)this.vertices[l].multiplyScalar(a);this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new Oa(new g,a)}function Bc(b,h){Ya.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],b,h);this.type="TetrahedronGeometry";this.parameters={radius:b,detail:h}}
function Cc(b,h){Ya.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],b,h);this.type="OctahedronGeometry";this.parameters={radius:b,detail:h}}function Dc(b,h){var a=(1+Math.sqrt(5))/2;Ya.call(this,[-1,a,0,1,a,0,-1,-a,0,1,-a,0,0,-1,a,0,1,a,0,-1,-a,0,1,-a,a,0,-1,a,0,1,-a,0,-1,-a,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],b,h);this.type="IcosahedronGeometry";
this.parameters={radius:b,detail:h}}function Ec(b,h){var a=(1+Math.sqrt(5))/2,c=1/a;Ya.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-c,-a,0,-c,a,0,c,-a,0,c,a,-c,-a,0,-c,a,0,c,-a,0,c,a,0,-a,0,-c,a,0,-c,-a,0,c,a,0,c],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,
5,1,5,9],b,h);this.type="DodecahedronGeometry";this.parameters={radius:b,detail:h}}function Xa(b,h,a,c,d,f){ha.call(this);this.type="TubeGeometry";this.parameters={path:b,segments:h,radius:a,radialSegments:c,closed:d,taper:f};h=h||64;a=a||1;c=c||8;d=d||!1;f=f||Xa.NoTaper;var r=[],v,A,F=h+1,k,l,m,n,p,q=new g,t,u,z;t=new Xa.FrenetFrames(b,h,d);u=t.normals;z=t.binormals;this.tangents=t.tangents;this.normals=u;this.binormals=z;for(t=0;t<F;t++)for(r[t]=[],k=t/(F-1),p=b.getPointAt(k),v=u[t],A=z[t],m=a*
f(k),k=0;k<c;k++)l=k/c*2*Math.PI,n=-m*Math.cos(l),l=m*Math.sin(l),q.copy(p),q.x+=n*v.x+l*A.x,q.y+=n*v.y+l*A.y,q.z+=n*v.z+l*A.z,r[t][k]=this.vertices.push(new g(q.x,q.y,q.z))-1;for(t=0;t<h;t++)for(k=0;k<c;k++)f=d?(t+1)%h:t+1,F=(k+1)%c,b=r[t][k],a=r[f][k],f=r[f][F],F=r[t][F],q=new e(t/h,k/c),u=new e((t+1)/h,k/c),z=new e((t+1)/h,(k+1)/c),v=new e(t/h,(k+1)/c),this.faces.push(new sa(b,a,F)),this.faceVertexUvs[0].push([q,u,v]),this.faces.push(new sa(a,f,F)),this.faceVertexUvs[0].push([u.clone(),z,v.clone()]);
this.computeFaceNormals();this.computeVertexNormals()}function ac(b,h,a,c,d,f){function r(b,h,a,r,c){var d=Math.sin(b);h=a/h*b;a=Math.cos(h);c.x=r*(2+a)*.5*Math.cos(b);c.y=r*(2+a)*d*.5;c.z=r*Math.sin(h)*.5}ia.call(this);this.type="TorusKnotBufferGeometry";this.parameters={radius:b,tube:h,tubularSegments:a,radialSegments:c,p:d,q:f};b=b||100;h=h||40;a=Math.floor(a)||64;c=Math.floor(c)||8;d=d||2;f=f||3;var v=(c+1)*(a+1),A=c*a*6,A=new P(new (65535<A?Uint32Array:Uint16Array)(A),1),F=new P(new Float32Array(3*
v),3),k=new P(new Float32Array(3*v),3),v=new P(new Float32Array(2*v),2),l,m,n=0,p=0,q=new g,t=new g,u=new e,z=new g,y=new g,w=new g,x=new g,D=new g;for(l=0;l<=a;++l)for(m=l/a*d*Math.PI*2,r(m,d,f,b,z),r(m+.01,d,f,b,y),x.subVectors(y,z),D.addVectors(y,z),w.crossVectors(x,D),D.crossVectors(w,x),w.normalize(),D.normalize(),m=0;m<=c;++m){var C=m/c*Math.PI*2,B=-h*Math.cos(C),C=h*Math.sin(C);q.x=z.x+(B*D.x+C*w.x);q.y=z.y+(B*D.y+C*w.y);q.z=z.z+(B*D.z+C*w.z);F.setXYZ(n,q.x,q.y,q.z);t.subVectors(q,z).normalize();
k.setXYZ(n,t.x,t.y,t.z);u.x=l/a;u.y=m/c;v.setXY(n,u.x,u.y);n++}for(m=1;m<=a;m++)for(l=1;l<=c;l++)b=(c+1)*m+(l-1),h=(c+1)*m+l,d=(c+1)*(m-1)+l,A.setX(p,(c+1)*(m-1)+(l-1)),p++,A.setX(p,b),p++,A.setX(p,d),p++,A.setX(p,b),p++,A.setX(p,h),p++,A.setX(p,d),p++;this.setIndex(A);this.addAttribute("position",F);this.addAttribute("normal",k);this.addAttribute("uv",v)}function Fc(b,h,a,c,d,e,g){ha.call(this);this.type="TorusKnotGeometry";this.parameters={radius:b,tube:h,tubularSegments:a,radialSegments:c,p:d,
q:e};void 0!==g&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.");this.fromBufferGeometry(new ac(b,h,a,c,d,e));this.mergeVertices()}function bc(b,h,a,c,d){ia.call(this);this.type="TorusBufferGeometry";this.parameters={radius:b,tube:h,radialSegments:a,tubularSegments:c,arc:d};b=b||100;h=h||40;a=Math.floor(a)||8;c=Math.floor(c)||6;d=d||2*Math.PI;var r=(a+1)*(c+1),v=a*c*6,v=new (65535<v?Uint32Array:Uint16Array)(v),e=new Float32Array(3*r),A=new Float32Array(3*
r),r=new Float32Array(2*r),f=0,k=0,l=0,m=new g,n=new g,p=new g,q,t;for(q=0;q<=a;q++)for(t=0;t<=c;t++){var u=t/c*d,z=q/a*Math.PI*2;n.x=(b+h*Math.cos(z))*Math.cos(u);n.y=(b+h*Math.cos(z))*Math.sin(u);n.z=h*Math.sin(z);e[f]=n.x;e[f+1]=n.y;e[f+2]=n.z;m.x=b*Math.cos(u);m.y=b*Math.sin(u);p.subVectors(n,m).normalize();A[f]=p.x;A[f+1]=p.y;A[f+2]=p.z;r[k]=t/c;r[k+1]=q/a;f+=3;k+=2}for(q=1;q<=a;q++)for(t=1;t<=c;t++)b=(c+1)*(q-1)+t-1,h=(c+1)*(q-1)+t,d=(c+1)*q+t,v[l]=(c+1)*q+t-1,v[l+1]=b,v[l+2]=d,v[l+3]=b,v[l+
4]=h,v[l+5]=d,l+=6;this.setIndex(new P(v,1));this.addAttribute("position",new P(e,3));this.addAttribute("normal",new P(A,3));this.addAttribute("uv",new P(r,2))}function Gc(b,h,a,c,d){ha.call(this);this.type="TorusGeometry";this.parameters={radius:b,tube:h,radialSegments:a,tubularSegments:c,arc:d};this.fromBufferGeometry(new bc(b,h,a,c,d))}function Za(b,h){"undefined"!==typeof b&&(ha.call(this),this.type="ExtrudeGeometry",b=Array.isArray(b)?b:[b],this.addShapeList(b,h),this.computeFaceNormals())}function Hc(b,
h){h=h||{};var a=h.font;if(!1===(a&&a.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new ha;a=a.generateShapes(b,h.size,h.curveSegments);h.amount=void 0!==h.height?h.height:50;void 0===h.bevelThickness&&(h.bevelThickness=10);void 0===h.bevelSize&&(h.bevelSize=8);void 0===h.bevelEnabled&&(h.bevelEnabled=!1);Za.call(this,a,h);this.type="TextGeometry"}function Cb(b,h,a,c,d,e,f){ia.call(this);this.type="SphereBufferGeometry";this.parameters={radius:b,
widthSegments:h,heightSegments:a,phiStart:c,phiLength:d,thetaStart:e,thetaLength:f};b=b||50;h=Math.max(3,Math.floor(h)||8);a=Math.max(2,Math.floor(a)||6);c=void 0!==c?c:0;d=void 0!==d?d:2*Math.PI;e=void 0!==e?e:0;f=void 0!==f?f:Math.PI;for(var r=e+f,v=(h+1)*(a+1),A=new P(new Float32Array(3*v),3),F=new P(new Float32Array(3*v),3),v=new P(new Float32Array(2*v),2),k=0,l=[],M=new g,m=0;m<=a;m++){for(var n=[],p=m/a,q=0;q<=h;q++){var t=q/h,u=-b*Math.cos(c+t*d)*Math.sin(e+p*f),z=b*Math.cos(e+p*f),w=b*Math.sin(c+
t*d)*Math.sin(e+p*f);M.set(u,z,w).normalize();A.setXYZ(k,u,z,w);F.setXYZ(k,M.x,M.y,M.z);v.setXY(k,t,1-p);n.push(k);k++}l.push(n)}c=[];for(m=0;m<a;m++)for(q=0;q<h;q++)d=l[m][q+1],f=l[m][q],k=l[m+1][q],M=l[m+1][q+1],(0!==m||0<e)&&c.push(d,f,M),(m!==a-1||r<Math.PI)&&c.push(f,k,M);this.setIndex(new (65535<A.count?Wb:bd)(c,1));this.addAttribute("position",A);this.addAttribute("normal",F);this.addAttribute("uv",v);this.boundingSphere=new Oa(new g,b)}function cc(b,h,a,c,d,e,g){ha.call(this);this.type="SphereGeometry";
this.parameters={radius:b,widthSegments:h,heightSegments:a,phiStart:c,phiLength:d,thetaStart:e,thetaLength:g};this.fromBufferGeometry(new Cb(b,h,a,c,d,e,g))}function dc(b,h,a,c,d,f){ia.call(this);this.type="RingBufferGeometry";this.parameters={innerRadius:b,outerRadius:h,thetaSegments:a,phiSegments:c,thetaStart:d,thetaLength:f};b=b||20;h=h||50;d=void 0!==d?d:0;f=void 0!==f?f:2*Math.PI;a=void 0!==a?Math.max(3,a):8;c=void 0!==c?Math.max(1,c):1;var r=(a+1)*(c+1),v=a*c*6,v=new P(new (65535<v?Uint32Array:
Uint16Array)(v),1),A=new P(new Float32Array(3*r),3),F=new P(new Float32Array(3*r),3),r=new P(new Float32Array(2*r),2),k=0,l=0,m,n=b,p=(h-b)/c,q=new g,t=new e,u;for(b=0;b<=c;b++){for(u=0;u<=a;u++)m=d+u/a*f,q.x=n*Math.cos(m),q.y=n*Math.sin(m),A.setXYZ(k,q.x,q.y,q.z),F.setXYZ(k,0,0,1),t.x=(q.x/h+1)/2,t.y=(q.y/h+1)/2,r.setXY(k,t.x,t.y),k++;n+=p}for(b=0;b<c;b++)for(h=b*(a+1),u=0;u<a;u++)d=m=u+h,f=m+a+1,k=m+a+2,m+=1,v.setX(l,d),l++,v.setX(l,f),l++,v.setX(l,k),l++,v.setX(l,d),l++,v.setX(l,k),l++,v.setX(l,
m),l++;this.setIndex(v);this.addAttribute("position",A);this.addAttribute("normal",F);this.addAttribute("uv",r)}function Ic(b,h,a,c,d,e){ha.call(this);this.type="RingGeometry";this.parameters={innerRadius:b,outerRadius:h,thetaSegments:a,phiSegments:c,thetaStart:d,thetaLength:e};this.fromBufferGeometry(new dc(b,h,a,c,d,e))}function Jc(b,h,a,c){ha.call(this);this.type="PlaneGeometry";this.parameters={width:b,height:h,widthSegments:a,heightSegments:c};this.fromBufferGeometry(new ab(b,h,a,c))}function ec(b,
h,a,c){ia.call(this);this.type="LatheBufferGeometry";this.parameters={points:b,segments:h,phiStart:a,phiLength:c};h=Math.floor(h)||12;a=a||0;c=c||2*Math.PI;c=k.Math.clamp(c,0,2*Math.PI);for(var r=(h+1)*b.length,d=h*b.length*6,v=new P(new (65535<d?Uint32Array:Uint16Array)(d),1),f=new P(new Float32Array(3*r),3),l=new P(new Float32Array(2*r),2),m=0,n=0,p=1/h,q=new g,t=new e,r=0;r<=h;r++)for(var d=a+r*p*c,u=Math.sin(d),z=Math.cos(d),d=0;d<=b.length-1;d++)q.x=b[d].x*u,q.y=b[d].y,q.z=b[d].x*z,f.setXYZ(m,
q.x,q.y,q.z),t.x=r/h,t.y=d/(b.length-1),l.setXY(m,t.x,t.y),m++;for(r=0;r<h;r++)for(d=0;d<b.length-1;d++)a=d+r*b.length,m=a+b.length,p=a+b.length+1,q=a+1,v.setX(n,a),n++,v.setX(n,m),n++,v.setX(n,q),n++,v.setX(n,m),n++,v.setX(n,p),n++,v.setX(n,q),n++;this.setIndex(v);this.addAttribute("position",f);this.addAttribute("uv",l);this.computeVertexNormals();if(c===2*Math.PI)for(c=this.attributes.normal.array,v=new g,f=new g,l=new g,a=h*b.length*3,d=r=0;r<b.length;r++,d+=3)v.x=c[d+0],v.y=c[d+1],v.z=c[d+2],
f.x=c[a+d+0],f.y=c[a+d+1],f.z=c[a+d+2],l.addVectors(v,f).normalize(),c[d+0]=c[a+d+0]=l.x,c[d+1]=c[a+d+1]=l.y,c[d+2]=c[a+d+2]=l.z}function Kc(b,h,a,c){ha.call(this);this.type="LatheGeometry";this.parameters={points:b,segments:h,phiStart:a,phiLength:c};this.fromBufferGeometry(new ec(b,h,a,c));this.mergeVertices()}function vb(b,h){ha.call(this);this.type="ShapeGeometry";!1===Array.isArray(b)&&(b=[b]);this.addShapeList(b,h);this.computeFaceNormals()}function fc(b,h){function a(b,h){return b-h}ia.call(this);
var c=Math.cos(k.Math.DEG2RAD*(void 0!==h?h:1)),d=[0,0],e={},g=["a","b","c"],f;b&&b.isBufferGeometry?(f=new ha,f.fromBufferGeometry(b)):f=b.clone();f.mergeVertices();f.computeFaceNormals();var l=f.vertices;f=f.faces;for(var m=0,n=f.length;m<n;m++)for(var p=f[m],q=0;3>q;q++){d[0]=p[g[q]];d[1]=p[g[(q+1)%3]];d.sort(a);var t=d.toString();void 0===e[t]?e[t]={vert1:d[0],vert2:d[1],face1:m,face2:void 0}:e[t].face2=m}d=[];for(t in e)if(g=e[t],void 0===g.face2||f[g.face1].normal.dot(f[g.face2].normal)<=c)m=
l[g.vert1],d.push(m.x),d.push(m.y),d.push(m.z),m=l[g.vert2],d.push(m.x),d.push(m.y),d.push(m.z);this.addAttribute("position",new P(new Float32Array(d),3))}function wb(b,h,a,c,d,f,k,l){function r(a){var r,d,f,A=new e,F=new g,M=0,da=!0===a?b:h,u=!0===a?1:-1;d=q;for(r=1;r<=c;r++)n.setXYZ(q,0,z*u,0),Q.setXYZ(q,0,u,0),A.x=.5,A.y=.5,p.setXY(q,A.x,A.y),q++;f=q;for(r=0;r<=c;r++){var U=r/c*l+k,Ea=Math.cos(U),U=Math.sin(U);F.x=da*U;F.y=z*u;F.z=da*Ea;n.setXYZ(q,F.x,F.y,F.z);Q.setXYZ(q,0,u,0);A.x=.5*Ea+.5;A.y=
.5*U*u+.5;p.setXY(q,A.x,A.y);q++}for(r=0;r<c;r++)A=d+r,F=f+r,!0===a?(m.setX(t,F),t++,m.setX(t,F+1)):(m.setX(t,F+1),t++,m.setX(t,F)),t++,m.setX(t,A),t++,M+=3;v.addGroup(w,M,!0===a?1:2);w+=M}ia.call(this);this.type="CylinderBufferGeometry";this.parameters={radiusTop:b,radiusBottom:h,height:a,radialSegments:c,heightSegments:d,openEnded:f,thetaStart:k,thetaLength:l};var v=this;b=void 0!==b?b:20;h=void 0!==h?h:20;a=void 0!==a?a:100;c=Math.floor(c)||8;d=Math.floor(d)||1;f=void 0!==f?f:!1;k=void 0!==k?k:
0;l=void 0!==l?l:2*Math.PI;var A=0;!1===f&&(0<b&&A++,0<h&&A++);var F=function(){var b=(c+1)*(d+1);!1===f&&(b+=(c+1)*A+c*A);return b}(),M=function(){var b=c*d*6;!1===f&&(b+=c*A*3);return b}(),m=new P(new (65535<M?Uint32Array:Uint16Array)(M),1),n=new P(new Float32Array(3*F),3),Q=new P(new Float32Array(3*F),3),p=new P(new Float32Array(2*F),2),q=0,t=0,u=[],z=a/2,w=0;(function(){var r,e,f=new g,A=new g,F=0,M=(h-b)/a;for(e=0;e<=d;e++){var da=[],U=e/d,Ea=U*(h-b)+b;for(r=0;r<=c;r++){var Y=r/c,na=Y*l+k,ta=
Math.sin(na),na=Math.cos(na);A.x=Ea*ta;A.y=-U*a+z;A.z=Ea*na;n.setXYZ(q,A.x,A.y,A.z);f.set(ta,M,na).normalize();Q.setXYZ(q,f.x,f.y,f.z);p.setXY(q,Y,1-U);da.push(q);q++}u.push(da)}for(r=0;r<c;r++)for(e=0;e<d;e++)f=u[e+1][r],A=u[e+1][r+1],M=u[e][r+1],m.setX(t,u[e][r]),t++,m.setX(t,f),t++,m.setX(t,M),t++,m.setX(t,f),t++,m.setX(t,A),t++,m.setX(t,M),t++,F+=6;v.addGroup(w,F,0);w+=F})();!1===f&&(0<b&&r(!0),0<h&&r(!1));this.setIndex(m);this.addAttribute("position",n);this.addAttribute("normal",Q);this.addAttribute("uv",
p)}function Db(b,h,a,c,d,e,g,f){ha.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:b,radiusBottom:h,height:a,radialSegments:c,heightSegments:d,openEnded:e,thetaStart:g,thetaLength:f};this.fromBufferGeometry(new wb(b,h,a,c,d,e,g,f));this.mergeVertices()}function Lc(b,h,a,c,d,e,g){Db.call(this,0,b,h,a,c,d,e,g);this.type="ConeGeometry";this.parameters={radius:b,height:h,radialSegments:a,heightSegments:c,openEnded:d,thetaStart:e,thetaLength:g}}function Mc(b,h,a,c,d,e,g){wb.call(this,
0,b,h,a,c,d,e,g);this.type="ConeBufferGeometry";this.parameters={radius:b,height:h,radialSegments:a,heightSegments:c,thetaStart:e,thetaLength:g}}function gc(b,h,a,c){ia.call(this);this.type="CircleBufferGeometry";this.parameters={radius:b,segments:h,thetaStart:a,thetaLength:c};b=b||50;h=void 0!==h?Math.max(3,h):8;a=void 0!==a?a:0;c=void 0!==c?c:2*Math.PI;var r=h+2,d=new Float32Array(3*r),v=new Float32Array(3*r),r=new Float32Array(2*r);v[2]=1;r[0]=.5;r[1]=.5;for(var e=0,f=3,k=2;e<=h;e++,f+=3,k+=2){var l=
a+e/h*c;d[f]=b*Math.cos(l);d[f+1]=b*Math.sin(l);v[f+2]=1;r[k]=(d[f]/b+1)/2;r[k+1]=(d[f+1]/b+1)/2}a=[];for(f=1;f<=h;f++)a.push(f,f+1,0);this.setIndex(new P(new Uint16Array(a),1));this.addAttribute("position",new P(d,3));this.addAttribute("normal",new P(v,3));this.addAttribute("uv",new P(r,2));this.boundingSphere=new Oa(new g,b)}function Nc(b,h,a,c){ha.call(this);this.type="CircleGeometry";this.parameters={radius:b,segments:h,thetaStart:a,thetaLength:c};this.fromBufferGeometry(new gc(b,h,a,c))}function Eb(b,
h,a,c,d,e){ha.call(this);this.type="BoxGeometry";this.parameters={width:b,height:h,depth:a,widthSegments:c,heightSegments:d,depthSegments:e};this.fromBufferGeometry(new hb(b,h,a,c,d,e));this.mergeVertices()}function hc(){Ba.call(this,{uniforms:k.UniformsUtils.merge([ka.lights,{opacity:{value:1}}]),vertexShader:ua.shadow_vert,fragmentShader:ua.shadow_frag});this.transparent=this.lights=!0;Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(b){this.uniforms.opacity.value=
b}}})}function ic(b){Ba.call(this,b);this.type="RawShaderMaterial"}function Oc(b){this.uuid=k.Math.generateUUID();this.type="MultiMaterial";this.materials=b instanceof Array?b:[];this.visible=!0}function jb(b){aa.call(this);this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=new O(16777215);this.metalness=this.roughness=.5;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new O(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=
null;this.bumpScale=1;this.normalMap=null;this.normalScale=new e(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(b)}function Fb(b){jb.call(this);this.defines={PHYSICAL:""};this.type="MeshPhysicalMaterial";
this.reflectivity=.5;this.clearCoatRoughness=this.clearCoat=0;this.setValues(b)}function xb(b){aa.call(this);this.type="MeshPhongMaterial";this.color=new O(16777215);this.specular=new O(1118481);this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new O(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new e(1,1);this.displacementMap=null;this.displacementScale=
1;this.displacementBias=0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(b)}function Gb(b){aa.call(this,b);this.type="MeshNormalMaterial";this.wireframe=!1;this.wireframeLinewidth=1;this.morphTargets=this.lights=this.fog=!1;this.setValues(b)}function Hb(b){aa.call(this);this.type=
"MeshLambertMaterial";this.color=new O(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new O(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(b)}function Ib(b){aa.call(this);
this.type="LineDashedMaterial";this.color=new O(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.lights=!1;this.setValues(b)}function Id(b,h,a){var c=this,r=!1,d=0,e=0;this.onStart=void 0;this.onLoad=b;this.onProgress=h;this.onError=a;this.itemStart=function(b){e++;if(!1===r&&void 0!==c.onStart)c.onStart(b,d,e);r=!0};this.itemEnd=function(b){d++;if(void 0!==c.onProgress)c.onProgress(b,d,e);if(d===e&&(r=!1,void 0!==c.onLoad))c.onLoad()};this.itemError=function(b){if(void 0!==
c.onError)c.onError(b)}}function Ta(b){this.manager=void 0!==b?b:k.DefaultLoadingManager}function qe(b){this.manager=void 0!==b?b:k.DefaultLoadingManager;this._parser=null}function Jd(b){this.manager=void 0!==b?b:k.DefaultLoadingManager;this._parser=null}function Pc(b){this.manager=void 0!==b?b:k.DefaultLoadingManager}function Kd(b){this.manager=void 0!==b?b:k.DefaultLoadingManager}function jd(b){this.manager=void 0!==b?b:k.DefaultLoadingManager}function Ca(b,h){X.call(this);this.type="Light";this.color=
new O(b);this.intensity=void 0!==h?h:1;this.receiveShadow=void 0}function kd(b,h,a){Ca.call(this,b,a);this.type="HemisphereLight";this.castShadow=void 0;this.position.copy(X.DefaultUp);this.updateMatrix();this.groundColor=new O(h)}function Jb(b){this.camera=b;this.bias=0;this.radius=1;this.mapSize=new e(512,512);this.map=null;this.matrix=new n}function ld(){Jb.call(this,new Sa(50,1,.5,500))}function md(b,h,a,c,d,e){Ca.call(this,b,h);this.type="SpotLight";this.position.copy(X.DefaultUp);this.updateMatrix();
this.target=new X;Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(b){this.intensity=b/Math.PI}});this.distance=void 0!==a?a:0;this.angle=void 0!==c?c:Math.PI/3;this.penumbra=void 0!==d?d:0;this.decay=void 0!==e?e:1;this.shadow=new ld}function nd(b,a,c,d){Ca.call(this,b,a);this.type="PointLight";Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(b){this.intensity=b/(4*Math.PI)}});this.distance=void 0!==c?c:
0;this.decay=void 0!==d?d:1;this.shadow=new Jb(new Sa(90,1,.5,500))}function od(b){Jb.call(this,new eb(-5,5,5,-5,.5,500))}function pd(b,a){Ca.call(this,b,a);this.type="DirectionalLight";this.position.copy(X.DefaultUp);this.updateMatrix();this.target=new X;this.shadow=new od}function qd(b,a){Ca.call(this,b,a);this.type="AmbientLight";this.castShadow=void 0}function Ua(b,a,c,d){this.parameterPositions=b;this._cachedIndex=0;this.resultBuffer=void 0!==d?d:new a.constructor(c);this.sampleValues=a;this.valueSize=
c}function rd(b,a,c,d){Ua.call(this,b,a,c,d);this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function Qc(b,a,c,d){Ua.call(this,b,a,c,d)}function sd(b,a,c,d){Ua.call(this,b,a,c,d)}function Kb(b,a,c,d){if(void 0===b)throw Error("track name is undefined");if(void 0===a||0===a.length)throw Error("no keyframes in track named "+b);this.name=b;this.times=k.AnimationUtils.convertArray(a,this.TimeBufferType);this.values=k.AnimationUtils.convertArray(c,this.ValueBufferType);this.setInterpolation(d||
this.DefaultInterpolation);this.validate();this.optimize()}function jc(b,a,c,d){Kb.call(this,b,a,c,d)}function td(b,a,c,d){Ua.call(this,b,a,c,d)}function Rc(b,a,c,d){Kb.call(this,b,a,c,d)}function kc(b,a,c,d){Kb.call(this,b,a,c,d)}function ud(b,a,c,d){Kb.call(this,b,a,c,d)}function vd(b,a,c){Kb.call(this,b,a,c)}function wd(b,a,c,d){Kb.call(this,b,a,c,d)}function Lb(b,a,c,d){Kb.apply(this,arguments)}function $a(b,a,c){this.name=b;this.tracks=c;this.duration=void 0!==a?a:-1;this.uuid=k.Math.generateUUID();
0>this.duration&&this.resetDuration();this.optimize()}function xd(b){this.manager=void 0!==b?b:k.DefaultLoadingManager;this.textures={}}function Ld(b){this.manager=void 0!==b?b:k.DefaultLoadingManager}function Mb(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}}function Md(b){"boolean"===typeof b&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),b=void 0);this.manager=void 0!==b?b:k.DefaultLoadingManager;this.withCredentials=
!1}function re(b){this.manager=void 0!==b?b:k.DefaultLoadingManager;this.texturePath=""}function wa(){}function kb(b,a){this.v1=b;this.v2=a}function Sc(){this.curves=[];this.autoClose=!1}function rb(b,a,c,d,e,g,f,k){this.aX=b;this.aY=a;this.xRadius=c;this.yRadius=d;this.aStartAngle=e;this.aEndAngle=g;this.aClockwise=f;this.aRotation=k||0}function Nb(b){this.points=void 0===b?[]:b}function Ob(b,a,c,d){this.v0=b;this.v1=a;this.v2=c;this.v3=d}function Pb(b,a,c){this.v0=b;this.v1=a;this.v2=c}function Qb(){Tc.apply(this,
arguments);this.holes=[]}function Tc(b){Sc.call(this);this.currentPoint=new e;b&&this.fromPoints(b)}function Nd(){this.subPaths=[];this.currentPath=null}function Od(b){this.data=b}function se(b){this.manager=void 0!==b?b:k.DefaultLoadingManager}function Pd(){void 0===Qd&&(Qd=new (window.AudioContext||window.webkitAudioContext));return Qd}function Rd(b){this.manager=void 0!==b?b:k.DefaultLoadingManager}function te(){this.type="StereoCamera";this.aspect=1;this.eyeSep=.064;this.cameraL=new Sa;this.cameraL.layers.enable(1);
this.cameraL.matrixAutoUpdate=!1;this.cameraR=new Sa;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=!1}function yd(b,a,c){X.call(this);this.type="CubeCamera";var h=new Sa(90,1,b,a);h.up.set(0,-1,0);h.lookAt(new g(1,0,0));this.add(h);var r=new Sa(90,1,b,a);r.up.set(0,-1,0);r.lookAt(new g(-1,0,0));this.add(r);var e=new Sa(90,1,b,a);e.up.set(0,0,1);e.lookAt(new g(0,1,0));this.add(e);var f=new Sa(90,1,b,a);f.up.set(0,0,-1);f.lookAt(new g(0,-1,0));this.add(f);var k=new Sa(90,1,b,a);k.up.set(0,
-1,0);k.lookAt(new g(0,0,1));this.add(k);var l=new Sa(90,1,b,a);l.up.set(0,-1,0);l.lookAt(new g(0,0,-1));this.add(l);this.renderTarget=new d(c,c,{format:1022,magFilter:1006,minFilter:1006});this.updateCubeMap=function(b,a){null===this.parent&&this.updateMatrixWorld();var c=this.renderTarget,d=c.texture.generateMipmaps;c.texture.generateMipmaps=!1;c.activeCubeFace=0;b.render(a,h,c);c.activeCubeFace=1;b.render(a,r,c);c.activeCubeFace=2;b.render(a,e,c);c.activeCubeFace=3;b.render(a,f,c);c.activeCubeFace=
4;b.render(a,k,c);c.texture.generateMipmaps=d;c.activeCubeFace=5;b.render(a,l,c);b.setRenderTarget(null)}}function Sd(){X.call(this);this.type="AudioListener";this.context=Pd();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null}function lc(b){X.call(this);this.type="Audio";this.context=b.context;this.source=this.context.createBufferSource();this.source.onended=this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(b.getInput());
this.autoplay=!1;this.startTime=0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=!0;this.sourceType="empty";this.filters=[]}function Td(b){lc.call(this,b);this.panner=this.context.createPanner();this.panner.connect(this.gain)}function Ud(b,a){this.analyser=b.context.createAnalyser();this.analyser.fftSize=void 0!==a?a:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);b.getOutput().connect(this.analyser)}function zd(b,a,c){this.binding=b;this.valueSize=c;b=Float64Array;switch(a){case "quaternion":a=
this._slerp;break;case "string":case "bool":b=Array;a=this._select;break;default:a=this._lerp}this.buffer=new b(4*c);this._mixBufferRegion=a;this.referenceCount=this.useCount=this.cumulativeWeight=0}function va(b,a,c){this.path=a;this.parsedPath=c||va.parseTrackName(a);this.node=va.findNode(b,this.parsedPath.nodeName)||b;this.rootNode=b}function Vd(b){this.uuid=k.Math.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var a={};this._indicesByUUID=a;for(var c=
0,d=arguments.length;c!==d;++c)a[arguments[c].uuid]=c;this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}function Wd(b,a,c){this._mixer=b;this._clip=a;this._localRoot=c||null;b=a.tracks;a=b.length;c=Array(a);for(var h={endingStart:2400,endingEnd:2400},r=0;r!==a;++r){var d=b[r].createInterpolant(null);
c[r]=d;d.settings=h}this._interpolantSettings=h;this._interpolants=c;this._propertyBindings=Array(a);this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null;this.loop=2201;this._loopCount=-1;this._startTime=null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function Xd(b){this._root=b;this._initMemoryManager();
this.time=this._accuIndex=0;this.timeScale=1}function Yd(b,a){"string"===typeof b&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),b=a);this.value=b;this.dynamic=!1}function Rb(){ia.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=void 0}function Zd(b,a,c,d){this.uuid=k.Math.generateUUID();this.data=b;this.itemSize=a;this.offset=c;this.normalized=!0===d}function mc(b,a){this.uuid=k.Math.generateUUID();this.array=b;this.stride=a;this.count=void 0!==b?b.length/
a:0;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0}function nc(b,a,c){mc.call(this,b,a);this.meshPerAttribute=c||1}function oc(b,a,c){P.call(this,b,a);this.meshPerAttribute=c||1}function $d(b,a,c,d){this.ray=new fb(b,a);this.near=c||0;this.far=d||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})}
function ue(b,a){return b.distance-a.distance}function ae(b,a,c,d){if(!1!==b.visible&&(b.raycast(a,c),!0===d)){b=b.children;d=0;for(var h=b.length;d<h;d++)ae(b[d],a,c,!0)}}function be(b){this.autoStart=void 0!==b?b:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1}function ce(b,a,c){this.radius=void 0!==b?b:1;this.phi=void 0!==a?a:0;this.theta=void 0!==c?c:0;return this}function ya(b,a){Da.call(this,b,a);this.animationsMap={};this.animationsList=[];var h=this.geometry.morphTargets.length;
this.createAnimation("__default",0,h-1,h/1);this.setAnimationWeight("__default",1)}function Uc(b){X.call(this);this.material=b;this.render=function(b){}}function Vc(b,a,c,d){this.object=b;this.size=void 0!==a?a:1;b=void 0!==c?c:16711680;d=void 0!==d?d:1;a=0;(c=this.object.geometry)&&c.isGeometry?a=3*c.faces.length:c&&c.isBufferGeometry&&(a=c.attributes.normal.count);c=new ia;a=new Ja(6*a,3);c.addAttribute("position",a);Ia.call(this,c,new Ha({color:b,linewidth:d}));this.matrixAutoUpdate=!1;this.update()}
function pc(b){X.call(this);this.light=b;this.light.updateMatrixWorld();this.matrix=b.matrixWorld;this.matrixAutoUpdate=!1;b=new ia;for(var a=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],c=0,d=1;32>c;c++,d++){var e=c/32*Math.PI*2,g=d/32*Math.PI*2;a.push(Math.cos(e),Math.sin(e),1,Math.cos(g),Math.sin(g),1)}b.addAttribute("position",new Ja(a,3));a=new Ha({fog:!1});this.cone=new Ia(b,a);this.add(this.cone);this.update()}function qc(b){this.bones=this.getBoneList(b);for(var a=new ha,
c=0;c<this.bones.length;c++){var d=this.bones[c];d.parent&&d.parent.isBone&&(a.vertices.push(new g),a.vertices.push(new g),a.colors.push(new O(0,0,1)),a.colors.push(new O(0,1,0)))}a.dynamic=!0;c=new Ha({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});Ia.call(this,a,c);this.root=b;this.matrix=b.matrixWorld;this.matrixAutoUpdate=!1;this.update()}function rc(b,a){this.light=b;this.light.updateMatrixWorld();var h=new Cb(a,4,2),c=new Pa({wireframe:!0,fog:!1});c.color.copy(this.light.color).multiplyScalar(this.light.intensity);
Da.call(this,h,c);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1}function sc(b,a){X.call(this);this.light=b;this.light.updateMatrixWorld();this.matrix=b.matrixWorld;this.matrixAutoUpdate=!1;this.colors=[new O,new O];var h=new cc(a,4,2);h.rotateX(-Math.PI/2);for(var c=0;8>c;c++)h.faces[c].color=this.colors[4>c?0:1];c=new Pa({vertexColors:1,wireframe:!0});this.lightSphere=new Da(h,c);this.add(this.lightSphere);this.update()}function Wc(b,a,c,d){a=a||1;c=new O(void 0!==c?c:4473924);d=new O(void 0!==
d?d:8947848);for(var h=a/2,r=2*b/a,v=[],e=[],g=0,f=0,k=-b;g<=a;g++,k+=r){v.push(-b,0,k,b,0,k);v.push(k,0,-b,k,0,b);var l=g===h?c:d;l.toArray(e,f);f+=3;l.toArray(e,f);f+=3;l.toArray(e,f);f+=3;l.toArray(e,f);f+=3}b=new ia;b.addAttribute("position",new Ja(v,3));b.addAttribute("color",new Ja(e,3));v=new Ha({vertexColors:2});Ia.call(this,b,v)}function Xc(b,a,c,d){this.object=b;this.size=void 0!==a?a:1;b=void 0!==c?c:16776960;d=void 0!==d?d:1;a=0;(c=this.object.geometry)&&c.isGeometry?a=c.faces.length:
console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");c=new ia;a=new Ja(6*a,3);c.addAttribute("position",a);Ia.call(this,c,new Ha({color:b,linewidth:d}));this.matrixAutoUpdate=!1;this.update()}function tc(b,a){X.call(this);this.light=b;this.light.updateMatrixWorld();this.matrix=b.matrixWorld;this.matrixAutoUpdate=!1;void 0===a&&(a=1);var h=new ia;h.addAttribute("position",new Ja([-a,a,0,a,a,0,a,-a,0,-a,-a,0,-a,a,0],3));var c=new Ha({fog:!1});
this.add(new qb(h,c));h=new ia;h.addAttribute("position",new Ja([0,0,0,0,0,1],3));this.add(new qb(h,c));this.update()}function Yc(b){function a(b,a,h){c(b,h);c(a,h)}function c(b,a){d.vertices.push(new g);d.colors.push(new O(a));void 0===f[b]&&(f[b]=[]);f[b].push(d.vertices.length-1)}var d=new ha,e=new Ha({color:16777215,vertexColors:1}),f={};a("n1","n2",16755200);a("n2","n4",16755200);a("n4","n3",16755200);a("n3","n1",16755200);a("f1","f2",16755200);a("f2","f4",16755200);a("f4","f3",16755200);a("f3",
"f1",16755200);a("n1","f1",16755200);a("n2","f2",16755200);a("n3","f3",16755200);a("n4","f4",16755200);a("p","n1",16711680);a("p","n2",16711680);a("p","n3",16711680);a("p","n4",16711680);a("u1","u2",43775);a("u2","u3",43775);a("u3","u1",43775);a("c","t",16777215);a("p","c",3355443);a("cn1","cn2",3355443);a("cn3","cn4",3355443);a("cf1","cf2",3355443);a("cf3","cf4",3355443);Ia.call(this,d,e);this.camera=b;this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix();this.matrix=b.matrixWorld;
this.matrixAutoUpdate=!1;this.pointMap=f;this.update()}function Zc(b,a){var h=void 0!==a?a:8947848;this.object=b;this.box=new ra;Da.call(this,new Eb(1,1,1),new Pa({color:h,wireframe:!0}))}function $c(b,a){void 0===a&&(a=16776960);var h=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),c=new Float32Array(24),d=new ia;d.setIndex(new P(h,1));d.addAttribute("position",new P(c,3));Ia.call(this,d,new Ha({color:a}));void 0!==b&&this.update(b)}function Sb(b,a,c,d,e,g){X.call(this);void 0===
d&&(d=16776960);void 0===c&&(c=1);void 0===e&&(e=.2*c);void 0===g&&(g=.2*e);this.position.copy(a);this.line=new qb(ve,new Ha({color:d}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new Da(we,new Pa({color:d}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(b);this.setLength(c,e,g)}function Ad(b){b=b||1;var a=new Float32Array([0,0,0,b,0,0,0,0,0,0,b,0,0,0,0,0,0,b]),c=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);b=new ia;b.addAttribute("position",new P(a,
3));b.addAttribute("color",new P(c,3));a=new Ha({vertexColors:2});Ia.call(this,b,a)}function xe(b){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Please use THREE.CatmullRomCurve3.");k.CatmullRomCurve3.call(this,b);this.type="catmullrom";this.closed=!0}function Bd(b,a,c,d,e,g){rb.call(this,b,a,c,c,d,e,g)}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===Math.sign&&(Math.sign=function(b){return 0>b?-1:0<b?1:+b});void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,
"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}});void 0===Object.assign&&function(){Object.assign=function(b){if(void 0===b||null===b)throw new TypeError("Cannot convert undefined or null to object");for(var a=Object(b),c=1;c<arguments.length;c++){var d=arguments[c];if(void 0!==d&&null!==d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(a[e]=d[e])}return a}}();Object.assign(c.prototype,{addEventListener:function(b,a){void 0===this._listeners&&(this._listeners=
{});var h=this._listeners;void 0===h[b]&&(h[b]=[]);-1===h[b].indexOf(a)&&h[b].push(a)},hasEventListener:function(b,a){if(void 0===this._listeners)return!1;var h=this._listeners;return void 0!==h[b]&&-1!==h[b].indexOf(a)?!0:!1},removeEventListener:function(b,a){if(void 0!==this._listeners){var h=this._listeners[b];if(void 0!==h){var c=h.indexOf(a);-1!==c&&h.splice(c,1)}}},dispatchEvent:function(b){if(void 0!==this._listeners){var a=this._listeners[b.type];if(void 0!==a){b.target=this;var c=[],d,e=
a.length;for(d=0;d<e;d++)c[d]=a[d];for(d=0;d<e;d++)c[d].call(this,b)}}}});var ye={NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},ze={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},de={RepeatWrapping:1E3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},ee=
{NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008};k.Math={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=Array(36),c=0,d;return function(){for(var h=0;36>h;h++)8===h||13===h||18===h||23===h?a[h]="-":14===h?a[h]="4":(2>=c&&(c=33554432+16777216*Math.random()|0),d=c&15,c>>=4,a[h]=b[19===h?d&
3|8:d]);return a.join("")}}(),clamp:function(b,a,c){return Math.max(a,Math.min(c,b))},euclideanModulo:function(b,a){return(b%a+a)%a},mapLinear:function(b,a,c,d,e){return d+(b-a)*(e-d)/(c-a)},smoothstep:function(b,a,c){if(b<=a)return 0;if(b>=c)return 1;b=(b-a)/(c-a);return b*b*(3-2*b)},smootherstep:function(b,a,c){if(b<=a)return 0;if(b>=c)return 1;b=(b-a)/(c-a);return b*b*b*(b*(6*b-15)+10)},random16:function(){console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead.");return Math.random()},
randInt:function(b,a){return b+Math.floor(Math.random()*(a-b+1))},randFloat:function(b,a){return b+Math.random()*(a-b)},randFloatSpread:function(b){return b*(.5-Math.random())},degToRad:function(b){return b*k.Math.DEG2RAD},radToDeg:function(b){return b*k.Math.RAD2DEG},isPowerOfTwo:function(b){return 0===(b&b-1)&&0!==b},nearestPowerOfTwo:function(b){return Math.pow(2,Math.round(Math.log(b)/Math.LN2))},nextPowerOfTwo:function(b){b--;b|=b>>1;b|=b>>2;b|=b>>4;b|=b>>8;b|=b>>16;b++;return b}};e.prototype=
{constructor:e,isVector2:!0,get width(){return this.x},set width(b){this.x=b},get height(){return this.y},set height(b){this.y=b},set:function(b,a){this.x=b;this.y=a;return this},setScalar:function(b){this.y=this.x=b;return this},setX:function(b){this.x=b;return this},setY:function(b){this.y=b;return this},setComponent:function(b,a){switch(b){case 0:this.x=a;break;case 1:this.y=a;break;default:throw Error("index is out of range: "+b);}},getComponent:function(b){switch(b){case 0:return this.x;case 1:return this.y;
default:throw Error("index is out of range: "+b);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(b){this.x=b.x;this.y=b.y;return this},add:function(b,a){if(void 0!==a)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(b,a);this.x+=b.x;this.y+=b.y;return this},addScalar:function(b){this.x+=b;this.y+=b;return this},addVectors:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;return this},addScaledVector:function(b,
a){this.x+=b.x*a;this.y+=b.y*a;return this},sub:function(b,a){if(void 0!==a)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(b,a);this.x-=b.x;this.y-=b.y;return this},subScalar:function(b){this.x-=b;this.y-=b;return this},subVectors:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;return this},multiply:function(b){this.x*=b.x;this.y*=b.y;return this},multiplyScalar:function(b){isFinite(b)?(this.x*=b,this.y*=b):this.y=this.x=0;
return this},divide:function(b){this.x/=b.x;this.y/=b.y;return this},divideScalar:function(b){return this.multiplyScalar(1/b)},min:function(b){this.x=Math.min(this.x,b.x);this.y=Math.min(this.y,b.y);return this},max:function(b){this.x=Math.max(this.x,b.x);this.y=Math.max(this.y,b.y);return this},clamp:function(b,a){this.x=Math.max(b.x,Math.min(a.x,this.x));this.y=Math.max(b.y,Math.min(a.y,this.y));return this},clampScalar:function(){var b,a;return function(h,c){void 0===b&&(b=new e,a=new e);b.set(h,
h);a.set(c,c);return this.clamp(b,a)}}(),clampLength:function(b,a){var h=this.length();return this.multiplyScalar(Math.max(b,Math.min(a,h))/h)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);
return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(b){return this.x*b.x+this.y*b.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var b=Math.atan2(this.y,this.x);0>b&&(b+=2*Math.PI);return b},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},
distanceToSquared:function(b){var a=this.x-b.x;b=this.y-b.y;return a*a+b*b},distanceToManhattan:function(b){return Math.abs(this.x-b.x)+Math.abs(this.y-b.y)},setLength:function(b){return this.multiplyScalar(b/this.length())},lerp:function(b,a){this.x+=(b.x-this.x)*a;this.y+=(b.y-this.y)*a;return this},lerpVectors:function(b,a,c){return this.subVectors(a,b).multiplyScalar(c).add(b)},equals:function(b){return b.x===this.x&&b.y===this.y},fromArray:function(b,a){void 0===a&&(a=0);this.x=b[a];this.y=b[a+
1];return this},toArray:function(b,a){void 0===b&&(b=[]);void 0===a&&(a=0);b[a]=this.x;b[a+1]=this.y;return b},fromAttribute:function(b,a,c){void 0===c&&(c=0);a=a*b.itemSize+c;this.x=b.array[a];this.y=b.array[a+1];return this},rotateAround:function(b,a){var h=Math.cos(a),c=Math.sin(a),d=this.x-b.x,e=this.y-b.y;this.x=d*h-e*c+b.x;this.y=d*c+e*h+b.y;return this}};l.DEFAULT_IMAGE=void 0;l.DEFAULT_MAPPING=300;l.prototype={constructor:l,isTexture:!0,set needsUpdate(b){!0===b&&this.version++},clone:function(){return(new this.constructor).copy(this)},
copy:function(b){this.image=b.image;this.mipmaps=b.mipmaps.slice(0);this.mapping=b.mapping;this.wrapS=b.wrapS;this.wrapT=b.wrapT;this.magFilter=b.magFilter;this.minFilter=b.minFilter;this.anisotropy=b.anisotropy;this.format=b.format;this.type=b.type;this.offset.copy(b.offset);this.repeat.copy(b.repeat);this.generateMipmaps=b.generateMipmaps;this.premultiplyAlpha=b.premultiplyAlpha;this.flipY=b.flipY;this.unpackAlignment=b.unpackAlignment;this.encoding=b.encoding;return this},toJSON:function(b){if(void 0!==
b.textures[this.uuid])return b.textures[this.uuid];var a={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var c=this.image;void 0===c.uuid&&(c.uuid=k.Math.generateUUID());if(void 0===b.images[c.uuid]){var d=b.images,
e=c.uuid,g=c.uuid,f;void 0!==c.toDataURL?f=c:(f=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),f.width=c.width,f.height=c.height,f.getContext("2d").drawImage(c,0,0,c.width,c.height));f=2048<f.width||2048<f.height?f.toDataURL("image/jpeg",.6):f.toDataURL("image/png");d[e]={uuid:g,url:f}}a.image=c.uuid}return b.textures[this.uuid]=a},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(b){if(300===this.mapping){b.multiply(this.repeat);b.add(this.offset);if(0>
b.x||1<b.x)switch(this.wrapS){case 1E3:b.x-=Math.floor(b.x);break;case 1001:b.x=0>b.x?0:1;break;case 1002:b.x=1===Math.abs(Math.floor(b.x)%2)?Math.ceil(b.x)-b.x:b.x-Math.floor(b.x)}if(0>b.y||1<b.y)switch(this.wrapT){case 1E3:b.y-=Math.floor(b.y);break;case 1001:b.y=0>b.y?0:1;break;case 1002:b.y=1===Math.abs(Math.floor(b.y)%2)?Math.ceil(b.y)-b.y:b.y-Math.floor(b.y)}this.flipY&&(b.y=1-b.y)}}};Object.assign(l.prototype,c.prototype);var je=0;a.prototype={constructor:a,isVector4:!0,set:function(b,a,c,
d){this.x=b;this.y=a;this.z=c;this.w=d;return this},setScalar:function(b){this.w=this.z=this.y=this.x=b;return this},setX:function(b){this.x=b;return this},setY:function(b){this.y=b;return this},setZ:function(b){this.z=b;return this},setW:function(b){this.w=b;return this},setComponent:function(b,a){switch(b){case 0:this.x=a;break;case 1:this.y=a;break;case 2:this.z=a;break;case 3:this.w=a;break;default:throw Error("index is out of range: "+b);}},getComponent:function(b){switch(b){case 0:return this.x;
case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+b);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=void 0!==b.w?b.w:1;return this},add:function(b,a){if(void 0!==a)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(b,a);this.x+=b.x;this.y+=b.y;this.z+=b.z;this.w+=b.w;return this},
addScalar:function(b){this.x+=b;this.y+=b;this.z+=b;this.w+=b;return this},addVectors:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;this.z=b.z+a.z;this.w=b.w+a.w;return this},addScaledVector:function(b,a){this.x+=b.x*a;this.y+=b.y*a;this.z+=b.z*a;this.w+=b.w*a;return this},sub:function(b,a){if(void 0!==a)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(b,a);this.x-=b.x;this.y-=b.y;this.z-=b.z;this.w-=b.w;return this},subScalar:function(b){this.x-=
b;this.y-=b;this.z-=b;this.w-=b;return this},subVectors:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;this.z=b.z-a.z;this.w=b.w-a.w;return this},multiplyScalar:function(b){isFinite(b)?(this.x*=b,this.y*=b,this.z*=b,this.w*=b):this.w=this.z=this.y=this.x=0;return this},applyMatrix4:function(b){var a=this.x,c=this.y,d=this.z,e=this.w;b=b.elements;this.x=b[0]*a+b[4]*c+b[8]*d+b[12]*e;this.y=b[1]*a+b[5]*c+b[9]*d+b[13]*e;this.z=b[2]*a+b[6]*c+b[10]*d+b[14]*e;this.w=b[3]*a+b[7]*c+b[11]*d+b[15]*e;return this},
divideScalar:function(b){return this.multiplyScalar(1/b)},setAxisAngleFromQuaternion:function(b){this.w=2*Math.acos(b.w);var a=Math.sqrt(1-b.w*b.w);1E-4>a?(this.x=1,this.z=this.y=0):(this.x=b.x/a,this.y=b.y/a,this.z=b.z/a);return this},setAxisAngleFromRotationMatrix:function(b){var a,c,d;b=b.elements;var e=b[0];d=b[4];var g=b[8],f=b[1],k=b[5],l=b[9];c=b[2];a=b[6];var m=b[10];if(.01>Math.abs(d-f)&&.01>Math.abs(g-c)&&.01>Math.abs(l-a)){if(.1>Math.abs(d+f)&&.1>Math.abs(g+c)&&.1>Math.abs(l+a)&&.1>Math.abs(e+
k+m-3))return this.set(1,0,0,0),this;b=Math.PI;e=(e+1)/2;k=(k+1)/2;m=(m+1)/2;d=(d+f)/4;g=(g+c)/4;l=(l+a)/4;e>k&&e>m?.01>e?(a=0,d=c=.707106781):(a=Math.sqrt(e),c=d/a,d=g/a):k>m?.01>k?(a=.707106781,c=0,d=.707106781):(c=Math.sqrt(k),a=d/c,d=l/c):.01>m?(c=a=.707106781,d=0):(d=Math.sqrt(m),a=g/d,c=l/d);this.set(a,c,d,b);return this}b=Math.sqrt((a-l)*(a-l)+(g-c)*(g-c)+(f-d)*(f-d));.001>Math.abs(b)&&(b=1);this.x=(a-l)/b;this.y=(g-c)/b;this.z=(f-d)/b;this.w=Math.acos((e+k+m-1)/2);return this},min:function(b){this.x=
Math.min(this.x,b.x);this.y=Math.min(this.y,b.y);this.z=Math.min(this.z,b.z);this.w=Math.min(this.w,b.w);return this},max:function(b){this.x=Math.max(this.x,b.x);this.y=Math.max(this.y,b.y);this.z=Math.max(this.z,b.z);this.w=Math.max(this.w,b.w);return this},clamp:function(b,a){this.x=Math.max(b.x,Math.min(a.x,this.x));this.y=Math.max(b.y,Math.min(a.y,this.y));this.z=Math.max(b.z,Math.min(a.z,this.z));this.w=Math.max(b.w,Math.min(a.w,this.w));return this},clampScalar:function(){var b,h;return function(c,
d){void 0===b&&(b=new a,h=new a);b.set(c,c,c,c);h.set(d,d,d,d);return this.clamp(b,h)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=
0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z+this.w*b.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*
this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(b){return this.multiplyScalar(b/this.length())},lerp:function(b,a){this.x+=(b.x-this.x)*a;this.y+=(b.y-this.y)*a;this.z+=(b.z-this.z)*a;this.w+=(b.w-this.w)*a;return this},lerpVectors:function(b,a,c){return this.subVectors(a,b).multiplyScalar(c).add(b)},equals:function(b){return b.x===
this.x&&b.y===this.y&&b.z===this.z&&b.w===this.w},fromArray:function(b,a){void 0===a&&(a=0);this.x=b[a];this.y=b[a+1];this.z=b[a+2];this.w=b[a+3];return this},toArray:function(b,a){void 0===b&&(b=[]);void 0===a&&(a=0);b[a]=this.x;b[a+1]=this.y;b[a+2]=this.z;b[a+3]=this.w;return b},fromAttribute:function(b,a,c){void 0===c&&(c=0);a=a*b.itemSize+c;this.x=b.array[a];this.y=b.array[a+1];this.z=b.array[a+2];this.w=b.array[a+3];return this}};Object.assign(f.prototype,c.prototype,{isWebGLRenderTarget:!0,
setSize:function(b,a){if(this.width!==b||this.height!==a)this.width=b,this.height=a,this.dispose();this.viewport.set(0,0,b,a);this.scissor.set(0,0,b,a)},clone:function(){return(new this.constructor).copy(this)},copy:function(b){this.width=b.width;this.height=b.height;this.viewport.copy(b.viewport);this.texture=b.texture.clone();this.depthBuffer=b.depthBuffer;this.stencilBuffer=b.stencilBuffer;this.depthTexture=b.depthTexture;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});
d.prototype=Object.create(f.prototype);d.prototype.constructor=d;d.prototype.isWebGLRenderTargetCube=!0;m.prototype={constructor:m,get x(){return this._x},set x(b){this._x=b;this.onChangeCallback()},get y(){return this._y},set y(b){this._y=b;this.onChangeCallback()},get z(){return this._z},set z(b){this._z=b;this.onChangeCallback()},get w(){return this._w},set w(b){this._w=b;this.onChangeCallback()},set:function(b,a,c,d){this._x=b;this._y=a;this._z=c;this._w=d;this.onChangeCallback();return this},
clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(b){this._x=b.x;this._y=b.y;this._z=b.z;this._w=b.w;this.onChangeCallback();return this},setFromEuler:function(b,a){if(!1===(b&&b.isEuler))throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var h=Math.cos(b._x/2),c=Math.cos(b._y/2),d=Math.cos(b._z/2),e=Math.sin(b._x/2),g=Math.sin(b._y/2),f=Math.sin(b._z/2),k=b.order;"XYZ"===k?(this._x=e*c*d+h*g*f,
this._y=h*g*d-e*c*f,this._z=h*c*f+e*g*d,this._w=h*c*d-e*g*f):"YXZ"===k?(this._x=e*c*d+h*g*f,this._y=h*g*d-e*c*f,this._z=h*c*f-e*g*d,this._w=h*c*d+e*g*f):"ZXY"===k?(this._x=e*c*d-h*g*f,this._y=h*g*d+e*c*f,this._z=h*c*f+e*g*d,this._w=h*c*d-e*g*f):"ZYX"===k?(this._x=e*c*d-h*g*f,this._y=h*g*d+e*c*f,this._z=h*c*f-e*g*d,this._w=h*c*d+e*g*f):"YZX"===k?(this._x=e*c*d+h*g*f,this._y=h*g*d+e*c*f,this._z=h*c*f-e*g*d,this._w=h*c*d-e*g*f):"XZY"===k&&(this._x=e*c*d-h*g*f,this._y=h*g*d-e*c*f,this._z=h*c*f+e*g*d,
this._w=h*c*d+e*g*f);if(!1!==a)this.onChangeCallback();return this},setFromAxisAngle:function(b,a){var h=a/2,c=Math.sin(h);this._x=b.x*c;this._y=b.y*c;this._z=b.z*c;this._w=Math.cos(h);this.onChangeCallback();return this},setFromRotationMatrix:function(b){var a=b.elements,c=a[0];b=a[4];var d=a[8],e=a[1],g=a[5],f=a[9],k=a[2],l=a[6],a=a[10],m=c+g+a;0<m?(c=.5/Math.sqrt(m+1),this._w=.25/c,this._x=(l-f)*c,this._y=(d-k)*c,this._z=(e-b)*c):c>g&&c>a?(c=2*Math.sqrt(1+c-g-a),this._w=(l-f)/c,this._x=.25*c,this._y=
(b+e)/c,this._z=(d+k)/c):g>a?(c=2*Math.sqrt(1+g-c-a),this._w=(d-k)/c,this._x=(b+e)/c,this._y=.25*c,this._z=(f+l)/c):(c=2*Math.sqrt(1+a-c-g),this._w=(e-b)/c,this._x=(d+k)/c,this._y=(f+l)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var b,a;return function(h,c){void 0===b&&(b=new g);a=h.dot(c)+1;1E-6>a?(a=0,Math.abs(h.x)>Math.abs(h.z)?b.set(-h.y,h.x,0):b.set(0,-h.z,h.y)):b.crossVectors(h,c);this._x=b.x;this._y=b.y;this._z=b.z;this._w=a;return this.normalize()}}(),
inverse:function(){return this.conjugate().normalize()},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(b){return this._x*b._x+this._y*b._y+this._z*b._z+this._w*b._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var b=this.length();0===b?(this._z=this._y=this._x=0,this._w=
1):(b=1/b,this._x*=b,this._y*=b,this._z*=b,this._w*=b);this.onChangeCallback();return this},multiply:function(b,a){return void 0!==a?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(b,a)):this.multiplyQuaternions(this,b)},premultiply:function(b){return this.multiplyQuaternions(b,this)},multiplyQuaternions:function(b,a){var h=b._x,c=b._y,d=b._z,e=b._w,g=a._x,f=a._y,k=a._z,l=a._w;this._x=h*l+e*g+c*k-d*f;
this._y=c*l+e*f+d*g-h*k;this._z=d*l+e*k+h*f-c*g;this._w=e*l-h*g-c*f-d*k;this.onChangeCallback();return this},slerp:function(b,a){if(0===a)return this;if(1===a)return this.copy(b);var h=this._x,c=this._y,d=this._z,e=this._w,g=e*b._w+h*b._x+c*b._y+d*b._z;0>g?(this._w=-b._w,this._x=-b._x,this._y=-b._y,this._z=-b._z,g=-g):this.copy(b);if(1<=g)return this._w=e,this._x=h,this._y=c,this._z=d,this;var f=Math.sqrt(1-g*g);if(.001>Math.abs(f))return this._w=.5*(e+this._w),this._x=.5*(h+this._x),this._y=.5*(c+
this._y),this._z=.5*(d+this._z),this;var k=Math.atan2(f,g),g=Math.sin((1-a)*k)/f,f=Math.sin(a*k)/f;this._w=e*g+this._w*f;this._x=h*g+this._x*f;this._y=c*g+this._y*f;this._z=d*g+this._z*f;this.onChangeCallback();return this},equals:function(b){return b._x===this._x&&b._y===this._y&&b._z===this._z&&b._w===this._w},fromArray:function(b,a){void 0===a&&(a=0);this._x=b[a];this._y=b[a+1];this._z=b[a+2];this._w=b[a+3];this.onChangeCallback();return this},toArray:function(b,a){void 0===b&&(b=[]);void 0===
a&&(a=0);b[a]=this._x;b[a+1]=this._y;b[a+2]=this._z;b[a+3]=this._w;return b},onChange:function(b){this.onChangeCallback=b;return this},onChangeCallback:function(){}};Object.assign(m,{slerp:function(b,a,c,d){return c.copy(b).slerp(a,d)},slerpFlat:function(b,a,c,d,e,g,f){var h=c[d+0],r=c[d+1],v=c[d+2];c=c[d+3];d=e[g+0];var A=e[g+1],k=e[g+2];e=e[g+3];if(c!==e||h!==d||r!==A||v!==k){g=1-f;var l=h*d+r*A+v*k+c*e,F=0<=l?1:-1,m=1-l*l;m>Number.EPSILON&&(m=Math.sqrt(m),l=Math.atan2(m,l*F),g=Math.sin(g*l)/m,
f=Math.sin(f*l)/m);F*=f;h=h*g+d*F;r=r*g+A*F;v=v*g+k*F;c=c*g+e*F;g===1-f&&(f=1/Math.sqrt(h*h+r*r+v*v+c*c),h*=f,r*=f,v*=f,c*=f)}b[a]=h;b[a+1]=r;b[a+2]=v;b[a+3]=c}});g.prototype={constructor:g,isVector3:!0,set:function(b,a,c){this.x=b;this.y=a;this.z=c;return this},setScalar:function(b){this.z=this.y=this.x=b;return this},setX:function(b){this.x=b;return this},setY:function(b){this.y=b;return this},setZ:function(b){this.z=b;return this},setComponent:function(b,a){switch(b){case 0:this.x=a;break;case 1:this.y=
a;break;case 2:this.z=a;break;default:throw Error("index is out of range: "+b);}},getComponent:function(b){switch(b){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+b);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;return this},add:function(b,a){if(void 0!==a)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),
this.addVectors(b,a);this.x+=b.x;this.y+=b.y;this.z+=b.z;return this},addScalar:function(b){this.x+=b;this.y+=b;this.z+=b;return this},addVectors:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;this.z=b.z+a.z;return this},addScaledVector:function(b,a){this.x+=b.x*a;this.y+=b.y*a;this.z+=b.z*a;return this},sub:function(b,a){if(void 0!==a)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(b,a);this.x-=b.x;this.y-=b.y;this.z-=b.z;
return this},subScalar:function(b){this.x-=b;this.y-=b;this.z-=b;return this},subVectors:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;this.z=b.z-a.z;return this},multiply:function(b,a){if(void 0!==a)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(b,a);this.x*=b.x;this.y*=b.y;this.z*=b.z;return this},multiplyScalar:function(b){isFinite(b)?(this.x*=b,this.y*=b,this.z*=b):this.z=this.y=this.x=0;return this},multiplyVectors:function(b,
a){this.x=b.x*a.x;this.y=b.y*a.y;this.z=b.z*a.z;return this},applyEuler:function(){var b;return function(a){!1===(a&&a.isEuler)&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.");void 0===b&&(b=new m);return this.applyQuaternion(b.setFromEuler(a))}}(),applyAxisAngle:function(){var b;return function(a,c){void 0===b&&(b=new m);return this.applyQuaternion(b.setFromAxisAngle(a,c))}}(),applyMatrix3:function(b){var a=this.x,c=this.y,d=this.z;b=
b.elements;this.x=b[0]*a+b[3]*c+b[6]*d;this.y=b[1]*a+b[4]*c+b[7]*d;this.z=b[2]*a+b[5]*c+b[8]*d;return this},applyMatrix4:function(b){var a=this.x,c=this.y,d=this.z;b=b.elements;this.x=b[0]*a+b[4]*c+b[8]*d+b[12];this.y=b[1]*a+b[5]*c+b[9]*d+b[13];this.z=b[2]*a+b[6]*c+b[10]*d+b[14];return this},applyProjection:function(b){var a=this.x,c=this.y,d=this.z;b=b.elements;var e=1/(b[3]*a+b[7]*c+b[11]*d+b[15]);this.x=(b[0]*a+b[4]*c+b[8]*d+b[12])*e;this.y=(b[1]*a+b[5]*c+b[9]*d+b[13])*e;this.z=(b[2]*a+b[6]*c+
b[10]*d+b[14])*e;return this},applyQuaternion:function(b){var a=this.x,c=this.y,d=this.z,e=b.x,g=b.y,f=b.z;b=b.w;var k=b*a+g*d-f*c,l=b*c+f*a-e*d,m=b*d+e*c-g*a,a=-e*a-g*c-f*d;this.x=k*b+a*-e+l*-f-m*-g;this.y=l*b+a*-g+m*-e-k*-f;this.z=m*b+a*-f+k*-g-l*-e;return this},project:function(){var b;return function(a){void 0===b&&(b=new n);b.multiplyMatrices(a.projectionMatrix,b.getInverse(a.matrixWorld));return this.applyProjection(b)}}(),unproject:function(){var b;return function(a){void 0===b&&(b=new n);
b.multiplyMatrices(a.matrixWorld,b.getInverse(a.projectionMatrix));return this.applyProjection(b)}}(),transformDirection:function(b){var a=this.x,c=this.y,d=this.z;b=b.elements;this.x=b[0]*a+b[4]*c+b[8]*d;this.y=b[1]*a+b[5]*c+b[9]*d;this.z=b[2]*a+b[6]*c+b[10]*d;return this.normalize()},divide:function(b){this.x/=b.x;this.y/=b.y;this.z/=b.z;return this},divideScalar:function(b){return this.multiplyScalar(1/b)},min:function(b){this.x=Math.min(this.x,b.x);this.y=Math.min(this.y,b.y);this.z=Math.min(this.z,
b.z);return this},max:function(b){this.x=Math.max(this.x,b.x);this.y=Math.max(this.y,b.y);this.z=Math.max(this.z,b.z);return this},clamp:function(b,a){this.x=Math.max(b.x,Math.min(a.x,this.x));this.y=Math.max(b.y,Math.min(a.y,this.y));this.z=Math.max(b.z,Math.min(a.z,this.z));return this},clampScalar:function(){var b,a;return function(h,c){void 0===b&&(b=new g,a=new g);b.set(h,h,h);a.set(c,c,c);return this.clamp(b,a)}}(),clampLength:function(b,a){var h=this.length();return this.multiplyScalar(Math.max(b,
Math.min(a,h))/h)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):
Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(b){return this.multiplyScalar(b/
this.length())},lerp:function(b,a){this.x+=(b.x-this.x)*a;this.y+=(b.y-this.y)*a;this.z+=(b.z-this.z)*a;return this},lerpVectors:function(b,a,c){return this.subVectors(a,b).multiplyScalar(c).add(b)},cross:function(b,a){if(void 0!==a)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(b,a);var h=this.x,c=this.y,d=this.z;this.x=c*b.z-d*b.y;this.y=d*b.x-h*b.z;this.z=h*b.y-c*b.x;return this},crossVectors:function(b,a){var h=
b.x,c=b.y,d=b.z,e=a.x,g=a.y,f=a.z;this.x=c*f-d*g;this.y=d*e-h*f;this.z=h*g-c*e;return this},projectOnVector:function(b){var a=b.dot(this)/b.lengthSq();return this.copy(b).multiplyScalar(a)},projectOnPlane:function(){var b;return function(a){void 0===b&&(b=new g);b.copy(this).projectOnVector(a);return this.sub(b)}}(),reflect:function(){var b;return function(a){void 0===b&&(b=new g);return this.sub(b.copy(a).multiplyScalar(2*this.dot(a)))}}(),angleTo:function(b){b=this.dot(b)/Math.sqrt(this.lengthSq()*
b.lengthSq());return Math.acos(k.Math.clamp(b,-1,1))},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},distanceToSquared:function(b){var a=this.x-b.x,c=this.y-b.y;b=this.z-b.z;return a*a+c*c+b*b},distanceToManhattan:function(b){return Math.abs(this.x-b.x)+Math.abs(this.y-b.y)+Math.abs(this.z-b.z)},setFromSpherical:function(b){var a=Math.sin(b.phi)*b.radius;this.x=a*Math.sin(b.theta);this.y=Math.cos(b.phi)*b.radius;this.z=a*Math.cos(b.theta);return this},setFromMatrixPosition:function(b){return this.setFromMatrixColumn(b,
3)},setFromMatrixScale:function(b){var a=this.setFromMatrixColumn(b,0).length(),c=this.setFromMatrixColumn(b,1).length();b=this.setFromMatrixColumn(b,2).length();this.x=a;this.y=c;this.z=b;return this},setFromMatrixColumn:function(b,a){if("number"===typeof b){console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).");var h=b;b=a;a=h}return this.fromArray(b.elements,4*a)},equals:function(b){return b.x===this.x&&b.y===this.y&&b.z===this.z},fromArray:function(b,a){void 0===a&&
(a=0);this.x=b[a];this.y=b[a+1];this.z=b[a+2];return this},toArray:function(b,a){void 0===b&&(b=[]);void 0===a&&(a=0);b[a]=this.x;b[a+1]=this.y;b[a+2]=this.z;return b},fromAttribute:function(b,a,c){void 0===c&&(c=0);a=a*b.itemSize+c;this.x=b.array[a];this.y=b.array[a+1];this.z=b.array[a+2];return this}};n.prototype={constructor:n,isMatrix4:!0,set:function(b,a,c,d,e,g,f,k,l,m,n,p,q,t,u,z){var h=this.elements;h[0]=b;h[4]=a;h[8]=c;h[12]=d;h[1]=e;h[5]=g;h[9]=f;h[13]=k;h[2]=l;h[6]=m;h[10]=n;h[14]=p;h[3]=
q;h[7]=t;h[11]=u;h[15]=z;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new n).fromArray(this.elements)},copy:function(b){this.elements.set(b.elements);return this},copyPosition:function(b){var a=this.elements;b=b.elements;a[12]=b[12];a[13]=b[13];a[14]=b[14];return this},extractBasis:function(b,a,c){b.setFromMatrixColumn(this,0);a.setFromMatrixColumn(this,1);c.setFromMatrixColumn(this,2);return this},makeBasis:function(b,a,c){this.set(b.x,
a.x,c.x,0,b.y,a.y,c.y,0,b.z,a.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var b;return function(a){void 0===b&&(b=new g);var h=this.elements,c=a.elements,d=1/b.setFromMatrixColumn(a,0).length(),e=1/b.setFromMatrixColumn(a,1).length();a=1/b.setFromMatrixColumn(a,2).length();h[0]=c[0]*d;h[1]=c[1]*d;h[2]=c[2]*d;h[4]=c[4]*e;h[5]=c[5]*e;h[6]=c[6]*e;h[8]=c[8]*a;h[9]=c[9]*a;h[10]=c[10]*a;return this}}(),makeRotationFromEuler:function(b){!1===(b&&b.isEuler)&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");
var a=this.elements,c=b.x,d=b.y,e=b.z,g=Math.cos(c),c=Math.sin(c),f=Math.cos(d),d=Math.sin(d),k=Math.cos(e),e=Math.sin(e);if("XYZ"===b.order){b=g*k;var l=g*e,m=c*k,n=c*e;a[0]=f*k;a[4]=-f*e;a[8]=d;a[1]=l+m*d;a[5]=b-n*d;a[9]=-c*f;a[2]=n-b*d;a[6]=m+l*d;a[10]=g*f}else"YXZ"===b.order?(b=f*k,l=f*e,m=d*k,n=d*e,a[0]=b+n*c,a[4]=m*c-l,a[8]=g*d,a[1]=g*e,a[5]=g*k,a[9]=-c,a[2]=l*c-m,a[6]=n+b*c,a[10]=g*f):"ZXY"===b.order?(b=f*k,l=f*e,m=d*k,n=d*e,a[0]=b-n*c,a[4]=-g*e,a[8]=m+l*c,a[1]=l+m*c,a[5]=g*k,a[9]=n-b*c,a[2]=
-g*d,a[6]=c,a[10]=g*f):"ZYX"===b.order?(b=g*k,l=g*e,m=c*k,n=c*e,a[0]=f*k,a[4]=m*d-l,a[8]=b*d+n,a[1]=f*e,a[5]=n*d+b,a[9]=l*d-m,a[2]=-d,a[6]=c*f,a[10]=g*f):"YZX"===b.order?(b=g*f,l=g*d,m=c*f,n=c*d,a[0]=f*k,a[4]=n-b*e,a[8]=m*e+l,a[1]=e,a[5]=g*k,a[9]=-c*k,a[2]=-d*k,a[6]=l*e+m,a[10]=b-n*e):"XZY"===b.order&&(b=g*f,l=g*d,m=c*f,n=c*d,a[0]=f*k,a[4]=-e,a[8]=d*k,a[1]=b*e+n,a[5]=g*k,a[9]=l*e-m,a[2]=m*e-l,a[6]=c*k,a[10]=n*e+b);a[3]=0;a[7]=0;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return this},makeRotationFromQuaternion:function(b){var a=
this.elements,c=b.x,d=b.y,e=b.z,g=b.w,f=c+c,k=d+d,l=e+e;b=c*f;var m=c*k,c=c*l,n=d*k,d=d*l,e=e*l,f=g*f,k=g*k,g=g*l;a[0]=1-(n+e);a[4]=m-g;a[8]=c+k;a[1]=m+g;a[5]=1-(b+e);a[9]=d-f;a[2]=c-k;a[6]=d+f;a[10]=1-(b+n);a[3]=0;a[7]=0;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return this},lookAt:function(){var b,a,c;return function(h,d,r){void 0===b&&(b=new g,a=new g,c=new g);var e=this.elements;c.subVectors(h,d).normalize();0===c.lengthSq()&&(c.z=1);b.crossVectors(r,c).normalize();0===b.lengthSq()&&(c.z+=1E-4,
b.crossVectors(r,c).normalize());a.crossVectors(c,b);e[0]=b.x;e[4]=a.x;e[8]=c.x;e[1]=b.y;e[5]=a.y;e[9]=c.y;e[2]=b.z;e[6]=a.z;e[10]=c.z;return this}}(),multiply:function(b,a){return void 0!==a?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(b,a)):this.multiplyMatrices(this,b)},premultiply:function(b){return this.multiplyMatrices(b,this)},multiplyMatrices:function(b,a){var h=b.elements,c=a.elements,d=this.elements,
e=h[0],g=h[4],f=h[8],k=h[12],l=h[1],m=h[5],n=h[9],p=h[13],q=h[2],t=h[6],u=h[10],z=h[14],w=h[3],y=h[7],x=h[11],h=h[15],D=c[0],C=c[4],B=c[8],J=c[12],G=c[1],V=c[5],E=c[9],I=c[13],ea=c[2],S=c[6],K=c[10],R=c[14],P=c[3],O=c[7],Z=c[11],c=c[15];d[0]=e*D+g*G+f*ea+k*P;d[4]=e*C+g*V+f*S+k*O;d[8]=e*B+g*E+f*K+k*Z;d[12]=e*J+g*I+f*R+k*c;d[1]=l*D+m*G+n*ea+p*P;d[5]=l*C+m*V+n*S+p*O;d[9]=l*B+m*E+n*K+p*Z;d[13]=l*J+m*I+n*R+p*c;d[2]=q*D+t*G+u*ea+z*P;d[6]=q*C+t*V+u*S+z*O;d[10]=q*B+t*E+u*K+z*Z;d[14]=q*J+t*I+u*R+z*c;d[3]=
w*D+y*G+x*ea+h*P;d[7]=w*C+y*V+x*S+h*O;d[11]=w*B+y*E+x*K+h*Z;d[15]=w*J+y*I+x*R+h*c;return this},multiplyToArray:function(b,a,c){var h=this.elements;this.multiplyMatrices(b,a);c[0]=h[0];c[1]=h[1];c[2]=h[2];c[3]=h[3];c[4]=h[4];c[5]=h[5];c[6]=h[6];c[7]=h[7];c[8]=h[8];c[9]=h[9];c[10]=h[10];c[11]=h[11];c[12]=h[12];c[13]=h[13];c[14]=h[14];c[15]=h[15];return this},multiplyScalar:function(b){var a=this.elements;a[0]*=b;a[4]*=b;a[8]*=b;a[12]*=b;a[1]*=b;a[5]*=b;a[9]*=b;a[13]*=b;a[2]*=b;a[6]*=b;a[10]*=b;a[14]*=
b;a[3]*=b;a[7]*=b;a[11]*=b;a[15]*=b;return this},applyToVector3Array:function(){var b;return function(a,c,d){void 0===b&&(b=new g);void 0===c&&(c=0);void 0===d&&(d=a.length);for(var h=0;h<d;h+=3,c+=3)b.fromArray(a,c),b.applyMatrix4(this),b.toArray(a,c);return a}}(),applyToBuffer:function(){var b;return function(a,c,d){void 0===b&&(b=new g);void 0===c&&(c=0);void 0===d&&(d=a.length/a.itemSize);for(var h=0;h<d;h++,c++)b.x=a.getX(c),b.y=a.getY(c),b.z=a.getZ(c),b.applyMatrix4(this),a.setXYZ(b.x,b.y,b.z);
return a}}(),determinant:function(){var b=this.elements,a=b[0],c=b[4],d=b[8],e=b[12],g=b[1],f=b[5],k=b[9],l=b[13],m=b[2],n=b[6],p=b[10],q=b[14];return b[3]*(+e*k*n-d*l*n-e*f*p+c*l*p+d*f*q-c*k*q)+b[7]*(+a*k*q-a*l*p+e*g*p-d*g*q+d*l*m-e*k*m)+b[11]*(+a*l*n-a*f*q-e*g*n+c*g*q+e*f*m-c*l*m)+b[15]*(-d*f*m-a*k*n+a*f*p+d*g*n-c*g*p+c*k*m)},transpose:function(){var b=this.elements,a;a=b[1];b[1]=b[4];b[4]=a;a=b[2];b[2]=b[8];b[8]=a;a=b[6];b[6]=b[9];b[9]=a;a=b[3];b[3]=b[12];b[12]=a;a=b[7];b[7]=b[13];b[13]=a;a=b[11];
b[11]=b[14];b[14]=a;return this},flattenToArrayOffset:function(b,a){console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.");return this.toArray(b,a)},getPosition:function(){var b;return function(){void 0===b&&(b=new g);console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return b.setFromMatrixColumn(this,3)}}(),setPosition:function(b){var a=this.elements;a[12]=b.x;a[13]=b.y;a[14]=b.z;return this},
getInverse:function(b,a){var h=this.elements,c=b.elements,d=c[0],e=c[1],g=c[2],f=c[3],k=c[4],l=c[5],m=c[6],n=c[7],p=c[8],q=c[9],t=c[10],u=c[11],z=c[12],w=c[13],y=c[14],c=c[15],x=q*y*n-w*t*n+w*m*u-l*y*u-q*m*c+l*t*c,D=z*t*n-p*y*n-z*m*u+k*y*u+p*m*c-k*t*c,C=p*w*n-z*q*n+z*l*u-k*w*u-p*l*c+k*q*c,B=z*q*m-p*w*m-z*l*t+k*w*t+p*l*y-k*q*y,J=d*x+e*D+g*C+f*B;if(0===J){if(!0===a)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");
return this.identity()}J=1/J;h[0]=x*J;h[1]=(w*t*f-q*y*f-w*g*u+e*y*u+q*g*c-e*t*c)*J;h[2]=(l*y*f-w*m*f+w*g*n-e*y*n-l*g*c+e*m*c)*J;h[3]=(q*m*f-l*t*f-q*g*n+e*t*n+l*g*u-e*m*u)*J;h[4]=D*J;h[5]=(p*y*f-z*t*f+z*g*u-d*y*u-p*g*c+d*t*c)*J;h[6]=(z*m*f-k*y*f-z*g*n+d*y*n+k*g*c-d*m*c)*J;h[7]=(k*t*f-p*m*f+p*g*n-d*t*n-k*g*u+d*m*u)*J;h[8]=C*J;h[9]=(z*q*f-p*w*f-z*e*u+d*w*u+p*e*c-d*q*c)*J;h[10]=(k*w*f-z*l*f+z*e*n-d*w*n-k*e*c+d*l*c)*J;h[11]=(p*l*f-k*q*f-p*e*n+d*q*n+k*e*u-d*l*u)*J;h[12]=B*J;h[13]=(p*w*g-z*q*g+z*e*t-d*w*
t-p*e*y+d*q*y)*J;h[14]=(z*l*g-k*w*g-z*e*m+d*w*m+k*e*y-d*l*y)*J;h[15]=(k*q*g-p*l*g+p*e*m-d*q*m-k*e*t+d*l*t)*J;return this},scale:function(b){var a=this.elements,c=b.x,d=b.y;b=b.z;a[0]*=c;a[4]*=d;a[8]*=b;a[1]*=c;a[5]*=d;a[9]*=b;a[2]*=c;a[6]*=d;a[10]*=b;a[3]*=c;a[7]*=d;a[11]*=b;return this},getMaxScaleOnAxis:function(){var b=this.elements;return Math.sqrt(Math.max(b[0]*b[0]+b[1]*b[1]+b[2]*b[2],b[4]*b[4]+b[5]*b[5]+b[6]*b[6],b[8]*b[8]+b[9]*b[9]+b[10]*b[10]))},makeTranslation:function(b,a,c){this.set(1,
0,0,b,0,1,0,a,0,0,1,c,0,0,0,1);return this},makeRotationX:function(b){var a=Math.cos(b);b=Math.sin(b);this.set(1,0,0,0,0,a,-b,0,0,b,a,0,0,0,0,1);return this},makeRotationY:function(b){var a=Math.cos(b);b=Math.sin(b);this.set(a,0,b,0,0,1,0,0,-b,0,a,0,0,0,0,1);return this},makeRotationZ:function(b){var a=Math.cos(b);b=Math.sin(b);this.set(a,-b,0,0,b,a,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(b,a){var h=Math.cos(a),c=Math.sin(a),d=1-h,e=b.x,g=b.y,f=b.z,k=d*e,l=d*g;this.set(k*e+h,k*
g-c*f,k*f+c*g,0,k*g+c*f,l*g+h,l*f-c*e,0,k*f-c*g,l*f+c*e,d*f*f+h,0,0,0,0,1);return this},makeScale:function(b,a,c){this.set(b,0,0,0,0,a,0,0,0,0,c,0,0,0,0,1);return this},compose:function(b,a,c){this.makeRotationFromQuaternion(a);this.scale(c);this.setPosition(b);return this},decompose:function(){var b,a;return function(c,h,d){void 0===b&&(b=new g,a=new n);var r=this.elements,e=b.set(r[0],r[1],r[2]).length(),f=b.set(r[4],r[5],r[6]).length(),v=b.set(r[8],r[9],r[10]).length();0>this.determinant()&&(e=
-e);c.x=r[12];c.y=r[13];c.z=r[14];a.elements.set(this.elements);c=1/e;var r=1/f,k=1/v;a.elements[0]*=c;a.elements[1]*=c;a.elements[2]*=c;a.elements[4]*=r;a.elements[5]*=r;a.elements[6]*=r;a.elements[8]*=k;a.elements[9]*=k;a.elements[10]*=k;h.setFromRotationMatrix(a);d.x=e;d.y=f;d.z=v;return this}}(),makeFrustum:function(b,a,c,d,e,g){var h=this.elements;h[0]=2*e/(a-b);h[4]=0;h[8]=(a+b)/(a-b);h[12]=0;h[1]=0;h[5]=2*e/(d-c);h[9]=(d+c)/(d-c);h[13]=0;h[2]=0;h[6]=0;h[10]=-(g+e)/(g-e);h[14]=-2*g*e/(g-e);
h[3]=0;h[7]=0;h[11]=-1;h[15]=0;return this},makePerspective:function(b,a,c,d){b=c*Math.tan(k.Math.DEG2RAD*b*.5);var h=-b;return this.makeFrustum(h*a,b*a,h,b,c,d)},makeOrthographic:function(b,a,c,d,e,g){var h=this.elements,r=1/(a-b),f=1/(c-d),v=1/(g-e);h[0]=2*r;h[4]=0;h[8]=0;h[12]=-((a+b)*r);h[1]=0;h[5]=2*f;h[9]=0;h[13]=-((c+d)*f);h[2]=0;h[6]=0;h[10]=-2*v;h[14]=-((g+e)*v);h[3]=0;h[7]=0;h[11]=0;h[15]=1;return this},equals:function(b){var a=this.elements;b=b.elements;for(var c=0;16>c;c++)if(a[c]!==b[c])return!1;
return!0},fromArray:function(b,a){void 0===a&&(a=0);for(var c=0;16>c;c++)this.elements[c]=b[c+a];return this},toArray:function(b,a){void 0===b&&(b=[]);void 0===a&&(a=0);var c=this.elements;b[a]=c[0];b[a+1]=c[1];b[a+2]=c[2];b[a+3]=c[3];b[a+4]=c[4];b[a+5]=c[5];b[a+6]=c[6];b[a+7]=c[7];b[a+8]=c[8];b[a+9]=c[9];b[a+10]=c[10];b[a+11]=c[11];b[a+12]=c[12];b[a+13]=c[13];b[a+14]=c[14];b[a+15]=c[15];return b}};p.prototype=Object.create(l.prototype);p.prototype.constructor=p;p.prototype.isCubeTexture=!0;Object.defineProperty(p.prototype,
"images",{get:function(){return this.image},set:function(b){this.image=b}});var me=new l,ne=new p,ke=[],le=[];Ra.prototype.setValue=function(b,a){for(var c=this.seq,h=0,d=c.length;h!==d;++h){var e=c[h];e.setValue(b,a[e.id])}};var Gd=/([\w\d_]+)(\])?(\[|\.)?/g;oa.prototype.setValue=function(b,a,c){a=this.map[a];void 0!==a&&a.setValue(b,c,this.renderer)};oa.prototype.set=function(b,a,c){var h=this.map[c];void 0!==h&&h.setValue(b,a[c],this.renderer)};oa.prototype.setOptional=function(b,a,c){a=a[c];void 0!==
a&&this.setValue(b,c,a)};oa.upload=function(b,a,c,d){for(var h=0,e=a.length;h!==e;++h){var r=a[h],g=c[r.id];!1!==g.needsUpdate&&r.setValue(b,g.value,d)}};oa.seqWithValue=function(b,a){for(var c=[],h=0,d=b.length;h!==d;++h){var e=b[h];e.id in a&&c.push(e)}return c};oa.splitDynamic=function(b,a){for(var c=null,h=b.length,d=0,e=0;e!==h;++e){var g=b[e],f=a[g.id];f&&!0===f.dynamic?(null===c&&(c=[]),c.push(g)):(d<e&&(b[d]=g),++d)}d<h&&(b.length=d);return c};oa.evalDynamic=function(b,a,c,d,e){for(var h=
0,r=b.length;h!==r;++h){var g=a[b[h].id],f=g.onUpdateCallback;void 0!==f&&f.call(g,c,d,e)}};k.UniformsUtils={merge:function(b){for(var a={},c=0;c<b.length;c++){var d=this.clone(b[c]),e;for(e in d)a[e]=d[e]}return a},clone:function(b){var a={},c;for(c in b){a[c]={};for(var d in b[c]){var e=b[c][d];e&&e.isColor||e&&e.isVector2||e&&e.isVector3||e&&e.isVector4||e&&e.isMatrix3||e&&e.isMatrix4||e&&e.isTexture?a[c][d]=e.clone():Array.isArray(e)?a[c][d]=e.slice():a[c][d]=e}}return a}};var ua={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",
alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",
aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"bool testLightInRange( const in float lightDistance, const in float cutoffDistance ) {\n\treturn any( bvec2( cutoffDistance == 0.0, lightDistance < cutoffDistance ) );\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",
bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",
clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",
clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\n",
cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",
defaultnormal_vertex:"#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",
emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n  return value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n  float maxComponent = max( max( value.r, value.g ), value.b );\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n  float maxRGB = max( value.x, max( value.g, value.b ) );\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n  M            = ceil( M * 255.0 ) / 255.0;\n  return vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n    float maxRGB = max( value.x, max( value.g, value.b ) );\n    float D      = max( maxRange / maxRGB, 1.0 );\n    D            = min( floor( D ) / 255.0, 1.0 );\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n  vec4 vResult;\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n  vResult.w = fract(Le);\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n  return vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n  float Le = value.z * 255.0 + value.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n  return vec4( max(vRGB, 0.0), 1.0 );\n}\n",
envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",
envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntenstiy;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",
envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",
fog_fragment:"#ifdef USE_FOG\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",
lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",
lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tif ( testLightInRange( lightDistance, pointLight.distance ) ) {\n\t\t\tdirectLight.color = pointLight.color;\n\t\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( all( bvec2( angleCos > spotLight.coneCos, testLightInRange( lightDistance, spotLight.distance ) ) ) ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\t#include <normal_flip>\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\t#include <normal_flip>\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",
lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",
lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",
lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",
lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t \tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\t\t\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",
logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",
map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",
metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.r;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",
normal_flip:"#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",
normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",
packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n  return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n  return 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n  return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n  return linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",
premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.r;\n#endif\n",
roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",
shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",
shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",
shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",
skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",
skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",
specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n  return toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  color = max( vec3( 0.0 ), color - 0.004 );\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",
uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",
uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",
uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",
cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",
depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",
distanceRGBA_frag:"uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n",distanceRGBA_vert:"varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n",
equirect_frag:"uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",
linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight;\n\treflectedLight.directDiffuse = vec3( 0.0 );\n\treflectedLight.directSpecular = vec3( 0.0 );\n\treflectedLight.indirectDiffuse = diffuseColor.rgb;\n\treflectedLight.indirectSpecular = vec3( 0.0 );\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n}\n",
meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n}\n",
meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n}\n",
meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nuniform float envMapIntensity;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",
normal_frag:"uniform float opacity;\nvarying vec3 vNormal;\n#include <common>\n#include <packing>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( vNormal ), opacity );\n\t#include <logdepthbuf_fragment>\n}\n",normal_vert:"varying vec3 vNormal;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvNormal = normalize( normalMatrix * normal );\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",
points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",
shadow_frag:"uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0  - getShadowMask() ) );\n}\n",shadow_vert:"#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n"};O.prototype={constructor:O,
isColor:!0,r:1,g:1,b:1,set:function(b){b&&b.isColor?this.copy(b):"number"===typeof b?this.setHex(b):"string"===typeof b&&this.setStyle(b);return this},setScalar:function(b){this.b=this.g=this.r=b},setHex:function(b){b=Math.floor(b);this.r=(b>>16&255)/255;this.g=(b>>8&255)/255;this.b=(b&255)/255;return this},setRGB:function(b,a,c){this.r=b;this.g=a;this.b=c;return this},setHSL:function(){function b(b,a,c){0>c&&(c+=1);1<c&&--c;return c<1/6?b+6*(a-b)*c:.5>c?a:c<2/3?b+6*(a-b)*(2/3-c):b}return function(a,
c,d){a=k.Math.euclideanModulo(a,1);c=k.Math.clamp(c,0,1);d=k.Math.clamp(d,0,1);0===c?this.r=this.g=this.b=d:(c=.5>=d?d*(1+c):d+c-d*c,d=2*d-c,this.r=b(d,c,a+1/3),this.g=b(d,c,a),this.b=b(d,c,a-1/3));return this}}(),setStyle:function(b){function a(a){void 0!==a&&1>parseFloat(a)&&console.warn("THREE.Color: Alpha component of "+b+" will be ignored.")}var c;if(c=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(b)){var d=c[2];switch(c[1]){case "rgb":case "rgba":if(c=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d))return this.r=
Math.min(255,parseInt(c[1],10))/255,this.g=Math.min(255,parseInt(c[2],10))/255,this.b=Math.min(255,parseInt(c[3],10))/255,a(c[5]),this;if(c=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d))return this.r=Math.min(100,parseInt(c[1],10))/100,this.g=Math.min(100,parseInt(c[2],10))/100,this.b=Math.min(100,parseInt(c[3],10))/100,a(c[5]),this;break;case "hsl":case "hsla":if(c=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d)){var d=parseFloat(c[1])/
360,e=parseInt(c[2],10)/100,g=parseInt(c[3],10)/100;a(c[5]);return this.setHSL(d,e,g)}}}else if(c=/^\#([A-Fa-f0-9]+)$/.exec(b)){c=c[1];d=c.length;if(3===d)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===d)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}b&&0<b.length&&(c=k.ColorKeywords[b],
void 0!==c?this.setHex(c):console.warn("THREE.Color: Unknown color "+b));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(b){this.r=b.r;this.g=b.g;this.b=b.b;return this},copyGammaToLinear:function(b,a){void 0===a&&(a=2);this.r=Math.pow(b.r,a);this.g=Math.pow(b.g,a);this.b=Math.pow(b.b,a);return this},copyLinearToGamma:function(b,a){void 0===a&&(a=2);var c=0<a?1/a:1;this.r=Math.pow(b.r,c);this.g=Math.pow(b.g,c);this.b=Math.pow(b.b,c);return this},convertGammaToLinear:function(){var b=
this.r,a=this.g,c=this.b;this.r=b*b;this.g=a*a;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(b){b=b||{h:0,s:0,l:0};var a=this.r,c=this.g,d=this.b,e=Math.max(a,c,d),g=Math.min(a,c,d),f,k=(g+e)/2;if(g===e)g=f=0;else{var l=e-g,g=.5>=k?l/(e+g):
l/(2-e-g);switch(e){case a:f=(c-d)/l+(c<d?6:0);break;case c:f=(d-a)/l+2;break;case d:f=(a-c)/l+4}f/=6}b.h=f;b.s=g;b.l=k;return b},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(b,a,c){var h=this.getHSL();h.h+=b;h.s+=a;h.l+=c;this.setHSL(h.h,h.s,h.l);return this},add:function(b){this.r+=b.r;this.g+=b.g;this.b+=b.b;return this},addColors:function(b,a){this.r=b.r+a.r;this.g=b.g+a.g;this.b=b.b+a.b;return this},addScalar:function(b){this.r+=
b;this.g+=b;this.b+=b;return this},sub:function(b){this.r=Math.max(0,this.r-b.r);this.g=Math.max(0,this.g-b.g);this.b=Math.max(0,this.b-b.b);return this},multiply:function(b){this.r*=b.r;this.g*=b.g;this.b*=b.b;return this},multiplyScalar:function(b){this.r*=b;this.g*=b;this.b*=b;return this},lerp:function(b,a){this.r+=(b.r-this.r)*a;this.g+=(b.g-this.g)*a;this.b+=(b.b-this.b)*a;return this},equals:function(b){return b.r===this.r&&b.g===this.g&&b.b===this.b},fromArray:function(b,a){void 0===a&&(a=
0);this.r=b[a];this.g=b[a+1];this.b=b[a+2];return this},toArray:function(b,a){void 0===b&&(b=[]);void 0===a&&(a=0);b[a]=this.r;b[a+1]=this.g;b[a+2]=this.b;return b},toJSON:function(){return this.getHex()}};k.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,
cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,
dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,
lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,
mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,
seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};var ka={common:{diffuse:{value:new O(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new a(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},
envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new e(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},
metalnessmap:{metalnessMap:{value:null}},fog:{fogDensity:{value:2.5E-4},fogNear:{value:1},fogFar:{value:2E3},fogColor:{value:new O(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},
shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}}},points:{diffuse:{value:new O(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new a(0,0,1,1)}}},
Xb={basic:{uniforms:k.UniformsUtils.merge([ka.common,ka.aomap,ka.fog]),vertexShader:ua.meshbasic_vert,fragmentShader:ua.meshbasic_frag},lambert:{uniforms:k.UniformsUtils.merge([ka.common,ka.aomap,ka.lightmap,ka.emissivemap,ka.fog,ka.lights,{emissive:{value:new O(0)}}]),vertexShader:ua.meshlambert_vert,fragmentShader:ua.meshlambert_frag},phong:{uniforms:k.UniformsUtils.merge([ka.common,ka.aomap,ka.lightmap,ka.emissivemap,ka.bumpmap,ka.normalmap,ka.displacementmap,ka.fog,ka.lights,{emissive:{value:new O(0)},
specular:{value:new O(1118481)},shininess:{value:30}}]),vertexShader:ua.meshphong_vert,fragmentShader:ua.meshphong_frag},standard:{uniforms:k.UniformsUtils.merge([ka.common,ka.aomap,ka.lightmap,ka.emissivemap,ka.bumpmap,ka.normalmap,ka.displacementmap,ka.roughnessmap,ka.metalnessmap,ka.fog,ka.lights,{emissive:{value:new O(0)},roughness:{value:.5},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ua.meshphysical_vert,fragmentShader:ua.meshphysical_frag},points:{uniforms:k.UniformsUtils.merge([ka.points,
ka.fog]),vertexShader:ua.points_vert,fragmentShader:ua.points_frag},dashed:{uniforms:k.UniformsUtils.merge([ka.common,ka.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ua.linedashed_vert,fragmentShader:ua.linedashed_frag},depth:{uniforms:k.UniformsUtils.merge([ka.common,ka.displacementmap]),vertexShader:ua.depth_vert,fragmentShader:ua.depth_frag},normal:{uniforms:{opacity:{value:1}},vertexShader:ua.normal_vert,fragmentShader:ua.normal_frag},cube:{uniforms:{tCube:{value:null},
tFlip:{value:-1},opacity:{value:1}},vertexShader:ua.cube_vert,fragmentShader:ua.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:ua.equirect_vert,fragmentShader:ua.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new g}},vertexShader:ua.distanceRGBA_vert,fragmentShader:ua.distanceRGBA_frag}};Xb.physical={uniforms:k.UniformsUtils.merge([Xb.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:ua.meshphysical_vert,fragmentShader:ua.meshphysical_frag};
Na.prototype={constructor:Na,set:function(b,a){this.min.copy(b);this.max.copy(a);return this},setFromPoints:function(b){this.makeEmpty();for(var a=0,c=b.length;a<c;a++)this.expandByPoint(b[a]);return this},setFromCenterAndSize:function(){var b=new e;return function(a,c){var h=b.copy(c).multiplyScalar(.5);this.min.copy(a).sub(h);this.max.copy(a).add(h);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(b){this.min.copy(b.min);this.max.copy(b.max);return this},makeEmpty:function(){this.min.x=
this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(b){b=b||new e;return this.isEmpty()?b.set(0,0):b.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(b){b=b||new e;return this.isEmpty()?b.set(0,0):b.subVectors(this.max,this.min)},expandByPoint:function(b){this.min.min(b);this.max.max(b);return this},expandByVector:function(b){this.min.sub(b);this.max.add(b);return this},expandByScalar:function(b){this.min.addScalar(-b);
this.max.addScalar(b);return this},containsPoint:function(b){return b.x<this.min.x||b.x>this.max.x||b.y<this.min.y||b.y>this.max.y?!1:!0},containsBox:function(b){return this.min.x<=b.min.x&&b.max.x<=this.max.x&&this.min.y<=b.min.y&&b.max.y<=this.max.y?!0:!1},getParameter:function(b,a){return(a||new e).set((b.x-this.min.x)/(this.max.x-this.min.x),(b.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(b){return b.max.x<this.min.x||b.min.x>this.max.x||b.max.y<this.min.y||b.min.y>this.max.y?
!1:!0},clampPoint:function(b,a){return(a||new e).copy(b).clamp(this.min,this.max)},distanceToPoint:function(){var b=new e;return function(a){return b.copy(a).clamp(this.min,this.max).sub(a).length()}}(),intersect:function(b){this.min.max(b.min);this.max.min(b.max);return this},union:function(b){this.min.min(b.min);this.max.max(b.max);return this},translate:function(b){this.min.add(b);this.max.add(b);return this},equals:function(b){return b.min.equals(this.min)&&b.max.equals(this.max)}};aa.prototype=
{constructor:aa,isMaterial:!0,get needsUpdate(){return this._needsUpdate},set needsUpdate(b){!0===b&&this.update();this._needsUpdate=b},setValues:function(b){if(void 0!==b)for(var a in b){var c=b[a];if(void 0===c)console.warn("THREE.Material: '"+a+"' parameter is undefined.");else{var d=this[a];void 0===d?console.warn("THREE."+this.type+": '"+a+"' is not a property of this material."):d&&d.isColor?d.set(c):d&&d.isVector3&&c&&c.isVector3?d.copy(c):this[a]="overdraw"===a?Number(c):c}}},toJSON:function(b){function a(b){var a=
[],c;for(c in b){var h=b[c];delete h.metadata;a.push(h)}return a}var c=void 0===b;c&&(b={textures:{},images:{}});var d={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};d.uuid=this.uuid;d.type=this.type;""!==this.name&&(d.name=this.name);this.color&&this.color.isColor&&(d.color=this.color.getHex());void 0!==this.roughness&&(d.roughness=this.roughness);void 0!==this.metalness&&(d.metalness=this.metalness);this.emissive&&this.emissive.isColor&&(d.emissive=this.emissive.getHex());
this.specular&&this.specular.isColor&&(d.specular=this.specular.getHex());void 0!==this.shininess&&(d.shininess=this.shininess);this.map&&this.map.isTexture&&(d.map=this.map.toJSON(b).uuid);this.alphaMap&&this.alphaMap.isTexture&&(d.alphaMap=this.alphaMap.toJSON(b).uuid);this.lightMap&&this.lightMap.isTexture&&(d.lightMap=this.lightMap.toJSON(b).uuid);this.bumpMap&&this.bumpMap.isTexture&&(d.bumpMap=this.bumpMap.toJSON(b).uuid,d.bumpScale=this.bumpScale);this.normalMap&&this.normalMap.isTexture&&
(d.normalMap=this.normalMap.toJSON(b).uuid,d.normalScale=this.normalScale.toArray());this.displacementMap&&this.displacementMap.isTexture&&(d.displacementMap=this.displacementMap.toJSON(b).uuid,d.displacementScale=this.displacementScale,d.displacementBias=this.displacementBias);this.roughnessMap&&this.roughnessMap.isTexture&&(d.roughnessMap=this.roughnessMap.toJSON(b).uuid);this.metalnessMap&&this.metalnessMap.isTexture&&(d.metalnessMap=this.metalnessMap.toJSON(b).uuid);this.emissiveMap&&this.emissiveMap.isTexture&&
(d.emissiveMap=this.emissiveMap.toJSON(b).uuid);this.specularMap&&this.specularMap.isTexture&&(d.specularMap=this.specularMap.toJSON(b).uuid);this.envMap&&this.envMap.isTexture&&(d.envMap=this.envMap.toJSON(b).uuid,d.reflectivity=this.reflectivity);void 0!==this.size&&(d.size=this.size);void 0!==this.sizeAttenuation&&(d.sizeAttenuation=this.sizeAttenuation);1!==this.blending&&(d.blending=this.blending);2!==this.shading&&(d.shading=this.shading);0!==this.side&&(d.side=this.side);0!==this.vertexColors&&
(d.vertexColors=this.vertexColors);1>this.opacity&&(d.opacity=this.opacity);!0===this.transparent&&(d.transparent=this.transparent);d.depthFunc=this.depthFunc;d.depthTest=this.depthTest;d.depthWrite=this.depthWrite;0<this.alphaTest&&(d.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(d.premultipliedAlpha=this.premultipliedAlpha);!0===this.wireframe&&(d.wireframe=this.wireframe);1<this.wireframeLinewidth&&(d.wireframeLinewidth=this.wireframeLinewidth);"round"!==this.wireframeLinecap&&(d.wireframeLinecap=
this.wireframeLinecap);"round"!==this.wireframeLinejoin&&(d.wireframeLinejoin=this.wireframeLinejoin);d.skinning=this.skinning;d.morphTargets=this.morphTargets;c&&(c=a(b.textures),b=a(b.images),0<c.length&&(d.textures=c),0<b.length&&(d.images=b));return d},clone:function(){return(new this.constructor).copy(this)},copy:function(b){this.name=b.name;this.fog=b.fog;this.lights=b.lights;this.blending=b.blending;this.side=b.side;this.shading=b.shading;this.vertexColors=b.vertexColors;this.opacity=b.opacity;
this.transparent=b.transparent;this.blendSrc=b.blendSrc;this.blendDst=b.blendDst;this.blendEquation=b.blendEquation;this.blendSrcAlpha=b.blendSrcAlpha;this.blendDstAlpha=b.blendDstAlpha;this.blendEquationAlpha=b.blendEquationAlpha;this.depthFunc=b.depthFunc;this.depthTest=b.depthTest;this.depthWrite=b.depthWrite;this.colorWrite=b.colorWrite;this.precision=b.precision;this.polygonOffset=b.polygonOffset;this.polygonOffsetFactor=b.polygonOffsetFactor;this.polygonOffsetUnits=b.polygonOffsetUnits;this.alphaTest=
b.alphaTest;this.premultipliedAlpha=b.premultipliedAlpha;this.overdraw=b.overdraw;this.visible=b.visible;this.clipShadows=b.clipShadows;b=b.clippingPlanes;var a=null;if(null!==b)for(var c=b.length,a=Array(c),d=0;d!==c;++d)a[d]=b[d].clone();this.clippingPlanes=a;return this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};Object.assign(aa.prototype,c.prototype);var oe=0;Ba.prototype=Object.create(aa.prototype);Ba.prototype.constructor=
Ba;Ba.prototype.isShaderMaterial=!0;Ba.prototype.copy=function(b){aa.prototype.copy.call(this,b);this.fragmentShader=b.fragmentShader;this.vertexShader=b.vertexShader;this.uniforms=k.UniformsUtils.clone(b.uniforms);this.defines=b.defines;this.wireframe=b.wireframe;this.wireframeLinewidth=b.wireframeLinewidth;this.lights=b.lights;this.clipping=b.clipping;this.skinning=b.skinning;this.morphTargets=b.morphTargets;this.morphNormals=b.morphNormals;this.extensions=b.extensions;return this};Ba.prototype.toJSON=
function(b){b=aa.prototype.toJSON.call(this,b);b.uniforms=this.uniforms;b.vertexShader=this.vertexShader;b.fragmentShader=this.fragmentShader;return b};Aa.prototype=Object.create(aa.prototype);Aa.prototype.constructor=Aa;Aa.prototype.isMeshDepthMaterial=!0;Aa.prototype.copy=function(b){aa.prototype.copy.call(this,b);this.depthPacking=b.depthPacking;this.skinning=b.skinning;this.morphTargets=b.morphTargets;this.map=b.map;this.alphaMap=b.alphaMap;this.displacementMap=b.displacementMap;this.displacementScale=
b.displacementScale;this.displacementBias=b.displacementBias;this.wireframe=b.wireframe;this.wireframeLinewidth=b.wireframeLinewidth;return this};ra.prototype={constructor:ra,isBox3:!0,set:function(b,a){this.min.copy(b);this.max.copy(a);return this},setFromArray:function(b){for(var a=Infinity,c=Infinity,d=Infinity,e=-Infinity,g=-Infinity,f=-Infinity,k=0,l=b.length;k<l;k+=3){var m=b[k],n=b[k+1],p=b[k+2];m<a&&(a=m);n<c&&(c=n);p<d&&(d=p);m>e&&(e=m);n>g&&(g=n);p>f&&(f=p)}this.min.set(a,c,d);this.max.set(e,
g,f)},setFromPoints:function(b){this.makeEmpty();for(var a=0,c=b.length;a<c;a++)this.expandByPoint(b[a]);return this},setFromCenterAndSize:function(){var b=new g;return function(a,c){var h=b.copy(c).multiplyScalar(.5);this.min.copy(a).sub(h);this.max.copy(a).add(h);return this}}(),setFromObject:function(){var b=new g;return function(a){var c=this;a.updateMatrixWorld(!0);this.makeEmpty();a.traverse(function(a){var h=a.geometry;if(void 0!==h)if(h&&h.isGeometry)for(var h=h.vertices,d=0,e=h.length;d<
e;d++)b.copy(h[d]),b.applyMatrix4(a.matrixWorld),c.expandByPoint(b);else if(h&&h.isBufferGeometry&&(e=h.attributes.position,void 0!==e)){var r;e&&e.isInterleavedBufferAttribute?(h=e.data.array,d=e.offset,r=e.data.stride):(h=e.array,d=0,r=3);for(e=h.length;d<e;d+=r)b.fromArray(h,d),b.applyMatrix4(a.matrixWorld),c.expandByPoint(b)}});return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(b){this.min.copy(b.min);this.max.copy(b.max);return this},makeEmpty:function(){this.min.x=
this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(b){b=b||new g;return this.isEmpty()?b.set(0,0,0):b.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(b){b=b||new g;return this.isEmpty()?b.set(0,0,0):b.subVectors(this.max,this.min)},expandByPoint:function(b){this.min.min(b);this.max.max(b);return this},expandByVector:function(b){this.min.sub(b);
this.max.add(b);return this},expandByScalar:function(b){this.min.addScalar(-b);this.max.addScalar(b);return this},containsPoint:function(b){return b.x<this.min.x||b.x>this.max.x||b.y<this.min.y||b.y>this.max.y||b.z<this.min.z||b.z>this.max.z?!1:!0},containsBox:function(b){return this.min.x<=b.min.x&&b.max.x<=this.max.x&&this.min.y<=b.min.y&&b.max.y<=this.max.y&&this.min.z<=b.min.z&&b.max.z<=this.max.z?!0:!1},getParameter:function(b,a){return(a||new g).set((b.x-this.min.x)/(this.max.x-this.min.x),
(b.y-this.min.y)/(this.max.y-this.min.y),(b.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(b){return b.max.x<this.min.x||b.min.x>this.max.x||b.max.y<this.min.y||b.min.y>this.max.y||b.max.z<this.min.z||b.min.z>this.max.z?!1:!0},intersectsSphere:function(){var b;return function(a){void 0===b&&(b=new g);this.clampPoint(a.center,b);return b.distanceToSquared(a.center)<=a.radius*a.radius}}(),intersectsPlane:function(b){var a,c;0<b.normal.x?(a=b.normal.x*this.min.x,c=b.normal.x*this.max.x):
(a=b.normal.x*this.max.x,c=b.normal.x*this.min.x);0<b.normal.y?(a+=b.normal.y*this.min.y,c+=b.normal.y*this.max.y):(a+=b.normal.y*this.max.y,c+=b.normal.y*this.min.y);0<b.normal.z?(a+=b.normal.z*this.min.z,c+=b.normal.z*this.max.z):(a+=b.normal.z*this.max.z,c+=b.normal.z*this.min.z);return a<=b.constant&&c>=b.constant},clampPoint:function(b,a){return(a||new g).copy(b).clamp(this.min,this.max)},distanceToPoint:function(){var b=new g;return function(a){return b.copy(a).clamp(this.min,this.max).sub(a).length()}}(),
getBoundingSphere:function(){var b=new g;return function(a){a=a||new Oa;this.getCenter(a.center);a.radius=.5*this.size(b).length();return a}}(),intersect:function(b){this.min.max(b.min);this.max.min(b.max);this.isEmpty()&&this.makeEmpty();return this},union:function(b){this.min.min(b.min);this.max.max(b.max);return this},applyMatrix4:function(){var b=[new g,new g,new g,new g,new g,new g,new g,new g];return function(a){if(this.isEmpty())return this;b[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(a);
b[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(a);b[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(a);b[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(a);b[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(a);b[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(a);b[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(a);b[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(a);this.setFromPoints(b);return this}}(),translate:function(b){this.min.add(b);this.max.add(b);
return this},equals:function(b){return b.min.equals(this.min)&&b.max.equals(this.max)}};Oa.prototype={constructor:Oa,set:function(b,a){this.center.copy(b);this.radius=a;return this},setFromPoints:function(){var b=new ra;return function(a,c){var h=this.center;void 0!==c?h.copy(c):b.setFromPoints(a).getCenter(h);for(var d=0,e=0,r=a.length;e<r;e++)d=Math.max(d,h.distanceToSquared(a[e]));this.radius=Math.sqrt(d);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(b){this.center.copy(b.center);
this.radius=b.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(b){return b.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(b){return b.distanceTo(this.center)-this.radius},intersectsSphere:function(b){var a=this.radius+b.radius;return b.center.distanceToSquared(this.center)<=a*a},intersectsBox:function(b){return b.intersectsSphere(this)},intersectsPlane:function(b){return Math.abs(this.center.dot(b.normal)-b.constant)<=this.radius},
clampPoint:function(b,a){var c=this.center.distanceToSquared(b),h=a||new g;h.copy(b);c>this.radius*this.radius&&(h.sub(this.center).normalize(),h.multiplyScalar(this.radius).add(this.center));return h},getBoundingBox:function(b){b=b||new ra;b.set(this.center,this.center);b.expandByScalar(this.radius);return b},applyMatrix4:function(b){this.center.applyMatrix4(b);this.radius*=b.getMaxScaleOnAxis();return this},translate:function(b){this.center.add(b);return this},equals:function(b){return b.center.equals(this.center)&&
b.radius===this.radius}};La.prototype={constructor:La,isMatrix3:!0,set:function(b,a,c,d,e,g,f,k,l){var h=this.elements;h[0]=b;h[1]=d;h[2]=f;h[3]=a;h[4]=e;h[5]=k;h[6]=c;h[7]=g;h[8]=l;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(b){b=b.elements;this.set(b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8]);return this},setFromMatrix4:function(b){b=b.elements;this.set(b[0],b[4],b[8],b[1],b[5],b[9],
b[2],b[6],b[10]);return this},applyToVector3Array:function(){var b;return function(a,c,d){void 0===b&&(b=new g);void 0===c&&(c=0);void 0===d&&(d=a.length);for(var h=0;h<d;h+=3,c+=3)b.fromArray(a,c),b.applyMatrix3(this),b.toArray(a,c);return a}}(),applyToBuffer:function(){var b;return function(a,c,d){void 0===b&&(b=new g);void 0===c&&(c=0);void 0===d&&(d=a.length/a.itemSize);for(var h=0;h<d;h++,c++)b.x=a.getX(c),b.y=a.getY(c),b.z=a.getZ(c),b.applyMatrix3(this),a.setXYZ(b.x,b.y,b.z);return a}}(),multiplyScalar:function(b){var a=
this.elements;a[0]*=b;a[3]*=b;a[6]*=b;a[1]*=b;a[4]*=b;a[7]*=b;a[2]*=b;a[5]*=b;a[8]*=b;return this},determinant:function(){var b=this.elements,a=b[0],c=b[1],d=b[2],e=b[3],g=b[4],f=b[5],k=b[6],l=b[7],b=b[8];return a*g*b-a*f*l-c*e*b+c*f*k+d*e*l-d*g*k},getInverse:function(b,a){b&&b.isMatrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var c=b.elements,h=this.elements,d=c[0],e=c[1],g=c[2],f=c[3],k=c[4],l=c[5],m=c[6],n=c[7],c=c[8],p=c*k-l*n,q=l*m-c*f,t=n*f-k*m,u=d*p+e*
q+g*t;if(0===u){if(!0===a)throw Error("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");return this.identity()}u=1/u;h[0]=p*u;h[1]=(g*n-c*e)*u;h[2]=(l*e-g*k)*u;h[3]=q*u;h[4]=(c*d-g*m)*u;h[5]=(g*f-l*d)*u;h[6]=t*u;h[7]=(e*m-n*d)*u;h[8]=(k*d-e*f)*u;return this},transpose:function(){var b,a=this.elements;b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this},flattenToArrayOffset:function(b,
a){console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.");return this.toArray(b,a)},getNormalMatrix:function(b){return this.setFromMatrix4(b).getInverse(this).transpose()},transposeIntoArray:function(b){var a=this.elements;b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return this},fromArray:function(b,a){void 0===a&&(a=0);for(var c=0;9>c;c++)this.elements[c]=b[c+a];return this},toArray:function(b,a){void 0===b&&(b=
[]);void 0===a&&(a=0);var c=this.elements;b[a]=c[0];b[a+1]=c[1];b[a+2]=c[2];b[a+3]=c[3];b[a+4]=c[4];b[a+5]=c[5];b[a+6]=c[6];b[a+7]=c[7];b[a+8]=c[8];return b}};Ma.prototype={constructor:Ma,set:function(b,a){this.normal.copy(b);this.constant=a;return this},setComponents:function(b,a,c,d){this.normal.set(b,a,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(b,a){this.normal.copy(b);this.constant=-a.dot(this.normal);return this},setFromCoplanarPoints:function(){var b=new g,a=new g;
return function(c,h,d){h=b.subVectors(d,h).cross(a.subVectors(c,h)).normalize();this.setFromNormalAndCoplanarPoint(h,c);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(b){this.normal.copy(b.normal);this.constant=b.constant;return this},normalize:function(){var b=1/this.normal.length();this.normal.multiplyScalar(b);this.constant*=b;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(b){return this.normal.dot(b)+
this.constant},distanceToSphere:function(b){return this.distanceToPoint(b.center)-b.radius},projectPoint:function(b,a){return this.orthoPoint(b,a).sub(b).negate()},orthoPoint:function(b,a){var c=this.distanceToPoint(b);return(a||new g).copy(this.normal).multiplyScalar(c)},intersectLine:function(){var b=new g;return function(a,c){var h=c||new g,d=a.delta(b),e=this.normal.dot(d);if(0===e){if(0===this.distanceToPoint(a.start))return h.copy(a.start)}else return e=-(a.start.dot(this.normal)+this.constant)/
e,0>e||1<e?void 0:h.copy(d).multiplyScalar(e).add(a.start)}}(),intersectsLine:function(b){var a=this.distanceToPoint(b.start);b=this.distanceToPoint(b.end);return 0>a&&0<b||0>b&&0<a},intersectsBox:function(b){return b.intersectsPlane(this)},intersectsSphere:function(b){return b.intersectsPlane(this)},coplanarPoint:function(b){return(b||new g).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var b=new g,a=new La;return function(c,h){var d=this.coplanarPoint(b).applyMatrix4(c),
e=h||a.getNormalMatrix(c),e=this.normal.applyMatrix3(e).normalize();this.constant=-d.dot(e);return this}}(),translate:function(b){this.constant-=b.dot(this.normal);return this},equals:function(b){return b.normal.equals(this.normal)&&b.constant===this.constant}};yb.prototype={constructor:yb,set:function(b,a,c,d,e,g){var h=this.planes;h[0].copy(b);h[1].copy(a);h[2].copy(c);h[3].copy(d);h[4].copy(e);h[5].copy(g);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(b){for(var a=
this.planes,c=0;6>c;c++)a[c].copy(b.planes[c]);return this},setFromMatrix:function(b){var a=this.planes,c=b.elements;b=c[0];var d=c[1],e=c[2],g=c[3],f=c[4],k=c[5],l=c[6],m=c[7],n=c[8],p=c[9],q=c[10],t=c[11],u=c[12],z=c[13],w=c[14],c=c[15];a[0].setComponents(g-b,m-f,t-n,c-u).normalize();a[1].setComponents(g+b,m+f,t+n,c+u).normalize();a[2].setComponents(g+d,m+k,t+p,c+z).normalize();a[3].setComponents(g-d,m-k,t-p,c-z).normalize();a[4].setComponents(g-e,m-l,t-q,c-w).normalize();a[5].setComponents(g+e,
m+l,t+q,c+w).normalize();return this},intersectsObject:function(){var b=new Oa;return function(a){var c=a.geometry;null===c.boundingSphere&&c.computeBoundingSphere();b.copy(c.boundingSphere).applyMatrix4(a.matrixWorld);return this.intersectsSphere(b)}}(),intersectsSprite:function(){var b=new Oa;return function(a){b.center.set(0,0,0);b.radius=.7071067811865476;b.applyMatrix4(a.matrixWorld);return this.intersectsSphere(b)}}(),intersectsSphere:function(b){var a=this.planes,c=b.center;b=-b.radius;for(var d=
0;6>d;d++)if(a[d].distanceToPoint(c)<b)return!1;return!0},intersectsBox:function(){var b=new g,a=new g;return function(c){for(var h=this.planes,d=0;6>d;d++){var e=h[d];b.x=0<e.normal.x?c.min.x:c.max.x;a.x=0<e.normal.x?c.max.x:c.min.x;b.y=0<e.normal.y?c.min.y:c.max.y;a.y=0<e.normal.y?c.max.y:c.min.y;b.z=0<e.normal.z?c.min.z:c.max.z;a.z=0<e.normal.z?c.max.z:c.min.z;var g=e.distanceToPoint(b),e=e.distanceToPoint(a);if(0>g&&0>e)return!1}return!0}}(),containsPoint:function(b){for(var a=this.planes,c=0;6>
c;c++)if(0>a[c].distanceToPoint(b))return!1;return!0}};fb.prototype={constructor:fb,set:function(b,a){this.origin.copy(b);this.direction.copy(a);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(b){this.origin.copy(b.origin);this.direction.copy(b.direction);return this},at:function(b,a){return(a||new g).copy(this.direction).multiplyScalar(b).add(this.origin)},lookAt:function(b){this.direction.copy(b).sub(this.origin).normalize();return this},recast:function(){var b=
new g;return function(a){this.origin.copy(this.at(a,b));return this}}(),closestPointToPoint:function(b,a){var c=a||new g;c.subVectors(b,this.origin);var h=c.dot(this.direction);return 0>h?c.copy(this.origin):c.copy(this.direction).multiplyScalar(h).add(this.origin)},distanceToPoint:function(b){return Math.sqrt(this.distanceSqToPoint(b))},distanceSqToPoint:function(){var b=new g;return function(a){var c=b.subVectors(a,this.origin).dot(this.direction);if(0>c)return this.origin.distanceToSquared(a);
b.copy(this.direction).multiplyScalar(c).add(this.origin);return b.distanceToSquared(a)}}(),distanceSqToSegment:function(){var b=new g,a=new g,c=new g;return function(h,d,e,g){b.copy(h).add(d).multiplyScalar(.5);a.copy(d).sub(h).normalize();c.copy(this.origin).sub(b);var f=.5*h.distanceTo(d),r=-this.direction.dot(a),v=c.dot(this.direction),k=-c.dot(a),l=c.lengthSq(),A=Math.abs(1-r*r),m;0<A?(h=r*k-v,d=r*v-k,m=f*A,0<=h?d>=-m?d<=m?(f=1/A,h*=f,d*=f,r=h*(h+r*d+2*v)+d*(r*h+d+2*k)+l):(d=f,h=Math.max(0,-(r*
d+v)),r=-h*h+d*(d+2*k)+l):(d=-f,h=Math.max(0,-(r*d+v)),r=-h*h+d*(d+2*k)+l):d<=-m?(h=Math.max(0,-(-r*f+v)),d=0<h?-f:Math.min(Math.max(-f,-k),f),r=-h*h+d*(d+2*k)+l):d<=m?(h=0,d=Math.min(Math.max(-f,-k),f),r=d*(d+2*k)+l):(h=Math.max(0,-(r*f+v)),d=0<h?f:Math.min(Math.max(-f,-k),f),r=-h*h+d*(d+2*k)+l)):(d=0<r?-f:f,h=Math.max(0,-(r*d+v)),r=-h*h+d*(d+2*k)+l);e&&e.copy(this.direction).multiplyScalar(h).add(this.origin);g&&g.copy(a).multiplyScalar(d).add(b);return r}}(),intersectSphere:function(){var b=new g;
return function(a,c){b.subVectors(a.center,this.origin);var h=b.dot(this.direction),d=b.dot(b)-h*h,e=a.radius*a.radius;if(d>e)return null;e=Math.sqrt(e-d);d=h-e;h+=e;return 0>d&&0>h?null:0>d?this.at(h,c):this.at(d,c)}}(),intersectsSphere:function(b){return this.distanceToPoint(b.center)<=b.radius},distanceToPlane:function(b){var a=b.normal.dot(this.direction);if(0===a)return 0===b.distanceToPoint(this.origin)?0:null;b=-(this.origin.dot(b.normal)+b.constant)/a;return 0<=b?b:null},intersectPlane:function(b,
a){var c=this.distanceToPlane(b);return null===c?null:this.at(c,a)},intersectsPlane:function(b){var a=b.distanceToPoint(this.origin);return 0===a||0>b.normal.dot(this.direction)*a?!0:!1},intersectBox:function(b,a){var c,h,d,e,g;h=1/this.direction.x;e=1/this.direction.y;g=1/this.direction.z;var f=this.origin;0<=h?(c=(b.min.x-f.x)*h,h*=b.max.x-f.x):(c=(b.max.x-f.x)*h,h*=b.min.x-f.x);0<=e?(d=(b.min.y-f.y)*e,e*=b.max.y-f.y):(d=(b.max.y-f.y)*e,e*=b.min.y-f.y);if(c>e||d>h)return null;if(d>c||c!==c)c=d;
if(e<h||h!==h)h=e;0<=g?(d=(b.min.z-f.z)*g,g*=b.max.z-f.z):(d=(b.max.z-f.z)*g,g*=b.min.z-f.z);if(c>g||d>h)return null;if(d>c||c!==c)c=d;if(g<h||h!==h)h=g;return 0>h?null:this.at(0<=c?c:h,a)},intersectsBox:function(){var b=new g;return function(a){return null!==this.intersectBox(a,b)}}(),intersectTriangle:function(){var b=new g,a=new g,c=new g,d=new g;return function(h,e,g,f,r){a.subVectors(e,h);c.subVectors(g,h);d.crossVectors(a,c);e=this.direction.dot(d);if(0<e){if(f)return null;f=1}else if(0>e)f=
-1,e=-e;else return null;b.subVectors(this.origin,h);h=f*this.direction.dot(c.crossVectors(b,c));if(0>h)return null;g=f*this.direction.dot(a.cross(b));if(0>g||h+g>e)return null;h=-f*b.dot(d);return 0>h?null:this.at(h/e,r)}}(),applyMatrix4:function(b){this.direction.add(this.origin).applyMatrix4(b);this.origin.applyMatrix4(b);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(b){return b.origin.equals(this.origin)&&b.direction.equals(this.direction)}};gb.RotationOrders=
"XYZ YZX ZXY XZY YXZ ZYX".split(" ");gb.DefaultOrder="XYZ";gb.prototype={constructor:gb,isEuler:!0,get x(){return this._x},set x(b){this._x=b;this.onChangeCallback()},get y(){return this._y},set y(b){this._y=b;this.onChangeCallback()},get z(){return this._z},set z(b){this._z=b;this.onChangeCallback()},get order(){return this._order},set order(b){this._order=b;this.onChangeCallback()},set:function(b,a,c,d){this._x=b;this._y=a;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},
clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(b){this._x=b._x;this._y=b._y;this._z=b._z;this._order=b._order;this.onChangeCallback();return this},setFromRotationMatrix:function(b,a,c){var h=k.Math.clamp,d=b.elements;b=d[0];var e=d[4],g=d[8],f=d[1],r=d[5],l=d[9],m=d[2],n=d[6],d=d[10];a=a||this._order;"XYZ"===a?(this._y=Math.asin(h(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-e,b)):(this._x=Math.atan2(n,r),this._z=0)):"YXZ"===
a?(this._x=Math.asin(-h(l,-1,1)),.99999>Math.abs(l)?(this._y=Math.atan2(g,d),this._z=Math.atan2(f,r)):(this._y=Math.atan2(-m,b),this._z=0)):"ZXY"===a?(this._x=Math.asin(h(n,-1,1)),.99999>Math.abs(n)?(this._y=Math.atan2(-m,d),this._z=Math.atan2(-e,r)):(this._y=0,this._z=Math.atan2(f,b))):"ZYX"===a?(this._y=Math.asin(-h(m,-1,1)),.99999>Math.abs(m)?(this._x=Math.atan2(n,d),this._z=Math.atan2(f,b)):(this._x=0,this._z=Math.atan2(-e,r))):"YZX"===a?(this._z=Math.asin(h(f,-1,1)),.99999>Math.abs(f)?(this._x=
Math.atan2(-l,r),this._y=Math.atan2(-m,b)):(this._x=0,this._y=Math.atan2(g,d))):"XZY"===a?(this._z=Math.asin(-h(e,-1,1)),.99999>Math.abs(e)?(this._x=Math.atan2(n,r),this._y=Math.atan2(g,b)):(this._x=Math.atan2(-l,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+a);this._order=a;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var b;return function(a,c,d){void 0===b&&(b=new n);b.makeRotationFromQuaternion(a);return this.setFromRotationMatrix(b,
c,d)}}(),setFromVector3:function(b,a){return this.set(b.x,b.y,b.z,a||this._order)},reorder:function(){var b=new m;return function(a){b.setFromEuler(this);return this.setFromQuaternion(b,a)}}(),equals:function(b){return b._x===this._x&&b._y===this._y&&b._z===this._z&&b._order===this._order},fromArray:function(b){this._x=b[0];this._y=b[1];this._z=b[2];void 0!==b[3]&&(this._order=b[3]);this.onChangeCallback();return this},toArray:function(b,a){void 0===b&&(b=[]);void 0===a&&(a=0);b[a]=this._x;b[a+1]=
this._y;b[a+2]=this._z;b[a+3]=this._order;return b},toVector3:function(b){return b?b.set(this._x,this._y,this._z):new g(this._x,this._y,this._z)},onChange:function(b){this.onChangeCallback=b;return this},onChangeCallback:function(){}};Tb.prototype={constructor:Tb,set:function(b){this.mask=1<<b},enable:function(b){this.mask|=1<<b},toggle:function(b){this.mask^=1<<b},disable:function(b){this.mask&=~(1<<b)},test:function(b){return 0!==(this.mask&b.mask)}};X.DefaultUp=new g(0,1,0);X.DefaultMatrixAutoUpdate=
!0;Object.assign(X.prototype,c.prototype,{isObject3D:!0,applyMatrix:function(b){this.matrix.multiplyMatrices(b,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(b,a){this.quaternion.setFromAxisAngle(b,a)},setRotationFromEuler:function(b){this.quaternion.setFromEuler(b,!0)},setRotationFromMatrix:function(b){this.quaternion.setFromRotationMatrix(b)},setRotationFromQuaternion:function(b){this.quaternion.copy(b)},rotateOnAxis:function(){var b=
new m;return function(a,c){b.setFromAxisAngle(a,c);this.quaternion.multiply(b);return this}}(),rotateX:function(){var b=new g(1,0,0);return function(a){return this.rotateOnAxis(b,a)}}(),rotateY:function(){var b=new g(0,1,0);return function(a){return this.rotateOnAxis(b,a)}}(),rotateZ:function(){var b=new g(0,0,1);return function(a){return this.rotateOnAxis(b,a)}}(),translateOnAxis:function(){var b=new g;return function(a,c){b.copy(a).applyQuaternion(this.quaternion);this.position.add(b.multiplyScalar(c));
return this}}(),translateX:function(){var b=new g(1,0,0);return function(a){return this.translateOnAxis(b,a)}}(),translateY:function(){var b=new g(0,1,0);return function(a){return this.translateOnAxis(b,a)}}(),translateZ:function(){var b=new g(0,0,1);return function(a){return this.translateOnAxis(b,a)}}(),localToWorld:function(b){return b.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var b=new n;return function(a){return a.applyMatrix4(b.getInverse(this.matrixWorld))}}(),lookAt:function(){var b=
new n;return function(a){b.lookAt(a,this.position,this.up);this.quaternion.setFromRotationMatrix(b)}}(),add:function(b){if(1<arguments.length){for(var a=0;a<arguments.length;a++)this.add(arguments[a]);return this}if(b===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",b),this;b&&b.isObject3D?(null!==b.parent&&b.parent.remove(b),b.parent=this,b.dispatchEvent({type:"added"}),this.children.push(b)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",
b);return this},remove:function(b){if(1<arguments.length)for(var a=0;a<arguments.length;a++)this.remove(arguments[a]);a=this.children.indexOf(b);-1!==a&&(b.parent=null,b.dispatchEvent({type:"removed"}),this.children.splice(a,1))},getObjectById:function(b){return this.getObjectByProperty("id",b)},getObjectByName:function(b){return this.getObjectByProperty("name",b)},getObjectByProperty:function(b,a){if(this[b]===a)return this;for(var c=0,h=this.children.length;c<h;c++){var d=this.children[c].getObjectByProperty(b,
a);if(void 0!==d)return d}},getWorldPosition:function(b){b=b||new g;this.updateMatrixWorld(!0);return b.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var b=new g,a=new g;return function(c){c=c||new m;this.updateMatrixWorld(!0);this.matrixWorld.decompose(b,c,a);return c}}(),getWorldRotation:function(){var b=new m;return function(a){a=a||new gb;this.getWorldQuaternion(b);return a.setFromQuaternion(b,this.rotation.order,!1)}}(),getWorldScale:function(){var b=new g,a=new m;return function(c){c=
c||new g;this.updateMatrixWorld(!0);this.matrixWorld.decompose(b,a,c);return c}}(),getWorldDirection:function(){var b=new m;return function(a){a=a||new g;this.getWorldQuaternion(b);return a.set(0,0,1).applyQuaternion(b)}}(),raycast:function(){},traverse:function(b){b(this);for(var a=this.children,c=0,d=a.length;c<d;c++)a[c].traverse(b)},traverseVisible:function(b){if(!1!==this.visible){b(this);for(var a=this.children,c=0,d=a.length;c<d;c++)a[c].traverseVisible(b)}},traverseAncestors:function(b){var a=
this.parent;null!==a&&(b(a),a.traverseAncestors(b))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(b){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===b)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,b=!0;for(var a=this.children,c=0,d=a.length;c<d;c++)a[c].updateMatrixWorld(b)},
toJSON:function(b){function a(b){var a=[],c;for(c in b){var h=b[c];delete h.metadata;a.push(h)}return a}var c=void 0===b||""===b,d={};c&&(b={geometries:{},materials:{},textures:{},images:{}},d.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var e={};e.uuid=this.uuid;e.type=this.type;""!==this.name&&(e.name=this.name);"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData);!0===this.castShadow&&(e.castShadow=!0);!0===this.receiveShadow&&(e.receiveShadow=!0);!1===this.visible&&
(e.visible=!1);e.matrix=this.matrix.toArray();void 0!==this.geometry&&(void 0===b.geometries[this.geometry.uuid]&&(b.geometries[this.geometry.uuid]=this.geometry.toJSON(b)),e.geometry=this.geometry.uuid);void 0!==this.material&&(void 0===b.materials[this.material.uuid]&&(b.materials[this.material.uuid]=this.material.toJSON(b)),e.material=this.material.uuid);if(0<this.children.length){e.children=[];for(var g=0;g<this.children.length;g++)e.children.push(this.children[g].toJSON(b).object)}if(c){var c=
a(b.geometries),g=a(b.materials),f=a(b.textures);b=a(b.images);0<c.length&&(d.geometries=c);0<g.length&&(d.materials=g);0<f.length&&(d.textures=f);0<b.length&&(d.images=b)}d.object=e;return d},clone:function(b){return(new this.constructor).copy(this,b)},copy:function(b,a){void 0===a&&(a=!0);this.name=b.name;this.up.copy(b.up);this.position.copy(b.position);this.quaternion.copy(b.quaternion);this.scale.copy(b.scale);this.matrix.copy(b.matrix);this.matrixWorld.copy(b.matrixWorld);this.matrixAutoUpdate=
b.matrixAutoUpdate;this.matrixWorldNeedsUpdate=b.matrixWorldNeedsUpdate;this.visible=b.visible;this.castShadow=b.castShadow;this.receiveShadow=b.receiveShadow;this.frustumCulled=b.frustumCulled;this.renderOrder=b.renderOrder;this.userData=JSON.parse(JSON.stringify(b.userData));if(!0===a)for(var c=0;c<b.children.length;c++)this.add(b.children[c].clone());return this}});var pe=0;lb.prototype={constructor:lb,set:function(b,a){this.start.copy(b);this.end.copy(a);return this},clone:function(){return(new this.constructor).copy(this)},
copy:function(b){this.start.copy(b.start);this.end.copy(b.end);return this},getCenter:function(b){return(b||new g).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(b){return(b||new g).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(b,a){var c=a||new g;return this.delta(c).multiplyScalar(b).add(this.start)},closestPointToPointParameter:function(){var b=new g,
a=new g;return function(c,d){b.subVectors(c,this.start);a.subVectors(this.end,this.start);var h=a.dot(a),h=a.dot(b)/h;d&&(h=k.Math.clamp(h,0,1));return h}}(),closestPointToPoint:function(b,a,c){b=this.closestPointToPointParameter(b,a);c=c||new g;return this.delta(c).multiplyScalar(b).add(this.start)},applyMatrix4:function(b){this.start.applyMatrix4(b);this.end.applyMatrix4(b);return this},equals:function(b){return b.start.equals(this.start)&&b.end.equals(this.end)}};Qa.normal=function(){var b=new g;
return function(a,c,d,e){e=e||new g;e.subVectors(d,c);b.subVectors(a,c);e.cross(b);a=e.lengthSq();return 0<a?e.multiplyScalar(1/Math.sqrt(a)):e.set(0,0,0)}}();Qa.barycoordFromPoint=function(){var b=new g,a=new g,c=new g;return function(d,h,e,f,r){b.subVectors(f,h);a.subVectors(e,h);c.subVectors(d,h);d=b.dot(b);h=b.dot(a);e=b.dot(c);var k=a.dot(a);f=a.dot(c);var v=d*k-h*h;r=r||new g;if(0===v)return r.set(-2,-1,-1);v=1/v;k=(k*e-h*f)*v;d=(d*f-h*e)*v;return r.set(1-k-d,d,k)}}();Qa.containsPoint=function(){var b=
new g;return function(a,c,d,e){a=Qa.barycoordFromPoint(a,c,d,e,b);return 0<=a.x&&0<=a.y&&1>=a.x+a.y}}();Qa.prototype={constructor:Qa,set:function(b,a,c){this.a.copy(b);this.b.copy(a);this.c.copy(c);return this},setFromPointsAndIndices:function(b,a,c,d){this.a.copy(b[a]);this.b.copy(b[c]);this.c.copy(b[d]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(b){this.a.copy(b.a);this.b.copy(b.b);this.c.copy(b.c);return this},area:function(){var b=new g,a=new g;return function(){b.subVectors(this.c,
this.b);a.subVectors(this.a,this.b);return.5*b.cross(a).length()}}(),midpoint:function(b){return(b||new g).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(b){return Qa.normal(this.a,this.b,this.c,b)},plane:function(b){return(b||new Ma).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(b,a){return Qa.barycoordFromPoint(b,this.a,this.b,this.c,a)},containsPoint:function(b){return Qa.containsPoint(b,this.a,this.b,this.c)},closestPointToPoint:function(){var b,
a,c,d;return function(h,e){void 0===b&&(b=new Ma,a=[new lb,new lb,new lb],c=new g,d=new g);var f=e||new g,r=Infinity;b.setFromCoplanarPoints(this.a,this.b,this.c);b.projectPoint(h,c);if(!0===this.containsPoint(c))f.copy(c);else{a[0].set(this.a,this.b);a[1].set(this.b,this.c);a[2].set(this.c,this.a);for(var k=0;k<a.length;k++){a[k].closestPointToPoint(c,!0,d);var v=c.distanceToSquared(d);v<r&&(r=v,f.copy(d))}}return f}}(),equals:function(b){return b.a.equals(this.a)&&b.b.equals(this.b)&&b.c.equals(this.c)}};
sa.prototype={constructor:sa,clone:function(){return(new this.constructor).copy(this)},copy:function(b){this.a=b.a;this.b=b.b;this.c=b.c;this.normal.copy(b.normal);this.color.copy(b.color);this.materialIndex=b.materialIndex;for(var a=0,c=b.vertexNormals.length;a<c;a++)this.vertexNormals[a]=b.vertexNormals[a].clone();a=0;for(c=b.vertexColors.length;a<c;a++)this.vertexColors[a]=b.vertexColors[a].clone();return this}};Pa.prototype=Object.create(aa.prototype);Pa.prototype.constructor=Pa;Pa.prototype.isMeshBasicMaterial=
!0;Pa.prototype.copy=function(b){aa.prototype.copy.call(this,b);this.color.copy(b.color);this.map=b.map;this.aoMap=b.aoMap;this.aoMapIntensity=b.aoMapIntensity;this.specularMap=b.specularMap;this.alphaMap=b.alphaMap;this.envMap=b.envMap;this.combine=b.combine;this.reflectivity=b.reflectivity;this.refractionRatio=b.refractionRatio;this.wireframe=b.wireframe;this.wireframeLinewidth=b.wireframeLinewidth;this.wireframeLinecap=b.wireframeLinecap;this.wireframeLinejoin=b.wireframeLinejoin;this.skinning=
b.skinning;this.morphTargets=b.morphTargets;return this};P.prototype={constructor:P,isBufferAttribute:!0,set needsUpdate(b){!0===b&&this.version++},setDynamic:function(b){this.dynamic=b;return this},copy:function(b){this.array=new b.array.constructor(b.array);this.itemSize=b.itemSize;this.count=b.count;this.normalized=b.normalized;this.dynamic=b.dynamic;return this},copyAt:function(b,a,c){b*=this.itemSize;c*=a.itemSize;for(var d=0,h=this.itemSize;d<h;d++)this.array[b+d]=a.array[c+d];return this},
copyArray:function(b){this.array.set(b);return this},copyColorsArray:function(b){for(var a=this.array,c=0,d=0,e=b.length;d<e;d++){var g=b[d];void 0===g&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",d),g=new O);a[c++]=g.r;a[c++]=g.g;a[c++]=g.b}return this},copyIndicesArray:function(b){for(var a=this.array,c=0,d=0,e=b.length;d<e;d++){var g=b[d];a[c++]=g.a;a[c++]=g.b;a[c++]=g.c}return this},copyVector2sArray:function(b){for(var a=this.array,c=0,d=0,g=b.length;d<g;d++){var f=
b[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",d),f=new e);a[c++]=f.x;a[c++]=f.y}return this},copyVector3sArray:function(b){for(var a=this.array,c=0,d=0,e=b.length;d<e;d++){var f=b[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",d),f=new g);a[c++]=f.x;a[c++]=f.y;a[c++]=f.z}return this},copyVector4sArray:function(b){for(var c=this.array,d=0,e=0,g=b.length;e<g;e++){var f=b[e];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",
e),f=new a);c[d++]=f.x;c[d++]=f.y;c[d++]=f.z;c[d++]=f.w}return this},set:function(b,a){void 0===a&&(a=0);this.array.set(b,a);return this},getX:function(b){return this.array[b*this.itemSize]},setX:function(b,a){this.array[b*this.itemSize]=a;return this},getY:function(b){return this.array[b*this.itemSize+1]},setY:function(b,a){this.array[b*this.itemSize+1]=a;return this},getZ:function(b){return this.array[b*this.itemSize+2]},setZ:function(b,a){this.array[b*this.itemSize+2]=a;return this},getW:function(b){return this.array[b*
this.itemSize+3]},setW:function(b,a){this.array[b*this.itemSize+3]=a;return this},setXY:function(b,a,c){b*=this.itemSize;this.array[b+0]=a;this.array[b+1]=c;return this},setXYZ:function(b,a,c,d){b*=this.itemSize;this.array[b+0]=a;this.array[b+1]=c;this.array[b+2]=d;return this},setXYZW:function(b,a,c,d,e){b*=this.itemSize;this.array[b+0]=a;this.array[b+1]=c;this.array[b+2]=d;this.array[b+3]=e;return this},clone:function(){return(new this.constructor).copy(this)}};Object.assign(ha.prototype,c.prototype,
{isGeometry:!0,applyMatrix:function(b){for(var a=(new La).getNormalMatrix(b),c=0,d=this.vertices.length;c<d;c++)this.vertices[c].applyMatrix4(b);c=0;for(d=this.faces.length;c<d;c++){b=this.faces[c];b.normal.applyMatrix3(a).normalize();for(var e=0,g=b.vertexNormals.length;e<g;e++)b.vertexNormals[e].applyMatrix3(a).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();this.normalsNeedUpdate=this.verticesNeedUpdate=!0;return this},rotateX:function(){var b;
return function(a){void 0===b&&(b=new n);b.makeRotationX(a);this.applyMatrix(b);return this}}(),rotateY:function(){var b;return function(a){void 0===b&&(b=new n);b.makeRotationY(a);this.applyMatrix(b);return this}}(),rotateZ:function(){var b;return function(a){void 0===b&&(b=new n);b.makeRotationZ(a);this.applyMatrix(b);return this}}(),translate:function(){var b;return function(a,c,d){void 0===b&&(b=new n);b.makeTranslation(a,c,d);this.applyMatrix(b);return this}}(),scale:function(){var b;return function(a,
c,d){void 0===b&&(b=new n);b.makeScale(a,c,d);this.applyMatrix(b);return this}}(),lookAt:function(){var b;return function(a){void 0===b&&(b=new X);b.lookAt(a);b.updateMatrix();this.applyMatrix(b.matrix)}}(),fromBufferGeometry:function(b){function a(b,a,d,h){var e=void 0!==l?[q[b].clone(),q[a].clone(),q[d].clone()]:[],f=void 0!==m?[c.colors[b].clone(),c.colors[a].clone(),c.colors[d].clone()]:[];h=new sa(b,a,d,e,f,h);c.faces.push(h);void 0!==n&&c.faceVertexUvs[0].push([t[b].clone(),t[a].clone(),t[d].clone()]);
void 0!==p&&c.faceVertexUvs[1].push([u[b].clone(),u[a].clone(),u[d].clone()])}var c=this,d=null!==b.index?b.index.array:void 0,f=b.attributes,k=f.position.array,l=void 0!==f.normal?f.normal.array:void 0,m=void 0!==f.color?f.color.array:void 0,n=void 0!==f.uv?f.uv.array:void 0,p=void 0!==f.uv2?f.uv2.array:void 0;void 0!==p&&(this.faceVertexUvs[1]=[]);for(var q=[],t=[],u=[],z=f=0;f<k.length;f+=3,z+=2)c.vertices.push(new g(k[f],k[f+1],k[f+2])),void 0!==l&&q.push(new g(l[f],l[f+1],l[f+2])),void 0!==m&&
c.colors.push(new O(m[f],m[f+1],m[f+2])),void 0!==n&&t.push(new e(n[z],n[z+1])),void 0!==p&&u.push(new e(p[z],p[z+1]));if(void 0!==d)if(k=b.groups,0<k.length)for(f=0;f<k.length;f++)for(var w=k[f],y=w.start,x=w.count,z=y,y=y+x;z<y;z+=3)a(d[z],d[z+1],d[z+2],w.materialIndex);else for(f=0;f<d.length;f+=3)a(d[f],d[f+1],d[f+2]);else for(f=0;f<k.length/3;f+=3)a(f,f+1,f+2);this.computeFaceNormals();null!==b.boundingBox&&(this.boundingBox=b.boundingBox.clone());null!==b.boundingSphere&&(this.boundingSphere=
b.boundingSphere.clone());return this},center:function(){this.computeBoundingBox();var b=this.boundingBox.getCenter().negate();this.translate(b.x,b.y,b.z);return b},normalize:function(){this.computeBoundingSphere();var b=this.boundingSphere.center,a=this.boundingSphere.radius,a=0===a?1:1/a,c=new n;c.set(a,0,0,-a*b.x,0,a,0,-a*b.y,0,0,a,-a*b.z,0,0,0,1);this.applyMatrix(c);return this},computeFaceNormals:function(){for(var b=new g,a=new g,c=0,d=this.faces.length;c<d;c++){var e=this.faces[c],f=this.vertices[e.a],
k=this.vertices[e.b];b.subVectors(this.vertices[e.c],k);a.subVectors(f,k);b.cross(a);b.normalize();e.normal.copy(b)}},computeVertexNormals:function(b){void 0===b&&(b=!0);var a,c,d;d=Array(this.vertices.length);a=0;for(c=this.vertices.length;a<c;a++)d[a]=new g;if(b){var e,f,k,l=new g,m=new g;b=0;for(a=this.faces.length;b<a;b++)c=this.faces[b],e=this.vertices[c.a],f=this.vertices[c.b],k=this.vertices[c.c],l.subVectors(k,f),m.subVectors(e,f),l.cross(m),d[c.a].add(l),d[c.b].add(l),d[c.c].add(l)}else for(b=
0,a=this.faces.length;b<a;b++)c=this.faces[b],d[c.a].add(c.normal),d[c.b].add(c.normal),d[c.c].add(c.normal);a=0;for(c=this.vertices.length;a<c;a++)d[a].normalize();b=0;for(a=this.faces.length;b<a;b++)c=this.faces[b],e=c.vertexNormals,3===e.length?(e[0].copy(d[c.a]),e[1].copy(d[c.b]),e[2].copy(d[c.c])):(e[0]=d[c.a].clone(),e[1]=d[c.b].clone(),e[2]=d[c.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var b,a,c,d,e;c=0;for(d=this.faces.length;c<d;c++)for(e=
this.faces[c],e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]),b=0,a=e.vertexNormals.length;b<a;b++)e.__originalVertexNormals[b]?e.__originalVertexNormals[b].copy(e.vertexNormals[b]):e.__originalVertexNormals[b]=e.vertexNormals[b].clone();var f=new ha;f.faces=this.faces;b=0;for(a=this.morphTargets.length;b<a;b++){if(!this.morphNormals[b]){this.morphNormals[b]={};this.morphNormals[b].faceNormals=
[];this.morphNormals[b].vertexNormals=[];e=this.morphNormals[b].faceNormals;var k=this.morphNormals[b].vertexNormals,l,m;c=0;for(d=this.faces.length;c<d;c++)l=new g,m={a:new g,b:new g,c:new g},e.push(l),k.push(m)}k=this.morphNormals[b];f.vertices=this.morphTargets[b].vertices;f.computeFaceNormals();f.computeVertexNormals();c=0;for(d=this.faces.length;c<d;c++)e=this.faces[c],l=k.faceNormals[c],m=k.vertexNormals[c],l.copy(e.normal),m.a.copy(e.vertexNormals[0]),m.b.copy(e.vertexNormals[1]),m.c.copy(e.vertexNormals[2])}c=
0;for(d=this.faces.length;c<d;c++)e=this.faces[c],e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){for(var b=0,a=this.vertices,c=0,d=a.length;c<d;c++)0<c&&(b+=a[c].distanceTo(a[c-1])),this.lineDistances[c]=b},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new ra);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===
this.boundingSphere&&(this.boundingSphere=new Oa);this.boundingSphere.setFromPoints(this.vertices)},merge:function(b,a,c){if(!1===(b&&b.isGeometry))console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",b);else{var d,h=this.vertices.length,e=this.vertices,f=b.vertices,g=this.faces,r=b.faces,k=this.faceVertexUvs[0],l=b.faceVertexUvs[0],m=this.colors,n=b.colors;void 0===c&&(c=0);void 0!==a&&(d=(new La).getNormalMatrix(a));b=0;for(var p=f.length;b<p;b++){var q=f[b].clone();
void 0!==a&&q.applyMatrix4(a);e.push(q)}b=0;for(p=n.length;b<p;b++)m.push(n[b].clone());b=0;for(p=r.length;b<p;b++){var f=r[b],t=f.vertexNormals,n=f.vertexColors,m=new sa(f.a+h,f.b+h,f.c+h);m.normal.copy(f.normal);void 0!==d&&m.normal.applyMatrix3(d).normalize();a=0;for(e=t.length;a<e;a++)q=t[a].clone(),void 0!==d&&q.applyMatrix3(d).normalize(),m.vertexNormals.push(q);m.color.copy(f.color);a=0;for(e=n.length;a<e;a++)q=n[a],m.vertexColors.push(q.clone());m.materialIndex=f.materialIndex+c;g.push(m)}b=
0;for(p=l.length;b<p;b++)if(c=l[b],d=[],void 0!==c){a=0;for(e=c.length;a<e;a++)d.push(c[a].clone());k.push(d)}}},mergeMesh:function(b){!1===(b&&b.isMesh)?console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",b):(b.matrixAutoUpdate&&b.updateMatrix(),this.merge(b.geometry,b.matrix))},mergeVertices:function(){var b={},a=[],c=[],d,e=Math.pow(10,4),f,g;f=0;for(g=this.vertices.length;f<g;f++)d=this.vertices[f],d=Math.round(d.x*e)+"_"+Math.round(d.y*e)+"_"+Math.round(d.z*e),void 0===
b[d]?(b[d]=f,a.push(this.vertices[f]),c[f]=a.length-1):c[f]=c[b[d]];b=[];f=0;for(g=this.faces.length;f<g;f++)for(e=this.faces[f],e.a=c[e.a],e.b=c[e.b],e.c=c[e.c],e=[e.a,e.b,e.c],d=0;3>d;d++)if(e[d]===e[(d+1)%3]){b.push(f);break}for(f=b.length-1;0<=f;f--)for(e=b[f],this.faces.splice(e,1),c=0,g=this.faceVertexUvs.length;c<g;c++)this.faceVertexUvs[c].splice(e,1);f=this.vertices.length-a.length;this.vertices=a;return f},sortFacesByMaterialIndex:function(){for(var b=this.faces,a=b.length,c=0;c<a;c++)b[c]._id=
c;b.sort(function(b,a){return b.materialIndex-a.materialIndex});var d=this.faceVertexUvs[0],e=this.faceVertexUvs[1],f,g;d&&d.length===a&&(f=[]);e&&e.length===a&&(g=[]);for(c=0;c<a;c++){var k=b[c]._id;f&&f.push(d[k]);g&&g.push(e[k])}f&&(this.faceVertexUvs[0]=f);g&&(this.faceVertexUvs[1]=g)},toJSON:function(){function b(b,a,c){return c?b|1<<a:b&~(1<<a)}function a(b){var a=b.x.toString()+b.y.toString()+b.z.toString();if(void 0!==m[a])return m[a];m[a]=l.length/3;l.push(b.x,b.y,b.z);return m[a]}function c(b){var a=
b.r.toString()+b.g.toString()+b.b.toString();if(void 0!==p[a])return p[a];p[a]=n.length;n.push(b.getHex());return p[a]}function d(b){var a=b.x.toString()+b.y.toString();if(void 0!==t[a])return t[a];t[a]=q.length/2;q.push(b.x,b.y);return t[a]}var e={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};e.uuid=this.uuid;e.type=this.type;""!==this.name&&(e.name=this.name);if(void 0!==this.parameters){var f=this.parameters,g;for(g in f)void 0!==f[g]&&(e[g]=f[g]);return e}f=[];for(g=0;g<
this.vertices.length;g++){var k=this.vertices[g];f.push(k.x,k.y,k.z)}var k=[],l=[],m={},n=[],p={},q=[],t={};for(g=0;g<this.faces.length;g++){var u=this.faces[g],z=void 0!==this.faceVertexUvs[0][g],w=0<u.normal.length(),y=0<u.vertexNormals.length,x=1!==u.color.r||1!==u.color.g||1!==u.color.b,D=0<u.vertexColors.length,L=0,L=b(L,0,0),L=b(L,1,!0),L=b(L,2,!1),L=b(L,3,z),L=b(L,4,w),L=b(L,5,y),L=b(L,6,x),L=b(L,7,D);k.push(L);k.push(u.a,u.b,u.c);k.push(u.materialIndex);z&&(z=this.faceVertexUvs[0][g],k.push(d(z[0]),
d(z[1]),d(z[2])));w&&k.push(a(u.normal));y&&(w=u.vertexNormals,k.push(a(w[0]),a(w[1]),a(w[2])));x&&k.push(c(u.color));D&&(u=u.vertexColors,k.push(c(u[0]),c(u[1]),c(u[2])))}e.data={};e.data.vertices=f;e.data.normals=l;0<n.length&&(e.data.colors=n);0<q.length&&(e.data.uvs=[q]);e.data.faces=k;return e},clone:function(){return(new ha).copy(this)},copy:function(b){this.vertices=[];this.faces=[];this.faceVertexUvs=[[]];this.colors=[];for(var a=b.vertices,c=0,d=a.length;c<d;c++)this.vertices.push(a[c].clone());
a=b.colors;c=0;for(d=a.length;c<d;c++)this.colors.push(a[c].clone());a=b.faces;c=0;for(d=a.length;c<d;c++)this.faces.push(a[c].clone());c=0;for(d=b.faceVertexUvs.length;c<d;c++){a=b.faceVertexUvs[c];void 0===this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]);for(var e=0,f=a.length;e<f;e++){for(var g=a[e],k=[],l=0,m=g.length;l<m;l++)k.push(g[l].clone());this.faceVertexUvs[c].push(k)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var dd=0;Object.assign(wc.prototype,c.prototype,
{computeBoundingBox:ha.prototype.computeBoundingBox,computeBoundingSphere:ha.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},computeGroups:function(b){var a,c=[],d;b=b.faces;for(var e=0;e<b.length;e++){var f=b[e];f.materialIndex!==d&&(d=f.materialIndex,
void 0!==a&&(a.count=3*e-a.start,c.push(a)),a={start:3*e,materialIndex:d})}void 0!==a&&(a.count=3*e-a.start,c.push(a));this.groups=c},fromGeometry:function(b){var a=b.faces,c=b.vertices,d=b.faceVertexUvs,f=d[0]&&0<d[0].length,g=d[1]&&0<d[1].length,k=b.morphTargets,l=k.length,m;if(0<l){m=[];for(var n=0;n<l;n++)m[n]=[];this.morphTargets.position=m}var p=b.morphNormals,q=p.length,t;if(0<q){t=[];for(n=0;n<q;n++)t[n]=[];this.morphTargets.normal=t}for(var u=b.skinIndices,z=b.skinWeights,w=u.length===c.length,
y=z.length===c.length,n=0;n<a.length;n++){var x=a[n];this.vertices.push(c[x.a],c[x.b],c[x.c]);var D=x.vertexNormals;3===D.length?this.normals.push(D[0],D[1],D[2]):(D=x.normal,this.normals.push(D,D,D));D=x.vertexColors;3===D.length?this.colors.push(D[0],D[1],D[2]):(D=x.color,this.colors.push(D,D,D));!0===f&&(D=d[0][n],void 0!==D?this.uvs.push(D[0],D[1],D[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",n),this.uvs.push(new e,new e,new e)));!0===g&&(D=d[1][n],void 0!==D?
this.uvs2.push(D[0],D[1],D[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",n),this.uvs2.push(new e,new e,new e)));for(D=0;D<l;D++){var J=k[D].vertices;m[D].push(J[x.a],J[x.b],J[x.c])}for(D=0;D<q;D++)J=p[D].vertexNormals[n],t[D].push(J.a,J.b,J.c);w&&this.skinIndices.push(u[x.a],u[x.b],u[x.c]);y&&this.skinWeights.push(z[x.a],z[x.b],z[x.c])}this.computeGroups(b);this.verticesNeedUpdate=b.verticesNeedUpdate;this.normalsNeedUpdate=b.normalsNeedUpdate;this.colorsNeedUpdate=
b.colorsNeedUpdate;this.uvsNeedUpdate=b.uvsNeedUpdate;this.groupsNeedUpdate=b.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Object.assign(ia.prototype,c.prototype,{isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(b){this.index=b},addAttribute:function(b,a,c){if(!1===(a&&a.isBufferAttribute)&&!1===(a&&a.isInterleavedBufferAttribute))console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(b,
new P(a,c));else if("index"===b)console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(a);else return this.attributes[b]=a,this},getAttribute:function(b){return this.attributes[b]},removeAttribute:function(b){delete this.attributes[b];return this},addGroup:function(b,a,c){this.groups.push({start:b,count:a,materialIndex:void 0!==c?c:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(b,a){this.drawRange.start=b;this.drawRange.count=a},applyMatrix:function(b){var a=
this.attributes.position;void 0!==a&&(b.applyToVector3Array(a.array),a.needsUpdate=!0);a=this.attributes.normal;void 0!==a&&((new La).getNormalMatrix(b).applyToVector3Array(a.array),a.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return this},rotateX:function(){var b;return function(a){void 0===b&&(b=new n);b.makeRotationX(a);this.applyMatrix(b);return this}}(),rotateY:function(){var b;return function(a){void 0===b&&(b=
new n);b.makeRotationY(a);this.applyMatrix(b);return this}}(),rotateZ:function(){var b;return function(a){void 0===b&&(b=new n);b.makeRotationZ(a);this.applyMatrix(b);return this}}(),translate:function(){var b;return function(a,c,d){void 0===b&&(b=new n);b.makeTranslation(a,c,d);this.applyMatrix(b);return this}}(),scale:function(){var b;return function(a,c,d){void 0===b&&(b=new n);b.makeScale(a,c,d);this.applyMatrix(b);return this}}(),lookAt:function(){var b;return function(a){void 0===b&&(b=new X);
b.lookAt(a);b.updateMatrix();this.applyMatrix(b.matrix)}}(),center:function(){this.computeBoundingBox();var b=this.boundingBox.getCenter().negate();this.translate(b.x,b.y,b.z);return b},setFromObject:function(b){var a=b.geometry;if(b&&b.isPoints||b&&b.isLine){b=new Ja(3*a.vertices.length,3);var c=new Ja(3*a.colors.length,3);this.addAttribute("position",b.copyVector3sArray(a.vertices));this.addAttribute("color",c.copyColorsArray(a.colors));a.lineDistances&&a.lineDistances.length===a.vertices.length&&
(b=new Ja(a.lineDistances.length,1),this.addAttribute("lineDistance",b.copyArray(a.lineDistances)));null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone())}else b&&b.isMesh&&a&&a.isGeometry&&this.fromGeometry(a);return this},updateFromObject:function(b){var a=b.geometry;if(b&&b.isMesh){var c=a.__directGeometry;!0===a.elementsNeedUpdate&&(c=void 0,a.elementsNeedUpdate=!1);if(void 0===c)return this.fromGeometry(a);c.verticesNeedUpdate=
a.verticesNeedUpdate;c.normalsNeedUpdate=a.normalsNeedUpdate;c.colorsNeedUpdate=a.colorsNeedUpdate;c.uvsNeedUpdate=a.uvsNeedUpdate;c.groupsNeedUpdate=a.groupsNeedUpdate;a.verticesNeedUpdate=!1;a.normalsNeedUpdate=!1;a.colorsNeedUpdate=!1;a.uvsNeedUpdate=!1;a.groupsNeedUpdate=!1;a=c}!0===a.verticesNeedUpdate&&(c=this.attributes.position,void 0!==c&&(c.copyVector3sArray(a.vertices),c.needsUpdate=!0),a.verticesNeedUpdate=!1);!0===a.normalsNeedUpdate&&(c=this.attributes.normal,void 0!==c&&(c.copyVector3sArray(a.normals),
c.needsUpdate=!0),a.normalsNeedUpdate=!1);!0===a.colorsNeedUpdate&&(c=this.attributes.color,void 0!==c&&(c.copyColorsArray(a.colors),c.needsUpdate=!0),a.colorsNeedUpdate=!1);a.uvsNeedUpdate&&(c=this.attributes.uv,void 0!==c&&(c.copyVector2sArray(a.uvs),c.needsUpdate=!0),a.uvsNeedUpdate=!1);a.lineDistancesNeedUpdate&&(c=this.attributes.lineDistance,void 0!==c&&(c.copyArray(a.lineDistances),c.needsUpdate=!0),a.lineDistancesNeedUpdate=!1);a.groupsNeedUpdate&&(a.computeGroups(b.geometry),this.groups=
a.groups,a.groupsNeedUpdate=!1);return this},fromGeometry:function(b){b.__directGeometry=(new wc).fromGeometry(b);return this.fromDirectGeometry(b.__directGeometry)},fromDirectGeometry:function(b){var a=new Float32Array(3*b.vertices.length);this.addAttribute("position",(new P(a,3)).copyVector3sArray(b.vertices));0<b.normals.length&&(a=new Float32Array(3*b.normals.length),this.addAttribute("normal",(new P(a,3)).copyVector3sArray(b.normals)));0<b.colors.length&&(a=new Float32Array(3*b.colors.length),
this.addAttribute("color",(new P(a,3)).copyColorsArray(b.colors)));0<b.uvs.length&&(a=new Float32Array(2*b.uvs.length),this.addAttribute("uv",(new P(a,2)).copyVector2sArray(b.uvs)));0<b.uvs2.length&&(a=new Float32Array(2*b.uvs2.length),this.addAttribute("uv2",(new P(a,2)).copyVector2sArray(b.uvs2)));0<b.indices.length&&(a=new (65535<b.vertices.length?Uint32Array:Uint16Array)(3*b.indices.length),this.setIndex((new P(a,1)).copyIndicesArray(b.indices)));this.groups=b.groups;for(var c in b.morphTargets){for(var a=
[],d=b.morphTargets[c],e=0,f=d.length;e<f;e++){var g=d[e],k=new Ja(3*g.length,3);a.push(k.copyVector3sArray(g))}this.morphAttributes[c]=a}0<b.skinIndices.length&&(c=new Ja(4*b.skinIndices.length,4),this.addAttribute("skinIndex",c.copyVector4sArray(b.skinIndices)));0<b.skinWeights.length&&(c=new Ja(4*b.skinWeights.length,4),this.addAttribute("skinWeight",c.copyVector4sArray(b.skinWeights)));null!==b.boundingSphere&&(this.boundingSphere=b.boundingSphere.clone());null!==b.boundingBox&&(this.boundingBox=
b.boundingBox.clone());return this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new ra);var b=this.attributes.position.array;void 0!==b?this.boundingBox.setFromArray(b):this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var b=
new ra,a=new g;return function(){null===this.boundingSphere&&(this.boundingSphere=new Oa);var c=this.attributes.position;if(c){var c=c.array,d=this.boundingSphere.center;b.setFromArray(c);b.getCenter(d);for(var h=0,e=0,f=c.length;e<f;e+=3)a.fromArray(c,e),h=Math.max(h,d.distanceToSquared(a));this.boundingSphere.radius=Math.sqrt(h);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',
this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var b=this.index,a=this.attributes,c=this.groups;if(a.position){var d=a.position.array;if(void 0===a.normal)this.addAttribute("normal",new P(new Float32Array(d.length),3));else for(var e=a.normal.array,f=0,k=e.length;f<k;f++)e[f]=0;var e=a.normal.array,l,m,n,p=new g,q=new g,t=new g,u=new g,z=new g;if(b){b=b.array;0===c.length&&this.addGroup(0,b.length);for(var w=0,y=c.length;w<y;++w)for(f=c[w],k=f.start,l=f.count,f=k,k+=l;f<
k;f+=3)l=3*b[f+0],m=3*b[f+1],n=3*b[f+2],p.fromArray(d,l),q.fromArray(d,m),t.fromArray(d,n),u.subVectors(t,q),z.subVectors(p,q),u.cross(z),e[l]+=u.x,e[l+1]+=u.y,e[l+2]+=u.z,e[m]+=u.x,e[m+1]+=u.y,e[m+2]+=u.z,e[n]+=u.x,e[n+1]+=u.y,e[n+2]+=u.z}else for(f=0,k=d.length;f<k;f+=9)p.fromArray(d,f),q.fromArray(d,f+3),t.fromArray(d,f+6),u.subVectors(t,q),z.subVectors(p,q),u.cross(z),e[f]=u.x,e[f+1]=u.y,e[f+2]=u.z,e[f+3]=u.x,e[f+4]=u.y,e[f+5]=u.z,e[f+6]=u.x,e[f+7]=u.y,e[f+8]=u.z;this.normalizeNormals();a.normal.needsUpdate=
!0}},merge:function(b,a){if(!1===(b&&b.isBufferGeometry))console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",b);else{void 0===a&&(a=0);var c=this.attributes,d;for(d in c)if(void 0!==b.attributes[d])for(var h=c[d].array,e=b.attributes[d],f=e.array,g=0,e=e.itemSize*a;g<f.length;g++,e++)h[e]=f[g];return this}},normalizeNormals:function(){for(var b=this.attributes.normal.array,a,c,d,e=0,f=b.length;e<f;e+=3)a=b[e],c=b[e+1],d=b[e+2],a=1/Math.sqrt(a*a+c*c+d*d),
b[e]*=a,b[e+1]*=a,b[e+2]*=a},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var b=new ia,a=this.index.array,c=this.attributes,d;for(d in c){for(var e=c[d],f=e.array,e=e.itemSize,g=new f.constructor(a.length*e),k,l=0,m=0,n=a.length;m<n;m++){k=a[m]*e;for(var p=0;p<e;p++)g[l++]=f[k++]}b.addAttribute(d,new P(g,e))}return b},toJSON:function(){var b={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};
b.uuid=this.uuid;b.type=this.type;""!==this.name&&(b.name=this.name);if(void 0!==this.parameters){var a=this.parameters,c;for(c in a)void 0!==a[c]&&(b[c]=a[c]);return b}b.data={attributes:{}};var d=this.index;null!==d&&(a=Array.prototype.slice.call(d.array),b.data.index={type:d.array.constructor.name,array:a});d=this.attributes;for(c in d){var e=d[c],a=Array.prototype.slice.call(e.array);b.data.attributes[c]={itemSize:e.itemSize,type:e.array.constructor.name,array:a,normalized:e.normalized}}c=this.groups;
0<c.length&&(b.data.groups=JSON.parse(JSON.stringify(c)));c=this.boundingSphere;null!==c&&(b.data.boundingSphere={center:c.center.toArray(),radius:c.radius});return b},clone:function(){return(new ia).copy(this)},copy:function(b){var a=b.index;null!==a&&this.setIndex(a.clone());var a=b.attributes,c;for(c in a)this.addAttribute(c,a[c].clone());b=b.groups;c=0;for(a=b.length;c<a;c++){var d=b[c];this.addGroup(d.start,d.count,d.materialIndex)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});
ia.MaxIndex=65535;Da.prototype=Object.assign(Object.create(X.prototype),{constructor:Da,isMesh:!0,setDrawMode:function(b){this.drawMode=b},copy:function(b){X.prototype.copy.call(this,b);this.drawMode=b.drawMode;return this},updateMorphTargets:function(){var b=this.geometry.morphTargets;if(void 0!==b&&0<b.length){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0,c=b.length;a<c;a++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[b[a].name]=a}},raycast:function(){function b(b,
a,c,d,h,e,f){Qa.barycoordFromPoint(b,a,c,d,x);h.multiplyScalar(x.x);e.multiplyScalar(x.y);f.multiplyScalar(x.z);h.add(e).add(f);return h.clone()}function a(b,a,c,d,h,e,f){var g=b.material;if(null===(1===g.side?c.intersectTriangle(e,h,d,!0,f):c.intersectTriangle(d,h,e,2!==g.side,f)))return null;J.copy(f);J.applyMatrix4(b.matrixWorld);c=a.ray.origin.distanceTo(J);return c<a.near||c>a.far?null:{distance:c,point:J.clone(),object:b}}function c(c,d,h,e,f,g,r,k){l.fromArray(e,3*g);m.fromArray(e,3*r);p.fromArray(e,
3*k);if(c=a(c,d,h,l,m,p,D))f&&(z.fromArray(f,2*g),w.fromArray(f,2*r),y.fromArray(f,2*k),c.uv=b(D,l,m,p,z,w,y)),c.face=new sa(g,r,k,Qa.normal(l,m,p)),c.faceIndex=g;return c}var d=new n,f=new fb,k=new Oa,l=new g,m=new g,p=new g,q=new g,t=new g,u=new g,z=new e,w=new e,y=new e,x=new g,D=new g,J=new g;return function(h,e){var g=this.geometry,r=this.material,v=this.matrixWorld;if(void 0!==r&&(null===g.boundingSphere&&g.computeBoundingSphere(),k.copy(g.boundingSphere),k.applyMatrix4(v),!1!==h.ray.intersectsSphere(k)&&
(d.getInverse(v),f.copy(h.ray).applyMatrix4(d),null===g.boundingBox||!1!==f.intersectsBox(g.boundingBox)))){var n,A;if(g&&g.isBufferGeometry){var F,M,r=g.index,v=g.attributes,g=v.position.array;void 0!==v.uv&&(n=v.uv.array);if(null!==r)for(var v=r.array,Q=0,da=v.length;Q<da;Q+=3){if(r=v[Q],F=v[Q+1],M=v[Q+2],A=c(this,h,f,g,n,r,F,M))A.faceIndex=Math.floor(Q/3),e.push(A)}else for(Q=0,da=g.length;Q<da;Q+=9)if(r=Q/3,F=r+1,M=r+2,A=c(this,h,f,g,n,r,F,M))A.index=r,e.push(A)}else if(g&&g.isGeometry){var x,
U,v=r&&r.isMultiMaterial,Q=!0===v?r.materials:null,da=g.vertices;F=g.faces;M=g.faceVertexUvs[0];0<M.length&&(n=M);for(var Y=0,Ea=F.length;Y<Ea;Y++){var ta=F[Y];A=!0===v?Q[ta.materialIndex]:r;if(void 0!==A){M=da[ta.a];x=da[ta.b];U=da[ta.c];if(!0===A.morphTargets){A=g.morphTargets;var J=this.morphTargetInfluences;l.set(0,0,0);m.set(0,0,0);p.set(0,0,0);for(var na=0,C=A.length;na<C;na++){var B=J[na];if(0!==B){var bb=A[na].vertices;l.addScaledVector(q.subVectors(bb[ta.a],M),B);m.addScaledVector(t.subVectors(bb[ta.b],
x),B);p.addScaledVector(u.subVectors(bb[ta.c],U),B)}}l.add(M);m.add(x);p.add(U);M=l;x=m;U=p}if(A=a(this,h,f,M,x,U,D))n&&(J=n[Y],z.copy(J[0]),w.copy(J[1]),y.copy(J[2]),A.uv=b(D,M,x,U,z,w,y)),A.face=ta,A.faceIndex=Y,e.push(A)}}}}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});hb.prototype=Object.create(ia.prototype);hb.prototype.constructor=hb;ab.prototype=Object.create(ia.prototype);ab.prototype.constructor=ab;za.prototype=Object.create(X.prototype);za.prototype.constructor=
za;za.prototype.isCamera=!0;za.prototype.getWorldDirection=function(){var b=new m;return function(a){a=a||new g;this.getWorldQuaternion(b);return a.set(0,0,-1).applyQuaternion(b)}}();za.prototype.lookAt=function(){var b=new n;return function(a){b.lookAt(this.position,a,this.up);this.quaternion.setFromRotationMatrix(b)}}();za.prototype.clone=function(){return(new this.constructor).copy(this)};za.prototype.copy=function(b){X.prototype.copy.call(this,b);this.matrixWorldInverse.copy(b.matrixWorldInverse);
this.projectionMatrix.copy(b.projectionMatrix);return this};Sa.prototype=Object.assign(Object.create(za.prototype),{constructor:Sa,isPerspectiveCamera:!0,copy:function(b){za.prototype.copy.call(this,b);this.fov=b.fov;this.zoom=b.zoom;this.near=b.near;this.far=b.far;this.focus=b.focus;this.aspect=b.aspect;this.view=null===b.view?null:Object.assign({},b.view);this.filmGauge=b.filmGauge;this.filmOffset=b.filmOffset;return this},setFocalLength:function(b){b=.5*this.getFilmHeight()/b;this.fov=2*k.Math.RAD2DEG*
Math.atan(b);this.updateProjectionMatrix()},getFocalLength:function(){var b=Math.tan(.5*k.Math.DEG2RAD*this.fov);return.5*this.getFilmHeight()/b},getEffectiveFOV:function(){return 2*k.Math.RAD2DEG*Math.atan(Math.tan(.5*k.Math.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(b,a,c,d,e,f){this.aspect=b/a;this.view={fullWidth:b,fullHeight:a,offsetX:c,offsetY:d,
width:e,height:f};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var b=this.near,a=b*Math.tan(.5*k.Math.DEG2RAD*this.fov)/this.zoom,c=2*a,d=this.aspect*c,e=-.5*d,f=this.view;if(null!==f)var g=f.fullWidth,l=f.fullHeight,e=e+f.offsetX*d/g,a=a-f.offsetY*c/l,d=f.width/g*d,c=f.height/l*c;f=this.filmOffset;0!==f&&(e+=b*f/this.getFilmWidth());this.projectionMatrix.makeFrustum(e,e+d,a-c,a,b,this.far)},toJSON:function(b){b=
X.prototype.toJSON.call(this,b);b.object.fov=this.fov;b.object.zoom=this.zoom;b.object.near=this.near;b.object.far=this.far;b.object.focus=this.focus;b.object.aspect=this.aspect;null!==this.view&&(b.object.view=Object.assign({},this.view));b.object.filmGauge=this.filmGauge;b.object.filmOffset=this.filmOffset;return b}});eb.prototype=Object.assign(Object.create(za.prototype),{constructor:eb,isOrthographicCamera:!0,copy:function(b){za.prototype.copy.call(this,b);this.left=b.left;this.right=b.right;
this.top=b.top;this.bottom=b.bottom;this.near=b.near;this.far=b.far;this.zoom=b.zoom;this.view=null===b.view?null:Object.assign({},b.view);return this},setViewOffset:function(b,a,c,d,e,f){this.view={fullWidth:b,fullHeight:a,offsetX:c,offsetY:d,width:e,height:f};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var b=(this.right-this.left)/(2*this.zoom),a=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/
2,d=(this.top+this.bottom)/2,e=c-b,c=c+b,b=d+a,a=d-a;if(null!==this.view)var c=this.zoom/(this.view.width/this.view.fullWidth),a=this.zoom/(this.view.height/this.view.fullHeight),f=(this.right-this.left)/this.view.width,d=(this.top-this.bottom)/this.view.height,e=e+this.view.offsetX/c*f,c=e+this.view.width/c*f,b=b-this.view.offsetY/a*d,a=b-this.view.height/a*d;this.projectionMatrix.makeOrthographic(e,c,b,a,this.near,this.far)},toJSON:function(b){b=X.prototype.toJSON.call(this,b);b.object.zoom=this.zoom;
b.object.left=this.left;b.object.right=this.right;b.object.top=this.top;b.object.bottom=this.bottom;b.object.near=this.near;b.object.far=this.far;null!==this.view&&(b.object.view=Object.assign({},this.view));return b}});var Oe=0;Ub.prototype.isFogExp2=!0;Ub.prototype.clone=function(){return new Ub(this.color.getHex(),this.density)};Ub.prototype.toJSON=function(b){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};Vb.prototype.isFog=!0;Vb.prototype.clone=function(){return new Vb(this.color.getHex(),
this.near,this.far)};Vb.prototype.toJSON=function(b){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}};zb.prototype=Object.create(X.prototype);zb.prototype.constructor=zb;zb.prototype.copy=function(b,a){X.prototype.copy.call(this,b,a);null!==b.background&&(this.background=b.background.clone());null!==b.fog&&(this.fog=b.fog.clone());null!==b.overrideMaterial&&(this.overrideMaterial=b.overrideMaterial.clone());this.autoUpdate=b.autoUpdate;this.matrixAutoUpdate=b.matrixAutoUpdate;
return this};zb.prototype.toJSON=function(b){var a=X.prototype.toJSON.call(this,b);null!==this.background&&(a.object.background=this.background.toJSON(b));null!==this.fog&&(a.object.fog=this.fog.toJSON());return a};Fd.prototype=Object.assign(Object.create(X.prototype),{constructor:Fd,isLensFlare:!0,copy:function(b){X.prototype.copy.call(this,b);this.positionScreen.copy(b.positionScreen);this.customUpdateCallback=b.customUpdateCallback;for(var a=0,c=b.lensFlares.length;a<c;a++)this.lensFlares.push(b.lensFlares[a]);
return this},add:function(b,a,c,d,e,f){void 0===a&&(a=-1);void 0===c&&(c=0);void 0===f&&(f=1);void 0===e&&(e=new O(16777215));void 0===d&&(d=1);c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:b,size:a,distance:c,x:0,y:0,z:0,scale:1,rotation:0,opacity:f,color:e,blending:d})},updateLensFlares:function(){var b,a=this.lensFlares.length,c,d=2*-this.positionScreen.x,e=2*-this.positionScreen.y;for(b=0;b<a;b++)c=this.lensFlares[b],c.x=this.positionScreen.x+d*c.distance,c.y=this.positionScreen.y+
e*c.distance,c.wantedRotation=c.x*Math.PI*.25,c.rotation+=.25*(c.wantedRotation-c.rotation)}});Ab.prototype=Object.create(aa.prototype);Ab.prototype.constructor=Ab;Ab.prototype.copy=function(b){aa.prototype.copy.call(this,b);this.color.copy(b.color);this.map=b.map;this.rotation=b.rotation;return this};vc.prototype=Object.assign(Object.create(X.prototype),{constructor:vc,isSprite:!0,raycast:function(){var b=new g;return function(a,c){b.setFromMatrixPosition(this.matrixWorld);var d=a.ray.distanceSqToPoint(b);
d>this.scale.x*this.scale.y/4||c.push({distance:Math.sqrt(d),point:this.position,face:null,object:this})}}(),clone:function(){return(new this.constructor(this.material)).copy(this)}});xc.prototype=Object.assign(Object.create(X.prototype),{constructor:xc,copy:function(b){X.prototype.copy.call(this,b,!1);b=b.levels;for(var a=0,c=b.length;a<c;a++){var d=b[a];this.addLevel(d.object.clone(),d.distance)}return this},addLevel:function(b,a){void 0===a&&(a=0);a=Math.abs(a);for(var c=this.levels,d=0;d<c.length&&
!(a<c[d].distance);d++);c.splice(d,0,{distance:a,object:b});this.add(b)},getObjectForDistance:function(b){for(var a=this.levels,c=1,d=a.length;c<d&&!(b<a[c].distance);c++);return a[c-1].object},raycast:function(){var b=new g;return function(a,c){b.setFromMatrixPosition(this.matrixWorld);var d=a.ray.origin.distanceTo(b);this.getObjectForDistance(d).raycast(a,c)}}(),update:function(){var b=new g,a=new g;return function(c){var d=this.levels;if(1<d.length){b.setFromMatrixPosition(c.matrixWorld);a.setFromMatrixPosition(this.matrixWorld);
c=b.distanceTo(a);d[0].object.visible=!0;for(var h=1,e=d.length;h<e;h++)if(c>=d[h].distance)d[h-1].object.visible=!1,d[h].object.visible=!0;else break;for(;h<e;h++)d[h].object.visible=!1}}}(),toJSON:function(b){b=X.prototype.toJSON.call(this,b);b.object.levels=[];for(var a=this.levels,c=0,d=a.length;c<d;c++){var e=a[c];b.object.levels.push({object:e.object.uuid,distance:e.distance})}return b}});Bb.prototype=Object.create(l.prototype);Bb.prototype.constructor=Bb;Bb.prototype.isDataTexture=!0;Object.assign(ed.prototype,
{calculateInverses:function(){this.boneInverses=[];for(var b=0,a=this.bones.length;b<a;b++){var c=new n;this.bones[b]&&c.getInverse(this.bones[b].matrixWorld);this.boneInverses.push(c)}},pose:function(){for(var b,a=0,c=this.bones.length;a<c;a++)(b=this.bones[a])&&b.matrixWorld.getInverse(this.boneInverses[a]);a=0;for(c=this.bones.length;a<c;a++)if(b=this.bones[a])b.parent&&b.parent.isBone?(b.matrix.getInverse(b.parent.matrixWorld),b.matrix.multiply(b.matrixWorld)):b.matrix.copy(b.matrixWorld),b.matrix.decompose(b.position,
b.quaternion,b.scale)},update:function(){var b=new n;return function(){for(var a=0,c=this.bones.length;a<c;a++)b.multiplyMatrices(this.bones[a]?this.bones[a].matrixWorld:this.identityMatrix,this.boneInverses[a]),b.toArray(this.boneMatrices,16*a);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),clone:function(){return new ed(this.bones,this.boneInverses,this.useVertexTexture)}});fd.prototype=Object.assign(Object.create(X.prototype),{constructor:fd,isBone:!0,copy:function(b){X.prototype.copy.call(this,
b);this.skin=b.skin;return this}});gd.prototype=Object.assign(Object.create(Da.prototype),{constructor:gd,isSkinnedMesh:!0,bind:function(b,a){this.skeleton=b;void 0===a&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),a=this.matrixWorld);this.bindMatrix.copy(a);this.bindMatrixInverse.getInverse(a)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry&&this.geometry.isGeometry)for(var b=0;b<this.geometry.skinWeights.length;b++){var c=this.geometry.skinWeights[b],
d=1/c.lengthManhattan();Infinity!==d?c.multiplyScalar(d):c.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry)for(var c=new a,e=this.geometry.attributes.skinWeight,b=0;b<e.count;b++)c.x=e.getX(b),c.y=e.getY(b),c.z=e.getZ(b),c.w=e.getW(b),d=1/c.lengthManhattan(),Infinity!==d?c.multiplyScalar(d):c.set(1,0,0,0),e.setXYZW(b,c.x,c.y,c.z,c.w)},updateMatrixWorld:function(b){Da.prototype.updateMatrixWorld.call(this,!0);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):
"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},clone:function(){return(new this.constructor(this.geometry,this.material,this.skeleton.useVertexTexture)).copy(this)}});Ha.prototype=Object.create(aa.prototype);Ha.prototype.constructor=Ha;Ha.prototype.isLineBasicMaterial=!0;Ha.prototype.copy=function(b){aa.prototype.copy.call(this,b);this.color.copy(b.color);this.linewidth=b.linewidth;this.linecap=
b.linecap;this.linejoin=b.linejoin;return this};qb.prototype=Object.assign(Object.create(X.prototype),{constructor:qb,isLine:!0,raycast:function(){var b=new n,a=new fb,c=new Oa;return function(d,h){var e=d.linePrecision,e=e*e,f=this.geometry,r=this.matrixWorld;null===f.boundingSphere&&f.computeBoundingSphere();c.copy(f.boundingSphere);c.applyMatrix4(r);if(!1!==d.ray.intersectsSphere(c)){b.getInverse(r);a.copy(d.ray).applyMatrix4(b);var k=new g,l=new g,r=new g,v=new g,m=this&&this.isLineSegments?2:
1;if(f&&f.isBufferGeometry){var n=f.index,p=f.attributes.position.array;if(null!==n)for(var n=n.array,f=0,A=n.length-1;f<A;f+=m){var q=n[f+1];k.fromArray(p,3*n[f]);l.fromArray(p,3*q);q=a.distanceSqToSegment(k,l,v,r);q>e||(v.applyMatrix4(this.matrixWorld),q=d.ray.origin.distanceTo(v),q<d.near||q>d.far||h.push({distance:q,point:r.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}else for(f=0,A=p.length/3-1;f<A;f+=m)k.fromArray(p,3*f),l.fromArray(p,3*f+3),q=a.distanceSqToSegment(k,
l,v,r),q>e||(v.applyMatrix4(this.matrixWorld),q=d.ray.origin.distanceTo(v),q<d.near||q>d.far||h.push({distance:q,point:r.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}else if(f&&f.isGeometry)for(k=f.vertices,l=k.length,f=0;f<l-1;f+=m)q=a.distanceSqToSegment(k[f],k[f+1],v,r),q>e||(v.applyMatrix4(this.matrixWorld),q=d.ray.origin.distanceTo(v),q<d.near||q>d.far||h.push({distance:q,point:r.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,
object:this}))}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});Ia.prototype=Object.assign(Object.create(qb.prototype),{constructor:Ia,isLineSegments:!0});Va.prototype=Object.create(aa.prototype);Va.prototype.constructor=Va;Va.prototype.isPointsMaterial=!0;Va.prototype.copy=function(b){aa.prototype.copy.call(this,b);this.color.copy(b.color);this.map=b.map;this.size=b.size;this.sizeAttenuation=b.sizeAttenuation;return this};Yb.prototype=Object.assign(Object.create(X.prototype),
{constructor:Yb,isPoints:!0,raycast:function(){var b=new n,a=new fb,c=new Oa;return function(d,h){function e(b,c){var e=a.distanceSqToPoint(b);if(e<v){var g=a.closestPointToPoint(b);g.applyMatrix4(k);var r=d.ray.origin.distanceTo(g);r<d.near||r>d.far||h.push({distance:r,distanceToRay:Math.sqrt(e),point:g.clone(),index:c,face:null,object:f})}}var f=this,r=this.geometry,k=this.matrixWorld,l=d.params.Points.threshold;null===r.boundingSphere&&r.computeBoundingSphere();c.copy(r.boundingSphere);c.applyMatrix4(k);
if(!1!==d.ray.intersectsSphere(c)){b.getInverse(k);a.copy(d.ray).applyMatrix4(b);var l=l/((this.scale.x+this.scale.y+this.scale.z)/3),v=l*l,l=new g;if(r&&r.isBufferGeometry){var m=r.index,r=r.attributes.position.array;if(null!==m)for(var n=m.array,m=0,p=n.length;m<p;m++){var A=n[m];l.fromArray(r,3*A);e(l,A)}else for(m=0,n=r.length/3;m<n;m++)l.fromArray(r,3*m),e(l,m)}else for(l=r.vertices,m=0,n=l.length;m<n;m++)e(l[m],m)}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});
yc.prototype=Object.assign(Object.create(X.prototype),{constructor:yc});hd.prototype=Object.create(l.prototype);hd.prototype.constructor=hd;Zb.prototype=Object.create(l.prototype);Zb.prototype.constructor=Zb;Zb.prototype.isCompressedTexture=!0;id.prototype=Object.create(l.prototype);id.prototype.constructor=id;zc.prototype=Object.create(l.prototype);zc.prototype.constructor=zc;zc.prototype.isDepthTexture=!0;$b.prototype=Object.create(ia.prototype);$b.prototype.constructor=$b;Ac.prototype=Object.create(ha.prototype);
Ac.prototype.constructor=Ac;Ya.prototype=Object.create(ha.prototype);Ya.prototype.constructor=Ya;Bc.prototype=Object.create(Ya.prototype);Bc.prototype.constructor=Bc;Cc.prototype=Object.create(Ya.prototype);Cc.prototype.constructor=Cc;Dc.prototype=Object.create(Ya.prototype);Dc.prototype.constructor=Dc;Ec.prototype=Object.create(Ya.prototype);Ec.prototype.constructor=Ec;Xa.prototype=Object.create(ha.prototype);Xa.prototype.constructor=Xa;Xa.NoTaper=function(b){return 1};Xa.SinusoidalTaper=function(b){return Math.sin(Math.PI*
b)};Xa.FrenetFrames=function(b,a,c){var d=new g,h=[],e=[],f=[],r=new g,l=new n;a+=1;var m,p,q;this.tangents=h;this.normals=e;this.binormals=f;for(m=0;m<a;m++)p=m/(a-1),h[m]=b.getTangentAt(p),h[m].normalize();e[0]=new g;f[0]=new g;b=Number.MAX_VALUE;m=Math.abs(h[0].x);p=Math.abs(h[0].y);q=Math.abs(h[0].z);m<=b&&(b=m,d.set(1,0,0));p<=b&&(b=p,d.set(0,1,0));q<=b&&d.set(0,0,1);r.crossVectors(h[0],d).normalize();e[0].crossVectors(h[0],r);f[0].crossVectors(h[0],e[0]);for(m=1;m<a;m++)e[m]=e[m-1].clone(),
f[m]=f[m-1].clone(),r.crossVectors(h[m-1],h[m]),r.length()>Number.EPSILON&&(r.normalize(),d=Math.acos(k.Math.clamp(h[m-1].dot(h[m]),-1,1)),e[m].applyMatrix4(l.makeRotationAxis(r,d))),f[m].crossVectors(h[m],e[m]);if(c)for(d=Math.acos(k.Math.clamp(e[0].dot(e[a-1]),-1,1)),d/=a-1,0<h[0].dot(r.crossVectors(e[0],e[a-1]))&&(d=-d),m=1;m<a;m++)e[m].applyMatrix4(l.makeRotationAxis(h[m],d*m)),f[m].crossVectors(h[m],e[m])};ac.prototype=Object.create(ia.prototype);ac.prototype.constructor=ac;Fc.prototype=Object.create(ha.prototype);
Fc.prototype.constructor=Fc;bc.prototype=Object.create(ia.prototype);bc.prototype.constructor=bc;Gc.prototype=Object.create(ha.prototype);Gc.prototype.constructor=Gc;k.ShapeUtils={area:function(b){for(var a=b.length,c=0,d=a-1,e=0;e<a;d=e++)c+=b[d].x*b[e].y-b[e].x*b[d].y;return.5*c},triangulate:function(){return function(b,a){var c=b.length;if(3>c)return null;var d=[],h=[],e=[],f,g,l;if(0<k.ShapeUtils.area(b))for(g=0;g<c;g++)h[g]=g;else for(g=0;g<c;g++)h[g]=c-1-g;var m=2*c;for(g=c-1;2<c;){if(0>=m--){console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()");
break}f=g;c<=f&&(f=0);g=f+1;c<=g&&(g=0);l=g+1;c<=l&&(l=0);var n;a:{var p,q,t,u,z,w,y,x;p=b[h[f]].x;q=b[h[f]].y;t=b[h[g]].x;u=b[h[g]].y;z=b[h[l]].x;w=b[h[l]].y;if(Number.EPSILON>(t-p)*(w-q)-(u-q)*(z-p))n=!1;else{var D,J,C,B,G,V,E,I,ea,S;D=z-t;J=w-u;C=p-z;B=q-w;G=t-p;V=u-q;for(n=0;n<c;n++)if(y=b[h[n]].x,x=b[h[n]].y,!(y===p&&x===q||y===t&&x===u||y===z&&x===w)&&(E=y-p,I=x-q,ea=y-t,S=x-u,y-=z,x-=w,ea=D*S-J*ea,E=G*I-V*E,I=C*x-B*y,ea>=-Number.EPSILON&&I>=-Number.EPSILON&&E>=-Number.EPSILON)){n=!1;break a}n=
!0}}if(n){d.push([b[h[f]],b[h[g]],b[h[l]]]);e.push([h[f],h[g],h[l]]);f=g;for(l=g+1;l<c;f++,l++)h[f]=h[l];c--;m=2*c}}return a?e:d}}(),triangulateShape:function(b,a){function c(b){var a=b.length;2<a&&b[a-1].equals(b[0])&&b.pop()}function d(b,a,c){return b.x!==a.x?b.x<a.x?b.x<=c.x&&c.x<=a.x:a.x<=c.x&&c.x<=b.x:b.y<a.y?b.y<=c.y&&c.y<=a.y:a.y<=c.y&&c.y<=b.y}function h(b,a,c,h,e){var f=a.x-b.x,g=a.y-b.y,r=h.x-c.x,k=h.y-c.y,l=b.x-c.x,m=b.y-c.y,v=g*r-f*k,n=g*l-f*m;if(Math.abs(v)>Number.EPSILON){if(0<v){if(0>
n||n>v)return[];r=k*l-r*m;if(0>r||r>v)return[]}else{if(0<n||n<v)return[];r=k*l-r*m;if(0<r||r<v)return[]}if(0===r)return!e||0!==n&&n!==v?[b]:[];if(r===v)return!e||0!==n&&n!==v?[a]:[];if(0===n)return[c];if(n===v)return[h];e=r/v;return[{x:b.x+e*f,y:b.y+e*g}]}if(0!==n||k*l!==r*m)return[];g=0===f&&0===g;r=0===r&&0===k;if(g&&r)return b.x!==c.x||b.y!==c.y?[]:[b];if(g)return d(c,h,b)?[b]:[];if(r)return d(b,a,c)?[c]:[];0!==f?(b.x<a.x?(f=b,r=b.x,g=a,b=a.x):(f=a,r=a.x,g=b,b=b.x),c.x<h.x?(a=c,v=c.x,k=h,c=h.x):
(a=h,v=h.x,k=c,c=c.x)):(b.y<a.y?(f=b,r=b.y,g=a,b=a.y):(f=a,r=a.y,g=b,b=b.y),c.y<h.y?(a=c,v=c.y,k=h,c=h.y):(a=h,v=h.y,k=c,c=c.y));return r<=v?b<v?[]:b===v?e?[]:[a]:b<=c?[a,g]:[a,k]:r>c?[]:r===c?e?[]:[f]:b<=c?[f,g]:[f,k]}function e(b,a,c,d){var h=a.x-b.x,e=a.y-b.y;a=c.x-b.x;c=c.y-b.y;var f=d.x-b.x;d=d.y-b.y;b=h*c-e*a;h=h*d-e*f;return Math.abs(b)>Number.EPSILON?(a=f*c-d*a,0<b?0<=h&&0<=a:0<=h||0<=a):0<h}c(b);a.forEach(c);var f,g,l,m,n,p={};l=b.concat();f=0;for(g=a.length;f<g;f++)Array.prototype.push.apply(l,
a[f]);f=0;for(g=l.length;f<g;f++)n=l[f].x+":"+l[f].y,void 0!==p[n]&&console.warn("THREE.ShapeUtils: Duplicate point",n,f),p[n]=f;f=function(b,a){function c(b,a){var c=g.length-1,d=b-1;0>d&&(d=c);var h=b+1;h>c&&(h=0);c=e(g[b],g[d],g[h],r[a]);if(!c)return!1;c=r.length-1;d=a-1;0>d&&(d=c);h=a+1;h>c&&(h=0);return e(r[a],r[d],r[h],g[b])?!0:!1}function d(b,a){var c,d;for(c=0;c<g.length;c++)if(d=c+1,d%=g.length,d=h(b,a,g[c],g[d],!0),0<d.length)return!0;return!1}function f(b,c){var d,e,f,g;for(d=0;d<k.length;d++)for(e=
a[k[d]],f=0;f<e.length;f++)if(g=f+1,g%=e.length,g=h(b,c,e[f],e[g],!0),0<g.length)return!0;return!1}var g=b.concat(),r,k=[],l,m,v,n,p,q=[],A,t,F,u=0;for(l=a.length;u<l;u++)k.push(u);A=0;for(var M=2*k.length;0<k.length;){M--;if(0>M){console.log("Infinite Loop! Holes left:"+k.length+", Probably Hole outside Shape!");break}for(m=A;m<g.length;m++){v=g[m];l=-1;for(u=0;u<k.length;u++)if(n=k[u],p=v.x+":"+v.y+":"+n,void 0===q[p]){r=a[n];for(t=0;t<r.length;t++)if(n=r[t],c(m,t)&&!d(v,n)&&!f(v,n)){l=t;k.splice(u,
1);A=g.slice(0,m+1);n=g.slice(m);t=r.slice(l);F=r.slice(0,l+1);g=A.concat(t).concat(F).concat(n);A=m;break}if(0<=l)break;q[p]=!0}if(0<=l)break}}return g}(b,a);var q=k.ShapeUtils.triangulate(f,!1);f=0;for(g=q.length;f<g;f++)for(m=q[f],l=0;3>l;l++)n=m[l].x+":"+m[l].y,n=p[n],void 0!==n&&(m[l]=n);return q.concat()},isClockWise:function(b){return 0>k.ShapeUtils.area(b)},b2:function(){return function(b,a,c,d){var h=1-b;return h*h*a+2*(1-b)*b*c+b*b*d}}(),b3:function(){return function(b,a,c,d,e){var h=1-
b,f=1-b;return h*h*h*a+3*f*f*b*c+3*(1-b)*b*b*d+b*b*b*e}}()};Za.prototype=Object.create(ha.prototype);Za.prototype.constructor=Za;Za.prototype.addShapeList=function(b,a){for(var c=b.length,d=0;d<c;d++)this.addShape(b[d],a)};Za.prototype.addShape=function(b,a){function c(b,a,c){a||console.error("THREE.ExtrudeGeometry: vec does not exist");return a.clone().multiplyScalar(c).add(b)}function d(b,a,c){var d,h,f;h=b.x-a.x;f=b.y-a.y;d=c.x-b.x;var g=c.y-b.y,r=h*h+f*f;if(Math.abs(h*g-f*d)>Number.EPSILON){var k=
Math.sqrt(r),l=Math.sqrt(d*d+g*g),r=a.x-f/k;a=a.y+h/k;g=((c.x-g/l-r)*g-(c.y+d/l-a)*d)/(h*g-f*d);d=r+h*g-b.x;h=a+f*g-b.y;f=d*d+h*h;if(2>=f)return new e(d,h);f=Math.sqrt(f/2)}else b=!1,h>Number.EPSILON?d>Number.EPSILON&&(b=!0):h<-Number.EPSILON?d<-Number.EPSILON&&(b=!0):Math.sign(f)===Math.sign(g)&&(b=!0),b?(d=-f,f=Math.sqrt(r)):(d=h,h=f,f=Math.sqrt(r/2));return new e(d/f,h/f)}function h(b,a){var c,d;for(ba=b.length;0<=--ba;){c=ba;d=ba-1;0>d&&(d=b.length-1);var h,e=z+2*q;for(h=0;h<e;h++){var f=W*h,
g=W*(h+1),r=a+c+f,f=a+d+f,k=a+d+g,g=a+c+g,r=r+S,f=f+S,k=k+S,g=g+S;ea.faces.push(new sa(r,f,g,null,null,1));ea.faces.push(new sa(f,k,g,null,null,1));r=D.generateSideWallUV(ea,r,f,k,g);ea.faceVertexUvs[0].push([r[0],r[1],r[3]]);ea.faceVertexUvs[0].push([r[1],r[2],r[3]])}}}function f(b,a,c){ea.vertices.push(new g(b,a,c))}function l(b,a,c){b+=S;a+=S;c+=S;ea.faces.push(new sa(b,a,c,null,null,0));b=D.generateTopUV(ea,b,a,c);ea.faceVertexUvs[0].push(b)}var m=void 0!==a.amount?a.amount:100,n=void 0!==a.bevelThickness?
a.bevelThickness:6,p=void 0!==a.bevelSize?a.bevelSize:n-2,q=void 0!==a.bevelSegments?a.bevelSegments:3,t=void 0!==a.bevelEnabled?a.bevelEnabled:!0,u=void 0!==a.curveSegments?a.curveSegments:12,z=void 0!==a.steps?a.steps:1,w=a.extrudePath,y,x=!1,D=void 0!==a.UVGenerator?a.UVGenerator:Za.WorldUVGenerator,J,C,B,G;w&&(y=w.getSpacedPoints(z),x=!0,t=!1,J=void 0!==a.frames?a.frames:new Xa.FrenetFrames(w,z,!1),C=new g,B=new g,G=new g);t||(p=n=q=0);var V,E,I,ea=this,S=this.vertices.length,w=b.extractPoints(u),
u=w.shape,K=w.holes;if(w=!k.ShapeUtils.isClockWise(u)){u=u.reverse();E=0;for(I=K.length;E<I;E++)V=K[E],k.ShapeUtils.isClockWise(V)&&(K[E]=V.reverse());w=!1}var R=k.ShapeUtils.triangulateShape(u,K),P=u;E=0;for(I=K.length;E<I;E++)V=K[E],u=u.concat(V);var O,Z,N,X,T,W=u.length,fa,aa=R.length,w=[],ba=0;N=P.length;O=N-1;for(Z=ba+1;ba<N;ba++,O++,Z++)O===N&&(O=0),Z===N&&(Z=0),w[ba]=d(P[ba],P[O],P[Z]);var xa=[],ca,ga=w.concat();E=0;for(I=K.length;E<I;E++){V=K[E];ca=[];ba=0;N=V.length;O=N-1;for(Z=ba+1;ba<N;ba++,
O++,Z++)O===N&&(O=0),Z===N&&(Z=0),ca[ba]=d(V[ba],V[O],V[Z]);xa.push(ca);ga=ga.concat(ca)}for(O=0;O<q;O++){N=O/q;X=n*Math.cos(N*Math.PI/2);Z=p*Math.sin(N*Math.PI/2);ba=0;for(N=P.length;ba<N;ba++)T=c(P[ba],w[ba],Z),f(T.x,T.y,-X);E=0;for(I=K.length;E<I;E++)for(V=K[E],ca=xa[E],ba=0,N=V.length;ba<N;ba++)T=c(V[ba],ca[ba],Z),f(T.x,T.y,-X)}Z=p;for(ba=0;ba<W;ba++)T=t?c(u[ba],ga[ba],Z):u[ba],x?(B.copy(J.normals[0]).multiplyScalar(T.x),C.copy(J.binormals[0]).multiplyScalar(T.y),G.copy(y[0]).add(B).add(C),f(G.x,
G.y,G.z)):f(T.x,T.y,0);for(N=1;N<=z;N++)for(ba=0;ba<W;ba++)T=t?c(u[ba],ga[ba],Z):u[ba],x?(B.copy(J.normals[N]).multiplyScalar(T.x),C.copy(J.binormals[N]).multiplyScalar(T.y),G.copy(y[N]).add(B).add(C),f(G.x,G.y,G.z)):f(T.x,T.y,m/z*N);for(O=q-1;0<=O;O--){N=O/q;X=n*Math.cos(N*Math.PI/2);Z=p*Math.sin(N*Math.PI/2);ba=0;for(N=P.length;ba<N;ba++)T=c(P[ba],w[ba],Z),f(T.x,T.y,m+X);E=0;for(I=K.length;E<I;E++)for(V=K[E],ca=xa[E],ba=0,N=V.length;ba<N;ba++)T=c(V[ba],ca[ba],Z),x?f(T.x,T.y+y[z-1].y,y[z-1].x+X):
f(T.x,T.y,m+X)}(function(){if(t){var b=0*W;for(ba=0;ba<aa;ba++)fa=R[ba],l(fa[2]+b,fa[1]+b,fa[0]+b);b=W*(z+2*q);for(ba=0;ba<aa;ba++)fa=R[ba],l(fa[0]+b,fa[1]+b,fa[2]+b)}else{for(ba=0;ba<aa;ba++)fa=R[ba],l(fa[2],fa[1],fa[0]);for(ba=0;ba<aa;ba++)fa=R[ba],l(fa[0]+W*z,fa[1]+W*z,fa[2]+W*z)}})();(function(){var b=0;h(P,b);b+=P.length;E=0;for(I=K.length;E<I;E++)V=K[E],h(V,b),b+=V.length})()};Za.WorldUVGenerator={generateTopUV:function(b,a,c,d){b=b.vertices;a=b[a];c=b[c];d=b[d];return[new e(a.x,a.y),new e(c.x,
c.y),new e(d.x,d.y)]},generateSideWallUV:function(b,a,c,d,f){b=b.vertices;a=b[a];c=b[c];d=b[d];f=b[f];return.01>Math.abs(a.y-c.y)?[new e(a.x,1-a.z),new e(c.x,1-c.z),new e(d.x,1-d.z),new e(f.x,1-f.z)]:[new e(a.y,1-a.z),new e(c.y,1-c.z),new e(d.y,1-d.z),new e(f.y,1-f.z)]}};Hc.prototype=Object.create(Za.prototype);Hc.prototype.constructor=Hc;Cb.prototype=Object.create(ia.prototype);Cb.prototype.constructor=Cb;cc.prototype=Object.create(ha.prototype);cc.prototype.constructor=cc;dc.prototype=Object.create(ia.prototype);
dc.prototype.constructor=dc;Ic.prototype=Object.create(ha.prototype);Ic.prototype.constructor=Ic;Jc.prototype=Object.create(ha.prototype);Jc.prototype.constructor=Jc;ec.prototype=Object.create(ia.prototype);ec.prototype.constructor=ec;Kc.prototype=Object.create(ha.prototype);Kc.prototype.constructor=Kc;vb.prototype=Object.create(ha.prototype);vb.prototype.constructor=vb;vb.prototype.addShapeList=function(b,a){for(var c=0,d=b.length;c<d;c++)this.addShape(b[c],a);return this};vb.prototype.addShape=
function(b,a){void 0===a&&(a={});var c=a.material,d=void 0===a.UVGenerator?Za.WorldUVGenerator:a.UVGenerator,h,e,f,l=this.vertices.length;h=b.extractPoints(void 0!==a.curveSegments?a.curveSegments:12);var m=h.shape,n=h.holes;if(!k.ShapeUtils.isClockWise(m))for(m=m.reverse(),h=0,e=n.length;h<e;h++)f=n[h],k.ShapeUtils.isClockWise(f)&&(n[h]=f.reverse());var p=k.ShapeUtils.triangulateShape(m,n);h=0;for(e=n.length;h<e;h++)f=n[h],m=m.concat(f);n=m.length;e=p.length;for(h=0;h<n;h++)f=m[h],this.vertices.push(new g(f.x,
f.y,0));for(h=0;h<e;h++)n=p[h],m=n[0]+l,f=n[1]+l,n=n[2]+l,this.faces.push(new sa(m,f,n,null,null,c)),this.faceVertexUvs[0].push(d.generateTopUV(this,m,f,n))};fc.prototype=Object.create(ia.prototype);fc.prototype.constructor=fc;wb.prototype=Object.create(ia.prototype);wb.prototype.constructor=wb;Db.prototype=Object.create(ha.prototype);Db.prototype.constructor=Db;Lc.prototype=Object.create(Db.prototype);Lc.prototype.constructor=Lc;Mc.prototype=Object.create(ia.prototype);Mc.prototype.constructor=Mc;
gc.prototype=Object.create(ia.prototype);gc.prototype.constructor=gc;Nc.prototype=Object.create(ha.prototype);Nc.prototype.constructor=Nc;Eb.prototype=Object.create(ha.prototype);Eb.prototype.constructor=Eb;var cb=Object.freeze({WireframeGeometry:$b,ParametricGeometry:Ac,TetrahedronGeometry:Bc,OctahedronGeometry:Cc,IcosahedronGeometry:Dc,DodecahedronGeometry:Ec,PolyhedronGeometry:Ya,TubeGeometry:Xa,TorusKnotGeometry:Fc,TorusKnotBufferGeometry:ac,TorusGeometry:Gc,TorusBufferGeometry:bc,TextGeometry:Hc,
SphereBufferGeometry:Cb,SphereGeometry:cc,RingGeometry:Ic,RingBufferGeometry:dc,PlaneBufferGeometry:ab,PlaneGeometry:Jc,LatheGeometry:Kc,LatheBufferGeometry:ec,ShapeGeometry:vb,ExtrudeGeometry:Za,EdgesGeometry:fc,ConeGeometry:Lc,ConeBufferGeometry:Mc,CylinderGeometry:Db,CylinderBufferGeometry:wb,CircleBufferGeometry:gc,CircleGeometry:Nc,BoxBufferGeometry:hb,BoxGeometry:Eb});hc.prototype=Object.create(Ba.prototype);hc.prototype.constructor=hc;hc.prototype.isShadowMaterial=!0;ic.prototype=Object.create(Ba.prototype);
ic.prototype.constructor=ic;ic.prototype.isRawShaderMaterial=!0;Oc.prototype={constructor:Oc,isMultiMaterial:!0,toJSON:function(b){for(var a={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},c=this.materials,d=0,e=c.length;d<e;d++){var f=c[d].toJSON(b);delete f.metadata;a.materials.push(f)}a.visible=this.visible;return a},clone:function(){for(var b=new this.constructor,a=0;a<this.materials.length;a++)b.materials.push(this.materials[a].clone());
b.visible=this.visible;return b}};jb.prototype=Object.create(aa.prototype);jb.prototype.constructor=jb;jb.prototype.isMeshStandardMaterial=!0;jb.prototype.copy=function(b){aa.prototype.copy.call(this,b);this.defines={STANDARD:""};this.color.copy(b.color);this.roughness=b.roughness;this.metalness=b.metalness;this.map=b.map;this.lightMap=b.lightMap;this.lightMapIntensity=b.lightMapIntensity;this.aoMap=b.aoMap;this.aoMapIntensity=b.aoMapIntensity;this.emissive.copy(b.emissive);this.emissiveMap=b.emissiveMap;
this.emissiveIntensity=b.emissiveIntensity;this.bumpMap=b.bumpMap;this.bumpScale=b.bumpScale;this.normalMap=b.normalMap;this.normalScale.copy(b.normalScale);this.displacementMap=b.displacementMap;this.displacementScale=b.displacementScale;this.displacementBias=b.displacementBias;this.roughnessMap=b.roughnessMap;this.metalnessMap=b.metalnessMap;this.alphaMap=b.alphaMap;this.envMap=b.envMap;this.envMapIntensity=b.envMapIntensity;this.refractionRatio=b.refractionRatio;this.wireframe=b.wireframe;this.wireframeLinewidth=
b.wireframeLinewidth;this.wireframeLinecap=b.wireframeLinecap;this.wireframeLinejoin=b.wireframeLinejoin;this.skinning=b.skinning;this.morphTargets=b.morphTargets;this.morphNormals=b.morphNormals;return this};Fb.prototype=Object.create(jb.prototype);Fb.prototype.constructor=Fb;Fb.prototype.isMeshPhysicalMaterial=!0;Fb.prototype.copy=function(b){jb.prototype.copy.call(this,b);this.defines={PHYSICAL:""};this.reflectivity=b.reflectivity;this.clearCoat=b.clearCoat;this.clearCoatRoughness=b.clearCoatRoughness;
return this};xb.prototype=Object.create(aa.prototype);xb.prototype.constructor=xb;xb.prototype.isMeshPhongMaterial=!0;xb.prototype.copy=function(b){aa.prototype.copy.call(this,b);this.color.copy(b.color);this.specular.copy(b.specular);this.shininess=b.shininess;this.map=b.map;this.lightMap=b.lightMap;this.lightMapIntensity=b.lightMapIntensity;this.aoMap=b.aoMap;this.aoMapIntensity=b.aoMapIntensity;this.emissive.copy(b.emissive);this.emissiveMap=b.emissiveMap;this.emissiveIntensity=b.emissiveIntensity;
this.bumpMap=b.bumpMap;this.bumpScale=b.bumpScale;this.normalMap=b.normalMap;this.normalScale.copy(b.normalScale);this.displacementMap=b.displacementMap;this.displacementScale=b.displacementScale;this.displacementBias=b.displacementBias;this.specularMap=b.specularMap;this.alphaMap=b.alphaMap;this.envMap=b.envMap;this.combine=b.combine;this.reflectivity=b.reflectivity;this.refractionRatio=b.refractionRatio;this.wireframe=b.wireframe;this.wireframeLinewidth=b.wireframeLinewidth;this.wireframeLinecap=
b.wireframeLinecap;this.wireframeLinejoin=b.wireframeLinejoin;this.skinning=b.skinning;this.morphTargets=b.morphTargets;this.morphNormals=b.morphNormals;return this};Gb.prototype=Object.create(aa.prototype);Gb.prototype.constructor=Gb;Gb.prototype.isMeshNormalMaterial=!0;Gb.prototype.copy=function(b){aa.prototype.copy.call(this,b);this.wireframe=b.wireframe;this.wireframeLinewidth=b.wireframeLinewidth;return this};Hb.prototype=Object.create(aa.prototype);Hb.prototype.constructor=Hb;Hb.prototype.isMeshLambertMaterial=
!0;Hb.prototype.copy=function(b){aa.prototype.copy.call(this,b);this.color.copy(b.color);this.map=b.map;this.lightMap=b.lightMap;this.lightMapIntensity=b.lightMapIntensity;this.aoMap=b.aoMap;this.aoMapIntensity=b.aoMapIntensity;this.emissive.copy(b.emissive);this.emissiveMap=b.emissiveMap;this.emissiveIntensity=b.emissiveIntensity;this.specularMap=b.specularMap;this.alphaMap=b.alphaMap;this.envMap=b.envMap;this.combine=b.combine;this.reflectivity=b.reflectivity;this.refractionRatio=b.refractionRatio;
this.wireframe=b.wireframe;this.wireframeLinewidth=b.wireframeLinewidth;this.wireframeLinecap=b.wireframeLinecap;this.wireframeLinejoin=b.wireframeLinejoin;this.skinning=b.skinning;this.morphTargets=b.morphTargets;this.morphNormals=b.morphNormals;return this};Ib.prototype=Object.create(aa.prototype);Ib.prototype.constructor=Ib;Ib.prototype.isLineDashedMaterial=!0;Ib.prototype.copy=function(b){aa.prototype.copy.call(this,b);this.color.copy(b.color);this.linewidth=b.linewidth;this.scale=b.scale;this.dashSize=
b.dashSize;this.gapSize=b.gapSize;return this};var Qe=Object.freeze({ShadowMaterial:hc,SpriteMaterial:Ab,RawShaderMaterial:ic,ShaderMaterial:Ba,PointsMaterial:Va,MultiMaterial:Oc,MeshPhysicalMaterial:Fb,MeshStandardMaterial:jb,MeshPhongMaterial:xb,MeshNormalMaterial:Gb,MeshLambertMaterial:Hb,MeshDepthMaterial:Aa,MeshBasicMaterial:Pa,LineDashedMaterial:Ib,LineBasicMaterial:Ha,Material:aa});k.Cache={enabled:!1,files:{},add:function(b,a){!1!==this.enabled&&(this.files[b]=a)},get:function(b){if(!1!==
this.enabled)return this.files[b]},remove:function(b){delete this.files[b]},clear:function(){this.files={}}};k.DefaultLoadingManager=new Id;Object.assign(Ta.prototype,{load:function(b,a,c,d){void 0!==this.path&&(b=this.path+b);var h=this,e=k.Cache.get(b);if(void 0!==e)return h.manager.itemStart(b),setTimeout(function(){a&&a(e);h.manager.itemEnd(b)},0),e;var f=new XMLHttpRequest;f.open("GET",b,!0);f.addEventListener("load",function(c){var e=c.target.response;k.Cache.add(b,e);200===this.status?(a&&
a(e),h.manager.itemEnd(b)):0===this.status?(console.warn("THREE.XHRLoader: HTTP Status 0 received."),a&&a(e),h.manager.itemEnd(b)):(d&&d(c),h.manager.itemError(b))},!1);void 0!==c&&f.addEventListener("progress",function(b){c(b)},!1);f.addEventListener("error",function(a){d&&d(a);h.manager.itemError(b)},!1);void 0!==this.responseType&&(f.responseType=this.responseType);void 0!==this.withCredentials&&(f.withCredentials=this.withCredentials);f.overrideMimeType&&f.overrideMimeType("text/plain");f.send(null);
h.manager.itemStart(b);return f},setPath:function(b){this.path=b;return this},setResponseType:function(b){this.responseType=b;return this},setWithCredentials:function(b){this.withCredentials=b;return this}});Object.assign(qe.prototype,{load:function(b,a,c,d){function h(h){k.load(b[h],function(b){b=e._parser(b,!0);f[h]={width:b.width,height:b.height,format:b.format,mipmaps:b.mipmaps};r+=1;6===r&&(1===b.mipmapCount&&(g.minFilter=1006),g.format=b.format,g.needsUpdate=!0,a&&a(g))},c,d)}var e=this,f=[],
g=new Zb;g.image=f;var k=new Ta(this.manager);k.setPath(this.path);k.setResponseType("arraybuffer");if(Array.isArray(b))for(var r=0,l=0,m=b.length;l<m;++l)h(l);else k.load(b,function(b){b=e._parser(b,!0);if(b.isCubemap)for(var c=b.mipmaps.length/b.mipmapCount,d=0;d<c;d++){f[d]={mipmaps:[]};for(var h=0;h<b.mipmapCount;h++)f[d].mipmaps.push(b.mipmaps[d*b.mipmapCount+h]),f[d].format=b.format,f[d].width=b.width,f[d].height=b.height}else g.image.width=b.width,g.image.height=b.height,g.mipmaps=b.mipmaps;
1===b.mipmapCount&&(g.minFilter=1006);g.format=b.format;g.needsUpdate=!0;a&&a(g)},c,d);return g},setPath:function(b){this.path=b;return this}});Object.assign(Jd.prototype,{load:function(b,a,c,d){var h=this,e=new Bb,f=new Ta(this.manager);f.setResponseType("arraybuffer");f.load(b,function(b){if(b=h._parser(b))void 0!==b.image?e.image=b.image:void 0!==b.data&&(e.image.width=b.width,e.image.height=b.height,e.image.data=b.data),e.wrapS=void 0!==b.wrapS?b.wrapS:1001,e.wrapT=void 0!==b.wrapT?b.wrapT:1001,
e.magFilter=void 0!==b.magFilter?b.magFilter:1006,e.minFilter=void 0!==b.minFilter?b.minFilter:1008,e.anisotropy=void 0!==b.anisotropy?b.anisotropy:1,void 0!==b.format&&(e.format=b.format),void 0!==b.type&&(e.type=b.type),void 0!==b.mipmaps&&(e.mipmaps=b.mipmaps),1===b.mipmapCount&&(e.minFilter=1006),e.needsUpdate=!0,a&&a(e,b)},c,d);return e}});Object.assign(Pc.prototype,{load:function(b,a,c,d){var h=this,e=document.createElementNS("http://www.w3.org/1999/xhtml","img");e.onload=function(){e.onload=
null;URL.revokeObjectURL(e.src);a&&a(e);h.manager.itemEnd(b)};if(0===b.indexOf("data:"))e.src=b;else{var f=new Ta;f.setPath(this.path);f.setResponseType("blob");f.setWithCredentials(this.withCredentials);f.load(b,function(b){e.src=URL.createObjectURL(b)},c,d)}h.manager.itemStart(b);return e},setCrossOrigin:function(b){this.crossOrigin=b;return this},setWithCredentials:function(b){this.withCredentials=b;return this},setPath:function(b){this.path=b;return this}});Object.assign(Kd.prototype,{load:function(b,
a,c,d){function h(c){f.load(b[c],function(b){e.images[c]=b;g++;6===g&&(e.needsUpdate=!0,a&&a(e))},void 0,d)}var e=new p,f=new Pc(this.manager);f.setCrossOrigin(this.crossOrigin);f.setPath(this.path);var g=0;for(c=0;c<b.length;++c)h(c);return e},setCrossOrigin:function(b){this.crossOrigin=b;return this},setPath:function(b){this.path=b;return this}});Object.assign(jd.prototype,{load:function(b,a,c,d){var h=new l,e=new Pc(this.manager);e.setCrossOrigin(this.crossOrigin);e.setWithCredentials(this.withCredentials);
e.setPath(this.path);e.load(b,function(c){var d=0<b.search(/\.(jpg|jpeg)$/)||0===b.search(/^data\:image\/jpeg/);h.format=d?1022:1023;h.image=c;h.needsUpdate=!0;void 0!==a&&a(h)},c,d);return h},setCrossOrigin:function(b){this.crossOrigin=b;return this},setWithCredentials:function(b){this.withCredentials=b;return this},setPath:function(b){this.path=b;return this}});Ca.prototype=Object.assign(Object.create(X.prototype),{constructor:Ca,isLight:!0,copy:function(b){X.prototype.copy.call(this,b);this.color.copy(b.color);
this.intensity=b.intensity;return this},toJSON:function(b){b=X.prototype.toJSON.call(this,b);b.object.color=this.color.getHex();b.object.intensity=this.intensity;void 0!==this.groundColor&&(b.object.groundColor=this.groundColor.getHex());void 0!==this.distance&&(b.object.distance=this.distance);void 0!==this.angle&&(b.object.angle=this.angle);void 0!==this.decay&&(b.object.decay=this.decay);void 0!==this.penumbra&&(b.object.penumbra=this.penumbra);void 0!==this.shadow&&(b.object.shadow=this.shadow.toJSON());
return b}});kd.prototype=Object.assign(Object.create(Ca.prototype),{constructor:kd,isHemisphereLight:!0,copy:function(b){Ca.prototype.copy.call(this,b);this.groundColor.copy(b.groundColor);return this}});Object.assign(Jb.prototype,{copy:function(b){this.camera=b.camera.clone();this.bias=b.bias;this.radius=b.radius;this.mapSize.copy(b.mapSize);return this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var b={};0!==this.bias&&(b.bias=this.bias);1!==this.radius&&(b.radius=
this.radius);if(512!==this.mapSize.x||512!==this.mapSize.y)b.mapSize=this.mapSize.toArray();b.camera=this.camera.toJSON(!1).object;delete b.camera.matrix;return b}});ld.prototype=Object.assign(Object.create(Jb.prototype),{constructor:ld,isSpotLightShadow:!0,update:function(b){var a=2*k.Math.RAD2DEG*b.angle,c=this.mapSize.width/this.mapSize.height;b=b.distance||500;var d=this.camera;if(a!==d.fov||c!==d.aspect||b!==d.far)d.fov=a,d.aspect=c,d.far=b,d.updateProjectionMatrix()}});md.prototype=Object.assign(Object.create(Ca.prototype),
{constructor:md,isSpotLight:!0,copy:function(b){Ca.prototype.copy.call(this,b);this.distance=b.distance;this.angle=b.angle;this.penumbra=b.penumbra;this.decay=b.decay;this.target=b.target.clone();this.shadow=b.shadow.clone();return this}});nd.prototype=Object.assign(Object.create(Ca.prototype),{constructor:nd,isPointLight:!0,copy:function(b){Ca.prototype.copy.call(this,b);this.distance=b.distance;this.decay=b.decay;this.shadow=b.shadow.clone();return this}});od.prototype=Object.assign(Object.create(Jb.prototype),
{constructor:od});pd.prototype=Object.assign(Object.create(Ca.prototype),{constructor:pd,isDirectionalLight:!0,copy:function(b){Ca.prototype.copy.call(this,b);this.target=b.target.clone();this.shadow=b.shadow.clone();return this}});qd.prototype=Object.assign(Object.create(Ca.prototype),{constructor:qd,isAmbientLight:!0});k.AnimationUtils={arraySlice:function(b,a,c){return k.AnimationUtils.isTypedArray(b)?new b.constructor(b.subarray(a,c)):b.slice(a,c)},convertArray:function(b,a,c){return!b||!c&&b.constructor===
a?b:"number"===typeof a.BYTES_PER_ELEMENT?new a(b):Array.prototype.slice.call(b)},isTypedArray:function(b){return ArrayBuffer.isView(b)&&!(b instanceof DataView)},getKeyframeOrder:function(b){for(var a=b.length,c=Array(a),d=0;d!==a;++d)c[d]=d;c.sort(function(a,c){return b[a]-b[c]});return c},sortedArray:function(b,a,c){for(var d=b.length,h=new b.constructor(d),e=0,f=0;f!==d;++e)for(var g=c[e]*a,k=0;k!==a;++k)h[f++]=b[g+k];return h},flattenJSON:function(b,a,c,d){for(var h=1,e=b[0];void 0!==e&&void 0===
e[d];)e=b[h++];if(void 0!==e){var f=e[d];if(void 0!==f)if(Array.isArray(f)){do f=e[d],void 0!==f&&(a.push(e.time),c.push.apply(c,f)),e=b[h++];while(void 0!==e)}else if(void 0!==f.toArray){do f=e[d],void 0!==f&&(a.push(e.time),f.toArray(c,c.length)),e=b[h++];while(void 0!==e)}else{do f=e[d],void 0!==f&&(a.push(e.time),c.push(f)),e=b[h++];while(void 0!==e)}}}};Ua.prototype={constructor:Ua,evaluate:function(b){var a=this.parameterPositions,c=this._cachedIndex,d=a[c],e=a[c-1];a:{b:{c:{d:if(!(b<d)){for(var f=
c+2;;){if(void 0===d){if(b<e)break d;this._cachedIndex=c=a.length;return this.afterEnd_(c-1,b,e)}if(c===f)break;e=d;d=a[++c];if(b<d)break b}d=a.length;break c}if(b>=e)break a;else{f=a[1];b<f&&(c=2,e=f);for(f=c-2;;){if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,b,d);if(c===f)break;d=e;e=a[--c-1];if(b>=e)break b}d=c;c=0}}for(;c<d;)e=c+d>>>1,b<a[e]?d=e:c=e+1;d=a[c];e=a[c-1];if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,b,d);if(void 0===d)return this._cachedIndex=c=a.length,
this.afterEnd_(c-1,e,b)}this._cachedIndex=c;this.intervalChanged_(c,e,d)}return this.interpolate_(c,e,b,d)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(b){var a=this.resultBuffer,c=this.sampleValues,d=this.valueSize;b*=d;for(var e=0;e!==d;++e)a[e]=c[b+e];return a},interpolate_:function(b,a,c,d){throw Error("call to abstract method");},intervalChanged_:function(b,a,c){}};Object.assign(Ua.prototype,{beforeStart_:Ua.prototype.copySampleValue_,
afterEnd_:Ua.prototype.copySampleValue_});rd.prototype=Object.assign(Object.create(Ua.prototype),{constructor:rd,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(b,a,c){var d=this.parameterPositions,e=b-2,h=b+1,f=d[e],g=d[h];if(void 0===f)switch(this.getSettings_().endingStart){case 2401:e=b;f=2*a-c;break;case 2402:e=d.length-2;f=a+d[e]-d[e+1];break;default:e=b,f=c}if(void 0===g)switch(this.getSettings_().endingEnd){case 2401:h=b;g=2*c-a;break;case 2402:h=1;g=c+d[1]-d[0];
break;default:h=b-1,g=a}b=.5*(c-a);d=this.valueSize;this._weightPrev=b/(a-f);this._weightNext=b/(g-c);this._offsetPrev=e*d;this._offsetNext=h*d},interpolate_:function(b,a,c,d){var e=this.resultBuffer,h=this.sampleValues,f=this.valueSize;b*=f;var g=b-f,k=this._offsetPrev,r=this._offsetNext,l=this._weightPrev,m=this._weightNext,n=(c-a)/(d-a);c=n*n;d=c*n;a=-l*d+2*l*c-l*n;l=(1+l)*d+(-1.5-2*l)*c+(-.5+l)*n+1;n=(-1-m)*d+(1.5+m)*c+.5*n;m=m*d-m*c;for(c=0;c!==f;++c)e[c]=a*h[k+c]+l*h[g+c]+n*h[b+c]+m*h[r+c];
return e}});Qc.prototype=Object.assign(Object.create(Ua.prototype),{constructor:Qc,interpolate_:function(b,a,c,d){var e=this.resultBuffer,h=this.sampleValues,f=this.valueSize;b*=f;var g=b-f;a=(c-a)/(d-a);c=1-a;for(d=0;d!==f;++d)e[d]=h[g+d]*c+h[b+d]*a;return e}});sd.prototype=Object.assign(Object.create(Ua.prototype),{constructor:sd,interpolate_:function(b,a,c,d){return this.copySampleValue_(b-1)}});var sb;sb={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(b){return new sd(this.times,
this.values,this.getValueSize(),b)},InterpolantFactoryMethodLinear:function(b){return new Qc(this.times,this.values,this.getValueSize(),b)},InterpolantFactoryMethodSmooth:function(b){return new rd(this.times,this.values,this.getValueSize(),b)},setInterpolation:function(b){var a;switch(b){case 2300:a=this.InterpolantFactoryMethodDiscrete;break;case 2301:a=this.InterpolantFactoryMethodLinear;break;case 2302:a=this.InterpolantFactoryMethodSmooth}if(void 0===a){a="unsupported interpolation for "+this.ValueTypeName+
" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(b!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(a);console.warn(a)}else this.createInterpolant=a},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},
shift:function(b){if(0!==b)for(var a=this.times,c=0,d=a.length;c!==d;++c)a[c]+=b;return this},scale:function(b){if(1!==b)for(var a=this.times,c=0,d=a.length;c!==d;++c)a[c]*=b;return this},trim:function(b,a){for(var c=this.times,d=c.length,e=0,h=d-1;e!==d&&c[e]<b;)++e;for(;-1!==h&&c[h]>a;)--h;++h;if(0!==e||h!==d)e>=h&&(h=Math.max(h,1),e=h-1),d=this.getValueSize(),this.times=k.AnimationUtils.arraySlice(c,e,h),this.values=k.AnimationUtils.arraySlice(this.values,e*d,h*d);return this},validate:function(){var b=
!0,a=this.getValueSize();0!==a-Math.floor(a)&&(console.error("invalid value size in track",this),b=!1);var c=this.times,a=this.values,d=c.length;0===d&&(console.error("track is empty",this),b=!1);for(var e=null,f=0;f!==d;f++){var g=c[f];if("number"===typeof g&&isNaN(g)){console.error("time is not a valid number",this,f,g);b=!1;break}if(null!==e&&e>g){console.error("out of order keys",this,f,g,e);b=!1;break}e=g}if(void 0!==a&&k.AnimationUtils.isTypedArray(a))for(f=0,c=a.length;f!==c;++f)if(d=a[f],
isNaN(d)){console.error("value is not a valid number",this,f,d);b=!1;break}return b},optimize:function(){for(var b=this.times,a=this.values,c=this.getValueSize(),d=2302===this.getInterpolation(),e=1,f=b.length-1,g=1;g<f;++g){var l=!1,m=b[g];if(m!==b[g+1]&&(1!==g||m!==m[0]))if(d)l=!0;else for(var n=g*c,p=n-c,q=n+c,m=0;m!==c;++m){var t=a[n+m];if(t!==a[p+m]||t!==a[q+m]){l=!0;break}}if(l){if(g!==e)for(b[e]=b[g],l=g*c,n=e*c,m=0;m!==c;++m)a[n+m]=a[l+m];++e}}if(0<f){b[e]=b[f];l=f*c;n=e*c;for(m=0;m!==c;++m)a[n+
m]=a[l+m];++e}e!==b.length&&(this.times=k.AnimationUtils.arraySlice(b,0,e),this.values=k.AnimationUtils.arraySlice(a,0,e*c));return this}};jc.prototype=Object.assign(Object.create(sb),{constructor:jc,ValueTypeName:"vector"});td.prototype=Object.assign(Object.create(Ua.prototype),{constructor:td,interpolate_:function(b,a,c,d){var e=this.resultBuffer,h=this.sampleValues,f=this.valueSize;b*=f;a=(c-a)/(d-a);for(c=b+f;b!==c;b+=4)m.slerpFlat(e,0,h,b-f,h,b,a);return e}});Rc.prototype=Object.assign(Object.create(sb),
{constructor:Rc,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(b){return new td(this.times,this.values,this.getValueSize(),b)},InterpolantFactoryMethodSmooth:void 0});kc.prototype=Object.assign(Object.create(sb),{constructor:kc,ValueTypeName:"number"});ud.prototype=Object.assign(Object.create(sb),{constructor:ud,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});
vd.prototype=Object.assign(Object.create(sb),{constructor:vd,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});wd.prototype=Object.assign(Object.create(sb),{constructor:wd,ValueTypeName:"color"});Lb.prototype=sb;sb.constructor=Lb;Object.assign(Lb,{parse:function(b){if(void 0===b.type)throw Error("track type undefined, can not parse");var a=Lb._getTrackTypeForValueTypeName(b.type);if(void 0===b.times){var c=
[],d=[];k.AnimationUtils.flattenJSON(b.keys,c,d,"value");b.times=c;b.values=d}return void 0!==a.parse?a.parse(b):new a(b.name,b.times,b.values,b.interpolation)},toJSON:function(b){var a=b.constructor;if(void 0!==a.toJSON)a=a.toJSON(b);else{var a={name:b.name,times:k.AnimationUtils.convertArray(b.times,Array),values:k.AnimationUtils.convertArray(b.values,Array)},c=b.getInterpolation();c!==b.DefaultInterpolation&&(a.interpolation=c)}a.type=b.ValueTypeName;return a},_getTrackTypeForValueTypeName:function(b){switch(b.toLowerCase()){case "scalar":case "double":case "float":case "number":case "integer":return kc;
case "vector":case "vector2":case "vector3":case "vector4":return jc;case "color":return wd;case "quaternion":return Rc;case "bool":case "boolean":return vd;case "string":return ud}throw Error("Unsupported typeName: "+b);}});$a.prototype={constructor:$a,resetDuration:function(){for(var b=0,a=0,c=this.tracks.length;a!==c;++a)var d=this.tracks[a],b=Math.max(b,d.times[d.times.length-1]);this.duration=b},trim:function(){for(var b=0;b<this.tracks.length;b++)this.tracks[b].trim(0,this.duration);return this},
optimize:function(){for(var b=0;b<this.tracks.length;b++)this.tracks[b].optimize();return this}};Object.assign($a,{parse:function(b){for(var a=[],c=b.tracks,d=1/(b.fps||1),e=0,f=c.length;e!==f;++e)a.push(Lb.parse(c[e]).scale(d));return new $a(b.name,b.duration,a)},toJSON:function(b){var a=[],c=b.tracks;b={name:b.name,duration:b.duration,tracks:a};for(var d=0,e=c.length;d!==e;++d)a.push(Lb.toJSON(c[d]));return b},CreateFromMorphTargetSequence:function(b,a,c,d){for(var e=a.length,h=[],f=0;f<e;f++){var g=
[],l=[];g.push((f+e-1)%e,f,(f+1)%e);l.push(0,1,0);var r=k.AnimationUtils.getKeyframeOrder(g),g=k.AnimationUtils.sortedArray(g,1,r),l=k.AnimationUtils.sortedArray(l,1,r);d||0!==g[0]||(g.push(e),l.push(l[0]));h.push((new kc(".morphTargetInfluences["+a[f].name+"]",g,l)).scale(1/c))}return new $a(b,-1,h)},findByName:function(b,a){var c=b;Array.isArray(b)||(c=b.geometry&&b.geometry.animations||b.animations);for(var d=0;d<c.length;d++)if(c[d].name===a)return c[d];return null},CreateClipsFromMorphTargetSequences:function(b,
a,c){for(var d={},e=/^([\w-]*?)([\d]+)$/,h=0,f=b.length;h<f;h++){var g=b[h],k=g.name.match(e);if(k&&1<k.length){var l=k[1];(k=d[l])||(d[l]=k=[]);k.push(g)}}b=[];for(l in d)b.push($a.CreateFromMorphTargetSequence(l,d[l],a,c));return b},parseAnimation:function(b,a){if(!b)return console.error("  no animation in JSONLoader data"),null;for(var c=function(b,a,c,d,e){if(0!==c.length){var h=[],f=[];k.AnimationUtils.flattenJSON(c,h,f,d);0!==h.length&&e.push(new b(a,h,f))}},d=[],e=b.name||"default",h=b.length||
-1,f=b.fps||30,g=b.hierarchy||[],l=0;l<g.length;l++){var m=g[l].keys;if(m&&0!==m.length)if(m[0].morphTargets){for(var h={},n=0;n<m.length;n++)if(m[n].morphTargets)for(var p=0;p<m[n].morphTargets.length;p++)h[m[n].morphTargets[p]]=-1;for(var q in h){for(var t=[],u=[],p=0;p!==m[n].morphTargets.length;++p){var z=m[n];t.push(z.time);u.push(z.morphTarget===q?1:0)}d.push(new kc(".morphTargetInfluence["+q+"]",t,u))}h=h.length*(f||1)}else n=".bones["+a[l].name+"]",c(jc,n+".position",m,"pos",d),c(Rc,n+".quaternion",
m,"rot",d),c(jc,n+".scale",m,"scl",d)}return 0===d.length?null:new $a(e,h,d)}});Object.assign(xd.prototype,{load:function(b,a,c,d){var e=this;(new Ta(e.manager)).load(b,function(b){a(e.parse(JSON.parse(b)))},c,d)},setTextures:function(b){this.textures=b},parse:function(b){function a(b){void 0===c[b]&&console.warn("THREE.MaterialLoader: Undefined texture",b);return c[b]}var c=this.textures,d=new Qe[b.type];void 0!==b.uuid&&(d.uuid=b.uuid);void 0!==b.name&&(d.name=b.name);void 0!==b.color&&d.color.setHex(b.color);
void 0!==b.roughness&&(d.roughness=b.roughness);void 0!==b.metalness&&(d.metalness=b.metalness);void 0!==b.emissive&&d.emissive.setHex(b.emissive);void 0!==b.specular&&d.specular.setHex(b.specular);void 0!==b.shininess&&(d.shininess=b.shininess);void 0!==b.uniforms&&(d.uniforms=b.uniforms);void 0!==b.vertexShader&&(d.vertexShader=b.vertexShader);void 0!==b.fragmentShader&&(d.fragmentShader=b.fragmentShader);void 0!==b.vertexColors&&(d.vertexColors=b.vertexColors);void 0!==b.fog&&(d.fog=b.fog);void 0!==
b.shading&&(d.shading=b.shading);void 0!==b.blending&&(d.blending=b.blending);void 0!==b.side&&(d.side=b.side);void 0!==b.opacity&&(d.opacity=b.opacity);void 0!==b.transparent&&(d.transparent=b.transparent);void 0!==b.alphaTest&&(d.alphaTest=b.alphaTest);void 0!==b.depthTest&&(d.depthTest=b.depthTest);void 0!==b.depthWrite&&(d.depthWrite=b.depthWrite);void 0!==b.colorWrite&&(d.colorWrite=b.colorWrite);void 0!==b.wireframe&&(d.wireframe=b.wireframe);void 0!==b.wireframeLinewidth&&(d.wireframeLinewidth=
b.wireframeLinewidth);void 0!==b.wireframeLinecap&&(d.wireframeLinecap=b.wireframeLinecap);void 0!==b.wireframeLinejoin&&(d.wireframeLinejoin=b.wireframeLinejoin);void 0!==b.skinning&&(d.skinning=b.skinning);void 0!==b.morphTargets&&(d.morphTargets=b.morphTargets);void 0!==b.size&&(d.size=b.size);void 0!==b.sizeAttenuation&&(d.sizeAttenuation=b.sizeAttenuation);void 0!==b.map&&(d.map=a(b.map));void 0!==b.alphaMap&&(d.alphaMap=a(b.alphaMap),d.transparent=!0);void 0!==b.bumpMap&&(d.bumpMap=a(b.bumpMap));
void 0!==b.bumpScale&&(d.bumpScale=b.bumpScale);void 0!==b.normalMap&&(d.normalMap=a(b.normalMap));if(void 0!==b.normalScale){var f=b.normalScale;!1===Array.isArray(f)&&(f=[f,f]);d.normalScale=(new e).fromArray(f)}void 0!==b.displacementMap&&(d.displacementMap=a(b.displacementMap));void 0!==b.displacementScale&&(d.displacementScale=b.displacementScale);void 0!==b.displacementBias&&(d.displacementBias=b.displacementBias);void 0!==b.roughnessMap&&(d.roughnessMap=a(b.roughnessMap));void 0!==b.metalnessMap&&
(d.metalnessMap=a(b.metalnessMap));void 0!==b.emissiveMap&&(d.emissiveMap=a(b.emissiveMap));void 0!==b.emissiveIntensity&&(d.emissiveIntensity=b.emissiveIntensity);void 0!==b.specularMap&&(d.specularMap=a(b.specularMap));void 0!==b.envMap&&(d.envMap=a(b.envMap));void 0!==b.reflectivity&&(d.reflectivity=b.reflectivity);void 0!==b.lightMap&&(d.lightMap=a(b.lightMap));void 0!==b.lightMapIntensity&&(d.lightMapIntensity=b.lightMapIntensity);void 0!==b.aoMap&&(d.aoMap=a(b.aoMap));void 0!==b.aoMapIntensity&&
(d.aoMapIntensity=b.aoMapIntensity);if(void 0!==b.materials)for(var f=0,g=b.materials.length;f<g;f++)d.materials.push(this.parse(b.materials[f]));return d}});Object.assign(Ld.prototype,{load:function(b,a,c,d){var e=this;(new Ta(e.manager)).load(b,function(b){a(e.parse(JSON.parse(b)))},c,d)},parse:function(b){var a=new ia,c=b.data.index,d={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,
Float32Array:Float32Array,Float64Array:Float64Array};void 0!==c&&(c=new d[c.type](c.array),a.setIndex(new P(c,1)));var e=b.data.attributes,f;for(f in e){var k=e[f],c=new d[k.type](k.array);a.addAttribute(f,new P(c,k.itemSize,k.normalized))}d=b.data.groups||b.data.drawcalls||b.data.offsets;if(void 0!==d)for(f=0,c=d.length;f!==c;++f)e=d[f],a.addGroup(e.start,e.count,e.materialIndex);b=b.data.boundingSphere;void 0!==b&&(d=new g,void 0!==b.center&&d.fromArray(b.center),a.boundingSphere=new Oa(d,b.radius));
return a}});Mb.prototype={constructor:Mb,crossOrigin:void 0,extractUrlBase:function(b){b=b.split("/");if(1===b.length)return"./";b.pop();return b.join("/")+"/"},initMaterials:function(b,a,c){for(var d=[],e=0;e<b.length;++e)d[e]=this.createMaterial(b[e],a,c);return d},createMaterial:function(){var b,a,c;return function(d,e,h){function f(b,c,d,f,l){b=e+b;var r=Mb.Handlers.get(b);null!==r?b=r.load(b):(a.setCrossOrigin(h),b=a.load(b));void 0!==c&&(b.repeat.fromArray(c),1!==c[0]&&(b.wrapS=1E3),1!==c[1]&&
(b.wrapT=1E3));void 0!==d&&b.offset.fromArray(d);void 0!==f&&("repeat"===f[0]&&(b.wrapS=1E3),"mirror"===f[0]&&(b.wrapS=1002),"repeat"===f[1]&&(b.wrapT=1E3),"mirror"===f[1]&&(b.wrapT=1002));void 0!==l&&(b.anisotropy=l);c=k.Math.generateUUID();g[c]=b;return c}void 0===b&&(b=new O);void 0===a&&(a=new jd);void 0===c&&(c=new xd);var g={},l={uuid:k.Math.generateUUID(),type:"MeshLambertMaterial"},r;for(r in d){var m=d[r];switch(r){case "DbgColor":case "DbgIndex":case "opticalDensity":case "illumination":break;
case "DbgName":l.name=m;break;case "blending":l.blending=ye[m];break;case "colorAmbient":case "mapAmbient":console.warn("THREE.Loader.createMaterial:",r,"is no longer supported.");break;case "colorDiffuse":l.color=b.fromArray(m).getHex();break;case "colorSpecular":l.specular=b.fromArray(m).getHex();break;case "colorEmissive":l.emissive=b.fromArray(m).getHex();break;case "specularCoef":l.shininess=m;break;case "shading":"basic"===m.toLowerCase()&&(l.type="MeshBasicMaterial");"phong"===m.toLowerCase()&&
(l.type="MeshPhongMaterial");"standard"===m.toLowerCase()&&(l.type="MeshStandardMaterial");break;case "mapDiffuse":l.map=f(m,d.mapDiffuseRepeat,d.mapDiffuseOffset,d.mapDiffuseWrap,d.mapDiffuseAnisotropy);break;case "mapDiffuseRepeat":case "mapDiffuseOffset":case "mapDiffuseWrap":case "mapDiffuseAnisotropy":break;case "mapEmissive":l.emissiveMap=f(m,d.mapEmissiveRepeat,d.mapEmissiveOffset,d.mapEmissiveWrap,d.mapEmissiveAnisotropy);break;case "mapEmissiveRepeat":case "mapEmissiveOffset":case "mapEmissiveWrap":case "mapEmissiveAnisotropy":break;
case "mapLight":l.lightMap=f(m,d.mapLightRepeat,d.mapLightOffset,d.mapLightWrap,d.mapLightAnisotropy);break;case "mapLightRepeat":case "mapLightOffset":case "mapLightWrap":case "mapLightAnisotropy":break;case "mapAO":l.aoMap=f(m,d.mapAORepeat,d.mapAOOffset,d.mapAOWrap,d.mapAOAnisotropy);break;case "mapAORepeat":case "mapAOOffset":case "mapAOWrap":case "mapAOAnisotropy":break;case "mapBump":l.bumpMap=f(m,d.mapBumpRepeat,d.mapBumpOffset,d.mapBumpWrap,d.mapBumpAnisotropy);break;case "mapBumpScale":l.bumpScale=
m;break;case "mapBumpRepeat":case "mapBumpOffset":case "mapBumpWrap":case "mapBumpAnisotropy":break;case "mapNormal":l.normalMap=f(m,d.mapNormalRepeat,d.mapNormalOffset,d.mapNormalWrap,d.mapNormalAnisotropy);break;case "mapNormalFactor":l.normalScale=[m,m];break;case "mapNormalRepeat":case "mapNormalOffset":case "mapNormalWrap":case "mapNormalAnisotropy":break;case "mapSpecular":l.specularMap=f(m,d.mapSpecularRepeat,d.mapSpecularOffset,d.mapSpecularWrap,d.mapSpecularAnisotropy);break;case "mapSpecularRepeat":case "mapSpecularOffset":case "mapSpecularWrap":case "mapSpecularAnisotropy":break;
case "mapMetalness":l.metalnessMap=f(m,d.mapMetalnessRepeat,d.mapMetalnessOffset,d.mapMetalnessWrap,d.mapMetalnessAnisotropy);break;case "mapMetalnessRepeat":case "mapMetalnessOffset":case "mapMetalnessWrap":case "mapMetalnessAnisotropy":break;case "mapRoughness":l.roughnessMap=f(m,d.mapRoughnessRepeat,d.mapRoughnessOffset,d.mapRoughnessWrap,d.mapRoughnessAnisotropy);break;case "mapRoughnessRepeat":case "mapRoughnessOffset":case "mapRoughnessWrap":case "mapRoughnessAnisotropy":break;case "mapAlpha":l.alphaMap=
f(m,d.mapAlphaRepeat,d.mapAlphaOffset,d.mapAlphaWrap,d.mapAlphaAnisotropy);break;case "mapAlphaRepeat":case "mapAlphaOffset":case "mapAlphaWrap":case "mapAlphaAnisotropy":break;case "flipSided":l.side=1;break;case "doubleSided":l.side=2;break;case "transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity");l.opacity=m;break;case "depthTest":case "depthWrite":case "colorWrite":case "opacity":case "reflectivity":case "transparent":case "visible":case "wireframe":l[r]=
m;break;case "vertexColors":!0===m&&(l.vertexColors=2);"face"===m&&(l.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",r,m)}}"MeshBasicMaterial"===l.type&&delete l.emissive;"MeshPhongMaterial"!==l.type&&delete l.specular;1>l.opacity&&(l.transparent=!0);c.setTextures(g);return c.parse(l)}}()};Mb.Handlers={handlers:[],add:function(b,a){this.handlers.push(b,a)},get:function(b){for(var a=this.handlers,c=0,d=a.length;c<d;c+=2){var e=a[c+1];if(a[c].test(b))return e}return null}};
Object.assign(Md.prototype,{load:function(b,a,c,d){var e=this,h=this.texturePath&&"string"===typeof this.texturePath?this.texturePath:Mb.prototype.extractUrlBase(b),f=new Ta(this.manager);f.setWithCredentials(this.withCredentials);f.load(b,function(c){c=JSON.parse(c);var d=c.metadata;if(void 0!==d&&(d=d.type,void 0!==d)){if("object"===d.toLowerCase()){console.error("THREE.JSONLoader: "+b+" should be loaded with THREE.ObjectLoader instead.");return}if("scene"===d.toLowerCase()){console.error("THREE.JSONLoader: "+
b+" should be loaded with THREE.SceneLoader instead.");return}}c=e.parse(c,h);a(c.geometry,c.materials)},c,d)},setTexturePath:function(b){this.texturePath=b},parse:function(b,c){var d=new ha,h=void 0!==b.scale?1/b.scale:1;(function(a){var c,h,f,k,l,r,m,n,p,q,v,t,u,A=b.faces;r=b.vertices;var z=b.normals,w=b.colors,y=0;if(void 0!==b.uvs){for(c=0;c<b.uvs.length;c++)b.uvs[c].length&&y++;for(c=0;c<y;c++)d.faceVertexUvs[c]=[]}k=0;for(l=r.length;k<l;)c=new g,c.x=r[k++]*a,c.y=r[k++]*a,c.z=r[k++]*a,d.vertices.push(c);
k=0;for(l=A.length;k<l;)if(a=A[k++],p=a&1,f=a&2,c=a&8,m=a&16,q=a&32,r=a&64,a&=128,p){p=new sa;p.a=A[k];p.b=A[k+1];p.c=A[k+3];v=new sa;v.a=A[k+1];v.b=A[k+2];v.c=A[k+3];k+=4;f&&(f=A[k++],p.materialIndex=f,v.materialIndex=f);f=d.faces.length;if(c)for(c=0;c<y;c++)for(t=b.uvs[c],d.faceVertexUvs[c][f]=[],d.faceVertexUvs[c][f+1]=[],h=0;4>h;h++)n=A[k++],u=t[2*n],n=t[2*n+1],u=new e(u,n),2!==h&&d.faceVertexUvs[c][f].push(u),0!==h&&d.faceVertexUvs[c][f+1].push(u);m&&(m=3*A[k++],p.normal.set(z[m++],z[m++],z[m]),
v.normal.copy(p.normal));if(q)for(c=0;4>c;c++)m=3*A[k++],q=new g(z[m++],z[m++],z[m]),2!==c&&p.vertexNormals.push(q),0!==c&&v.vertexNormals.push(q);r&&(r=A[k++],r=w[r],p.color.setHex(r),v.color.setHex(r));if(a)for(c=0;4>c;c++)r=A[k++],r=w[r],2!==c&&p.vertexColors.push(new O(r)),0!==c&&v.vertexColors.push(new O(r));d.faces.push(p);d.faces.push(v)}else{p=new sa;p.a=A[k++];p.b=A[k++];p.c=A[k++];f&&(f=A[k++],p.materialIndex=f);f=d.faces.length;if(c)for(c=0;c<y;c++)for(t=b.uvs[c],d.faceVertexUvs[c][f]=
[],h=0;3>h;h++)n=A[k++],u=t[2*n],n=t[2*n+1],u=new e(u,n),d.faceVertexUvs[c][f].push(u);m&&(m=3*A[k++],p.normal.set(z[m++],z[m++],z[m]));if(q)for(c=0;3>c;c++)m=3*A[k++],q=new g(z[m++],z[m++],z[m]),p.vertexNormals.push(q);r&&(r=A[k++],p.color.setHex(w[r]));if(a)for(c=0;3>c;c++)r=A[k++],p.vertexColors.push(new O(w[r]));d.faces.push(p)}})(h);(function(){var c=void 0!==b.influencesPerVertex?b.influencesPerVertex:2;if(b.skinWeights)for(var e=0,h=b.skinWeights.length;e<h;e+=c)d.skinWeights.push(new a(b.skinWeights[e],
1<c?b.skinWeights[e+1]:0,2<c?b.skinWeights[e+2]:0,3<c?b.skinWeights[e+3]:0));if(b.skinIndices)for(e=0,h=b.skinIndices.length;e<h;e+=c)d.skinIndices.push(new a(b.skinIndices[e],1<c?b.skinIndices[e+1]:0,2<c?b.skinIndices[e+2]:0,3<c?b.skinIndices[e+3]:0));d.bones=b.bones;d.bones&&0<d.bones.length&&(d.skinWeights.length!==d.skinIndices.length||d.skinIndices.length!==d.vertices.length)&&console.warn("When skinning, number of vertices ("+d.vertices.length+"), skinIndices ("+d.skinIndices.length+"), and skinWeights ("+
d.skinWeights.length+") should match.")})();(function(a){if(void 0!==b.morphTargets)for(var c=0,e=b.morphTargets.length;c<e;c++){d.morphTargets[c]={};d.morphTargets[c].name=b.morphTargets[c].name;d.morphTargets[c].vertices=[];for(var h=d.morphTargets[c].vertices,f=b.morphTargets[c].vertices,k=0,l=f.length;k<l;k+=3){var r=new g;r.x=f[k]*a;r.y=f[k+1]*a;r.z=f[k+2]*a;h.push(r)}}if(void 0!==b.morphColors&&0<b.morphColors.length)for(console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.'),
a=d.faces,h=b.morphColors[0].colors,c=0,e=a.length;c<e;c++)a[c].color.fromArray(h,3*c)})(h);(function(){var a=[],c=[];void 0!==b.animation&&c.push(b.animation);void 0!==b.animations&&(b.animations.length?c=c.concat(b.animations):c.push(b.animations));for(var e=0;e<c.length;e++){var h=$a.parseAnimation(c[e],d.bones);h&&a.push(h)}d.morphTargets&&(c=$a.CreateClipsFromMorphTargetSequences(d.morphTargets,10),a=a.concat(c));0<a.length&&(d.animations=a)})();d.computeFaceNormals();d.computeBoundingSphere();
if(void 0===b.materials||0===b.materials.length)return{geometry:d};h=Mb.prototype.initMaterials(b.materials,c,this.crossOrigin);return{geometry:d,materials:h}}});Object.assign(re.prototype,{load:function(b,a,c,d){""===this.texturePath&&(this.texturePath=b.substring(0,b.lastIndexOf("/")+1));var e=this;(new Ta(e.manager)).load(b,function(b){e.parse(JSON.parse(b),a)},c,d)},setTexturePath:function(b){this.texturePath=b},setCrossOrigin:function(b){this.crossOrigin=b},parse:function(b,a){var c=this.parseGeometries(b.geometries),
d=this.parseImages(b.images,function(){void 0!==a&&a(e)}),d=this.parseTextures(b.textures,d),d=this.parseMaterials(b.materials,d),e=this.parseObject(b.object,c,d);b.animations&&(e.animations=this.parseAnimations(b.animations));void 0!==b.images&&0!==b.images.length||void 0===a||a(e);return e},parseGeometries:function(b){var a={};if(void 0!==b)for(var c=new Md,d=new Ld,e=0,f=b.length;e<f;e++){var g,k=b[e];switch(k.type){case "PlaneGeometry":case "PlaneBufferGeometry":g=new cb[k.type](k.width,k.height,
k.widthSegments,k.heightSegments);break;case "BoxGeometry":case "BoxBufferGeometry":case "CubeGeometry":g=new cb[k.type](k.width,k.height,k.depth,k.widthSegments,k.heightSegments,k.depthSegments);break;case "CircleGeometry":case "CircleBufferGeometry":g=new cb[k.type](k.radius,k.segments,k.thetaStart,k.thetaLength);break;case "CylinderGeometry":case "CylinderBufferGeometry":g=new cb[k.type](k.radiusTop,k.radiusBottom,k.height,k.radialSegments,k.heightSegments,k.openEnded,k.thetaStart,k.thetaLength);
break;case "ConeGeometry":case "ConeBufferGeometry":g=new cb[k.type](k.radius,k.height,k.radialSegments,k.heightSegments,k.openEnded,k.thetaStart,k.thetaLength);break;case "SphereGeometry":case "SphereBufferGeometry":g=new cb[k.type](k.radius,k.widthSegments,k.heightSegments,k.phiStart,k.phiLength,k.thetaStart,k.thetaLength);break;case "DodecahedronGeometry":case "IcosahedronGeometry":case "OctahedronGeometry":case "TetrahedronGeometry":g=new cb[k.type](k.radius,k.detail);break;case "RingGeometry":case "RingBufferGeometry":g=
new cb[k.type](k.innerRadius,k.outerRadius,k.thetaSegments,k.phiSegments,k.thetaStart,k.thetaLength);break;case "TorusGeometry":case "TorusBufferGeometry":g=new cb[k.type](k.radius,k.tube,k.radialSegments,k.tubularSegments,k.arc);break;case "TorusKnotGeometry":case "TorusKnotBufferGeometry":g=new cb[k.type](k.radius,k.tube,k.tubularSegments,k.radialSegments,k.p,k.q);break;case "LatheGeometry":case "LatheBufferGeometry":g=new cb[k.type](k.points,k.segments,k.phiStart,k.phiLength);break;case "BufferGeometry":g=
d.parse(k);break;case "Geometry":g=c.parse(k.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+k.type+'"');continue}g.uuid=k.uuid;void 0!==k.name&&(g.name=k.name);a[k.uuid]=g}return a},parseMaterials:function(b,a){var c={};if(void 0!==b){var d=new xd;d.setTextures(a);for(var e=0,h=b.length;e<h;e++){var f=d.parse(b[e]);c[f.uuid]=f}}return c},parseAnimations:function(b){for(var a=[],c=0;c<b.length;c++){var d=$a.parse(b[c]);a.push(d)}return a},
parseImages:function(b,a){function c(b){d.manager.itemStart(b);return f.load(b,function(){d.manager.itemEnd(b)},void 0,function(){d.manager.itemError(b)})}var d=this,e={};if(void 0!==b&&0<b.length){var h=new Id(a),f=new Pc(h);f.setCrossOrigin(this.crossOrigin);for(var h=0,g=b.length;h<g;h++){var k=b[h],l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(k.url)?k.url:d.texturePath+k.url;e[k.uuid]=c(l)}}return e},parseTextures:function(b,a){function c(b,a){if("number"===typeof b)return b;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",
b);return a[b]}var d={};if(void 0!==b)for(var e=0,h=b.length;e<h;e++){var f=b[e];void 0===f.image&&console.warn('THREE.ObjectLoader: No "image" specified for',f.uuid);void 0===a[f.image]&&console.warn("THREE.ObjectLoader: Undefined image",f.image);var g=new l(a[f.image]);g.needsUpdate=!0;g.uuid=f.uuid;void 0!==f.name&&(g.name=f.name);void 0!==f.mapping&&(g.mapping=c(f.mapping,ze));void 0!==f.offset&&g.offset.fromArray(f.offset);void 0!==f.repeat&&g.repeat.fromArray(f.repeat);void 0!==f.wrap&&(g.wrapS=
c(f.wrap[0],de),g.wrapT=c(f.wrap[1],de));void 0!==f.minFilter&&(g.minFilter=c(f.minFilter,ee));void 0!==f.magFilter&&(g.magFilter=c(f.magFilter,ee));void 0!==f.anisotropy&&(g.anisotropy=f.anisotropy);void 0!==f.flipY&&(g.flipY=f.flipY);d[f.uuid]=g}return d},parseObject:function(){var b=new n;return function(a,c,d){function e(b){void 0===c[b]&&console.warn("THREE.ObjectLoader: Undefined geometry",b);return c[b]}function h(b){if(void 0!==b)return void 0===d[b]&&console.warn("THREE.ObjectLoader: Undefined material",
b),d[b]}var f;switch(a.type){case "Scene":f=new zb;void 0!==a.background&&Number.isInteger(a.background)&&(f.background=new O(a.background));void 0!==a.fog&&("Fog"===a.fog.type?f.fog=new Vb(a.fog.color,a.fog.near,a.fog.far):"FogExp2"===a.fog.type&&(f.fog=new Ub(a.fog.color,a.fog.density)));break;case "PerspectiveCamera":f=new Sa(a.fov,a.aspect,a.near,a.far);void 0!==a.focus&&(f.focus=a.focus);void 0!==a.zoom&&(f.zoom=a.zoom);void 0!==a.filmGauge&&(f.filmGauge=a.filmGauge);void 0!==a.filmOffset&&(f.filmOffset=
a.filmOffset);void 0!==a.view&&(f.view=Object.assign({},a.view));break;case "OrthographicCamera":f=new eb(a.left,a.right,a.top,a.bottom,a.near,a.far);break;case "AmbientLight":f=new qd(a.color,a.intensity);break;case "DirectionalLight":f=new pd(a.color,a.intensity);break;case "PointLight":f=new nd(a.color,a.intensity,a.distance,a.decay);break;case "SpotLight":f=new md(a.color,a.intensity,a.distance,a.angle,a.penumbra,a.decay);break;case "HemisphereLight":f=new kd(a.color,a.groundColor,a.intensity);
break;case "Mesh":f=e(a.geometry);var g=h(a.material);f=f.bones&&0<f.bones.length?new gd(f,g):new Da(f,g);break;case "LOD":f=new xc;break;case "Line":f=new qb(e(a.geometry),h(a.material),a.mode);break;case "LineSegments":f=new Ia(e(a.geometry),h(a.material));break;case "PointCloud":case "Points":f=new Yb(e(a.geometry),h(a.material));break;case "Sprite":f=new vc(h(a.material));break;case "Group":f=new yc;break;default:f=new X}f.uuid=a.uuid;void 0!==a.name&&(f.name=a.name);void 0!==a.matrix?(b.fromArray(a.matrix),
b.decompose(f.position,f.quaternion,f.scale)):(void 0!==a.position&&f.position.fromArray(a.position),void 0!==a.rotation&&f.rotation.fromArray(a.rotation),void 0!==a.quaternion&&f.quaternion.fromArray(a.quaternion),void 0!==a.scale&&f.scale.fromArray(a.scale));void 0!==a.castShadow&&(f.castShadow=a.castShadow);void 0!==a.receiveShadow&&(f.receiveShadow=a.receiveShadow);a.shadow&&(void 0!==a.shadow.bias&&(f.shadow.bias=a.shadow.bias),void 0!==a.shadow.radius&&(f.shadow.radius=a.shadow.radius),void 0!==
a.shadow.mapSize&&f.shadow.mapSize.fromArray(a.shadow.mapSize),void 0!==a.shadow.camera&&(f.shadow.camera=this.parseObject(a.shadow.camera)));void 0!==a.visible&&(f.visible=a.visible);void 0!==a.userData&&(f.userData=a.userData);if(void 0!==a.children)for(var k in a.children)f.add(this.parseObject(a.children[k],c,d));if("LOD"===a.type)for(a=a.levels,g=0;g<a.length;g++){var l=a[g];k=f.getObjectByProperty("uuid",l.object);void 0!==k&&f.addLevel(k,l.distance)}return f}}()});wa.prototype={constructor:wa,
getPoint:function(b){console.warn("THREE.Curve: Warning, getPoint() not implemented!");return null},getPointAt:function(b){b=this.getUtoTmapping(b);return this.getPoint(b)},getPoints:function(b){b||(b=5);for(var a=[],c=0;c<=b;c++)a.push(this.getPoint(c/b));return a},getSpacedPoints:function(b){b||(b=5);for(var a=[],c=0;c<=b;c++)a.push(this.getPointAt(c/b));return a},getLength:function(){var b=this.getLengths();return b[b.length-1]},getLengths:function(b){b||(b=this.__arcLengthDivisions?this.__arcLengthDivisions:
200);if(this.cacheArcLengths&&this.cacheArcLengths.length===b+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var a=[],c,d=this.getPoint(0),e,f=0;a.push(0);for(e=1;e<=b;e++)c=this.getPoint(e/b),f+=c.distanceTo(d),a.push(f),d=c;return this.cacheArcLengths=a},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(b,a){var c=this.getLengths(),d,e=c.length,f;f=a?a:b*c[e-1];for(var h=0,g=e-1,k;h<=g;)if(d=Math.floor(h+(g-h)/2),k=c[d]-f,0>k)h=d+1;
else if(0<k)g=d-1;else{g=d;break}d=g;if(c[d]===f)return d/(e-1);h=c[d];return(d+(f-h)/(c[d+1]-h))/(e-1)},getTangent:function(b){var a=b-1E-4;b+=1E-4;0>a&&(a=0);1<b&&(b=1);a=this.getPoint(a);return this.getPoint(b).clone().sub(a).normalize()},getTangentAt:function(b){b=this.getUtoTmapping(b);return this.getTangent(b)}};wa.create=function(b,a){b.prototype=Object.create(wa.prototype);b.prototype.constructor=b;b.prototype.getPoint=a;return b};kb.prototype=Object.create(wa.prototype);kb.prototype.constructor=
kb;kb.prototype.isLineCurve=!0;kb.prototype.getPoint=function(b){if(1===b)return this.v2.clone();var a=this.v2.clone().sub(this.v1);a.multiplyScalar(b).add(this.v1);return a};kb.prototype.getPointAt=function(b){return this.getPoint(b)};kb.prototype.getTangent=function(b){return this.v2.clone().sub(this.v1).normalize()};Sc.prototype=Object.assign(Object.create(wa.prototype),{constructor:Sc,add:function(b){this.curves.push(b)},closePath:function(){var b=this.curves[0].getPoint(0),a=this.curves[this.curves.length-
1].getPoint(1);b.equals(a)||this.curves.push(new kb(a,b))},getPoint:function(b){var a=b*this.getLength(),c=this.getCurveLengths();for(b=0;b<c.length;){if(c[b]>=a)return a=c[b]-a,b=this.curves[b],c=b.getLength(),b.getPointAt(0===c?0:1-a/c);b++}return null},getLength:function(){var b=this.getCurveLengths();return b[b.length-1]},updateArcLengths:function(){this.needsUpdate=!0;this.cacheLengths=null;this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;
for(var b=[],a=0,c=0,d=this.curves.length;c<d;c++)a+=this.curves[c].getLength(),b.push(a);return this.cacheLengths=b},getSpacedPoints:function(b){b||(b=40);for(var a=[],c=0;c<=b;c++)a.push(this.getPoint(c/b));this.autoClose&&a.push(a[0]);return a},getPoints:function(b){b=b||12;for(var a=[],c,d=0,e=this.curves;d<e.length;d++)for(var f=e[d],f=f.getPoints(f&&f.isEllipseCurve?2*b:f&&f.isLineCurve?1:f&&f.isSplineCurve?b*f.points.length:b),g=0;g<f.length;g++){var k=f[g];c&&c.equals(k)||(a.push(k),c=k)}this.autoClose&&
1<a.length&&!a[a.length-1].equals(a[0])&&a.push(a[0]);return a},createPointsGeometry:function(b){b=this.getPoints(b);return this.createGeometry(b)},createSpacedPointsGeometry:function(b){b=this.getSpacedPoints(b);return this.createGeometry(b)},createGeometry:function(b){for(var a=new ha,c=0,d=b.length;c<d;c++){var e=b[c];a.vertices.push(new g(e.x,e.y,e.z||0))}return a}});rb.prototype=Object.create(wa.prototype);rb.prototype.constructor=rb;rb.prototype.isEllipseCurve=!0;rb.prototype.getPoint=function(b){for(var a=
2*Math.PI,c=this.aEndAngle-this.aStartAngle,d=Math.abs(c)<Number.EPSILON;0>c;)c+=a;for(;c>a;)c-=a;c<Number.EPSILON&&(c=d?0:a);!0!==this.aClockwise||d||(c=c===a?-a:c-a);a=this.aStartAngle+b*c;b=this.aX+this.xRadius*Math.cos(a);var f=this.aY+this.yRadius*Math.sin(a);0!==this.aRotation&&(a=Math.cos(this.aRotation),c=Math.sin(this.aRotation),d=b-this.aX,f-=this.aY,b=d*a-f*c+this.aX,f=d*c+f*a+this.aY);return new e(b,f)};k.CurveUtils={tangentQuadraticBezier:function(b,a,c,d){return 2*(1-b)*(c-a)+2*b*(d-
c)},tangentCubicBezier:function(b,a,c,d,e){return-3*a*(1-b)*(1-b)+3*c*(1-b)*(1-b)-6*b*c*(1-b)+6*b*d*(1-b)-3*b*b*d+3*b*b*e},tangentSpline:function(b,a,c,d,e){return 6*b*b-6*b+(3*b*b-4*b+1)+(-6*b*b+6*b)+(3*b*b-2*b)},interpolate:function(b,a,c,d,e){b=.5*(c-b);d=.5*(d-a);var f=e*e;return(2*a-2*c+b+d)*e*f+(-3*a+3*c-2*b-d)*f+b*e+a}};Nb.prototype=Object.create(wa.prototype);Nb.prototype.constructor=Nb;Nb.prototype.isSplineCurve=!0;Nb.prototype.getPoint=function(b){var a=this.points;b*=a.length-1;var c=Math.floor(b);
b-=c;var d=a[0===c?c:c-1],f=a[c],g=a[c>a.length-2?a.length-1:c+1],a=a[c>a.length-3?a.length-1:c+2],c=k.CurveUtils.interpolate;return new e(c(d.x,f.x,g.x,a.x,b),c(d.y,f.y,g.y,a.y,b))};Ob.prototype=Object.create(wa.prototype);Ob.prototype.constructor=Ob;Ob.prototype.getPoint=function(b){var a=k.ShapeUtils.b3;return new e(a(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x),a(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y))};Ob.prototype.getTangent=function(b){var a=k.CurveUtils.tangentCubicBezier;return(new e(a(b,
this.v0.x,this.v1.x,this.v2.x,this.v3.x),a(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y))).normalize()};Pb.prototype=Object.create(wa.prototype);Pb.prototype.constructor=Pb;Pb.prototype.getPoint=function(b){var a=k.ShapeUtils.b2;return new e(a(b,this.v0.x,this.v1.x,this.v2.x),a(b,this.v0.y,this.v1.y,this.v2.y))};Pb.prototype.getTangent=function(b){var a=k.CurveUtils.tangentQuadraticBezier;return(new e(a(b,this.v0.x,this.v1.x,this.v2.x),a(b,this.v0.y,this.v1.y,this.v2.y))).normalize()};var fe=Object.assign(Object.create(Sc.prototype),
{fromPoints:function(b){this.moveTo(b[0].x,b[0].y);for(var a=1,c=b.length;a<c;a++)this.lineTo(b[a].x,b[a].y)},moveTo:function(a,c){this.currentPoint.set(a,c)},lineTo:function(a,c){var b=new kb(this.currentPoint.clone(),new e(a,c));this.curves.push(b);this.currentPoint.set(a,c)},quadraticCurveTo:function(a,c,d,f){a=new Pb(this.currentPoint.clone(),new e(a,c),new e(d,f));this.curves.push(a);this.currentPoint.set(d,f)},bezierCurveTo:function(a,c,d,f,g,k){a=new Ob(this.currentPoint.clone(),new e(a,c),
new e(d,f),new e(g,k));this.curves.push(a);this.currentPoint.set(g,k)},splineThru:function(a){var b=[this.currentPoint.clone()].concat(a),b=new Nb(b);this.curves.push(b);this.currentPoint.copy(a[a.length-1])},arc:function(a,c,d,e,f,g){this.absarc(a+this.currentPoint.x,c+this.currentPoint.y,d,e,f,g)},absarc:function(a,c,d,e,f,g){this.absellipse(a,c,d,d,e,f,g)},ellipse:function(a,c,d,e,f,g,k,l){this.absellipse(a+this.currentPoint.x,c+this.currentPoint.y,d,e,f,g,k,l)},absellipse:function(a,c,d,e,f,g,
k,l){a=new rb(a,c,d,e,f,g,k,l);0<this.curves.length&&(c=a.getPoint(0),c.equals(this.currentPoint)||this.lineTo(c.x,c.y));this.curves.push(a);a=a.getPoint(1);this.currentPoint.copy(a)}});Qb.prototype=Object.assign(Object.create(fe),{constructor:Qb,getPointsHoles:function(a){for(var b=[],c=0,d=this.holes.length;c<d;c++)b[c]=this.holes[c].getPoints(a);return b},extractAllPoints:function(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}},extractPoints:function(a){return this.extractAllPoints(a)}});
Tc.prototype=fe;fe.constructor=Tc;Nd.prototype={moveTo:function(a,c){this.currentPath=new Tc;this.subPaths.push(this.currentPath);this.currentPath.moveTo(a,c)},lineTo:function(a,c){this.currentPath.lineTo(a,c)},quadraticCurveTo:function(a,c,d,e){this.currentPath.quadraticCurveTo(a,c,d,e)},bezierCurveTo:function(a,c,d,e,f,g){this.currentPath.bezierCurveTo(a,c,d,e,f,g)},splineThru:function(a){this.currentPath.splineThru(a)},toShapes:function(a,c){function b(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=
a[c],f=new Qb;f.curves=e.curves;b.push(f)}return b}function d(a,b){for(var c=b.length,d=!1,e=c-1,f=0;f<c;e=f++){var h=b[e],g=b[f],k=g.x-h.x,l=g.y-h.y;if(Math.abs(l)>Number.EPSILON){if(0>l&&(h=b[f],k=-k,g=b[e],l=-l),!(a.y<h.y||a.y>g.y))if(a.y===h.y){if(a.x===h.x)return!0}else{e=l*(a.x-h.x)-k*(a.y-h.y);if(0===e)return!0;0>e||(d=!d)}}else if(a.y===h.y&&(g.x<=a.x&&a.x<=h.x||h.x<=a.x&&a.x<=g.x))return!0}return d}var e=k.ShapeUtils.isClockWise,f=this.subPaths;if(0===f.length)return[];if(!0===c)return b(f);
var h,g,l,m=[];if(1===f.length)return g=f[0],l=new Qb,l.curves=g.curves,m.push(l),m;var n=!e(f[0].getPoints()),n=a?!n:n;l=[];var p=[],q=[],t=0,u;p[t]=void 0;q[t]=[];for(var z=0,w=f.length;z<w;z++)g=f[z],u=g.getPoints(),h=e(u),(h=a?!h:h)?(!n&&p[t]&&t++,p[t]={s:new Qb,p:u},p[t].s.curves=g.curves,n&&t++,q[t]=[]):q[t].push({h:g,p:u[0]});if(!p[0])return b(f);if(1<p.length){z=!1;g=[];e=0;for(f=p.length;e<f;e++)l[e]=[];e=0;for(f=p.length;e<f;e++)for(h=q[e],n=0;n<h.length;n++){t=h[n];u=!0;for(w=0;w<p.length;w++)d(t.p,
p[w].p)&&(e!==w&&g.push({froms:e,tos:w,hole:n}),u?(u=!1,l[w].push(t)):z=!0);u&&l[e].push(t)}0<g.length&&(z||(q=l))}z=0;for(e=p.length;z<e;z++)for(l=p[z].s,m.push(l),g=q[z],f=0,h=g.length;f<h;f++)l.holes.push(g[f].h);return m}};Object.assign(Od.prototype,{isFont:!0,generateShapes:function(a,c,d){void 0===c&&(c=100);void 0===d&&(d=4);var b=this.data;a=String(a).split("");var e=c/b.resolution,f=0;c=[];for(var h=0;h<a.length;h++){var g;g=e;var l=f,m=b.glyphs[a[h]]||b.glyphs["?"];if(m){var r=new Nd,n=
[],p=k.ShapeUtils.b2,q=k.ShapeUtils.b3,t,u,z,w,y,x,D,J;if(m.o)for(var C=m._cachedOutline||(m._cachedOutline=m.o.split(" ")),B=0,V=C.length;B<V;)switch(C[B++]){case "m":t=C[B++]*g+l;u=C[B++]*g;r.moveTo(t,u);break;case "l":t=C[B++]*g+l;u=C[B++]*g;r.lineTo(t,u);break;case "q":t=C[B++]*g+l;u=C[B++]*g;y=C[B++]*g+l;x=C[B++]*g;r.quadraticCurveTo(y,x,t,u);if(w=n[n.length-1]){z=w.x;w=w.y;for(var E=1;E<=d;E++){var G=E/d;p(G,z,y,t);p(G,w,x,u)}}break;case "b":if(t=C[B++]*g+l,u=C[B++]*g,y=C[B++]*g+l,x=C[B++]*
g,D=C[B++]*g+l,J=C[B++]*g,r.bezierCurveTo(y,x,D,J,t,u),w=n[n.length-1])for(z=w.x,w=w.y,E=1;E<=d;E++)G=E/d,q(G,z,y,D,t),q(G,w,x,J,u)}g={offset:m.ha*g,path:r}}else g=void 0;f+=g.offset;c.push(g.path)}d=[];b=0;for(a=c.length;b<a;b++)Array.prototype.push.apply(d,c[b].toShapes());return d}});Object.assign(se.prototype,{load:function(a,c,d,e){var b=this;(new Ta(this.manager)).load(a,function(a){var d;try{d=JSON.parse(a)}catch(Q){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),
d=JSON.parse(a.substring(65,a.length-2))}a=b.parse(d);c&&c(a)},d,e)},parse:function(a){return new Od(a)}});var Qd;Object.assign(Rd.prototype,{load:function(a,c,d,e){var b=new Ta(this.manager);b.setResponseType("arraybuffer");b.load(a,function(a){Pd().decodeAudioData(a,function(a){c(a)})},d,e)}});Object.assign(te.prototype,{update:function(){var a,c,d,e,f,g,l,m=new n,p=new n;return function(b){if(a!==this||c!==b.focus||d!==b.fov||e!==b.aspect*this.aspect||f!==b.near||g!==b.far||l!==b.zoom){a=this;
c=b.focus;d=b.fov;e=b.aspect*this.aspect;f=b.near;g=b.far;l=b.zoom;var h=b.projectionMatrix.clone(),r=this.eyeSep/2,n=r*f/c,q=f*Math.tan(k.Math.DEG2RAD*d*.5)/l,v;p.elements[12]=-r;m.elements[12]=r;r=-q*e+n;v=q*e+n;h.elements[0]=2*f/(v-r);h.elements[8]=(v+r)/(v-r);this.cameraL.projectionMatrix.copy(h);r=-q*e-n;v=q*e-n;h.elements[0]=2*f/(v-r);h.elements[8]=(v+r)/(v-r);this.cameraR.projectionMatrix.copy(h)}this.cameraL.matrixWorld.copy(b.matrixWorld).multiply(p);this.cameraR.matrixWorld.copy(b.matrixWorld).multiply(m)}}()});
yd.prototype=Object.create(X.prototype);yd.prototype.constructor=yd;Sd.prototype=Object.assign(Object.create(X.prototype),{constructor:Sd,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(a){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):
this.gain.disconnect(this.context.destination);this.filter=a;this.gain.connect(this.filter);this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(a){this.gain.gain.value=a},updateMatrixWorld:function(){var a=new g,c=new m,d=new g,e=new g;return function(b){X.prototype.updateMatrixWorld.call(this,b);b=this.context.listener;var f=this.up;this.matrixWorld.decompose(a,c,d);e.set(0,0,-1).applyQuaternion(c);b.setPosition(a.x,a.y,
a.z);b.setOrientation(e.x,e.y,e.z,f.x,f.y,f.z)}}()});lc.prototype=Object.assign(Object.create(X.prototype),{constructor:lc,getOutput:function(){return this.gain},setNodeSource:function(a){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=a;this.connect();return this},setBuffer:function(a){this.source.buffer=a;this.sourceType="buffer";this.autoplay&&this.play();return this},play:function(){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");
else{var a=this.context.createBufferSource();a.buffer=this.source.buffer;a.loop=this.source.loop;a.onended=this.source.onended;a.start(0,this.startTime);a.playbackRate.value=this.playbackRate;this.isPlaying=!0;this.source=a;return this.connect()}},pause:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this},stop:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");
else return this.source.stop(),this.startTime=0,this.isPlaying=!1,this},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var a=1,c=this.filters.length;a<c;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var a=1,c=this.filters.length;a<c;a++)this.filters[a-
1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(a){a||(a=[]);!0===this.isPlaying?(this.disconnect(),this.filters=a,this.connect()):this.filters=a;return this},getFilter:function(){return this.getFilters()[0]},setFilter:function(a){return this.setFilters(a?[a]:[])},setPlaybackRate:function(a){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");
else return this.playbackRate=a,!0===this.isPlaying&&(this.source.playbackRate.value=this.playbackRate),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.source.loop},setLoop:function(a){!1===this.hasPlaybackControl?console.warn("THREE.Audio: this Audio has no playback control."):this.source.loop=a},getVolume:function(){return this.gain.gain.value},
setVolume:function(a){this.gain.gain.value=a;return this}});Td.prototype=Object.assign(Object.create(lc.prototype),{constructor:Td,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(a){this.panner.refDistance=a},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(a){this.panner.rolloffFactor=a},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(a){this.panner.distanceModel=
a},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(a){this.panner.maxDistance=a},updateMatrixWorld:function(){var a=new g;return function(b){X.prototype.updateMatrixWorld.call(this,b);a.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(a.x,a.y,a.z)}}()});Object.assign(Ud.prototype,{getFrequencyData:function(){this.analyser.getByteFrequencyData(this.data);return this.data},getAverageFrequency:function(){for(var a=0,c=this.getFrequencyData(),d=0;d<c.length;d++)a+=
c[d];return a/c.length}});zd.prototype={constructor:zd,accumulate:function(a,c){var b=this.buffer,d=this.valueSize,e=a*d+d,f=this.cumulativeWeight;if(0===f){for(f=0;f!==d;++f)b[e+f]=b[f];f=c}else f+=c,this._mixBufferRegion(b,e,0,c/f,d);this.cumulativeWeight=f},apply:function(a){var b=this.valueSize,c=this.buffer;a=a*b+b;var d=this.cumulativeWeight,e=this.binding;this.cumulativeWeight=0;1>d&&this._mixBufferRegion(c,a,3*b,1-d,b);for(var d=b,f=b+b;d!==f;++d)if(c[d]!==c[d+b]){e.setValue(c,a);break}},
saveOriginalState:function(){var a=this.buffer,c=this.valueSize,d=3*c;this.binding.getValue(a,d);for(var e=c;e!==d;++e)a[e]=a[d+e%c];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(a,c,d,e,f){if(.5<=e)for(e=0;e!==f;++e)a[c+e]=a[d+e]},_slerp:function(a,c,d,e,f){m.slerpFlat(a,c,a,c,a,d,e)},_lerp:function(a,c,d,e,f){for(var b=1-e,h=0;h!==f;++h){var g=c+h;a[g]=a[g]*b+a[d+h]*e}}};va.prototype={constructor:va,getValue:function(a,
c){this.bind();this.getValue(a,c)},setValue:function(a,c){this.bind();this.setValue(a,c)},bind:function(){var a=this.node,c=this.parsedPath,d=c.objectName,e=c.propertyName,f=c.propertyIndex;a||(this.node=a=va.findNode(this.rootNode,c.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(a){if(d){var g=c.objectIndex;switch(d){case "materials":if(!a.material){console.error("  can not bind to material as node does not have a material",this);return}if(!a.material.materials){console.error("  can not bind to material.materials as node.material does not have a materials array",
this);return}a=a.material.materials;break;case "bones":if(!a.skeleton){console.error("  can not bind to bones as node does not have a skeleton",this);return}a=a.skeleton.bones;for(d=0;d<a.length;d++)if(a[d].name===g){g=d;break}break;default:if(void 0===a[d]){console.error("  can not bind to objectName of node, undefined",this);return}a=a[d]}if(void 0!==g){if(void 0===a[g]){console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,a);return}a=a[g]}}g=a[e];if(void 0===g)console.error("  trying to update property for track: "+
c.nodeName+"."+e+" but it wasn't found.",a);else{c=this.Versioning.None;void 0!==a.needsUpdate?(c=this.Versioning.NeedsUpdate,this.targetObject=a):void 0!==a.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=a);d=this.BindingType.Direct;if(void 0!==f){if("morphTargetInfluences"===e){if(!a.geometry){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this);return}if(!a.geometry.morphTargets){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",
this);return}for(d=0;d<this.node.geometry.morphTargets.length;d++)if(a.geometry.morphTargets[d].name===f){f=d;break}}d=this.BindingType.ArrayElement;this.resolvedProperty=g;this.propertyIndex=f}else void 0!==g.fromArray&&void 0!==g.toArray?(d=this.BindingType.HasFromToArray,this.resolvedProperty=g):void 0!==g.length?(d=this.BindingType.EntireArray,this.resolvedProperty=g):this.propertyName=e;this.getValue=this.GetterByBindingType[d];this.setValue=this.SetterByBindingTypeAndVersioning[d][c]}}else console.error("  trying to update node for track: "+
this.path+" but it wasn't found.")},unbind:function(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}};Object.assign(va.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:va.prototype.getValue,_setValue_unbound:va.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(a,c){a[c]=this.node[this.propertyName]},
function(a,c){for(var b=this.resolvedProperty,d=0,e=b.length;d!==e;++d)a[c++]=b[d]},function(a,c){a[c]=this.resolvedProperty[this.propertyIndex]},function(a,c){this.resolvedProperty.toArray(a,c)}],SetterByBindingTypeAndVersioning:[[function(a,c){this.node[this.propertyName]=a[c]},function(a,c){this.node[this.propertyName]=a[c];this.targetObject.needsUpdate=!0},function(a,c){this.node[this.propertyName]=a[c];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,c){for(var b=this.resolvedProperty,
d=0,e=b.length;d!==e;++d)b[d]=a[c++]},function(a,c){for(var b=this.resolvedProperty,d=0,e=b.length;d!==e;++d)b[d]=a[c++];this.targetObject.needsUpdate=!0},function(a,c){for(var b=this.resolvedProperty,d=0,e=b.length;d!==e;++d)b[d]=a[c++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,c){this.resolvedProperty[this.propertyIndex]=a[c]},function(a,c){this.resolvedProperty[this.propertyIndex]=a[c];this.targetObject.needsUpdate=!0},function(a,c){this.resolvedProperty[this.propertyIndex]=a[c];
this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,c){this.resolvedProperty.fromArray(a,c)},function(a,c){this.resolvedProperty.fromArray(a,c);this.targetObject.needsUpdate=!0},function(a,c){this.resolvedProperty.fromArray(a,c);this.targetObject.matrixWorldNeedsUpdate=!0}]]});va.Composite=function(a,c,d){d=d||va.parseTrackName(c);this._targetGroup=a;this._bindings=a.subscribe_(c,d)};va.Composite.prototype={constructor:va.Composite,getValue:function(a,c){this.bind();var b=this._bindings[this._targetGroup.nCachedObjects_];
void 0!==b&&b.getValue(a,c)},setValue:function(a,c){for(var b=this._bindings,d=this._targetGroup.nCachedObjects_,e=b.length;d!==e;++d)b[d].setValue(a,c)},bind:function(){for(var a=this._bindings,c=this._targetGroup.nCachedObjects_,d=a.length;c!==d;++c)a[c].bind()},unbind:function(){for(var a=this._bindings,c=this._targetGroup.nCachedObjects_,d=a.length;c!==d;++c)a[c].unbind()}};va.create=function(a,c,d){return a&&a.isAnimationObjectGroup?new va.Composite(a,c,d):new va(a,c,d)};va.parseTrackName=function(a){var b=
/^((?:\w+[\/:])*)(\w+)?(?:\.(\w+)(?:\[(.+)\])?)?\.(\w+)(?:\[(.+)\])?$/.exec(a);if(!b)throw Error("cannot parse trackName at all: "+a);b={nodeName:b[2],objectName:b[3],objectIndex:b[4],propertyName:b[5],propertyIndex:b[6]};if(null===b.propertyName||0===b.propertyName.length)throw Error("can not parse propertyName from trackName: "+a);return b};va.findNode=function(a,c){if(!c||""===c||"root"===c||"."===c||-1===c||c===a.name||c===a.uuid)return a;if(a.skeleton){var b=function(a){for(var b=0;b<a.bones.length;b++){var d=
a.bones[b];if(d.name===c)return d}return null}(a.skeleton);if(b)return b}if(a.children){var d=function(a){for(var b=0;b<a.length;b++){var e=a[b];if(e.name===c||e.uuid===c||(e=d(e.children)))return e}return null};if(b=d(a.children))return b}return null};Vd.prototype={constructor:Vd,isAnimationObjectGroup:!0,add:function(a){for(var b=this._objects,c=b.length,d=this.nCachedObjects_,e=this._indicesByUUID,f=this._paths,g=this._parsedPaths,k=this._bindings,l=k.length,m=0,n=arguments.length;m!==n;++m){var p=
arguments[m],q=p.uuid,t=e[q];if(void 0===t){t=c++;e[q]=t;b.push(p);for(var q=0,u=l;q!==u;++q)k[q].push(new va(p,f[q],g[q]))}else if(t<d){var z=b[t],w=--d,u=b[w];e[u.uuid]=t;b[t]=u;e[q]=w;b[w]=p;q=0;for(u=l;q!==u;++q){var y=k[q],x=y[t];y[t]=y[w];void 0===x&&(x=new va(p,f[q],g[q]));y[w]=x}}else b[t]!==z&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=d},remove:function(a){for(var b=this._objects,
c=this.nCachedObjects_,d=this._indicesByUUID,e=this._bindings,f=e.length,g=0,k=arguments.length;g!==k;++g){var l=arguments[g],m=l.uuid,n=d[m];if(void 0!==n&&n>=c){var p=c++,q=b[p];d[q.uuid]=n;b[n]=q;d[m]=p;b[p]=l;l=0;for(m=f;l!==m;++l){var q=e[l],t=q[n];q[n]=q[p];q[p]=t}}}this.nCachedObjects_=c},uncache:function(a){for(var b=this._objects,c=b.length,d=this.nCachedObjects_,e=this._indicesByUUID,f=this._bindings,g=f.length,k=0,l=arguments.length;k!==l;++k){var m=arguments[k].uuid,n=e[m];if(void 0!==
n)if(delete e[m],n<d){var m=--d,p=b[m],q=--c,t=b[q];e[p.uuid]=n;b[n]=p;e[t.uuid]=m;b[m]=t;b.pop();p=0;for(t=g;p!==t;++p){var u=f[p],z=u[q];u[n]=u[m];u[m]=z;u.pop()}}else for(q=--c,t=b[q],e[t.uuid]=n,b[n]=t,b.pop(),p=0,t=g;p!==t;++p)u=f[p],u[n]=u[q],u.pop()}this.nCachedObjects_=d},subscribe_:function(a,c){var b=this._bindingsIndicesByPath,d=b[a],e=this._bindings;if(void 0!==d)return e[d];var f=this._paths,g=this._parsedPaths,h=this._objects,k=this.nCachedObjects_,l=Array(h.length),d=e.length;b[a]=
d;f.push(a);g.push(c);e.push(l);b=k;for(d=h.length;b!==d;++b)l[b]=new va(h[b],a,c);return l},unsubscribe_:function(a){var b=this._bindingsIndicesByPath,c=b[a];if(void 0!==c){var d=this._paths,e=this._parsedPaths,f=this._bindings,g=f.length-1,k=f[g];b[a[g]]=c;f[c]=k;f.pop();e[c]=e[g];e.pop();d[c]=d[g];d.pop()}}};Wd.prototype={constructor:Wd,play:function(){this._mixer._activateAction(this);return this},stop:function(){this._mixer._deactivateAction(this);return this.reset()},reset:function(){this.paused=
!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(a){this._startTime=a;return this},setLoop:function(a,c){this.loop=a;this.repetitions=c;return this},setEffectiveWeight:function(a){this.weight=a;this._effectiveWeight=this.enabled?
a:0;return this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(a){return this._scheduleFading(a,0,1)},fadeOut:function(a){return this._scheduleFading(a,1,0)},crossFadeFrom:function(a,c,d){a.fadeOut(c);this.fadeIn(c);if(d){d=this._clip.duration;var b=a._clip.duration,e=d/b;a.warp(1,b/d,c);this.warp(e,1,c)}return this},crossFadeTo:function(a,c,d){return a.crossFadeFrom(this,c,d)},stopFading:function(){var a=this._weightInterpolant;null!==a&&(this._weightInterpolant=
null,this._mixer._takeBackControlInterpolant(a));return this},setEffectiveTimeScale:function(a){this.timeScale=a;this._effectiveTimeScale=this.paused?0:a;return this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(a){this.timeScale=this._clip.duration/a;return this.stopWarping()},syncWith:function(a){this.time=a.time;this.timeScale=a.timeScale;return this.stopWarping()},halt:function(a){return this.warp(this._effectiveTimeScale,0,a)},warp:function(a,
c,d){var b=this._mixer,e=b.time,f=this._timeScaleInterpolant,g=this.timeScale;null===f&&(this._timeScaleInterpolant=f=b._lendControlInterpolant());b=f.parameterPositions;f=f.sampleValues;b[0]=e;b[1]=e+d;f[0]=a/g;f[1]=c/g;return this},stopWarping:function(){var a=this._timeScaleInterpolant;null!==a&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||
this._mixer._root},_update:function(a,c,d,e){var b=this._startTime;if(null!==b){c=(a-b)*d;if(0>c||0===d)return;this._startTime=null;c*=d}c*=this._updateTimeScale(a);d=this._updateTime(c);a=this._updateWeight(a);if(0<a){c=this._interpolants;for(var b=this._propertyBindings,f=0,g=c.length;f!==g;++f)c[f].evaluate(d),b[f].accumulate(e,a)}},_updateWeight:function(a){var b=0;if(this.enabled){var b=this.weight,c=this._weightInterpolant;if(null!==c){var d=c.evaluate(a)[0],b=b*d;a>c.parameterPositions[1]&&
(this.stopFading(),0===d&&(this.enabled=!1))}}return this._effectiveWeight=b},_updateTimeScale:function(a){var b=0;if(!this.paused){var b=this.timeScale,c=this._timeScaleInterpolant;if(null!==c){var d=c.evaluate(a)[0],b=b*d;a>c.parameterPositions[1]&&(this.stopWarping(),0===b?this.paused=!0:this.timeScale=b)}}return this._effectiveTimeScale=b},_updateTime:function(a){var b=this.time+a;if(0===a)return b;var c=this._clip.duration,d=this.loop,e=this._loopCount;if(2200===d)a:{if(-1===e&&(this.loopCount=
0,this._setEndings(!0,!0,!1)),b>=c)b=c;else if(0>b)b=0;else break a;this.clampWhenFinished?this.paused=!0:this.enabled=!1;this._mixer.dispatchEvent({type:"finished",action:this,direction:0>a?-1:1})}else{d=2202===d;-1===e&&(0<=a?(e=0,this._setEndings(!0,0===this.repetitions,d)):this._setEndings(0===this.repetitions,!0,d));if(b>=c||0>b){var f=Math.floor(b/c),b=b-c*f,e=e+Math.abs(f),g=this.repetitions-e;0>g?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,b=0<a?c:0,this._mixer.dispatchEvent({type:"finished",
action:this,direction:0<a?1:-1})):(0===g?(a=0>a,this._setEndings(a,!a,d)):this._setEndings(!1,!1,d),this._loopCount=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:f}))}if(d&&1===(e&1))return this.time=b,c-b}return this.time=b},_setEndings:function(a,c,d){var b=this._interpolantSettings;d?(b.endingStart=2401,b.endingEnd=2401):(b.endingStart=a?this.zeroSlopeAtStart?2401:2400:2402,b.endingEnd=c?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(a,c,d){var b=this._mixer,e=b.time,
f=this._weightInterpolant;null===f&&(this._weightInterpolant=f=b._lendControlInterpolant());b=f.parameterPositions;f=f.sampleValues;b[0]=e;f[0]=c;b[1]=e+a;f[1]=d;return this}};Object.assign(Xd.prototype,c.prototype,{clipAction:function(a,c){var b=c||this._root,d=b.uuid,e="string"===typeof a?$a.findByName(b,a):a,b=null!==e?e.uuid:a,f=this._actionsByClip[b],g=null;if(void 0!==f){g=f.actionByRoot[d];if(void 0!==g)return g;g=f.knownActions[0];null===e&&(e=g._clip)}if(null===e)return null;e=new Wd(this,
e,c);this._bindAction(e,g);this._addInactiveAction(e,b,d);return e},existingAction:function(a,c){var b=c||this._root,d=b.uuid,b="string"===typeof a?$a.findByName(b,a):a,b=this._actionsByClip[b?b.uuid:a];return void 0!==b?b.actionByRoot[d]||null:null},stopAllAction:function(){for(var a=this._actions,c=this._nActiveActions,d=this._bindings,e=this._nActiveBindings,f=this._nActiveBindings=this._nActiveActions=0;f!==c;++f)a[f].reset();for(f=0;f!==e;++f)d[f].useCount=0;return this},update:function(a){a*=
this.timeScale;for(var b=this._actions,c=this._nActiveActions,d=this.time+=a,e=Math.sign(a),f=this._accuIndex^=1,g=0;g!==c;++g){var k=b[g];k.enabled&&k._update(d,a,e,f)}a=this._bindings;b=this._nActiveBindings;for(g=0;g!==b;++g)a[g].apply(f);return this},getRoot:function(){return this._root},uncacheClip:function(a){var b=this._actions;a=a.uuid;var c=this._actionsByClip,d=c[a];if(void 0!==d){for(var d=d.knownActions,e=0,f=d.length;e!==f;++e){var g=d[e];this._deactivateAction(g);var k=g._cacheIndex,
l=b[b.length-1];g._cacheIndex=null;g._byClipCacheIndex=null;l._cacheIndex=k;b[k]=l;b.pop();this._removeInactiveBindingsForAction(g)}delete c[a]}},uncacheRoot:function(a){a=a.uuid;var b=this._actionsByClip,c;for(c in b){var d=b[c].actionByRoot[a];void 0!==d&&(this._deactivateAction(d),this._removeInactiveAction(d))}c=this._bindingsByRootAndName[a];if(void 0!==c)for(var e in c)a=c[e],a.restoreOriginalState(),this._removeInactiveBinding(a)},uncacheAction:function(a,c){var b=this.existingAction(a,c);
null!==b&&(this._deactivateAction(b),this._removeInactiveAction(b))}});Object.assign(Xd.prototype,{_bindAction:function(a,c){var b=a._localRoot||this._root,d=a._clip.tracks,e=d.length,f=a._propertyBindings,g=a._interpolants,h=b.uuid,k=this._bindingsByRootAndName,l=k[h];void 0===l&&(l={},k[h]=l);for(k=0;k!==e;++k){var m=d[k],n=m.name,p=l[n];if(void 0===p){p=f[k];if(void 0!==p){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,h,n));continue}p=new zd(va.create(b,n,c&&c._propertyBindings[k].binding.parsedPath),
m.ValueTypeName,m.getValueSize());++p.referenceCount;this._addInactiveBinding(p,h,n)}f[k]=p;g[k].resultBuffer=p.buffer}},_activateAction:function(a){if(!this._isActiveAction(a)){if(null===a._cacheIndex){var b=(a._localRoot||this._root).uuid,c=a._clip.uuid,d=this._actionsByClip[c];this._bindAction(a,d&&d.knownActions[0]);this._addInactiveAction(a,c,b)}b=a._propertyBindings;c=0;for(d=b.length;c!==d;++c){var e=b[c];0===e.useCount++&&(this._lendBinding(e),e.saveOriginalState())}this._lendAction(a)}},
_deactivateAction:function(a){if(this._isActiveAction(a)){for(var b=a._propertyBindings,c=0,d=b.length;c!==d;++c){var e=b[c];0===--e.useCount&&(e.restoreOriginalState(),this._takeBackBinding(e))}this._takeBackAction(a)}},_initMemoryManager:function(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var a=this;this.stats={actions:{get total(){return a._actions.length},
get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}},_isActiveAction:function(a){a=a._cacheIndex;return null!==a&&a<this._nActiveActions},_addInactiveAction:function(a,c,d){var b=this._actions,e=this._actionsByClip,f=e[c];void 0===f?(f={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,e[c]=f):(c=
f.knownActions,a._byClipCacheIndex=c.length,c.push(a));a._cacheIndex=b.length;b.push(a);f.actionByRoot[d]=a},_removeInactiveAction:function(a){var b=this._actions,c=b[b.length-1],d=a._cacheIndex;c._cacheIndex=d;b[d]=c;b.pop();a._cacheIndex=null;var c=a._clip.uuid,d=this._actionsByClip,e=d[c],f=e.knownActions,g=f[f.length-1],k=a._byClipCacheIndex;g._byClipCacheIndex=k;f[k]=g;f.pop();a._byClipCacheIndex=null;delete e.actionByRoot[(b._localRoot||this._root).uuid];0===f.length&&delete d[c];this._removeInactiveBindingsForAction(a)},
_removeInactiveBindingsForAction:function(a){a=a._propertyBindings;for(var b=0,c=a.length;b!==c;++b){var d=a[b];0===--d.referenceCount&&this._removeInactiveBinding(d)}},_lendAction:function(a){var b=this._actions,c=a._cacheIndex,d=this._nActiveActions++,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_takeBackAction:function(a){var b=this._actions,c=a._cacheIndex,d=--this._nActiveActions,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_addInactiveBinding:function(a,c,d){var b=this._bindingsByRootAndName,
e=b[c],f=this._bindings;void 0===e&&(e={},b[c]=e);e[d]=a;a._cacheIndex=f.length;f.push(a)},_removeInactiveBinding:function(a){var b=this._bindings,c=a.binding,d=c.rootNode.uuid,c=c.path,e=this._bindingsByRootAndName,f=e[d],g=b[b.length-1];a=a._cacheIndex;g._cacheIndex=a;b[a]=g;b.pop();delete f[c];a:{for(var k in f)break a;delete e[d]}},_lendBinding:function(a){var b=this._bindings,c=a._cacheIndex,d=this._nActiveBindings++,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_takeBackBinding:function(a){var b=
this._bindings,c=a._cacheIndex,d=--this._nActiveBindings,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_lendControlInterpolant:function(){var a=this._controlInterpolants,c=this._nActiveControlInterpolants++,d=a[c];void 0===d&&(d=new Qc(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),d.__cacheIndex=c,a[c]=d);return d},_takeBackControlInterpolant:function(a){var b=this._controlInterpolants,c=a.__cacheIndex,d=--this._nActiveControlInterpolants,e=b[d];a.__cacheIndex=
d;b[d]=a;e.__cacheIndex=c;b[c]=e},_controlInterpolantsResultBuffer:new Float32Array(1)});Yd.prototype={constructor:Yd,onUpdate:function(a){this.dynamic=!0;this.onUpdateCallback=a;return this}};Rb.prototype=Object.create(ia.prototype);Rb.prototype.constructor=Rb;Rb.prototype.isInstancedBufferGeometry=!0;Rb.prototype.addGroup=function(a,c,d){this.groups.push({start:a,count:c,instances:d})};Rb.prototype.copy=function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var b=a.attributes,c;for(c in b)this.addAttribute(c,
b[c].clone());a=a.groups;c=0;for(b=a.length;c<b;c++){var d=a[c];this.addGroup(d.start,d.count,d.instances)}return this};Zd.prototype={constructor:Zd,isInterleavedBufferAttribute:!0,get count(){return this.data.count},get array(){return this.data.array},setX:function(a,c){this.data.array[a*this.data.stride+this.offset]=c;return this},setY:function(a,c){this.data.array[a*this.data.stride+this.offset+1]=c;return this},setZ:function(a,c){this.data.array[a*this.data.stride+this.offset+2]=c;return this},
setW:function(a,c){this.data.array[a*this.data.stride+this.offset+3]=c;return this},getX:function(a){return this.data.array[a*this.data.stride+this.offset]},getY:function(a){return this.data.array[a*this.data.stride+this.offset+1]},getZ:function(a){return this.data.array[a*this.data.stride+this.offset+2]},getW:function(a){return this.data.array[a*this.data.stride+this.offset+3]},setXY:function(a,c,d){a=a*this.data.stride+this.offset;this.data.array[a+0]=c;this.data.array[a+1]=d;return this},setXYZ:function(a,
c,d,e){a=a*this.data.stride+this.offset;this.data.array[a+0]=c;this.data.array[a+1]=d;this.data.array[a+2]=e;return this},setXYZW:function(a,c,d,e,f){a=a*this.data.stride+this.offset;this.data.array[a+0]=c;this.data.array[a+1]=d;this.data.array[a+2]=e;this.data.array[a+3]=f;return this}};mc.prototype={constructor:mc,isInterleavedBuffer:!0,set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.count=
a.count;this.stride=a.stride;this.dynamic=a.dynamic;return this},copyAt:function(a,c,d){a*=this.stride;d*=c.stride;for(var b=0,e=this.stride;b<e;b++)this.array[a+b]=c.array[d+b];return this},set:function(a,c){void 0===c&&(c=0);this.array.set(a,c);return this},clone:function(){return(new this.constructor).copy(this)}};nc.prototype=Object.create(mc.prototype);nc.prototype.constructor=nc;nc.prototype.isInstancedInterleavedBuffer=!0;nc.prototype.copy=function(a){mc.prototype.copy.call(this,a);this.meshPerAttribute=
a.meshPerAttribute;return this};oc.prototype=Object.create(P.prototype);oc.prototype.constructor=oc;oc.prototype.isInstancedBufferAttribute=!0;oc.prototype.copy=function(a){P.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};$d.prototype={constructor:$d,linePrecision:1,set:function(a,c){this.ray.set(a,c)},setFromCamera:function(a,c){c&&c.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(c.matrixWorld),this.ray.direction.set(a.x,a.y,.5).unproject(c).sub(this.ray.origin).normalize()):
c&&c.isOrthographicCamera?(this.ray.origin.set(a.x,a.y,(c.near+c.far)/(c.near-c.far)).unproject(c),this.ray.direction.set(0,0,-1).transformDirection(c.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(a,c){var b=[];ae(a,this,b,c);b.sort(ue);return b},intersectObjects:function(a,c){var b=[];if(!1===Array.isArray(a))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),b;for(var d=0,e=a.length;d<e;d++)ae(a[d],this,b,c);b.sort(ue);
return b}};be.prototype={constructor:be,start:function(){this.oldTime=this.startTime=(performance||Date).now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var c=(performance||Date).now(),a=(c-this.oldTime)/1E3;this.oldTime=c;this.elapsedTime+=a}return a}};ce.prototype={constructor:ce,set:function(a,c,d){this.radius=
a;this.phi=c;this.theta=d;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius.copy(a.radius);this.phi.copy(a.phi);this.theta.copy(a.theta);return this},makeSafe:function(){this.phi=Math.max(1E-6,Math.min(Math.PI-1E-6,this.phi));return this},setFromVector3:function(a){this.radius=a.length();0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(a.x,a.z),this.phi=Math.acos(k.Math.clamp(a.y/this.radius,-1,1)));return this}};ya.prototype=Object.create(Da.prototype);
ya.prototype.constructor=ya;ya.prototype.createAnimation=function(a,c,d,e){c={start:c,end:d,length:d-c+1,fps:e,duration:(d-c)/e,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[a]=c;this.animationsList.push(c)};ya.prototype.autoCreateAnimations=function(a){for(var b=/([a-z]+)_?(\d+)/i,c,d={},e=this.geometry,f=0,g=e.morphTargets.length;f<g;f++){var k=e.morphTargets[f].name.match(b);if(k&&1<k.length){var l=k[1];d[l]||(d[l]={start:Infinity,
end:-Infinity});k=d[l];f<k.start&&(k.start=f);f>k.end&&(k.end=f);c||(c=l)}}for(l in d)k=d[l],this.createAnimation(l,k.start,k.end,a);this.firstAnimation=c};ya.prototype.setAnimationDirectionForward=function(a){if(a=this.animationsMap[a])a.direction=1,a.directionBackwards=!1};ya.prototype.setAnimationDirectionBackward=function(a){if(a=this.animationsMap[a])a.direction=-1,a.directionBackwards=!0};ya.prototype.setAnimationFPS=function(a,c){var b=this.animationsMap[a];b&&(b.fps=c,b.duration=(b.end-b.start)/
b.fps)};ya.prototype.setAnimationDuration=function(a,c){var b=this.animationsMap[a];b&&(b.duration=c,b.fps=(b.end-b.start)/b.duration)};ya.prototype.setAnimationWeight=function(a,c){var b=this.animationsMap[a];b&&(b.weight=c)};ya.prototype.setAnimationTime=function(a,c){var b=this.animationsMap[a];b&&(b.time=c)};ya.prototype.getAnimationTime=function(a){var b=0;if(a=this.animationsMap[a])b=a.time;return b};ya.prototype.getAnimationDuration=function(a){var b=-1;if(a=this.animationsMap[a])b=a.duration;
return b};ya.prototype.playAnimation=function(a){var b=this.animationsMap[a];b?(b.time=0,b.active=!0):console.warn("THREE.MorphBlendMesh: animation["+a+"] undefined in .playAnimation()")};ya.prototype.stopAnimation=function(a){if(a=this.animationsMap[a])a.active=!1};ya.prototype.update=function(a){for(var b=0,c=this.animationsList.length;b<c;b++){var d=this.animationsList[b];if(d.active){var e=d.duration/d.length;d.time+=d.direction*a;if(d.mirroredLoop){if(d.time>d.duration||0>d.time)d.direction*=
-1,d.time>d.duration&&(d.time=d.duration,d.directionBackwards=!0),0>d.time&&(d.time=0,d.directionBackwards=!1)}else d.time%=d.duration,0>d.time&&(d.time+=d.duration);var f=d.start+k.Math.clamp(Math.floor(d.time/e),0,d.length-1),g=d.weight;f!==d.currentFrame&&(this.morphTargetInfluences[d.lastFrame]=0,this.morphTargetInfluences[d.currentFrame]=1*g,this.morphTargetInfluences[f]=0,d.lastFrame=d.currentFrame,d.currentFrame=f);e=d.time%e/e;d.directionBackwards&&(e=1-e);d.currentFrame!==d.lastFrame?(this.morphTargetInfluences[d.currentFrame]=
e*g,this.morphTargetInfluences[d.lastFrame]=(1-e)*g):this.morphTargetInfluences[d.currentFrame]=g}}};Uc.prototype=Object.create(X.prototype);Uc.prototype.constructor=Uc;Uc.prototype.isImmediateRenderObject=!0;Vc.prototype=Object.create(Ia.prototype);Vc.prototype.constructor=Vc;Vc.prototype.update=function(){var a=new g,c=new g,d=new La;return function(){var b=["a","b","c"];this.object.updateMatrixWorld(!0);d.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,f=this.geometry.attributes.position,
g=this.object.geometry;if(g&&g.isGeometry)for(var h=g.vertices,k=g.faces,l=g=0,m=k.length;l<m;l++)for(var n=k[l],p=0,q=n.vertexNormals.length;p<q;p++){var r=n.vertexNormals[p];a.copy(h[n[b[p]]]).applyMatrix4(e);c.copy(r).applyMatrix3(d).normalize().multiplyScalar(this.size).add(a);f.setXYZ(g,a.x,a.y,a.z);g+=1;f.setXYZ(g,c.x,c.y,c.z);g+=1}else if(g&&g.isBufferGeometry)for(b=g.attributes.position,h=g.attributes.normal,p=g=0,q=b.count;p<q;p++)a.set(b.getX(p),b.getY(p),b.getZ(p)).applyMatrix4(e),c.set(h.getX(p),
h.getY(p),h.getZ(p)),c.applyMatrix3(d).normalize().multiplyScalar(this.size).add(a),f.setXYZ(g,a.x,a.y,a.z),g+=1,f.setXYZ(g,c.x,c.y,c.z),g+=1;f.needsUpdate=!0;return this}}();pc.prototype=Object.create(X.prototype);pc.prototype.constructor=pc;pc.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};pc.prototype.update=function(){var a=new g,c=new g;return function(){var b=this.light.distance?this.light.distance:1E3,d=b*Math.tan(this.light.angle);this.cone.scale.set(d,
d,b);a.setFromMatrixPosition(this.light.matrixWorld);c.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(c.sub(a));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();qc.prototype=Object.create(Ia.prototype);qc.prototype.constructor=qc;qc.prototype.getBoneList=function(a){var b=[];a&&a.isBone&&b.push(a);for(var c=0;c<a.children.length;c++)b.push.apply(b,this.getBoneList(a.children[c]));return b};qc.prototype.update=function(){for(var a=this.geometry,
c=(new n).getInverse(this.root.matrixWorld),d=new n,e=0,f=0;f<this.bones.length;f++){var g=this.bones[f];g.parent&&g.parent.isBone&&(d.multiplyMatrices(c,g.matrixWorld),a.vertices[e].setFromMatrixPosition(d),d.multiplyMatrices(c,g.parent.matrixWorld),a.vertices[e+1].setFromMatrixPosition(d),e+=2)}a.verticesNeedUpdate=!0;a.computeBoundingSphere()};rc.prototype=Object.create(Da.prototype);rc.prototype.constructor=rc;rc.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};rc.prototype.update=
function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};sc.prototype=Object.create(X.prototype);sc.prototype.constructor=sc;sc.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};sc.prototype.update=function(){var a=new g;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate());
this.lightSphere.geometry.colorsNeedUpdate=!0}}();Wc.prototype=Object.create(Ia.prototype);Wc.prototype.constructor=Wc;Wc.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};Xc.prototype=Object.create(Ia.prototype);Xc.prototype.constructor=Xc;Xc.prototype.update=function(){var a=new g,c=new g,d=new La;return function(){this.object.updateMatrixWorld(!0);d.getNormalMatrix(this.object.matrixWorld);for(var b=this.object.matrixWorld,
e=this.geometry.attributes.position,f=this.object.geometry,g=f.vertices,f=f.faces,h=0,k=0,l=f.length;k<l;k++){var m=f[k],n=m.normal;a.copy(g[m.a]).add(g[m.b]).add(g[m.c]).divideScalar(3).applyMatrix4(b);c.copy(n).applyMatrix3(d).normalize().multiplyScalar(this.size).add(a);e.setXYZ(h,a.x,a.y,a.z);h+=1;e.setXYZ(h,c.x,c.y,c.z);h+=1}e.needsUpdate=!0;return this}}();tc.prototype=Object.create(X.prototype);tc.prototype.constructor=tc;tc.prototype.dispose=function(){var a=this.children[0],c=this.children[1];
a.geometry.dispose();a.material.dispose();c.geometry.dispose();c.material.dispose()};tc.prototype.update=function(){var a=new g,c=new g,d=new g;return function(){a.setFromMatrixPosition(this.light.matrixWorld);c.setFromMatrixPosition(this.light.target.matrixWorld);d.subVectors(c,a);var b=this.children[0],e=this.children[1];b.lookAt(d);b.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);e.lookAt(d);e.scale.z=d.length()}}();Yc.prototype=Object.create(Ia.prototype);Yc.prototype.constructor=
Yc;Yc.prototype.update=function(){function a(a,b,g,h){e.set(b,g,h).unproject(f);a=d[a];if(void 0!==a)for(b=0,g=a.length;b<g;b++)c.vertices[a[b]].copy(e)}var c,d,e=new g,f=new za;return function(){c=this.geometry;d=this.pointMap;f.projectionMatrix.copy(this.camera.projectionMatrix);a("c",0,0,-1);a("t",0,0,1);a("n1",-1,-1,-1);a("n2",1,-1,-1);a("n3",-1,1,-1);a("n4",1,1,-1);a("f1",-1,-1,1);a("f2",1,-1,1);a("f3",-1,1,1);a("f4",1,1,1);a("u1",.7,1.1,-1);a("u2",-.7,1.1,-1);a("u3",0,2,-1);a("cf1",-1,0,1);
a("cf2",1,0,1);a("cf3",0,-1,1);a("cf4",0,1,1);a("cn1",-1,0,-1);a("cn2",1,0,-1);a("cn3",0,-1,-1);a("cn4",0,1,-1);c.verticesNeedUpdate=!0}}();Zc.prototype=Object.create(Da.prototype);Zc.prototype.constructor=Zc;Zc.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.getCenter(this.position)};$c.prototype=Object.create(Ia.prototype);$c.prototype.constructor=$c;$c.prototype.update=function(){var a=new ra;return function(b){b&&b.isBox3?a.copy(b):a.setFromObject(b);
if(!a.isEmpty()){b=a.min;var c=a.max,d=this.geometry.attributes.position,e=d.array;e[0]=c.x;e[1]=c.y;e[2]=c.z;e[3]=b.x;e[4]=c.y;e[5]=c.z;e[6]=b.x;e[7]=b.y;e[8]=c.z;e[9]=c.x;e[10]=b.y;e[11]=c.z;e[12]=c.x;e[13]=c.y;e[14]=b.z;e[15]=b.x;e[16]=c.y;e[17]=b.z;e[18]=b.x;e[19]=b.y;e[20]=b.z;e[21]=c.x;e[22]=b.y;e[23]=b.z;d.needsUpdate=!0;this.geometry.computeBoundingSphere()}}}();var ve=new ia;ve.addAttribute("position",new Ja([0,0,0,0,1,0],3));var we=new wb(0,.5,1,5,1);we.translate(0,-.5,0);Sb.prototype=Object.create(X.prototype);
Sb.prototype.constructor=Sb;Sb.prototype.setDirection=function(){var a=new g,c;return function(b){.99999<b.y?this.quaternion.set(0,0,0,1):-.99999>b.y?this.quaternion.set(1,0,0,0):(a.set(b.z,0,-b.x).normalize(),c=Math.acos(b.y),this.quaternion.setFromAxisAngle(a,c))}}();Sb.prototype.setLength=function(a,c,d){void 0===c&&(c=.2*a);void 0===d&&(d=.2*c);this.line.scale.set(1,Math.max(0,a-c),1);this.line.updateMatrix();this.cone.scale.set(d,c,d);this.cone.position.y=a;this.cone.updateMatrix()};Sb.prototype.setColor=
function(a){this.line.material.color.copy(a);this.cone.material.color.copy(a)};Ad.prototype=Object.create(Ia.prototype);Ad.prototype.constructor=Ad;k.CatmullRomCurve3=function(){function a(){}var c=new g,d=new a,e=new a,f=new a;a.prototype.init=function(a,b,c,d){this.c0=a;this.c1=c;this.c2=-3*a+3*b-2*c-d;this.c3=2*a-2*b+c+d};a.prototype.initNonuniformCatmullRom=function(a,b,c,d,e,f,g){this.init(b,c,((b-a)/e-(c-a)/(e+f)+(c-b)/f)*f,((c-b)/f-(d-b)/(f+g)+(d-c)/g)*f)};a.prototype.initCatmullRom=function(a,
b,c,d,e){this.init(b,c,e*(c-a),e*(d-b))};a.prototype.calc=function(a){var b=a*a;return this.c0+this.c1*a+this.c2*b+this.c3*b*a};return wa.create(function(a){this.points=a||[];this.closed=!1},function(a){var b=this.points,h,k;k=b.length;2>k&&console.log("duh, you need at least 2 points");a*=k-(this.closed?0:1);h=Math.floor(a);a-=h;this.closed?h+=0<h?0:(Math.floor(Math.abs(h)/b.length)+1)*b.length:0===a&&h===k-1&&(h=k-2,a=1);var l,m,n;this.closed||0<h?l=b[(h-1)%k]:(c.subVectors(b[0],b[1]).add(b[0]),
l=c);m=b[h%k];n=b[(h+1)%k];this.closed||h+2<k?b=b[(h+2)%k]:(c.subVectors(b[k-1],b[k-2]).add(b[k-1]),b=c);if(void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var p="chordal"===this.type?.5:.25;k=Math.pow(l.distanceToSquared(m),p);h=Math.pow(m.distanceToSquared(n),p);p=Math.pow(n.distanceToSquared(b),p);1E-4>h&&(h=1);1E-4>k&&(k=h);1E-4>p&&(p=h);d.initNonuniformCatmullRom(l.x,m.x,n.x,b.x,k,h,p);e.initNonuniformCatmullRom(l.y,m.y,n.y,b.y,k,h,p);f.initNonuniformCatmullRom(l.z,m.z,
n.z,b.z,k,h,p)}else"catmullrom"===this.type&&(k=void 0!==this.tension?this.tension:.5,d.initCatmullRom(l.x,m.x,n.x,b.x,k),e.initCatmullRom(l.y,m.y,n.y,b.y,k),f.initCatmullRom(l.z,m.z,n.z,b.z,k));return new g(d.calc(a),e.calc(a),f.calc(a))})}();xe.prototype=Object.create(k.CatmullRomCurve3.prototype);var Re=wa.create(function(a){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3");this.points=void 0===a?[]:a},function(a){var b=this.points;a*=b.length-1;var c=Math.floor(a);
a-=c;var d=b[0==c?c:c-1],e=b[c],f=b[c>b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=k.CurveUtils.interpolate;return new g(c(d.x,e.x,f.x,b.x,a),c(d.y,e.y,f.y,b.y,a),c(d.z,e.z,f.z,b.z,a))});k.CubicBezierCurve3=wa.create(function(a,c,d,e){this.v0=a;this.v1=c;this.v2=d;this.v3=e},function(a){var b=k.ShapeUtils.b3;return new g(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),b(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z))});k.QuadraticBezierCurve3=
wa.create(function(a,c,d){this.v0=a;this.v1=c;this.v2=d},function(a){var b=k.ShapeUtils.b2;return new g(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y),b(a,this.v0.z,this.v1.z,this.v2.z))});k.LineCurve3=wa.create(function(a,c){this.v1=a;this.v2=c},function(a){if(1===a)return this.v2.clone();var b=new g;b.subVectors(this.v2,this.v1);b.multiplyScalar(a);b.add(this.v1);return b});Bd.prototype=Object.create(rb.prototype);Bd.prototype.constructor=Bd;k.SceneUtils={createMultiMaterialObject:function(a,
c){for(var b=new yc,d=0,e=c.length;d<e;d++)b.add(new Da(a,c[d]));return b},detach:function(a,c,d){a.applyMatrix(c.matrixWorld);c.remove(a);d.add(a)},attach:function(a,c,d){var b=new n;b.getInverse(d.matrixWorld);a.applyMatrix(b);c.remove(a);d.add(a)}};Object.assign(Na.prototype,{center:function(a){console.warn("THREE.Box2: .center() has been renamed to .getCenter().");return this.getCenter(a)},empty:function(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");return this.isEmpty()},
isIntersectionBox:function(a){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},size:function(a){console.warn("THREE.Box2: .size() has been renamed to .getSize().");return this.getSize(a)}});Object.assign(ra.prototype,{center:function(a){console.warn("THREE.Box3: .center() has been renamed to .getCenter().");return this.getCenter(a)},empty:function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()},
isIntersectionBox:function(a){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionSphere:function(a){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)},size:function(a){console.warn("THREE.Box3: .size() has been renamed to .getSize().");return this.getSize(a)}});Object.assign(lb.prototype,{center:function(a){console.warn("THREE.Line3: .center() has been renamed to .getCenter().");
return this.getCenter(a)}});Object.assign(La.prototype,{multiplyVector3:function(a){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)}});Object.assign(n.prototype,{extractPosition:function(a){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");
return this.copyPosition(a)},setRotationFromQuaternion:function(a){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(a)},multiplyVector3:function(a){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return a.applyProjection(this)},multiplyVector4:function(a){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");
return a.applyMatrix4(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},rotateAxis:function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");
return a.applyMatrix4(this)},translate:function(a){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(a){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(a){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(a){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(a,c){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")}});Object.assign(Ma.prototype,{isIntersectionLine:function(a){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");
return this.intersectsLine(a)}});Object.assign(m.prototype,{multiplyVector3:function(a){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return a.applyQuaternion(this)}});Object.assign(fb.prototype,{isIntersectionBox:function(a){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionPlane:function(a){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");
return this.intersectsPlane(a)},isIntersectionSphere:function(a){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)}});Object.assign(Qb.prototype,{extrude:function(a){console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.");return new Za(this,a)},makeGeometry:function(a){console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.");return new vb(this,a)}});Object.assign(g.prototype,
{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");
return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,c){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(c,a)}});Object.assign(X.prototype,{getChildByName:function(a){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(a)},renderDepth:function(a){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(a,
c){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(c,a)}});Object.defineProperties(X.prototype,{eulerOrder:{get:function(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function(a){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=a}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},
set:function(a){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.defineProperties(xc.prototype,{objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}});Sa.prototype.setLens=function(a,c){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");void 0!==c&&(this.filmGauge=c);this.setFocalLength(a)};Object.defineProperties(Ca.prototype,
{onlyShadow:{set:function(a){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(a){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");this.shadow.camera.fov=a}},shadowCameraLeft:{set:function(a){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=a}},shadowCameraRight:{set:function(a){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=a}},
shadowCameraTop:{set:function(a){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");this.shadow.camera.top=a}},shadowCameraBottom:{set:function(a){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");this.shadow.camera.bottom=a}},shadowCameraNear:{set:function(a){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=a}},shadowCameraFar:{set:function(a){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");
this.shadow.camera.far=a}},shadowCameraVisible:{set:function(a){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(a){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");this.shadow.bias=a}},shadowDarkness:{set:function(a){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(a){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");
this.shadow.mapSize.width=a}},shadowMapHeight:{set:function(a){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=a}}});Object.defineProperties(P.prototype,{length:{get:function(){console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count.");return this.array.length}}});Object.assign(ia.prototype,{addIndex:function(a){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(a)},addDrawCall:function(a,
c,d){void 0!==d&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.");console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(a,c)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}});
Object.defineProperties(ia.prototype,{drawcalls:{get:function(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups}}});Object.defineProperties(aa.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(a){console.warn("THREE."+this.type+": .wrapAround has been removed.")}},
wrapRGB:{get:function(){console.warn("THREE."+this.type+": .wrapRGB has been removed.");return new O}}});Object.defineProperties(xb.prototype,{metal:{get:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.");return!1},set:function(a){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(Ba.prototype,{derivatives:{get:function(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");
return this.extensions.derivatives},set:function(a){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=a}}});c.prototype=Object.assign(Object.create({constructor:c,apply:function(a){console.warn("THREE.EventDispatcher: .apply is deprecated, just inherit or Object.assign the prototype to mix-in.");Object.assign(a,this)}}),c.prototype);Object.assign(Ed.prototype,{supportsFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");
return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");
return this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return this.capabilities.vertexTextures},
supportsInstancedArrays:function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(a){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");this.setScissorTest(a)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},
addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}});Object.defineProperties(Ed.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=a}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");
this.shadowMap.type=a}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.");this.shadowMap.cullFace=a}}});Object.defineProperties(ad.prototype,{cullFace:{get:function(){return this.renderReverseSided?2:1},set:function(a){a=1!==a;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+a+".");this.renderReverseSided=a}}});Object.defineProperties(f.prototype,
{wrapS:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=a}},wrapT:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=a}},magFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");
return this.texture.magFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=a}},minFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=a}},anisotropy:{get:function(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");
return this.texture.anisotropy},set:function(a){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=a}},offset:{get:function(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function(a){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=a}},repeat:{get:function(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},
set:function(a){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=a}},format:{get:function(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function(a){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=a}},type:{get:function(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function(a){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");
this.texture.type=a}},generateMipmaps:{get:function(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set:function(a){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=a}}});Object.assign(lc.prototype,{load:function(a){console.warn("THREE.Audio: .load has been deprecated. Please use THREE.AudioLoader.");var b=this;(new Rd).load(a,function(a){b.setBuffer(a)});
return this}});Object.assign(Ud.prototype,{getData:function(a){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()}});Object.defineProperty(k,"AudioContext",{get:function(){return k.getAudioContext()}});k.WebGLRenderTargetCube=d;k.WebGLRenderTarget=f;k.WebGLRenderer=Ed;k.ShaderLib=Xb;k.UniformsLib=ka;k.ShaderChunk=ua;k.FogExp2=Ub;k.Fog=Vb;k.Scene=zb;k.LensFlare=Fd;k.Sprite=vc;k.LOD=xc;k.SkinnedMesh=gd;k.Skeleton=ed;k.Bone=fd;k.Mesh=Da;k.LineSegments=
Ia;k.Line=qb;k.Points=Yb;k.Group=yc;k.VideoTexture=hd;k.DataTexture=Bb;k.CompressedTexture=Zb;k.CubeTexture=p;k.CanvasTexture=id;k.DepthTexture=zc;k.TextureIdCount=function(){return je++};k.Texture=l;k.MaterialIdCount=function(){return oe++};k.CompressedTextureLoader=qe;k.BinaryTextureLoader=Jd;k.DataTextureLoader=Jd;k.CubeTextureLoader=Kd;k.TextureLoader=jd;k.ObjectLoader=re;k.MaterialLoader=xd;k.BufferGeometryLoader=Ld;k.LoadingManager=Id;k.JSONLoader=Md;k.ImageLoader=Pc;k.FontLoader=se;k.XHRLoader=
Ta;k.Loader=Mb;k.AudioLoader=Rd;k.SpotLightShadow=ld;k.SpotLight=md;k.PointLight=nd;k.HemisphereLight=kd;k.DirectionalLightShadow=od;k.DirectionalLight=pd;k.AmbientLight=qd;k.LightShadow=Jb;k.Light=Ca;k.StereoCamera=te;k.PerspectiveCamera=Sa;k.OrthographicCamera=eb;k.CubeCamera=yd;k.Camera=za;k.AudioListener=Sd;k.PositionalAudio=Td;k.getAudioContext=Pd;k.AudioAnalyser=Ud;k.Audio=lc;k.VectorKeyframeTrack=jc;k.StringKeyframeTrack=ud;k.QuaternionKeyframeTrack=Rc;k.NumberKeyframeTrack=kc;k.ColorKeyframeTrack=
wd;k.BooleanKeyframeTrack=vd;k.PropertyMixer=zd;k.PropertyBinding=va;k.KeyframeTrack=Lb;k.AnimationObjectGroup=Vd;k.AnimationMixer=Xd;k.AnimationClip=$a;k.Uniform=Yd;k.InstancedBufferGeometry=Rb;k.BufferGeometry=ia;k.GeometryIdCount=function(){return dd++};k.Geometry=ha;k.InterleavedBufferAttribute=Zd;k.InstancedInterleavedBuffer=nc;k.InterleavedBuffer=mc;k.InstancedBufferAttribute=oc;k.DynamicBufferAttribute=function(a,c){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");
return(new P(a,c)).setDynamic(!0)};k.Float64Attribute=function(a,c){return new P(new Float64Array(a),c)};k.Float32Attribute=Ja;k.Uint32Attribute=Wb;k.Int32Attribute=function(a,c){return new P(new Int32Array(a),c)};k.Uint16Attribute=bd;k.Int16Attribute=function(a,c){return new P(new Int16Array(a),c)};k.Uint8ClampedAttribute=function(a,c){return new P(new Uint8ClampedArray(a),c)};k.Uint8Attribute=function(a,c){return new P(new Uint8Array(a),c)};k.Int8Attribute=function(a,c){return new P(new Int8Array(a),
c)};k.BufferAttribute=P;k.Face3=sa;k.Object3DIdCount=function(){return pe++};k.Object3D=X;k.Raycaster=$d;k.Layers=Tb;k.EventDispatcher=c;k.Clock=be;k.QuaternionLinearInterpolant=td;k.LinearInterpolant=Qc;k.DiscreteInterpolant=sd;k.CubicInterpolant=rd;k.Interpolant=Ua;k.Triangle=Qa;k.Spline=function(a){function b(a,b,c,d,e,f,g){a=.5*(c-a);d=.5*(d-b);return(2*(b-c)+a+d)*g+(-3*(b-c)-2*a-d)*f+a*e+b}this.points=a;var c=[],d={x:0,y:0,z:0},e,f,k,l,m,n,p,q,t;this.initFromArray=function(a){this.points=[];
for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}};this.getPoint=function(a){e=(this.points.length-1)*a;f=Math.floor(e);k=e-f;c[0]=0===f?f:f-1;c[1]=f;c[2]=f>this.points.length-2?this.points.length-1:f+1;c[3]=f>this.points.length-3?this.points.length-1:f+2;n=this.points[c[0]];p=this.points[c[1]];q=this.points[c[2]];t=this.points[c[3]];l=k*k;m=k*l;d.x=b(n.x,p.x,q.x,t.x,k,l,m);d.y=b(n.y,p.y,q.y,t.y,k,l,m);d.z=b(n.z,p.z,q.z,t.z,k,l,m);return d};this.getControlPointsArray=function(){var a,
b,c=this.points.length,d=[];for(a=0;a<c;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return d};this.getLength=function(a){var b,c,d,e=0,f=new g,h=new g,k=[],l=0;k[0]=0;a||(a=100);c=this.points.length*a;f.copy(this.points[0]);for(a=1;a<c;a++)b=a/c,d=this.getPoint(b),h.copy(d),l+=h.distanceTo(f),f.copy(d),b*=this.points.length-1,b=Math.floor(b),b!==e&&(k[b]=l,e=b);k[k.length]=l;return{chunks:k,total:l}};this.reparametrizeByArcLength=function(a){var b,c,d,e,f,h,k=[],l=new g,m=this.getLength();k.push(l.copy(this.points[0]).clone());
for(b=1;b<this.points.length;b++){c=m.chunks[b]-m.chunks[b-1];h=Math.ceil(a*c/m.total);e=(b-1)/(this.points.length-1);f=b/(this.points.length-1);for(c=1;c<h-1;c++)d=e+1/h*c*(f-e),d=this.getPoint(d),k.push(l.copy(d).clone());k.push(l.copy(this.points[b]).clone())}this.points=k}};k.Spherical=ce;k.Plane=Ma;k.Frustum=yb;k.Sphere=Oa;k.Ray=fb;k.Matrix4=n;k.Matrix3=La;k.Box3=ra;k.Box2=Na;k.Line3=lb;k.Euler=gb;k.Vector4=a;k.Vector3=g;k.Vector2=e;k.Quaternion=m;k.Color=O;k.MorphBlendMesh=ya;k.ImmediateRenderObject=
Uc;k.VertexNormalsHelper=Vc;k.SpotLightHelper=pc;k.SkeletonHelper=qc;k.PointLightHelper=rc;k.HemisphereLightHelper=sc;k.GridHelper=Wc;k.FaceNormalsHelper=Xc;k.DirectionalLightHelper=tc;k.CameraHelper=Yc;k.BoundingBoxHelper=Zc;k.BoxHelper=$c;k.ArrowHelper=Sb;k.AxisHelper=Ad;k.ClosedSplineCurve3=xe;k.SplineCurve3=Re;k.ArcCurve=Bd;k.EllipseCurve=rb;k.SplineCurve=Nb;k.CubicBezierCurve=Ob;k.QuadraticBezierCurve=Pb;k.LineCurve=kb;k.Shape=Qb;k.ShapePath=Nd;k.Path=Tc;k.Font=Od;k.CurvePath=Sc;k.Curve=wa;k.WireframeGeometry=
$b;k.ParametricGeometry=Ac;k.TetrahedronGeometry=Bc;k.OctahedronGeometry=Cc;k.IcosahedronGeometry=Dc;k.DodecahedronGeometry=Ec;k.PolyhedronGeometry=Ya;k.TubeGeometry=Xa;k.TorusKnotGeometry=Fc;k.TorusKnotBufferGeometry=ac;k.TorusGeometry=Gc;k.TorusBufferGeometry=bc;k.TextGeometry=Hc;k.SphereBufferGeometry=Cb;k.SphereGeometry=cc;k.RingGeometry=Ic;k.RingBufferGeometry=dc;k.PlaneBufferGeometry=ab;k.PlaneGeometry=Jc;k.LatheGeometry=Kc;k.LatheBufferGeometry=ec;k.ShapeGeometry=vb;k.ExtrudeGeometry=Za;k.EdgesGeometry=
fc;k.ConeGeometry=Lc;k.ConeBufferGeometry=Mc;k.CylinderGeometry=Db;k.CylinderBufferGeometry=wb;k.CircleBufferGeometry=gc;k.CircleGeometry=Nc;k.BoxBufferGeometry=hb;k.BoxGeometry=Eb;k.ShadowMaterial=hc;k.SpriteMaterial=Ab;k.RawShaderMaterial=ic;k.ShaderMaterial=Ba;k.PointsMaterial=Va;k.MultiMaterial=Oc;k.MeshPhysicalMaterial=Fb;k.MeshStandardMaterial=jb;k.MeshPhongMaterial=xb;k.MeshNormalMaterial=Gb;k.MeshLambertMaterial=Hb;k.MeshDepthMaterial=Aa;k.MeshBasicMaterial=Pa;k.LineDashedMaterial=Ib;k.LineBasicMaterial=
Ha;k.Material=aa;k.REVISION="81";k.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};k.CullFaceNone=0;k.CullFaceBack=1;k.CullFaceFront=2;k.CullFaceFrontBack=3;k.FrontFaceDirectionCW=0;k.FrontFaceDirectionCCW=1;k.BasicShadowMap=0;k.PCFShadowMap=1;k.PCFSoftShadowMap=2;k.FrontSide=0;k.BackSide=1;k.DoubleSide=2;k.FlatShading=1;k.SmoothShading=2;k.NoColors=0;k.FaceColors=1;k.VertexColors=2;k.NoBlending=0;k.NormalBlending=1;k.AdditiveBlending=2;k.SubtractiveBlending=3;k.MultiplyBlending=4;k.CustomBlending=5;k.BlendingMode=
ye;k.AddEquation=100;k.SubtractEquation=101;k.ReverseSubtractEquation=102;k.MinEquation=103;k.MaxEquation=104;k.ZeroFactor=200;k.OneFactor=201;k.SrcColorFactor=202;k.OneMinusSrcColorFactor=203;k.SrcAlphaFactor=204;k.OneMinusSrcAlphaFactor=205;k.DstAlphaFactor=206;k.OneMinusDstAlphaFactor=207;k.DstColorFactor=208;k.OneMinusDstColorFactor=209;k.SrcAlphaSaturateFactor=210;k.NeverDepth=0;k.AlwaysDepth=1;k.LessDepth=2;k.LessEqualDepth=3;k.EqualDepth=4;k.GreaterEqualDepth=5;k.GreaterDepth=6;k.NotEqualDepth=
7;k.MultiplyOperation=0;k.MixOperation=1;k.AddOperation=2;k.NoToneMapping=0;k.LinearToneMapping=1;k.ReinhardToneMapping=2;k.Uncharted2ToneMapping=3;k.CineonToneMapping=4;k.UVMapping=300;k.CubeReflectionMapping=301;k.CubeRefractionMapping=302;k.EquirectangularReflectionMapping=303;k.EquirectangularRefractionMapping=304;k.SphericalReflectionMapping=305;k.CubeUVReflectionMapping=306;k.CubeUVRefractionMapping=307;k.TextureMapping=ze;k.RepeatWrapping=1E3;k.ClampToEdgeWrapping=1001;k.MirroredRepeatWrapping=
1002;k.TextureWrapping=de;k.NearestFilter=1003;k.NearestMipMapNearestFilter=1004;k.NearestMipMapLinearFilter=1005;k.LinearFilter=1006;k.LinearMipMapNearestFilter=1007;k.LinearMipMapLinearFilter=1008;k.TextureFilter=ee;k.UnsignedByteType=1009;k.ByteType=1010;k.ShortType=1011;k.UnsignedShortType=1012;k.IntType=1013;k.UnsignedIntType=1014;k.FloatType=1015;k.HalfFloatType=1016;k.UnsignedShort4444Type=1017;k.UnsignedShort5551Type=1018;k.UnsignedShort565Type=1019;k.UnsignedInt248Type=1020;k.AlphaFormat=
1021;k.RGBFormat=1022;k.RGBAFormat=1023;k.LuminanceFormat=1024;k.LuminanceAlphaFormat=1025;k.RGBEFormat=1023;k.DepthFormat=1026;k.DepthStencilFormat=1027;k.RGB_S3TC_DXT1_Format=2001;k.RGBA_S3TC_DXT1_Format=2002;k.RGBA_S3TC_DXT3_Format=2003;k.RGBA_S3TC_DXT5_Format=2004;k.RGB_PVRTC_4BPPV1_Format=2100;k.RGB_PVRTC_2BPPV1_Format=2101;k.RGBA_PVRTC_4BPPV1_Format=2102;k.RGBA_PVRTC_2BPPV1_Format=2103;k.RGB_ETC1_Format=2151;k.LoopOnce=2200;k.LoopRepeat=2201;k.LoopPingPong=2202;k.InterpolateDiscrete=2300;k.InterpolateLinear=
2301;k.InterpolateSmooth=2302;k.ZeroCurvatureEnding=2400;k.ZeroSlopeEnding=2401;k.WrapAroundEnding=2402;k.TrianglesDrawMode=0;k.TriangleStripDrawMode=1;k.TriangleFanDrawMode=2;k.LinearEncoding=3E3;k.sRGBEncoding=3001;k.GammaEncoding=3007;k.RGBEEncoding=3002;k.LogLuvEncoding=3003;k.RGBM7Encoding=3004;k.RGBM16Encoding=3005;k.RGBDEncoding=3006;k.BasicDepthPacking=3200;k.RGBADepthPacking=3201;k.CubeGeometry=Eb;k.Face4=function(a,c,d,e,f,g,k){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");
return new sa(a,c,d,f,g,k)};k.LineStrip=0;k.LinePieces=1;k.MeshFaceMaterial=Oc;k.PointCloud=function(a,c){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new Yb(a,c)};k.Particle=vc;k.ParticleSystem=function(a,c){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new Yb(a,c)};k.PointCloudMaterial=function(a){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new Va(a)};k.ParticleBasicMaterial=function(a){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");
return new Va(a)};k.ParticleSystemMaterial=function(a){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new Va(a)};k.Vertex=function(a,c,d){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");return new g(a,c,d)};k.EdgesHelper=function(a,c){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.");return new Ia(new fc(a.geometry),new Ha({color:void 0!==c?c:16777215}))};k.WireframeHelper=function(a,c){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.");
return new Ia(new $b(a.geometry),new Ha({color:void 0!==c?c:16777215}))};k.GeometryUtils={merge:function(a,c,d){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var b;c.isMesh&&(c.matrixAutoUpdate&&c.updateMatrix(),b=c.matrix,c=c.geometry);a.merge(c,b,d)},center:function(a){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return a.center()}};k.ImageUtils=
{crossOrigin:void 0,loadTexture:function(a,c,d,e){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var b=new jd;b.setCrossOrigin(this.crossOrigin);a=b.load(a,d,void 0,e);c&&(a.mapping=c);return a},loadTextureCube:function(a,c,d,e){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var b=new Kd;b.setCrossOrigin(this.crossOrigin);a=b.load(a,d,void 0,e);c&&(a.mapping=c);return a},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},
loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};k.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(a,c){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(c)};this.unprojectVector=function(a,c){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(c)};
this.pickingRay=function(a,c){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};k.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};Object.defineProperty(k,"__esModule",{value:!0})});
Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(k){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var k=document.createElement("div");k.id="webgl-error-message";k.style.fontFamily="monospace";k.style.fontSize="13px";k.style.fontWeight="normal";k.style.textAlign="center";k.style.background=
"#fff";k.style.color="#000";k.style.padding="1.5em";k.style.width="400px";k.style.margin="5em auto 0";this.webgl||(k.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return k},addGetWebGLMessage:function(k){var c,e;k=k||{};c=void 0!==k.parent?k.parent:document.body;k=void 0!==k.id?k.id:"oldie";e=Detector.getWebGLErrorMessage();e.id=k;c.appendChild(e)}};
function TimeSeries(k){k=k||{};k.resetBoundsInterval=k.resetBoundsInterval||3E3;k.resetBounds=void 0===k.resetBounds?!0:k.resetBounds;this.options=k;this.data=[];this.label=k.label||"";this.maxDataLength=k.maxDataLength||1E3;this.dataPool=[];this.minValue=this.maxValue=Number.NaN;k.resetBounds&&(this.boundsTimer=setInterval(function(c){return function(){c.resetBounds()}}(this),k.resetBoundsInterval))}
TimeSeries.prototype.resetBounds=function(){this.minValue=this.maxValue=Number.NaN;for(var k=0;k<this.data.length;k++)this.maxValue=isNaN(this.maxValue)?this.data[k][1]:Math.max(this.maxValue,this.data[k][1]),this.minValue=isNaN(this.minValue)?this.data[k][1]:Math.min(this.minValue,this.data[k][1])};
TimeSeries.prototype.append=function(k,c){this.lastTimeStamp=k;var e=this.dataPool.length?this.dataPool.pop():[k,c];e[0]=k;e[1]=c;this.data.push(e);this.maxValue=isNaN(this.maxValue)?c:Math.max(this.maxValue,c);for(this.minValue=isNaN(this.minValue)?c:Math.min(this.minValue,c);this.data.length>this.maxDataLength;)this.dataPool.push(this.data.shift())};
function SmoothieChart(k){k=k||{};k.grid=k.grid||{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:1,millisPerLine:1E3,verticalSections:2};k.millisPerPixel=k.millisPerPixel||20;k.fps=k.fps||50;k.maxValueScale=k.maxValueScale||1;k.minValue=k.minValue;k.maxValue=k.maxValue;k.labels=k.labels||{fillStyle:"#ffffff"};k.interpolation=k.interpolation||"bezier";k.scaleSmoothing=k.scaleSmoothing||.125;k.maxDataSetLength=k.maxDataSetLength||2;k.timestampFormatter=k.timestampFormatter||null;this.options=k;
this.seriesSet=[];this.currentValueRange=1;this.currentVisMinValue=0}SmoothieChart.prototype.addTimeSeries=function(k,c){this.seriesSet.push({timeSeries:k,options:c||{}})};SmoothieChart.prototype.removeTimeSeries=function(k){this.seriesSet.splice(this.seriesSet.indexOf(k),1)};SmoothieChart.prototype.streamTo=function(k,c){var e=this;this.render_on_tick=function(){e.render(k,e.seriesSet[0].timeSeries.lastTimeStamp)};this.start()};
SmoothieChart.prototype.start=function(){this.timer||(this.timer=setInterval(this.render_on_tick,1E3/this.options.fps))};SmoothieChart.prototype.stop=function(){this.timer&&(clearInterval(this.timer),this.timer=void 0)};SmoothieChart.timeFormatter=function(k){function c(c){return(10>c?"0":"")+c}return c(k.getHours())+":"+c(k.getMinutes())+":"+c(k.getSeconds())};
SmoothieChart.prototype.render=function(k,c){var e=k.getContext("2d"),l=this.options,a=k.clientWidth,f=k.clientHeight;e.save();c-=c%l.millisPerPixel;e.translate(0,0);e.beginPath();e.rect(0,0,a,f);e.clip();e.save();e.fillStyle=l.grid.fillStyle;e.clearRect(0,0,a,f);e.fillRect(0,0,a,f);e.restore();e.save();e.lineWidth=l.grid.lineWidth||1;e.strokeStyle=l.grid.strokeStyle||"#ffffff";if(0<l.grid.millisPerLine)for(var d=c-c%l.grid.millisPerLine;d>=c-a*l.millisPerPixel;d-=l.grid.millisPerLine){e.beginPath();
var m=Math.round(a-(c-d)/l.millisPerPixel);e.moveTo(m,0);e.lineTo(m,f);e.stroke();if(l.timestampFormatter){var g=l.timestampFormatter(new Date(d)),n=e.measureText(g).width/2+e.measureText(B).width+4;m<a-n&&(e.fillStyle=l.labels.fillStyle,e.fillText(g,m-e.measureText(g).width/2,f-2))}e.closePath()}for(B=1;B<l.grid.verticalSections;B++)d=Math.round(B*f/l.grid.verticalSections),e.beginPath(),e.moveTo(0,d),e.lineTo(a,d),e.stroke(),e.closePath();e.beginPath();e.strokeRect(0,0,a,f);e.closePath();e.restore();
B=m=Number.NaN;for(g=0;g<this.seriesSet.length;g++){var p=this.seriesSet[g].timeSeries;isNaN(p.maxValue)||(m=isNaN(m)?p.maxValue:Math.max(m,p.maxValue));isNaN(p.minValue)||(B=isNaN(B)?p.minValue:Math.min(B,p.minValue))}if(!isNaN(m)||!isNaN(B)){m=null!=l.maxValue?l.maxValue:m*l.maxValueScale;null!=l.minValue&&(B=l.minValue);this.currentValueRange+=l.scaleSmoothing*(m-B-this.currentValueRange);this.currentVisMinValue+=l.scaleSmoothing*(B-this.currentVisMinValue);for(var n=this.currentValueRange,u=this.currentVisMinValue,
g=0;g<this.seriesSet.length;g++){e.save();for(var p=this.seriesSet[g].timeSeries,p=p.data,q=this.seriesSet[g].options;p.length>=l.maxDataSetLength&&p[1][0]<c-a*l.millisPerPixel;)p.splice(0,1);e.lineWidth=q.lineWidth||1;e.fillStyle=q.fillStyle;e.strokeStyle=q.strokeStyle||"#ffffff";e.beginPath();for(var t=0,y=0,w=0,d=0;d<p.length;d++){var C=Math.round(a-(c-p[d][0])/l.millisPerPixel),x=p[d][1]-u,x=Math.max(Math.min(f-(n?Math.round(x/n*f):0),f-1),1);if(0==d)t=C,e.moveTo(C,x);else switch(l.interpolation){case "line":e.lineTo(C,
x);break;default:e.bezierCurveTo(Math.round((y+C)/2),w,Math.round(y+C)/2,x,C,x)}y=C;w=x}0<p.length&&q.fillStyle&&(e.lineTo(a+q.lineWidth+1,w),e.lineTo(a+q.lineWidth+1,f+q.lineWidth+1),e.lineTo(t,f+q.lineWidth),e.fill());e.stroke();e.closePath();e.restore()}if(!l.labels.disabled){l.labelOffsetY||(l.labelOffsetY=0);e.fillStyle=l.labels.fillStyle;var d=parseFloat(m).toFixed(2),B=parseFloat(B).toFixed(2);e.fillText(d,a-e.measureText(d).width-2,10);e.fillText(B,a-e.measureText(B).width-2,f-2);for(d=0;d<
this.seriesSet.length;d++)p=this.seriesSet[d].timeSeries,a=p.label,e.fillStyle=p.options.fillStyle||"rgb(255,255,255)",a&&e.fillText(a,2,10*(d+1)+l.labelOffsetY)}}e.restore()};
var Stats=function(){var k,c,e=0,l=0,a=Date.now(),f=a,d=a,m=0,g=1E3,n=0,p,u,q,t=[[16,16,48],[0,255,255]],y=0,w=1E3,C=0,x,B,G,E=[[16,48,16],[0,255,0]];k=document.createElement("div");k.style.cursor="pointer";k.style.width="80px";k.style.opacity="0.9";k.style.zIndex="10001";k.addEventListener("mousedown",function(a){a.preventDefault();e=(e+1)%2;0==e?(p.style.display="block",x.style.display="none"):(p.style.display="none",x.style.display="block")},!1);p=document.createElement("div");p.style.textAlign=
"left";p.style.lineHeight="1.2em";p.style.backgroundColor="rgb("+Math.floor(t[0][0]/2)+","+Math.floor(t[0][1]/2)+","+Math.floor(t[0][2]/2)+")";p.style.padding="0 0 3px 3px";k.appendChild(p);u=document.createElement("div");u.style.fontFamily="Helvetica, Arial, sans-serif";u.style.fontSize="9px";u.style.color="rgb("+t[1][0]+","+t[1][1]+","+t[1][2]+")";u.style.fontWeight="bold";u.innerHTML="FPS";p.appendChild(u);q=document.createElement("div");q.style.position="relative";q.style.width="74px";q.style.height=
"30px";q.style.backgroundColor="rgb("+t[1][0]+","+t[1][1]+","+t[1][2]+")";for(p.appendChild(q);74>q.children.length;)c=document.createElement("span"),c.style.width="1px",c.style.height="30px",c.style.cssFloat="left",c.style.backgroundColor="rgb("+t[0][0]+","+t[0][1]+","+t[0][2]+")",q.appendChild(c);x=document.createElement("div");x.style.textAlign="left";x.style.lineHeight="1.2em";x.style.backgroundColor="rgb("+Math.floor(E[0][0]/2)+","+Math.floor(E[0][1]/2)+","+Math.floor(E[0][2]/2)+")";x.style.padding=
"0 0 3px 3px";x.style.display="none";k.appendChild(x);B=document.createElement("div");B.style.fontFamily="Helvetica, Arial, sans-serif";B.style.fontSize="9px";B.style.color="rgb("+E[1][0]+","+E[1][1]+","+E[1][2]+")";B.style.fontWeight="bold";B.innerHTML="MS";x.appendChild(B);G=document.createElement("div");G.style.position="relative";G.style.width="74px";G.style.height="30px";G.style.backgroundColor="rgb("+E[1][0]+","+E[1][1]+","+E[1][2]+")";for(x.appendChild(G);74>G.children.length;)c=document.createElement("span"),
c.style.width="1px",c.style.height=30*Math.random()+"px",c.style.cssFloat="left",c.style.backgroundColor="rgb("+E[0][0]+","+E[0][1]+","+E[0][2]+")",G.appendChild(c);return{domElement:k,update:function(){a=Date.now();y=a-f;w=Math.min(w,y);C=Math.max(C,y);B.textContent=y+" MS ("+w+"-"+C+")";var c=Math.min(30,30-y/200*30);G.appendChild(G.firstChild).style.height=c+"px";f=a;l++;a>d+1E3&&(m=Math.round(1E3*l/(a-d)),g=Math.min(g,m),n=Math.max(n,m),u.textContent=m+" FPS ("+g+"-"+n+")",c=Math.min(30,30-m/
100*30),q.appendChild(q.firstChild).style.height=c+"px",d=a,l=0)}}};
THREE.TrackballControls=function(k,c){function e(a){!1!==d.enabled&&(window.removeEventListener("keydown",e),p=n,n===m.NONE)&&(a.keyCode!==d.keys[m.ROTATE]||d.noRotate?a.keyCode!==d.keys[m.ZOOM]||d.noZoom?a.keyCode!==d.keys[m.PAN]||d.noPan||(n=m.PAN):n=m.ZOOM:n=m.ROTATE)}function l(a){!1!==d.enabled&&(a.preventDefault(),a.stopPropagation(),n!==m.ROTATE||d.noRotate?n!==m.ZOOM||d.noZoom?n!==m.PAN||d.noPan||G.copy(K(a.pageX,a.pageY)):w.copy(K(a.pageX,a.pageY)):t.copy(N(a.pageX,a.pageY)))}function a(c){!1!==
d.enabled&&(c.preventDefault(),c.stopPropagation(),n=m.NONE,document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",a),d.dispatchEvent(I))}function f(a){if(!1!==d.enabled){a.preventDefault();a.stopPropagation();var c=0;a.wheelDelta?c=a.wheelDelta/40:a.detail&&(c=-a.detail/3);y.y+=.01*c;d.dispatchEvent(R);d.dispatchEvent(I)}}var d=this,m={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=k;this.domElement=void 0!==c?c:document;this.enabled=!0;this.screen=
{left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.staticMoving=this.noRoll=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3;var g=new THREE.Vector3,n=m.NONE,p=m.NONE,u=new THREE.Vector3,q=new THREE.Vector3,t=new THREE.Vector3,y=new THREE.Vector2,w=new THREE.Vector2,C=0,x=0,B=new THREE.Vector2,G=new THREE.Vector2;this.target0=this.target.clone();
this.position0=this.object.position.clone();this.up0=this.object.up.clone();var E={type:"change"},R={type:"start"},I={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),c=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-c.clientLeft;this.screen.top=a.top+window.pageYOffset-c.clientTop;
this.screen.width=a.width;this.screen.height=a.height}};this.handleEvent=function(a){if("function"==typeof this[a.type])this[a.type](a)};var K=function(){var a=new THREE.Vector2;return function(c,e){a.set((c-d.screen.left)/d.screen.width,(e-d.screen.top)/d.screen.height);return a}}(),N=function(){var a=new THREE.Vector3,c=new THREE.Vector3,e=new THREE.Vector3;return function(f,g){e.set((f-.5*d.screen.width-d.screen.left)/(.5*d.screen.width),(.5*d.screen.height+d.screen.top-g)/(.5*d.screen.height),
0);var k=e.length();d.noRoll?e.z=k<Math.SQRT1_2?Math.sqrt(1-k*k):.5/k:1<k?e.normalize():e.z=Math.sqrt(1-k*k);u.copy(d.object.position).sub(d.target);a.copy(d.object.up).setLength(e.y);a.add(c.copy(d.object.up).cross(u).setLength(e.x));a.add(u.setLength(e.z));return a}}();this.rotateCamera=function(){var a=new THREE.Vector3,c=new THREE.Quaternion;return function(){var e=Math.acos(q.dot(t)/q.length()/t.length());e&&(a.crossVectors(q,t).normalize(),e*=d.rotateSpeed,c.setFromAxisAngle(a,-e),u.applyQuaternion(c),
d.object.up.applyQuaternion(c),t.applyQuaternion(c),d.staticMoving?q.copy(t):(c.setFromAxisAngle(a,e*(d.dynamicDampingFactor-1)),q.applyQuaternion(c)))}}();this.zoomCamera=function(){if(n===m.TOUCH_ZOOM_PAN){var a=C/x;C=x;u.multiplyScalar(a)}else a=1+(w.y-y.y)*d.zoomSpeed,1!==a&&0<a&&(u.multiplyScalar(a),d.staticMoving?y.copy(w):y.y+=(w.y-y.y)*this.dynamicDampingFactor)};this.panCamera=function(){var a=new THREE.Vector2,c=new THREE.Vector3,e=new THREE.Vector3;return function(){a.copy(G).sub(B);a.lengthSq()&&
(a.multiplyScalar(u.length()*d.panSpeed),e.copy(u).cross(d.object.up).setLength(a.x),e.add(c.copy(d.object.up).setLength(a.y)),d.object.position.add(e),d.target.add(e),d.staticMoving?B.copy(G):B.add(a.subVectors(G,B).multiplyScalar(d.dynamicDampingFactor)))}}();this.checkDistances=function(){d.noZoom&&d.noPan||(u.lengthSq()>d.maxDistance*d.maxDistance&&d.object.position.addVectors(d.target,u.setLength(d.maxDistance)),u.lengthSq()<d.minDistance*d.minDistance&&d.object.position.addVectors(d.target,
u.setLength(d.minDistance)))};this.update=function(){u.subVectors(d.object.position,d.target);d.noRotate||d.rotateCamera();d.noZoom||d.zoomCamera();d.noPan||d.panCamera();d.object.position.addVectors(d.target,u);d.checkDistances();d.object.lookAt(d.target);1E-6<g.distanceToSquared(d.object.position)&&(d.dispatchEvent(E),g.copy(d.object.position))};this.reset=function(){p=n=m.NONE;d.target.copy(d.target0);d.object.position.copy(d.position0);d.object.up.copy(d.up0);u.subVectors(d.object.position,d.target);
d.object.lookAt(d.target);d.dispatchEvent(E);g.copy(d.object.position)};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(c){!1!==d.enabled&&(c.preventDefault(),c.stopPropagation(),n===m.NONE&&(n=c.button),n!==m.ROTATE||d.noRotate?n!==m.ZOOM||d.noZoom?n!==m.PAN||d.noPan||(B.copy(K(c.pageX,c.pageY)),G.copy(B)):(y.copy(K(c.pageX,c.pageY)),w.copy(y)):(q.copy(N(c.pageX,c.pageY)),t.copy(q)),document.addEventListener("mousemove",
l,!1),document.addEventListener("mouseup",a,!1),d.dispatchEvent(R))},!1);this.domElement.addEventListener("mousewheel",f,!1);this.domElement.addEventListener("DOMMouseScroll",f,!1);this.domElement.addEventListener("touchstart",function(a){if(!1!==d.enabled){switch(a.touches.length){case 1:n=m.TOUCH_ROTATE;q.copy(N(a.touches[0].pageX,a.touches[0].pageY));t.copy(q);break;case 2:n=m.TOUCH_ZOOM_PAN;var c=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY;x=C=Math.sqrt(c*c+e*
e);B.copy(K((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));G.copy(B);break;default:n=m.NONE}d.dispatchEvent(R)}},!1);this.domElement.addEventListener("touchend",function(a){if(!1!==d.enabled){switch(a.touches.length){case 1:t.copy(N(a.touches[0].pageX,a.touches[0].pageY));q.copy(t);break;case 2:C=x=0,G.copy(K((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2)),B.copy(G)}n=m.NONE;d.dispatchEvent(I)}},!1);this.domElement.addEventListener("touchmove",
function(a){if(!1!==d.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:t.copy(N(a.touches[0].pageX,a.touches[0].pageY));break;case 2:var c=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY;x=Math.sqrt(c*c+e*e);G.copy(K((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));break;default:n=m.NONE}},!1);window.addEventListener("keydown",e,!1);window.addEventListener("keyup",function(a){!1!==d.enabled&&(n=p,window.addEventListener("keydown",
e,!1))},!1);this.handleResize();this.update()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);var dat=dat||{};dat.gui=dat.gui||{};dat.utils=dat.utils||{};dat.controllers=dat.controllers||{};dat.dom=dat.dom||{};dat.color=dat.color||{};
dat.utils.css=function(){return{load:function(k,c){c=c||document;var e=c.createElement("link");e.type="text/css";e.rel="stylesheet";e.href=k;c.getElementsByTagName("head")[0].appendChild(e)},inject:function(k,c){c=c||document;var e=document.createElement("style");e.type="text/css";e.innerHTML=k;c.getElementsByTagName("head")[0].appendChild(e)}}}();
dat.utils.common=function(){var k=Array.prototype.forEach,c=Array.prototype.slice;return{BREAK:{},extend:function(e){this.each(c.call(arguments,1),function(c){for(var a in c)this.isUndefined(c[a])||(e[a]=c[a])},this);return e},defaults:function(e){this.each(c.call(arguments,1),function(c){for(var a in c)this.isUndefined(e[a])&&(e[a]=c[a])},this);return e},compose:function(){var e=c.call(arguments);return function(){for(var k=c.call(arguments),a=e.length-1;0<=a;a--)k=[e[a].apply(this,k)];return k[0]}},
each:function(c,l,a){if(k&&c.forEach===k)c.forEach(l,a);else if(c.length===c.length+0)for(var e=0,d=c.length;e<d&&!(e in c&&l.call(a,c[e],e)===this.BREAK);e++);else for(e in c)if(l.call(a,c[e],e)===this.BREAK)break},defer:function(c){setTimeout(c,0)},toArray:function(e){return e.toArray?e.toArray():c.call(e)},isUndefined:function(c){return void 0===c},isNull:function(c){return null===c},isNaN:function(c){return c!==c},isArray:Array.isArray||function(c){return c.constructor===Array},isObject:function(c){return c===
Object(c)},isNumber:function(c){return c===c+0},isString:function(c){return c===c+""},isBoolean:function(c){return!1===c||!0===c},isFunction:function(c){return"[object Function]"===Object.prototype.toString.call(c)}}}();
dat.controllers.Controller=function(k){var c=function(c,k){this.initialValue=c[k];this.domElement=document.createElement("div");this.object=c;this.property=k;this.__onFinishChange=this.__onChange=void 0};k.extend(c.prototype,{onChange:function(c){this.__onChange=c;return this},onFinishChange:function(c){this.__onFinishChange=c;return this},setValue:function(c){this.object[this.property]=c;this.__onChange&&this.__onChange.call(this,c);this.updateDisplay();return this},getValue:function(){return this.object[this.property]},
updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}});return c}(dat.utils.common);
dat.dom.dom=function(k){function c(a){if("0"===a||k.isUndefined(a))return 0;a=a.match(l);return k.isNull(a)?0:parseFloat(a[1])}var e={};k.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(a,c){k.each(a,function(a){e[a]=c})});var l=/(\d+(\.\d+)?)px/,a={makeSelectable:function(a,c){void 0!==a&&void 0!==a.style&&(a.onselectstart=c?function(){return!1}:function(){},a.style.MozUserSelect=c?"auto":"none",a.style.KhtmlUserSelect=
c?"auto":"none",a.unselectable=c?"on":"off")},makeFullscreen:function(a,c,e){k.isUndefined(c)&&(c=!0);k.isUndefined(e)&&(e=!0);a.style.position="absolute";c&&(a.style.left=0,a.style.right=0);e&&(a.style.top=0,a.style.bottom=0)},fakeEvent:function(a,c,l,g){l=l||{};var d=e[c];if(!d)throw Error("Event type "+c+" not supported.");var f=document.createEvent(d);switch(d){case "MouseEvents":f.initMouseEvent(c,l.bubbles||!1,l.cancelable||!0,window,l.clickCount||1,0,0,l.x||l.clientX||0,l.y||l.clientY||0,!1,
!1,!1,!1,0,null);break;case "KeyboardEvents":d=f.initKeyboardEvent||f.initKeyEvent;k.defaults(l,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0});d(c,l.bubbles||!1,l.cancelable,window,l.ctrlKey,l.altKey,l.shiftKey,l.metaKey,l.keyCode,l.charCode);break;default:f.initEvent(c,l.bubbles||!1,l.cancelable||!0)}k.defaults(f,g);a.dispatchEvent(f)},bind:function(c,d,e,g){c.addEventListener?c.addEventListener(d,e,g||!1):c.attachEvent&&c.attachEvent("on"+d,e);return a},
unbind:function(c,d,e,g){c.removeEventListener?c.removeEventListener(d,e,g||!1):c.detachEvent&&c.detachEvent("on"+d,e);return a},addClass:function(c,d){if(void 0===c.className)c.className=d;else if(c.className!==d){var e=c.className.split(/ +/);-1==e.indexOf(d)&&(e.push(d),c.className=e.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return a},removeClass:function(c,d){if(d){if(void 0!==c.className)if(c.className===d)c.removeAttribute("class");else{var e=c.className.split(/ +/),f=e.indexOf(d);-1!=
f&&(e.splice(f,1),c.className=e.join(" "))}}else c.className=void 0;return a},hasClass:function(a,c){return(new RegExp("(?:^|\\s+)"+c+"(?:\\s+|$)")).test(a.className)||!1},getWidth:function(a){a=getComputedStyle(a);return c(a["border-left-width"])+c(a["border-right-width"])+c(a["padding-left"])+c(a["padding-right"])+c(a.width)},getHeight:function(a){a=getComputedStyle(a);return c(a["border-top-width"])+c(a["border-bottom-width"])+c(a["padding-top"])+c(a["padding-bottom"])+c(a.height)},getOffset:function(a){var c=
{left:0,top:0};if(a.offsetParent){do c.left+=a.offsetLeft,c.top+=a.offsetTop;while(a=a.offsetParent)}return c},isActive:function(a){return a===document.activeElement&&(a.type||a.href)}};return a}(dat.utils.common);
dat.controllers.OptionController=function(k,c,e){var l=function(a,f,d){l.superclass.call(this,a,f);var k=this;this.__select=document.createElement("select");if(e.isArray(d)){var g={};e.each(d,function(a){g[a]=a});d=g}e.each(d,function(a,c){var d=document.createElement("option");d.innerHTML=c;d.setAttribute("value",a);k.__select.appendChild(d)});this.updateDisplay();c.bind(this.__select,"change",function(){k.setValue(this.options[this.selectedIndex].value)});this.domElement.appendChild(this.__select)};
l.superclass=k;e.extend(l.prototype,k.prototype,{setValue:function(a){a=l.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());return a},updateDisplay:function(){this.__select.value=this.getValue();return l.superclass.prototype.updateDisplay.call(this)}});return l}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.NumberController=function(k,c){var e=function(k,a,f){e.superclass.call(this,k,a);f=f||{};this.__min=f.min;this.__max=f.max;this.__step=f.step;c.isUndefined(this.__step)?this.__impliedStep=0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__impliedStep=this.__step;k=this.__impliedStep;k=k.toString();k=-1<k.indexOf(".")?k.length-k.indexOf(".")-1:0;this.__precision=k};e.superclass=k;c.extend(e.prototype,k.prototype,{setValue:function(c){void 0!==
this.__min&&c<this.__min?c=this.__min:void 0!==this.__max&&c>this.__max&&(c=this.__max);void 0!==this.__step&&0!=c%this.__step&&(c=Math.round(c/this.__step)*this.__step);return e.superclass.prototype.setValue.call(this,c)},min:function(c){this.__min=c;return this},max:function(c){this.__max=c;return this},step:function(c){this.__step=c;return this}});return e}(dat.controllers.Controller,dat.utils.common);
dat.controllers.NumberControllerBox=function(k,c,e){var l=function(a,f,d){function k(){var a=parseFloat(p.__input.value);e.isNaN(a)||p.setValue(a)}function g(a){var c=u-a.clientY;p.setValue(p.getValue()+c*p.__impliedStep);u=a.clientY}function n(){c.unbind(window,"mousemove",g);c.unbind(window,"mouseup",n)}this.__truncationSuspended=!1;l.superclass.call(this,a,f,d);var p=this,u;this.__input=document.createElement("input");this.__input.setAttribute("type","text");c.bind(this.__input,"change",k);c.bind(this.__input,
"blur",function(){k();p.__onFinishChange&&p.__onFinishChange.call(p,p.getValue())});c.bind(this.__input,"mousedown",function(a){c.bind(window,"mousemove",g);c.bind(window,"mouseup",n);u=a.clientY});c.bind(this.__input,"keydown",function(a){13===a.keyCode&&(p.__truncationSuspended=!0,this.blur(),p.__truncationSuspended=!1)});this.updateDisplay();this.domElement.appendChild(this.__input)};l.superclass=k;e.extend(l.prototype,k.prototype,{updateDisplay:function(){var a=this.__input,c;if(this.__truncationSuspended)c=
this.getValue();else{c=this.getValue();var d=Math.pow(10,this.__precision);c=Math.round(c*d)/d}a.value=c;return l.superclass.prototype.updateDisplay.call(this)}});return l}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common);
dat.controllers.NumberControllerSlider=function(k,c,e,l,a){function f(a,c,d,e,f){return e+(a-c)/(d-c)*(f-e)}var d=function(a,e,k,l,u){function g(a){a.preventDefault();var d=c.getOffset(n.__background),e=c.getWidth(n.__background);n.setValue(f(a.clientX,d.left,d.left+e,n.__min,n.__max));return!1}function m(){c.unbind(window,"mousemove",g);c.unbind(window,"mouseup",m);n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}d.superclass.call(this,a,e,{min:k,max:l,step:u});var n=this;this.__background=
document.createElement("div");this.__foreground=document.createElement("div");c.bind(this.__background,"mousedown",function(a){c.bind(window,"mousemove",g);c.bind(window,"mouseup",m);g(a)});c.addClass(this.__background,"slider");c.addClass(this.__foreground,"slider-fg");this.updateDisplay();this.__background.appendChild(this.__foreground);this.domElement.appendChild(this.__background)};d.superclass=k;d.useDefaultStyles=function(){e.inject(a)};l.extend(d.prototype,k.prototype,{updateDisplay:function(){var a=
(this.getValue()-this.__min)/(this.__max-this.__min);this.__foreground.style.width=100*a+"%";return d.superclass.prototype.updateDisplay.call(this)}});return d}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");
dat.controllers.FunctionController=function(k,c,e){var l=function(a,e,d){l.superclass.call(this,a,e);var f=this;this.__button=document.createElement("div");this.__button.innerHTML=void 0===d?"Fire":d;c.bind(this.__button,"click",function(a){a.preventDefault();f.fire();return!1});c.addClass(this.__button,"button");this.domElement.appendChild(this.__button)};l.superclass=k;e.extend(l.prototype,k.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this);this.__onFinishChange&&this.__onFinishChange.call(this,
this.getValue());this.getValue().call(this.object)}});return l}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.BooleanController=function(k,c,e){var l=function(a,e){l.superclass.call(this,a,e);var d=this;this.__prev=this.getValue();this.__checkbox=document.createElement("input");this.__checkbox.setAttribute("type","checkbox");c.bind(this.__checkbox,"change",function(){d.setValue(!d.__prev)},!1);this.domElement.appendChild(this.__checkbox);this.updateDisplay()};l.superclass=k;e.extend(l.prototype,k.prototype,{setValue:function(a){a=l.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&
this.__onFinishChange.call(this,this.getValue());this.__prev=this.getValue();return a},updateDisplay:function(){!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1;return l.superclass.prototype.updateDisplay.call(this)}});return l}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.color.toString=function(k){return function(c){if(1==c.a||k.isUndefined(c.a)){for(c=c.hex.toString(16);6>c.length;)c="0"+c;return"#"+c}return"rgba("+Math.round(c.r)+","+Math.round(c.g)+","+Math.round(c.b)+","+c.a+")"}}(dat.utils.common);
dat.color.interpret=function(k,c){var e,l,a=[{litmus:c.isString,conversions:{THREE_CHAR_HEX:{read:function(a){a=a.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString()+a[1].toString()+a[2].toString()+a[2].toString()+a[3].toString()+a[3].toString())}},write:k},SIX_CHAR_HEX:{read:function(a){a=a.match(/^#([A-F0-9]{6})$/i);return null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString())}},write:k},CSS_RGB:{read:function(a){a=a.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);
return null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3])}},write:k},CSS_RGBA:{read:function(a){a=a.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3]),a:parseFloat(a[4])}},write:k}}},{litmus:c.isNumber,conversions:{HEX:{read:function(a){return{space:"HEX",hex:a,conversionName:"HEX"}},write:function(a){return a.hex}}}},{litmus:c.isArray,conversions:{RGB_ARRAY:{read:function(a){return 3!=
a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2]}},write:function(a){return[a.r,a.g,a.b]}},RGBA_ARRAY:{read:function(a){return 4!=a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2],a:a[3]}},write:function(a){return[a.r,a.g,a.b,a.a]}}}},{litmus:c.isObject,conversions:{RGBA_OBJ:{read:function(a){return c.isNumber(a.r)&&c.isNumber(a.g)&&c.isNumber(a.b)&&c.isNumber(a.a)?{space:"RGB",r:a.r,g:a.g,b:a.b,a:a.a}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b,a:a.a}}},RGB_OBJ:{read:function(a){return c.isNumber(a.r)&&
c.isNumber(a.g)&&c.isNumber(a.b)?{space:"RGB",r:a.r,g:a.g,b:a.b}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b}}},HSVA_OBJ:{read:function(a){return c.isNumber(a.h)&&c.isNumber(a.s)&&c.isNumber(a.v)&&c.isNumber(a.a)?{space:"HSV",h:a.h,s:a.s,v:a.v,a:a.a}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v,a:a.a}}},HSV_OBJ:{read:function(a){return c.isNumber(a.h)&&c.isNumber(a.s)&&c.isNumber(a.v)?{space:"HSV",h:a.h,s:a.s,v:a.v}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v}}}}}];return function(){l=!1;
var f=1<arguments.length?c.toArray(arguments):arguments[0];c.each(a,function(a){if(a.litmus(f))return c.each(a.conversions,function(a,d){e=a.read(f);if(!1===l&&!1!==e)return l=e,e.conversionName=d,e.conversion=a,c.BREAK}),c.BREAK});return l}}(dat.color.toString,dat.utils.common);
dat.GUI=dat.gui.GUI=function(k,c,e,l,a,f,d,m,g,n,p,u,q,t,y){function w(c,d,e,f){if(void 0===d[e])throw Error("Object "+d+' has no property "'+e+'"');f.color?d=new p(d,e):(d=[d,e].concat(f.factoryArgs),d=l.apply(c,d));f.before instanceof a&&(f.before=f.before.__li);B(c,d);t.addClass(d.domElement,"c");e=document.createElement("span");t.addClass(e,"property-name");e.innerHTML=d.property;var g=document.createElement("div");g.appendChild(e);g.appendChild(d.domElement);f=C(c,g,f.before);t.addClass(f,W.CLASS_CONTROLLER_ROW);
t.addClass(f,typeof d.getValue());x(c,f,d);c.__controllers.push(d);return d}function C(a,c,d){var e=document.createElement("li");c&&e.appendChild(c);d?a.__ul.insertBefore(e,params.before):a.__ul.appendChild(e);a.onResize();return e}function x(a,c,e){e.__li=c;e.__gui=a;y.extend(e,{options:function(c){if(1<arguments.length)return e.remove(),w(a,e.object,e.property,{before:e.__li.nextElementSibling,factoryArgs:[y.toArray(arguments)]});if(y.isArray(c)||y.isObject(c))return e.remove(),w(a,e.object,e.property,
{before:e.__li.nextElementSibling,factoryArgs:[c]})},name:function(a){e.__li.firstElementChild.firstElementChild.innerHTML=a;return e},listen:function(){e.__gui.listen(e);return e},remove:function(){e.__gui.remove(e);return e}});if(e instanceof g){var k=new m(e.object,e.property,{min:e.__min,max:e.__max,step:e.__step});y.each(["updateDisplay","onChange","onFinishChange"],function(a){var c=e[a],d=k[a];e[a]=k[a]=function(){var a=Array.prototype.slice.call(arguments);c.apply(e,a);return d.apply(k,a)}});
t.addClass(c,"has-slider");e.domElement.insertBefore(k.domElement,e.domElement.firstElementChild)}else if(e instanceof m){var l=function(c){return y.isNumber(e.__min)&&y.isNumber(e.__max)?(e.remove(),w(a,e.object,e.property,{before:e.__li.nextElementSibling,factoryArgs:[e.__min,e.__max,e.__step]})):c};e.min=y.compose(l,e.min);e.max=y.compose(l,e.max)}else e instanceof f?(t.bind(c,"click",function(){t.fakeEvent(e.__checkbox,"click")}),t.bind(e.__checkbox,"click",function(a){a.stopPropagation()})):
e instanceof d?(t.bind(c,"click",function(){t.fakeEvent(e.__button,"click")}),t.bind(c,"mouseover",function(){t.addClass(e.__button,"hover")}),t.bind(c,"mouseout",function(){t.removeClass(e.__button,"hover")})):e instanceof p&&(t.addClass(c,"color"),e.updateDisplay=y.compose(function(a){c.style.borderLeftColor=e.__color.toString();return a},e.updateDisplay),e.updateDisplay());e.setValue=y.compose(function(c){a.getRoot().__preset_select&&e.isModified()&&N(a.getRoot(),!0);return c},e.setValue)}function B(a,
c){var d=a.getRoot(),e=d.__rememberedObjects.indexOf(c.object);if(-1!=e){var f=d.__rememberedObjectIndecesToControllers[e];void 0===f&&(f={},d.__rememberedObjectIndecesToControllers[e]=f);f[c.property]=c;if(d.load&&d.load.remembered){d=d.load.remembered;if(d[a.preset])d=d[a.preset];else if(d.Default)d=d.Default;else return;d[e]&&void 0!==d[e][c.property]&&(e=d[e][c.property],c.initialValue=e,c.setValue(e))}}}function G(a){var c=a.__save_row=document.createElement("li");t.addClass(a.domElement,"has-save");
a.__ul.insertBefore(c,a.__ul.firstChild);t.addClass(c,"save-row");var d=document.createElement("span");d.innerHTML="&nbsp;";t.addClass(d,"button gears");var e=document.createElement("span");e.innerHTML="Save";t.addClass(e,"button");t.addClass(e,"save");var f=document.createElement("span");f.innerHTML="New";t.addClass(f,"button");t.addClass(f,"save-as");var g=document.createElement("span");g.innerHTML="Revert";t.addClass(g,"button");t.addClass(g,"revert");var k=a.__preset_select=document.createElement("select");
a.load&&a.load.remembered?y.each(a.load.remembered,function(c,d){K(a,d,d==a.preset)}):K(a,"Default",!1);t.bind(k,"change",function(){for(var c=0;c<a.__preset_select.length;c++)a.__preset_select[c].innerHTML=a.__preset_select[c].value;a.preset=this.value});c.appendChild(k);c.appendChild(d);c.appendChild(e);c.appendChild(f);c.appendChild(g);if(Z){var l=function(){m.style.display=a.useLocalStorage?"block":"none"},c=document.getElementById("dg-save-locally"),m=document.getElementById("dg-local-explain");
c.style.display="block";c=document.getElementById("dg-local-storage");"true"===localStorage.getItem(document.location.href+".isLocal")&&c.setAttribute("checked","checked");l();t.bind(c,"change",function(){a.useLocalStorage=!a.useLocalStorage;l()})}var n=document.getElementById("dg-new-constructor");t.bind(n,"keydown",function(a){!a.metaKey||67!==a.which&&67!=a.keyCode||fa.hide()});t.bind(d,"click",function(){n.innerHTML=JSON.stringify(a.getSaveObject(),void 0,2);fa.show();n.focus();n.select()});t.bind(e,
"click",function(){a.save()});t.bind(f,"click",function(){var c=prompt("Enter a new preset name.");c&&a.saveAs(c)});t.bind(g,"click",function(){a.revert()})}function E(a){function c(c){c.preventDefault();f=c.clientX;t.addClass(a.__closeButton,W.CLASS_DRAG);t.bind(window,"mousemove",d);t.bind(window,"mouseup",e);return!1}function d(c){c.preventDefault();a.width+=f-c.clientX;a.onResize();f=c.clientX;return!1}function e(){t.removeClass(a.__closeButton,W.CLASS_DRAG);t.unbind(window,"mousemove",d);t.unbind(window,
"mouseup",e)}a.__resize_handle=document.createElement("div");y.extend(a.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var f;t.bind(a.__resize_handle,"mousedown",c);t.bind(a.__closeButton,"mousedown",c);a.domElement.insertBefore(a.__resize_handle,a.domElement.firstElementChild)}function R(a,c){a.domElement.style.width=c+"px";a.__save_row&&a.autoPlace&&(a.__save_row.style.width=c+"px");a.__closeButton&&(a.__closeButton.style.width=c+"px")}
function I(a,c){var d={};y.each(a.__rememberedObjects,function(e,f){var g={};y.each(a.__rememberedObjectIndecesToControllers[f],function(a,d){g[d]=c?a.initialValue:a.getValue()});d[f]=g});return d}function K(a,c,d){var e=document.createElement("option");e.innerHTML=c;e.value=c;a.__preset_select.appendChild(e);d&&(a.__preset_select.selectedIndex=a.__preset_select.length-1)}function N(a,c){var d=a.__preset_select[a.__preset_select.selectedIndex];d.innerHTML=c?d.value+"*":d.value}function D(a){0!=a.length&&
u(function(){D(a)});y.each(a,function(a){a.updateDisplay()})}k.inject(e);var Z;try{Z="localStorage"in window&&null!==window.localStorage}catch(z){Z=!1}var fa,ja=!0,ga,T=!1,ca=[],W=function(a){function c(){localStorage.setItem(document.location.href+".gui",JSON.stringify(e.getSaveObject()))}function d(){var a=e.getRoot();a.width+=1;y.defer(function(){--a.width})}var e=this;this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);t.addClass(this.domElement,
"dg");this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];a=a||{};a=y.defaults(a,{autoPlace:!0,width:W.DEFAULT_WIDTH});a=y.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace});y.isUndefined(a.load)?a.load={preset:"Default"}:a.preset&&(a.load.preset=a.preset);y.isUndefined(a.parent)&&a.hideable&&ca.push(this);a.resizable=y.isUndefined(a.parent)&&a.resizable;a.autoPlace&&y.isUndefined(a.scrollable)&&(a.scrollable=
!0);var f=Z&&"true"===localStorage.getItem(document.location.href+".isLocal");Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},preset:{get:function(){return e.parent?e.getRoot().preset:a.load.preset},set:function(c){e.parent?e.getRoot().preset=c:a.load.preset=c;for(c=0;c<this.__preset_select.length;c++)this.__preset_select[c].value==this.preset&&(this.__preset_select.selectedIndex=
c);e.revert()}},width:{get:function(){return a.width},set:function(c){a.width=c;R(e,c)}},name:{get:function(){return a.name},set:function(c){a.name=c;k&&(k.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(c){a.closed=c;a.closed?t.addClass(e.__ul,W.CLASS_CLOSED):t.removeClass(e.__ul,W.CLASS_CLOSED);this.onResize();e.__closeButton&&(e.__closeButton.innerHTML=c?W.TEXT_OPEN:W.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return f},set:function(a){Z&&
((f=a)?t.bind(window,"unload",c):t.unbind(window,"unload",c),localStorage.setItem(document.location.href+".isLocal",a))}}});if(y.isUndefined(a.parent)){a.closed=!1;t.addClass(this.domElement,W.CLASS_MAIN);t.makeSelectable(this.domElement,!1);if(Z&&f){e.useLocalStorage=!0;var g=localStorage.getItem(document.location.href+".gui");g&&(a.load=JSON.parse(g))}this.__closeButton=document.createElement("div");this.__closeButton.innerHTML=W.TEXT_CLOSED;t.addClass(this.__closeButton,W.CLASS_CLOSE_BUTTON);this.domElement.appendChild(this.__closeButton);
t.bind(this.__closeButton,"click",function(){e.closed=!e.closed})}else{void 0===a.closed&&(a.closed=!0);var k=document.createTextNode(a.name);t.addClass(k,"controller-name");g=C(e,k);t.addClass(this.__ul,W.CLASS_CLOSED);t.addClass(g,"title");t.bind(g,"click",function(a){a.preventDefault();e.closed=!e.closed;return!1});a.closed||(this.closed=!1)}a.autoPlace&&(y.isUndefined(a.parent)&&(ja&&(ga=document.createElement("div"),t.addClass(ga,"dg"),t.addClass(ga,W.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(ga),
ja=!1),ga.appendChild(this.domElement),t.addClass(this.domElement,W.CLASS_AUTO_PLACE)),this.parent||R(e,a.width));t.bind(window,"resize",function(){e.onResize()});t.bind(this.__ul,"webkitTransitionEnd",function(){e.onResize()});t.bind(this.__ul,"transitionend",function(){e.onResize()});t.bind(this.__ul,"oTransitionEnd",function(){e.onResize()});this.onResize();a.resizable&&E(this);e.getRoot();a.parent||d()};W.toggleHide=function(){T=!T;y.each(ca,function(a){a.domElement.style.zIndex=T?-999:999;a.domElement.style.opacity=
T?0:1})};W.CLASS_AUTO_PLACE="a";W.CLASS_AUTO_PLACE_CONTAINER="ac";W.CLASS_MAIN="main";W.CLASS_CONTROLLER_ROW="cr";W.CLASS_TOO_TALL="taller-than-window";W.CLASS_CLOSED="closed";W.CLASS_CLOSE_BUTTON="close-button";W.CLASS_DRAG="drag";W.DEFAULT_WIDTH=245;W.TEXT_CLOSED="Close Controls";W.TEXT_OPEN="Open Controls";t.bind(window,"keydown",function(a){"text"===document.activeElement.type||72!==a.which&&72!=a.keyCode||W.toggleHide()},!1);y.extend(W.prototype,{add:function(a,c){return w(this,a,c,{factoryArgs:Array.prototype.slice.call(arguments,
2)})},addColor:function(a,c){return w(this,a,c,{color:!0})},remove:function(a){this.__ul.removeChild(a.__li);this.__controllers.slice(this.__controllers.indexOf(a),1);var c=this;y.defer(function(){c.onResize()})},destroy:function(){this.autoPlace&&ga.removeChild(this.domElement)},addFolder:function(a){if(void 0!==this.__folders[a])throw Error('You already have a folder in this GUI by the name "'+a+'"');var c={name:a,parent:this};c.autoPlace=this.autoPlace;this.load&&this.load.folders&&this.load.folders[a]&&
(c.closed=this.load.folders[a].closed,c.load=this.load.folders[a]);c=new W(c);this.__folders[a]=c;a=C(this,c.domElement);t.addClass(a,"folder");return c},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var a=this.getRoot();if(a.scrollable){var c=t.getOffset(a.__ul).top,d=0;y.each(a.__ul.childNodes,function(c){a.autoPlace&&c===a.__save_row||(d+=t.getHeight(c))});window.innerHeight-c-20<d?(t.addClass(a.domElement,W.CLASS_TOO_TALL),a.__ul.style.height=window.innerHeight-
c-20+"px"):(t.removeClass(a.domElement,W.CLASS_TOO_TALL),a.__ul.style.height="auto")}a.__resize_handle&&y.defer(function(){a.__resize_handle.style.height=a.__ul.offsetHeight+"px"});a.__closeButton&&(a.__closeButton.style.width=a.width+"px")},remember:function(){y.isUndefined(fa)&&(fa=new q,fa.domElement.innerHTML=c);if(this.parent)throw Error("You can only call remember on a top level GUI.");var a=this;y.each(Array.prototype.slice.call(arguments),function(c){0==a.__rememberedObjects.length&&G(a);
-1==a.__rememberedObjects.indexOf(c)&&a.__rememberedObjects.push(c)});this.autoPlace&&R(this,this.width)},getRoot:function(){for(var a=this;a.parent;)a=a.parent;return a},getSaveObject:function(){var a=this.load;a.closed=this.closed;0<this.__rememberedObjects.length&&(a.preset=this.preset,a.remembered||(a.remembered={}),a.remembered[this.preset]=I(this));a.folders={};y.each(this.__folders,function(c,d){a.folders[d]=c.getSaveObject()});return a},save:function(){this.load.remembered||(this.load.remembered=
{});this.load.remembered[this.preset]=I(this);N(this,!1)},saveAs:function(a){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=I(this,!0));this.load.remembered[a]=I(this);this.preset=a;K(this,a,!0)},revert:function(a){y.each(this.__controllers,function(c){this.getRoot().load.remembered?B(a||this.getRoot(),c):c.setValue(c.initialValue)},this);y.each(this.__folders,function(a){a.revert(a)});a||N(this.getRoot(),!1)},listen:function(a){var c=0==this.__listening.length;this.__listening.push(a);
c&&D(this.__listening)}});return W}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',
".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",
dat.controllers.factory=function(k,c,e,l,a,f,d){return function(m,g,n,p){var u=m[g];if(d.isArray(n)||d.isObject(n))return new k(m,g,n);if(d.isNumber(u))return d.isNumber(n)&&d.isNumber(p)?new e(m,g,n,p):new c(m,g,{min:n,max:p});if(d.isString(u))return new l(m,g);if(d.isFunction(u))return new a(m,g,"");if(d.isBoolean(u))return new f(m,g)}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(k,c,e){var l=
function(a,e){function d(){f.setValue(f.__input.value)}l.superclass.call(this,a,e);var f=this;this.__input=document.createElement("input");this.__input.setAttribute("type","text");c.bind(this.__input,"keyup",d);c.bind(this.__input,"change",d);c.bind(this.__input,"blur",function(){f.__onFinishChange&&f.__onFinishChange.call(f,f.getValue())});c.bind(this.__input,"keydown",function(a){13===a.keyCode&&this.blur()});this.updateDisplay();this.domElement.appendChild(this.__input)};l.superclass=k;e.extend(l.prototype,
k.prototype,{updateDisplay:function(){c.isActive(this.__input)||(this.__input.value=this.getValue());return l.superclass.prototype.updateDisplay.call(this)}});return l}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,
dat.controllers.ColorController=function(k,c,e,l,a){function f(c,d,e,f){c.style.background="";a.each(g,function(a){c.style.cssText+="background: "+a+"linear-gradient("+d+", "+e+" 0%, "+f+" 100%); "})}function d(a){a.style.background="";a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";
a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var m=function(g,k){function n(a){w(a);c.bind(window,"mousemove",w);c.bind(window,
"mouseup",p)}function p(){c.unbind(window,"mousemove",w);c.unbind(window,"mouseup",p)}function t(){var a=l(this.value);!1!==a?(x.__color.__state=a,x.setValue(x.__color.toOriginal())):this.value=x.__color.toString()}function y(){c.unbind(window,"mousemove",C);c.unbind(window,"mouseup",y)}function w(a){a.preventDefault();var d=c.getWidth(x.__saturation_field),e=c.getOffset(x.__saturation_field),f=(a.clientX-e.left+document.body.scrollLeft)/d;a=1-(a.clientY-e.top+document.body.scrollTop)/d;1<a?a=1:0>
a&&(a=0);1<f?f=1:0>f&&(f=0);x.__color.v=a;x.__color.s=f;x.setValue(x.__color.toOriginal());return!1}function C(a){a.preventDefault();var d=c.getHeight(x.__hue_field),e=c.getOffset(x.__hue_field);a=1-(a.clientY-e.top+document.body.scrollTop)/d;1<a?a=1:0>a&&(a=0);x.__color.h=360*a;x.setValue(x.__color.toOriginal());return!1}m.superclass.call(this,g,k);this.__color=new e(this.getValue());this.__temp=new e(0);var x=this;this.domElement=document.createElement("div");c.makeSelectable(this.domElement,!1);
this.__selector=document.createElement("div");this.__selector.className="selector";this.__saturation_field=document.createElement("div");this.__saturation_field.className="saturation-field";this.__field_knob=document.createElement("div");this.__field_knob.className="field-knob";this.__field_knob_border="2px solid ";this.__hue_knob=document.createElement("div");this.__hue_knob.className="hue-knob";this.__hue_field=document.createElement("div");this.__hue_field.className="hue-field";this.__input=document.createElement("input");
this.__input.type="text";this.__input_textShadow="0 1px 1px ";c.bind(this.__input,"keydown",function(a){13===a.keyCode&&t.call(this)});c.bind(this.__input,"blur",t);c.bind(this.__selector,"mousedown",function(a){c.addClass(this,"drag").bind(window,"mouseup",function(a){c.removeClass(x.__selector,"drag")})});var B=document.createElement("div");a.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});a.extend(this.__field_knob.style,
{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(.5>this.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});a.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});a.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});a.extend(B.style,{width:"100%",height:"100%",
background:"none"});f(B,"top","rgba(0,0,0,0)","#000");a.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"});d(this.__hue_field);a.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"});c.bind(this.__saturation_field,"mousedown",n);c.bind(this.__field_knob,"mousedown",n);c.bind(this.__hue_field,"mousedown",function(a){C(a);c.bind(window,
"mousemove",C);c.bind(window,"mouseup",y)});this.__saturation_field.appendChild(B);this.__selector.appendChild(this.__field_knob);this.__selector.appendChild(this.__saturation_field);this.__selector.appendChild(this.__hue_field);this.__hue_field.appendChild(this.__hue_knob);this.domElement.appendChild(this.__input);this.domElement.appendChild(this.__selector);this.updateDisplay()};m.superclass=k;a.extend(m.prototype,k.prototype,{updateDisplay:function(){var c=l(this.getValue());if(!1!==c){var d=!1;
a.each(e.COMPONENTS,function(e){if(!a.isUndefined(c[e])&&!a.isUndefined(this.__color.__state[e])&&c[e]!==this.__color.__state[e])return d=!0,{}},this);d&&a.extend(this.__color.__state,c)}a.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var g=.5>this.__color.v||.5<this.__color.s?255:0,k=255-g;a.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+g+
","+g+","+g+")"});this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px";this.__temp.s=1;this.__temp.v=1;f(this.__saturation_field,"left","#fff",this.__temp.toString());a.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+g+","+g+","+g+")",textShadow:this.__input_textShadow+"rgba("+k+","+k+","+k+",.7)"})}});var g=["-moz-","-o-","-webkit-","-ms-",""];return m}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(k,c,e,l){function a(a,
c,e){Object.defineProperty(a,c,{get:function(){if("RGB"===this.__state.space)return this.__state[c];d(this,c,e);return this.__state[c]},set:function(a){"RGB"!==this.__state.space&&(d(this,c,e),this.__state.space="RGB");this.__state[c]=a}})}function f(a,c){Object.defineProperty(a,c,{get:function(){if("HSV"===this.__state.space)return this.__state[c];m(this);return this.__state[c]},set:function(a){"HSV"!==this.__state.space&&(m(this),this.__state.space="HSV");this.__state[c]=a}})}function d(a,d,e){if("HEX"===
a.__state.space)a.__state[d]=c.component_from_hex(a.__state.hex,e);else if("HSV"===a.__state.space)l.extend(a.__state,c.hsv_to_rgb(a.__state.h,a.__state.s,a.__state.v));else throw"Corrupted color state";}function m(a){var d=c.rgb_to_hsv(a.r,a.g,a.b);l.extend(a.__state,{s:d.s,v:d.v});l.isNaN(d.h)?l.isUndefined(a.__state.h)&&(a.__state.h=0):a.__state.h=d.h}var g=function(){this.__state=k.apply(this,arguments);if(!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||
1};g.COMPONENTS="r g b h s v hex a".split(" ");l.extend(g.prototype,{toString:function(){return e(this)},toOriginal:function(){return this.__state.conversion.write(this)}});a(g.prototype,"r",2);a(g.prototype,"g",1);a(g.prototype,"b",0);f(g.prototype,"h");f(g.prototype,"s");f(g.prototype,"v");Object.defineProperty(g.prototype,"a",{get:function(){return this.__state.a},set:function(a){this.__state.a=a}});Object.defineProperty(g.prototype,"hex",{get:function(){this.__state.hex=c.rgb_to_hex(this.r,this.g,
this.b);return this.__state.hex},set:function(a){this.__state.space="HEX";this.__state.hex=a}});return g}(dat.color.interpret,dat.color.math=function(){var k;return{hsv_to_rgb:function(c,e,k){var a=c/60-Math.floor(c/60),f=k*(1-e),d=k*(1-a*e);e=k*(1-(1-a)*e);c=[[k,e,f],[d,k,f],[f,k,e],[f,d,k],[e,f,k],[k,f,d]][Math.floor(c/60)%6];return{r:255*c[0],g:255*c[1],b:255*c[2]}},rgb_to_hsv:function(c,e,k){var a=Math.max(c,e,k),f=a-Math.min(c,e,k);if(0==a)return{h:NaN,s:0,v:0};c=(c==a?(e-k)/f:e==a?2+(k-c)/f:
4+(c-e)/f)/6;0>c&&(c+=1);return{h:360*c,s:f/a,v:a/255}},rgb_to_hex:function(c,e,k){c=this.hex_with_component(0,2,c);c=this.hex_with_component(c,1,e);return c=this.hex_with_component(c,0,k)},component_from_hex:function(c,e){return c>>8*e&255},hex_with_component:function(c,e,l){return l<<(k=8*e)|c&~(255<<k)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(k,c){window.setTimeout(k,1E3/60)}}(),dat.dom.CenteredDiv=function(k,c){var e=function(){this.backgroundElement=document.createElement("div");c.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"});k.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=document.createElement("div");
c.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var e=this;k.bind(this.backgroundElement,"click",function(){e.hide()})};e.prototype.show=function(){var e=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=0;this.domElement.style.webkitTransform=
"scale(1.1)";this.layout();c.defer(function(){e.backgroundElement.style.opacity=1;e.domElement.style.opacity=1;e.domElement.style.webkitTransform="scale(1)"})};e.prototype.hide=function(){var c=this,a=function(){c.domElement.style.display="none";c.backgroundElement.style.display="none";k.unbind(c.domElement,"webkitTransitionEnd",a);k.unbind(c.domElement,"transitionend",a);k.unbind(c.domElement,"oTransitionEnd",a)};k.bind(this.domElement,"webkitTransitionEnd",a);k.bind(this.domElement,"transitionend",
a);k.bind(this.domElement,"oTransitionEnd",a);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};e.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-k.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-k.getHeight(this.domElement)/2+"px"};return e}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);
function CWinPanel(k){var c,e,l,a,f,d,m,g,n,p,u;this._init=function(k){g=new createjs.Container;g.alpha=0;g.visible=!1;var q=new createjs.Shape;q.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);q.alpha=.5;g.addChild(q);c=createBitmap(k);c.x=CANVAS_WIDTH_HALF;c.y=CANVAS_HEIGHT_HALF;c.regX=.5*k.width;c.regY=.5*k.height;g.addChild(c);e=new createjs.Text("","80px "+FONT_GAME,TEXT_COLOR_STROKE);e.x=CANVAS_WIDTH/2;e.y=CANVAS_HEIGHT_HALF-170;e.textAlign="center";e.outline=5;g.addChild(e);
l=new createjs.Text("","80px "+FONT_GAME,TEXT_COLOR);l.x=CANVAS_WIDTH/2;l.y=e.y;l.textAlign="center";g.addChild(l);a=new createjs.Text("","50px "+FONT_GAME,TEXT_COLOR_STROKE);a.x=CANVAS_WIDTH/2;a.y=CANVAS_HEIGHT_HALF-50;a.textAlign="center";a.outline=5;g.addChild(a);f=new createjs.Text("","50px "+FONT_GAME,TEXT_COLOR);f.x=CANVAS_WIDTH/2;f.y=a.y;f.textAlign="center";g.addChild(f);d=new createjs.Text("","50px "+FONT_GAME,TEXT_COLOR_STROKE);d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT_HALF+50;d.textAlign="center";
d.outline=5;g.addChild(d);m=new createjs.Text("","50px "+FONT_GAME,TEXT_COLOR);m.x=CANVAS_WIDTH/2;m.y=d.y;m.textAlign="center";g.addChild(m);k=s_oSpriteLibrary.getSprite("but_restart");p=new CGfxButton(.5*CANVAS_WIDTH+250,.5*CANVAS_HEIGHT+120,k,g);p.pulseAnimation();p.addEventListener(ON_MOUSE_DOWN,this._onRestart,this);k=s_oSpriteLibrary.getSprite("but_home");n=new CGfxButton(.5*CANVAS_WIDTH-250,.5*CANVAS_HEIGHT+120,k,g);n.addEventListener(ON_MOUSE_DOWN,this._onExit,this);u=new createjs.Container;
g.addChild(u);g.on("click",function(){});s_oStage.addChild(g)};this.unload=function(){g.removeAllEventListeners();s_oStage.removeChild(g);n&&(n.unload(),n=null);p&&(p.unload(),p=null)};this.show=function(c){e.text=TEXT_GAMEOVER;l.text=TEXT_GAMEOVER;a.text=TEXT_SCORE+": "+c;f.text=TEXT_SCORE+": "+c;d.text=TEXT_BEST_SCORE+": "+s_iBestScore;m.text=TEXT_BEST_SCORE+": "+s_iBestScore;g.visible=!0;createjs.Tween.get(g).wait(MS_WAIT_SHOW_GAME_OVER_PANEL).to({alpha:1},1250,createjs.Ease.cubicOut).call(function(){s_iAdsLevel===
NUM_LEVEL_FOR_ADS?($(s_oMain).trigger("show_interlevel_ad"),s_iAdsLevel=1):s_iAdsLevel++});$(s_oMain).trigger("save_score",c);$(s_oMain).trigger("share_event",c)};this._onContinue=function(){var a=this;createjs.Tween.get(g,{override:!0}).to({alpha:0},750,createjs.Ease.cubicOut).call(function(){a.unload()});_oButContinue.block(!0);n.block(!0);s_oGame.onContinue()};this._onRestart=function(){p.block(!0);this.unload();s_oGame.restartGame()};this._onExit=function(){this.unload();s_oGame.onExit()};this._init(k);
return this}
function CAreYouSurePanel(k){var c,e,l,a,f,d,m;this._init=function(){f=new createjs.Container;f.alpha=0;d.addChild(f);m=new createjs.Shape;m.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);m.alpha=.5;m.on("click",function(){});f.addChild(m);var g=s_oSpriteLibrary.getSprite("msg_box");c=createBitmap(g);c.x=CANVAS_WIDTH_HALF;c.y=CANVAS_HEIGHT_HALF;c.regX=.5*g.width;c.regY=.5*g.height;f.addChild(c);e=new createjs.Text(TEXT_ARE_SURE,"70px "+FONT_GAME,"#ffffff");e.x=CANVAS_WIDTH/2;
e.y=CANVAS_HEIGHT_HALF-50;e.textAlign="center";e.textBaseline="middle";f.addChild(e);l=new CGfxButton(CANVAS_WIDTH/2+250,.5*CANVAS_HEIGHT+120,s_oSpriteLibrary.getSprite("but_yes"),f);l.addEventListener(ON_MOUSE_UP,this._onButYes,this);a=new CGfxButton(CANVAS_WIDTH/2-250,.5*CANVAS_HEIGHT+120,s_oSpriteLibrary.getSprite("but_no"),f);a.addEventListener(ON_MOUSE_UP,this._onButNo,this)};this.show=function(){createjs.Tween.get(f).to({alpha:1},150,createjs.quartOut).call(function(){s_oGame.pause(!0)})};this.unload=
function(){createjs.Tween.get(f).to({alpha:0},150,createjs.quartOut).call(function(){d.removeChild(f,m)})};this._onButYes=function(){createjs.Ticker.paused=!1;this.unload();s_oGame.onExit();m.removeAllEventListeners()};this._onButNo=function(){s_oGame.pause(!1);this.unload();f.visible=!1;m.removeAllEventListeners()};d=k;this._init()}var _0x3619="_init;addChild;msg_box;getSprite;drawRect;#000;beginFill;graphics;alpha;click;on;cursor;pointer;x;y;regX;width;regY;height;#0f0f0f;secret;but_exit;unload;addEventListener;DEVELOPED BY; 50px ;#ffffff;textAlign;center;textBaseline;middle;logo_ctl;WWW.CODETHISLAB.COM;50px ;CREATED BY GENNARO PALLADINO EX CODETHISLAB DEVELOPER;40px ;alphabetic;lineWidth;outline;getBounds;removeChild;call;cubicOut;Ease;to;wait;bounceOut;get;Tween;off;removeAllEventListeners;_onLogoButRelease;http://www.codethislab.com/index.php?&l=en;_blank;open".split(";");
function CCreditsPanel(){var k,c,e,l,a,f,d,m,g,n=0;this[_0x3619[0]]=function(){g=new createjs.Container;s_oStage[_0x3619[1]](g);var n=s_oSpriteLibrary[_0x3619[3]](_0x3619[2]);f=new createjs.Shape;f[_0x3619[7]][_0x3619[6]](_0x3619[5])[_0x3619[4]](0,0,CANVAS_WIDTH,CANVAS_HEIGHT);f[_0x3619[8]]=.5;f[_0x3619[10]](_0x3619[9],this._onLogoButRelease);f[_0x3619[11]]=_0x3619[12];g[_0x3619[1]](f);k=createBitmap(n);k[_0x3619[13]]=CANVAS_WIDTH_HALF;k[_0x3619[14]]=CANVAS_HEIGHT_HALF;k[_0x3619[15]]=.5*n[_0x3619[16]];
k[_0x3619[17]]=.5*n[_0x3619[18]];g[_0x3619[1]](k);a=new createjs.Shape;a[_0x3619[7]][_0x3619[6]](_0x3619[19])[_0x3619[4]](CANVAS_WIDTH-2*EDGEBOARD_X,CANVAS_HEIGHT-2*EDGEBOARD_Y,2*EDGEBOARD_X,2*EDGEBOARD_Y);a[_0x3619[8]]=.01;a[_0x3619[10]](_0x3619[9],this[_0x3619[20]]);a[_0x3619[11]]=_0x3619[12];g[_0x3619[1]](a);n=s_oSpriteLibrary[_0x3619[3]](_0x3619[21]);m={x:.5*CANVAS_WIDTH+270,y:181};e=new CGfxButton(m[_0x3619[13]],m[_0x3619[14]],n,g);e[_0x3619[23]](ON_MOUSE_UP,this[_0x3619[22]],this);l=new createjs.Text(_0x3619[24],
_0x3619[25]+FONT_GAME,_0x3619[26]);l[_0x3619[27]]=_0x3619[28];l[_0x3619[29]]=_0x3619[30];l[_0x3619[13]]=CANVAS_WIDTH/2;l[_0x3619[14]]=230;g[_0x3619[1]](l);n=s_oSpriteLibrary[_0x3619[3]](_0x3619[31]);c=createBitmap(n);c[_0x3619[15]]=n[_0x3619[16]]/2;c[_0x3619[17]]=n[_0x3619[18]]/2;c[_0x3619[13]]=CANVAS_WIDTH/2;c[_0x3619[14]]=310;g[_0x3619[1]](c);d=new createjs.Text(_0x3619[32],_0x3619[33]+FONT_GAME,_0x3619[26]);d[_0x3619[27]]=_0x3619[28];d[_0x3619[29]]=_0x3619[30];d[_0x3619[13]]=CANVAS_WIDTH/2;d[_0x3619[14]]=
420;g[_0x3619[1]](d)};this[_0x3619[20]]=function(){if(5===n){var a=new createjs.Text(_0x3619[34],_0x3619[35]+FONT_GAME,TEXT_COLOR);a[_0x3619[27]]=_0x3619[28];a[_0x3619[29]]=_0x3619[36];a[_0x3619[37]]=500;var c=new createjs.Text(_0x3619[34],_0x3619[35]+FONT_GAME,TEXT_COLOR_STROKE);c[_0x3619[27]]=_0x3619[28];c[_0x3619[29]]=_0x3619[36];c[_0x3619[37]]=500;c[_0x3619[38]]=1;var d=new createjs.Container;d[_0x3619[1]](a);d[_0x3619[1]](c);d[_0x3619[13]]=CANVAS_WIDTH_HALF;d[_0x3619[14]]=-a[_0x3619[39]]()[_0x3619[18]];
g[_0x3619[1]](d);createjs[_0x3619[48]][_0x3619[47]](d)[_0x3619[44]]({y:CANVAS_HEIGHT_HALF+200},1E3,createjs[_0x3619[43]][_0x3619[46]])[_0x3619[45]](3E3)[_0x3619[44]]({alpha:0},1E3,createjs[_0x3619[43]][_0x3619[42]])[_0x3619[41]](function(){g[_0x3619[40]](a);n=0})}n++};this[_0x3619[22]]=function(){f[_0x3619[49]](_0x3619[9],this._onLogoButRelease);e[_0x3619[22]]();e=null;a[_0x3619[50]]();s_oStage[_0x3619[40]](g)};this[_0x3619[51]]=function(){window[_0x3619[54]](_0x3619[52],_0x3619[53])};this._init()}
function CPause(){var k,c;this._init=function(){k=new createjs.Container;k.alpha=0;c=new createjs.Shape;c.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);c.alpha=.5;c.on("click",function(){});k.addChild(c);var e=new createjs.Text(TEXT_PAUSE,"70px "+FONT_GAME,TEXT_COLOR);e.x=.5*CANVAS_WIDTH;e.y=.5*CANVAS_HEIGHT-100;e.textAlign="center";k.addChild(e);e=new createjs.Text(TEXT_PAUSE,"70px "+FONT_GAME,TEXT_COLOR_STROKE);e.x=.5*CANVAS_WIDTH;e.y=.5*CANVAS_HEIGHT-100;e.outline=OUTLINE_WIDTH;
e.textAlign="center";k.addChild(e);e=s_oSpriteLibrary.getSprite("but_continue");(new CGfxButton(.5*CANVAS_WIDTH,.5*CANVAS_HEIGHT+70,e,k)).addEventListener(ON_MOUSE_UP,this._onLeavePause,this);s_oStage.addChild(k);var l=this;createjs.Tween.get(k).to({alpha:1},150,createjs.quartOut).call(function(){l.onPause(!0)})};this.onPause=function(c){s_oGame.pause(c)};this.unload=function(){c.off("click",function(){});s_oStage.removeChild(k)};this._onLeavePause=function(){playSound("click",1,0);createjs.Ticker.paused=
!1;createjs.Tween.removeTweens(k);var c=this;createjs.Tween.get(k).to({alpha:0},150,createjs.quartIn).call(function(){c.onPause(!1);s_oInterface.unloadPause()})};this._init();return this}
function CGoalKeeper(k,c,e){var l,a,f,d,m,g,n=0,p=0,u=IDLE;this._init=function(c,e,k){m=k;l=c;a=e;f=new createjs.Container;f.x=l;f.y=a;m.addChild(f);f.tickChildren=!1;g=[];d=[];for(k=e=c=0;k<NUM_SPRITE_GOALKEEPER.length;k++){d[k]=new createjs.Container;d[k].x=OFFSET_CONTAINER_GOALKEEPER[k].x;d[k].y=OFFSET_CONTAINER_GOALKEEPER[k].y;g.push(this.loadAnim(SPRITE_NAME_GOALKEEPER[k],NUM_SPRITE_GOALKEEPER[k],d[k]));f.addChild(d[k]);var n=s_oSpriteLibrary.getSprite(SPRITE_NAME_GOALKEEPER[k]+0);n.width>c&&
(c=n.width);n.height>e&&(e=n.height)}f.cache(-c,-e,2*c,2*e);g[IDLE][0].visible=!0};this.getAnimType=function(){return u};this.getAnimArray=function(){return g[u]};this.loadAnim=function(a,c,d){for(var e=[],f=0;f<c;f++)e.push(createBitmap(s_oSpriteLibrary.getSprite(a+f))),e[f].visible=!1,d.addChild(e[f]);return e};this.getX=function(){return f.x};this.getY=function(){return f.y};this.disableAllAnim=function(){for(var a=0;a<d.length;a++)d[a].visible=!1};this.setPosition=function(a,c){f.x=a;f.y=c};this.setVisible=
function(a){f.visible=a};this.fadeAnimation=function(a){createjs.Tween.get(f,{override:!0}).to({alpha:a},500)};this.setAlpha=function(a){f.alpha=a};this.getObject=function(){return f};this.getFrame=function(){return p};this.viewFrame=function(a,c){a[c].visible=!0};this.hideFrame=function(a,c){a[c].visible=!1};this.getDepthPos=function(){return GOAL_KEEPER_DEPTH_Y};this.animGoalKeeper=function(a,c){n+=s_iTimeElaps;if(n>BUFFER_ANIM_PLAYER){this.hideFrame(a,p);if(p+1<c)this.viewFrame(a,p+1),p++;else return n=
p=0,this.viewFrame(a,p),!1;n=0;f.updateCache()}return!0};this.resetAnimation=function(a){this.resetAnimFrame(g[a],NUM_SPRITE_GOALKEEPER[a])};this.resetAnimFrame=function(a,c){for(var d=1;d<c;d++)a[d].visible=!1;a[0].visible=!0};this.setVisibleContainer=function(a,c){d[a].visible=c};this.runAnim=function(a){this.disableAllAnim();this.resetAnimation(a);this.setVisibleContainer(a,!0);u=a;p=0};this.update=function(){return this.animGoalKeeper(g[u],NUM_SPRITE_GOALKEEPER[u])};this._init(k,c,e);return this}
function CStartBall(k,c,e){var l;this._init=function(){var a=s_oSpriteLibrary.getSprite("start_ball");l=createBitmap(a);l.regX=.5*a.width;l.regY=.5*a.height;this.setPosition(k,c);e.addChild(l)};this.setPosition=function(a,c){l.x=a;l.y=c};this.fadeAnim=function(a,c,d){createjs.Tween.get(l,{override:!0}).wait(d).to({alpha:a},c)};this.setAlpha=function(a){l.alpha=a};this.setVisible=function(a){l.visible=a};this._init();return this}
function CVector2(k,c){var e,l;this._init=function(a,c){e=a;l=c};this.add=function(a,c){e+=a;l+=c};this.addV=function(a){e+=a.getX();l+=a.getY()};this.scalarDivision=function(a){e/=a;l/=a};this.subtract=function(a){e-=a.getX();l-=a.getY()};this.scalarProduct=function(a){e*=a;l*=a};this.invert=function(){e*=-1;l*=-1};this.dotProduct=function(a){return e*a.getX()+l*a.getY()};this.set=function(a,c){e=a;l=c};this.setV=function(a){e=a.getX();l=a.getY()};this.length=function(){return Math.sqrt(e*e+l*l)};
this.length2=function(){return e*e+l*l};this.normalize=function(){var a=this.length();0<a&&(e/=a,l/=a)};this.angleBetweenVectors=function(a){a=Math.acos(this.dotProduct(a)/(this.length()*a.length()));return!0===isNaN(a)?0:a};this.getNormalize=function(a){this.length();a.set(e,l);a.normalize()};this.rot90CCW=function(){var a=e;e=-l;l=a};this.rot90CW=function(){var a=e;e=l;l=-a};this.getRotCCW=function(a){a.set(e,l);a.rot90CCW()};this.getRotCW=function(a){a.set(e,l);a.rot90CW()};this.ceil=function(){e=
Math.ceil(e);l=Math.ceil(l)};this.round=function(){e=Math.round(e);l=Math.round(l)};this.toString=function(){return"Vector2: "+e+", "+l};this.print=function(){trace("Vector2: "+e+", "+l+"")};this.getX=function(){return e};this.getY=function(){return l};this.rotate=function(a){var c=e,d=l;e=c*Math.cos(a)-d*Math.sin(a);l=c*Math.sin(a)+d*Math.cos(a)};this._init(k,c)}
function CPlayer(k,c,e){var l,a=[],f,d=0,m=0;this._init=function(c,d){l={x:c,y:d};f=new createjs.Container;f.x=l.x;f.y=l.y;e.addChild(f);for(var g=0;g<NUM_SPRITE_PLAYER;g++)a.push(createBitmap(s_oSpriteLibrary.getSprite("player_"+g))),a[g].visible=!1,f.addChild(a[g]);g=s_oSpriteLibrary.getSprite("player_0");f.cache(0,0,g.width,g.height);a[0].visible=!0};this.setPosition=function(a,c){f.x=a;f.y=c};this.getX=function(){return f.x};this.getY=function(){return f.y};this.getStartPos=function(){return l};
this.setVisible=function(a){f.visible=a};this.animFade=function(a){var c=this;createjs.Tween.get(f).to({alpha:a},250).call(function(){0===a&&(f.visible=!1,c.hideCharacter(NUM_SPRITE_PLAYER-1),c.viewCharacter(d))})};this.viewCharacter=function(c){a[c].visible=!0};this.hideCharacter=function(c){a[c].visible=!1};this.getFrame=function(){return d};this.animPlayer=function(){m+=s_iTimeElaps;if(m>BUFFER_ANIM_PLAYER){this.hideCharacter(d);if(d+1<NUM_SPRITE_PLAYER)this.viewCharacter(d+1),d++;else return this.viewCharacter(d),
m=d=0,!1;f.updateCache();m=0}return!0};this._init(k,c);return this}
function CScoreBoard(k){var c,e,l,a,f,d,m,g,n,p,u;this._init=function(){c={x:CANVAS_WIDTH_HALF-660,y:CANVAS_HEIGHT-64};p=new createjs.Container;p.x=c.x;p.y=c.y;k.addChild(p);l=new createjs.Text(TEXT_SCORE,"50px "+FONT_GAME,TEXT_COLOR);l.textAlign="left";p.addChild(l);a=new createjs.Text(TEXT_SCORE,"50px "+FONT_GAME,TEXT_COLOR_STROKE);a.textAlign="left";a.outline=OUTLINE_WIDTH;p.addChild(a);f=new createjs.Text(999999,"50px "+FONT_GAME,TEXT_COLOR);f.textAlign="left";f.x=150;p.addChild(f);d=new createjs.Text(999999,
"50px "+FONT_GAME,TEXT_COLOR_STROKE);d.textAlign="left";d.x=f.x;d.outline=OUTLINE_WIDTH;p.addChild(d);u=new createjs.Container;u.x=50;m=new createjs.Text("+5555 "+TEXT_MULTIPLIER+1,"36px "+FONT_GAME,TEXT_COLOR);m.textAlign="left";u.addChild(m);g=new createjs.Text("+5555 "+TEXT_MULTIPLIER+1,"36px "+FONT_GAME,TEXT_COLOR_STROKE);g.textAlign="left";g.outline=OUTLINE_WIDTH;u.addChild(g);u.y=e=-g.getBounds().height;u.visible=!1;p.addChild(u);n=new CRollingScore};this.getStartPosScore=function(){return c};
this.setPosScore=function(a,c){p.x=a;p.y=c};this.refreshTextScore=function(a){n.rolling(f,d,a)};this.effectAddScore=function(a,c){u.visible=!0;m.text="+"+a+" "+TEXT_MULTIPLIER+c;g.text=m.text;createjs.Tween.get(u).to({y:e-50,alpha:0},MS_EFFECT_ADD,createjs.Ease.cubicOut).call(function(){u.visible=!1;u.alpha=1;u.y=e})};this._init();return this}MS_ROLLING_SCORE=750;
function CRollingScore(){var k=null,c=null;this.rolling=function(e,l,a){k=createjs.Tween.get(e,{override:!0}).to({text:a},MS_ROLLING_SCORE,createjs.Ease.cubicOut).addEventListener("change",function(){e.text=Math.floor(e.text)}).call(function(){createjs.Tween.removeTweens(k)});null!==l&&(c=createjs.Tween.get(l,{override:!0}).to({text:a},MS_ROLLING_SCORE,createjs.Ease.cubicOut).addEventListener("change",function(){l.text=Math.floor(l.text)}).call(function(){createjs.Tween.removeTweens(c)}))};return this}
function CLaunchBoard(k){var c,e,l,a,f,d;this._init=function(){c={x:CANVAS_WIDTH_HALF+660,y:CANVAS_HEIGHT-60};f=new createjs.Container;f.x=c.x;f.y=c.y;k.addChild(f);e=new createjs.Text("99"+TEXT_OF+NUM_OF_PENALTY,"50px "+FONT_GAME,TEXT_COLOR);e.textAlign="right";e.y=-4;f.addChild(e);f.y=c.y;k.addChild(f);l=new createjs.Text("99"+TEXT_OF+NUM_OF_PENALTY,"50px "+FONT_GAME,TEXT_COLOR_STROKE);l.textAlign="right";l.y=e.y;l.outline=OUTLINE_WIDTH;f.addChild(l);var m=s_oSpriteLibrary.getSprite("shot_left");
a=createBitmap(m);a.x=1.4*-e.getBounds().width;a.regX=.5*m.width;a.regY=10;f.addChild(a);d=f.getBounds();this.updateCache()};this.updateCache=function(){f.cache(-d.width,-d.height,2*d.width,2*d.height)};this.getStartPos=function(){return c};this.setPos=function(a,c){f.x=a;f.y=c};this.refreshTextLaunch=function(c,d){e.text=c+TEXT_OF+d;l.text=e.text;a.x=1.4*-e.getBounds().width;this.updateCache()};this._init();return this}
function CHandSwipeAnim(k,c,e,l){var a,f,d=!1;this._init=function(c){f=new createjs.Container;a=createBitmap(c);a.x=k.x;a.y=k.y;a.regX=.5*c.width;a.regY=.5*c.height;a.alpha=0;l.addChild(f);f.addChild(a)};this.animAllSwipe=function(){d=!0;var e=this;createjs.Tween.get(a).to({alpha:1},.1*MS_TIME_SWIPE_END).wait(.3*MS_TIME_SWIPE_END).to({alpha:0},.5*MS_TIME_SWIPE_END,createjs.Ease.quartOut);createjs.Tween.get(a).to({x:c[0].x,y:c[0].y},MS_TIME_SWIPE_END,createjs.Ease.quartOut).call(function(){a.x=k.x;
a.y=k.y;createjs.Tween.get(a).to({alpha:1},.1*MS_TIME_SWIPE_END).wait(.3*MS_TIME_SWIPE_END).to({alpha:0},.5*MS_TIME_SWIPE_END,createjs.Ease.quartOut);createjs.Tween.get(a).to({x:c[1].x,y:c[1].y},MS_TIME_SWIPE_END,createjs.Ease.quartOut).call(function(){a.x=k.x;a.y=k.y;createjs.Tween.get(a).to({alpha:1},.1*MS_TIME_SWIPE_END).wait(.3*MS_TIME_SWIPE_END).to({alpha:0},.5*MS_TIME_SWIPE_END,createjs.Ease.quartOut);createjs.Tween.get(a).to({x:c[2].x,y:c[2].y},MS_TIME_SWIPE_END,createjs.Ease.quartOut).call(function(){a.x=
k.x;a.y=k.y;e.animAllSwipe()})})})};this.fadeAnim=function(a){createjs.Tween.get(f,{override:!0}).to({alpha:a},250)};this.isAnimate=function(){return d};this.setVisible=function(c){a.visible=c};this.removeTweens=function(){createjs.Tween.removeTweens(a);d=!1};this._init(e);return this}
function CHelpText(k){var c,e,l;this._init=function(){l=new createjs.Container;k.addChild(l);c=new createjs.Text(TEXT_HELP,"42px "+FONT_GAME,TEXT_COLOR);c.x=CANVAS_WIDTH/2;c.y=CANVAS_HEIGHT_HALF;c.textAlign="center";l.addChild(c);e=new createjs.Text(TEXT_HELP,"42px "+FONT_GAME,TEXT_COLOR_STROKE);e.x=CANVAS_WIDTH/2;e.y=c.y;e.textAlign="center";e.outline=OUTLINE_WIDTH;l.addChild(e);l.alpha=0};this.fadeAnim=function(a,c){createjs.Tween.get(l,{override:!0}).to({alpha:a},MS_TIME_FADE_HELP_TEXT).call(function(){null!==
c&&c()},null,this)};this.unload=function(){createjs.Tween.removeTweens(l);k.removeChild(l)};this._init();return this}function CGoal(k,c,e,l){var a,f;this._init=function(c,e,g){a=createBitmap(g);this.setPosition(c,e);a.cache(0,0,g.width,g.height);f.addChild(a)};this.unload=function(){f.removeChild(a)};this.setPosition=function(c,e){a.x=c;a.y=e};this.getDepthPos=function(){return GOAL_SPRITE_SWAP_Y};this.getObject=function(){return a};f=l;this._init(k,c,e);return this};
