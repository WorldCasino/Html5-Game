var s_iOffsetX=0,s_iOffsetY=0,s_fInverseScaling=0,s_fScaleCanvas=0;
(function(a){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))})(navigator.userAgent||
navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(a){console.log(a)}function isIOS(){for(var a="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");a.length;)if(navigator.platform===a.pop())return s_bIsIphone=!0;return s_bIsIphone=!1}window.addEventListener("orientationchange",onOrientationChange);
function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}
function getSize(a){var b=a.toLowerCase(),c=window.document,e=c.documentElement;if(void 0===window["inner"+a])a=e["client"+a];else if(window["inner"+a]!=e["client"+a]){var d=c.createElement("body");d.id="vpw-test-b";d.style.cssText="overflow:scroll";var g=c.createElement("div");g.id="vpw-test-d";g.style.cssText="position:absolute;top:-1000px";g.innerHTML="<style>@media("+b+":"+e["client"+a]+"px){body#vpw-test-b div#vpw-test-d{"+b+":7px!important}}</style>";d.appendChild(g);e.insertBefore(d,c.head);
a=7==g["offset"+a]?e["client"+a]:window["inner"+a];e.removeChild(d)}else a=window["inner"+a];return a}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}function getHeightOfIOSToolbars(){var a=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<a?a:0}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var a;a=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?getIOSWindowHeight():getSize("Height");var b=getSize("Width");_checkOrientation(b,a);s_iScaleFactor=s_fScaleCanvas=Math.min(a/CANVAS_HEIGHT,b/CANVAS_WIDTH);var c=CANVAS_WIDTH*s_iScaleFactor,e=CANVAS_HEIGHT*s_iScaleFactor,d;e<a?(d=a-e,e+=d,c+=CANVAS_WIDTH/CANVAS_HEIGHT*d):c<b&&(d=b-c,c+=d,e+=CANVAS_HEIGHT/CANVAS_WIDTH*d);d=a/2-e/2;var g=b/2-c/2,f=CANVAS_WIDTH/c;if(g*f<-EDGEBOARD_X||
d*f<-EDGEBOARD_Y)s_iScaleFactor=Math.min(a/(CANVAS_HEIGHT-2*EDGEBOARD_Y),b/(CANVAS_WIDTH-2*EDGEBOARD_X)),c=CANVAS_WIDTH*s_iScaleFactor,e=CANVAS_HEIGHT*s_iScaleFactor,d=(a-e)/2,g=(b-c)/2,f=CANVAS_WIDTH/c;s_fInverseScaling=f;s_iOffsetX=-1*g*f;s_iOffsetY=-1*d*f;0<=d&&(s_iOffsetY=0);0<=g&&(s_iOffsetX=0);null!==s_oInterface&&s_oInterface.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);$("#canvas").css("width",c+"px");$("#canvas").css("height",e+"px");
0>d?($("#canvas").css("top",d+"px"),s_iCanvasOffsetHeight=d):($("#canvas").css("top","0px"),s_iCanvasOffsetHeight=0);$("#canvas").css("left",g+"px");resizeCanvas3D();s_iCanvasResizeWidth=c;s_iCanvasResizeHeight=e;s_iCanvasOffsetWidth=g}}
function _checkOrientation(a,b){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(a>b?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),
s_oMain.stopUpdate()))}function inIframe(){try{return window.self!==window.top}catch(a){return!0}}function createBitmap(a,b,c){var e=new createjs.Bitmap(a),d=new createjs.Shape;b&&c?d.graphics.beginFill("#fff").drawRect(-b/2,-c/2,b,c):d.graphics.beginFill("#ff0").drawRect(0,0,a.width,a.height);e.hitArea=d;return e}
function createSprite(a,b,c,e,d,g){a=null!==b?new createjs.Sprite(a,b):new createjs.Sprite(a);b=new createjs.Shape;b.graphics.beginFill("#000000").drawRect(-c,-e,d,g);a.hitArea=b;return a}function randomFloatBetween(a,b,c){"undefined"===typeof c&&(c=2);return parseFloat(Math.min(a+Math.random()*(b-a),b).toFixed(c))}function shuffle(a){for(var b=a.length,c,e;0!==b;)e=Math.floor(Math.random()*b),--b,c=a[b],a[b]=a[e],a[e]=c;return a}
function formatTime(a){a/=1E3;var b=Math.floor(a/60);a=parseFloat(a-60*b).toFixed(1);var c="",c=10>b?c+("0"+b+":"):c+(b+":");return 10>a?c+("0"+a):c+a}function degreesToRadians(a){return a*Math.PI/180}function checkRectCollision(a,b){var c,e;c=getBounds(a,.9);e=getBounds(b,.98);return calculateIntersection(c,e)}
function calculateIntersection(a,b){var c,e,d,g,f,h,k,l;c=a.x+(d=a.width/2);e=a.y+(g=a.height/2);f=b.x+(h=b.width/2);k=b.y+(l=b.height/2);c=Math.abs(c-f)-(d+h);e=Math.abs(e-k)-(g+l);return 0>c&&0>e?(c=Math.min(Math.min(a.width,b.width),-c),e=Math.min(Math.min(a.height,b.height),-e),{x:Math.max(a.x,b.x),y:Math.max(a.y,b.y),width:c,height:e,rect1:a,rect2:b}):null}
function getBounds(a,b){var c={x:Infinity,y:Infinity,width:0,height:0};if(a instanceof createjs.Container){c.x2=-Infinity;c.y2=-Infinity;var e=a.children,d=e.length,g,f;for(f=0;f<d;f++)g=getBounds(e[f],1),g.x<c.x&&(c.x=g.x),g.y<c.y&&(c.y=g.y),g.x+g.width>c.x2&&(c.x2=g.x+g.width),g.y+g.height>c.y2&&(c.y2=g.y+g.height);Infinity==c.x&&(c.x=0);Infinity==c.y&&(c.y=0);Infinity==c.x2&&(c.x2=0);Infinity==c.y2&&(c.y2=0);c.width=c.x2-c.x;c.height=c.y2-c.y;delete c.x2;delete c.y2}else{var h,k;a instanceof createjs.Bitmap?
(d=a.sourceRect||a.image,f=d.width*b,h=d.height*b):a instanceof createjs.Sprite?a.spriteSheet._frames&&a.spriteSheet._frames[a.currentFrame]&&a.spriteSheet._frames[a.currentFrame].image?(d=a.spriteSheet.getFrame(a.currentFrame),f=d.rect.width,h=d.rect.height,e=d.regX,k=d.regY):(c.x=a.x||0,c.y=a.y||0):(c.x=a.x||0,c.y=a.y||0);e=e||0;f=f||0;k=k||0;h=h||0;c.regX=e;c.regY=k;d=a.localToGlobal(0-e,0-k);g=a.localToGlobal(f-e,h-k);f=a.localToGlobal(f-e,0-k);e=a.localToGlobal(0-e,h-k);c.x=Math.min(Math.min(Math.min(d.x,
g.x),f.x),e.x);c.y=Math.min(Math.min(Math.min(d.y,g.y),f.y),e.y);c.width=Math.max(Math.max(Math.max(d.x,g.x),f.x),e.x)-c.x;c.height=Math.max(Math.max(Math.max(d.y,g.y),f.y),e.y)-c.y}return c}function NoClickDelay(a){this.element=a;window.Touch&&this.element.addEventListener("touchstart",this,!1)}
NoClickDelay.prototype={handleEvent:function(a){switch(a.type){case "touchstart":this.onTouchStart(a);break;case "touchmove":this.onTouchMove(a);break;case "touchend":this.onTouchEnd(a)}},onTouchStart:function(a){a.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(a){this.moved=!0},onTouchEnd:function(a){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){a=document.elementFromPoint(a.changedTouches[0].clientX,a.changedTouches[0].clientY);3==a.nodeType&&(a=a.parentNode);var b=document.createEvent("MouseEvents");b.initEvent("click",!0,!0);a.dispatchEvent(b)}}};
(function(){function a(a){var c={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};a=a||window.event;a.type in c?document.body.className=c[a.type]:(document.body.className=this[b]?"hidden":"visible","hidden"===document.body.className?s_oMain.stopUpdate():s_oMain.startUpdate())}var b="hidden";b in document?document.addEventListener("visibilitychange",a):(b="mozHidden")in document?document.addEventListener("mozvisibilitychange",a):(b="webkitHidden")in
document?document.addEventListener("webkitvisibilitychange",a):(b="msHidden")in document?document.addEventListener("msvisibilitychange",a):"onfocusin"in document?document.onfocusin=document.onfocusout=a:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=a})();function playSound(a,b,c){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?createjs.Sound.play(a,{loop:c,volume:b}):null}function stopSound(a){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||a.stop()}
function setVolume(a,b){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)a.volume=b}function setMute(a,b){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||a.setMute(b)}function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}function getParamValue(a){for(var b=window.location.search.substring(1).split("&"),c=0;c<b.length;c++){var e=b[c].split("=");if(e[0]==a)return e[1]}}
function rotateVector2D(a,b){return{x:b.x*Math.cos(a)+b.y*Math.sin(a),y:b.x*-Math.sin(a)+b.y*Math.cos(a)}}function normalize(a,b){0<b&&(a.x/=b,a.y/=b);return a}function length(a){return Math.sqrt(a.x*a.x+a.y*a.y)}function findNearestIntersectingObject(a,b,c,e){var d=CANVAS_RESIZE_WIDTH+2*OFFSET_WIDTH,g=CANVAS_RESIZE_HEIGHT+2*OFFSET_HEIGHT,f=new THREE.Raycaster,h=new THREE.Vector3;h.x=a/d*2-1;h.y=2*-(b/g)+1;h.z=.5;f.setFromCamera(h,c);a=f.intersectObjects(e,!0);b=!1;0<a.length&&(b=a[0]);return b}
function distance(a,b,c,e){a-=c;b-=e;return Math.sqrt(a*a+b*b)}function distance2(a,b,c,e){a-=c;b-=e;return a*a+b*b}function resizeCanvas3D(){$("canvas").each(function(){"#canvas"!=$(this).attr("id")&&($(this).css("width",$("#canvas").css("width")),$(this).css("height",$("#canvas").css("height")),$(this).css("position",$("#canvas").css("position")),$(this).css("left",$("#canvas").css("left")),$(this).css("top",$("#canvas").css("top")))})}
function createOrthoGraphicCamera(){var a=new THREE.PerspectiveCamera(FOV,CANVAS_WIDTH/CANVAS_HEIGHT,NEAR,FAR);a.rotation.x=Math.PI/180*CAMERA_PROPERTIES.rot_x;a.rotation.y=Math.PI/180*CAMERA_PROPERTIES.rot_y;a.rotation.z=Math.PI/180*CAMERA_PROPERTIES.rot_z;a.position.set(CAMERA_PROPERTIES.x,CAMERA_PROPERTIES.y,CAMERA_PROPERTIES.z);a.updateProjectionMatrix();a.updateMatrixWorld();return a}
function rotateVector2D(a,b){return{x:b.x*Math.cos(a)+b.y*Math.sin(a),y:b.x*-Math.sin(a)+b.y*Math.cos(a),z:0}}Math.radians=function(a){return a*Math.PI/180};Math.degrees=function(a){return 180/Math.PI*a};function distanceV3(a,b,c,e,d,g){a-=e;b-=d;c-=g;return Math.sqrt(a*a+b*b+c*c)}function distanceV2(a,b){var c=a.x-b.x,e=a.y-b.y;return Math.sqrt(c*c+e*e)}function saveItem(a,b){localStorage.setItem(a,b)}function getItem(a){return localStorage.getItem(a)}
function clearAllItem(){localStorage.clear()}
function CSpriteLibrary(){var a,b,c,e,d,g;this.init=function(f,h,k){c=b=0;e=f;d=h;g=k;a={}};this.addSprite=function(c,d){a.hasOwnProperty(c)||(a[c]={szPath:d,oSprite:new Image},b++)};this.getSprite=function(b){return a.hasOwnProperty(b)?a[b].oSprite:null};this._onSpritesLoaded=function(){d.call(g)};this._onSpriteLoaded=function(){e.call(g);++c==b&&this._onSpritesLoaded()};this.loadSprites=function(){for(var b in a)a[b].oSprite.oSpriteLibrary=this,a[b].oSprite.onload=function(){this.oSpriteLibrary._onSpriteLoaded()},
a[b].oSprite.src=a[b].szPath};this.getNumSprites=function(){return b}}
var CANVAS_WIDTH=790,CANVAS_HEIGHT=1410,CANVAS_WIDTH_HALF=.5*CANVAS_WIDTH,CANVAS_HEIGHT_HALF=.5*CANVAS_HEIGHT,EDGEBOARD_X=150,EDGEBOARD_Y=212,DISABLE_SOUND_MOBILE=!1,FONT_GAME="Arial",SECONDARY_FONT="blackplotanregular",MS_FADE_SOUNDTRACK=750,FPS=30,FPS_DESKTOP=60,FPS_TIME=1/FPS,ROLL_BALL_RATE=60/FPS,TIME_REFRESH_DIRECTION=.05,TIME_RESET_LAUNCH=3,DIRECTION_VELOCITY=-2,DIRECTION_CHARACTER_VELOCITY=6,LAUNCH_TURN=10,TURNS_BOARD_POS={x:0,y:362},NUM_SPRITE_MONITOR=52,NUM_SPRITE_PLAYER=36,CHARACTER_START_POS=
{x:40,y:702},STATE_LOADING=0,STATE_MENU=1,STATE_HELP=1,STATE_GAME=3,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,ON_TWEEN_ENDED=6,ON_BUT_NO_DOWN=7,ON_BUT_YES_DOWN=8,STEP_RATE=1,TEXT_SIZE=[80,100,130],TEXT_EXCELLENT_COLOR=["#fff","#5d96fe"],TEXT_COLOR="#ffffff",TEXT_COLOR_STROKE="#000000",TIME_INTERVAL_STROBE=.2,PHYSICS_ACCURACY=3,BALL_VELOCITY_MULTIPLIER=1,PHYSICS_STEP=1/(FPS*STEP_RATE),STATE_INIT=0,STATE_PLAY=1,STATE_FINISH=2,STATE_PAUSE=3,TIME_REFRESH_POSITION,
MONITOR_STRIKE=0,MONITOR_SPARE=1,MONITOR_GUTTER=2,BALL_MASS=49,BALL_RADIUS=12.5,BALL=0,PINS=1,WALL=2,FLOOR=3,CHANNEL=4,PINS_FLOOR=4,WALL_TRACK=5,SIDE_PINS_FLOOR=6,BALL_LINEAR_DAMPING=0,OFFSET_BALL_POS_X=10,OBJECT,MIN_BALL_VEL_ROTATION=.1,FOV=40,INTERVAL_SHOOT=1,DIRECTION=0,POWER=1,EFFECT=2,EFFECT_POWER_RATE=-(.4*STEP_RATE),MIN_FORCE_BALL_GUTTER=-30,MAX_EFFECT_ANGLE=45,MONITOR_WAIT_TIME=1,LIMIT_HAND_RANGE_POS={x:35.2},POSITION_BALL={x:0,y:900,z:-7+BALL_RADIUS},GOAL_LINE_POS={x:0,y:31,z:-2.7},HAND_KEEPER_SIZE=
{width:1.8,depth:.5,height:1.5},WALL_PINS_SIZE={width:80,depth:1,height:150},WALL_PINS_DOWN_SIZE={width:80,depth:100,height:1},WALL_PINS_FORWARD_SIZE={width:80,depth:2,height:77},WALL_PINS_POSITION={x:0,y:-1105,z:-27},WALL_TRACK_POSITION={x:0,y:0,z:20},WALL_TRACK_SIZE={width:1,depth:905,height:100,offsetX:82},ROOF_TRACK_SIZE={width:82,depth:70,height:1,offsetY:-835},SIDE_WALL_PINS_SIZE={width:1,depth:100,height:150},FLOOR_PINS_SIZE={width:53,depth:875,height:20},FLOOR_WALL_PINS_SIZE={width:80,depth:1,
height:100},FLOOR_WALL_PINS_POSITION={x:0,y:-765,z:20},FLOOR_PINS_POSITION={x:0,y:-39,z:-29},PINS_BINDER_PROPERTIES={width:75,depth:2,height:25},PINS_BINDER_POSITION={x:0,y:-750,z:10},SENSOR_POSITION={x:0,y:-1005,z:-175},SENSOR_SIZE={width:75,depth:95,height:1},WALL_TRACK_DEPTH_SIZE={width:100,depth:1,height:100},WALL_TRACK_DEPTH_POSITION={x:0,y:-914,z:0},FLOOR_PINS_SIDE_PROPERTIES={width:15,depth:FLOOR_PINS_SIZE.depth,height:1,rot:Math.radians(0)},PIN_PROPERTY={radius_top:8,radius_bottom:7,height:50,
segments:7,mass:2.52015625,linearDamping:.01,angularDamping:.5},PIN_DIAMETER=2*PIN_PROPERTY.radius_top,BALL_PROPERTY={mass:BALL_MASS,linearDamping:0,angularDamping:.05},OFFSET_TRACK_POSITION={x:0,y:0,z:-9},PINS_POSITION_Z=OFFSET_TRACK_POSITION.z+.5*PIN_PROPERTY.height,FIRST_PIN_POSITION=-810,DISTANCE_PIN_OFFSET=.75,MIN_VELOCITY_PINS=.1,DISTANCE_PIN_Y=-5,PIN_BINDER_TO_Y=-950,PINS_POSITION=[{x:0,y:FIRST_PIN_POSITION,z:PINS_POSITION_Z},{x:PIN_DIAMETER*DISTANCE_PIN_OFFSET,y:FIRST_PIN_POSITION+DISTANCE_PIN_Y-
PIN_DIAMETER,z:PINS_POSITION_Z},{x:-PIN_DIAMETER*DISTANCE_PIN_OFFSET,y:FIRST_PIN_POSITION+DISTANCE_PIN_Y-PIN_DIAMETER,z:PINS_POSITION_Z},{x:-PIN_DIAMETER*DISTANCE_PIN_OFFSET*2,y:FIRST_PIN_POSITION+2*(DISTANCE_PIN_Y-PIN_DIAMETER),z:PINS_POSITION_Z},{x:0,y:FIRST_PIN_POSITION+2*(DISTANCE_PIN_Y-PIN_DIAMETER),z:PINS_POSITION_Z},{x:PIN_DIAMETER*DISTANCE_PIN_OFFSET*2,y:FIRST_PIN_POSITION+2*(DISTANCE_PIN_Y-PIN_DIAMETER),z:PINS_POSITION_Z},{x:PIN_DIAMETER*DISTANCE_PIN_OFFSET*3,y:FIRST_PIN_POSITION+3*(DISTANCE_PIN_Y-
PIN_DIAMETER),z:PINS_POSITION_Z},{x:PIN_DIAMETER*DISTANCE_PIN_OFFSET,y:FIRST_PIN_POSITION+3*(DISTANCE_PIN_Y-PIN_DIAMETER),z:PINS_POSITION_Z},{x:-PIN_DIAMETER*DISTANCE_PIN_OFFSET,y:FIRST_PIN_POSITION+3*(DISTANCE_PIN_Y-PIN_DIAMETER),z:PINS_POSITION_Z},{x:-PIN_DIAMETER*DISTANCE_PIN_OFFSET*3,y:FIRST_PIN_POSITION+3*(DISTANCE_PIN_Y-PIN_DIAMETER),z:PINS_POSITION_Z}],OFFSET_FIELD_Y=35,OFFSET_FIELD_X=35,MAX_LAUNCH_FORCE=200*BALL_MASS,MIN_LAUNCH_FORCE=.8*BALL_MASS,FORCE_RATE=2.5*BALL_MASS,PINS_REFLECTION_LIMIT=
.35,BALL_SCALE_FACTOR=.14,PIN_ALPHA_FACTOR=.9,PIN_SCALE_FACTOR=.3,SHADOW_SCALE_FACTOR=18.5,FADE_PIN_FACTOR=WALL_TRACK_DEPTH_POSITION.y-.01,BOARD_SCALE_F=.25,PIN_REF_REGY_FACTOR=20,BUFFER_ANIM_MONITOR=FPS/30*20,BUFFER_ANIM_PLAYER=FPS/20,SHOW_3D_RENDER=!1,SHOW_DEPTH_TRACK_MODEL=!1,CAMERA_TEST_TRACKBALL=!0,CAMERA_TEST_TRANSFORM=!1,PIN_TEST=!1,SHOW_PROXY_COLLISION=!1,CAMERA_TEST_LOOK_AT={x:0,y:-500,z:-100},OPACITY_INTENSITY_3D=1,PINS_PROPERTIES_TEST={x:0,y:250,z:PINS_POSITION_Z+20},BALL_Z_FORCE_RANGE=
{min:3,max:10},CAMERA_PROPERTIES={x:0,y:1500,z:300,rot_x:105,rot_y:180,rot_z:0},NEAR=10,FAR=4E3,ENABLE_FULLSCREEN,ENABLE_CHECK_ORIENTATION;TEXT_GAMEOVER="GAME OVER";TEXT_SCORE="TOTAL SCORE";TEXT_HELP1_PC="PRESS SPACE BAR TO SWITCH";TEXT_HELP1_MOBILE="TOUCH DISPLAY TO SWITCH";TEXT_POWER="POWER";TEXT_EFFECT="EFFECT";TEXT_TOTAL="TOTAL";TEXT_ARE_SURE="ARE YOU SURE?";TEXT_CREDITS_DEVELOPED="DEVELOPED BY";TEXT_LINK1="WWW.CODETHISLAB.COM";TEXT_MOVE="MOVE";TEXT_SHARE_IMAGE="200x200.jpg";
TEXT_SHARE_TITLE="Congratulations!";TEXT_SHARE_MSG1="You collected <strong>";TEXT_SHARE_MSG2=" points</strong>!<br><br>Share your score with your friends!";TEXT_SHARE_SHARE1="My score is ";TEXT_SHARE_SHARE2=" points! Can you do better?";
function CPreloader(){var a,b,c,e,d,g,f,h;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png");s_oSpriteLibrary.loadSprites();h=new createjs.Container;s_oStage.addChild(h)};this.unload=function(){h.removeAllChildren()};this.hide=function(){var a=this;setTimeout(function(){createjs.Tween.get(f).to({alpha:1},500).call(function(){a.unload();
s_oMain.gotoMenu()})},1E3)};this._onImagesLoaded=function(){};this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};this.attachSprites=function(){var k=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));h.addChild(k);k=s_oSpriteLibrary.getSprite("progress_bar");d=createBitmap(k);d.x=CANVAS_WIDTH/2-k.width/2;d.y=CANVAS_HEIGHT-300;h.addChild(d);a=k.width;b=k.height;g=new createjs.Shape;g.graphics.beginFill("rgba(255,255,255,0.01)").drawRect(d.x,d.y,1,b);h.addChild(g);d.mask=
g;c=new createjs.Text("","30px "+FONT_GAME,"#fff");c.x=CANVAS_WIDTH/2;c.y=CANVAS_HEIGHT-300;c.textBaseline="alphabetic";c.textAlign="center";h.addChild(c);e=new createjs.Text("","30px "+SECONDARY_FONT,"#fff");e.x=CANVAS_WIDTH+200;e.y=CANVAS_HEIGHT+200;e.textBaseline="alphabetic";e.textAlign="center";h.addChild(e);f=new createjs.Shape;f.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);f.alpha=0;h.addChild(f)};this.refreshLoader=function(f){c.text=f+"%";e.text=f+"%";g.graphics.clear();
f=Math.floor(f*a/100);g.graphics.beginFill("rgba(255,255,255,0.01)").drawRect(d.x,d.y,f,b)};this._init()}
function CMain(a){var b,c=0,e=0,d=STATE_LOADING,g,f,h;this.initContainer=function(){var a=document.getElementById("canvas");s_oStage=new createjs.Stage(a);createjs.Touch.enable(s_oStage);s_oStage.preventSelection=!1;s_bMobile=jQuery.browser.mobile;!1===s_bMobile?(s_oStage.enableMouseOver(20),$("body").on("contextmenu","#canvas",function(a){return!1}),FPS=FPS_DESKTOP,FPS_TIME=1/FPS,BUFFER_ANIM_MONITOR=FPS/30*20,PHYSICS_STEP=1/(FPS*STEP_RATE),ROLL_BALL_RATE=60/FPS):BALL_VELOCITY_MULTIPLIER=.8;s_iPrevTime=
(new Date).getTime();createjs.Ticker.addEventListener("tick",this._update);createjs.Ticker.setFPS(FPS);navigator.userAgent.match(/Windows Phone/i)&&(DISABLE_SOUND_MOBILE=!0);s_oSpriteLibrary=new CSpriteLibrary;f=new CPreloader;b=!0};this.soundLoaded=function(){c++;f.refreshLoader(Math.floor(c/e*100));if(c===e){f.unload();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)s_oSoundTrack=createjs.Sound.play("soundtrack",{loop:-1});this.gotoMenu()}};this._initSounds=function(){createjs.Sound.initializeDefaultPlugins()&&
(0<navigator.userAgent.indexOf("Opera")||0<navigator.userAgent.indexOf("OPR")?(createjs.Sound.alternateExtensions=["mp3"],createjs.Sound.addEventListener("fileload",createjs.proxy(this.soundLoaded,this)),createjs.Sound.registerSound("./sounds/click.ogg","click"),createjs.Sound.registerSound("./sounds/ball_hitting.ogg","ball_hitting"),createjs.Sound.registerSound("./sounds/soundtrack.ogg","soundtrack"),createjs.Sound.registerSound("./sounds/ball_crash.ogg","ball_crash"),createjs.Sound.registerSound("./sounds/binder.ogg",
"binder"),createjs.Sound.registerSound("./sounds/pin_hitted.ogg","pin_hitted"),createjs.Sound.registerSound("./sounds/gingle_gutterball.ogg","gingle_gutterball"),createjs.Sound.registerSound("./sounds/gingle_spare.ogg","gingle_spare"),createjs.Sound.registerSound("./sounds/gingle_strike.ogg","gingle_strike"),createjs.Sound.registerSound("./sounds/ambience.ogg","ambience")):(createjs.Sound.alternateExtensions=["ogg"],createjs.Sound.addEventListener("fileload",createjs.proxy(this.soundLoaded,this)),
createjs.Sound.registerSound("./sounds/click.mp3","click"),createjs.Sound.registerSound("./sounds/ball_hitting.mp3","ball_hitting"),createjs.Sound.registerSound("./sounds/soundtrack.mp3","soundtrack"),createjs.Sound.registerSound("./sounds/ball_crash.mp3","ball_crash"),createjs.Sound.registerSound("./sounds/binder.mp3","binder"),createjs.Sound.registerSound("./sounds/pin_hitted.mp3","pin_hitted"),createjs.Sound.registerSound("./sounds/gingle_gutterball.mp3","gingle_gutterball"),createjs.Sound.registerSound("./sounds/gingle_spare.mp3",
"gingle_spare"),createjs.Sound.registerSound("./sounds/gingle_strike.mp3","gingle_strike"),createjs.Sound.registerSound("./sounds/ambience.mp3","ambience")),e+=10)};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("but_play","./sprites/but_play.png");s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png");s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png");
s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png");s_oSpriteLibrary.addSprite("but_home","./sprites/but_home.png");s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png");s_oSpriteLibrary.addSprite("ball","./sprites/ball.png");s_oSpriteLibrary.addSprite("but_continue","./sprites/but_continue.png");s_oSpriteLibrary.addSprite("but_yes","./sprites/but_yes.png");s_oSpriteLibrary.addSprite("but_no","./sprites/but_no.png");s_oSpriteLibrary.addSprite("but_info","./sprites/but_info.png");
s_oSpriteLibrary.addSprite("logo_ctl","./sprites/logo_ctl.png");s_oSpriteLibrary.addSprite("arrow_right","./sprites/arrow_right.png");s_oSpriteLibrary.addSprite("arrow_left","./sprites/arrow_left.png");s_oSpriteLibrary.addSprite("ball_shadow","./sprites/ball_shadow.png");s_oSpriteLibrary.addSprite("pin","./sprites/pin.png");s_oSpriteLibrary.addSprite("ball_ref","./sprites/ball_ref.png");s_oSpriteLibrary.addSprite("bg_help","./sprites/bg_help.png");s_oSpriteLibrary.addSprite("power_bar_bg","./sprites/power_bar_bg.png");
s_oSpriteLibrary.addSprite("power_bar_fill","./sprites/power_bar_fill.png");s_oSpriteLibrary.addSprite("power_bar_frame","./sprites/power_bar_frame.png");s_oSpriteLibrary.addSprite("effect_arrow","./sprites/effect_arrow.png");s_oSpriteLibrary.addSprite("key_left","./sprites/key_left.png");s_oSpriteLibrary.addSprite("key_right","./sprites/key_right.png");s_oSpriteLibrary.addSprite("turn_board","./sprites/turn_board.png");s_oSpriteLibrary.addSprite("bowling_track","./sprites/bowling_track.png");s_oSpriteLibrary.addSprite("monitor",
"./sprites/monitor.jpg");s_oSpriteLibrary.addSprite("pattern_monitor","./sprites/pattern_monitor.png");s_oSpriteLibrary.addSprite("pin_binder","./sprites/pin_binder.png");s_oSpriteLibrary.addSprite("semaphore","./sprites/semaphore.png");s_oSpriteLibrary.addSprite("total_board","./sprites/total_board.png");s_oSpriteLibrary.addSprite("last_turn_board","./sprites/last_turn_board.png");s_oSpriteLibrary.addSprite("but_fullscreen","./sprites/but_fullscreen.png");for(var a=0;a<NUM_SPRITE_MONITOR;a++)s_oSpriteLibrary.addSprite("monitor_strike_"+
a,"./sprites/monitor_strike/monitor_strike_"+a+".jpg"),s_oSpriteLibrary.addSprite("monitor_spare_"+a,"./sprites/monitor_spare/monitor_spare_"+a+".jpg"),s_oSpriteLibrary.addSprite("monitor_gutterball_"+a,"./sprites/monitor_gutterball/monitor_gutterball_"+a+".jpg");for(a=0;a<NUM_SPRITE_PLAYER;a++)s_oSpriteLibrary.addSprite("player_"+a,"./sprites/player_anim/player_"+a+".png");e+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=function(){c++;f.refreshLoader(Math.floor(c/
e*100));if(c===e){f.unload();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)s_oSoundTrack=createjs.Sound.play("soundtrack",{loop:-1});this.gotoMenu()}};this._onAllImagesLoaded=function(){};this.onAllPreloaderImagesLoaded=function(){this._loadImages()};this.preloaderReady=function(){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)this._initSounds(),s_oSoundTrack=createjs.Sound.play("soundtrack",{loop:-1});this._loadImages();b=!0};this.gotoMenu=function(){new CMenu;d=STATE_MENU};this.gotoGame=function(){h=
new CGame(g);d=STATE_GAME};this.gotoHelp=function(){new CHelp;d=STATE_HELP};this.stopUpdate=function(){b=!1;createjs.Ticker.paused=!0;$("#block_game").css("display","block");createjs.Sound.setMute(!0)};this.startUpdate=function(){s_iPrevTime=(new Date).getTime();b=!0;createjs.Ticker.paused=!1;$("#block_game").css("display","none");s_bAudioActive&&createjs.Sound.setMute(!1)};this._update=function(a){if(!1!==b){var c=(new Date).getTime();s_iTimeElaps=c-s_iPrevTime;s_iCntTime+=s_iTimeElaps;s_iCntFps++;
s_iPrevTime=c;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);d===STATE_GAME&&h.update();s_oStage.update(a)}};s_oMain=this;g=a;ENABLE_CHECK_ORIENTATION=a.check_orientation;this.initContainer()}var s_bMobile,s_bAudioActive=!0,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_iCanvasResizeHeight,s_iCanvasResizeWidth,s_iCanvasOffsetHeight,s_iCanvasOffsetWidth,s_iAdsLevel=1,s_oDrawLayer,s_oStage,s_oMain,s_oSpriteLibrary,s_oSoundTrack,s_bFullscreen=!1;
function CTextButton(a,b,c,e,d,g,f){var h,k,l;this._init=function(a,b,c,d,f,e,g){h=[];k=[];var p=createBitmap(c),m=Math.ceil(g/20),n=new createjs.Text(d,"bold "+g+"px "+f,"#000000");n.textAlign="center";n.textBaseline="alphabetic";var q=n.getBounds();n.x=c.width/2+m;n.y=Math.floor(c.height/2)+q.height/3+m;d=new createjs.Text(d,"bold "+g+"px "+f,e);d.textAlign="center";d.textBaseline="alphabetic";q=d.getBounds();d.x=c.width/2;d.y=Math.floor(c.height/2)+q.height/3;l=new createjs.Container;l.x=a;l.y=
b;l.regX=c.width/2;l.regY=c.height/2;l.addChild(p,n,d);s_bMobile||(l.cursor="pointer");s_oStage.addChild(l);this._initListener()};this.unload=function(){l.off("mousedown");l.off("pressup");s_oStage.removeChild(l)};this.setVisible=function(a){l.visible=a};this._initListener=function(){oParent=this;l.on("mousedown",this.buttonDown);l.on("pressup",this.buttonRelease)};this.addEventListener=function(a,b,c){h[a]=b;k[a]=c};this.buttonRelease=function(){l.scaleX=1;l.scaleY=1;playSound("click",1,0);h[ON_MOUSE_UP]&&
h[ON_MOUSE_UP].call(k[ON_MOUSE_UP])};this.buttonDown=function(){l.scaleX=.9;l.scaleY=.9;h[ON_MOUSE_DOWN]&&h[ON_MOUSE_DOWN].call(k[ON_MOUSE_DOWN])};this.setPosition=function(a,b){l.x=a;l.y=b};this.setX=function(a){l.x=a};this.setY=function(a){l.y=a};this.getButtonImage=function(){return l};this.getX=function(){return l.x};this.getY=function(){return l.y};this._init(a,b,c,e,d,g,f);return this}
function CToggle(a,b,c,e,d){var g,f,h,k,l;this._init=function(a,b,c,d,e){l=void 0!==e?e:s_oStage;f=[];h=[];e=new createjs.SpriteSheet({images:[c],frames:{width:c.width/2,height:c.height,regX:c.width/2/2,regY:c.height/2},animations:{state_true:[0],state_false:[1]}});g=d;k=createSprite(e,"state_"+g,c.width/2/2,c.height/2,c.width/2,c.height);k.x=a;k.y=b;k.stop();s_bMobile||(k.cursor="pointer");l.addChild(k);this._initListener()};this.unload=function(){k.off("mousedown",this.buttonDown);k.off("pressup",
this.buttonRelease);l.removeChild(k)};this._initListener=function(){k.on("mousedown",this.buttonDown);k.on("pressup",this.buttonRelease)};this.addEventListener=function(a,b,c){f[a]=b;h[a]=c};this.setCursorType=function(a){k.cursor=a};this.setActive=function(a){g=a;k.gotoAndStop("state_"+g)};this.buttonRelease=function(){k.scaleX=1;k.scaleY=1;playSound("click",1,0);g=!g;k.gotoAndStop("state_"+g);f[ON_MOUSE_UP]&&f[ON_MOUSE_UP].call(h[ON_MOUSE_UP],g)};this.buttonDown=function(){k.scaleX=.9;k.scaleY=
.9;f[ON_MOUSE_DOWN]&&f[ON_MOUSE_DOWN].call(h[ON_MOUSE_DOWN])};this.setPosition=function(a,b){k.x=a;k.y=b};this._init(a,b,c,e,d)}
function CGfxButton(a,b,c,e){var d,g,f,h,k,l,n,q,m,p=!1,r;this._init=function(a,b,c){d=[];g=[];h=[];f=createBitmap(c);f.x=a;f.y=b;l=k=1;f.regX=c.width/2;f.regY=c.height/2;s_bMobile||(f.cursor="pointer");r.addChild(f);this._initListener()};this.unload=function(){f.off("mousedown",q);f.off("pressup",m);r.removeChild(f)};this.setVisible=function(a){f.visible=a};this.setCursorType=function(a){f.cursor=a};this._initListener=function(){q=f.on("mousedown",this.buttonDown);m=f.on("pressup",this.buttonRelease)};
this.addEventListener=function(a,b,c){d[a]=b;g[a]=c};this.addEventListenerWithParams=function(a,b,c,f){d[a]=b;g[a]=c;h[a]=f};this.buttonRelease=function(){p||(f.scaleX=0<k?1:-1,f.scaleY=1,playSound("click",1,0),d[ON_MOUSE_UP]&&d[ON_MOUSE_UP].call(g[ON_MOUSE_UP],h[ON_MOUSE_UP]))};this.buttonDown=function(){p||(f.scaleX=0<k?.9:-.9,f.scaleY=.9,d[ON_MOUSE_DOWN]&&d[ON_MOUSE_DOWN].call(g[ON_MOUSE_DOWN],h[ON_MOUSE_DOWN]))};this.rotation=function(a){f.rotation=a};this.getButton=function(){return f};this.setPosition=
function(a,b){f.x=a;f.y=b};this.setX=function(a){f.x=a};this.setY=function(a){f.y=a};this.getButtonImage=function(){return f};this.block=function(a){p=a;f.scaleX=k;f.scaleY=l};this.setScaleX=function(a){k=f.scaleX=a};this.getX=function(){return f.x};this.getY=function(){return f.y};this.pulseAnimation=function(){createjs.Tween.get(f).to({scaleX:.9*k,scaleY:.9*l},850,createjs.Ease.quadOut).to({scaleX:k,scaleY:l},650,createjs.Ease.quadIn).call(function(){n.pulseAnimation()})};this.trebleAnimation=function(){createjs.Tween.get(f).to({rotation:5},
75,createjs.Ease.quadOut).to({rotation:-5},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750).call(function(){n.trebleAnimation()})};this.removeAllTweens=function(){createjs.Tween.removeTweens(f)};r=void 0!==e?e:s_oStage;this._init(a,b,c);n=this;return this}
function CMenu(){var a,b,c,e,d,g,f,h,k,l,n,q,m,p,r,t=null,w=null;this._init=function(){k=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(k);var v=s_oSpriteLibrary.getSprite("but_play");d=CANVAS_WIDTH/2;g=CANVAS_HEIGHT-340;l=createBitmap(v);l.x=d;l.y=g;l.regX=.5*v.width;l.regY=.5*v.height;s_oStage.addChild(l);n=new createjs.Shape;n.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(d-l.regX,g-l.regY,184,184);n.on("mousedown",this._onMouseDownHitArea,this,!0);n.on("pressup",this._onButPlayRelease,
this,!0);n.cursor="pointer";s_oStage.addChild(n);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)v=s_oSpriteLibrary.getSprite("audio_icon"),f=CANVAS_WIDTH-v.height/2-10,h=v.height/2+10,p=new CToggle(f,h,v,s_bAudioActive),p.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);v=s_oSpriteLibrary.getSprite("but_info");c=v.height/2+10;e=v.height/2+10;q=new CGfxButton(c,e,v,s_oStage);q.addEventListener(ON_MOUSE_UP,this._onButInfoRelease,this);var v=window.document,u=v.documentElement;t=u.requestFullscreen||
u.mozRequestFullScreen||u.webkitRequestFullScreen||u.msRequestFullscreen;w=v.exitFullscreen||v.mozCancelFullScreen||v.webkitExitFullscreen||v.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(t=!1);t&&!1===inIframe()&&(v=s_oSpriteLibrary.getSprite("but_fullscreen"),a=c+v.width/2+10,b=v.height/2+10,r=new CToggle(a,b,v,s_bFullscreen,s_oStage),r.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));m=new createjs.Shape;m.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(m);
createjs.Tween.get(m).to({alpha:0},1E3).call(function(){m.visible=!1});this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this._onMouseDownHitArea=function(){l.scaleX=l.scaleY=.9};this.refreshButtonPos=function(d,g){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||p.setPosition(f-d,g+h);t&&!1===inIframe()&&r.setPosition(a+d,b+g);q.setPosition(c+d,e+g)};this.unload=function(){n.removeAllEventListeners();n=null;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)p.unload(),p=null;t&&!1===inIframe()&&r.unload();s_oStage.removeAllChildren();
s_oMenu=null};this._onButPlayRelease=function(){l.scaleX=l.scaleY=1;this.unload();playSound("click",1,0);s_oMain.gotoGame()};this._onAudioToggle=function(){createjs.Sound.setMute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onButInfoRelease=function(){new CCreditsPanel};this._onFullscreenRelease=function(){s_bFullscreen?(w.call(window.document),s_bFullscreen=!1):(t.call(window.document.documentElement),s_bFullscreen=!0);sizeHandler()};s_oMenu=this;this._init()}var s_oMenu=null;
function CGame(a){function b(a){A||ea!==STATE_PLAY||u||(V===DIRECTION&&(37===a.keyCode?(s_oGame.onLeft(),A=!0):39===a.keyCode&&(s_oGame.onRight(),A=!0)),32===a.keyCode&&(s_oGame.manageControl(),A=!0));a.preventDefault();return!1}function c(a){A&&ea===STATE_PLAY&&(V===DIRECTION&&(37===a.keyCode?(A=!1,s_oGame.dirKeyUp()):39===a.keyCode&&(A=!1,s_oGame.dirKeyUp())),32===a.keyCode&&(A=!1));a.preventDefault();return!1}var e,d,g,f,h,k,l,n,q,m,p,r,t,w,v,u=!1,z=!1,x=!1,A=!1,y=!1,B=!1,C=!1,F=!1,H=!1,K=!1,M=
!1,O=!1,I=!1,D=!0,J=!1,N=!1,S=!1,Q=!1,R,G=1,P=2,T=0,V=DIRECTION,Y,W,ba,L,U,Z,ca,ea=STATE_INIT,da=null;this._init=function(){this.pause(!0);W=Y=R=0;$(s_oMain).trigger("start_session");$(s_oMain).trigger("start_level",1);ba=[];L=[];v=playSound("ambience",1,-1);this.resetScoreStageArray();p=new createjs.Container;s_oStage.addChild(p);q=new CScenario;h=new createjs.Shape;h.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,460);p.addChild(h);d=new CTrack(0,362,s_oSpriteLibrary.getSprite("bowling_track"),
q.getTrackBodyDepth(),p);ba.push(d);r=new CPowerBar(100,CANVAS_HEIGHT_HALF+225,s_oStage);r.setVisible(!1);var a=s_oSpriteLibrary.getSprite("effect_arrow");t=new CEffectArray(CANVAS_WIDTH+10,CANVAS_HEIGHT_HALF+430,a,s_oStage);t.setVisible(!1);da=SHOW_3D_RENDER?camera:createOrthoGraphicCamera();q.ballBody().mass=0;for(var a=s_oSpriteLibrary.getSprite("pin"),w=0;w<PINS_POSITION.length;w++)L[w]=new CPin(0,0,a,q.getPinByID(w),p),ba.push(L[w]),L[w].setPosRef(OFFSET_TRACK_POSITION.z);PIN_TEST&&(L.push(new CPin(0,
0,a,q.getPinByID(w),p)),ba.push(L[L.length-1]),L[L.length-1].getPhysics().quaternion.setFromEuler(Math.radians(0),Math.radians(0),Math.radians(0),"XYZ"),L[L.length-1].getPhysics().mass=0);a=s_oSpriteLibrary.getSprite("ball");m=new CBall(0,0,a,q.ballBody(),p);m.setVisible(!1);ba.push(m);resizeCanvas3D();a=s_oSpriteLibrary.getSprite("pin_binder");k=new CPinDragger(397,470,a,p);k.setVisible(!1);k.changeState("throw_pins_0");!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||createjs.Tween.get(s_oSoundTrack).to({volume:0},
MS_FADE_SOUNDTRACK);a=s_oSpriteLibrary.getSprite("monitor");g=createBitmap(a);g.y=225;p.addChild(g);a=s_oSpriteLibrary.getSprite("semaphore");l=new CSemaphore(CANVAS_WIDTH_HALF+3,381,a,p);n=new CCharacter(CHARACTER_START_POS.x,CHARACTER_START_POS.y,p);e=new CInterface;f=new CAnimMonitor(0,291,e.getContainerBoard());s_bMobile||(document.onkeydown=b,document.onkeyup=c);if(SHOW_3D_RENDER)this.onExitHelp();else e.createHelpPanel()};this.resetScoreStageArray=function(){U=[];for(var a=0;a<LAUNCH_TURN;a++)U[a]=
[]};this.refreshPos=function(a,b){r.setPosition(r.getStartPos().x+a,r.getStartPos().y-b);t.setPosition(t.getStartPos().x-a,t.getStartPos().y-b)};this.startPinsPosition=function(){this.updatePinsPosition();for(var a=0;a<L.length;a++)L[a].setStartPos(L[a].getX(),L[a].getY())};this.onMouseDown=function(){V===DIRECTION?(s_oGame.deactiveEventMouseMove(),s_oGame.activeStateLaunchPower()):V===POWER?(r.removeTweensMask(),s_oGame.activeStateLaunchEffect()):V===EFFECT&&(s_oGame.launchBall(),V=DIRECTION)};this.manageControl=
function(){u||(V===DIRECTION?(e.dirArrowsVisibility(!1),C=!1,s_oGame.activeStateLaunchPower()):V===POWER?(r.removeTweensMask(),s_oGame.activeStateLaunchEffect()):V===EFFECT&&(t.stopAnimation(),t.removeAllEventListeners(),J=!0,z=!1,u=!0,V=DIRECTION))};this.dirKeyUp=function(){C=!1};this.onLeft=function(){w=s_oGame.onLeft;C=!0;Z=TIME_REFRESH_DIRECTION;var a=q.ballBody();a.position.x-=DIRECTION_VELOCITY;a.position.x>LIMIT_HAND_RANGE_POS.x?a.position.x=LIMIT_HAND_RANGE_POS.x:n.setPosition(n.getX()-DIRECTION_CHARACTER_VELOCITY,
n.getY())};this.onRight=function(){w=s_oGame.onRight;C=!0;Z=TIME_REFRESH_DIRECTION;var a=q.ballBody();a.position.x+=DIRECTION_VELOCITY;a.position.x<-LIMIT_HAND_RANGE_POS.x?a.position.x=-LIMIT_HAND_RANGE_POS.x:n.setPosition(n.getX()+DIRECTION_CHARACTER_VELOCITY,n.getY())};this.sortDepth=function(a,b){null!==a&&null!==b&&(a.getDepthPos()<b.getDepthPos()?p.getChildIndex(a.getObject())>p.getChildIndex(b.getObject())&&p.swapChildren(a.getObject(),b.getObject()):a.getDepthPos()>b.getDepthPos()&&p.getChildIndex(b.getObject())>
p.getChildIndex(a.getObject())&&p.swapChildren(b.getObject(),a.getObject()))};this.onExitHelp=function(){this.pause(!1);e.onExitFromHelp()};this.ballPosition=function(){var a=q.ballBody(),b=this.convert3dPosTo2dScreen(a.position,da),c=b.z*(BALL_SCALE_FACTOR-m.getStartScale())+m.getStartScale();m.setPosition(b.x,b.y);m.scale(c);s_bMobile||this.refreshShadowCast(m,a,c)};this.refreshShadowCast=function(a,b,c){var d=q.getTrackBody();if(b.position.z-BALL_RADIUS<d.position.z)a.scaleShadow(0);else{var f=
this.convert3dPosTo2dScreen({x:b.position.x,y:b.position.y,z:d.position.z},da);b=-(b.position.z-BALL_RADIUS)+d.position.z+1;a.scaleShadow(b*c);a.setAlphaByHeight(b);a.setPositionShadow(f.x,f.y)}};this.launchBall=function(){m.setVisible(!0);var a=r.getMaskValue()/r.getMaskHeight()*100;a<MIN_LAUNCH_FORCE&&(a=MIN_LAUNCH_FORCE);s_oGame.addImpulseToBall(-a*FORCE_RATE);s_oGame.addAngularVelocityToBall(t.getStoppedFrame()*EFFECT_POWER_RATE)};this.activeStateLaunchPower=function(){V=POWER;r.setVisible(!0);
r.animFade(1);r.animateMask(TIME_POWER_BAR)};this.activeStateLaunchEffect=function(){V=EFFECT;t.animFade(1);t.animArrow();t.setVisible(!0)};this.addAngularVelocityToBall=function(a){a={x:0,y:a,z:0};q.setElementAngularVelocity(q.ballBody(),a)};this.completeLaunch=function(){z||(x=z=!0,m.animFade(0),m.playSound(),createjs.Tween.get(this).wait(1500).call(function(){n.animFade(0)}),ca=TIME_RESET_LAUNCH)};this.isAwakwePins=function(a){Q=a};this.awakePins=function(){if(Q)for(var a=0;a<L.length;a++)L[a].getPhysics().position.y>
d.getDepthPos()&&L[a].isDownYet()?L[a].getPhysics().wakeUp():L[a].getPhysics().position.y>d.getDepthPos()&&1===G&&L[a].getPhysics().wakeUp()};this.onStopAllPin=function(){var a=this.countPinDown();Y+=a;this.controlTurnResult(a);r.mask(0);t.animFade(0);r.animFade(0)};this.setPinsPhysicsMovement=function(a){D=a};this.nextStage=function(){this.resetScene();k.setVisible(!1);q.getPinsBinder().collisionResponse=0;q.getPinsBinder().position.y=PINS_BINDER_POSITION.y;W=0;this.activeControl()};this.pinBinderAction=
function(){k.setVisible(!0);q.getPinsBinder().collisionResponse=1;k.animThrowPins()};this.repositionPins=function(){for(var a=0;a<L.length;a++)L[a].resetState(),L[a].setPosition(L[a].getX(),L[a].getY()-100),L[a].animReposition(L[a].getStartPos().y,function(){})};this.controlTurnResult=function(a){y?(this.addSpareScore(a),R+=a):B&&(this.addStrikeScore(a),R+=a);var b;b=N?this.addExtraScore(a):this.addScoreNormalTurns(a);var c=!1;R+=a;9!==T?(U[T][G-1]=a,U[T][2]=R):(U[T][G-1]=a,U[T][3]=R,c=!0);e.refreshTurnsBoard(T,
G,R,b.point,c);b.next?(this.nextTurn(),Y<L.length&&(k.setVisible(!0),k.takeRemainPinsAndRepos(),q.getPinsBinder().collisionResponse=1,I=!0)):9!==T?(Y=0,T++,G=1,e.setStateTurnBoard(T,"on"),0===P&&(B=!1)):this.gameOver();e.refresTotalBoard(R);W=0;S=F=O=!1};this.gameOver=function(){ea=STATE_FINISH;e.createEndPanel(R)};this.addExtraScore=function(a){var b={next:!0,point:a};a>=L.length?N?b=this.strikeResult():2===G&&N&&(b=this.spareResult()):a<L.length&&(b=this.aritmeticResult(a));return b};this.addScoreNormalTurns=
function(a){var b={next:!0,point:a};Y===L.length?1!==G||N?2!==G||N||(b=this.spareResult()):b=this.strikeResult():Y<L.length&&2===G&&(b=this.aritmeticResult(a));return b};this.aritmeticResult=function(a){this.pinBinderAction();return{next:N,point:a}};this.spareResult=function(){var a=!1;y=!0;9===T&&(a=N=!0);this.pinBinderAction();K=!0;playSound("gingle_spare",1,0);f.setVisibleMonitorSpare(!0);return{next:a,point:"/"}};this.strikeResult=function(){var a=!1;P=2;B=!0;f.setVisibleMonitorStrike(!0);H=!0;
playSound("gingle_strike",1,0);9===T&&(a=N=!0);this.pinBinderAction();return{next:a,point:"X"}};this.nextTurn=function(){if(N){if(3===G){this.gameOver();return}}else if(9===T&&2===G){this.gameOver();return}G++};this.addStrikeScore=function(a){9!==T?(1!==T&&10===U[T-2][0]&&(U[T-2][2]+=a,e.refreshTurnsBoard(T-2,null,U[T-2][2],null)),U[T-1][2]+=a,e.refreshTurnsBoard(T-1,null,U[T-1][2],null)):(U[T][3]+=a,e.refreshTurnsBoard(T,null,U[T][3],null,!0));P--};this.addSpareScore=function(a){9!==T?(U[T-1][2]+=
a,e.refreshTurnsBoard(T-1,null,U[T-1][2],null)):(U[T][3]+=a,e.refreshTurnsBoard(T,null,U[T][3],null,!0))};this.activeControl=function(){l.changeState("green");u=!1;e.dirArrowsVisibility(!0);n.setPosition(CHARACTER_START_POS.x,CHARACTER_START_POS.y);n.animFade(1);n.setVisible(!0)};this.countPinDown=function(){for(var a=W,b=0;b<L.length;b++)if(!L[b].isDownYet()){var c=new CANNON.Vec3;L[b].getPhysics().quaternion.toEuler(c);c.x=Math.ceil(Math.degrees(c.x));c.y=Math.ceil(Math.degrees(c.y));c.z=Math.ceil(Math.degrees(c.z));
if(20<c.x||-20>c.x||20<c.y||-20>c.y||L[b].getPhysics().position.z<d.getHeightPos())a++,L[b].setDown(!0)}return a};this.animUpRemainPins=function(){for(var a=0;a<L.length;a++)L[a].isDownYet()||L[a].animTake(L[a].getStartPos().y-100)};this.repositionRemainPins=function(){for(var a=0;a<L.length;a++)if(L[a].isDownYet())L[a].setVisible(!1);else{L[a].getPhysics().position.set(PINS_POSITION[a].x,PINS_POSITION[a].y,PINS_POSITION[a].z);L[a].getPhysics().quaternion.setFromEuler(0,0,0,"XYZ");L[a].getPhysics().angularVelocity.set(0,
0,0);L[a].getPhysics().velocity.set(0,0,0);L[a].getPhysics().mass=PIN_PROPERTY.mass;L[a].setPosition(L[a].getStartPos().x,L[a].getStartPos().y-100);L[a].setPlayedSound(!1);var b=this.pinReflection(a,L[a].getPhysics().position);L[a].setAlphaByHeight(0);L[a].animReposition(L[a].getStartPos().y,b);b=this.convert3dPosTo2dScreen(L[a].getPhysics().position,da);this.pinScale(a,b);L[a].setVisible(!0);L[a].pinRotation()}I=!1};this.unload=function(){s_oStage.removeAllChildren();e.unload();q.destroyWorld();
q=null};this.addImpulseToBall=function(a){if(ea===STATE_PLAY){q.ballBody().mass=BALL_MASS;a={x:0,y:a,z:0};var b=q.ballBody();q.addImpulse(b,a);q.setElementAngularVelocity(b,{x:0,y:0,z:0});u=!0;l.changeState("red")}};this.pause=function(a){ea=a?STATE_PAUSE:STATE_PLAY;createjs.Ticker.paused=a};this.setPinDown=function(a,b,c){L[a].isDownYet()===b||I||(c!==WALL||L[a].isDownYet()?c===SIDE_PINS_FLOOR&&L[a].setPosRef(q.getSideFloorPins(0).position.z):L[a].setVisibleRef(!1),L[a].setDown(b),b?W++:W--)};this.onExit=
function(){this.unload();$(s_oMain).trigger("end_level");$(s_oMain).trigger("show_interlevel_ad");$(s_oMain).trigger("end_session");if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)createjs.Tween.get(s_oSoundTrack).to({volume:1},MS_FADE_SOUNDTRACK),v.destroy();s_oMain.gotoMenu()};this.restartGame=function(){this.resetValues();this.resetScene();ea=STATE_PLAY;$(s_oMain).trigger("restart_level",1)};this.resetValues=function(){W=Y=R=T=0;G=1;I=O=M=K=S=H=F=C=B=y=A=x=z=u=!1;D=!0;N=J=!1;this.resetScoreStageArray();
for(var a=0;a<LAUNCH_TURN-1;a++)for(var b=0;2>b;b++)0===b?e.refreshTurnsBoard(a,b+1,R,0,!1):e.refreshTurnsBoard(a,b+1,R,"",!1),e.setStateTurnBoard(a,"off");for(b=0;3>b;b++)0===b?e.refreshTurnsBoard(LAUNCH_TURN-1,b+1,R,0,!0):e.refreshTurnsBoard(LAUNCH_TURN-1,b+1,R,"",!0),e.setStateTurnBoard(LAUNCH_TURN-1,"off");e.setStateTurnBoard(0,"on");e.refresTotalBoard(0)};this.resetBallPosition=function(){var a=q.ballBody();a.mass=0;a.position.set(POSITION_BALL.x,POSITION_BALL.y,POSITION_BALL.z);q.setElementVelocity(a,
{x:0,y:0,z:0});q.setElementAngularVelocity(a,{x:0,y:0,z:0});m.setPlayedSound(!1)};this._updateInit=function(){q.update();this._updateBall2DPosition();ea=STATE_PLAY};this.convert2dScreenPosTo3d=function(a,b){var c=new THREE.Vector3(a.x/s_iCanvasResizeWidth*2-1,2*-(a.y/s_iCanvasResizeHeight)+1,-1);c.unproject(da);c.sub(da.position);c.normalize();var d=b.position.y;c.multiply(new THREE.Vector3(d,1,d));return c};this.convert3dPosTo2dScreen=function(a,b){var c=(new THREE.Vector3(a.x,a.y,a.z)).project(b),
d=.5*Math.floor(s_iCanvasResizeWidth),f=.5*Math.floor(s_iCanvasResizeHeight);c.x=(c.x*d+d)*s_fInverseScaling;c.y=(-(c.y*f)+f)*s_fInverseScaling;return c};this.resetScene=function(){this.resetPinsPosition();this.resetBallPosition()};this.resetPinsPosition=function(){for(var a=0;a<L.length;a++){var b=L[a].getPhysics();b.position.set(PINS_POSITION[a].x,PINS_POSITION[a].y,PINS_POSITION[a].z);b.quaternion.setFromEuler(0,0,0,"XYZ");b.angularVelocity.set(0,0,0);b.velocity.set(0,0,0);b.collisionResponse=
1;b.mass=PIN_PROPERTY.mass;L[a].setPosRef(q.getTrackBody().position.z);b=this.convert3dPosTo2dScreen(b.position,da);this.pinScale(a,b);L[a].setDown(!1);L[a].setVisible(!0);L[a].setPlayedSound(!1);L[a].setVisibleRef(!0)}};this._onEnd=function(){this.onExit()};this.swapChildrenIndex=function(){for(var a=0;a<ba.length-1;a++)for(var b=a+1;b<ba.length;b++)ba[a].getObject().visible&&ba[b].getObject().visible&&this.sortDepth(ba[a],ba[b])};this.updatePinsPosition=function(){for(var a=0;a<L.length;a++)if(L[a].getVisible()){var b=
this.pinPosition(a);this.pinScale(a,b);L[a].isVisibleRef&&this.pinReflection(a,L[a].getPhysics().position);this.pinFade(a);PIN_TEST||L[a].pinRotation()}};this.pinFade=function(a){if(L[a].getPhysics().position.y<d.getDepthPos()){var b=1-(L[a].getPhysics().position.y-d.getDepthPos())*(FADE_PIN_FACTOR-d.getDepthPos());L[a].setAlpha(b)}};this.pinScale=function(a,b){var c=b.z*(PIN_SCALE_FACTOR-L[a].getStartScale())+L[a].getStartScale();L[a].scale(c);return c};this.pinReflection=function(a,b){if(b.y<d.getDepthPos())L[a].setAlphaByHeight(0);
else{var c={x:b.x,y:b.y,z:L[a].getPosRef()},c=this.convert3dPosTo2dScreen(c,da),f=b.z+q.getTrackBody().position.z,e=f*(PIN_ALPHA_FACTOR-1)+1;e>PINS_REFLECTION_LIMIT&&(e=PINS_REFLECTION_LIMIT);f=f*(PIN_REF_REGY_FACTOR-L[a].getRegYRef())+L[a].getRegYRef();L[a].setRegYRef(f);L[a].setAlphaByHeight(e);L[a].setPositionReflection(c.x,c.y);return e}};this.setPinCollide=function(){F=!0};this.pinPosition=function(a){var b=L[a].getPhysics(),b=this.convert3dPosTo2dScreen(b.position,da);L[a].setPosition(b.x,b.y);
return b};this.movementKeyDown=function(){C&&(0>Z?(Z=TIME_REFRESH_DIRECTION,w()):Z-=FPS_TIME)};this.pinsMovementDetect=function(){if(x){for(var a=L.length,b=0;b<L.length;b++){var c=L[b].getPhysics().velocity;Math.abs(c.x)<MIN_VELOCITY_PINS&&Math.abs(c.y)<MIN_VELOCITY_PINS&&(s_oScenario.setElementVelocity(L[b].getPhysics(),{x:0,y:0,z:0}),a--)}0===a?(this.onStopAllPin(),x=!1):0>ca?(this.stopAllPin(),this.onStopAllPin(),x=!1):ca-=FPS_TIME}};this.gutterBall=function(){O||F||(M=!0,f.setVisibleMonitorGutter(!0),
O=!0,playSound("gingle_gutterball",1,0))};this.stopAllPin=function(){for(var a=0;a<L.length;a++)s_oScenario.setElementVelocity(L[a].getPhysics(),{x:0,y:0,z:0})};this.pinTest=function(){L[L.length-1].pinRotation();console.log(L[L.length-1].getPhysics().position)};this.animMonitor=function(){H?H=f.animMonitor(f.getStrikeArray()):K?K=f.animMonitor(f.getSpareArray()):M&&((M=f.animMonitor(f.getGutterArray()))||this.completeLaunch())};this.pinSoundCollision=function(a){L[a].playAudio()};this.twoPinsSoundCollision=
function(a,b){createjs.Tween.get(this).wait(Math.floor(50*Math.random())).call(function(){L[a].playAudio()});createjs.Tween.get(this).wait(Math.floor(50*Math.random())).call(function(){L[b].playAudio()})};this.ballHitFloor=function(){S||(S=!0,playSound("ball_hitting",1,0))};this.channelForceApply=function(){O&&q.ballBody().velocity.y>MIN_FORCE_BALL_GUTTER&&q.ballBody().applyForce({x:0,y:-100,z:0},new CANNON.Vec3(0,0,0))};this.characterAnimation=function(){J&&(J=n.animCharacter(),24===n.getFrame()&&
this.launchBall())};this._updatePlay=function(){for(var a=0;a<PHYSICS_ACCURACY;a++)q.update(),this.awakePins();this._updateBall2DPosition();D&&this.updatePinsPosition();this.swapChildrenIndex();this.movementKeyDown();this.pinsMovementDetect();this.channelForceApply();this.characterAnimation();PIN_TEST&&this.pinTest();this.animMonitor()};this.update=function(){switch(ea){case STATE_INIT:this._updateInit();break;case STATE_PLAY:this._updatePlay();break;case STATE_FINISH:q.update(),this.animMonitor(),
D&&this.updatePinsPosition()}};this._updateBall2DPosition=function(){this.ballPosition();da.updateProjectionMatrix();da.updateMatrixWorld()};s_oGame=this;TIME_POWER_BAR=a.time_power_bar;SPEED_EFFECT_ARROW=a.speed_effect_arrow;NUM_LEVEL_FOR_ADS=a.num_levels_for_ads;ENABLE_FULLSCREEN=a.fullscreen;this._init()}var s_oGame;
function CInterface(){var a,b,c,e,d,g,f,h=null,k,l,n,q,m,p,r=null,t,w=null,v=null,u;this._init=function(){m=new createjs.Container;u=m.y=161;m.regY=s_oSpriteLibrary.getSprite("monitor_strike_0").height+s_oSpriteLibrary.getSprite("turn_board").height;s_oStage.addChild(m);n=new CTurnsBoard(TURNS_BOARD_POS.x,TURNS_BOARD_POS.y,m);var h=s_oSpriteLibrary.getSprite("total_board");q=new CTotalScoreBoard(n.getLastX(),TURNS_BOARD_POS.y,h,m);r=new CController;h=s_oSpriteLibrary.getSprite("but_exit");a=CANVAS_WIDTH-
h.height/2-10;b=h.height/2+10;f=new CGfxButton(a,b,h);f.addEventListener(ON_MOUSE_UP,this._onExit,this);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)h=s_oSpriteLibrary.getSprite("audio_icon"),d=a-h.height-10,g=b,k=new CToggle(d,g,h,s_bAudioActive),k.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);var h=window.document,p=h.documentElement;w=p.requestFullscreen||p.mozRequestFullScreen||p.webkitRequestFullScreen||p.msRequestFullscreen;v=h.exitFullscreen||h.mozCancelFullScreen||h.webkitExitFullscreen||
h.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(w=!1);w&&!1===inIframe()&&(h=s_oSpriteLibrary.getSprite("but_fullscreen"),c=h.width/4+10,e=h.height/2+10,t=new CToggle(c,e,h,s_bFullscreen,s_oStage),t.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.refreshButtonPos=function(h,p){f.setPosition(a-h,p+b);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||k.setPosition(d-h,p+g);w&&!1===inIframe()&&t.setPosition(c+h,e+p);m.x=h;m.y=u- -.5*h+1;m.scaleX=
m.scaleY=.5*h/EDGEBOARD_X*(BOARD_SCALE_F-1)+1;s_oGame.refreshPos(h,p);if(null!==r){var l=r.getStartPositionControlLeft();r.setPositionControlLeft(l.x+h,l.y-p);l=r.getStartPositionControlRight();r.setPositionControlRight(l.x-h,l.y-p)}};this.unload=function(){f.unload();f=null;this.onExitFromHelp();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)k.unload(),k=null;w&&!1===inIframe()&&t.unload();s_oInterface=null};this.getContainerBoard=function(){return m};this.onExitFromHelp=function(){null!==h&&(h.unload(),
h=null)};this.createHelpPanel=function(){h=new CHelpPanel(0,0,s_oSpriteLibrary.getSprite("bg_help"))};this.createEndPanel=function(a){p=new CEndPanel(s_oSpriteLibrary.getSprite("msg_box"));p.show(a)};this.resetTurnsBoard=function(){n.resetAllTurnBoard()};this.refreshTurnsBoard=function(a,b,c,d,f){a=n.getTurnBoard(a);null!==b&&a.refreshTextByID(b-1,d);f?a.refreshTextByID(3,c):a.refreshTextByID(2,c)};this.refresTotalBoard=function(a){q.refreshText(a)};this.setStateTurnBoard=function(a,b){n.stateTurnBoard(a,
b)};this._onAudioToggle=function(){createjs.Sound.setMute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){(new CAreYouSurePanel(s_oStage)).show()};this.unloadPause=function(){l.unload();l=null};this.dirArrowsVisibility=function(a){null!==r&&r.arrowVisibility(a)};this.onButPauseRelease=function(){playSound("click",1,0);l=new CPause};this._onFullscreenRelease=function(){s_bFullscreen?(v.call(window.document),s_bFullscreen=!1):(w.call(window.document.documentElement),s_bFullscreen=
!0);sizeHandler()};s_oInterface=this;this._init();return this}var s_oInterface=null;
function CHelpPanel(a,b,c){var e,d,g,f,h,k,l,n,q,m,p,r=!1;this._init=function(a,b,c){createjs.Ticker.paused=!1;q=new createjs.Container;q.x=a;q.y=b;s_oStage.addChild(q);n=new createjs.Shape;n.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);n.alpha=.7;q.addChild(n);l=createBitmap(c);l.x=CANVAS_WIDTH_HALF;l.y=CANVAS_HEIGHT_HALF-30;l.regX=.5*c.width;l.regY=.5*c.height;q.addChild(l);p=new createjs.Container;p.y=-60;q.addChild(p);a=TEXT_HELP1_PC;b="key_left";c="key_right";var d=26,
f=.7;s_bMobile&&(a=TEXT_HELP1_MOBILE,b="arrow_left",c="arrow_right",f=.5,d=30);e=new createjs.Text(a,d+"px "+FONT_GAME,TEXT_COLOR);e.textAlign="center";e.lineWidth=400;e.x=.5*CANVAS_WIDTH;e.y=.5*CANVAS_HEIGHT-360;q.addChild(e);this.directionControl(b,c,f);this.powerBarControl();this.effectArrow();a=s_oSpriteLibrary.getSprite("but_continue");m=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT_HALF+400,a,p);m.addEventListener(ON_MOUSE_UP,this._onExitHelp,this);m.pulseAnimation();var g=this;q.on("pressup",
function(){g._onExitHelp()});q.cursor="pointer"};this.directionControl=function(a,b,c){a=s_oSpriteLibrary.getSprite(a);g=createBitmap(a);g.x=CANVAS_WIDTH_HALF-150;g.y=CANVAS_HEIGHT_HALF-170;g.regX=.5*a.width;g.regY=.5*a.height;g.scaleX=g.scaleY=c;p.addChild(g);b=s_oSpriteLibrary.getSprite(b);d=createBitmap(b);d.x=CANVAS_WIDTH_HALF+150;d.y=CANVAS_HEIGHT_HALF-170;d.regX=.5*b.width;d.regY=.5*b.height;d.scaleX=d.scaleY=c;p.addChild(d);c=s_oSpriteLibrary.getSprite("ball");f=createBitmap(c);f.x=CANVAS_WIDTH_HALF;
f.y=CANVAS_HEIGHT_HALF-170;f.regX=.5*c.width;f.regY=.5*c.height;p.addChild(f);c=new createjs.Text(TEXT_MOVE,"36px "+FONT_GAME,TEXT_COLOR);c.textAlign="center";c.lineWidth=300;c.x=.5*CANVAS_WIDTH;c.y=CANVAS_HEIGHT_HALF-115;p.addChild(c);this.animArrowControl()};this.powerBarControl=function(){h=new CPowerBar(CANVAS_WIDTH_HALF-135,CANVAS_HEIGHT_HALF-50,p);h.animateMask(TIME_POWER_BAR)};this.effectArrow=function(){var a=s_oSpriteLibrary.getSprite("effect_arrow");k=new CEffectArray(CANVAS_WIDTH_HALF+
250,CANVAS_HEIGHT_HALF+155,a,p);k.animArrow()};this.animArrowControl=function(){var a=this;g.scaleX=g.scaleY=.8;createjs.Tween.get(f).to({x:CANVAS_WIDTH_HALF-25},750).call(function(){g.scaleX=g.scaleY=1;d.scaleX=d.scaleY=.8;createjs.Tween.get(f).to({x:CANVAS_WIDTH_HALF+25},750).call(function(){d.scaleX=d.scaleY=1;a.animArrowControl()})})};this.unload=function(){createjs.Tween.get(q).to({alpha:0},500,createjs.Ease.cubicIn).call(function(){s_oStage.removeChild(q)});var a=this;k;q.off("pressup",function(){a._onExitHelp()})};
this._onExitHelp=function(){r||(r=!0,this.unload(),s_oGame.onExitHelp())};this._init(a,b,c)}
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self);b.CANNON=a()}}(function(){return function b(c,e,d){function g(h,l){if(!e[h]){if(!c[h]){var k="function"==typeof require&&require;if(!l&&k)return k(h,!0);if(f)return f(h,!0);throw Error("Cannot find module '"+h+"'");}k=e[h]={exports:{}};c[h][0].call(k.exports,function(b){var d=c[h][1][b];return g(d?
d:b)},k,k.exports,b,c,e,d)}return e[h].exports}for(var f="function"==typeof require&&require,h=0;h<d.length;h++)g(d[h]);return g}({1:[function(b,c,e){c.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},
bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(b,c,e){c.exports={version:b("../package.json").version,AABB:b("./collision/AABB"),ArrayCollisionMatrix:b("./collision/ArrayCollisionMatrix"),
Body:b("./objects/Body"),Box:b("./shapes/Box"),Broadphase:b("./collision/Broadphase"),Constraint:b("./constraints/Constraint"),ContactEquation:b("./equations/ContactEquation"),Narrowphase:b("./world/Narrowphase"),ConeTwistConstraint:b("./constraints/ConeTwistConstraint"),ContactMaterial:b("./material/ContactMaterial"),ConvexPolyhedron:b("./shapes/ConvexPolyhedron"),Cylinder:b("./shapes/Cylinder"),DistanceConstraint:b("./constraints/DistanceConstraint"),Equation:b("./equations/Equation"),EventTarget:b("./utils/EventTarget"),
FrictionEquation:b("./equations/FrictionEquation"),GSSolver:b("./solver/GSSolver"),GridBroadphase:b("./collision/GridBroadphase"),Heightfield:b("./shapes/Heightfield"),HingeConstraint:b("./constraints/HingeConstraint"),LockConstraint:b("./constraints/LockConstraint"),Mat3:b("./math/Mat3"),Material:b("./material/Material"),NaiveBroadphase:b("./collision/NaiveBroadphase"),ObjectCollisionMatrix:b("./collision/ObjectCollisionMatrix"),Pool:b("./utils/Pool"),Particle:b("./shapes/Particle"),Plane:b("./shapes/Plane"),
PointToPointConstraint:b("./constraints/PointToPointConstraint"),Quaternion:b("./math/Quaternion"),Ray:b("./collision/Ray"),RaycastVehicle:b("./objects/RaycastVehicle"),RaycastResult:b("./collision/RaycastResult"),RigidVehicle:b("./objects/RigidVehicle"),RotationalEquation:b("./equations/RotationalEquation"),RotationalMotorEquation:b("./equations/RotationalMotorEquation"),SAPBroadphase:b("./collision/SAPBroadphase"),SPHSystem:b("./objects/SPHSystem"),Shape:b("./shapes/Shape"),Solver:b("./solver/Solver"),
Sphere:b("./shapes/Sphere"),SplitSolver:b("./solver/SplitSolver"),Spring:b("./objects/Spring"),Trimesh:b("./shapes/Trimesh"),Vec3:b("./math/Vec3"),Vec3Pool:b("./utils/Vec3Pool"),World:b("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,
"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,
"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(b,c,e){function d(b){b=b||{};
this.lowerBound=new g;b.lowerBound&&this.lowerBound.copy(b.lowerBound);this.upperBound=new g;b.upperBound&&this.upperBound.copy(b.upperBound)}var g=b("../math/Vec3");b("../utils/Utils");c.exports=d;var f=new g;d.prototype.setFromPoints=function(b,c,d,e){var g=this.lowerBound,h=this.upperBound;g.copy(b[0]);d&&d.vmult(g,g);h.copy(g);for(var k=1;k<b.length;k++){var l=b[k];d&&(d.vmult(l,f),l=f);l.x>h.x&&(h.x=l.x);l.x<g.x&&(g.x=l.x);l.y>h.y&&(h.y=l.y);l.y<g.y&&(g.y=l.y);l.z>h.z&&(h.z=l.z);l.z<g.z&&(g.z=
l.z)}c&&(c.vadd(g,g),c.vadd(h,h));e&&(g.x-=e,g.y-=e,g.z-=e,h.x+=e,h.y+=e,h.z+=e);return this};d.prototype.copy=function(b){this.lowerBound.copy(b.lowerBound);this.upperBound.copy(b.upperBound);return this};d.prototype.clone=function(){return(new d).copy(this)};d.prototype.extend=function(b){var c=b.lowerBound.x;this.lowerBound.x>c&&(this.lowerBound.x=c);c=b.upperBound.x;this.upperBound.x<c&&(this.upperBound.x=c);c=b.lowerBound.y;this.lowerBound.y>c&&(this.lowerBound.y=c);c=b.upperBound.y;this.upperBound.y<
c&&(this.upperBound.y=c);c=b.lowerBound.z;this.lowerBound.z>c&&(this.lowerBound.z=c);c=b.upperBound.z;this.upperBound.z<c&&(this.upperBound.z=c)};d.prototype.overlaps=function(b){var c=this.lowerBound,d=this.upperBound,f=b.lowerBound;b=b.upperBound;return(f.x<=d.x&&d.x<=b.x||c.x<=b.x&&b.x<=d.x)&&(f.y<=d.y&&d.y<=b.y||c.y<=b.y&&b.y<=d.y)&&(f.z<=d.z&&d.z<=b.z||c.z<=b.z&&b.z<=d.z)};d.prototype.contains=function(b){var c=this.lowerBound,d=this.upperBound,f=b.lowerBound;b=b.upperBound;return c.x<=f.x&&
d.x>=b.x&&c.y<=f.y&&d.y>=b.y&&c.z<=f.z&&d.z>=b.z};d.prototype.getCorners=function(b,c,d,f,e,g,h,t){var p=this.lowerBound,k=this.upperBound;b.copy(p);c.set(k.x,p.y,p.z);d.set(k.x,k.y,p.z);f.set(p.x,k.y,k.z);e.set(k.x,p.y,p.z);g.set(p.x,k.y,p.z);h.set(p.x,p.y,k.z);t.copy(k)};var h=[new g,new g,new g,new g,new g,new g,new g,new g];d.prototype.toLocalFrame=function(b,c){this.getCorners(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7]);for(var d=0;8!==d;d++){var f=h[d];b.pointToLocal(f,f)}return c.setFromPoints(h)};
d.prototype.toWorldFrame=function(b,c){this.getCorners(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7]);for(var d=0;8!==d;d++){var f=h[d];b.pointToWorld(f,f)}return c.setFromPoints(h)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(b,c,e){function d(){this.matrix=[]}c.exports=d;d.prototype.get=function(b,c){b=b.index;c=c.index;if(c>b){var d=c;c=b;b=d}return this.matrix[(b*(b+1)>>1)+c-1]};d.prototype.set=function(b,c,d){b=b.index;c=c.index;if(c>b){var f=c;c=b;b=f}this.matrix[(b*(b+1)>>1)+c-1]=d?1:0};
d.prototype.reset=function(){for(var b=0,c=this.matrix.length;b!==c;b++)this.matrix[b]=0};d.prototype.setNumObjects=function(b){this.matrix.length=b*(b-1)>>1}},{}],5:[function(b,c,e){function d(){this.world=null;this.useBoundingBoxes=!1;this.dirty=!0}var g=b("../objects/Body");e=b("../math/Vec3");var f=b("../math/Quaternion");b("../shapes/Shape");b("../shapes/Plane");c.exports=d;d.prototype.collisionPairs=function(b,c,d){throw Error("collisionPairs not implemented for this BroadPhase class!");};var h=
g.STATIC|g.KINEMATIC;d.prototype.needBroadphaseCollision=function(b,c){return 0!==(b.collisionFilterGroup&c.collisionFilterMask)&&0!==(c.collisionFilterGroup&b.collisionFilterMask)&&(0===(b.type&h)&&b.sleepState!==g.SLEEPING||0===(c.type&h)&&c.sleepState!==g.SLEEPING)?!0:!1};d.prototype.intersectionTest=function(b,c,d,f){this.useBoundingBoxes?this.doBoundingBoxBroadphase(b,c,d,f):this.doBoundingSphereBroadphase(b,c,d,f)};var k=new e;new e;new f;new e;d.prototype.doBoundingSphereBroadphase=function(b,
c,d,f){c.position.vsub(b.position,k);var e=Math.pow(b.boundingRadius+c.boundingRadius,2);k.norm2()<e&&(d.push(b),f.push(c))};d.prototype.doBoundingBoxBroadphase=function(b,c,d,f){b.aabbNeedsUpdate&&b.computeAABB();c.aabbNeedsUpdate&&c.computeAABB();b.aabb.overlaps(c.aabb)&&(d.push(b),f.push(c))};var l={keys:[]},n=[],q=[];d.prototype.makePairsUnique=function(b,c){for(var d=b.length,f=0;f!==d;f++)n[f]=b[f],q[f]=c[f];b.length=0;for(f=c.length=0;f!==d;f++){var e=n[f].id,g=q[f].id,e=e<g?e+","+g:g+","+
e;l[e]=f;l.keys.push(e)}for(f=0;f!==l.keys.length;f++)e=l.keys.pop(),d=l[e],b.push(n[d]),c.push(q[d]),delete l[e]};d.prototype.setWorld=function(b){};var m=new e;d.boundingSphereCheck=function(b,c){b.position.vsub(c.position,m);return Math.pow(b.shape.boundingSphereRadius+c.shape.boundingSphereRadius,2)>m.norm2()};d.prototype.aabbQuery=function(b,c,d){console.warn(".aabbQuery is not implemented in this Broadphase subclass.");return[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,
"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(b,c,e){function d(b,c,d,e,h){g.apply(this);this.nx=d||10;this.ny=e||10;this.nz=h||10;this.aabbMin=b||new f(100,100,100);this.aabbMax=c||new f(-100,-100,-100);b=this.nx*this.ny*this.nz;if(0>=b)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[];this.binLengths=[];this.bins.length=b;this.binLengths.length=b;for(c=0;c<b;c++)this.bins[c]=[],this.binLengths[c]=0}c.exports=d;var g=b("./Broadphase"),f=b("../math/Vec3"),h=b("../shapes/Shape");
d.prototype=new g;d.prototype.constructor=d;var k=new f;new f;d.prototype.collisionPairs=function(b,c,d){function f(b,c,d,f,e,g,h){b=(b-C)*K|0;c=(c-F)*M|0;d=(d-H)*O|0;f=R((f-C)*K);e=R((e-F)*M);g=R((g-H)*O);0>b?b=0:b>=n&&(b=n-1);0>c?c=0:c>=q&&(c=q-1);0>d?d=0:d>=u&&(d=u-1);0>f?f=0:f>=n&&(f=n-1);0>e?e=0:e>=q&&(e=q-1);0>g?g=0:g>=u&&(g=u-1);b*=z;c*=x;d*=1;f*=z;e*=x;for(g*=1;b<=f;b+=z)for(var p=c;p<=e;p+=x)for(var k=d;k<=g;k+=1){var m=b+p+k;S[m][Q[m]++]=h}}var e=b.numObjects();b=b.bodies;for(var g=this.aabbMax,
l=this.aabbMin,n=this.nx,q=this.ny,u=this.nz,z=q*u,x=u,A=g.x,y=g.y,B=g.z,C=l.x,F=l.y,H=l.z,K=n/(A-C),M=q/(y-F),O=u/(B-H),A=(A-C)/n,I=(y-F)/q,B=(B-H)/u,D=.5*Math.sqrt(A*A+I*I+B*B),y=h.types,J=y.SPHERE,N=y.PLANE,S=this.bins,Q=this.binLengths,y=this.bins.length,l=0;l!==y;l++)Q[l]=0;for(var R=Math.ceil,l=Math.min,g=Math.max,l=0;l!==e;l++){var g=b[l],G=g.shape;switch(G.type){case J:var P=g.position.x,T=g.position.y,V=g.position.z,G=G.radius;f(P-G,T-G,V-G,P+G,T+G,V+G,g);break;case N:G.worldNormalNeedsUpdate&&
G.computeWorldNormal(g.quaternion);var V=G.worldNormal,G=F+.5*I-g.position.y,Y=H+.5*B-g.position.z,W=k;W.set(C+.5*A-g.position.x,G,Y);for(var ba=P=0;P!==n;P++,ba+=z,W.y=G,W.x+=A)for(var L=T=0;T!==q;T++,L+=x,W.z=Y,W.y+=I)for(var U=0,Z=0;U!==u;U++,Z+=1,W.z+=B)if(W.dot(V)<D){var ca=ba+L+Z;S[ca][Q[ca]++]=g}break;default:g.aabbNeedsUpdate&&g.computeAABB(),f(g.aabb.lowerBound.x,g.aabb.lowerBound.y,g.aabb.lowerBound.z,g.aabb.upperBound.x,g.aabb.upperBound.y,g.aabb.upperBound.z,g)}}for(l=0;l!==y;l++)if(e=
Q[l],1<e)for(b=S[l],P=0;P!==e;P++)for(g=b[P],T=0;T!==P;T++)A=b[T],this.needBroadphaseCollision(g,A)&&this.intersectionTest(g,A,c,d);this.makePairsUnique(c,d)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(b,c,e){function d(){g.apply(this)}c.exports=d;var g=b("./Broadphase");b=b("./AABB");d.prototype=new g;d.prototype.constructor=d;d.prototype.collisionPairs=function(b,c,d){b=b.bodies;var f=b.length,e,g,h,p;for(e=0;e!==f;e++)for(g=0;g!==e;g++)h=b[e],p=b[g],this.needBroadphaseCollision(h,
p)&&this.intersectionTest(h,p,c,d)};new b;d.prototype.aabbQuery=function(b,c,d){d=d||[];for(var f=0;f<b.bodies.length;f++){var e=b.bodies[f];e.aabbNeedsUpdate&&e.computeAABB();e.aabb.overlaps(c)&&d.push(e)}return d}},{"./AABB":3,"./Broadphase":5}],8:[function(b,c,e){function d(){this.matrix={}}c.exports=d;d.prototype.get=function(b,c){b=b.id;c=c.id;if(c>b){var d=c;c=b;b=d}return b+"-"+c in this.matrix};d.prototype.set=function(b,c,d){b=b.id;c=c.id;if(c>b){var f=c;c=b;b=f}d?this.matrix[b+"-"+c]=!0:
delete this.matrix[b+"-"+c]};d.prototype.reset=function(){this.matrix={}};d.prototype.setNumObjects=function(b){}},{}],9:[function(b,c,e){function d(b,c){this.from=b?b.clone():new f;this.to=c?c.clone():new f;this._direction=new f;this.precision=1E-4;this.checkCollisionResponse=!0;this.skipBackfaces=!1;this.collisionFilterGroup=this.collisionFilterMask=-1;this.mode=d.ANY;this.result=new k;this.hasHit=!1;this.callback=function(b){}}function g(b,c,d,f){f.vsub(c,J);d.vsub(c,q);b.vsub(c,m);b=J.dot(J);
c=J.dot(q);d=J.dot(m);f=q.dot(q);var e=q.dot(m),g,h;return 0<=(g=f*d-c*e)&&0<=(h=b*e-c*d)&&g+h<b*f-c*c}c.exports=d;var f=b("../math/Vec3");c=b("../math/Quaternion");var h=b("../math/Transform");b("../shapes/ConvexPolyhedron");b("../shapes/Box");var k=b("../collision/RaycastResult");e=b("../shapes/Shape");b=b("../collision/AABB");d.prototype.constructor=d;d.CLOSEST=1;d.ANY=2;d.ALL=4;var l=new b,n=[];d.prototype.intersectWorld=function(b,c){this.mode=c.mode||d.ANY;this.result=c.result||new k;this.skipBackfaces=
!!c.skipBackfaces;this.collisionFilterMask="undefined"!==typeof c.collisionFilterMask?c.collisionFilterMask:-1;this.collisionFilterGroup="undefined"!==typeof c.collisionFilterGroup?c.collisionFilterGroup:-1;c.from&&this.from.copy(c.from);c.to&&this.to.copy(c.to);this.callback=c.callback||function(){};this.hasHit=!1;this.result.reset();this._updateDirection();this.getAABB(l);n.length=0;b.broadphase.aabbQuery(b,l,n);this.intersectBodies(n);return this.hasHit};var q=new f,m=new f;d.pointInTriangle=g;
var p=new f,r=new c;d.prototype.intersectBody=function(b,c){c&&(this.result=c,this._updateDirection());var d=this.checkCollisionResponse;if((!d||b.collisionResponse)&&0!==(this.collisionFilterGroup&b.collisionFilterMask)&&0!==(b.collisionFilterGroup&this.collisionFilterMask))for(var f=0,e=b.shapes.length;f<e;f++){var g=b.shapes[f];if(!d||g.collisionResponse)if(b.quaternion.mult(b.shapeOrientations[f],r),b.quaternion.vmult(b.shapeOffsets[f],p),p.vadd(b.position,p),this.intersectShape(g,r,p,b),this.result._shouldStop)break}};
d.prototype.intersectBodies=function(b,c){c&&(this.result=c,this._updateDirection());for(var d=0,f=b.length;!this.result._shouldStop&&d<f;d++)this.intersectBody(b[d])};d.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction);this._direction.normalize()};d.prototype.intersectShape=function(b,c,d,f){var e=this.from,g=this._direction;d.vsub(e,J);var h=J.dot(g);g.mult(h,N);N.vadd(e,N);d.distanceTo(N)>b.boundingSphereRadius||(e=this[b.type])&&e.call(this,b,c,d,f)};new f;new f;var t=
new f,w=new f,v=new f,u=new f;new f;new k;d.prototype.intersectBox=function(b,c,d,f){return this.intersectConvex(b.convexPolyhedronRepresentation,c,d,f)};d.prototype[e.types.BOX]=d.prototype.intersectBox;d.prototype.intersectPlane=function(b,c,d,e){var g=this.from,h=this.to,p=this._direction,k=new f(0,0,1);c.vmult(k,k);var m=new f;g.vsub(d,m);c=m.dot(k);h.vsub(d,m);m=m.dot(k);if(!(0<c*m||g.distanceTo(h)<c||(m=k.dot(p),Math.abs(m)<this.precision))){var l=new f,h=new f;c=new f;g.vsub(d,l);d=-k.dot(l)/
m;p.scale(d,h);g.vadd(h,c);this.reportIntersection(k,c,b,e,-1)}};d.prototype[e.types.PLANE]=d.prototype.intersectPlane;d.prototype.getAABB=function(b){var c=this.to,d=this.from;b.lowerBound.x=Math.min(c.x,d.x);b.lowerBound.y=Math.min(c.y,d.y);b.lowerBound.z=Math.min(c.z,d.z);b.upperBound.x=Math.max(c.x,d.x);b.upperBound.y=Math.max(c.y,d.y);b.upperBound.z=Math.max(c.z,d.z)};var z={faceList:[0]};d.prototype.intersectHeightfield=function(b,c,e,g){var p=new f,k=new d(this.from,this.to);h.pointToLocalFrame(e,
c,k.from,k.from);h.pointToLocalFrame(e,c,k.to,k.to);var m=[],l=null,n=null,q=null,r=null,t=b.getIndexOfPosition(k.from.x,k.from.y,m,!1);t&&(l=m[0],n=m[1],q=m[0],r=m[1]);if(t=b.getIndexOfPosition(k.to.x,k.to.y,m,!1)){if(null===l||m[0]<l)l=m[0];if(null===q||m[0]>q)q=m[0];if(null===n||m[1]<n)n=m[1];if(null===r||m[1]>r)r=m[1]}if(null!==l)for(b.getRectMinMax(l,n,q,r,[]),k=l;k<=q;k++)for(m=n;m<=r;m++){if(this.result._shouldStop)return;b.getConvexTrianglePillar(k,m,!1);h.pointToWorldFrame(e,c,b.pillarOffset,
p);this.intersectConvex(b.pillarConvex,c,p,g,z);if(this.result._shouldStop)return;b.getConvexTrianglePillar(k,m,!0);h.pointToWorldFrame(e,c,b.pillarOffset,p);this.intersectConvex(b.pillarConvex,c,p,g,z)}};d.prototype[e.types.HEIGHTFIELD]=d.prototype.intersectHeightfield;var x=new f,A=new f;d.prototype.intersectSphere=function(b,c,d,f){c=this.from;var e=this.to,g=Math.pow(e.x-c.x,2)+Math.pow(e.y-c.y,2)+Math.pow(e.z-c.z,2),h=2*((e.x-c.x)*(c.x-d.x)+(e.y-c.y)*(c.y-d.y)+(e.z-c.z)*(c.z-d.z)),p=Math.pow(h,
2)-4*g*(Math.pow(c.x-d.x,2)+Math.pow(c.y-d.y,2)+Math.pow(c.z-d.z,2)-Math.pow(b.radius,2));if(!(0>p))if(0===p)c.lerp(e,p,x),x.vsub(d,A),A.normalize(),this.reportIntersection(A,x,b,f,-1);else{var k=(-h-Math.sqrt(p))/(2*g),g=(-h+Math.sqrt(p))/(2*g);0<=k&&1>=k&&(c.lerp(e,k,x),x.vsub(d,A),A.normalize(),this.reportIntersection(A,x,b,f,-1));!this.result._shouldStop&&0<=g&&1>=g&&(c.lerp(e,g,x),x.vsub(d,A),A.normalize(),this.reportIntersection(A,x,b,f,-1))}};d.prototype[e.types.SPHERE]=d.prototype.intersectSphere;
var y=new f;new f;new f;var B=new f;d.prototype.intersectConvex=function(b,c,d,f,e){e=e&&e.faceList||null;for(var h=b.faces,p=b.vertices,k=b.faceNormals,m=this._direction,l=this.from,n=l.distanceTo(this.to),q=e?e.length:h.length,r=this.result,x=0;!r._shouldStop&&x<q;x++){var A=e?e[x]:x,z=h[A],G=k[A],R=c,N=d;B.copy(p[z[0]]);R.vmult(B,B);B.vadd(N,B);B.vsub(l,B);R.vmult(G,y);G=m.dot(y);if(!(Math.abs(G)<this.precision||(G=y.dot(B)/G,0>G)))for(m.mult(G,t),t.vadd(l,t),w.copy(p[z[0]]),R.vmult(w,w),N.vadd(w,
w),G=1;!r._shouldStop&&G<z.length-1;G++){v.copy(p[z[G]]);u.copy(p[z[G+1]]);R.vmult(v,v);R.vmult(u,u);N.vadd(v,v);N.vadd(u,u);var F=t.distanceTo(l);!g(t,w,v,u)&&!g(t,v,w,u)||F>n||this.reportIntersection(y,t,b,f,A)}}};d.prototype[e.types.CONVEXPOLYHEDRON]=d.prototype.intersectConvex;var C=new f,F=new f,H=new f,K=new f,M=new f,O=new f;new b;var I=[],D=new h;d.prototype.intersectTrimesh=function(b,c,d,f,e){e=b.indices;var p=this.from,k=this.to,m=this._direction;D.position.copy(d);D.quaternion.copy(c);
h.vectorToLocalFrame(d,c,m,F);h.pointToLocalFrame(d,c,p,H);h.pointToLocalFrame(d,c,k,K);p=H.distanceSquared(K);b.tree.rayQuery(this,D,I);k=0;for(m=I.length;!this.result._shouldStop&&k!==m;k++){var l=I[k];b.getNormal(l,C);b.getVertex(e[3*l],w);w.vsub(H,B);var n=F.dot(C),n=C.dot(B)/n;0>n||(F.scale(n,t),t.vadd(H,t),b.getVertex(e[3*l+1],v),b.getVertex(e[3*l+2],u),n=t.distanceSquared(H),!g(t,v,w,u)&&!g(t,w,v,u)||n>p||(h.vectorToWorldFrame(c,C,M),h.pointToWorldFrame(d,c,t,O),this.reportIntersection(M,O,
b,f,l)))}I.length=0};d.prototype[e.types.TRIMESH]=d.prototype.intersectTrimesh;d.prototype.reportIntersection=function(b,c,f,e,g){var h=this.from,p=this.to,k=h.distanceTo(c),m=this.result;if(!(this.skipBackfaces&&0<b.dot(this._direction)))switch(m.hitFaceIndex="undefined"!==typeof g?g:-1,this.mode){case d.ALL:this.hasHit=!0;m.set(h,p,b,c,f,e,k);m.hasHit=!0;this.callback(m);break;case d.CLOSEST:if(k<m.distance||!m.hasHit)this.hasHit=!0,m.hasHit=!0,m.set(h,p,b,c,f,e,k);break;case d.ANY:this.hasHit=
!0,m.hasHit=!0,m.set(h,p,b,c,f,e,k),m._shouldStop=!0}};var J=new f,N=new f},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(b,c,e){function d(){this.rayFromWorld=new g;this.rayToWorld=new g;this.hitNormalWorld=new g;this.hitPointWorld=new g;this.hasHit=!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1}var g=
b("../math/Vec3");c.exports=d;d.prototype.reset=function(){this.rayFromWorld.setZero();this.rayToWorld.setZero();this.hitNormalWorld.setZero();this.hitPointWorld.setZero();this.hasHit=!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1};d.prototype.abort=function(){this._shouldStop=!0};d.prototype.set=function(b,c,d,e,g,q,m){this.rayFromWorld.copy(b);this.rayToWorld.copy(c);this.hitNormalWorld.copy(d);this.hitPointWorld.copy(e);this.shape=g;this.body=q;this.distance=
m}},{"../math/Vec3":30}],11:[function(b,c,e){function d(b){g.apply(this);this.axisList=[];this.world=null;this.axisIndex=0;var c=this.axisList;this._addBodyHandler=function(b){c.push(b.body)};this._removeBodyHandler=function(b){b=c.indexOf(b.body);-1!==b&&c.splice(b,1)};b&&this.setWorld(b)}b("../shapes/Shape");var g=b("../collision/Broadphase");c.exports=d;d.prototype=new g;d.prototype.setWorld=function(b){for(var c=this.axisList.length=0;c<b.bodies.length;c++)this.axisList.push(b.bodies[c]);b.removeEventListener("addBody",
this._addBodyHandler);b.removeEventListener("removeBody",this._removeBodyHandler);b.addEventListener("addBody",this._addBodyHandler);b.addEventListener("removeBody",this._removeBodyHandler);this.world=b;this.dirty=!0};d.insertionSortX=function(b){for(var c=1,d=b.length;c<d;c++){for(var e=b[c],f=c-1;0<=f&&!(b[f].aabb.lowerBound.x<=e.aabb.lowerBound.x);f--)b[f+1]=b[f];b[f+1]=e}return b};d.insertionSortY=function(b){for(var c=1,d=b.length;c<d;c++){for(var e=b[c],f=c-1;0<=f&&!(b[f].aabb.lowerBound.y<=
e.aabb.lowerBound.y);f--)b[f+1]=b[f];b[f+1]=e}return b};d.insertionSortZ=function(b){for(var c=1,d=b.length;c<d;c++){for(var e=b[c],f=c-1;0<=f&&!(b[f].aabb.lowerBound.z<=e.aabb.lowerBound.z);f--)b[f+1]=b[f];b[f+1]=e}return b};d.prototype.collisionPairs=function(b,c,e){b=this.axisList;var f=b.length,g=this.axisIndex,h,k;this.dirty&&(this.sortList(),this.dirty=!1);for(h=0;h!==f;h++){var p=b[h];for(k=h+1;k<f;k++){var r=b[k];if(this.needBroadphaseCollision(p,r)){if(!d.checkBounds(p,r,g))break;this.intersectionTest(p,
r,c,e)}}}};d.prototype.sortList=function(){for(var b=this.axisList,c=this.axisIndex,e=b.length,g=0;g!==e;g++){var n=b[g];n.aabbNeedsUpdate&&n.computeAABB()}0===c?d.insertionSortX(b):1===c?d.insertionSortY(b):2===c&&d.insertionSortZ(b)};d.checkBounds=function(b,c,d){var e,f;0===d?(e=b.position.x,f=c.position.x):1===d?(e=b.position.y,f=c.position.y):2===d&&(e=b.position.z,f=c.position.z);return f-c.boundingRadius<e+b.boundingRadius};d.prototype.autoDetectAxis=function(){for(var b=0,c=0,d=0,e=0,g=0,
q=0,m=this.axisList,p=m.length,r=1/p,t=0;t!==p;t++)var w=m[t],v=w.position.x,b=b+v,c=c+v*v,v=w.position.y,d=d+v,e=e+v*v,w=w.position.z,g=g+w,q=q+w*w;b=c-b*b*r;d=e-d*d*r;g=q-g*g*r;this.axisIndex=b>d?b>g?0:2:d>g?1:2};d.prototype.aabbQuery=function(b,c,d){d=d||[];this.dirty&&(this.sortList(),this.dirty=!1);b=this.axisList;for(var e=0;e<b.length;e++){var f=b[e];f.aabbNeedsUpdate&&f.computeAABB();f.aabb.overlaps(c)&&d.push(f)}return d}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(b,
c,e){function d(b,c,d){d=d||{};var e="undefined"!==typeof d.maxForce?d.maxForce:1E6,p=d.pivotA?d.pivotA.clone():new k,l=d.pivotB?d.pivotB.clone():new k;this.axisA=d.axisA?d.axisA.clone():new k;this.axisB=d.axisB?d.axisB.clone():new k;g.call(this,b,p,c,l,e);this.collideConnected=!!d.collideConnected;this.angle="undefined"!==typeof d.angle?d.angle:0;p=this.coneEquation=new f(b,c,d);b=this.twistEquation=new h(b,c,d);this.twistAngle="undefined"!==typeof d.twistAngle?d.twistAngle:0;p.maxForce=0;p.minForce=
-e;b.maxForce=0;b.minForce=-e;this.equations.push(p,b)}c.exports=d;b("./Constraint");var g=b("./PointToPointConstraint"),f=b("../equations/ConeEquation"),h=b("../equations/RotationalEquation");b("../equations/ContactEquation");var k=b("../math/Vec3");d.prototype=new g;d.constructor=d;new k;new k;d.prototype.update=function(){var b=this.bodyA,c=this.bodyB,d=this.coneEquation,e=this.twistEquation;g.prototype.update.call(this);b.vectorToWorldFrame(this.axisA,d.axisA);c.vectorToWorldFrame(this.axisB,
d.axisB);this.axisA.tangents(e.axisA,e.axisA);b.vectorToWorldFrame(e.axisA,e.axisA);this.axisB.tangents(e.axisB,e.axisB);c.vectorToWorldFrame(e.axisB,e.axisB);d.angle=this.angle;e.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(b,c,e){function d(b,c,e){e=g.defaults(e,{collideConnected:!0,wakeUpBodies:!0});this.equations=[];this.bodyA=b;
this.bodyB=c;this.id=d.idCounter++;this.collideConnected=e.collideConnected;e.wakeUpBodies&&(b&&b.wakeUp(),c&&c.wakeUp())}c.exports=d;var g=b("../utils/Utils");d.prototype.update=function(){throw Error("method update() not implmemented in this Constraint subclass!");};d.prototype.enable=function(){for(var b=this.equations,c=0;c<b.length;c++)b[c].enabled=!0};d.prototype.disable=function(){for(var b=this.equations,c=0;c<b.length;c++)b[c].enabled=!1};d.idCounter=0},{"../utils/Utils":53}],14:[function(b,
c,e){function d(b,c,d,e){g.call(this,b,c);"undefined"===typeof d&&(d=b.position.distanceTo(c.position));"undefined"===typeof e&&(e=1E6);this.distance=d;b=this.distanceEquation=new f(b,c);this.equations.push(b);b.minForce=-e;b.maxForce=e}c.exports=d;var g=b("./Constraint"),f=b("../equations/ContactEquation");d.prototype=new g;d.prototype.update=function(){var b=this.distanceEquation,c=.5*this.distance,d=b.ni;this.bodyB.position.vsub(this.bodyA.position,d);d.normalize();d.mult(c,b.ri);d.mult(-c,b.rj)}},
{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(b,c,e){function d(b,c,d){d=d||{};var e="undefined"!==typeof d.maxForce?d.maxForce:1E6,p=d.pivotA?d.pivotA.clone():new k,m=d.pivotB?d.pivotB.clone():new k;g.call(this,b,p,c,m,e);(this.axisA=d.axisA?d.axisA.clone():new k(1,0,0)).normalize();(this.axisB=d.axisB?d.axisB.clone():new k(1,0,0)).normalize();p=this.rotationalEquation1=new f(b,c,d);d=this.rotationalEquation2=new f(b,c,d);b=this.motorEquation=new h(b,c,e);b.enabled=!1;this.equations.push(p,
d,b)}c.exports=d;b("./Constraint");var g=b("./PointToPointConstraint"),f=b("../equations/RotationalEquation"),h=b("../equations/RotationalMotorEquation");b("../equations/ContactEquation");var k=b("../math/Vec3");d.prototype=new g;d.constructor=d;d.prototype.enableMotor=function(){this.motorEquation.enabled=!0};d.prototype.disableMotor=function(){this.motorEquation.enabled=!1};d.prototype.setMotorSpeed=function(b){this.motorEquation.targetVelocity=b};d.prototype.setMotorMaxForce=function(b){this.motorEquation.maxForce=
b;this.motorEquation.minForce=-b};var l=new k,n=new k;d.prototype.update=function(){var b=this.bodyA,c=this.bodyB,d=this.motorEquation,e=this.rotationalEquation1,f=this.rotationalEquation2,h=this.axisA,k=this.axisB;g.prototype.update.call(this);b.quaternion.vmult(h,l);c.quaternion.vmult(k,n);l.tangents(e.axisA,f.axisA);e.axisB.copy(n);f.axisB.copy(n);this.motorEquation.enabled&&(b.quaternion.vmult(this.axisA,d.axisA),c.quaternion.vmult(this.axisB,d.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,
"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(b,c,e){function d(b,c,d){d=d||{};var e="undefined"!==typeof d.maxForce?d.maxForce:1E6,m=new h,p=new h,k=new h;b.position.vadd(c.position,k);k.scale(.5,k);c.pointToLocalFrame(k,p);b.pointToLocalFrame(k,m);g.call(this,b,m,c,p,e);e=this.rotationalEquation1=new f(b,c,d);m=this.rotationalEquation2=new f(b,c,d);b=this.rotationalEquation3=new f(b,c,d);this.equations.push(e,m,b)}c.exports=
d;b("./Constraint");var g=b("./PointToPointConstraint"),f=b("../equations/RotationalEquation");b("../equations/RotationalMotorEquation");b("../equations/ContactEquation");var h=b("../math/Vec3");d.prototype=new g;d.constructor=d;new h;new h;d.prototype.update=function(){var b=this.bodyA,c=this.bodyB,d=this.rotationalEquation1,e=this.rotationalEquation2,f=this.rotationalEquation3;g.prototype.update.call(this);b.vectorToWorldFrame(h.UNIT_X,d.axisA);c.vectorToWorldFrame(h.UNIT_Y,d.axisB);b.vectorToWorldFrame(h.UNIT_Y,
e.axisA);c.vectorToWorldFrame(h.UNIT_Z,e.axisB);b.vectorToWorldFrame(h.UNIT_Z,f.axisA);c.vectorToWorldFrame(h.UNIT_X,f.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(b,c,e){function d(b,c,d,e,m){g.call(this,b,d);m="undefined"!==typeof m?m:1E6;this.pivotA=c?c.clone():new h;this.pivotB=e?e.clone():new h;c=this.equationX=new f(b,d);e=this.equationY=
new f(b,d);b=this.equationZ=new f(b,d);this.equations.push(c,e,b);c.minForce=e.minForce=b.minForce=-m;c.maxForce=e.maxForce=b.maxForce=m;c.ni.set(1,0,0);e.ni.set(0,1,0);b.ni.set(0,0,1)}c.exports=d;var g=b("./Constraint"),f=b("../equations/ContactEquation"),h=b("../math/Vec3");d.prototype=new g;d.prototype.update=function(){var b=this.bodyB,c=this.equationX,d=this.equationY,e=this.equationZ;this.bodyA.quaternion.vmult(this.pivotA,c.ri);b.quaternion.vmult(this.pivotB,c.rj);d.ri.copy(c.ri);d.rj.copy(c.rj);
e.ri.copy(c.ri);e.rj.copy(c.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(b,c,e){function d(b,c,d){d=d||{};var e="undefined"!==typeof d.maxForce?d.maxForce:1E6;f.call(this,b,c,-e,e);this.axisA=d.axisA?d.axisA.clone():new g(1,0,0);this.axisB=d.axisB?d.axisB.clone():new g(0,1,0);this.angle="undefined"!==typeof d.angle?d.angle:0}c.exports=d;var g=b("../math/Vec3");b("../math/Mat3");var f=b("./Equation");d.prototype=new f;d.prototype.constructor=d;var h=new g,
k=new g;d.prototype.computeB=function(b){var c=this.a,d=this.b,e=this.axisA,f=this.axisB,g=this.jacobianElementA,l=this.jacobianElementB;e.cross(f,h);f.cross(e,k);g.rotational.copy(k);l.rotational.copy(h);e=Math.cos(this.angle)-e.dot(f);f=this.computeGW();g=this.computeGiMf();return-e*c-f*d-b*g}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(b,c,e){function d(b,c,d){g.call(this,b,c,0,"undefined"!==typeof d?d:1E6);this.restitution=0;this.ri=new f;this.rj=new f;this.ni=new f}c.exports=
d;var g=b("./Equation"),f=b("../math/Vec3");b("../math/Mat3");d.prototype=new g;d.prototype.constructor=d;var h=new f,k=new f,l=new f;d.prototype.computeB=function(b){var c=this.a,d=this.b,e=this.bi,f=this.bj,g=this.ri,p=this.rj,m=e.velocity,n=e.angularVelocity,q=f.velocity,r=f.angularVelocity,t=this.jacobianElementA,K=this.jacobianElementB,M=this.ni;g.cross(M,h);p.cross(M,k);M.negate(t.spatial);h.negate(t.rotational);K.spatial.copy(M);K.rotational.copy(k);l.copy(f.position);l.vadd(p,l);l.vsub(e.position,
l);l.vsub(g,l);e=M.dot(l);f=this.restitution+1;m=f*q.dot(M)-f*m.dot(M)+r.dot(k)-n.dot(h);n=this.computeGiMf();return-e*c-m*d-b*n};var n=new f,q=new f,m=new f,p=new f,r=new f;d.prototype.getImpactVelocityAlongNormal=function(){this.bi.position.vadd(this.ri,m);this.bj.position.vadd(this.rj,p);this.bi.getVelocityAtWorldPoint(m,n);this.bj.getVelocityAtWorldPoint(p,q);n.vsub(q,r);return this.ni.dot(r)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(b,c,e){function d(b,c,e,f){this.id=
d.id++;this.minForce="undefined"===typeof e?-1E6:e;this.maxForce="undefined"===typeof f?1E6:f;this.bi=b;this.bj=c;this.eps=this.b=this.a=0;this.jacobianElementA=new g;this.jacobianElementB=new g;this.enabled=!0;this.setSpookParams(1E7,4,1/60)}c.exports=d;var g=b("../math/JacobianElement");b=b("../math/Vec3");d.prototype.constructor=d;d.id=0;d.prototype.setSpookParams=function(b,c,d){this.a=4/(d*(1+4*c));this.b=4*c/(1+4*c);this.eps=4/(d*d*b*(1+4*c))};d.prototype.computeB=function(b,c,d){var e=this.computeGW(),
f=this.computeGq(),g=this.computeGiMf();return-f*b-e*c-g*d};d.prototype.computeGq=function(){var b=this.jacobianElementB,c=this.bj.position;return this.jacobianElementA.spatial.dot(this.bi.position)+b.spatial.dot(c)};var f=new b;d.prototype.computeGW=function(){var b=this.jacobianElementB,c=this.bi,d=this.bj,e=d.velocity,d=d.angularVelocity||f;return this.jacobianElementA.multiplyVectors(c.velocity,c.angularVelocity||f)+b.multiplyVectors(e,d)};d.prototype.computeGWlambda=function(){var b=this.jacobianElementB,
c=this.bi,d=this.bj,e=d.vlambda,d=d.wlambda||f;return this.jacobianElementA.multiplyVectors(c.vlambda,c.wlambda||f)+b.multiplyVectors(e,d)};var h=new b,k=new b,l=new b,n=new b;d.prototype.computeGiMf=function(){var b=this.jacobianElementA,c=this.jacobianElementB,d=this.bi,e=this.bj,f=d.force,g=d.torque,m=e.force,q=e.torque,A=d.invMassSolve,y=e.invMassSolve;d.invInertiaWorldSolve?d.invInertiaWorldSolve.vmult(g,l):l.set(0,0,0);e.invInertiaWorldSolve?e.invInertiaWorldSolve.vmult(q,n):n.set(0,0,0);f.mult(A,
h);m.mult(y,k);return b.multiplyVectors(h,l)+c.multiplyVectors(k,n)};var q=new b;d.prototype.computeGiMGt=function(){var b=this.jacobianElementA,c=this.jacobianElementB,d=this.bi,e=this.bj,f=d.invInertiaWorldSolve,g=e.invInertiaWorldSolve,d=d.invMassSolve+e.invMassSolve;f&&(f.vmult(b.rotational,q),d+=q.dot(b.rotational));g&&(g.vmult(c.rotational,q),d+=q.dot(c.rotational));return d};var m=new b;new b;new b;new b;new b;new b;d.prototype.addToWlambda=function(b){var c=this.jacobianElementA,d=this.jacobianElementB,
e=this.bi,f=this.bj;c.spatial.mult(e.invMassSolve*b,m);e.vlambda.vadd(m,e.vlambda);d.spatial.mult(f.invMassSolve*b,m);f.vlambda.vadd(m,f.vlambda);e.invInertiaWorldSolve&&(e.invInertiaWorldSolve.vmult(c.rotational,m),m.mult(b,m),e.wlambda.vadd(m,e.wlambda));f.invInertiaWorldSolve&&(f.invInertiaWorldSolve.vmult(d.rotational,m),m.mult(b,m),f.wlambda.vadd(m,f.wlambda))};d.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(b,
c,e){function d(b,c,d){g.call(this,b,c,-d,d);this.ri=new f;this.rj=new f;this.t=new f}c.exports=d;var g=b("./Equation"),f=b("../math/Vec3");b("../math/Mat3");d.prototype=new g;d.prototype.constructor=d;var h=new f,k=new f;d.prototype.computeB=function(b){var c=this.b,d=this.rj,e=this.t;this.ri.cross(e,h);d.cross(e,k);var d=this.jacobianElementA,f=this.jacobianElementB;e.negate(d.spatial);h.negate(d.rotational);f.spatial.copy(e);f.rotational.copy(k);e=this.computeGW();d=this.computeGiMf();return-e*
c-b*d}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(b,c,e){function d(b,c,d){d=d||{};var e="undefined"!==typeof d.maxForce?d.maxForce:1E6;f.call(this,b,c,-e,e);this.axisA=d.axisA?d.axisA.clone():new g(1,0,0);this.axisB=d.axisB?d.axisB.clone():new g(0,1,0);this.maxAngle=Math.PI/2}c.exports=d;var g=b("../math/Vec3");b("../math/Mat3");var f=b("./Equation");d.prototype=new f;d.prototype.constructor=d;var h=new g,k=new g;d.prototype.computeB=function(b){var c=this.a,d=this.b,e=
this.axisA,f=this.axisB,g=this.jacobianElementA,l=this.jacobianElementB;e.cross(f,h);f.cross(e,k);g.rotational.copy(k);l.rotational.copy(h);e=Math.cos(this.maxAngle)-e.dot(f);f=this.computeGW();g=this.computeGiMf();return-e*c-f*d-b*g}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(b,c,e){function d(b,c,d){d="undefined"!==typeof d?d:1E6;f.call(this,b,c,-d,d);this.axisA=new g;this.axisB=new g;this.targetVelocity=0}c.exports=d;var g=b("../math/Vec3");b("../math/Mat3");var f=b("./Equation");
d.prototype=new f;d.prototype.constructor=d;d.prototype.computeB=function(b){var c=this.b,d=this.axisB,e=this.jacobianElementB;this.jacobianElementA.rotational.copy(this.axisA);d.negate(e.rotational);d=this.computeGW()-this.targetVelocity;e=this.computeGiMf();return-d*c-b*e}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(b,c,e){function d(b,c,e){e=g.defaults(e,{friction:.3,restitution:.3,contactEquationStiffness:1E7,contactEquationRelaxation:3,frictionEquationStiffness:1E7,frictionEquationRelaxation:3});
this.id=d.idCounter++;this.materials=[b,c];this.friction=e.friction;this.restitution=e.restitution;this.contactEquationStiffness=e.contactEquationStiffness;this.contactEquationRelaxation=e.contactEquationRelaxation;this.frictionEquationStiffness=e.frictionEquationStiffness;this.frictionEquationRelaxation=e.frictionEquationRelaxation}var g=b("../utils/Utils");c.exports=d;d.idCounter=0},{"../utils/Utils":53}],25:[function(b,c,e){function d(b){var c="";b=b||{};"string"===typeof b?(c=b,b={}):"object"===
typeof b&&(c="");this.name=c;this.id=d.idCounter++;this.friction="undefined"!==typeof b.friction?b.friction:-1;this.restitution="undefined"!==typeof b.restitution?b.restitution:-1}c.exports=d;d.idCounter=0},{}],26:[function(b,c,e){function d(){this.spatial=new g;this.rotational=new g}c.exports=d;var g=b("./Vec3");d.prototype.multiplyElement=function(b){return b.spatial.dot(this.spatial)+b.rotational.dot(this.rotational)};d.prototype.multiplyVectors=function(b,c){return b.dot(this.spatial)+c.dot(this.rotational)}},
{"./Vec3":30}],27:[function(b,c,e){function d(b){this.elements=b?b:[0,0,0,0,0,0,0,0,0]}c.exports=d;var g=b("./Vec3");d.prototype.identity=function(){var b=this.elements;b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1};d.prototype.setZero=function(){var b=this.elements;b[0]=0;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=0;b[6]=0;b[7]=0;b[8]=0};d.prototype.setTrace=function(b){var c=this.elements;c[0]=b.x;c[4]=b.y;c[8]=b.z};d.prototype.getTrace=function(b){b=b||new g;var c=this.elements;b.x=c[0];
b.y=c[4];b.z=c[8]};d.prototype.vmult=function(b,c){c=c||new g;var d=this.elements,e=b.x,f=b.y,h=b.z;c.x=d[0]*e+d[1]*f+d[2]*h;c.y=d[3]*e+d[4]*f+d[5]*h;c.z=d[6]*e+d[7]*f+d[8]*h;return c};d.prototype.smult=function(b){for(var c=0;c<this.elements.length;c++)this.elements[c]*=b};d.prototype.mmult=function(b,c){for(var e=c||new d,f=0;3>f;f++)for(var g=0;3>g;g++){for(var h=0,m=0;3>m;m++)h+=b.elements[f+3*m]*this.elements[m+3*g];e.elements[f+3*g]=h}return e};d.prototype.scale=function(b,c){c=c||new d;for(var e=
this.elements,f=c.elements,g=0;3!==g;g++)f[3*g+0]=b.x*e[3*g+0],f[3*g+1]=b.y*e[3*g+1],f[3*g+2]=b.z*e[3*g+2];return c};d.prototype.solve=function(b,c){c=c||new g;for(var d=[],e=0;12>e;e++)d.push(0);for(var f,e=0;3>e;e++)for(f=0;3>f;f++)d[e+4*f]=this.elements[e+3*f];d[3]=b.x;d[7]=b.y;d[11]=b.z;var h=3,m=h,p,r;do{e=m-h;if(0===d[e+4*e])for(f=e+1;f<m;f++)if(0!==d[e+4*f]){p=4;do r=4-p,d[r+4*e]+=d[r+4*f];while(--p);break}if(0!==d[e+4*e])for(f=e+1;f<m;f++){var t=d[e+4*f]/d[e+4*e];p=4;do r=4-p,d[r+4*f]=r<=
e?0:d[r+4*f]-d[r+4*e]*t;while(--p)}}while(--h);c.z=d[11]/d[10];c.y=(d[7]-d[6]*c.z)/d[5];c.x=(d[3]-d[2]*c.z-d[1]*c.y)/d[0];if(isNaN(c.x)||isNaN(c.y)||isNaN(c.z)||Infinity===c.x||Infinity===c.y||Infinity===c.z)throw"Could not solve equation! Got x=["+c.toString()+"], b=["+b.toString()+"], A=["+this.toString()+"]";return c};d.prototype.e=function(b,c,d){if(void 0===d)return this.elements[c+3*b];this.elements[c+3*b]=d};d.prototype.copy=function(b){for(var c=0;c<b.elements.length;c++)this.elements[c]=
b.elements[c];return this};d.prototype.toString=function(){for(var b="",c=0;9>c;c++)b+=this.elements[c]+",";return b};d.prototype.reverse=function(b){b=b||new d;for(var c=[],e=0;18>e;e++)c.push(0);for(var f,e=0;3>e;e++)for(f=0;3>f;f++)c[e+6*f]=this.elements[e+3*f];c[3]=1;c[9]=0;c[15]=0;c[4]=0;c[10]=1;c[16]=0;c[5]=0;c[11]=0;c[17]=1;var g=3,q=g,m,p;do{e=q-g;if(0===c[e+6*e])for(f=e+1;f<q;f++)if(0!==c[e+6*f]){m=6;do p=6-m,c[p+6*e]+=c[p+6*f];while(--m);break}if(0!==c[e+6*e])for(f=e+1;f<q;f++){var r=c[e+
6*f]/c[e+6*e];m=6;do p=6-m,c[p+6*f]=p<=e?0:c[p+6*f]-c[p+6*e]*r;while(--m)}}while(--g);e=2;do{f=e-1;do{r=c[e+6*f]/c[e+6*e];m=6;do p=6-m,c[p+6*f]-=c[p+6*e]*r;while(--m)}while(f--)}while(--e);e=2;do{r=1/c[e+6*e];m=6;do p=6-m,c[p+6*e]*=r;while(--m)}while(e--);e=2;do{f=2;do{p=c[3+f+6*e];if(isNaN(p)||Infinity===p)throw"Could not reverse! A=["+this.toString()+"]";b.e(e,f,p)}while(f--)}while(e--);return b};d.prototype.setRotationFromQuaternion=function(b){var c=b.x,d=b.y,e=b.z,f=b.w,g=c+c,m=d+d,p=e+e;b=c*
g;var r=c*m,c=c*p,t=d*m,d=d*p,e=e*p,g=f*g,m=f*m,f=f*p,p=this.elements;p[0]=1-(t+e);p[1]=r-f;p[2]=c+m;p[3]=r+f;p[4]=1-(b+e);p[5]=d-g;p[6]=c-m;p[7]=d+g;p[8]=1-(b+t);return this};d.prototype.transpose=function(b){b=b||new d;for(var c=b.elements,e=this.elements,f=0;3!==f;f++)for(var g=0;3!==g;g++)c[3*f+g]=e[3*g+f];return b}},{"./Vec3":30}],28:[function(b,c,e){function d(b,c,d,e){this.x=void 0!==b?b:0;this.y=void 0!==c?c:0;this.z=void 0!==d?d:0;this.w=void 0!==e?e:1}c.exports=d;var g=b("./Vec3");d.prototype.set=
function(b,c,d,e){this.x=b;this.y=c;this.z=d;this.w=e};d.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w};d.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]};d.prototype.setFromAxisAngle=function(b,c){var d=Math.sin(.5*c);this.x=b.x*d;this.y=b.y*d;this.z=b.z*d;this.w=Math.cos(.5*c)};d.prototype.toAxisAngle=function(b){b=b||new g;this.normalize();var c=2*Math.acos(this.w),d=Math.sqrt(1-this.w*this.w);.001>d?(b.x=this.x,b.y=this.y,b.z=this.z):(b.x=this.x/
d,b.y=this.y/d,b.z=this.z/d);return[b,c]};var f=new g,h=new g;d.prototype.setFromVectors=function(b,c){if(b.isAntiparallelTo(c))b.tangents(f,h),this.setFromAxisAngle(f,Math.PI);else{var d=b.cross(c);this.x=d.x;this.y=d.y;this.z=d.z;this.w=Math.sqrt(Math.pow(b.norm(),2)*Math.pow(c.norm(),2))+b.dot(c);this.normalize()}};var k=new g,l=new g,n=new g;d.prototype.mult=function(b,c){c=c||new d;var e=this.w;k.set(this.x,this.y,this.z);l.set(b.x,b.y,b.z);c.w=e*b.w-k.dot(l);k.cross(l,n);c.x=e*l.x+b.w*k.x+n.x;
c.y=e*l.y+b.w*k.y+n.y;c.z=e*l.z+b.w*k.z+n.z;return c};d.prototype.inverse=function(b){var c=this.x,e=this.y,f=this.z,g=this.w;b=b||new d;this.conjugate(b);c=1/(c*c+e*e+f*f+g*g);b.x*=c;b.y*=c;b.z*=c;b.w*=c;return b};d.prototype.conjugate=function(b){b=b||new d;b.x=-this.x;b.y=-this.y;b.z=-this.z;b.w=this.w;return b};d.prototype.normalize=function(){var b=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===b?this.w=this.z=this.y=this.x=0:(b=1/b,this.x*=b,this.y*=b,this.z*=b,this.w*=
b)};d.prototype.normalizeFast=function(){var b=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===b?this.w=this.z=this.y=this.x=0:(this.x*=b,this.y*=b,this.z*=b,this.w*=b)};d.prototype.vmult=function(b,c){c=c||new g;var d=b.x,e=b.y,f=b.z,h=this.x,m=this.y,k=this.z,l=this.w,n=l*d+m*f-k*e,q=l*e+k*d-h*f,y=l*f+h*e-m*d,d=-h*d-m*e-k*f;c.x=n*l+d*-h+q*-k-y*-m;c.y=q*l+d*-m+y*-h-n*-k;c.z=y*l+d*-k+n*-m-q*-h;return c};d.prototype.copy=function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=b.w;return this};
d.prototype.toEuler=function(b,c){c=c||"YZX";var d,e,f,g=this.x,h=this.y,m=this.z,k=this.w;switch(c){case "YZX":var l=g*h+m*k;.499<l&&(d=2*Math.atan2(g,k),e=Math.PI/2,f=0);-.499>l&&(d=-2*Math.atan2(g,k),e=-Math.PI/2,f=0);isNaN(d)&&(f=m*m,d=Math.atan2(2*h*k-2*g*m,1-2*h*h-2*f),e=Math.asin(2*l),f=Math.atan2(2*g*k-2*h*m,1-2*g*g-2*f));break;default:throw Error("Euler order "+c+" not supported yet.");}b.y=d;b.z=e;b.x=f};d.prototype.setFromEuler=function(b,c,d,e){e=e||"XYZ";var f=Math.cos(b/2),g=Math.cos(c/
2),h=Math.cos(d/2);b=Math.sin(b/2);c=Math.sin(c/2);d=Math.sin(d/2);"XYZ"===e?(this.x=b*g*h+f*c*d,this.y=f*c*h-b*g*d,this.z=f*g*d+b*c*h,this.w=f*g*h-b*c*d):"YXZ"===e?(this.x=b*g*h+f*c*d,this.y=f*c*h-b*g*d,this.z=f*g*d-b*c*h,this.w=f*g*h+b*c*d):"ZXY"===e?(this.x=b*g*h-f*c*d,this.y=f*c*h+b*g*d,this.z=f*g*d+b*c*h,this.w=f*g*h-b*c*d):"ZYX"===e?(this.x=b*g*h-f*c*d,this.y=f*c*h+b*g*d,this.z=f*g*d-b*c*h,this.w=f*g*h+b*c*d):"YZX"===e?(this.x=b*g*h+f*c*d,this.y=f*c*h+b*g*d,this.z=f*g*d-b*c*h,this.w=f*g*h-b*
c*d):"XZY"===e&&(this.x=b*g*h-f*c*d,this.y=f*c*h-b*g*d,this.z=f*g*d+b*c*h,this.w=f*g*h+b*c*d);return this};d.prototype.clone=function(){return new d(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(b,c,e){function d(b){b=b||{};this.position=new g;b.position&&this.position.copy(b.position);this.quaternion=new f;b.quaternion&&this.quaternion.copy(b.quaternion)}var g=b("./Vec3"),f=b("./Quaternion");c.exports=d;var h=new f;d.pointToLocalFrame=function(b,c,d,e){e=e||new g;d.vsub(b,e);c.conjugate(h);
h.vmult(e,e);return e};d.prototype.pointToLocal=function(b,c){return d.pointToLocalFrame(this.position,this.quaternion,b,c)};d.pointToWorldFrame=function(b,c,d,e){e=e||new g;c.vmult(d,e);e.vadd(b,e);return e};d.prototype.pointToWorld=function(b,c){return d.pointToWorldFrame(this.position,this.quaternion,b,c)};d.prototype.vectorToWorldFrame=function(b,c){c=c||new g;this.quaternion.vmult(b,c);return c};d.vectorToWorldFrame=function(b,c,d){b.vmult(c,d);return d};d.vectorToLocalFrame=function(b,c,d,e){e=
e||new g;c.w*=-1;c.vmult(d,e);c.w*=-1;return e}},{"./Quaternion":28,"./Vec3":30}],30:[function(b,c,e){function d(b,c,d){this.x=b||0;this.y=c||0;this.z=d||0}c.exports=d;var g=b("./Mat3");d.ZERO=new d(0,0,0);d.UNIT_X=new d(1,0,0);d.UNIT_Y=new d(0,1,0);d.UNIT_Z=new d(0,0,1);d.prototype.cross=function(b,c){var e=b.x,f=b.y,g=b.z,h=this.x,k=this.y,l=this.z;c=c||new d;c.x=k*g-l*f;c.y=l*e-h*g;c.z=h*f-k*e;return c};d.prototype.set=function(b,c,d){this.x=b;this.y=c;this.z=d;return this};d.prototype.setZero=
function(){this.x=this.y=this.z=0};d.prototype.vadd=function(b,c){if(c)c.x=b.x+this.x,c.y=b.y+this.y,c.z=b.z+this.z;else return new d(this.x+b.x,this.y+b.y,this.z+b.z)};d.prototype.vsub=function(b,c){if(c)c.x=this.x-b.x,c.y=this.y-b.y,c.z=this.z-b.z;else return new d(this.x-b.x,this.y-b.y,this.z-b.z)};d.prototype.crossmat=function(){return new g([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])};d.prototype.normalize=function(){var b=this.x,c=this.y,d=this.z,b=Math.sqrt(b*b+c*c+d*d);0<b?(c=1/
b,this.x*=c,this.y*=c,this.z*=c):this.z=this.y=this.x=0;return b};d.prototype.unit=function(b){b=b||new d;var c=this.x,e=this.y,f=this.z,g=Math.sqrt(c*c+e*e+f*f);0<g?(g=1/g,b.x=c*g,b.y=e*g,b.z=f*g):(b.x=1,b.y=0,b.z=0);return b};d.prototype.norm=function(){var b=this.x,c=this.y,d=this.z;return Math.sqrt(b*b+c*c+d*d)};d.prototype.length=d.prototype.norm;d.prototype.norm2=function(){return this.dot(this)};d.prototype.lengthSquared=d.prototype.norm2;d.prototype.distanceTo=function(b){var c=this.x,d=this.y,
e=this.z,f=b.x,g=b.y;b=b.z;return Math.sqrt((f-c)*(f-c)+(g-d)*(g-d)+(b-e)*(b-e))};d.prototype.distanceSquared=function(b){var c=this.x,d=this.y,e=this.z,f=b.x,g=b.y;b=b.z;return(f-c)*(f-c)+(g-d)*(g-d)+(b-e)*(b-e)};d.prototype.mult=function(b,c){c=c||new d;var e=this.y,f=this.z;c.x=b*this.x;c.y=b*e;c.z=b*f;return c};d.prototype.scale=d.prototype.mult;d.prototype.dot=function(b){return this.x*b.x+this.y*b.y+this.z*b.z};d.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z};d.prototype.negate=
function(b){b=b||new d;b.x=-this.x;b.y=-this.y;b.z=-this.z;return b};var f=new d,h=new d;d.prototype.tangents=function(b,c){var d=this.norm();0<d?(d=1/d,f.set(this.x*d,this.y*d,this.z*d),.9>Math.abs(f.x)?h.set(1,0,0):h.set(0,1,0),f.cross(h,b),f.cross(b,c)):(b.set(1,0,0),c.set(0,1,0))};d.prototype.toString=function(){return this.x+","+this.y+","+this.z};d.prototype.toArray=function(){return[this.x,this.y,this.z]};d.prototype.copy=function(b){this.x=b.x;this.y=b.y;this.z=b.z;return this};d.prototype.lerp=
function(b,c,d){var e=this.x,f=this.y,g=this.z;d.x=e+(b.x-e)*c;d.y=f+(b.y-f)*c;d.z=g+(b.z-g)*c};d.prototype.almostEquals=function(b,c){void 0===c&&(c=1E-6);return Math.abs(this.x-b.x)>c||Math.abs(this.y-b.y)>c||Math.abs(this.z-b.z)>c?!1:!0};d.prototype.almostZero=function(b){void 0===b&&(b=1E-6);return Math.abs(this.x)>b||Math.abs(this.y)>b||Math.abs(this.z)>b?!1:!0};var k=new d;d.prototype.isAntiparallelTo=function(b,c){this.negate(k);return k.almostEquals(b,c)};d.prototype.clone=function(){return new d(this.x,
this.y,this.z)}},{"./Mat3":27}],31:[function(b,c,e){function d(b){b=b||{};g.apply(this);this.id=d.idCounter++;this.postStep=this.preStep=this.world=null;this.vlambda=new f;this.collisionFilterGroup="number"===typeof b.collisionFilterGroup?b.collisionFilterGroup:1;this.collisionFilterMask="number"===typeof b.collisionFilterMask?b.collisionFilterMask:1;this.collisionResponse=!0;this.position=new f;b.position&&this.position.copy(b.position);this.previousPosition=new f;this.initPosition=new f;this.velocity=
new f;b.velocity&&this.velocity.copy(b.velocity);this.initVelocity=new f;this.force=new f;var c="number"===typeof b.mass?b.mass:0;this.mass=c;this.invMass=0<c?1/c:0;this.material=b.material||null;this.linearDamping="number"===typeof b.linearDamping?b.linearDamping:.01;this.type=0>=c?d.STATIC:d.DYNAMIC;typeof b.type===typeof d.STATIC&&(this.type=b.type);this.allowSleep="undefined"!==typeof b.allowSleep?b.allowSleep:!0;this.sleepState=0;this.sleepSpeedLimit="undefined"!==typeof b.sleepSpeedLimit?b.sleepSpeedLimit:
.1;this.sleepTimeLimit="undefined"!==typeof b.sleepTimeLimit?b.sleepTimeLimit:1;this.timeLastSleepy=0;this._wakeUpAfterNarrowphase=!1;this.torque=new f;this.quaternion=new k;b.quaternion&&this.quaternion.copy(b.quaternion);this.initQuaternion=new k;this.angularVelocity=new f;b.angularVelocity&&this.angularVelocity.copy(b.angularVelocity);this.initAngularVelocity=new f;this.interpolatedPosition=new f;this.interpolatedQuaternion=new k;this.shapes=[];this.shapeOffsets=[];this.shapeOrientations=[];this.inertia=
new f;this.invInertia=new f;this.invInertiaWorld=new h;this.invMassSolve=0;this.invInertiaSolve=new f;this.invInertiaWorldSolve=new h;this.fixedRotation="undefined"!==typeof b.fixedRotation?b.fixedRotation:!1;this.angularDamping="undefined"!==typeof b.angularDamping?b.angularDamping:.01;this.userData="undefined"!==typeof b.userData?b.userData:null;this.aabb=new l;this.aabbNeedsUpdate=!0;this.wlambda=new f;b.shape&&this.addShape(b.shape);this.updateMassProperties()}c.exports=d;var g=b("../utils/EventTarget");
b("../shapes/Shape");var f=b("../math/Vec3"),h=b("../math/Mat3"),k=b("../math/Quaternion");b("../material/Material");var l=b("../collision/AABB"),n=b("../shapes/Box");d.prototype=new g;d.prototype.constructor=d;d.DYNAMIC=1;d.STATIC=2;d.KINEMATIC=4;d.AWAKE=0;d.SLEEPY=1;d.SLEEPING=2;d.idCounter=0;d.prototype.wakeUp=function(){var b=this.sleepState;this.sleepState=0;b===d.SLEEPING&&this.dispatchEvent({type:"wakeup"})};d.prototype.sleep=function(){this.sleepState=d.SLEEPING;this.velocity.set(0,0,0);this.angularVelocity.set(0,
0,0)};d.sleepyEvent={type:"sleepy"};d.sleepEvent={type:"sleep"};d.prototype.sleepTick=function(b){if(this.allowSleep){var c=this.sleepState,e=this.velocity.norm2()+this.angularVelocity.norm2(),f=Math.pow(this.sleepSpeedLimit,2);c===d.AWAKE&&e<f?(this.sleepState=d.SLEEPY,this.timeLastSleepy=b,this.dispatchEvent(d.sleepyEvent)):c===d.SLEEPY&&e>f?this.wakeUp():c===d.SLEEPY&&b-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(d.sleepEvent))}};d.prototype.updateSolveMassProperties=
function(){this.sleepState===d.SLEEPING||this.type===d.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))};d.prototype.pointToLocalFrame=function(b,c){c=c||new f;b.vsub(this.position,c);this.quaternion.conjugate().vmult(c,c);return c};d.prototype.vectorToLocalFrame=function(b,c){c=c||new f;this.quaternion.conjugate().vmult(b,
c);return c};d.prototype.pointToWorldFrame=function(b,c){c=c||new f;this.quaternion.vmult(b,c);c.vadd(this.position,c);return c};d.prototype.vectorToWorldFrame=function(b,c){c=c||new f;this.quaternion.vmult(b,c);return c};var q=new f,m=new k;d.prototype.addShape=function(b,c,d){var e=new f,g=new k;c&&e.copy(c);d&&g.copy(d);this.shapes.push(b);this.shapeOffsets.push(e);this.shapeOrientations.push(g);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=!0;return this};d.prototype.updateBoundingRadius=
function(){for(var b=this.shapes,c=this.shapeOffsets,d=b.length,e=0,f=0;f!==d;f++){var g=b[f];g.updateBoundingSphereRadius();var h=c[f].norm(),g=g.boundingSphereRadius;h+g>e&&(e=h+g)}this.boundingRadius=e};var p=new l;d.prototype.computeAABB=function(){for(var b=this.shapes,c=this.shapeOffsets,d=this.shapeOrientations,e=b.length,f=this.quaternion,g=this.aabb,h=0;h!==e;h++){var k=b[h];d[h].mult(f,m);m.vmult(c[h],q);q.vadd(this.position,q);k.calculateWorldAABB(q,m,p.lowerBound,p.upperBound);0===h?g.copy(p):
g.extend(p)}this.aabbNeedsUpdate=!1};var r=new h,t=new h;new h;d.prototype.updateInertiaWorld=function(b){var c=this.invInertia;if(c.x!==c.y||c.y!==c.z||b)r.setRotationFromQuaternion(this.quaternion),r.transpose(t),r.scale(c,r),r.mmult(t,this.invInertiaWorld)};var w=new f,v=new f;d.prototype.applyForce=function(b,c){this.type===d.DYNAMIC&&(c.vsub(this.position,w),w.cross(b,v),this.force.vadd(b,this.force),this.torque.vadd(v,this.torque))};var u=new f,z=new f;d.prototype.applyLocalForce=function(b,
c){this.type===d.DYNAMIC&&(this.vectorToWorldFrame(b,u),this.pointToWorldFrame(c,z),this.applyForce(u,z))};var x=new f,A=new f,y=new f;d.prototype.applyImpulse=function(b,c){this.type===d.DYNAMIC&&(c.vsub(this.position,x),A.copy(b),A.mult(this.invMass,A),this.velocity.vadd(A,this.velocity),x.cross(b,y),this.invInertiaWorld.vmult(y,y),this.angularVelocity.vadd(y,this.angularVelocity))};var B=new f,C=new f;d.prototype.applyLocalImpulse=function(b,c){this.type===d.DYNAMIC&&(this.vectorToWorldFrame(b,
B),this.pointToWorldFrame(c,C),this.applyImpulse(B,C))};var F=new f;d.prototype.updateMassProperties=function(){this.invMass=0<this.mass?1/this.mass:0;var b=this.inertia,c=this.fixedRotation;this.computeAABB();F.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2);n.calculateInertia(F,this.mass,b);this.invInertia.set(0<b.x&&!c?1/b.x:0,0<b.y&&!c?1/b.y:0,0<b.z&&!c?1/b.z:0);this.updateInertiaWorld(!0)};
d.prototype.getVelocityAtWorldPoint=function(b,c){var d=new f;b.vsub(this.position,d);this.angularVelocity.cross(d,c);this.velocity.vadd(c,c);return c}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(b,c,e){function d(b){this.chassisBody=b.chassisBody;this.wheelInfos=[];this.sliding=!1;this.world=null;this.indexRightAxis="undefined"!==typeof b.indexRightAxis?
b.indexRightAxis:1;this.indexForwardAxis="undefined"!==typeof b.indexForwardAxis?b.indexForwardAxis:0;this.indexUpAxis="undefined"!==typeof b.indexUpAxis?b.indexUpAxis:2}function g(b,c,d){var e=A,f=y,g=B,h=C;c.vsub(b.position,e);e.cross(d,f);b.invInertiaWorld.vmult(f,h);h.cross(e,g);return b.invMass+d.dot(g)}b("./Body");var f=b("../math/Vec3"),h=b("../math/Quaternion");b("../collision/RaycastResult");e=b("../collision/Ray");var k=b("../objects/WheelInfo");c.exports=d;new f;new f;new f;var l=new f,
n=new f,q=new f;new e;d.prototype.addWheel=function(b){b=b||{};b=new k(b);var c=this.wheelInfos.length;this.wheelInfos.push(b);return c};d.prototype.setSteeringValue=function(b,c){this.wheelInfos[c].steering=b};new f;d.prototype.applyEngineForce=function(b,c){this.wheelInfos[c].engineForce=b};d.prototype.setBrake=function(b,c){this.wheelInfos[c].brake=b};d.prototype.addToWorld=function(b){b.add(this.chassisBody);var c=this;this.preStepCallback=function(){c.updateVehicle(b.dt)};b.addEventListener("preStep",
this.preStepCallback);this.world=b};d.prototype.getVehicleAxisWorld=function(b,c){c.set(0===b?1:0,1===b?1:0,2===b?1:0);this.chassisBody.vectorToWorldFrame(c,c)};d.prototype.updateVehicle=function(b){for(var c=this.wheelInfos,d=c.length,e=this.chassisBody,g=0;g<d;g++)this.updateWheelTransform(g);this.currentVehicleSpeedKmHour=3.6*e.velocity.norm();g=new f;this.getVehicleAxisWorld(this.indexForwardAxis,g);0>g.dot(e.velocity)&&(this.currentVehicleSpeedKmHour*=-1);for(g=0;g<d;g++)this.castRay(c[g]);this.updateSuspension(b);
for(var h=new f,p=new f,g=0;g<d;g++){var m=c[g],k=m.suspensionForce;k>m.maxSuspensionForce&&(k=m.maxSuspensionForce);m.raycastResult.hitNormalWorld.scale(k*b,h);m.raycastResult.hitPointWorld.vsub(e.position,p);e.applyImpulse(h,m.raycastResult.hitPointWorld)}this.updateFriction(b);h=new f;p=new f;k=new f;for(g=0;g<d;g++){m=c[g];e.getVelocityAtWorldPoint(m.chassisConnectionPointWorld,k);var l=1;switch(this.indexUpAxis){case 1:l=-1}if(m.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,p);
var n=p.dot(m.raycastResult.hitNormalWorld);m.raycastResult.hitNormalWorld.scale(n,h);p.vsub(h,p);n=p.dot(k);m.deltaRotation=l*n*b/m.radius}!m.sliding&&m.isInContact||0===m.engineForce||!m.useCustomSlidingRotationalSpeed||(m.deltaRotation=(0<m.engineForce?1:-1)*m.customSlidingRotationalSpeed*b);Math.abs(m.brake)>Math.abs(m.engineForce)&&(m.deltaRotation=0);m.rotation+=m.deltaRotation;m.deltaRotation*=.99}};d.prototype.updateSuspension=function(b){b=this.chassisBody.mass;for(var c=this.wheelInfos,
d=c.length,e=0;e<d;e++){var f=c[e];if(f.isInContact){var g;g=f.suspensionStiffness*(f.suspensionRestLength-f.suspensionLength)*f.clippedInvContactDotSuspension;var h=f.suspensionRelativeVelocity;g-=(0>h?f.dampingCompression:f.dampingRelaxation)*h;f.suspensionForce=g*b;0>f.suspensionForce&&(f.suspensionForce=0)}else f.suspensionForce=0}};d.prototype.removeFromWorld=function(b){b.remove(this.chassisBody);b.removeEventListener("preStep",this.preStepCallback);this.world=null};var m=new f,p=new f;d.prototype.castRay=
function(b){this.updateWheelTransformWorld(b);var c=this.chassisBody,d=-1;b.directionWorld.scale(b.suspensionRestLength+b.radius,m);var e=b.chassisConnectionPointWorld;e.vadd(m,p);var g=b.raycastResult;g.reset();var h=c.collisionResponse;c.collisionResponse=!1;this.world.rayTest(e,p,g);c.collisionResponse=h;e=g.body;b.raycastResult.groundObject=0;e?(d=g.distance,b.raycastResult.hitNormalWorld=g.hitNormalWorld,b.isInContact=!0,b.suspensionLength=g.distance-b.radius,g=b.suspensionRestLength-b.maxSuspensionTravel,
e=b.suspensionRestLength+b.maxSuspensionTravel,b.suspensionLength<g&&(b.suspensionLength=g),b.suspensionLength>e&&(b.suspensionLength=e,b.raycastResult.reset()),g=b.raycastResult.hitNormalWorld.dot(b.directionWorld),e=new f,c.getVelocityAtWorldPoint(b.raycastResult.hitPointWorld,e),c=b.raycastResult.hitNormalWorld.dot(e),-.1<=g?(b.suspensionRelativeVelocity=0,b.clippedInvContactDotSuspension=10):(g=-1/g,b.suspensionRelativeVelocity=c*g,b.clippedInvContactDotSuspension=g)):(b.suspensionLength=b.suspensionRestLength+
0*b.maxSuspensionTravel,b.suspensionRelativeVelocity=0,b.directionWorld.scale(-1,b.raycastResult.hitNormalWorld),b.clippedInvContactDotSuspension=1);return d};d.prototype.updateWheelTransformWorld=function(b){b.isInContact=!1;var c=this.chassisBody;c.pointToWorldFrame(b.chassisConnectionPointLocal,b.chassisConnectionPointWorld);c.vectorToWorldFrame(b.directionLocal,b.directionWorld);c.vectorToWorldFrame(b.axleLocal,b.axleWorld)};d.prototype.updateWheelTransform=function(b){b=this.wheelInfos[b];this.updateWheelTransformWorld(b);
b.directionLocal.scale(-1,l);n.copy(b.axleLocal);l.cross(n,q);q.normalize();n.normalize();var c=b.steering,d=new h;d.setFromAxisAngle(l,c);c=new h;c.setFromAxisAngle(n,b.rotation);var e=b.worldTransform.quaternion;this.chassisBody.quaternion.mult(d,e);e.mult(c,e);e.normalize();d=b.worldTransform.position;d.copy(b.directionWorld);d.scale(b.suspensionLength,d);d.vadd(b.chassisConnectionPointWorld,d)};var r=[new f(1,0,0),new f(0,1,0),new f(0,0,1)];d.prototype.getWheelTransformWorld=function(b){return this.wheelInfos[b].worldTransform};
var t=new f,w=[],v=[];d.prototype.updateFriction=function(b){for(var c=this.wheelInfos,d=c.length,e=this.chassisBody,h=0,p=0;p<d;p++){var m=c[p],k=m.raycastResult.body;k&&h++;m.sideImpulse=0;m.forwardImpulse=0;v[p]||(v[p]=new f);w[p]||(w[p]=new f)}for(p=0;p<d;p++)if(m=c[p],k=m.raycastResult.body){var l=w[p];this.getWheelTransformWorld(p).vectorToWorldFrame(r[this.indexRightAxis],l);var h=m.raycastResult.hitNormalWorld,n=l.dot(h);h.scale(n,t);l.vsub(t,l);l.normalize();h.cross(l,v[p]);v[p].normalize();
h=m;var n=e,q=m.raycastResult.hitPointWorld,A=m.raycastResult.hitPointWorld;if(1.1<l.norm2())k=0;else{var B=F,y=H,C=K;n.getVelocityAtWorldPoint(q,B);k.getVelocityAtWorldPoint(A,y);B.vsub(y,C);k=-.2*l.dot(C)*(1/(n.invMass+k.invMass))}h.sideImpulse=k;m.sideImpulse*=1}this.sliding=!1;for(p=0;p<d;p++){m=c[p];k=m.raycastResult.body;n=0;m.slipInfo=1;if(k){var h=m.brake?m.brake:0,B=e,q=k,A=m.raycastResult.hitPointWorld,l=v[p],n=h,y=A,C=u,M=z,L=x;B.getVelocityAtWorldPoint(y,C);q.getVelocityAtWorldPoint(y,
M);C.vsub(M,L);y=l.dot(L);B=g(B,A,l);q=g(q,A,l);q=1/(B+q)*-y;n<q&&(q=n);q<-n&&(q=-n);n=q;n+=m.engineForce*b;h/=n;m.slipInfo*=h}m.forwardImpulse=0;m.skidInfo=1;k&&(m.skidInfo=1,k=m.suspensionForce*b*m.frictionSlip,h=k*k,m.forwardImpulse=n,n=.5*m.forwardImpulse,q=1*m.sideImpulse,n=n*n+q*q,m.sliding=!1,n>h&&(this.sliding=!0,m.sliding=!0,h=k/Math.sqrt(n),m.skidInfo*=h))}if(this.sliding)for(p=0;p<d;p++)m=c[p],0!==m.sideImpulse&&1>m.skidInfo&&(m.forwardImpulse*=m.skidInfo,m.sideImpulse*=m.skidInfo);for(p=
0;p<d;p++)m=c[p],b=new f,b.copy(m.raycastResult.hitPointWorld),0!==m.forwardImpulse&&(k=new f,v[p].scale(m.forwardImpulse,k),e.applyImpulse(k,b)),0!==m.sideImpulse&&(k=m.raycastResult.body,h=new f,h.copy(m.raycastResult.hitPointWorld),n=new f,w[p].scale(m.sideImpulse,n),e.pointToLocalFrame(b,b),b["xyz"[this.indexUpAxis]]*=m.rollInfluence,e.pointToWorldFrame(b,b),e.applyImpulse(n,b),n.scale(-1,n),k.applyImpulse(n,h))};var u=new f,z=new f,x=new f,A=new f,y=new f,B=new f,C=new f,F=new f,H=new f,K=new f},
{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(b,c,e){function d(b){this.wheelBodies=[];this.coordinateSystem="undefined"===typeof b.coordinateSystem?new k(1,2,3):b.coordinateSystem.clone();this.chassisBody=b.chassisBody;this.chassisBody||(b=new h(new k(5,2,.5)),this.chassisBody=new g(1,b));this.constraints=[];this.wheelAxes=[];this.wheelForces=[]}var g=b("./Body"),f=b("../shapes/Sphere"),h=b("../shapes/Box"),
k=b("../math/Vec3"),l=b("../constraints/HingeConstraint");c.exports=d;d.prototype.addWheel=function(b){b=b||{};var c=b.body;c||(c=new g(1,new f(1.2)));this.wheelBodies.push(c);this.wheelForces.push(0);new k;var d="undefined"!==typeof b.position?b.position.clone():new k,e=new k;this.chassisBody.pointToWorldFrame(d,e);c.position.set(e.x,e.y,e.z);b="undefined"!==typeof b.axis?b.axis.clone():new k(0,1,0);this.wheelAxes.push(b);c=new l(this.chassisBody,c,{pivotA:d,axisA:b,pivotB:k.ZERO,axisB:b,collideConnected:!1});
this.constraints.push(c);return this.wheelBodies.length-1};d.prototype.setSteeringValue=function(b,c){var d=this.wheelAxes[c],e=Math.cos(b),f=Math.sin(b),g=d.x,d=d.y;this.constraints[c].axisA.set(e*g-f*d,f*g+e*d,0)};d.prototype.setMotorSpeed=function(b,c){var d=this.constraints[c];d.enableMotor();d.motorTargetVelocity=b};d.prototype.disableMotor=function(b){this.constraints[b].disableMotor()};var n=new k;d.prototype.setWheelForce=function(b,c){this.wheelForces[c]=b};d.prototype.applyWheelForce=function(b,
c){var d=this.wheelBodies[c],e=d.torque;this.wheelAxes[c].scale(b,n);d.vectorToWorldFrame(n,n);e.vadd(n,e)};d.prototype.addToWorld=function(b){for(var c=this.constraints,d=this.wheelBodies.concat([this.chassisBody]),e=0;e<d.length;e++)b.add(d[e]);for(e=0;e<c.length;e++)b.addConstraint(c[e]);b.addEventListener("preStep",this._update.bind(this))};d.prototype._update=function(){for(var b=this.wheelForces,c=0;c<b.length;c++)this.applyWheelForce(b[c],c)};d.prototype.removeFromWorld=function(b){for(var c=
this.constraints,d=this.wheelBodies.concat([this.chassisBody]),e=0;e<d.length;e++)b.remove(d[e]);for(e=0;e<c.length;e++)b.removeConstraint(c[e])};var q=new k;d.prototype.getWheelSpeed=function(b){var c=this.wheelBodies[b].angularVelocity;this.chassisBody.vectorToWorldFrame(this.wheelAxes[b],q);return c.dot(q)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(b,c,e){function d(){this.particles=[];this.speedOfSound=this.smoothingRadius=
this.density=1;this.viscosity=.01;this.eps=1E-6;this.pressures=[];this.densities=[];this.neighbors=[]}c.exports=d;b("../shapes/Shape");c=b("../math/Vec3");b("../math/Quaternion");b("../shapes/Particle");b("../objects/Body");b("../material/Material");d.prototype.add=function(b){this.particles.push(b);this.neighbors.length<this.particles.length&&this.neighbors.push([])};d.prototype.remove=function(b){b=this.particles.indexOf(b);-1!==b&&(this.particles.splice(b,1),this.neighbors.length>this.particles.length&&
this.neighbors.pop())};var g=new c;d.prototype.getNeighbors=function(b,c){for(var d=this.particles.length,e=b.id,f=this.smoothingRadius*this.smoothingRadius,h=0;h!==d;h++){var p=this.particles[h];p.position.vsub(b.position,g);e!==p.id&&g.norm2()<f&&c.push(p)}};var f=new c,h=new c,k=new c,l=new c,n=new c,q=new c;d.prototype.update=function(){for(var b=this.particles.length,c=this.speedOfSound,d=this.eps,e=0;e!==b;e++){var g=this.particles[e],v=this.neighbors[e];v.length=0;this.getNeighbors(g,v);v.push(this.particles[e]);
for(var u=v.length,z=0,x=0;x!==u;x++){g.position.vsub(v[x].position,f);var A=f.norm(),A=this.w(A),z=z+v[x].mass*A}this.densities[e]=z;this.pressures[e]=c*c*(this.densities[e]-this.density)}for(e=0;e!==b;e++){c=this.particles[e];h.set(0,0,0);k.set(0,0,0);v=this.neighbors[e];u=v.length;for(x=0;x!==u;x++)z=v[x],c.position.vsub(z.position,n),A=n.norm(),g=-z.mass*(this.pressures[e]/(this.densities[e]*this.densities[e]+d)+this.pressures[x]/(this.densities[x]*this.densities[x]+d)),this.gradw(n,l),l.mult(g,
l),h.vadd(l,h),z.velocity.vsub(c.velocity,q),q.mult(1/(1E-4+this.densities[e]*this.densities[x])*this.viscosity*z.mass,q),g=this.nablaw(A),q.mult(g,q),k.vadd(q,k);k.mult(c.mass,k);h.mult(c.mass,h);c.force.vadd(k,c.force);c.force.vadd(h,c.force)}};d.prototype.w=function(b){var c=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(c,9))*Math.pow(c*c-b*b,3)};d.prototype.gradw=function(b,c){var d=b.norm(),e=this.smoothingRadius;b.mult(945/(32*Math.PI*Math.pow(e,9))*Math.pow(e*e-d*d,2),c)};d.prototype.nablaw=
function(b){var c=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(c,9))*(c*c-b*b)*(7*b*b-3*c*c)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(b,c,e){function d(b,c,d){d=d||{};this.restLength="number"===typeof d.restLength?d.restLength:1;this.stiffness=d.stiffness||100;this.damping=d.damping||1;this.bodyA=b;this.bodyB=c;this.localAnchorA=new g;this.localAnchorB=new g;d.localAnchorA&&this.localAnchorA.copy(d.localAnchorA);
d.localAnchorB&&this.localAnchorB.copy(d.localAnchorB);d.worldAnchorA&&this.setWorldAnchorA(d.worldAnchorA);d.worldAnchorB&&this.setWorldAnchorB(d.worldAnchorB)}var g=b("../math/Vec3");c.exports=d;d.prototype.setWorldAnchorA=function(b){this.bodyA.pointToLocalFrame(b,this.localAnchorA)};d.prototype.setWorldAnchorB=function(b){this.bodyB.pointToLocalFrame(b,this.localAnchorB)};d.prototype.getWorldAnchorA=function(b){this.bodyA.pointToWorldFrame(this.localAnchorA,b)};d.prototype.getWorldAnchorB=function(b){this.bodyB.pointToWorldFrame(this.localAnchorB,
b)};var f=new g,h=new g,k=new g,l=new g,n=new g,q=new g,m=new g,p=new g,r=new g,t=new g,w=new g;d.prototype.applyForce=function(){var b=this.stiffness,c=this.damping,d=this.restLength,e=this.bodyA,g=this.bodyB;this.getWorldAnchorA(n);this.getWorldAnchorB(q);n.vsub(e.position,m);q.vsub(g.position,p);q.vsub(n,f);var y=f.norm();h.copy(f);h.normalize();g.velocity.vsub(e.velocity,k);g.angularVelocity.cross(p,w);k.vadd(w,k);e.angularVelocity.cross(m,w);k.vsub(w,k);h.mult(-b*(y-d)-c*k.dot(h),l);e.force.vsub(l,
e.force);g.force.vadd(l,g.force);m.cross(l,r);p.cross(l,t);e.torque.vsub(r,e.torque);g.torque.vadd(t,g.torque)}},{"../math/Vec3":30}],36:[function(b,c,e){function d(b){b=k.defaults(b,{chassisConnectionPointLocal:new g,chassisConnectionPointWorld:new g,directionLocal:new g,directionWorld:new g,axleLocal:new g,axleWorld:new g,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1E4,steering:0,rotation:0,deltaRotation:0,
rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1});this.maxSuspensionTravel=b.maxSuspensionTravel;this.customSlidingRotationalSpeed=b.customSlidingRotationalSpeed;this.useCustomSlidingRotationalSpeed=b.useCustomSlidingRotationalSpeed;this.sliding=!1;this.chassisConnectionPointLocal=
b.chassisConnectionPointLocal.clone();this.chassisConnectionPointWorld=b.chassisConnectionPointWorld.clone();this.directionLocal=b.directionLocal.clone();this.directionWorld=b.directionWorld.clone();this.axleLocal=b.axleLocal.clone();this.axleWorld=b.axleWorld.clone();this.suspensionRestLength=b.suspensionRestLength;this.suspensionMaxLength=b.suspensionMaxLength;this.radius=b.radius;this.suspensionStiffness=b.suspensionStiffness;this.dampingCompression=b.dampingCompression;this.dampingRelaxation=
b.dampingRelaxation;this.frictionSlip=b.frictionSlip;this.deltaRotation=this.rotation=this.steering=0;this.rollInfluence=b.rollInfluence;this.maxSuspensionForce=b.maxSuspensionForce;this.brake=this.engineForce=0;this.isFrontWheel=b.isFrontWheel;this.clippedInvContactDotSuspension=1;this.forwardImpulse=this.sideImpulse=this.suspensionLength=this.skidInfo=this.suspensionForce=this.suspensionRelativeVelocity=0;this.raycastResult=new h;this.worldTransform=new f;this.isInContact=!1}var g=b("../math/Vec3"),
f=b("../math/Transform"),h=b("../collision/RaycastResult"),k=b("../utils/Utils");c.exports=d;var l=new g,n=new g,l=new g;d.prototype.updateWheel=function(b){var c=this.raycastResult;if(this.isInContact){var d=c.hitNormalWorld.dot(c.directionWorld);c.hitPointWorld.vsub(b.position,n);b.getVelocityAtWorldPoint(n,l);b=c.hitNormalWorld.dot(l);-.1<=d?(this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10):(d=-1/d,this.suspensionRelativeVelocity=b*d,this.clippedInvContactDotSuspension=
d)}else c.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,c.directionWorld.scale(-1,c.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(b,c,e){function d(b){g.call(this);this.type=g.types.BOX;this.halfExtents=b;this.convexPolyhedronRepresentation=null;this.updateConvexPolyhedronRepresentation();this.updateBoundingSphereRadius()}c.exports=d;var g=b("./Shape"),
f=b("../math/Vec3"),h=b("./ConvexPolyhedron");d.prototype=new g;d.prototype.constructor=d;d.prototype.updateConvexPolyhedronRepresentation=function(){var b=this.halfExtents.x,c=this.halfExtents.y,d=this.halfExtents.z,b=[new f(-b,-c,-d),new f(b,-c,-d),new f(b,c,-d),new f(-b,c,-d),new f(-b,-c,d),new f(b,-c,d),new f(b,c,d),new f(-b,c,d)];new f(0,0,1);new f(0,1,0);new f(1,0,0);this.convexPolyhedronRepresentation=b=new h(b,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]);b.material=this.material};
d.prototype.calculateLocalInertia=function(b,c){c=c||new f;d.calculateInertia(this.halfExtents,b,c);return c};d.calculateInertia=function(b,c,d){d.x=1/12*c*(4*b.y*b.y+4*b.z*b.z);d.y=1/12*c*(4*b.x*b.x+4*b.z*b.z);d.z=1/12*c*(4*b.y*b.y+4*b.x*b.x)};d.prototype.getSideNormals=function(b,c){var d=this.halfExtents;b[0].set(d.x,0,0);b[1].set(0,d.y,0);b[2].set(0,0,d.z);b[3].set(-d.x,0,0);b[4].set(0,-d.y,0);b[5].set(0,0,-d.z);if(void 0!==c)for(d=0;d!==b.length;d++)c.vmult(b[d],b[d]);return b};d.prototype.volume=
function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z};d.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var k=new f;new f;d.prototype.forEachWorldCorner=function(b,c,d){for(var e=this.halfExtents,e=[[e.x,e.y,e.z],[-e.x,e.y,e.z],[-e.x,-e.y,e.z],[-e.x,-e.y,-e.z],[e.x,-e.y,-e.z],[e.x,e.y,-e.z],[-e.x,e.y,-e.z],[e.x,-e.y,e.z]],f=0;f<e.length;f++)k.set(e[f][0],e[f][1],e[f][2]),c.vmult(k,k),b.vadd(k,k),d(k.x,k.y,k.z)};var l=[new f,
new f,new f,new f,new f,new f,new f,new f];d.prototype.calculateWorldAABB=function(b,c,d,e){var f=this.halfExtents;l[0].set(f.x,f.y,f.z);l[1].set(-f.x,f.y,f.z);l[2].set(-f.x,-f.y,f.z);l[3].set(-f.x,-f.y,-f.z);l[4].set(f.x,-f.y,-f.z);l[5].set(f.x,f.y,-f.z);l[6].set(-f.x,f.y,-f.z);l[7].set(f.x,-f.y,f.z);var g=l[0];c.vmult(g,g);b.vadd(g,g);e.copy(g);d.copy(g);for(f=1;8>f;f++){g=l[f];c.vmult(g,g);b.vadd(g,g);var h=g.x,p=g.y,g=g.z;h>e.x&&(e.x=h);p>e.y&&(e.y=p);g>e.z&&(e.z=g);h<d.x&&(d.x=h);p<d.y&&(d.y=
p);g<d.z&&(d.z=g)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(b,c,e){function d(b,c,d){g.call(this);this.type=g.types.CONVEXPOLYHEDRON;this.vertices=b||[];this.worldVertices=[];this.worldVerticesNeedsUpdate=!0;this.faces=c||[];this.faceNormals=[];this.computeNormals();this.worldFaceNormalsNeedsUpdate=!0;this.worldFaceNormals=[];this.uniqueEdges=[];this.uniqueAxes=d?d.slice():null;this.computeEdges();this.updateBoundingSphereRadius()}c.exports=d;var g=b("./Shape"),f=b("../math/Vec3");
b("../math/Quaternion");var h=b("../math/Transform");d.prototype=new g;d.prototype.constructor=d;var k=new f;d.prototype.computeEdges=function(){for(var b=this.faces,c=this.vertices,d=this.uniqueEdges,e=d.length=0;e!==b.length;e++)for(var f=b[e],g=f.length,h=0;h!==g;h++){c[f[h]].vsub(c[f[(h+1)%g]],k);k.normalize();for(var p=!1,m=0;m!==d.length;m++)if(d[m].almostEquals(k)||d[m].almostEquals(k)){p=!0;break}p||d.push(k.clone())}};d.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;
for(var b=0;b<this.faces.length;b++){for(var c=0;c<this.faces[b].length;c++)if(!this.vertices[this.faces[b][c]])throw Error("Vertex "+this.faces[b][c]+" not found!");c=this.faceNormals[b]||new f;this.getFaceNormal(b,c);c.negate(c);this.faceNormals[b]=c;if(0>c.dot(this.vertices[this.faces[b][0]]))for(console.error(".faceNormals["+b+"] = Vec3("+c.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),c=0;c<
this.faces[b].length;c++)console.warn(".vertices["+this.faces[b][c]+"] = Vec3("+this.vertices[this.faces[b][c]].toString()+")")}};var l=new f,n=new f;d.computeNormal=function(b,c,d,e){c.vsub(b,n);d.vsub(c,l);l.cross(n,e);e.isZero()||e.normalize()};d.prototype.getFaceNormal=function(b,c){var e=this.faces[b];return d.computeNormal(this.vertices[e[0]],this.vertices[e[1]],this.vertices[e[2]],c)};var q=new f;d.prototype.clipAgainstHull=function(b,c,d,e,g,h,p,k,m){for(var l=-1,n=-Number.MAX_VALUE,r=0;r<
d.faces.length;r++){q.copy(d.faceNormals[r]);g.vmult(q,q);var t=q.dot(h);t>n&&(n=t,l=r)}for(var n=[],r=d.faces[l],t=r.length,u=0;u<t;u++){var v=d.vertices[r[u]],w=new f;w.copy(v);g.vmult(w,w);e.vadd(w,w);n.push(w)}0<=l&&this.clipFaceAgainstHull(h,b,c,n,p,k,m)};var m=new f,p=new f,r=new f,t=new f,w=new f,v=new f;d.prototype.findSeparatingAxis=function(b,c,d,e,f,g,h,k){var l=Number.MAX_VALUE,n=0;if(this.uniqueAxes)for(u=0;u!==this.uniqueAxes.length;u++){d.vmult(this.uniqueAxes[u],m);x=this.testSepAxis(m,
b,c,d,e,f);if(!1===x)return!1;x<l&&(l=x,g.copy(m))}else for(var q=h?h.length:this.faces.length,u=0;u<q;u++){x=h?h[u]:u;m.copy(this.faceNormals[x]);d.vmult(m,m);var x=this.testSepAxis(m,b,c,d,e,f);if(!1===x)return!1;x<l&&(l=x,g.copy(m))}if(b.uniqueAxes)for(u=0;u!==b.uniqueAxes.length;u++){f.vmult(b.uniqueAxes[u],p);n++;x=this.testSepAxis(p,b,c,d,e,f);if(!1===x)return!1;x<l&&(l=x,g.copy(p))}else for(h=k?k.length:b.faces.length,u=0;u<h;u++){x=k?k[u]:u;p.copy(b.faceNormals[x]);f.vmult(p,p);n++;x=this.testSepAxis(p,
b,c,d,e,f);if(!1===x)return!1;x<l&&(l=x,g.copy(p))}for(k=0;k!==this.uniqueEdges.length;k++)for(d.vmult(this.uniqueEdges[k],t),n=0;n!==b.uniqueEdges.length;n++)if(f.vmult(b.uniqueEdges[n],w),t.cross(w,v),!v.almostZero()){v.normalize();u=this.testSepAxis(v,b,c,d,e,f);if(!1===u)return!1;u<l&&(l=u,g.copy(v))}e.vsub(c,r);0<r.dot(g)&&g.negate(g);return!0};var u=[],z=[];d.prototype.testSepAxis=function(b,c,e,f,g,h){d.project(this,b,e,f,u);d.project(c,b,g,h,z);e=u[0];b=u[1];c=z[0];f=z[1];if(e<f||c<b)return!1;
e-=f;b=c-b;return e<b?e:b};var x=new f,A=new f;d.prototype.calculateLocalInertia=function(b,c){this.computeLocalAABB(x,A);var d=A.x-x.x,e=A.y-x.y,f=A.z-x.z;c.x=1/12*b*(4*e*e+4*f*f);c.y=1/12*b*(4*d*d+4*f*f);c.z=1/12*b*(4*e*e+4*d*d)};d.prototype.getPlaneConstantOfFace=function(b){return-this.faceNormals[b].dot(this.vertices[this.faces[b][0]])};var y=new f,B=new f,C=new f,F=new f,H=new f,K=new f,M=new f,O=new f;d.prototype.clipFaceAgainstHull=function(b,c,d,e,f,g,h){for(var p=[],k=-1,m=Number.MAX_VALUE,
l=0;l<this.faces.length;l++){y.copy(this.faceNormals[l]);d.vmult(y,y);var n=y.dot(b);n<m&&(m=n,k=l)}if(!(0>k)){b=this.faces[k];b.connectedFaces=[];for(m=0;m<this.faces.length;m++)for(l=0;l<this.faces[m].length;l++)-1!==b.indexOf(this.faces[m][l])&&m!==k&&-1===b.connectedFaces.indexOf(m)&&b.connectedFaces.push(m);m=b.length;for(l=0;l<m;l++){n=this.vertices[b[l]];n.vsub(this.vertices[b[(l+1)%m]],B);C.copy(B);d.vmult(C,C);c.vadd(C,C);F.copy(this.faceNormals[k]);d.vmult(F,F);c.vadd(F,F);C.cross(F,H);
H.negate(H);K.copy(n);d.vmult(K,K);c.vadd(K,K);K.dot(H);n=b.connectedFaces[l];M.copy(this.faceNormals[n]);n=this.getPlaneConstantOfFace(n);O.copy(M);d.vmult(O,O);n-=O.dot(c);for(this.clipFaceAgainstPlane(e,p,O,n);e.length;)e.shift();for(;p.length;)e.push(p.shift())}M.copy(this.faceNormals[k]);n=this.getPlaneConstantOfFace(k);O.copy(M);d.vmult(O,O);n-=O.dot(c);for(m=0;m<e.length;m++)c=O.dot(e[m])+n,c<=f&&(console.log("clamped: depth="+c+" to minDist="+(f+"")),c=f),c<=g&&(d=e[m],0>=c&&h.push({point:d,
normal:O,depth:c}))}};d.prototype.clipFaceAgainstPlane=function(b,c,d,e){var g,h,p=b.length;if(2>p)return c;var k=b[b.length-1],m;g=d.dot(k)+e;for(var l=0;l<p;l++){m=b[l];h=d.dot(m)+e;if(0>g){if(0>h){var n=new f;n.copy(m)}else n=new f,k.lerp(m,g/(g-h),n);c.push(n)}else 0>h&&(n=new f,k.lerp(m,g/(g-h),n),c.push(n),c.push(m));k=m;g=h}return c};d.prototype.computeWorldVertices=function(b,c){for(var d=this.vertices.length;this.worldVertices.length<d;)this.worldVertices.push(new f);for(var e=this.vertices,
g=this.worldVertices,h=0;h!==d;h++)c.vmult(e[h],g[h]),b.vadd(g[h],g[h]);this.worldVerticesNeedsUpdate=!1};new f;d.prototype.computeLocalAABB=function(b,c){var d=this.vertices.length,e=this.vertices;b.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);c.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var f=0;f<d;f++){var g=e[f];g.x<b.x?b.x=g.x:g.x>c.x&&(c.x=g.x);g.y<b.y?b.y=g.y:g.y>c.y&&(c.y=g.y);g.z<b.z?b.z=g.z:g.z>c.z&&(c.z=g.z)}};d.prototype.computeWorldFaceNormals=function(b){for(var c=
this.faceNormals.length;this.worldFaceNormals.length<c;)this.worldFaceNormals.push(new f);for(var d=this.faceNormals,e=this.worldFaceNormals,g=0;g!==c;g++)b.vmult(d[g],e[g]);this.worldFaceNormalsNeedsUpdate=!1};d.prototype.updateBoundingSphereRadius=function(){for(var b=0,c=this.vertices,d=0,e=c.length;d!==e;d++){var f=c[d].norm2();f>b&&(b=f)}this.boundingSphereRadius=Math.sqrt(b)};var I=new f;d.prototype.calculateWorldAABB=function(b,c,d,e){for(var f=this.vertices.length,g=this.vertices,h,p,k,m,
l,n,r=0;r<f;r++){I.copy(g[r]);c.vmult(I,I);b.vadd(I,I);var q=I;if(q.x<h||void 0===h)h=q.x;else if(q.x>m||void 0===m)m=q.x;if(q.y<p||void 0===p)p=q.y;else if(q.y>l||void 0===l)l=q.y;if(q.z<k||void 0===k)k=q.z;else if(q.z>n||void 0===n)n=q.z}d.set(h,p,k);e.set(m,l,n)};d.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};d.prototype.getAveragePointLocal=function(b){b=b||new f;for(var c=this.vertices.length,d=this.vertices,e=0;e<c;e++)b.vadd(d[e],b);b.mult(1/c,b);return b};d.prototype.transformAllPoints=
function(b,c){var d=this.vertices.length,e=this.vertices;if(c){for(var f=0;f<d;f++){var g=e[f];c.vmult(g,g)}for(f=0;f<this.faceNormals.length;f++)g=this.faceNormals[f],c.vmult(g,g)}if(b)for(f=0;f<d;f++)g=e[f],g.vadd(b,g)};var D=new f,J=new f,N=new f;d.prototype.pointIsInside=function(b){var c,d=this.vertices,e=this.faces,f=this.faceNormals,g=this.faces.length;this.getAveragePointLocal(D);for(var h=0;h<g;h++){c=f[h];var p=d[e[h][0]],k=J;b.vsub(p,k);var k=c.dot(k),m=N;D.vsub(p,m);c=c.dot(m);if(0>k&&
0<c||0<k&&0>c)return!1}return-1};new f;var S=new f,Q=new f;d.project=function(b,c,d,e,f){var g=b.vertices.length;b=b.vertices;Q.setZero();h.vectorToLocalFrame(d,e,c,S);h.pointToLocalFrame(d,e,Q,Q);e=Q.dot(S);d=c=b[0].dot(S);for(var p=1;p<g;p++){var k=b[p].dot(S);k>c&&(c=k);k<d&&(d=k)}d-=e;c-=e;d>c&&(g=d,d=c,c=g);f[0]=c;f[1]=d}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(b,c,e){function d(b,c,d,e){var k=[],p=[],l=[],n=[],q=[],v=Math.cos,u=Math.sin;
k.push(new f(c*v(0),c*u(0),.5*-d));n.push(0);k.push(new f(b*v(0),b*u(0),.5*d));q.push(1);for(var z=0;z<e;z++){var x=2*Math.PI/e*(z+1),A=2*Math.PI/e*(z+.5);z<e-1?(k.push(new f(c*v(x),c*u(x),.5*-d)),n.push(2*z+2),k.push(new f(b*v(x),b*u(x),.5*d)),q.push(2*z+3),l.push([2*z+2,2*z+3,2*z+1,2*z])):l.push([0,1,2*z+1,2*z]);(1===e%2||z<e/2)&&p.push(new f(v(A),u(A),0))}l.push(q);p.push(new f(0,0,1));b=[];for(z=0;z<n.length;z++)b.push(n[n.length-z-1]);l.push(b);this.type=g.types.CONVEXPOLYHEDRON;h.call(this,
k,l,p)}c.exports=d;var g=b("./Shape"),f=b("../math/Vec3");b("../math/Quaternion");var h=b("./ConvexPolyhedron");d.prototype=new h},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(b,c,e){function d(b,c){c=k.defaults(c,{maxValue:null,minValue:null,elementSize:1});this.data=b;this.maxValue=c.maxValue;this.minValue=c.minValue;this.elementSize=c.elementSize;null===c.minValue&&this.updateMinValue();null===c.maxValue&&this.updateMaxValue();this.cacheEnabled=
!0;g.call(this);this.pillarConvex=new f;this.pillarOffset=new h;this.type=g.types.HEIGHTFIELD;this.updateBoundingSphereRadius();this._cachedPillars={}}var g=b("./Shape"),f=b("./ConvexPolyhedron"),h=b("../math/Vec3"),k=b("../utils/Utils");c.exports=d;d.prototype=new g;d.prototype.update=function(){this._cachedPillars={}};d.prototype.updateMinValue=function(){for(var b=this.data,c=b[0][0],d=0;d!==b.length;d++)for(var e=0;e!==b[d].length;e++){var f=b[d][e];f<c&&(c=f)}this.minValue=c};d.prototype.updateMaxValue=
function(){for(var b=this.data,c=b[0][0],d=0;d!==b.length;d++)for(var e=0;e!==b[d].length;e++){var f=b[d][e];f>c&&(c=f)}this.maxValue=c};d.prototype.setHeightValueAtIndex=function(b,c,d){this.data[b][c]=d;this.clearCachedConvexTrianglePillar(b,c,!1);0<b&&(this.clearCachedConvexTrianglePillar(b-1,c,!0),this.clearCachedConvexTrianglePillar(b-1,c,!1));0<c&&(this.clearCachedConvexTrianglePillar(b,c-1,!0),this.clearCachedConvexTrianglePillar(b,c-1,!1));0<c&&0<b&&this.clearCachedConvexTrianglePillar(b-
1,c-1,!0)};d.prototype.getRectMinMax=function(b,c,d,e,f){f=f||[];for(var g=this.data,h=this.minValue;b<=d;b++)for(var p=c;p<=e;p++){var k=g[b][p];k>h&&(h=k)}f[0]=this.minValue;f[1]=h};d.prototype.getIndexOfPosition=function(b,c,d,e){var f=this.elementSize,g=this.data;b=Math.floor(b/f);c=Math.floor(c/f);d[0]=b;d[1]=c;e&&(0>b&&(b=0),0>c&&(c=0),b>=g.length-1&&(b=g.length-1),c>=g[0].length-1&&(c=g[0].length-1));return 0>b||0>c||b>=g.length-1||c>=g[0].length-1?!1:!0};d.prototype.getHeightAt=function(b,
c,d){var e=[];this.getIndexOfPosition(b,c,e,d);b=[];this.getRectMinMax(e[0],e[1]+1,e[0],e[1]+1,b);return(b[0]+b[1])/2};d.prototype.getCacheConvexTrianglePillarKey=function(b,c,d){return b+"_"+c+"_"+(d?1:0)};d.prototype.getCachedConvexTrianglePillar=function(b,c,d){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(b,c,d)]};d.prototype.setCachedConvexTrianglePillar=function(b,c,d,e,f){this._cachedPillars[this.getCacheConvexTrianglePillarKey(b,c,d)]={convex:e,offset:f}};d.prototype.clearCachedConvexTrianglePillar=
function(b,c,d){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(b,c,d)]};d.prototype.getConvexTrianglePillar=function(b,c,d){var e=this.pillarConvex,g=this.pillarOffset;if(this.cacheEnabled){var k=this.getCachedConvexTrianglePillar(b,c,d);if(k){this.pillarConvex=k.convex;this.pillarOffset=k.offset;return}e=new f;g=new h;this.pillarConvex=e;this.pillarOffset=g}var k=this.data,l=this.elementSize,n=e.faces;e.vertices.length=6;for(var q=0;6>q;q++)e.vertices[q]||(e.vertices[q]=new h);n.length=
5;for(q=0;5>q;q++)n[q]||(n[q]=[]);var q=e.vertices,u=(Math.min(k[b][c],k[b+1][c],k[b][c+1],k[b+1][c+1])-this.minValue)/2+this.minValue;d?(g.set((b+.75)*l,(c+.75)*l,u),q[0].set(.25*l,.25*l,k[b+1][c+1]-u),q[1].set(-.75*l,.25*l,k[b][c+1]-u),q[2].set(.25*l,-.75*l,k[b+1][c]-u),q[3].set(.25*l,.25*l,-u-1),q[4].set(-.75*l,.25*l,-u-1),q[5].set(.25*l,-.75*l,-u-1),n[0][0]=0,n[0][1]=1,n[0][2]=2,n[1][0]=5,n[1][1]=4,n[1][2]=3,n[2][0]=2,n[2][1]=5,n[2][2]=3,n[2][3]=0,n[3][0]=3,n[3][1]=4,n[3][2]=1,n[3][3]=0,n[4][0]=
1,n[4][1]=4,n[4][2]=5,n[4][3]=2):(g.set((b+.25)*l,(c+.25)*l,u),q[0].set(-.25*l,-.25*l,k[b][c]-u),q[1].set(.75*l,-.25*l,k[b+1][c]-u),q[2].set(-.25*l,.75*l,k[b][c+1]-u),q[3].set(-.25*l,-.25*l,-u-1),q[4].set(.75*l,-.25*l,-u-1),q[5].set(-.25*l,.75*l,-u-1),n[0][0]=0,n[0][1]=1,n[0][2]=2,n[1][0]=5,n[1][1]=4,n[1][2]=3,n[2][0]=0,n[2][1]=2,n[2][2]=5,n[2][3]=3,n[3][0]=1,n[3][1]=0,n[3][2]=3,n[3][3]=4,n[4][0]=4,n[4][1]=5,n[4][2]=2,n[4][3]=1);e.computeNormals();e.computeEdges();e.updateBoundingSphereRadius();this.setCachedConvexTrianglePillar(b,
c,d,e,g)};d.prototype.calculateLocalInertia=function(b,c){c=c||new h;c.set(0,0,0);return c};d.prototype.volume=function(){return Number.MAX_VALUE};d.prototype.calculateWorldAABB=function(b,c,d,e){d.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};d.prototype.updateBoundingSphereRadius=function(){var b=this.data,c=this.elementSize;this.boundingSphereRadius=(new h(b.length*c,b[0].length*c,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue)))).norm()}},
{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(b,c,e){function d(){g.call(this);this.type=g.types.PARTICLE}c.exports=d;var g=b("./Shape"),f=b("../math/Vec3");d.prototype=new g;d.prototype.constructor=d;d.prototype.calculateLocalInertia=function(b,c){c=c||new f;c.set(0,0,0);return c};d.prototype.volume=function(){return 0};d.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0};d.prototype.calculateWorldAABB=function(b,c,d,e){d.copy(b);
e.copy(b)}},{"../math/Vec3":30,"./Shape":43}],42:[function(b,c,e){function d(){g.call(this);this.type=g.types.PLANE;this.worldNormal=new f;this.worldNormalNeedsUpdate=!0;this.boundingSphereRadius=Number.MAX_VALUE}c.exports=d;var g=b("./Shape"),f=b("../math/Vec3");d.prototype=new g;d.prototype.constructor=d;d.prototype.computeWorldNormal=function(b){var c=this.worldNormal;c.set(0,0,1);b.vmult(c,c);this.worldNormalNeedsUpdate=!1};d.prototype.calculateLocalInertia=function(b,c){return c=c||new f};d.prototype.volume=
function(){return Number.MAX_VALUE};var h=new f;d.prototype.calculateWorldAABB=function(b,c,d,e){h.set(0,0,1);c.vmult(h,h);c=Number.MAX_VALUE;d.set(-c,-c,-c);e.set(c,c,c);1===h.x&&(e.x=b.x);1===h.y&&(e.y=b.y);1===h.z&&(e.z=b.z);-1===h.x&&(d.x=b.x);-1===h.y&&(d.y=b.y);-1===h.z&&(d.z=b.z)};d.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(b,c,e){function d(){this.id=d.idCounter++;this.boundingSphereRadius=this.type=
0;this.collisionResponse=!0;this.material=null}c.exports=d;d=b("./Shape");b("../math/Vec3");b("../math/Quaternion");b("../material/Material");d.prototype.constructor=d;d.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type;};d.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type;};d.prototype.calculateLocalInertia=function(b,c){throw"calculateLocalInertia() not implemented for shape type "+this.type;
};d.idCounter=0;d.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(b,c,e){function d(b){g.call(this);this.radius=void 0!==b?Number(b):1;this.type=g.types.SPHERE;if(0>this.radius)throw Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}c.exports=d;var g=b("./Shape"),f=b("../math/Vec3");d.prototype=new g;d.prototype.constructor=
d;d.prototype.calculateLocalInertia=function(b,c){c=c||new f;var d=2*b*this.radius*this.radius/5;c.x=d;c.y=d;c.z=d;return c};d.prototype.volume=function(){return 4*Math.PI*this.radius/3};d.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius};d.prototype.calculateWorldAABB=function(b,c,d,e){c=this.radius;for(var f=["x","y","z"],g=0;g<f.length;g++){var h=f[g];d[h]=b[h]-c;e[h]=b[h]+c}}},{"../math/Vec3":30,"./Shape":43}],45:[function(b,c,e){function d(b,c){g.call(this);
this.type=g.types.TRIMESH;this.vertices=new Float32Array(b);this.indices=new Int16Array(c);this.normals=new Float32Array(c.length);this.aabb=new k;this.edges=null;this.scale=new f(1,1,1);this.tree=new l;this.updateEdges();this.updateNormals();this.updateAABB();this.updateBoundingSphereRadius();this.updateTree()}c.exports=d;var g=b("./Shape"),f=b("../math/Vec3");b("../math/Quaternion");var h=b("../math/Transform"),k=b("../collision/AABB"),l=b("../utils/Octree");d.prototype=new g;d.prototype.constructor=
d;var n=new f;d.prototype.updateTree=function(){var b=this.tree;b.reset();b.aabb.copy(this.aabb);var c=this.scale;b.aabb.lowerBound.x*=1/c.x;b.aabb.lowerBound.y*=1/c.y;b.aabb.lowerBound.z*=1/c.z;b.aabb.upperBound.x*=1/c.x;b.aabb.upperBound.y*=1/c.y;b.aabb.upperBound.z*=1/c.z;for(var c=new k,d=new f,e=new f,g=new f,h=[d,e,g],p=0;p<this.indices.length/3;p++){var m=3*p;this._getUnscaledVertex(this.indices[m],d);this._getUnscaledVertex(this.indices[m+1],e);this._getUnscaledVertex(this.indices[m+2],g);
c.setFromPoints(h);b.insert(c,p)}b.removeEmptyNodes()};var q=new k;d.prototype.getTrianglesInAABB=function(b,c){q.copy(b);var d=this.scale,e=d.x,f=d.y,d=d.z,g=q.lowerBound,h=q.upperBound;g.x/=e;g.y/=f;g.z/=d;h.x/=e;h.y/=f;h.z/=d;return this.tree.aabbQuery(q,c)};d.prototype.setScale=function(b){var c=b.x===b.y===b.z;this.scale.x===this.scale.y===this.scale.z&&c||this.updateNormals();this.scale.copy(b);this.updateAABB();this.updateBoundingSphereRadius()};d.prototype.updateNormals=function(){for(var b=
this.normals,c=0;c<this.indices.length/3;c++){var e=3*c,f=this.indices[e+1],g=this.indices[e+2];this.getVertex(this.indices[e],w);this.getVertex(f,v);this.getVertex(g,u);d.computeNormal(v,w,u,n);b[e]=n.x;b[e+1]=n.y;b[e+2]=n.z}};d.prototype.updateEdges=function(){for(var b={},c=function(c,d){b[f<g?f+"_"+g:g+"_"+f]=!0},d=0;d<this.indices.length/3;d++){var e=3*d,f=this.indices[e],g=this.indices[e+1],e=this.indices[e+2];c(f,g);c(g,e);c(e,f)}c=Object.keys(b);this.edges=new Int16Array(2*c.length);for(d=
0;d<c.length;d++)e=c[d].split("_"),this.edges[2*d]=parseInt(e[0],10),this.edges[2*d+1]=parseInt(e[1],10)};d.prototype.getEdgeVertex=function(b,c,d){this.getVertex(this.edges[2*b+(c?1:0)],d)};var m=new f,p=new f;d.prototype.getEdgeVector=function(b,c){this.getEdgeVertex(b,0,m);this.getEdgeVertex(b,1,p);p.vsub(m,c)};var r=new f,t=new f;d.computeNormal=function(b,c,d,e){c.vsub(b,t);d.vsub(c,r);r.cross(t,e);e.isZero()||e.normalize()};var w=new f,v=new f,u=new f;d.prototype.getVertex=function(b,c){var d=
this.scale;this._getUnscaledVertex(b,c);c.x*=d.x;c.y*=d.y;c.z*=d.z;return c};d.prototype._getUnscaledVertex=function(b,c){var d=3*b,e=this.vertices;return c.set(e[d],e[d+1],e[d+2])};d.prototype.getWorldVertex=function(b,c,d,e){this.getVertex(b,e);h.pointToWorldFrame(c,d,e,e);return e};d.prototype.getTriangleVertices=function(b,c,d,e){b*=3;this.getVertex(this.indices[b],c);this.getVertex(this.indices[b+1],d);this.getVertex(this.indices[b+2],e)};d.prototype.getNormal=function(b,c){var d=3*b;return c.set(this.normals[d],
this.normals[d+1],this.normals[d+2])};var z=new k;d.prototype.calculateLocalInertia=function(b,c){this.computeLocalAABB(z);var d=z.upperBound.x-z.lowerBound.x,e=z.upperBound.y-z.lowerBound.y,f=z.upperBound.z-z.lowerBound.z;return c.set(1/12*b*(4*e*e+4*f*f),1/12*b*(4*d*d+4*f*f),1/12*b*(4*e*e+4*d*d))};var x=new f;d.prototype.computeLocalAABB=function(b){var c=b.lowerBound;b=b.upperBound;var d=this.vertices.length;this.getVertex(0,x);c.copy(x);b.copy(x);for(var e=0;e!==d;e++)this.getVertex(e,x),x.x<
c.x?c.x=x.x:x.x>b.x&&(b.x=x.x),x.y<c.y?c.y=x.y:x.y>b.y&&(b.y=x.y),x.z<c.z?c.z=x.z:x.z>b.z&&(b.z=x.z)};d.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)};d.prototype.updateBoundingSphereRadius=function(){for(var b=0,c=this.vertices,d=new f,e=0,c=c.length/3;e!==c;e++){this.getVertex(e,d);var g=d.norm2();g>b&&(b=g)}this.boundingSphereRadius=Math.sqrt(b)};new f;var A=new h,y=new k;d.prototype.calculateWorldAABB=function(b,c,d,e){A.position=b;A.quaternion=c;this.aabb.toWorldFrame(A,y);
d.copy(y.lowerBound);e.copy(y.upperBound)};d.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};d.createTorus=function(b,c,e,f,g){b=b||1;c=c||.5;e=e||8;f=f||6;g=g||2*Math.PI;for(var h=[],p=[],k=0;k<=e;k++)for(var m=0;m<=f;m++){var l=m/f*g,n=k/e*Math.PI*2;h.push((b+c*Math.cos(n))*Math.cos(l),(b+c*Math.cos(n))*Math.sin(l),c*Math.sin(n))}for(k=1;k<=e;k++)for(m=1;m<=f;m++)b=(f+1)*(k-1)+m-1,c=(f+1)*(k-1)+m,g=(f+1)*k+m,p.push((f+1)*k+m-1,b,g),p.push(b,c,g);return new d(h,p)}},{"../collision/AABB":3,
"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(b,c,e){function d(){g.call(this);this.iterations=10;this.tolerance=1E-7}c.exports=d;b("../math/Vec3");b("../math/Quaternion");var g=b("./Solver");d.prototype=new g;var f=[],h=[],k=[];d.prototype.solve=function(b,c){var d=0,e=this.iterations,g=this.tolerance*this.tolerance,l=this.equations,n=l.length,w=c.bodies,v=w.length,u,z,x,A,y;if(0!==n)for(x=0;x!==v;x++)w[x].updateSolveMassProperties();
h.length=n;k.length=n;f.length=n;for(x=0;x!==n;x++){var B=l[x];f[x]=0;k[x]=B.computeB(b);h[x]=1/B.computeC()}if(0!==n){for(x=0;x!==v;x++)B=w[x],d=B.wlambda,B.vlambda.set(0,0,0),d&&d.set(0,0,0);for(d=0;d!==e;d++){for(var C=x=0;C!==n;C++)B=l[C],u=k[C],z=h[C],y=f[C],A=B.computeGWlambda(),u=z*(u-A-B.eps*y),y+u<B.minForce?u=B.minForce-y:y+u>B.maxForce&&(u=B.maxForce-y),f[C]+=u,x+=0<u?u:-u,B.addToWlambda(u);if(x*x<g)break}for(x=0;x!==v;x++)B=w[x],e=B.velocity,g=B.angularVelocity,e.vadd(B.vlambda,e),g&&
g.vadd(B.wlambda,g)}return d}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(b,c,e){function d(){this.equations=[]}c.exports=d;d.prototype.solve=function(b,c){return 0};d.prototype.addEquation=function(b){b.enabled&&this.equations.push(b)};d.prototype.removeEquation=function(b){var c=this.equations;b=c.indexOf(b);-1!==b&&c.splice(b,1)};d.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(b,c,e){function d(b,c,d){k.call(this);this.iterations=
c;this.tolerance=d;this.subsolver=b;this.nodes=[];for(this.nodePool=[];128>this.nodePool.length;)this.nodePool.push(this.createNode())}function g(b){for(var c=b.length,d=0;d!==c;d++){var e=b[d];if(!(e.visited||e.body.type&m))return e}return!1}function f(b,c,d){c.push(b.body);c=b.eqs.length;for(var e=0;e!==c;e++){var f=b.eqs[e];-1===d.indexOf(f)&&d.push(f)}}function h(b,c){return c.id-b.id}c.exports=d;b("../math/Vec3");b("../math/Quaternion");var k=b("./Solver");b=b("../objects/Body");d.prototype=
new k;var l=[],n=[],q={bodies:[]},m=b.STATIC,p=[];d.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}};d.prototype.solve=function(b,c){for(var d=this.nodePool,e=c.bodies,k=this.equations,m=k.length,r=e.length,t=this.subsolver;d.length<r;)d.push(this.createNode());l.length=r;for(var y=0;y<r;y++)l[y]=d[y];for(y=0;y!==r;y++)d=l[y],d.body=e[y],d.children.length=0,d.eqs.length=0,d.visited=!1;for(r=0;r!==m;r++){var d=k[r],y=e.indexOf(d.bi),B=e.indexOf(d.bj),y=l[y],B=l[B];y.children.push(B);
y.eqs.push(d);B.children.push(y);B.eqs.push(d)}e=0;k=n;t.tolerance=this.tolerance;for(t.iterations=this.iterations;y=g(l);){k.length=0;q.bodies.length=0;d=y;y=f;m=q.bodies;r=k;p.push(d);d.visited=!0;for(y(d,m,r);p.length;)for(d=p.pop();B=g(d.children);)B.visited=!0,y(B,m,r),p.push(B);m=k.length;k=k.sort(h);for(y=0;y!==m;y++)t.addEquation(k[y]);t.solve(b,q);t.removeAllEquations();e++}return e}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(b,c,e){b=function(){};
c.exports=b;b.prototype={constructor:b,addEventListener:function(b,c){void 0===this._listeners&&(this._listeners={});var d=this._listeners;void 0===d[b]&&(d[b]=[]);-1===d[b].indexOf(c)&&d[b].push(c);return this},hasEventListener:function(b,c){if(void 0===this._listeners)return!1;var d=this._listeners;return void 0!==d[b]&&-1!==d[b].indexOf(c)?!0:!1},removeEventListener:function(b,c){if(void 0===this._listeners)return this;var d=this._listeners;if(void 0===d[b])return this;var e=d[b].indexOf(c);-1!==
e&&d[b].splice(e,1);return this},dispatchEvent:function(b){if(void 0===this._listeners)return this;var c=this._listeners[b.type];if(void 0!==c){b.target=this;for(var d=0,e=c.length;d<e;d++)c[d].call(this,b)}return this}}},{}],50:[function(b,c,e){function d(b){b=b||{};this.root=b.root||null;this.aabb=b.aabb?b.aabb.clone():new f;this.data=[];this.children=[]}function g(b,c){c=c||{};c.root=null;c.aabb=b;d.call(this,c);this.maxDepth="undefined"!==typeof c.maxDepth?c.maxDepth:8}var f=b("../collision/AABB"),
h=b("../math/Vec3");c.exports=g;g.prototype=new d;d.prototype.reset=function(b,c){this.children.length=this.data.length=0};d.prototype.insert=function(b,c,d){var e=this.data;d=d||0;if(!this.aabb.contains(b))return!1;var f=this.children;if(d<(this.maxDepth||this.root.maxDepth)){var g=!1;f.length||(this.subdivide(),g=!0);for(var h=0;8!==h;h++)if(f[h].insert(b,c,d+1))return!0;g&&(f.length=0)}e.push(c);return!0};var k=new h;d.prototype.subdivide=function(){var b=this.aabb,c=b.lowerBound,e=b.upperBound,
b=this.children;b.push(new d({aabb:new f({lowerBound:new h(0,0,0)})}),new d({aabb:new f({lowerBound:new h(1,0,0)})}),new d({aabb:new f({lowerBound:new h(1,1,0)})}),new d({aabb:new f({lowerBound:new h(1,1,1)})}),new d({aabb:new f({lowerBound:new h(0,1,1)})}),new d({aabb:new f({lowerBound:new h(0,0,1)})}),new d({aabb:new f({lowerBound:new h(1,0,1)})}),new d({aabb:new f({lowerBound:new h(0,1,0)})}));e.vsub(c,k);k.scale(.5,k);for(var e=this.root||this,g=0;8!==g;g++){var l=b[g];l.root=e;var t=l.aabb.lowerBound;
t.x*=k.x;t.y*=k.y;t.z*=k.z;t.vadd(c,t);t.vadd(k,l.aabb.upperBound)}};d.prototype.aabbQuery=function(b,c){for(var d=[this];d.length;){var e=d.pop();e.aabb.overlaps(b)&&Array.prototype.push.apply(c,e.data);Array.prototype.push.apply(d,e.children)}return c};var l=new f;d.prototype.rayQuery=function(b,c,d){b.getAABB(l);l.toLocalFrame(c,l);this.aabbQuery(l,d);return d};d.prototype.removeEmptyNodes=function(){for(var b=[this];b.length;){for(var c=b.pop(),d=c.children.length-1;0<=d;d--)c.children[d].data.length||
c.children.splice(d,1);Array.prototype.push.apply(b,c.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(b,c,e){function d(){this.objects=[];this.type=Object}c.exports=d;d.prototype.release=function(){for(var b=arguments.length,c=0;c!==b;c++)this.objects.push(arguments[c])};d.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()};d.prototype.constructObject=function(){throw Error("constructObject() not implemented in this Pool subclass yet!");
}},{}],52:[function(b,c,e){function d(){this.data={keys:[]}}c.exports=d;d.prototype.get=function(b,c){if(b>c){var d=c;c=b;b=d}return this.data[b+"-"+c]};d.prototype.set=function(b,c,d){if(b>c){var e=c;c=b;b=e}e=b+"-"+c;this.get(b,c)||this.data.keys.push(e);this.data[e]=d};d.prototype.reset=function(){for(var b=this.data,c=b.keys;0<c.length;){var d=c.pop();delete b[d]}}},{}],53:[function(b,c,e){function d(){}c.exports=d;d.defaults=function(b,c){b=b||{};for(var d in c)d in b||(b[d]=c[d]);return b}},
{}],54:[function(b,c,e){function d(){f.call(this);this.type=g}c.exports=d;var g=b("../math/Vec3"),f=b("./Pool");d.prototype=new f;d.prototype.constructObject=function(){return new g}},{"../math/Vec3":30,"./Pool":51}],55:[function(b,c,e){function d(b){this.contactPointPool=[];this.frictionEquationPool=[];this.result=[];this.frictionResult=[];this.v3pool=new l;this.world=b;this.currentContactMaterial=null;this.enableFrictionReduction=!1}c.exports=d;c=b("../collision/AABB");e=b("../shapes/Shape");var g=
b("../collision/Ray"),f=b("../math/Vec3"),h=b("../math/Transform");b("../shapes/ConvexPolyhedron");var k=b("../math/Quaternion");b("../solver/Solver");var l=b("../utils/Vec3Pool"),n=b("../equations/ContactEquation"),q=b("../equations/FrictionEquation");d.prototype.createContactEquation=function(b,c,d,e,f,g){var h;this.contactPointPool.length?(h=this.contactPointPool.pop(),h.bi=b,h.bj=c):h=new n(b,c);h.enabled=b.collisionResponse&&c.collisionResponse&&d.collisionResponse&&e.collisionResponse;var p=
this.currentContactMaterial;h.restitution=p.restitution;h.setSpookParams(p.contactEquationStiffness,p.contactEquationRelaxation,this.world.dt);b=d.material||b.material;c=e.material||c.material;b&&c&&0<=b.restitution&&0<=c.restitution&&(h.restitution=b.restitution*c.restitution);h.si=f||d;h.sj=g||e;return h};d.prototype.createFrictionEquationsFromContact=function(b,c){var d=b.bi,e=b.bj,f=this.world,g=this.currentContactMaterial,h=g.friction,p=b.si.material||d.material,k=b.sj.material||e.material;p&&
k&&0<=p.friction&&0<=k.friction&&(h=p.friction*k.friction);if(0<h){h*=f.gravity.length();p=d.invMass+e.invMass;0<p&&(p=1/p);var m=this.frictionEquationPool,k=m.length?m.pop():new q(d,e,h*p),m=m.length?m.pop():new q(d,e,h*p);k.bi=m.bi=d;k.bj=m.bj=e;k.minForce=m.minForce=-h*p;k.maxForce=m.maxForce=h*p;k.ri.copy(b.ri);k.rj.copy(b.rj);m.ri.copy(b.ri);m.rj.copy(b.rj);b.ni.tangents(k.t,m.t);k.setSpookParams(g.frictionEquationStiffness,g.frictionEquationRelaxation,f.dt);m.setSpookParams(g.frictionEquationStiffness,
g.frictionEquationRelaxation,f.dt);k.enabled=m.enabled=b.enabled;c.push(k,m);return!0}return!1};var m=new f,p=new f,r=new f;d.prototype.createFrictionFromAverage=function(b){var c=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(c,this.frictionResult)&&1!==b){var d=this.frictionResult[this.frictionResult.length-2],e=this.frictionResult[this.frictionResult.length-1];m.setZero();p.setZero();r.setZero();for(var f=c.bi,g=0;g!==b;g++)c=this.result[this.result.length-1-g],c.bodyA!==
f?(m.vadd(c.ni,m),p.vadd(c.ri,p),r.vadd(c.rj,r)):(m.vsub(c.ni,m),p.vadd(c.rj,p),r.vadd(c.ri,r));b=1/b;p.scale(b,d.ri);r.scale(b,d.rj);e.ri.copy(d.ri);e.rj.copy(d.rj);m.normalize();m.tangents(d.t,e.t)}};var t=new f,w=new f,v=new k,u=new k;d.prototype.getContacts=function(b,c,d,e,f,g,h){this.contactPointPool=f;this.frictionEquationPool=h;this.result=e;this.frictionResult=g;e=0;for(f=b.length;e!==f;e++){g=b[e];h=c[e];var p=null;g.material&&h.material&&(p=d.getContactMaterial(g.material,h.material)||
null);for(var k=0;k<g.shapes.length;k++){g.quaternion.mult(g.shapeOrientations[k],v);g.quaternion.vmult(g.shapeOffsets[k],t);t.vadd(g.position,t);for(var m=g.shapes[k],l=0;l<h.shapes.length;l++){h.quaternion.mult(h.shapeOrientations[l],u);h.quaternion.vmult(h.shapeOffsets[l],w);w.vadd(h.position,w);var n=h.shapes[l];if(!(t.distanceTo(w)>m.boundingSphereRadius+n.boundingSphereRadius)){var r=null;m.material&&n.material&&(r=d.getContactMaterial(m.material,n.material)||null);this.currentContactMaterial=
r||p||d.defaultContactMaterial;(r=this[m.type|n.type])&&(m.type<n.type?r.call(this,m,n,t,w,v,u,g,h,m,n):r.call(this,n,m,w,t,u,v,h,g,m,n))}}}}};d.prototype[e.types.BOX|e.types.BOX]=d.prototype.boxBox=function(b,c,d,e,f,g,h,k){b.convexPolyhedronRepresentation.material=b.material;c.convexPolyhedronRepresentation.material=c.material;b.convexPolyhedronRepresentation.collisionResponse=b.collisionResponse;c.convexPolyhedronRepresentation.collisionResponse=c.collisionResponse;this.convexConvex(b.convexPolyhedronRepresentation,
c.convexPolyhedronRepresentation,d,e,f,g,h,k,b,c)};d.prototype[e.types.BOX|e.types.CONVEXPOLYHEDRON]=d.prototype.boxConvex=function(b,c,d,e,f,g,h,k){b.convexPolyhedronRepresentation.material=b.material;b.convexPolyhedronRepresentation.collisionResponse=b.collisionResponse;this.convexConvex(b.convexPolyhedronRepresentation,c,d,e,f,g,h,k,b,c)};d.prototype[e.types.BOX|e.types.PARTICLE]=d.prototype.boxParticle=function(b,c,d,e,f,g,h,k){b.convexPolyhedronRepresentation.material=b.material;b.convexPolyhedronRepresentation.collisionResponse=
b.collisionResponse;this.convexParticle(b.convexPolyhedronRepresentation,c,d,e,f,g,h,k,b,c)};d.prototype[e.types.SPHERE]=d.prototype.sphereSphere=function(b,c,d,e,f,g,h,k){f=this.createContactEquation(h,k,b,c);e.vsub(d,f.ni);f.ni.normalize();f.ri.copy(f.ni);f.rj.copy(f.ni);f.ri.mult(b.radius,f.ri);f.rj.mult(-c.radius,f.rj);f.ri.vadd(d,f.ri);f.ri.vsub(h.position,f.ri);f.rj.vadd(e,f.rj);f.rj.vsub(k.position,f.rj);this.result.push(f);this.createFrictionEquationsFromContact(f,this.frictionResult)};var z=
new f,x=new f,A=new f;d.prototype[e.types.PLANE|e.types.TRIMESH]=d.prototype.planeTrimesh=function(b,c,d,e,g,k,p,m){var l=new f;z.set(0,0,1);g.vmult(z,z);for(g=0;g<c.vertices.length/3;g++){c.getVertex(g,l);var n=new f;n.copy(l);h.pointToWorldFrame(e,k,n,l);n=x;l.vsub(d,n);if(0>=z.dot(n)){var r=this.createContactEquation(p,m,b,c);r.ni.copy(z);var q=A;z.scale(n.dot(z),q);l.vsub(q,q);r.ri.copy(q);r.ri.vsub(p.position,r.ri);r.rj.copy(l);r.rj.vsub(m.position,r.rj);this.result.push(r);this.createFrictionEquationsFromContact(r,
this.frictionResult)}}};var y=new f,B=new f;new f;var C=new f,F=new f,H=new f,K=new f,M=new f,O=new f,I=new f,D=new f,J=new f,N=new f,S=new f,Q=new c,R=[];d.prototype[e.types.SPHERE|e.types.TRIMESH]=d.prototype.sphereTrimesh=function(b,c,d,e,f,k,p,m){h.pointToLocalFrame(e,k,d,I);f=b.radius;Q.lowerBound.set(I.x-f,I.y-f,I.z-f);Q.upperBound.set(I.x+f,I.y+f,I.z+f);c.getTrianglesInAABB(Q,R);var l=b.radius*b.radius;for(f=0;f<R.length;f++)for(var n=0;3>n;n++)if(c.getVertex(c.indices[3*R[f]+n],C),C.vsub(I,
B),B.norm2()<=l){F.copy(C);h.pointToWorldFrame(e,k,F,C);C.vsub(d,B);var r=this.createContactEquation(p,m,b,c);r.ni.copy(B);r.ni.normalize();r.ri.copy(r.ni);r.ri.scale(b.radius,r.ri);r.ri.vadd(d,r.ri);r.ri.vsub(p.position,r.ri);r.rj.copy(C);r.rj.vsub(m.position,r.rj);this.result.push(r);this.createFrictionEquationsFromContact(r,this.frictionResult)}for(f=0;f<R.length;f++)for(n=0;3>n;n++)c.getVertex(c.indices[3*R[f]+n],H),c.getVertex(c.indices[3*R[f]+(n+1)%3],K),K.vsub(H,M),I.vsub(K,D),d=D.dot(M),I.vsub(H,
D),r=D.dot(M),0<r&&0>d&&(I.vsub(H,D),O.copy(M),O.normalize(),r=D.dot(O),O.scale(r,D),D.vadd(H,D),d=D.distanceTo(I),d<b.radius&&(r=this.createContactEquation(p,m,b,c),D.vsub(I,r.ni),r.ni.normalize(),r.ni.scale(b.radius,r.ri),h.pointToWorldFrame(e,k,D,D),D.vsub(m.position,r.rj),h.vectorToWorldFrame(k,r.ni,r.ni),h.vectorToWorldFrame(k,r.ri,r.ri),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)));f=0;for(n=R.length;f!==n;f++)c.getTriangleVertices(R[f],J,N,S),c.getNormal(R[f],
y),I.vsub(J,D),d=D.dot(y),y.scale(d,D),I.vsub(D,D),d=D.distanceTo(I),g.pointInTriangle(D,J,N,S)&&d<b.radius&&(r=this.createContactEquation(p,m,b,c),D.vsub(I,r.ni),r.ni.normalize(),r.ni.scale(b.radius,r.ri),h.pointToWorldFrame(e,k,D,D),D.vsub(m.position,r.rj),h.vectorToWorldFrame(k,r.ni,r.ni),h.vectorToWorldFrame(k,r.ri,r.ri),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult));R.length=0};var G=new f,P=new f;d.prototype[e.types.SPHERE|e.types.PLANE]=d.prototype.spherePlane=
function(b,c,d,e,f,g,h,k){c=this.createContactEquation(h,k,b,c);c.ni.set(0,0,1);g.vmult(c.ni,c.ni);c.ni.negate(c.ni);c.ni.normalize();c.ni.mult(b.radius,c.ri);d.vsub(e,G);c.ni.mult(c.ni.dot(G),P);G.vsub(P,c.rj);-G.dot(c.ni)<=b.radius&&(b=c.ri,g=c.rj,b.vadd(d,b),b.vsub(h.position,b),g.vadd(e,g),g.vsub(k.position,g),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult))};var T=new f,V=new f,Y=new f,W=new f,ba=new f,L=new f,U=new f,Z=[new f,new f,new f,new f,new f,new f],
ca=new f,ea=new f,da=new f,ua=new f;d.prototype[e.types.SPHERE|e.types.BOX]=d.prototype.sphereBox=function(b,c,d,e,f,g,h,k){f=this.v3pool;d.vsub(e,W);c.getSideNormals(Z,g);g=b.radius;for(var p=!1,m=null,l=0,n=0,r=0,q=null,t=0,u=Z.length;t!==u&&!1===p;t++){var v=ba;v.copy(Z[t]);var w=v.norm();v.normalize();var x=W.dot(v);if(x<w+g&&0<x){var A=L,y=U;A.copy(Z[(t+1)%3]);y.copy(Z[(t+2)%3]);var z=A.norm(),B=y.norm();A.normalize();y.normalize();var N=W.dot(A),D=W.dot(y);N<z&&N>-z&&D<B&&D>-B&&(x=Math.abs(x-
w-g),null===q||x<q)&&(q=x,n=N,r=D,m=w,ea.copy(v),da.copy(A),ua.copy(y),l++)}}l&&(p=!0,l=this.createContactEquation(h,k,b,c),ea.mult(-g,l.ri),l.ni.copy(ea),l.ni.negate(l.ni),ea.mult(m,ea),da.mult(n,da),ea.vadd(da,ea),ua.mult(r,ua),ea.vadd(ua,l.rj),l.ri.vadd(d,l.ri),l.ri.vsub(h.position,l.ri),l.rj.vadd(e,l.rj),l.rj.vsub(k.position,l.rj),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult));x=f.get();for(m=0;2!==m&&!p;m++)for(n=0;2!==n&&!p;n++)for(r=0;2!==r&&!p;r++)x.set(0,
0,0),m?x.vadd(Z[0],x):x.vsub(Z[0],x),n?x.vadd(Z[1],x):x.vsub(Z[1],x),r?x.vadd(Z[2],x):x.vsub(Z[2],x),e.vadd(x,ca),ca.vsub(d,ca),ca.norm2()<g*g&&(p=!0,l=this.createContactEquation(h,k,b,c),l.ri.copy(ca),l.ri.normalize(),l.ni.copy(l.ri),l.ri.mult(g,l.ri),l.rj.copy(x),l.ri.vadd(d,l.ri),l.ri.vsub(h.position,l.ri),l.rj.vadd(e,l.rj),l.rj.vsub(k.position,l.rj),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult));f.release(x);q=f.get();t=f.get();l=f.get();u=f.get();x=f.get();
v=Z.length;for(m=0;m!==v&&!p;m++)for(n=0;n!==v&&!p;n++)if(m%3!==n%3){Z[n].cross(Z[m],q);q.normalize();Z[m].vadd(Z[n],t);l.copy(d);l.vsub(t,l);l.vsub(e,l);w=l.dot(q);q.mult(w,u);for(r=0;r===m%3||r===n%3;)r++;x.copy(d);x.vsub(u,x);x.vsub(t,x);x.vsub(e,x);w=Math.abs(w);A=x.norm();w<Z[r].norm()&&A<g&&(p=!0,r=this.createContactEquation(h,k,b,c),t.vadd(u,r.rj),r.rj.copy(r.rj),x.negate(r.ni),r.ni.normalize(),r.ri.copy(r.rj),r.ri.vadd(e,r.ri),r.ri.vsub(d,r.ri),r.ri.normalize(),r.ri.mult(g,r.ri),r.ri.vadd(d,
r.ri),r.ri.vsub(h.position,r.ri),r.rj.vadd(e,r.rj),r.rj.vsub(k.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult))}f.release(q,t,l,u,x)};var Da=new f,ya=new f,Ea=new f,na=new f,za=new f,Ba=new f,va=new f,Aa=new f,ga=new f,aa=new f;d.prototype[e.types.SPHERE|e.types.CONVEXPOLYHEDRON]=d.prototype.sphereConvex=function(b,c,d,e,f,g,h,k){f=this.v3pool;d.vsub(e,Da);for(var p=c.faceNormals,m=c.faces,l=c.vertices,n=b.radius,r=0;r!==l.length;r++){var q=za;g.vmult(l[r],
q);e.vadd(q,q);var t=na;q.vsub(d,t);if(t.norm2()<n*n){b=this.createContactEquation(h,k,b,c);b.ri.copy(t);b.ri.normalize();b.ni.copy(b.ri);b.ri.mult(n,b.ri);q.vsub(e,b.rj);b.ri.vadd(d,b.ri);b.ri.vsub(h.position,b.ri);b.rj.vadd(e,b.rj);b.rj.vsub(k.position,b.rj);this.result.push(b);this.createFrictionEquationsFromContact(b,this.frictionResult);return}}r=0;for(q=m.length;r!==q;r++){var t=m[r],u=Ba;g.vmult(p[r],u);var v=va;g.vmult(l[t[0]],v);v.vadd(e,v);var x=Aa;u.mult(-n,x);d.vadd(x,x);var w=ga;x.vsub(v,
w);x=w.dot(u);w=aa;d.vsub(v,w);if(0>x&&0<w.dot(u)){for(var v=[],w=0,A=t.length;w!==A;w++){var y=f.get();g.vmult(l[t[w]],y);e.vadd(y,y);v.push(y)}a:{for(var w=v,A=u,y=d,z=null,B=w.length,N=0;N!==B;N++){var D=w[N],F=T;w[(N+1)%B].vsub(D,F);var C=V;F.cross(A,C);F=Y;y.vsub(D,F);D=C.dot(F);if(null===z||0<D&&!0===z||0>=D&&!1===z)null===z&&(z=0<D);else{w=!1;break a}}w=!0}if(w){b=this.createContactEquation(h,k,b,c);u.mult(-n,b.ri);u.negate(b.ni);c=f.get();u.mult(-x,c);g=f.get();u.mult(-n,g);d.vsub(e,b.rj);
b.rj.vadd(g,b.rj);b.rj.vadd(c,b.rj);b.rj.vadd(e,b.rj);b.rj.vsub(k.position,b.rj);b.ri.vadd(d,b.ri);b.ri.vsub(h.position,b.ri);f.release(c);f.release(g);this.result.push(b);this.createFrictionEquationsFromContact(b,this.frictionResult);w=0;for(t=v.length;w!==t;w++)f.release(v[w]);break}else for(w=0;w!==t.length;w++){u=f.get();x=f.get();g.vmult(l[t[(w+1)%t.length]],u);g.vmult(l[t[(w+2)%t.length]],x);e.vadd(u,u);e.vadd(x,x);B=ya;x.vsub(u,B);z=Ea;B.unit(z);A=f.get();y=f.get();d.vsub(u,y);N=y.dot(z);z.mult(N,
A);A.vadd(u,A);z=f.get();A.vsub(d,z);if(0<N&&N*N<B.norm2()&&z.norm2()<n*n){b=this.createContactEquation(h,k,b,c);A.vsub(e,b.rj);A.vsub(d,b.ni);b.ni.normalize();b.ni.mult(n,b.ri);b.rj.vadd(e,b.rj);b.rj.vsub(k.position,b.rj);b.ri.vadd(d,b.ri);b.ri.vsub(h.position,b.ri);this.result.push(b);this.createFrictionEquationsFromContact(b,this.frictionResult);w=0;for(t=v.length;w!==t;w++)f.release(v[w]);f.release(u);f.release(x);f.release(A);f.release(z);f.release(y);return}f.release(u);f.release(x);f.release(A);
f.release(z);f.release(y)}w=0;for(t=v.length;w!==t;w++)f.release(v[w])}}};new f;new f;d.prototype[e.types.PLANE|e.types.BOX]=d.prototype.planeBox=function(b,c,d,e,f,g,h,k){c.convexPolyhedronRepresentation.material=c.material;c.convexPolyhedronRepresentation.collisionResponse=c.collisionResponse;this.planeConvex(b,c.convexPolyhedronRepresentation,d,e,f,g,h,k)};var ia=new f,E=new f,fa=new f,la=new f;d.prototype[e.types.PLANE|e.types.CONVEXPOLYHEDRON]=d.prototype.planeConvex=function(b,c,d,e,f,g,h,k){E.set(0,
0,1);f.vmult(E,E);for(var p=f=0;p!==c.vertices.length;p++)if(ia.copy(c.vertices[p]),g.vmult(ia,ia),e.vadd(ia,ia),ia.vsub(d,fa),0>=E.dot(fa)){var m=this.createContactEquation(h,k,b,c),l=la;E.mult(E.dot(fa),l);ia.vsub(l,l);l.vsub(d,m.ri);m.ni.copy(E);ia.vsub(e,m.rj);m.ri.vadd(d,m.ri);m.ri.vsub(h.position,m.ri);m.rj.vadd(e,m.rj);m.rj.vsub(k.position,m.rj);this.result.push(m);f++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(m,this.frictionResult)}this.enableFrictionReduction&&
f&&this.createFrictionFromAverage(f)};var X=new f,ha=new f;d.prototype[e.types.CONVEXPOLYHEDRON]=d.prototype.convexConvex=function(b,c,d,e,f,g,h,k,p,m,l,n){if(!(d.distanceTo(e)>b.boundingSphereRadius+c.boundingSphereRadius)&&b.findSeparatingAxis(c,d,f,e,g,X,l,n)){l=[];b.clipAgainstHull(d,f,c,e,g,X,-100,100,l);for(g=f=0;g!==l.length;g++){n=this.createContactEquation(h,k,b,c,p,m);var r=n.ri,q=n.rj;X.negate(n.ni);l[g].normal.negate(ha);ha.mult(l[g].depth,ha);l[g].point.vadd(ha,r);q.copy(l[g].point);
r.vsub(d,r);q.vsub(e,q);r.vadd(d,r);r.vsub(h.position,r);q.vadd(e,q);q.vsub(k.position,q);this.result.push(n);f++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(n,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)}};var ka=new f,pa=new f,qa=new f;d.prototype[e.types.PLANE|e.types.PARTICLE]=d.prototype.planeParticle=function(b,c,d,e,f,g,h,k){ka.set(0,0,1);h.quaternion.vmult(ka,ka);e.vsub(h.position,pa);0>=ka.dot(pa)&&(b=this.createContactEquation(k,
h,c,b),b.ni.copy(ka),b.ni.negate(b.ni),b.ri.set(0,0,0),ka.mult(ka.dot(e),qa),e.vsub(qa,qa),b.rj.copy(qa),this.result.push(b),this.createFrictionEquationsFromContact(b,this.frictionResult))};var oa=new f;d.prototype[e.types.PARTICLE|e.types.SPHERE]=d.prototype.sphereParticle=function(b,c,d,e,f,g,h,k){oa.set(0,0,1);e.vsub(d,oa);oa.norm2()<=b.radius*b.radius&&(c=this.createContactEquation(k,h,c,b),oa.normalize(),c.rj.copy(oa),c.rj.mult(b.radius,c.rj),c.ni.copy(oa),c.ni.negate(c.ni),c.ri.set(0,0,0),this.result.push(c),
this.createFrictionEquationsFromContact(c,this.frictionResult))};var Fa=new k,wa=new f;new f;var Ca=new f,ra=new f,ma=new f;d.prototype[e.types.PARTICLE|e.types.CONVEXPOLYHEDRON]=d.prototype.convexParticle=function(b,c,d,e,f,g,h,k){var p=-1;g=null;var m=0;wa.copy(e);wa.vsub(d,wa);f.conjugate(Fa);Fa.vmult(wa,wa);if(b.pointIsInside(wa)){b.worldVerticesNeedsUpdate&&b.computeWorldVertices(d,f);b.worldFaceNormalsNeedsUpdate&&b.computeWorldFaceNormals(f);f=0;for(var l=b.faces.length;f!==l;f++){var n=b.worldFaceNormals[f];
e.vsub(b.worldVertices[b.faces[f][0]],ra);var r=-n.dot(ra);if(null===g||Math.abs(r)<Math.abs(g))g=r,p=f,Ca.copy(n),m++}-1!==p?(b=this.createContactEquation(k,h,c,b),Ca.mult(g,ma),ma.vadd(e,ma),ma.vsub(d,ma),b.rj.copy(ma),Ca.negate(b.ni),b.ri.set(0,0,0),c=b.ri,g=b.rj,c.vadd(e,c),c.vsub(k.position,c),g.vadd(d,g),g.vsub(h.position,g),this.result.push(b),this.createFrictionEquationsFromContact(b,this.frictionResult)):console.warn("Point found inside convex, but did not find penetrating face!")}};d.prototype[e.types.BOX|
e.types.HEIGHTFIELD]=d.prototype.boxHeightfield=function(b,c,d,e,f,g,h,k){b.convexPolyhedronRepresentation.material=b.material;b.convexPolyhedronRepresentation.collisionResponse=b.collisionResponse;this.convexHeightfield(b.convexPolyhedronRepresentation,c,d,e,f,g,h,k)};var ja=new f,sa=new f,Ga=[0];d.prototype[e.types.CONVEXPOLYHEDRON|e.types.HEIGHTFIELD]=d.prototype.convexHeightfield=function(b,c,d,e,f,g,k,p){var m=c.data,l=c.elementSize,n=b.boundingSphereRadius;h.pointToLocalFrame(e,g,d,ja);var r=
Math.floor((ja.x-n)/l)-1,q=Math.ceil((ja.x+n)/l)+1,t=Math.floor((ja.y-n)/l)-1,l=Math.ceil((ja.y+n)/l)+1;if(!(0>q||0>l||r>m.length||t>m[0].length)){0>r&&(r=0);0>q&&(q=0);0>t&&(t=0);0>l&&(l=0);r>=m.length&&(r=m.length-1);q>=m.length&&(q=m.length-1);l>=m[0].length&&(l=m[0].length-1);t>=m[0].length&&(t=m[0].length-1);m=[];c.getRectMinMax(r,t,q,l,m);var u=m[0];if(!(ja.z-n>m[1]||ja.z+n<u))for(n=r;n<q;n++)for(r=t;r<l;r++)c.getConvexTrianglePillar(n,r,!1),h.pointToWorldFrame(e,g,c.pillarOffset,sa),d.distanceTo(sa)<
c.pillarConvex.boundingSphereRadius+b.boundingSphereRadius&&this.convexConvex(b,c.pillarConvex,d,sa,f,g,k,p,null,null,Ga,null),c.getConvexTrianglePillar(n,r,!0),h.pointToWorldFrame(e,g,c.pillarOffset,sa),d.distanceTo(sa)<c.pillarConvex.boundingSphereRadius+b.boundingSphereRadius&&this.convexConvex(b,c.pillarConvex,d,sa,f,g,k,p,null,null,Ga,null)}};var ta=new f,xa=new f;d.prototype[e.types.SPHERE|e.types.HEIGHTFIELD]=d.prototype.sphereHeightfield=function(b,c,d,e,f,g,k,p){var m=c.data,l=b.radius,n=
c.elementSize;h.pointToLocalFrame(e,g,d,ta);var r=Math.floor((ta.x-l)/n)-1,q=Math.ceil((ta.x+l)/n)+1,t=Math.floor((ta.y-l)/n)-1,n=Math.ceil((ta.y+l)/n)+1;if(!(0>q||0>n||r>m.length||n>m[0].length)){0>r&&(r=0);0>q&&(q=0);0>t&&(t=0);0>n&&(n=0);r>=m.length&&(r=m.length-1);q>=m.length&&(q=m.length-1);n>=m[0].length&&(n=m[0].length-1);t>=m[0].length&&(t=m[0].length-1);m=[];c.getRectMinMax(r,t,q,n,m);var u=m[0];if(!(ta.z-l>m[1]||ta.z+l<u))for(l=this.result;r<q;r++)for(m=t;m<n;m++)if(u=l.length,c.getConvexTrianglePillar(r,
m,!1),h.pointToWorldFrame(e,g,c.pillarOffset,xa),d.distanceTo(xa)<c.pillarConvex.boundingSphereRadius+b.boundingSphereRadius&&this.sphereConvex(b,c.pillarConvex,d,xa,f,g,k,p),c.getConvexTrianglePillar(r,m,!0),h.pointToWorldFrame(e,g,c.pillarOffset,xa),d.distanceTo(xa)<c.pillarConvex.boundingSphereRadius+b.boundingSphereRadius&&this.sphereConvex(b,c.pillarConvex,d,xa,f,g,k,p),2<l.length-u)return}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,
"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(b,c,e){function d(){k.apply(this);this.dt=-1;this.allowSleep=!1;this.contacts=[];this.frictionEquations=[];this.quatNormalizeSkip=0;this.quatNormalizeFast=!1;this.stepnumber=this.time=0;this.default_dt=1/60;this.nextId=0;this.gravity=new g;this.broadphase=new w;this.bodies=[];this.solver=new f;this.constraints=[];this.narrowphase=
new h(this);this.collisionMatrix=new l;this.collisionMatrixPrevious=new l;this.materials=[];this.contactmaterials=[];this.contactMaterialTable=new p;this.defaultMaterial=new n("default");this.defaultContactMaterial=new q(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0});this.doProfiling=!1;this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0};this.subsystems=[];this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",
body:null}}c.exports=d;b("../shapes/Shape");var g=b("../math/Vec3");c=b("../math/Quaternion");var f=b("../solver/GSSolver");b("../utils/Vec3Pool");b("../equations/ContactEquation");b("../equations/FrictionEquation");var h=b("./Narrowphase"),k=b("../utils/EventTarget"),l=b("../collision/ArrayCollisionMatrix"),n=b("../material/Material"),q=b("../material/ContactMaterial"),m=b("../objects/Body"),p=b("../utils/TupleDictionary"),r=b("../collision/RaycastResult");e=b("../collision/AABB");var t=b("../collision/Ray"),
w=b("../collision/NaiveBroadphase");d.prototype=new k;new e;var v=new t;d.prototype.getContactMaterial=function(b,c){return this.contactMaterialTable.get(b.id,c.id)};d.prototype.numObjects=function(){return this.bodies.length};d.prototype.collisionMatrixTick=function(){var b=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix;this.collisionMatrix=b;this.collisionMatrix.reset()};d.prototype.add=d.prototype.addBody=function(b){-1===this.bodies.indexOf(b)&&(b.index=this.bodies.length,
this.bodies.push(b),b.world=this,b.initPosition.copy(b.position),b.initVelocity.copy(b.velocity),b.timeLastSleepy=this.time,b instanceof m&&(b.initAngularVelocity.copy(b.angularVelocity),b.initQuaternion.copy(b.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=b,this.dispatchEvent(this.addBodyEvent))};d.prototype.addConstraint=function(b){this.constraints.push(b)};d.prototype.removeConstraint=function(b){b=this.constraints.indexOf(b);-1!==b&&this.constraints.splice(b,
1)};d.prototype.rayTest=function(b,c,d){d instanceof r?this.raycastClosest(b,c,{skipBackfaces:!0},d):this.raycastAll(b,c,{skipBackfaces:!0},d)};d.prototype.raycastAll=function(b,c,d,e){d.mode=t.ALL;d.from=b;d.to=c;d.callback=e;return v.intersectWorld(this,d)};d.prototype.raycastAny=function(b,c,d,e){d.mode=t.ANY;d.from=b;d.to=c;d.result=e;return v.intersectWorld(this,d)};d.prototype.raycastClosest=function(b,c,d,e){d.mode=t.CLOSEST;d.from=b;d.to=c;d.result=e;return v.intersectWorld(this,d)};d.prototype.remove=
function(b){b.world=null;var c=this.bodies.length-1,d=this.bodies,e=d.indexOf(b);if(-1!==e){d.splice(e,1);for(e=0;e!==d.length;e++)d[e].index=e;this.collisionMatrix.setNumObjects(c);this.removeBodyEvent.body=b;this.dispatchEvent(this.removeBodyEvent)}};d.prototype.removeBody=d.prototype.remove;d.prototype.addMaterial=function(b){this.materials.push(b)};d.prototype.addContactMaterial=function(b){this.contactmaterials.push(b);this.contactMaterialTable.set(b.materials[0].id,b.materials[1].id,b)};"undefined"===
typeof performance&&(performance={});if(!performance.now){var u=Date.now();performance.timing&&performance.timing.navigationStart&&(u=performance.timing.navigationStart);performance.now=function(){return Date.now()-u}}var z=new g;d.prototype.step=function(b,c,d){d=d||10;c=c||0;if(0===c)this.internalStep(b),this.time+=b;else{var e=Math.floor((this.time+c)/b)-Math.floor(this.time/b),e=Math.min(e,d);d=performance.now();for(var f=0;f!==e&&!(this.internalStep(b),performance.now()-d>1E3*b);f++);this.time+=
c;b=this.time%b/b;c=this.bodies;for(e=0;e!==c.length;e++)d=c[e],d.type!==m.STATIC&&d.sleepState!==m.SLEEPING?(d.position.vsub(d.previousPosition,z),z.scale(b,z),d.position.vadd(z,d.interpolatedPosition)):(d.interpolatedPosition.copy(d.position),d.interpolatedQuaternion.copy(d.quaternion))}};var x={type:"postStep"},A={type:"preStep"},y={type:"collide",body:null,contact:null},B=[],C=[],F=[],H=[];new g;new g;new g;new g;new g;new g;new g;new g;new g;new c;var K=new c,M=new c,O=new g;d.prototype.internalStep=
function(b){this.dt=b;var c=this.contacts,d=this.numObjects(),e=this.bodies,f=this.solver,g=this.gravity,h=this.doProfiling,k=this.profile,p=m.DYNAMIC,l,n=this.constraints;g.norm();var r=g.x,q=g.y,t=g.z;h&&(l=performance.now());for(g=0;g!==d;g++){var u=e[g];if(u.type&p){var v=u.force,u=u.mass;v.x+=u*r;v.y+=u*q;v.z+=u*t}}g=0;for(u=this.subsystems.length;g!==u;g++)this.subsystems[g].update();h&&(l=performance.now());F.length=0;H.length=0;this.broadphase.collisionPairs(this,F,H);h&&(k.broadphase=performance.now()-
l);u=n.length;for(g=0;g!==u;g++)if(r=n[g],!r.collideConnected)for(q=F.length-1;0<=q;--q)if(r.bodyA===F[q]&&r.bodyB===H[q]||r.bodyB===F[q]&&r.bodyA===H[q])F.splice(q,1),H.splice(q,1);this.collisionMatrixTick();h&&(l=performance.now());u=c.length;for(g=0;g!==u;g++)B.push(c[g]);c.length=0;u=this.frictionEquations.length;for(g=0;g!==u;g++)C.push(this.frictionEquations[g]);this.frictionEquations.length=0;this.narrowphase.getContacts(F,H,this,c,B,this.frictionEquations,C);h&&(k.narrowphase=performance.now()-
l);h&&(l=performance.now());for(g=0;g<this.frictionEquations.length;g++)f.addEquation(this.frictionEquations[g]);g=c.length;for(q=0;q!==g;q++)r=c[q],u=r.bi,t=r.bj,u.material&&t.material&&this.getContactMaterial(u.material,t.material),u.material&&t.material&&0<=u.material.restitution&&0<=t.material.restitution&&(r.restitution=u.material.restitution*t.material.restitution),f.addEquation(r),u.allowSleep&&u.type===m.DYNAMIC&&u.sleepState===m.SLEEPING&&t.sleepState===m.AWAKE&&t.type!==m.STATIC&&t.velocity.norm2()+
t.angularVelocity.norm2()>=2*Math.pow(t.sleepSpeedLimit,2)&&(u._wakeUpAfterNarrowphase=!0),t.allowSleep&&t.type===m.DYNAMIC&&t.sleepState===m.SLEEPING&&u.sleepState===m.AWAKE&&u.type!==m.STATIC&&u.velocity.norm2()+u.angularVelocity.norm2()>=2*Math.pow(u.sleepSpeedLimit,2)&&(t._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(u,t,!0),this.collisionMatrixPrevious.get(u,t)||(y.body=t,y.contact=r,u.dispatchEvent(y),y.body=u,t.dispatchEvent(y));h&&(k.makeContactConstraints=performance.now()-l,l=performance.now());
for(g=0;g!==d;g++)u=e[g],u._wakeUpAfterNarrowphase&&(u.wakeUp(),u._wakeUpAfterNarrowphase=!1);u=n.length;for(g=0;g!==u;g++)for(r=n[g],r.update(),q=0,c=r.equations.length;q!==c;q++)f.addEquation(r.equations[q]);f.solve(b,this);h&&(k.solve=performance.now()-l);f.removeAllEquations();f=Math.pow;for(g=0;g!==d;g++)if(u=e[g],u.type&p&&(n=f(1-u.linearDamping,b),c=u.velocity,c.mult(n,c),n=u.angularVelocity))c=f(1-u.angularDamping,b),n.mult(c,n);this.dispatchEvent(A);for(g=0;g!==d;g++)u=e[g],u.preStep&&u.preStep.call(u);
h&&(l=performance.now());p=m.DYNAMIC|m.KINEMATIC;f=0===this.stepnumber%(this.quatNormalizeSkip+1);n=this.quatNormalizeFast;c=.5*b;for(g=0;g!==d;g++)if(u=e[g],r=u.force,q=u.torque,u.type&p&&u.sleepState!==m.SLEEPING){var t=u.velocity,v=u.angularVelocity,w=u.position,z=u.quaternion,I=u.invMass,da=u.invInertiaWorld;t.x+=r.x*I*b;t.y+=r.y*I*b;t.z+=r.z*I*b;u.angularVelocity&&(da.vmult(q,O),O.mult(b,O),O.vadd(v,v));w.x+=t.x*b;w.y+=t.y*b;w.z+=t.z*b;u.angularVelocity&&(K.set(v.x,v.y,v.z,0),K.mult(z,M),z.x+=
c*M.x,z.y+=c*M.y,z.z+=c*M.z,z.w+=c*M.w,f&&(n?z.normalizeFast():z.normalize()));u.aabb&&(u.aabbNeedsUpdate=!0);u.updateInertiaWorld&&u.updateInertiaWorld()}this.clearForces();this.broadphase.dirty=!0;h&&(k.integrate=performance.now()-l);this.time+=b;this.stepnumber+=1;this.dispatchEvent(x);for(g=0;g!==d;g++)u=e[g],(b=u.postStep)&&b.call(u);if(this.allowSleep)for(g=0;g!==d;g++)e[g].sleepTick(this.time)};d.prototype.clearForces=function(){for(var b=this.bodies,c=b.length,d=0;d!==c;d++){var e=b[d];e.force.set(0,
0,0);e.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},
{},[2])(2)});CANNON=CANNON||{};var camera,scene,renderer,controls=null,s_oRender;
CANNON.Demo=function(a){function b(){if(x){for(var a in x.__controllers)x.__controllers[a].updateDisplay();for(var b in x.__folders)for(a in x.__folders[b].__controllers)x.__folders[b].__controllers[a].updateDisplay()}}function c(a){function b(a,c){a.material&&(a.material=c);for(var d=0;d<a.children.length;d++)b(a.children[d],c)}if(-1===P.indexOf(a))throw Error("Render mode "+a+" not found!");switch(a){case "solid":p.currentMaterial=F;T.intensity=1;V.color.setHex(2236962);break;case "wireframe":p.currentMaterial=
H,T.intensity=0,V.color.setHex(16777215)}for(var c=0;c<u.length;c++)b(u[c],p.currentMaterial);t.rendermode=a}function e(){for(var a=v.length,b=0;b<a;b++){var c=v[b];c.position.copy(c.initPosition);c.velocity.copy(c.initVelocity);c.initAngularVelocity&&(c.angularVelocity.copy(c.initAngularVelocity),c.quaternion.copy(c.initQuaternion))}}function d(a){0===a.x&&(a.x=1E-6);0===a.y&&(a.y=1E-6);0===a.z&&(a.z=1E-6)}function g(){for(var a=v.length,b=0;b<a;b++){var c=v[b],e=u[b];e.position.copy(c.position);
c.quaternion&&e.quaternion.copy(c.quaternion)}M.restart();if(t.contacts)for(b=0;b<G.contacts.length;b++)for(a=0;2>a;a++){var e=M.request(),f=G.contacts[b],c=0===a?f.bi:f.bj,g=0===a?f.ri:f.rj;e.position.set(c.position.x+g.x,c.position.y+g.y,c.position.z+g.z)}M.hideCached();O.restart();if(t.cm2contact)for(b=0;b<G.contacts.length;b++)for(a=0;2>a;a++)e=O.request(),f=G.contacts[b],c=0===a?f.bi:f.bj,g=0===a?f.ri:f.rj,e.scale.set(g.x,g.y,g.z),d(e.scale),e.position.copy(c.position);O.hideCached();N.restart();
S.restart();if(t.constraints){for(b=0;b<G.constraints.length;b++)f=G.constraints[b],f instanceof CANNON.DistanceConstraint&&(c=f.equations.normal,a=c.bi,c=c.bj,e=N.request(),c=c.position?c.position:c,e.scale.set(c.x-a.position.x,c.y-a.position.y,c.z-a.position.z),d(e.scale),e.position.copy(a.position));for(b=0;b<G.constraints.length;b++)if(f=G.constraints[b],f instanceof CANNON.PointToPointConstraint){var g=f.equations.normal,a=g.bi,c=g.bj,e=S.request(),f=S.request(),h=S.request();e.scale.set(g.ri.x,
g.ri.y,g.ri.z);f.scale.set(g.rj.x,g.rj.y,g.rj.z);h.scale.set(-g.penetrationVec.x,-g.penetrationVec.y,-g.penetrationVec.z);d(e.scale);d(f.scale);d(h.scale);e.position.copy(a.position);f.position.copy(c.position);g.bj.position.vadd(g.rj,h.position)}}S.hideCached();N.hideCached();Q.restart();if(t.normals)for(b=0;b<G.contacts.length;b++)f=G.contacts[b],a=f.bi,e=Q.request(),g=f.ni,c=a,e.scale.set(g.x,g.y,g.z),d(e.scale),e.position.copy(c.position),f.ri.vadd(e.position,e.position);Q.hideCached();R.restart();
if(t.axes)for(a=0;a<v.length;a++)c=v[a],e=R.request(),e.position.copy(c.position),c.quaternion&&e.quaternion.copy(c.quaternion);R.hideCached();J.restart();if(t.aabbs)for(b=0;b<v.length;b++)c=v[b],c.computeAABB&&(c.aabbNeedsUpdate&&c.computeAABB(),isFinite(c.aabb.lowerBound.x)&&isFinite(c.aabb.lowerBound.y)&&isFinite(c.aabb.lowerBound.z)&&isFinite(c.aabb.upperBound.x)&&isFinite(c.aabb.upperBound.y)&&isFinite(c.aabb.upperBound.z)&&0!=c.aabb.lowerBound.x-c.aabb.upperBound.x&&0!=c.aabb.lowerBound.y-c.aabb.upperBound.y&&
0!=c.aabb.lowerBound.z-c.aabb.upperBound.z&&(e=J.request(),e.scale.set(c.aabb.lowerBound.x-c.aabb.upperBound.x,c.aabb.lowerBound.y-c.aabb.upperBound.y,c.aabb.lowerBound.z-c.aabb.upperBound.z),e.position.set(.5*(c.aabb.lowerBound.x+c.aabb.upperBound.x),.5*(c.aabb.lowerBound.y+c.aabb.upperBound.y),.5*(c.aabb.lowerBound.z+c.aabb.upperBound.z))));J.hideCached()}function f(){requestAnimationFrame(f);t.paused||g();l();Y.update()}function h(a){mouseX=a.clientX-Z;mouseY=a.clientY-ca}function k(a){ba=s_iCanvasResizeWidth+
2*s_iCanvasOffsetWidth;L=s_iCanvasResizeHeight+2*s_iCanvasOffsetHeight;CAMERA_TEST_TRACKBALL&&(controls.screen.width=ba,controls.screen.height=L)}function l(){(CAMERA_TEST_TRACKBALL||CAMERA_TEST_TRANSFORM&&null!==controls)&&controls.update();renderer.clear();renderer.render(p.scene,camera)}function n(a){p.dispatchEvent({type:"destroy"});t.paused=!1;b();q(a)}function q(a){for(var c=u.length,d=0;d<c;d++){G.remove(v.pop());var e=u.pop();p.scene.remove(e)}for(;G.constraints.length;)G.removeConstraint(G.constraints[0]);
z[a]();t.iterations=G.solver.iterations;t.gx=G.gravity.x+0;t.gy=G.gravity.y+0;t.gz=G.gravity.z+0;t.quatNormalizeSkip=G.quatNormalizeSkip;t.quatNormalizeFast=G.quatNormalizeFast;b();M.restart();M.hideCached();O.restart();O.hideCached();N.restart();N.hideCached();Q.restart();Q.hideCached()}function m(a){var b=[],c=[];this.request=function(){geo=b.length?b.pop():a();scene.add(geo);c.push(geo);return geo};this.restart=function(){for(;c.length;)b.push(c.pop())};this.hideCached=function(){for(var a=0;a<
b.length;a++)scene.remove(b[a])}}var p=this;this.addScene=function(a,b){if("string"!==typeof a)throw Error("1st argument of Demo.addScene(title,initfunc) must be a string!");if("function"!==typeof b)throw Error("2nd argument of Demo.addScene(title,initfunc) must be a function!");z.push(b);var c=z.length-1;B[a]=function(){n(c)};r.add(B,a)};this.restartCurrentScene=e;this.changeScene=n;this.start=function(){q(0)};var r,t=this.settings={stepFrequency:60,quatNormalizeSkip:2,quatNormalizeFast:!0,gx:0,
gy:0,gz:0,iterations:3,tolerance:1E-4,k:1E6,d:3,scene:0,paused:!1,rendermode:"solid",constraints:!1,contacts:!1,cm2contact:!1,normals:!1,axes:!1,particleSize:.1,shadows:!1,aabbs:!1,profiling:!1,maxSubSteps:3};a=a||{};for(var w in a)w in t&&(t[w]=a[w]);if(0!==t.stepFrequency%60)throw Error("stepFrequency must be a multiple of 60.");var v=this.bodies=[],u=this.visuals=[],z=[],x=null,A=null,y=null,B={},C=new THREE.SphereGeometry(.1,6,6);this.particleGeo=new THREE.SphereGeometry(1,16,8);var F=new THREE.MeshPhongMaterial({color:11184810,
specular:1118481,shininess:50}),H=new THREE.MeshLambertMaterial({color:16777215,wireframe:!0});this.currentMaterial=F;var K=new THREE.MeshPhongMaterial({color:16711680});this.particleMaterial=new THREE.MeshLambertMaterial({color:16711680});var M=new m(function(){return new THREE.Mesh(C,K)}),O=new m(function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:16711680}))}),I=new THREE.BoxGeometry(1,
1,1),D=new THREE.MeshBasicMaterial({color:11184810,wireframe:!0}),J=new m(function(){return new THREE.Mesh(I,D)}),N=new m(function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:16711680}))}),S=new m(function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:16711680}))}),
Q=new m(function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:65280}))}),R=new m(function(){var a=new THREE.Object3D,b=new THREE.Vector3(0,0,0),c=new THREE.Geometry,d=new THREE.Geometry,e=new THREE.Geometry;c.vertices.push(b);d.vertices.push(b);e.vertices.push(b);c.vertices.push(new THREE.Vector3(1,0,0));d.vertices.push(new THREE.Vector3(0,1,0));e.vertices.push(new THREE.Vector3(0,
0,1));b=new THREE.Line(c,new THREE.LineBasicMaterial({color:16711680}));d=new THREE.Line(d,new THREE.LineBasicMaterial({color:65280}));e=new THREE.Line(e,new THREE.LineBasicMaterial({color:255}));a.add(b);a.add(d);a.add(e);return a}),G=this.world=new CANNON.World;G.broadphase=new CANNON.NaiveBroadphase;var P=["solid","wireframe"],T,V,Y,W;Detector.webgl||Detector.addGetWebGLMessage();var ba=s_iCanvasResizeWidth+s_iCanvasOffsetWidth,L=s_iCanvasResizeHeight+s_iCanvasOffsetHeight,U,Z=ba/2,ca=L/2;(function(){U=
document.createElement("div");document.body.appendChild(U);CAMERA_TEST_TRACKBALL?(NEAR=5,camera=new THREE.PerspectiveCamera(45,ba/L,NEAR,FAR),camera.lookAt(new THREE.Vector3(CAMERA_TEST_LOOK_AT.x,CAMERA_TEST_LOOK_AT.y,CAMERA_TEST_LOOK_AT.z)),camera.position.set(0,500,500),camera.up.set(0,0,1)):camera=createOrthoGraphicCamera();scene=p.scene=new THREE.Scene;scene.fog=new THREE.Fog(8306926,.5*FAR,FAR);V=new THREE.AmbientLight(4473924);scene.add(V);T=new THREE.DirectionalLight(16777164,1);T.position.set(180,
0,180);T.target.position.set(0,0,0);T.castShadow=!0;T.shadow.camera.near=10;T.shadow.camera.far=100;T.shadow.camera.fov=30;T.shadowMapBias=.0139;T.shadowMapDarkness=.1;T.shadow.mapSize.width=1024;T.shadow.mapSize.height=1024;scene.add(T);scene.add(camera);renderer=SHOW_3D_RENDER?new THREE.WebGLRenderer({clearColor:0,clearAlpha:.5,antialias:!0,alpha:!0}):new THREE.CanvasRenderer({clearColor:0,clearAlpha:.5,antialias:!1,alpha:!0});renderer.setSize(ba,L);renderer.domElement.style.position="relative";
renderer.domElement.style.top="0px";renderer.domElement.style.opacity=OPACITY_INTENSITY_3D;U.appendChild(renderer.domElement);W=document.createElement("div");W.style.position="absolute";W.style.top="10px";W.style.width="100%";W.style.textAlign="center";W.innerHTML='<a href="http://github.com/schteppe/cannon.js">cannon.js</a> - javascript 3d physics';U.appendChild(W);document.addEventListener("mousemove",h);window.addEventListener("resize",k);renderer.setClearColor(scene.fog.color,1);renderer.autoClear=
!1;y=document.createElement("canvas");y.width=ba;y.height=L;y.style.opacity=.5;y.style.position="absolute";y.style.top="0px";y.style.zIndex=90;U.appendChild(y);A=new SmoothieChart({labelOffsetY:50,maxDataSetLength:100,millisPerPixel:2,grid:{strokeStyle:"none",fillStyle:"none",lineWidth:1,millisPerLine:250,verticalSections:6},labels:{fillStyle:"rgb(180, 180, 180)"}});A.streamTo(y);var a={},b=[[255,0,0],[0,255,0],[0,0,255],[255,255,0],[255,0,255],[0,255,255]],d=0,e;for(e in G.profile){var f=b[d%b.length];
a[e]=new TimeSeries({label:e,fillStyle:"rgb("+f[0]+","+f[1]+","+f[2]+")",maxDataLength:500});d++}G.addEventListener("postStep",function(b){for(var c in G.profile)a[c].append(1E3*G.time,G.profile[c])});d=0;for(e in G.profile)f=b[d%b.length],A.addTimeSeries(a[e],{strokeStyle:"rgb("+f[0]+","+f[1]+","+f[2]+")",lineWidth:2}),d++;G.doProfiling=!1;A.stop();y.style.display="none";Y=new Stats;Y.domElement.style.position="absolute";Y.domElement.style.top="0px";Y.domElement.style.zIndex=100;U.appendChild(Y.domElement);
void 0!=window.dat&&(x=new dat.GUI,x.domElement.parentNode.style.zIndex=120,b=x.addFolder("Rendering"),b.add(t,"rendermode",{Solid:"solid",Wireframe:"wireframe"}).onChange(function(a){c(a)}),b.add(t,"contacts"),b.add(t,"cm2contact"),b.add(t,"normals"),b.add(t,"constraints"),b.add(t,"axes"),b.add(t,"particleSize").min(0).max(1).onChange(function(a){for(var b=0;b<u.length;b++)v[b]instanceof CANNON.Particle&&u[b].scale.set(a,a,a)}),b.add(t,"shadows").onChange(function(a){a?renderer.shadowMapAutoUpdate=
!0:(renderer.shadowMapAutoUpdate=!1,renderer.clearTarget(T.shadowMap))}),b.add(t,"aabbs"),b.add(t,"profiling").onChange(function(a){a?(G.doProfiling=!0,A.start(),y.style.display="block"):(G.doProfiling=!1,A.stop(),y.style.display="none")}),b=x.addFolder("World"),b.add(t,"paused").onChange(function(a){}),b.add(t,"stepFrequency",60,600).step(60),b.add(t,"gx",-100,100).onChange(function(a){isNaN(a)||G.gravity.set(a,t.gy,t.gz)}),b.add(t,"gy",-100,100).onChange(function(a){isNaN(a)||G.gravity.set(t.gx,
a,t.gz)}),b.add(t,"gz",-100,100).onChange(function(a){isNaN(a)||G.gravity.set(t.gx,t.gy,a)}),b.add(t,"quatNormalizeSkip",0,50).step(1).onChange(function(a){isNaN(a)||(G.quatNormalizeSkip=a)}),b.add(t,"quatNormalizeFast").onChange(function(a){G.quatNormalizeFast=!!a}),b=x.addFolder("Solver"),b.add(t,"iterations",1,50).step(1).onChange(function(a){G.solver.iterations=a}),b.add(t,"k",10,1E7).onChange(function(a){p.setGlobalSpookParams(t.k,t.d,1/t.stepFrequency)}),b.add(t,"d",0,20).step(.1).onChange(function(a){p.setGlobalSpookParams(t.k,
t.d,1/t.stepFrequency)}),b.add(t,"tolerance",0,10).step(.01).onChange(function(a){G.solver.tolerance=a}),r=x.addFolder("Scenes"),r.open());CAMERA_TEST_TRACKBALL&&(controls=new THREE.TrackballControls(camera,renderer.domElement),controls.rotateSpeed=1,controls.zoomSpeed=1.2,controls.panSpeed=.2,controls.noZoom=!1,controls.noPan=!1,controls.staticMoving=!1,controls.dynamicDampingFactor=.3,controls.minDistance=0,controls.maxDistance=1E5,controls.keys=[65,83,68],controls.screen.width=ba,controls.screen.height=
L)})();f();s_oRender=l;document.addEventListener("keypress",function(a){if(a.keyCode)switch(a.keyCode){case 32:e();break;case 104:"none"==Y.domElement.style.display?(Y.domElement.style.display="block",W.style.display="block"):(Y.domElement.style.display="none",W.style.display="none");break;case 97:t.aabbs=!t.aabbs;b();break;case 99:t.constraints=!t.constraints;b();break;case 112:t.paused=!t.paused;b();break;case 115:G.step(1/t.stepFrequency);g();break;case 109:a=P.indexOf(t.rendermode);a++;a%=P.length;
c(P[a]);b();break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:z.length>a.keyCode-49&&!document.activeElement.localName.match(/input/)&&n(a.keyCode-49)}})};CANNON.Demo.prototype=new CANNON.EventTarget;CANNON.Demo.constructor=CANNON.Demo;
CANNON.Demo.prototype.setGlobalSpookParams=function(a,b,c){for(var e=this.world,d=0;d<e.constraints.length;d++)for(var g=e.constraints[d],f=0;f<g.equations.length;f++)g.equations[f].setSpookParams(a,b,c);for(d=0;d<e.contactmaterials.length;d++)c=e.contactmaterials[d],c.contactEquationStiffness=a,c.frictionEquationStiffness=a,c.contactEquationRelaxation=b,c.frictionEquationRelaxation=b;e.defaultContactMaterial.contactEquationStiffness=a;e.defaultContactMaterial.frictionEquationStiffness=a;e.defaultContactMaterial.contactEquationRelaxation=
b;e.defaultContactMaterial.frictionEquationRelaxation=b};
CANNON.Demo.prototype.createTransformControl=function(a,b){controls=new THREE.TransformControls(camera,renderer.domElement);scene.add(a);controls.attach(a,b);scene.add(controls);console.log("CREATE");window.addEventListener("keydown",function(a){switch(a.keyCode){case 81:controls.setSpace("local"===controls.space?"world":"local");break;case 17:controls.setTranslationSnap(100);controls.setRotationSnap(THREE.Math.degToRad(15));break;case 87:controls.setMode("translate");break;case 69:controls.setMode("rotate");
break;case 82:controls.setMode("scale");break;case 187:case 107:controls.setSize(controls.size+.1);break;case 189:case 109:controls.setSize(Math.max(controls.size-.1,.1))}});window.addEventListener("keyup",function(a){switch(a.keyCode){case 17:controls.setTranslationSnap(null),controls.setRotationSnap(null)}})};CANNON.Demo.prototype.getWorld=function(){return this.world};
CANNON.Demo.prototype.addVisual=function(a,b){var c;a instanceof CANNON.Body&&(c=this.shape2mesh(a,b));c&&(this.bodies.push(a),this.visuals.push(c),a.visualref=c,a.visualref.visualId=this.bodies.length-1,this.scene.add(c));return c};CANNON.Demo.prototype.addVisuals=function(a){for(var b=0;b<a.length;b++)this.addVisual(a[b])};
CANNON.Demo.prototype.removeVisual=function(a){if(a.visualref){for(var b=this.bodies,c=this.visuals,e=[],d=[],g=b.length,f=0;f<g;f++)e.unshift(b.pop()),d.unshift(c.pop());for(var g=a.visualref.visualId,h=0;h<e.length;h++)h!==g&&(f=h>g?h-1:h,b[f]=e[h],c[f]=d[h],b[f].visualref=e[h].visualref,b[f].visualref.visualId=f);a.visualref.visualId=null;this.scene.remove(a.visualref);a.visualref=null}};CANNON.Demo.prototype.removeAllVisuals=function(){for(;this.bodies.length;)this.removeVisual(this.bodies[0])};
CANNON.Demo.prototype.shape2mesh=function(a,b){for(var c=new THREE.Object3D,e=0;e<a.shapes.length;e++){var d=a.shapes[e];switch(d.type){case CANNON.Shape.types.SPHERE:var g=new THREE.SphereGeometry(d.radius,8,8),d=void 0===b?new THREE.Mesh(g,this.currentMaterial):new THREE.Mesh(g,b);d.castShadow=!0;break;case CANNON.Shape.types.PARTICLE:d=new THREE.Mesh(this.particleGeo,this.particleMaterial);g=this.settings;d.scale.set(g.particleSize,g.particleSize,g.particleSize);break;case CANNON.Shape.types.PLANE:var f=
new THREE.PlaneGeometry(10,10,4,4),d=new THREE.Object3D,g=new THREE.Object3D,f=void 0===b?new THREE.Mesh(f,this.currentMaterial):new THREE.Mesh(f,b);f.scale.set(100,100,100);g.add(f);f.castShadow=!1;f.receiveShadow=!0;d.add(g);break;case CANNON.Shape.types.BOX:g=new THREE.BoxGeometry(2*d.halfExtents.x,2*d.halfExtents.y,2*d.halfExtents.z);d=void 0===b?new THREE.Mesh(g,this.currentMaterial):new THREE.Mesh(g,b);break;case CANNON.Shape.types.CONVEXPOLYHEDRON:f=new THREE.Geometry;for(g=0;g<d.vertices.length;g++){var h=
d.vertices[g];f.vertices.push(new THREE.Vector3(h.x,h.y,h.z))}for(g=0;g<d.faces.length;g++)for(var k=d.faces[g],l=k[0],h=1;h<k.length-1;h++)f.faces.push(new THREE.Face3(l,k[h],k[h+1]));f.computeBoundingSphere();f.computeFaceNormals();d=void 0===b?new THREE.Mesh(f,this.currentMaterial):new THREE.Mesh(f,b);break;case CANNON.Shape.types.HEIGHTFIELD:for(var f=new THREE.Geometry,k=new CANNON.Vec3,l=new CANNON.Vec3,n=new CANNON.Vec3,h=0;h<d.data.length-1;h++)for(var q=0;q<d.data[h].length-1;q++)for(var m=
0;2>m;m++)d.getConvexTrianglePillar(h,q,0===m),k.copy(d.pillarConvex.vertices[0]),l.copy(d.pillarConvex.vertices[1]),n.copy(d.pillarConvex.vertices[2]),k.vadd(d.pillarOffset,k),l.vadd(d.pillarOffset,l),n.vadd(d.pillarOffset,n),f.vertices.push(new THREE.Vector3(k.x,k.y,k.z),new THREE.Vector3(l.x,l.y,l.z),new THREE.Vector3(n.x,n.y,n.z)),g=f.vertices.length-3,f.faces.push(new THREE.Face3(g,g+1,g+2));f.computeBoundingSphere();f.computeFaceNormals();d=void 0===b?new THREE.Mesh(f,this.currentMaterial):
new THREE.Mesh(f,b);break;case CANNON.Shape.types.TRIMESH:f=new THREE.Geometry;k=new CANNON.Vec3;l=new CANNON.Vec3;n=new CANNON.Vec3;for(g=0;g<d.indices.length/3;g++)d.getTriangleVertices(g,k,l,n),f.vertices.push(new THREE.Vector3(k.x,k.y,k.z),new THREE.Vector3(l.x,l.y,l.z),new THREE.Vector3(n.x,n.y,n.z)),h=f.vertices.length-3,f.faces.push(new THREE.Face3(h,h+1,h+2));f.computeBoundingSphere();f.computeFaceNormals();d=void 0===b?new THREE.Mesh(f,this.currentMaterial):new THREE.Mesh(f,b);break;default:throw"Visual type not recognized: "+
d.type;}d.receiveShadow=!0;d.castShadow=!0;if(d.children)for(g=0;g<d.children.length;g++)if(d.children[g].castShadow=!0,d.children[g].receiveShadow=!0,d.children[g])for(h=0;h<d.children[g].length;h++)d.children[g].children[h].castShadow=!0,d.children[g].children[h].receiveShadow=!0;g=a.shapeOffsets[e];f=a.shapeOrientations[e];d.position.set(g.x,g.y,g.z);d.quaternion.set(f.x,f.y,f.z,f.w);c.add(d)}this.camera=function(){return camera};this.getScene=function(){return scene};return c};
function CBall(a,b,c,e,d){var g,f,h,k,l,n,q=null,m=!1;this._init=function(a,b,c){n=new createjs.Container;h.addChild(n);g=createBitmap(c);g.x=a;g.y=b;g.regX=.5*c.width;g.regY=.5*c.height;c=s_oSpriteLibrary.getSprite("ball_ref");f=createBitmap(c);f.x=a;f.y=b;f.regX=.5*c.width;f.regY=.5*-c.height+15;f.alpha=.75;c=s_oSpriteLibrary.getSprite("ball_shadow");l=createBitmap(c);l.x=a;l.y=b;l.regX=.5*c.width;l.regY=.5*c.height;n.addChild(l,g,f)};this.unload=function(){g.removeAllEventListeners();h.removeChild(g)};
this.setVisible=function(a){n.visible=a};this.startPosShadowY=function(a){q=a};this.getStartShadowYPos=function(){return q};this.tweenFade=function(a,b,c){createjs.Tween.get(n).wait(c).to({alpha:a},b).call(function(){})};this.playSound=function(){m||(playSound("ball_crash",1,0),m=!0)};this.setPlayedSound=function(a){m=a};this.animFade=function(a){createjs.Tween.get(n).to({alpha:a},250,createjs.Ease.circleOut).call(function(){0===a&&(n.visible=!1,n.alpha=1,s_oGame.resetBallPosition())})};this.setPositionShadow=
function(a,b){l.x=a;l.y=b};this.setPosition=function(a,b){f.x=g.x=a;f.y=g.y=b};this.getPhysics=function(){return k};this.setAngle=function(a){f.rotation=g.rotation=a};this.getX=function(){return g.x};this.getY=function(){return g.y};this.getStartScale=function(){return 36};this.scale=function(a){f.scaleX=g.scaleX=a;f.scaleY=g.scaleY=a};this.scaleShadow=function(a){.08<a?(l.scaleX=a,l.scaleY=a):(l.scaleX=.08,l.scaleY=.08)};this.setAlphaByHeight=function(a){l.alpha=a};this.getScale=function(){return g.scaleX};
this.getObject=function(){return n};this.getDepthPos=function(){return k.position.y};k=e;h=d;this._init(a,b,c);return this}
function CScenario(){var a,b,c,e,d,g,f,h,k,l,n,q,m,p,r,t,w,v,u,z;if(SHOW_3D_RENDER)var x=new CANNON.Demo;this.getDemo=function(){return x};this._init=function(){u=[];z=[];a=SHOW_3D_RENDER?x.getWorld():new CANNON.World;var f=new CANNON.GSSolver;f.iterations=10;f.tolerance=1E-4;a.allowSleep=!0;a.gravity.set(0,0,-(19.52*STEP_RATE));a.broadphase=new CANNON.NaiveBroadphase;a.solver=new CANNON.SplitSolver(f,20,1E-4);b=new CANNON.Material;c=new CANNON.Material;e=new CANNON.Material;d=new CANNON.Material;
var f=new CANNON.ContactMaterial(c,e,{friction:.1,restitution:.1}),g=new CANNON.ContactMaterial(c,b,{friction:.01,restitution:.1}),h=new CANNON.ContactMaterial(c,d,{friction:.1,restitution:.3}),k=new CANNON.ContactMaterial(b,d,{friction:.2,restitution:.3}),p=new CANNON.ContactMaterial(d,d,{friction:.01,restitution:.1}),m=new CANNON.ContactMaterial(d,e,{friction:.01,restitution:.1});a.addContactMaterial(f);a.addContactMaterial(g);a.addContactMaterial(h);a.addContactMaterial(k);a.addContactMaterial(p);
a.addContactMaterial(m);s_oScenario._createBallBody();for(f=0;f<PINS_POSITION.length;f++)u[f]=s_oScenario.createPin(PINS_POSITION[f],f,!1);s_oScenario.importFBXTrack();s_oScenario.createWallPins();s_oScenario.createFloorPins();s_oScenario.createPinsBinder();s_oScenario.createWallFloorPins();s_oScenario.createSideWallTrack();s_oScenario.createSensorPinFloor();SHOW_DEPTH_TRACK_MODEL&&s_oScenario.createDepthTrack();PIN_TEST&&u.push(s_oScenario.createPin(PINS_PROPERTIES_TEST,-1,!0));z.push(s_oScenario.createAFloorSidePins({x:FLOOR_PINS_POSITION.x+
(FLOOR_PINS_SIZE.width+FLOOR_PINS_SIDE_PROPERTIES.width-2.7),y:FLOOR_PINS_POSITION.y,z:FLOOR_PINS_POSITION.z+FLOOR_PINS_SIZE.height-9},FLOOR_PINS_SIDE_PROPERTIES.rot));z.push(s_oScenario.createAFloorSidePins({x:FLOOR_PINS_POSITION.x+(-FLOOR_PINS_SIZE.width-FLOOR_PINS_SIDE_PROPERTIES.width+2.7),y:FLOOR_PINS_POSITION.y,z:FLOOR_PINS_POSITION.z+FLOOR_PINS_SIZE.height-9},-FLOOR_PINS_SIDE_PROPERTIES.rot))};this.importFBXTrack=function(){var a=new THREE.LoadingManager;a.onProgress=function(a,b,c){console.log(a,
b,c)};(new THREE.FBXLoader(a)).load("models/stage.txt",function(a){s_oScenario.parseFile(a);s_oGame.ballPosition();s_oGame.startPinsPosition()},function(a){a.lengthComputable&&console.log(Math.round(a.loaded/a.total*100,2)+"% downloaded")},function(a){})};this.parseFile=function(a){for(var b=0;b<a.children.length;b++){var c=a.children[b];console.log("oMesh.name: "+c.name);"floor"===c.name?(k=s_oScenario._createFieldBody(c,FLOOR),k.addEventListener("collide",function(a){s_oScenario.floorCollision(a)})):
"channel_left"===c.name?(l=s_oScenario._createFieldBody(c,CHANNEL),l.addEventListener("collide",function(a){s_oScenario.channelCollision(a)})):"channel_right"===c.name&&(n=s_oScenario._createFieldBody(c,CHANNEL),n.addEventListener("collide",function(a){s_oScenario.channelCollision(a)}))}};this.createSensorPinFloor=function(){var b=new CANNON.Box(new CANNON.Vec3(SENSOR_SIZE.width,SENSOR_SIZE.depth,SENSOR_SIZE.height));v=new CANNON.Body({mass:0,material:e,userData:{type:WALL}});v.addShape(b);v.addEventListener("collide",
function(a){s_oScenario.sensorCollision(a)});v.position.set(SENSOR_POSITION.x,SENSOR_POSITION.y,SENSOR_POSITION.z);a.addBody(v);SHOW_3D_RENDER&&(b=new THREE.MeshPhongMaterial({color:5570645,specular:1118481,shininess:50}),x.addVisual(v,b))};this.createAFloorSidePins=function(c,d){var e,f=new CANNON.Box(new CANNON.Vec3(FLOOR_PINS_SIDE_PROPERTIES.width,FLOOR_PINS_SIDE_PROPERTIES.depth,FLOOR_PINS_SIDE_PROPERTIES.height));e=new CANNON.Body({mass:0,material:b,userData:{type:PINS_FLOOR},collisionFilterGroup:PINS_FLOOR,
collisionFilterMask:PINS});e.addShape(f);e.quaternion.y=d;e.position.set(c.x,c.y,c.z);e.addEventListener("collide",function(a){s_oScenario.sideWallCollision(a)});a.addBody(e);SHOW_3D_RENDER&&SHOW_PROXY_COLLISION&&(f=new THREE.MeshPhongMaterial({color:34816,specular:1118481,shininess:50}),x.addVisual(e,f));return e};this.createDepthTrack=function(){var b=new CANNON.Box(new CANNON.Vec3(WALL_TRACK_DEPTH_SIZE.width,WALL_TRACK_DEPTH_SIZE.depth,WALL_TRACK_DEPTH_SIZE.height));r=new CANNON.Body({mass:0,material:e});
r.collisionResponse=0;r.addShape(b);r.position.set(WALL_TRACK_DEPTH_POSITION.x,WALL_TRACK_DEPTH_POSITION.y,WALL_TRACK_DEPTH_POSITION.z);a.addBody(r);SHOW_3D_RENDER&&(b=new THREE.MeshPhongMaterial({color:8947712,specular:1118481,shininess:50}),x.addVisual(r,b))};this.createFloorPins=function(){var c=new CANNON.Box(new CANNON.Vec3(FLOOR_PINS_SIZE.width,FLOOR_PINS_SIZE.depth,FLOOR_PINS_SIZE.height));q=new CANNON.Body({mass:0,material:b,userData:{type:PINS_FLOOR},collisionFilterGroup:PINS_FLOOR,collisionFilterMask:PINS});
q.addShape(c);q.position.set(FLOOR_PINS_POSITION.x,FLOOR_PINS_POSITION.y,FLOOR_PINS_POSITION.z);a.addBody(q);SHOW_3D_RENDER&&SHOW_PROXY_COLLISION&&(c=new THREE.MeshPhongMaterial({color:136,specular:1118481,shininess:50}),x.addVisual(q,c))};this.createWallFloorPins=function(){var c=new CANNON.Box(new CANNON.Vec3(FLOOR_WALL_PINS_SIZE.width,FLOOR_WALL_PINS_SIZE.depth,FLOOR_WALL_PINS_SIZE.height));m=new CANNON.Body({mass:0,material:b,userData:{type:PINS_FLOOR},collisionFilterGroup:PINS_FLOOR,collisionFilterMask:PINS});
m.addShape(c);m.position.set(FLOOR_WALL_PINS_POSITION.x,FLOOR_WALL_PINS_POSITION.y,FLOOR_WALL_PINS_POSITION.z);a.addBody(m);SHOW_3D_RENDER&&SHOW_PROXY_COLLISION&&(c=new THREE.MeshPhongMaterial({color:8912896,specular:16776960,shininess:10}),x.addVisual(m,c))};this.createPinsBinder=function(){var b=new CANNON.Box(new CANNON.Vec3(PINS_BINDER_PROPERTIES.width,PINS_BINDER_PROPERTIES.depth,PINS_BINDER_PROPERTIES.height));t=new CANNON.Body({mass:0,material:e,userData:{type:PINS_FLOOR},collisionFilterGroup:PINS_FLOOR,
collisionFilterMask:PINS,fixedRotation:!0,allowSleep:!1,sleepTimeLimit:1});t.addShape(b);t.position.set(PINS_BINDER_POSITION.x,PINS_BINDER_POSITION.y,PINS_BINDER_POSITION.z);a.addBody(t);t.collisionResponse=0;SHOW_3D_RENDER&&(b=new THREE.MeshPhongMaterial({color:5592405,specular:1118481,shininess:50}),x.addVisual(t,b))};this._createFieldBody=function(c,d){var e=this.__extractMeshData(c),f=new CANNON.Body({mass:0,material:b,userData:{type:d}});f.addShape(e);e=new CANNON.Vec3(c.position.x+OFFSET_TRACK_POSITION.x,
c.position.y+OFFSET_TRACK_POSITION.y,c.position.z+OFFSET_TRACK_POSITION.z);f.position.copy(e);a.addBody(f);SHOW_3D_RENDER&&(e=new THREE.MeshPhongMaterial({color:14596231,specular:0,shininess:100}),x.addVisual(f,e));return f};this.__extractMeshData=function(a){var b=a.geometry.faces;a=a.geometry.vertices;for(var c=0;c<b.length;c++);for(var d=[],e=[],c=0;c<a.length;c++)d.push(1*a[c].x),d.push(1*a[c].y),d.push(1*a[c].z);for(c=0;c<b.length;c++)e.push(b[c].a),e.push(b[c].b),e.push(b[c].c);return new CANNON.Trimesh(d,
e)};this.createPin=function(b,c,e){var f=new CANNON.Cylinder(PIN_PROPERTY.radius_top,PIN_PROPERTY.radius_bottom,PIN_PROPERTY.height,PIN_PROPERTY.segments);c=new CANNON.Body({mass:PIN_PROPERTY.mass,material:d,linearDamping:PIN_PROPERTY.linearDamping,angularDamping:PIN_PROPERTY.angularDamping,userData:{type:PINS,id:c},collisionFilterGroup:PINS,collisionFilterMask:-1,allowSleep:!0,sleepTimeLimit:1});c.addShape(f);c.position.set(b.x,b.y,b.z);c.addEventListener("collide",function(a){s_oScenario.pinCollision(a)});
a.addBody(c);SHOW_3D_RENDER&&(b=new THREE.MeshPhongMaterial({color:16777215,specular:1118481,shininess:100}),b=x.addVisual(c,b),e&&CAMERA_TEST_TRANSFORM&&!CAMERA_TEST_TRACKBALL&&x.createTransformControl(b,c));return c};this.createWallPins=function(){var b=new CANNON.Box(new CANNON.Vec3(WALL_PINS_SIZE.width,WALL_PINS_SIZE.depth,WALL_PINS_SIZE.height)),c=new CANNON.Box(new CANNON.Vec3(SIDE_WALL_PINS_SIZE.width,SIDE_WALL_PINS_SIZE.depth,SIDE_WALL_PINS_SIZE.height)),d=new CANNON.Box(new CANNON.Vec3(WALL_PINS_DOWN_SIZE.width,
WALL_PINS_DOWN_SIZE.depth,WALL_PINS_DOWN_SIZE.height)),f=new CANNON.Box(new CANNON.Vec3(WALL_PINS_FORWARD_SIZE.width,WALL_PINS_FORWARD_SIZE.depth,WALL_PINS_FORWARD_SIZE.height));p=new CANNON.Body({mass:0,material:e,userData:{type:WALL}});p.addShape(b);p.addShape(c,new CANNON.Vec3(WALL_PINS_SIZE.width,SIDE_WALL_PINS_SIZE.depth,0));p.addShape(c,new CANNON.Vec3(-WALL_PINS_SIZE.width,SIDE_WALL_PINS_SIZE.depth,0));p.addShape(d,new CANNON.Vec3(0,SIDE_WALL_PINS_SIZE.depth,-SIDE_WALL_PINS_SIZE.height));p.addShape(f,
new CANNON.Vec3(0,2*WALL_PINS_DOWN_SIZE.depth,-WALL_PINS_SIZE.height+WALL_PINS_FORWARD_SIZE.height));p.addShape(d,new CANNON.Vec3(0,SIDE_WALL_PINS_SIZE.depth,.9*WALL_PINS_SIZE.height));p.addEventListener("collide",function(a){s_oScenario.wallCollision(a)});p.position.set(WALL_PINS_POSITION.x,WALL_PINS_POSITION.y,WALL_PINS_POSITION.z);a.addBody(p);SHOW_3D_RENDER&&(b=new THREE.MeshPhongMaterial({color:3355443,specular:1118481,shininess:50}),x.addVisual(p,b))};this.createSideWallTrack=function(){var b=
new CANNON.Box(new CANNON.Vec3(WALL_TRACK_SIZE.width,WALL_TRACK_SIZE.depth,WALL_TRACK_SIZE.height)),c=new CANNON.Box(new CANNON.Vec3(ROOF_TRACK_SIZE.width,ROOF_TRACK_SIZE.depth,ROOF_TRACK_SIZE.height));w=new CANNON.Body({mass:0,material:e,userData:{type:WALL_TRACK}});w.addShape(b,new CANNON.Vec3(WALL_TRACK_SIZE.offsetX,0,0));w.addShape(b,new CANNON.Vec3(-WALL_TRACK_SIZE.offsetX,0,0));w.addShape(c,new CANNON.Vec3(0,ROOF_TRACK_SIZE.offsetY,.85*WALL_TRACK_SIZE.height));w.position.set(WALL_TRACK_POSITION.x,
WALL_TRACK_POSITION.y,WALL_TRACK_POSITION.z);a.addBody(w);SHOW_3D_RENDER&&SHOW_PROXY_COLLISION&&(b=new THREE.MeshPhongMaterial({color:11184810,specular:16777215,shininess:15}),x.addVisual(w,b))};this._createBallBody=function(){g=new CANNON.Sphere(BALL_RADIUS);f=new CANNON.Body({mass:BALL_PROPERTY.mass,material:c,linearDamping:BALL_PROPERTY.linearDamping,allowSleep:!1,angularDamping:BALL_PROPERTY.angularDamping,userData:{type:BALL}});var b=new CANNON.Vec3(POSITION_BALL.x,POSITION_BALL.y,POSITION_BALL.z);
f.position.copy(b);f.addEventListener("collide",function(a){s_oScenario.ballCollision(a)});f.addShape(g);a.add(f);SHOW_3D_RENDER&&(b=new THREE.MeshPhongMaterial({color:11184810,specular:1118481,shininess:100}),h=x.addVisual(f,b))};this.addImpulse=function(a,b){var c=new CANNON.Vec3(0,0,BALL_RADIUS),d=new CANNON.Vec3(b.x,b.y,b.z);a.applyImpulse(d,c)};this.addForce=function(a,b){var c=new CANNON.Vec3(0,0,0),d=new CANNON.Vec3(b.x,b.y,b.z);a.applyForce(d,c)};this.getBodyVelocity=function(a){return a.velocity};
this.ballBody=function(){return f};this.ballMesh=function(){return h};this.ballCollision=function(a){(a.contact.bi.userData.type===BALL&&a.contact.bj.userData.type===PINS||a.contact.bj.userData.type===BALL&&a.contact.bi.userData.type===PINS)&&s_oGame.setPinCollide()};this.getCamera=function(){return x.camera()};this.floorCollision=function(a){(a.contact.bi.userData.type===BALL&&a.contact.bj.userData.type===FLOOR||a.contact.bj.userData.type===BALL&&a.contact.bi.userData.type===FLOOR)&&s_oGame.ballHitFloor()};
this.channelCollision=function(a){(a.contact.bi.userData.type===BALL&&a.contact.bj.userData.type===CHANNEL||a.contact.bj.userData.type===BALL&&a.contact.bi.userData.type===CHANNEL)&&s_oGame.gutterBall()};this.getPinsBinder=function(){return t};this.getPinByID=function(a){return u[a]};this.setElementAngularVelocity=function(a,b){a.angularVelocity.set(b.x,b.y,b.z)};this.setElementVelocity=function(a,b){var c=new CANNON.Vec3(b.x,b.y,b.z);a.velocity=c};this.setElementLinearDamping=function(a,b){a.linearDamping=
b};this.getTrackBody=function(){return k};this.getTrackBodyDepth=function(){return r};this.update=function(){a.step(PHYSICS_STEP)};this.resetPinsPosition=function(){for(var a=0;a<u.length;a++)u[a].position.set(PINS_POSITION[a].x,PINS_POSITION[a].y,PINS_POSITION[a].z),u[a].quaternion.setFromEuler(0,0,0,"XYZ"),u[a].angularVelocity.set(0,0,0),u[a].velocity.set(0,0,0)};this.getSideFloorPins=function(a){return z[a]};this.pinCollision=function(a){a.contact.bi.userData.type===PINS&&a.contact.bj.userData.type===
BALL?s_oGame.pinSoundCollision(a.contact.bi.userData.id):a.contact.bj.userData.type===PINS&&a.contact.bi.userData.type===BALL?s_oGame.pinSoundCollision(a.contact.bj.userData.id):a.contact.bj.userData.type===PINS&&a.contact.bi.userData.type===PINS&&s_oGame.twoPinsSoundCollision(a.contact.bj.userData.id,a.contact.bi.userData.id)};this.sideWallCollision=function(a){s_oGame.setPinDown(a.contact.bj.userData.id,!0,SIDE_PINS_FLOOR)};this.sensorCollision=function(a){a.contact.bj.sleep();a.contact.bj.userData.type===
PINS&&s_oGame.setPinDown(a.contact.bj.userData.id,!0,SIDE_PINS_FLOOR)};this.wallCollision=function(a){a.contact.bi.userData.type===BALL&&a.contact.bj.userData.type===WALL||a.contact.bj.userData.type===BALL&&a.contact.bi.userData.type===WALL?s_oGame.completeLaunch():a.contact.bj.userData.type===PINS&&a.contact.bi.userData.type===WALL&&s_oGame.setPinDown(a.contact.bj.userData.id,!0,WALL)};this.destroyWorld=function(){for(var b=a.bodies,c=0;c<b.length;c++)a.remove(b[c]);a=null};s_oScenario=this;SHOW_3D_RENDER?
(x.addScene("bowling",this._init),x.start()):this._init()}var s_oScenario;"use strict";var THREE={REVISION:"79"};"function"===typeof define&&define.amd?define("three",THREE):"undefined"!==typeof exports&&"undefined"!==typeof module&&(module.exports=THREE);void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}});
void 0===Object.assign&&function(){Object.assign=function(a){if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var e=arguments[c];if(void 0!==e&&null!==e)for(var d in e)Object.prototype.hasOwnProperty.call(e,d)&&(b[d]=e[d])}return b}}();
Object.assign(THREE,{MOUSE:{LEFT:0,MIDDLE:1,RIGHT:2},CullFaceNone:0,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,FrontFaceDirectionCW:0,FrontFaceDirectionCCW:1,BasicShadowMap:0,PCFShadowMap:1,PCFSoftShadowMap:2,FrontSide:0,BackSide:1,DoubleSide:2,FlatShading:1,SmoothShading:2,NoColors:0,FaceColors:1,VertexColors:2,NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5,AddEquation:100,SubtractEquation:101,ReverseSubtractEquation:102,MinEquation:103,
MaxEquation:104,ZeroFactor:200,OneFactor:201,SrcColorFactor:202,OneMinusSrcColorFactor:203,SrcAlphaFactor:204,OneMinusSrcAlphaFactor:205,DstAlphaFactor:206,OneMinusDstAlphaFactor:207,DstColorFactor:208,OneMinusDstColorFactor:209,SrcAlphaSaturateFactor:210,NeverDepth:0,AlwaysDepth:1,LessDepth:2,LessEqualDepth:3,EqualDepth:4,GreaterEqualDepth:5,GreaterDepth:6,NotEqualDepth:7,MultiplyOperation:0,MixOperation:1,AddOperation:2,NoToneMapping:0,LinearToneMapping:1,ReinhardToneMapping:2,Uncharted2ToneMapping:3,
CineonToneMapping:4,UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307,RepeatWrapping:1E3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002,NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008,UnsignedByteType:1009,
ByteType:1010,ShortType:1011,UnsignedShortType:1012,IntType:1013,UnsignedIntType:1014,FloatType:1015,HalfFloatType:1025,UnsignedShort4444Type:1016,UnsignedShort5551Type:1017,UnsignedShort565Type:1018,AlphaFormat:1019,RGBFormat:1020,RGBAFormat:1021,LuminanceFormat:1022,LuminanceAlphaFormat:1023,RGBEFormat:THREE.RGBAFormat,DepthFormat:1026,RGB_S3TC_DXT1_Format:2001,RGBA_S3TC_DXT1_Format:2002,RGBA_S3TC_DXT3_Format:2003,RGBA_S3TC_DXT5_Format:2004,RGB_PVRTC_4BPPV1_Format:2100,RGB_PVRTC_2BPPV1_Format:2101,
RGBA_PVRTC_4BPPV1_Format:2102,RGBA_PVRTC_2BPPV1_Format:2103,RGB_ETC1_Format:2151,LoopOnce:2200,LoopRepeat:2201,LoopPingPong:2202,InterpolateDiscrete:2300,InterpolateLinear:2301,InterpolateSmooth:2302,ZeroCurvatureEnding:2400,ZeroSlopeEnding:2401,WrapAroundEnding:2402,TrianglesDrawMode:0,TriangleStripDrawMode:1,TriangleFanDrawMode:2,LinearEncoding:3E3,sRGBEncoding:3001,GammaEncoding:3007,RGBEEncoding:3002,LogLuvEncoding:3003,RGBM7Encoding:3004,RGBM16Encoding:3005,RGBDEncoding:3006,BasicDepthPacking:3200,
RGBADepthPacking:3201});THREE.Color=function(a,b,c){return void 0===b&&void 0===c?this.set(a):this.setRGB(a,b,c)};
THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(a){a instanceof THREE.Color?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setScalar:function(a){this.b=this.g=this.r=a},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(){function a(a,c,e){0>e&&(e+=1);1<e&&--e;return e<1/6?a+6*(c-a)*e:
.5>e?c:e<2/3?a+6*(c-a)*(2/3-e):a}return function(b,c,e){b=THREE.Math.euclideanModulo(b,1);c=THREE.Math.clamp(c,0,1);e=THREE.Math.clamp(e,0,1);0===c?this.r=this.g=this.b=e:(c=.5>=e?e*(1+c):e+c-e*c,e=2*e-c,this.r=a(e,c,b+1/3),this.g=a(e,c,b),this.b=a(e,c,b-1/3));return this}}(),setStyle:function(a){function b(b){void 0!==b&&1>parseFloat(b)&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}var c;if(c=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(a)){var e=c[2];switch(c[1]){case "rgb":case "rgba":if(c=
/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(e))return this.r=Math.min(255,parseInt(c[1],10))/255,this.g=Math.min(255,parseInt(c[2],10))/255,this.b=Math.min(255,parseInt(c[3],10))/255,b(c[5]),this;if(c=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(e))return this.r=Math.min(100,parseInt(c[1],10))/100,this.g=Math.min(100,parseInt(c[2],10))/100,this.b=Math.min(100,parseInt(c[3],10))/100,b(c[5]),this;break;case "hsl":case "hsla":if(c=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(e)){var e=
parseFloat(c[1])/360,d=parseInt(c[2],10)/100,g=parseInt(c[3],10)/100;b(c[5]);return this.setHSL(e,d,g)}}}else if(c=/^\#([A-Fa-f0-9]+)$/.exec(a)){c=c[1];e=c.length;if(3===e)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}a&&0<a.length&&
(c=THREE.ColorKeywords[a],void 0!==c?this.setHex(c):console.warn("THREE.Color: Unknown color "+a));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a,b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);var c=0<b?1/b:1;this.r=Math.pow(a.r,c);this.g=Math.pow(a.g,c);this.b=Math.pow(a.b,
c);return this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var b=this.r,c=this.g,e=this.b,d=Math.max(b,c,e),g=Math.min(b,c,e),f,h=
(g+d)/2;if(g===d)g=f=0;else{var k=d-g,g=.5>=h?k/(d+g):k/(2-d-g);switch(d){case b:f=(c-e)/k+(c<e?6:0);break;case c:f=(e-b)/k+2;break;case e:f=(b-c)/k+4}f/=6}a.h=f;a.s=g;a.l=h;return a},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,b,c){var e=this.getHSL();e.h+=a;e.s+=b;e.l+=c;this.setHSL(e.h,e.s,e.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=
a.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},sub:function(a){this.r=Math.max(0,this.r-a.r);this.g=Math.max(0,this.g-a.g);this.b=Math.max(0,this.b-a.b);return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===
this.b},fromArray:function(a,b){void 0===b&&(b=0);this.r=a[b];this.g=a[b+1];this.b=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a}};
THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,
darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,
grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,
lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,
palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,
tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(a,b,c,e){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==e?e:1};
THREE.Quaternion.prototype={constructor:THREE.Quaternion,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a;this.onChangeCallback()},set:function(a,b,c,e){this._x=a;this._y=b;this._z=c;this._w=e;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},
copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;this._w=a.w;this.onChangeCallback();return this},setFromEuler:function(a,b){if(!1===a instanceof THREE.Euler)throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var c=Math.cos(a._x/2),e=Math.cos(a._y/2),d=Math.cos(a._z/2),g=Math.sin(a._x/2),f=Math.sin(a._y/2),h=Math.sin(a._z/2),k=a.order;"XYZ"===k?(this._x=g*e*d+c*f*h,this._y=c*f*d-g*e*h,this._z=c*e*h+g*f*d,this._w=c*e*d-g*f*h):"YXZ"===
k?(this._x=g*e*d+c*f*h,this._y=c*f*d-g*e*h,this._z=c*e*h-g*f*d,this._w=c*e*d+g*f*h):"ZXY"===k?(this._x=g*e*d-c*f*h,this._y=c*f*d+g*e*h,this._z=c*e*h+g*f*d,this._w=c*e*d-g*f*h):"ZYX"===k?(this._x=g*e*d-c*f*h,this._y=c*f*d+g*e*h,this._z=c*e*h-g*f*d,this._w=c*e*d+g*f*h):"YZX"===k?(this._x=g*e*d+c*f*h,this._y=c*f*d+g*e*h,this._z=c*e*h-g*f*d,this._w=c*e*d-g*f*h):"XZY"===k&&(this._x=g*e*d-c*f*h,this._y=c*f*d-g*e*h,this._z=c*e*h+g*f*d,this._w=c*e*d+g*f*h);if(!1!==b)this.onChangeCallback();return this},setFromAxisAngle:function(a,
b){var c=b/2,e=Math.sin(c);this._x=a.x*e;this._y=a.y*e;this._z=a.z*e;this._w=Math.cos(c);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var e=b[8],d=b[1],g=b[5],f=b[9],h=b[2],k=b[6],b=b[10],l=c+g+b;0<l?(c=.5/Math.sqrt(l+1),this._w=.25/c,this._x=(k-f)*c,this._y=(e-h)*c,this._z=(d-a)*c):c>g&&c>b?(c=2*Math.sqrt(1+c-g-b),this._w=(k-f)/c,this._x=.25*c,this._y=(a+d)/c,this._z=(e+h)/c):g>b?(c=2*Math.sqrt(1+g-c-b),this._w=(e-h)/c,this._x=(a+d)/c,this._y=
.25*c,this._z=(f+k)/c):(c=2*Math.sqrt(1+b-c-g),this._w=(d-a)/c,this._x=(e+h)/c,this._y=(f+k)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,b;return function(c,e){void 0===a&&(a=new THREE.Vector3);b=c.dot(e)+1;1E-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,e);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;return this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){this._x*=
-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},
multiply:function(a,b){return void 0!==b?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},premultiply:function(a){return this.multiplyQuaternions(a,this)},multiplyQuaternions:function(a,b){var c=a._x,e=a._y,d=a._z,g=a._w,f=b._x,h=b._y,k=b._z,l=b._w;this._x=c*l+g*f+e*k-d*h;this._y=e*l+g*h+d*f-c*k;this._z=d*l+g*k+c*h-e*f;this._w=g*l-c*f-e*h-d*k;this.onChangeCallback();
return this},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,e=this._y,d=this._z,g=this._w,f=g*a._w+c*a._x+e*a._y+d*a._z;0>f?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,f=-f):this.copy(a);if(1<=f)return this._w=g,this._x=c,this._y=e,this._z=d,this;var h=Math.sqrt(1-f*f);if(.001>Math.abs(h))return this._w=.5*(g+this._w),this._x=.5*(c+this._x),this._y=.5*(e+this._y),this._z=.5*(d+this._z),this;var k=Math.atan2(h,f),f=Math.sin((1-b)*k)/h,h=Math.sin(b*
k)/h;this._w=g*f+this._w*h;this._x=c*f+this._x*h;this._y=e*f+this._y*h;this._z=d*f+this._z*h;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=
a;return this},onChangeCallback:function(){}};
Object.assign(THREE.Quaternion,{slerp:function(a,b,c,e){return c.copy(a).slerp(b,e)},slerpFlat:function(a,b,c,e,d,g,f){var h=c[e+0],k=c[e+1],l=c[e+2];c=c[e+3];e=d[g+0];var n=d[g+1],q=d[g+2];d=d[g+3];if(c!==d||h!==e||k!==n||l!==q){g=1-f;var m=h*e+k*n+l*q+c*d,p=0<=m?1:-1,r=1-m*m;r>Number.EPSILON&&(r=Math.sqrt(r),m=Math.atan2(r,m*p),g=Math.sin(g*m)/r,f=Math.sin(f*m)/r);p*=f;h=h*g+e*p;k=k*g+n*p;l=l*g+q*p;c=c*g+d*p;g===1-f&&(f=1/Math.sqrt(h*h+k*k+l*l+c*c),h*=f,k*=f,l*=f,c*=f)}a[b]=h;a[b+1]=k;a[b+2]=l;
a[b+3]=c}});THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};
THREE.Vector2.prototype={constructor:THREE.Vector2,get width(){return this.x},set width(a){this.x=a},get height(){return this.y},set height(a){this.y=a},set:function(a,b){this.x=a;this.y=b;return this},setScalar:function(a){this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;
case 1:return this.y;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},
addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,
this.y*=a):this.y=this.x=0;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));return this},clampScalar:function(){var a,b;return function(c,e){void 0===
a&&(a=new THREE.Vector2,b=new THREE.Vector2);a.set(c,c);b.set(e,e);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.multiplyScalar(Math.max(a,Math.min(b,c))/c)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);
this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var a=Math.atan2(this.y,this.x);0>a&&(a+=2*Math.PI);return a},
distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},distanceToManhattan:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y},
fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];return this},rotateAround:function(a,b){var c=Math.cos(b),e=Math.sin(b),d=this.x-a.x,g=this.y-a.y;this.x=d*c-g*e+a.x;this.y=d*e+g*c+a.y;return this}};THREE.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};
THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setScalar:function(a){this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;
case 2:return this.z;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,
b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},
multiply:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===b instanceof THREE.Euler&&
console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.");void 0===a&&(a=new THREE.Quaternion);return this.applyQuaternion(a.setFromEuler(b))}}(),applyAxisAngle:function(){var a;return function(b,c){void 0===a&&(a=new THREE.Quaternion);return this.applyQuaternion(a.setFromAxisAngle(b,c))}}(),applyMatrix3:function(a){var b=this.x,c=this.y,e=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*e;this.y=a[1]*b+a[4]*c+a[7]*e;this.z=a[2]*b+a[5]*c+a[8]*e;return this},
applyMatrix4:function(a){var b=this.x,c=this.y,e=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*e+a[12];this.y=a[1]*b+a[5]*c+a[9]*e+a[13];this.z=a[2]*b+a[6]*c+a[10]*e+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,e=this.z;a=a.elements;var d=1/(a[3]*b+a[7]*c+a[11]*e+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*e+a[12])*d;this.y=(a[1]*b+a[5]*c+a[9]*e+a[13])*d;this.z=(a[2]*b+a[6]*c+a[10]*e+a[14])*d;return this},applyQuaternion:function(a){var b=this.x,c=this.y,e=this.z,d=a.x,g=a.y,f=a.z;a=
a.w;var h=a*b+g*e-f*c,k=a*c+f*b-d*e,l=a*e+d*c-g*b,b=-d*b-g*c-f*e;this.x=h*a+b*-d+k*-f-l*-g;this.y=k*a+b*-g+l*-d-h*-f;this.z=l*a+b*-f+h*-g-k*-d;return this},project:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyProjection(a)}}(),unproject:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyProjection(a)}}(),
transformDirection:function(a){var b=this.x,c=this.y,e=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*e;this.y=a[1]*b+a[5]*c+a[9]*e;this.z=a[2]*b+a[6]*c+a[10]*e;return this.normalize()},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=
Math.max(this.z,a.z);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this},clampScalar:function(){var a,b;return function(c,e){void 0===a&&(a=new THREE.Vector3,b=new THREE.Vector3);a.set(c,c,c);b.set(e,e,e);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.multiplyScalar(Math.max(a,Math.min(b,c))/c)},floor:function(){this.x=Math.floor(this.x);this.y=
Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=
-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=
(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},cross:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var c=this.x,e=this.y,d=this.z;this.x=e*a.z-d*a.y;this.y=d*a.x-c*a.z;this.z=c*a.y-e*a.x;return this},crossVectors:function(a,b){var c=a.x,e=a.y,d=a.z,g=b.x,f=b.y,h=b.z;this.x=e*h-d*f;this.y=d*g-c*h;
this.z=c*f-e*g;return this},projectOnVector:function(a){var b=a.dot(this)/a.lengthSq();return this.copy(a).multiplyScalar(b)},projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=this.dot(a)/Math.sqrt(this.lengthSq()*a.lengthSq());return Math.acos(THREE.Math.clamp(a,
-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},distanceToManhattan:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)},setFromSpherical:function(a){var b=Math.sin(a.phi)*a.radius;this.x=b*Math.sin(a.theta);this.y=Math.cos(a.phi)*a.radius;this.z=b*Math.cos(a.theta);return this},setFromMatrixPosition:function(a){return this.setFromMatrixColumn(a,3)},
setFromMatrixScale:function(a){var b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,1).length();a=this.setFromMatrixColumn(a,2).length();this.x=b;this.y=c;this.z=a;return this},setFromMatrixColumn:function(a,b){if("number"===typeof a){console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).");var c=a;a=b;b=c}return this.fromArray(a.elements,4*b)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);
this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];return this}};THREE.Vector4=function(a,b,c,e){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==e?e:1};
THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,b,c,e){this.x=a;this.y=b;this.z=c;this.w=e;return this},setScalar:function(a){this.w=this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+
a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);
this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;this.w+=a.w*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=
a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a,this.w*=a):this.w=this.z=this.y=this.x=0;return this},applyMatrix4:function(a){var b=this.x,c=this.y,e=this.z,d=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*e+a[12]*d;this.y=a[1]*b+a[5]*c+a[9]*e+a[13]*d;this.z=
a[2]*b+a[6]*c+a[10]*e+a[14]*d;this.w=a[3]*b+a[7]*c+a[11]*e+a[15]*d;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){var b,c,e;a=a.elements;var d=a[0];e=a[4];var g=a[8],f=a[1],h=a[5],k=a[9];c=a[2];b=a[6];var l=a[10];if(.01>Math.abs(e-f)&&.01>Math.abs(g-c)&&.01>
Math.abs(k-b)){if(.1>Math.abs(e+f)&&.1>Math.abs(g+c)&&.1>Math.abs(k+b)&&.1>Math.abs(d+h+l-3))return this.set(1,0,0,0),this;a=Math.PI;d=(d+1)/2;h=(h+1)/2;l=(l+1)/2;e=(e+f)/4;g=(g+c)/4;k=(k+b)/4;d>h&&d>l?.01>d?(b=0,e=c=.707106781):(b=Math.sqrt(d),c=e/b,e=g/b):h>l?.01>h?(b=.707106781,c=0,e=.707106781):(c=Math.sqrt(h),b=e/c,e=k/c):.01>l?(c=b=.707106781,e=0):(e=Math.sqrt(l),b=g/e,c=k/e);this.set(b,c,e,a);return this}a=Math.sqrt((b-k)*(b-k)+(g-c)*(g-c)+(f-e)*(f-e));.001>Math.abs(a)&&(a=1);this.x=(b-k)/
a;this.y=(g-c)/a;this.z=(f-e)/a;this.w=Math.acos((d+h+l-1)/2);return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);this.w=Math.min(this.w,a.w);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);this.w=Math.max(this.w,a.w);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));
this.w=Math.max(a.w,Math.min(b.w,this.w));return this},clampScalar:function(){var a,b;return function(c,e){void 0===a&&(a=new THREE.Vector4,b=new THREE.Vector4);a.set(c,c,c,c);b.set(e,e,e,e);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=
Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*
a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-
this.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+
c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];this.w=a.array[b+3];return this}};THREE.Euler=function(a,b,c,e){this._x=a||0;this._y=b||0;this._z=c||0;this._order=e||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");THREE.Euler.DefaultOrder="XYZ";
THREE.Euler.prototype={constructor:THREE.Euler,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,c,e){this._x=a;this._y=b;this._z=c;this._order=e||this._order;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,
this._y,this._z,this._order)},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b,c){var e=THREE.Math.clamp,d=a.elements;a=d[0];var g=d[4],f=d[8],h=d[1],k=d[5],l=d[9],n=d[2],q=d[6],d=d[10];b=b||this._order;"XYZ"===b?(this._y=Math.asin(e(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-g,a)):(this._x=Math.atan2(q,k),this._z=0)):"YXZ"===b?(this._x=Math.asin(-e(l,-1,1)),.99999>Math.abs(l)?
(this._y=Math.atan2(f,d),this._z=Math.atan2(h,k)):(this._y=Math.atan2(-n,a),this._z=0)):"ZXY"===b?(this._x=Math.asin(e(q,-1,1)),.99999>Math.abs(q)?(this._y=Math.atan2(-n,d),this._z=Math.atan2(-g,k)):(this._y=0,this._z=Math.atan2(h,a))):"ZYX"===b?(this._y=Math.asin(-e(n,-1,1)),.99999>Math.abs(n)?(this._x=Math.atan2(q,d),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-g,k))):"YZX"===b?(this._z=Math.asin(e(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(-l,k),this._y=Math.atan2(-n,a)):(this._x=
0,this._y=Math.atan2(f,d))):"XZY"===b?(this._z=Math.asin(-e(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(q,k),this._y=Math.atan2(f,a)):(this._x=Math.atan2(-l,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+b);this._order=b;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var a;return function(b,c,e){void 0===a&&(a=new THREE.Matrix4);a.makeRotationFromQuaternion(b);return this.setFromRotationMatrix(a,c,e)}}(),setFromVector3:function(a,
b){return this.set(a.x,a.y,a.z,b||this._order)},reorder:function(){var a=new THREE.Quaternion;return function(b){a.setFromEuler(this);return this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;
a[b+3]=this._order;return a},toVector3:function(a){return a?a.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};THREE.Line3=function(a,b){this.start=void 0!==a?a:new THREE.Vector3;this.end=void 0!==b?b:new THREE.Vector3};
THREE.Line3.prototype={constructor:THREE.Line3,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},center:function(a){return(a||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},
at:function(a,b){var c=b||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,e){a.subVectors(c,this.start);b.subVectors(this.end,this.start);var d=b.dot(b),d=b.dot(a)/d;e&&(d=THREE.Math.clamp(d,0,1));return d}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);c=c||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);
this.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)}};THREE.Box2=function(a,b){this.min=void 0!==a?a:new THREE.Vector2(Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector2(-Infinity,-Infinity)};
THREE.Box2.prototype={constructor:THREE.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new THREE.Vector2;return function(b,c){var e=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(e);this.max.copy(b).add(e);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);
return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new THREE.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);
this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector2).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>
this.max.y?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector2;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&
a.max.equals(this.max)}};THREE.Box3=function(a,b){this.min=void 0!==a?a:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};
THREE.Box3.prototype={constructor:THREE.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromArray:function(a){for(var b=Infinity,c=Infinity,e=Infinity,d=-Infinity,g=-Infinity,f=-Infinity,h=0,k=a.length;h<k;h+=3){var l=a[h],n=a[h+1],q=a[h+2];l<b&&(b=l);n<c&&(c=n);q<e&&(e=q);l>d&&(d=l);n>g&&(g=n);q>f&&(f=q)}this.min.set(b,c,e);this.max.set(d,g,f)},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=
new THREE.Vector3;return function(b,c){var e=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(e);this.max.copy(b).add(e);return this}}(),setFromObject:function(){var a=new THREE.Vector3;return function(b){var c=this;b.updateMatrixWorld(!0);this.makeEmpty();b.traverse(function(b){var d=b.geometry;if(void 0!==d)if(d instanceof THREE.Geometry)for(var d=d.vertices,e=0,f=d.length;e<f;e++)a.copy(d[e]),a.applyMatrix4(b.matrixWorld),c.expandByPoint(a);else if(d instanceof THREE.BufferGeometry&&(f=d.attributes.position,
void 0!==f)){var h;f instanceof THREE.InterleavedBufferAttribute?(d=f.data.array,e=f.offset,h=f.data.stride):(d=f.array,e=0,h=3);for(f=d.length;e<f;e+=h)a.fromArray(d,e),a.applyMatrix4(b.matrixWorld),c.expandByPoint(a)}});return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<
this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(a){return(a||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||
a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector3).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||
a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0},intersectsSphere:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);this.clampPoint(b.center,a);return a.distanceToSquared(b.center)<=b.radius*b.radius}}(),intersectsPlane:function(a){var b,c;0<a.normal.x?(b=a.normal.x*this.min.x,c=a.normal.x*this.max.x):(b=a.normal.x*this.max.x,c=a.normal.x*this.min.x);0<a.normal.y?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,
c+=a.normal.y*this.min.y);0<a.normal.z?(b+=a.normal.z*this.min.z,c+=a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z);return b<=a.constant&&c>=a.constant},clampPoint:function(a,b){return(b||new THREE.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new THREE.Vector3;return function(b){b=b||new THREE.Sphere;b.center=
this.center();b.radius=.5*this.size(a).length();return b}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);this.isEmpty()&&this.makeEmpty();return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(){var a=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(b){if(this.isEmpty())return this;a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);
a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);
return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}};THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")};
THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(a,b,c,e,d,g,f,h,k){var l=this.elements;l[0]=a;l[1]=e;l[2]=f;l[3]=b;l[4]=d;l[5]=h;l[6]=c;l[7]=g;l[8]=k;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},setFromMatrix4:function(a){a=a.elements;this.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]);
return this},applyToVector3Array:function(){var a;return function(b,c,e){void 0===a&&(a=new THREE.Vector3);void 0===c&&(c=0);void 0===e&&(e=b.length);for(var d=0;d<e;d+=3,c+=3)a.fromArray(b,c),a.applyMatrix3(this),a.toArray(b,c);return b}}(),applyToBuffer:function(){var a;return function(b,c,e){void 0===a&&(a=new THREE.Vector3);void 0===c&&(c=0);void 0===e&&(e=b.length/b.itemSize);for(var d=0;d<e;d++,c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.applyMatrix3(this),b.setXYZ(a.x,a.y,a.z);return b}}(),
multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],e=a[2],d=a[3],g=a[4],f=a[5],h=a[6],k=a[7],a=a[8];return b*g*a-b*f*k-c*d*a+c*f*h+e*d*k-e*g*h},getInverse:function(a,b){a instanceof THREE.Matrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var c=a.elements,e=this.elements,d=c[0],g=c[1],f=c[2],h=c[3],k=c[4],l=c[5],n=c[6],q=c[7],
c=c[8],m=c*k-l*q,p=l*n-c*h,r=q*h-k*n,t=d*m+g*p+f*r;if(0===t){if(b)throw Error("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");return this.identity()}t=1/t;e[0]=m*t;e[1]=(f*q-c*g)*t;e[2]=(l*g-f*k)*t;e[3]=p*t;e[4]=(c*d-f*n)*t;e[5]=(f*h-l*d)*t;e[6]=r*t;e[7]=(g*n-q*d)*t;e[8]=(k*d-g*h)*t;return this},transpose:function(){var a,b=this.elements;a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=
b[7];b[7]=a;return this},flattenToArrayOffset:function(a,b){console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.");return this.toArray(a,b)},getNormalMatrix:function(a){return this.setFromMatrix4(a).getInverse(this).transpose()},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(a,b){void 0===
a&&(a=[]);void 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a}};THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")};
THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(a,b,c,e,d,g,f,h,k,l,n,q,m,p,r,t){var w=this.elements;w[0]=a;w[4]=b;w[8]=c;w[12]=e;w[1]=d;w[5]=g;w[9]=f;w[13]=h;w[2]=k;w[6]=l;w[10]=n;w[14]=q;w[3]=m;w[7]=p;w[11]=r;w[15]=t;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)},copy:function(a){this.elements.set(a.elements);return this},copyPosition:function(a){var b=this.elements;a=a.elements;
b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,b,c){a.setFromMatrixColumn(this,0);b.setFromMatrixColumn(this,1);c.setFromMatrixColumn(this,2);return this},makeBasis:function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);var c=this.elements,e=b.elements,d=1/a.setFromMatrixColumn(b,0).length(),g=1/a.setFromMatrixColumn(b,1).length();b=1/a.setFromMatrixColumn(b,
2).length();c[0]=e[0]*d;c[1]=e[1]*d;c[2]=e[2]*d;c[4]=e[4]*g;c[5]=e[5]*g;c[6]=e[6]*g;c[8]=e[8]*b;c[9]=e[9]*b;c[10]=e[10]*b;return this}}(),makeRotationFromEuler:function(a){!1===a instanceof THREE.Euler&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,e=a.y,d=a.z,g=Math.cos(c),c=Math.sin(c),f=Math.cos(e),e=Math.sin(e),h=Math.cos(d),d=Math.sin(d);if("XYZ"===a.order){a=g*h;var k=g*d,l=c*h,n=c*d;b[0]=f*h;b[4]=
-f*d;b[8]=e;b[1]=k+l*e;b[5]=a-n*e;b[9]=-c*f;b[2]=n-a*e;b[6]=l+k*e;b[10]=g*f}else"YXZ"===a.order?(a=f*h,k=f*d,l=e*h,n=e*d,b[0]=a+n*c,b[4]=l*c-k,b[8]=g*e,b[1]=g*d,b[5]=g*h,b[9]=-c,b[2]=k*c-l,b[6]=n+a*c,b[10]=g*f):"ZXY"===a.order?(a=f*h,k=f*d,l=e*h,n=e*d,b[0]=a-n*c,b[4]=-g*d,b[8]=l+k*c,b[1]=k+l*c,b[5]=g*h,b[9]=n-a*c,b[2]=-g*e,b[6]=c,b[10]=g*f):"ZYX"===a.order?(a=g*h,k=g*d,l=c*h,n=c*d,b[0]=f*h,b[4]=l*e-k,b[8]=a*e+n,b[1]=f*d,b[5]=n*e+a,b[9]=k*e-l,b[2]=-e,b[6]=c*f,b[10]=g*f):"YZX"===a.order?(a=g*f,k=g*
e,l=c*f,n=c*e,b[0]=f*h,b[4]=n-a*d,b[8]=l*d+k,b[1]=d,b[5]=g*h,b[9]=-c*h,b[2]=-e*h,b[6]=k*d+l,b[10]=a-n*d):"XZY"===a.order&&(a=g*f,k=g*e,l=c*f,n=c*e,b[0]=f*h,b[4]=-d,b[8]=e*h,b[1]=a*d+n,b[5]=g*h,b[9]=k*d-l,b[2]=l*d-k,b[6]=c*h,b[10]=n*d+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,e=a.y,d=a.z,g=a.w,f=c+c,h=e+e,k=d+d;a=c*f;var l=c*h,c=c*k,n=e*h,e=e*k,d=d*k,f=g*f,h=g*h,g=g*k;b[0]=1-(n+d);b[4]=l-g;b[8]=c+h;b[1]=l+
g;b[5]=1-(a+d);b[9]=e-f;b[2]=c-h;b[6]=e+f;b[10]=1-(a+n);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a,b,c;return function(e,d,g){void 0===a&&(a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3);var f=this.elements;c.subVectors(e,d).normalize();0===c.lengthSq()&&(c.z=1);a.crossVectors(g,c).normalize();0===a.lengthSq()&&(c.z+=1E-4,a.crossVectors(g,c).normalize());b.crossVectors(c,a);f[0]=a.x;f[4]=b.x;f[8]=c.x;f[1]=a.y;f[5]=b.y;f[9]=c.y;f[2]=a.z;
f[6]=b.z;f[10]=c.z;return this}}(),multiply:function(a,b){return void 0!==b?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(a,b){var c=a.elements,e=b.elements,d=this.elements,g=c[0],f=c[4],h=c[8],k=c[12],l=c[1],n=c[5],q=c[9],m=c[13],p=c[2],r=c[6],t=c[10],w=c[14],v=c[3],u=c[7],z=c[11],c=c[15],
x=e[0],A=e[4],y=e[8],B=e[12],C=e[1],F=e[5],H=e[9],K=e[13],M=e[2],O=e[6],I=e[10],D=e[14],J=e[3],N=e[7],S=e[11],e=e[15];d[0]=g*x+f*C+h*M+k*J;d[4]=g*A+f*F+h*O+k*N;d[8]=g*y+f*H+h*I+k*S;d[12]=g*B+f*K+h*D+k*e;d[1]=l*x+n*C+q*M+m*J;d[5]=l*A+n*F+q*O+m*N;d[9]=l*y+n*H+q*I+m*S;d[13]=l*B+n*K+q*D+m*e;d[2]=p*x+r*C+t*M+w*J;d[6]=p*A+r*F+t*O+w*N;d[10]=p*y+r*H+t*I+w*S;d[14]=p*B+r*K+t*D+w*e;d[3]=v*x+u*C+z*M+c*J;d[7]=v*A+u*F+z*O+c*N;d[11]=v*y+u*H+z*I+c*S;d[15]=v*B+u*K+z*D+c*e;return this},multiplyToArray:function(a,b,
c){var e=this.elements;this.multiplyMatrices(a,b);c[0]=e[0];c[1]=e[1];c[2]=e[2];c[3]=e[3];c[4]=e[4];c[5]=e[5];c[6]=e[6];c[7]=e[7];c[8]=e[8];c[9]=e[9];c[10]=e[10];c[11]=e[11];c[12]=e[12];c[13]=e[13];c[14]=e[14];c[15]=e[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},applyToVector3Array:function(){var a;return function(b,c,e){void 0===a&&
(a=new THREE.Vector3);void 0===c&&(c=0);void 0===e&&(e=b.length);for(var d=0;d<e;d+=3,c+=3)a.fromArray(b,c),a.applyMatrix4(this),a.toArray(b,c);return b}}(),applyToBuffer:function(){var a;return function(b,c,e){void 0===a&&(a=new THREE.Vector3);void 0===c&&(c=0);void 0===e&&(e=b.length/b.itemSize);for(var d=0;d<e;d++,c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.applyMatrix4(this),b.setXYZ(a.x,a.y,a.z);return b}}(),determinant:function(){var a=this.elements,b=a[0],c=a[4],e=a[8],d=a[12],g=a[1],f=
a[5],h=a[9],k=a[13],l=a[2],n=a[6],q=a[10],m=a[14];return a[3]*(+d*h*n-e*k*n-d*f*q+c*k*q+e*f*m-c*h*m)+a[7]*(+b*h*m-b*k*q+d*g*q-e*g*m+e*k*l-d*h*l)+a[11]*(+b*k*n-b*f*m-d*g*n+c*g*m+d*f*l-c*k*l)+a[15]*(-e*f*l-b*h*n+b*f*q+e*g*n-c*g*q+c*h*l)},transpose:function(){var a=this.elements,b;b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,b){console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.");
return this.toArray(a,b)},getPosition:function(){var a;return function(){void 0===a&&(a=new THREE.Vector3);console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return a.setFromMatrixColumn(this,3)}}(),setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var c=this.elements,e=a.elements,d=e[0],g=e[1],f=e[2],h=e[3],k=e[4],l=e[5],n=e[6],q=e[7],m=e[8],p=e[9],r=e[10],t=e[11],w=e[12],
v=e[13],u=e[14],e=e[15],z=p*u*q-v*r*q+v*n*t-l*u*t-p*n*e+l*r*e,x=w*r*q-m*u*q-w*n*t+k*u*t+m*n*e-k*r*e,A=m*v*q-w*p*q+w*l*t-k*v*t-m*l*e+k*p*e,y=w*p*n-m*v*n-w*l*r+k*v*r+m*l*u-k*p*u,B=d*z+g*x+f*A+h*y;if(0===B){if(b)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");return this.identity()}B=1/B;c[0]=z*B;c[1]=(v*r*h-p*u*h-v*f*t+g*u*t+p*f*e-g*r*e)*B;c[2]=(l*u*h-v*n*h+v*f*q-g*u*q-l*f*e+g*n*e)*B;c[3]=
(p*n*h-l*r*h-p*f*q+g*r*q+l*f*t-g*n*t)*B;c[4]=x*B;c[5]=(m*u*h-w*r*h+w*f*t-d*u*t-m*f*e+d*r*e)*B;c[6]=(w*n*h-k*u*h-w*f*q+d*u*q+k*f*e-d*n*e)*B;c[7]=(k*r*h-m*n*h+m*f*q-d*r*q-k*f*t+d*n*t)*B;c[8]=A*B;c[9]=(w*p*h-m*v*h-w*g*t+d*v*t+m*g*e-d*p*e)*B;c[10]=(k*v*h-w*l*h+w*g*q-d*v*q-k*g*e+d*l*e)*B;c[11]=(m*l*h-k*p*h-m*g*q+d*p*q+k*g*t-d*l*t)*B;c[12]=y*B;c[13]=(m*v*f-w*p*f+w*g*r-d*v*r-m*g*u+d*p*u)*B;c[14]=(w*l*f-k*v*f-w*g*n+d*v*n+k*g*u-d*l*u)*B;c[15]=(k*p*f-m*l*f+m*g*n-d*p*n-k*g*r+d*l*r)*B;return this},scale:function(a){var b=
this.elements,c=a.x,e=a.y;a=a.z;b[0]*=c;b[4]*=e;b[8]*=a;b[1]*=c;b[5]*=e;b[9]*=a;b[2]*=c;b[6]*=e;b[10]*=a;b[3]*=c;b[7]*=e;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this},makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);
return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b),e=Math.sin(b),d=1-c,g=a.x,f=a.y,h=a.z,k=d*g,l=d*f;this.set(k*g+c,k*f-e*h,k*h+e*f,0,k*f+e*h,l*f+c,l*h-e*g,0,k*h-e*f,l*h+e*g,d*h*h+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,
0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a,b;return function(c,e,d){void 0===a&&(a=new THREE.Vector3,b=new THREE.Matrix4);var g=this.elements,f=a.set(g[0],g[1],g[2]).length(),h=a.set(g[4],g[5],g[6]).length(),k=a.set(g[8],g[9],g[10]).length();0>this.determinant()&&(f=-f);c.x=g[12];c.y=g[13];c.z=g[14];b.elements.set(this.elements);c=1/f;var g=1/h,l=1/k;b.elements[0]*=c;b.elements[1]*=c;
b.elements[2]*=c;b.elements[4]*=g;b.elements[5]*=g;b.elements[6]*=g;b.elements[8]*=l;b.elements[9]*=l;b.elements[10]*=l;e.setFromRotationMatrix(b);d.x=f;d.y=h;d.z=k;return this}}(),makeFrustum:function(a,b,c,e,d,g){var f=this.elements;f[0]=2*d/(b-a);f[4]=0;f[8]=(b+a)/(b-a);f[12]=0;f[1]=0;f[5]=2*d/(e-c);f[9]=(e+c)/(e-c);f[13]=0;f[2]=0;f[6]=0;f[10]=-(g+d)/(g-d);f[14]=-2*g*d/(g-d);f[3]=0;f[7]=0;f[11]=-1;f[15]=0;return this},makePerspective:function(a,b,c,e){a=c*Math.tan(THREE.Math.DEG2RAD*a*.5);var d=
-a;return this.makeFrustum(d*b,a*b,d,a,c,e)},makeOrthographic:function(a,b,c,e,d,g){var f=this.elements,h=1/(b-a),k=1/(c-e),l=1/(g-d);f[0]=2*h;f[4]=0;f[8]=0;f[12]=-((b+a)*h);f[1]=0;f[5]=2*k;f[9]=0;f[13]=-((c+e)*k);f[2]=0;f[6]=0;f[10]=-2*l;f[14]=-((g+d)*l);f[3]=0;f[7]=0;f[11]=0;f[15]=1;return this},equals:function(a){var b=this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0},fromArray:function(a){this.elements.set(a);return this},toArray:function(a,b){void 0===a&&(a=[]);
void 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a}};THREE.Ray=function(a,b){this.origin=void 0!==a?a:new THREE.Vector3;this.direction=void 0!==b?b:new THREE.Vector3};
THREE.Ray.prototype={constructor:THREE.Ray,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){return(b||new THREE.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(a){this.direction.copy(a).sub(this.origin).normalize();return this},recast:function(){var a=new THREE.Vector3;return function(b){this.origin.copy(this.at(b,
a));return this}}(),closestPointToPoint:function(a,b){var c=b||new THREE.Vector3;c.subVectors(a,this.origin);var e=c.dot(this.direction);return 0>e?c.copy(this.origin):c.copy(this.direction).multiplyScalar(e).add(this.origin)},distanceToPoint:function(a){return Math.sqrt(this.distanceSqToPoint(a))},distanceSqToPoint:function(){var a=new THREE.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceToSquared(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);
return a.distanceToSquared(b)}}(),distanceSqToSegment:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(e,d,g,f){a.copy(e).add(d).multiplyScalar(.5);b.copy(d).sub(e).normalize();c.copy(this.origin).sub(a);var h=.5*e.distanceTo(d),k=-this.direction.dot(b),l=c.dot(this.direction),n=-c.dot(b),q=c.lengthSq(),m=Math.abs(1-k*k),p;0<m?(e=k*n-l,d=k*l-n,p=h*m,0<=e?d>=-p?d<=p?(h=1/m,e*=h,d*=h,k=e*(e+k*d+2*l)+d*(k*e+d+2*n)+q):(d=h,e=Math.max(0,-(k*d+l)),k=-e*e+d*(d+2*
n)+q):(d=-h,e=Math.max(0,-(k*d+l)),k=-e*e+d*(d+2*n)+q):d<=-p?(e=Math.max(0,-(-k*h+l)),d=0<e?-h:Math.min(Math.max(-h,-n),h),k=-e*e+d*(d+2*n)+q):d<=p?(e=0,d=Math.min(Math.max(-h,-n),h),k=d*(d+2*n)+q):(e=Math.max(0,-(k*h+l)),d=0<e?h:Math.min(Math.max(-h,-n),h),k=-e*e+d*(d+2*n)+q)):(d=0<k?-h:h,e=Math.max(0,-(k*d+l)),k=-e*e+d*(d+2*n)+q);g&&g.copy(this.direction).multiplyScalar(e).add(this.origin);f&&f.copy(b).multiplyScalar(d).add(a);return k}}(),intersectSphere:function(){var a=new THREE.Vector3;return function(b,
c){a.subVectors(b.center,this.origin);var e=a.dot(this.direction),d=a.dot(a)-e*e,g=b.radius*b.radius;if(d>g)return null;g=Math.sqrt(g-d);d=e-g;e+=g;return 0>d&&0>e?null:0>d?this.at(e,c):this.at(d,c)}}(),intersectsSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0===b)return 0===a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){var c=
this.distanceToPlane(a);return null===c?null:this.at(c,b)},intersectsPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},intersectBox:function(a,b){var c,e,d,g,f;e=1/this.direction.x;g=1/this.direction.y;f=1/this.direction.z;var h=this.origin;0<=e?(c=(a.min.x-h.x)*e,e*=a.max.x-h.x):(c=(a.max.x-h.x)*e,e*=a.min.x-h.x);0<=g?(d=(a.min.y-h.y)*g,g*=a.max.y-h.y):(d=(a.max.y-h.y)*g,g*=a.min.y-h.y);if(c>g||d>e)return null;if(d>c||c!==c)c=d;if(g<e||e!==
e)e=g;0<=f?(d=(a.min.z-h.z)*f,f*=a.max.z-h.z):(d=(a.max.z-h.z)*f,f*=a.min.z-h.z);if(c>f||d>e)return null;if(d>c||c!==c)c=d;if(f<e||e!==e)e=f;return 0>e?null:this.at(0<=c?c:e,b)},intersectsBox:function(){var a=new THREE.Vector3;return function(b){return null!==this.intersectBox(b,a)}}(),intersectTriangle:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,e=new THREE.Vector3;return function(d,g,f,h,k){b.subVectors(g,d);c.subVectors(f,d);e.crossVectors(b,c);g=this.direction.dot(e);
if(0<g){if(h)return null;h=1}else if(0>g)h=-1,g=-g;else return null;a.subVectors(this.origin,d);d=h*this.direction.dot(c.crossVectors(a,c));if(0>d)return null;f=h*this.direction.dot(b.cross(a));if(0>f||d+f>g)return null;d=-h*a.dot(e);return 0>d?null:this.at(d/g,k)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}};
THREE.Sphere=function(a,b){this.center=void 0!==a?a:new THREE.Vector3;this.radius=void 0!==b?b:0};
THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new THREE.Box3;return function(b,c){var e=this.center;void 0!==c?e.copy(c):a.setFromPoints(b).center(e);for(var d=0,g=0,f=b.length;g<f;g++)d=Math.max(d,e.distanceToSquared(b[g]));this.radius=Math.sqrt(d);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},
empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},intersectsBox:function(a){return a.intersectsSphere(this)},intersectsPlane:function(a){return Math.abs(this.center.dot(a.normal)-a.constant)<=this.radius},clampPoint:function(a,b){var c=
this.center.distanceToSquared(a),e=b||new THREE.Vector3;e.copy(a);c>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center));return e},getBoundingBox:function(a){a=a||new THREE.Box3;a.set(this.center,this.center);a.expandByScalar(this.radius);return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&
a.radius===this.radius}};THREE.Frustum=function(a,b,c,e,d,g){this.planes=[void 0!==a?a:new THREE.Plane,void 0!==b?b:new THREE.Plane,void 0!==c?c:new THREE.Plane,void 0!==e?e:new THREE.Plane,void 0!==d?d:new THREE.Plane,void 0!==g?g:new THREE.Plane]};
THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(a,b,c,e,d,g){var f=this.planes;f[0].copy(a);f[1].copy(b);f[2].copy(c);f[3].copy(e);f[4].copy(d);f[5].copy(g);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){for(var b=this.planes,c=0;6>c;c++)b[c].copy(a.planes[c]);return this},setFromMatrix:function(a){var b=this.planes,c=a.elements;a=c[0];var e=c[1],d=c[2],g=c[3],f=c[4],h=c[5],k=c[6],l=c[7],n=c[8],q=c[9],m=c[10],p=c[11],r=c[12],t=c[13],w=c[14],
c=c[15];b[0].setComponents(g-a,l-f,p-n,c-r).normalize();b[1].setComponents(g+a,l+f,p+n,c+r).normalize();b[2].setComponents(g+e,l+h,p+q,c+t).normalize();b[3].setComponents(g-e,l-h,p-q,c-t).normalize();b[4].setComponents(g-d,l-k,p-m,c-w).normalize();b[5].setComponents(g+d,l+k,p+m,c+w).normalize();return this},intersectsObject:function(){var a=new THREE.Sphere;return function(b){var c=b.geometry;null===c.boundingSphere&&c.computeBoundingSphere();a.copy(c.boundingSphere).applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),
intersectsSprite:function(){var a=new THREE.Sphere;return function(b){a.center.set(0,0,0);a.radius=.7071067811865476;a.applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSphere:function(a){var b=this.planes,c=a.center;a=-a.radius;for(var e=0;6>e;e++)if(b[e].distanceToPoint(c)<a)return!1;return!0},intersectsBox:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){for(var e=this.planes,d=0;6>d;d++){var g=e[d];a.x=0<g.normal.x?c.min.x:c.max.x;b.x=0<g.normal.x?
c.max.x:c.min.x;a.y=0<g.normal.y?c.min.y:c.max.y;b.y=0<g.normal.y?c.max.y:c.min.y;a.z=0<g.normal.z?c.min.z:c.max.z;b.z=0<g.normal.z?c.max.z:c.min.z;var f=g.distanceToPoint(a),g=g.distanceToPoint(b);if(0>f&&0>g)return!1}return!0}}(),containsPoint:function(a){for(var b=this.planes,c=0;6>c;c++)if(0>b[c].distanceToPoint(a))return!1;return!0}};THREE.Plane=function(a,b){this.normal=void 0!==a?a:new THREE.Vector3(1,0,0);this.constant=void 0!==b?b:0};
THREE.Plane.prototype={constructor:THREE.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,e){this.normal.set(a,b,c);this.constant=e;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,e,d){e=a.subVectors(d,e).cross(b.subVectors(c,e)).normalize();this.setFromNormalAndCoplanarPoint(e,
c);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,
b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,b){var c=this.distanceToPoint(a);return(b||new THREE.Vector3).copy(this.normal).multiplyScalar(c)},intersectLine:function(){var a=new THREE.Vector3;return function(b,c){var e=c||new THREE.Vector3,d=b.delta(a),g=this.normal.dot(d);if(0===g){if(0===this.distanceToPoint(b.start))return e.copy(b.start)}else return g=-(b.start.dot(this.normal)+this.constant)/g,0>g||1<g?void 0:e.copy(d).multiplyScalar(g).add(b.start)}}(),intersectsLine:function(a){var b=
this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectsBox:function(a){return a.intersectsPlane(this)},intersectsSphere:function(a){return a.intersectsPlane(this)},coplanarPoint:function(a){return(a||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new THREE.Vector3,b=new THREE.Matrix3;return function(c,e){var d=this.coplanarPoint(a).applyMatrix4(c),g=e||b.getNormalMatrix(c),g=this.normal.applyMatrix3(g).normalize();
this.constant=-d.dot(g);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&a.constant===this.constant}};THREE.Spherical=function(a,b,c){this.radius=void 0!==a?a:1;this.phi=void 0!==b?b:0;this.theta=void 0!==c?c:0;return this};
THREE.Spherical.prototype={constructor:THREE.Spherical,set:function(a,b,c){this.radius=a;this.phi=b;this.theta=c;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius.copy(a.radius);this.phi.copy(a.phi);this.theta.copy(a.theta);return this},makeSafe:function(){this.phi=Math.max(1E-6,Math.min(Math.PI-1E-6,this.phi));return this},setFromVector3:function(a){this.radius=a.length();0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(a.x,a.z),this.phi=
Math.acos(THREE.Math.clamp(a.y/this.radius,-1,1)));return this}};
THREE.Math={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),b=Array(36),c=0,e;return function(){for(var d=0;36>d;d++)8===d||13===d||18===d||23===d?b[d]="-":14===d?b[d]="4":(2>=c&&(c=33554432+16777216*Math.random()|0),e=c&15,c>>=4,b[d]=a[19===d?e&3|8:e]);return b.join("")}}(),clamp:function(a,b,c){return Math.max(b,Math.min(c,a))},euclideanModulo:function(a,b){return(a%b+b)%b},mapLinear:function(a,b,c,
e,d){return e+(a-b)*(d-e)/(c-b)},smoothstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead.");return Math.random()},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*
(.5-Math.random())},degToRad:function(a){return a*THREE.Math.DEG2RAD},radToDeg:function(a){return a*THREE.Math.RAD2DEG},isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nearestPowerOfTwo:function(a){return Math.pow(2,Math.round(Math.log(a)/Math.LN2))},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a}};
THREE.Spline=function(a){function b(a,b,c,d,e,f,g){a=.5*(c-a);d=.5*(d-b);return(2*(b-c)+a+d)*g+(-3*(b-c)-2*a-d)*f+a*e+b}this.points=a;var c=[],e={x:0,y:0,z:0},d,g,f,h,k,l,n,q,m;this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}};this.getPoint=function(a){d=(this.points.length-1)*a;g=Math.floor(d);f=d-g;c[0]=0===g?g:g-1;c[1]=g;c[2]=g>this.points.length-2?this.points.length-1:g+1;c[3]=g>this.points.length-3?this.points.length-1:g+
2;l=this.points[c[0]];n=this.points[c[1]];q=this.points[c[2]];m=this.points[c[3]];h=f*f;k=f*h;e.x=b(l.x,n.x,q.x,m.x,f,h,k);e.y=b(l.y,n.y,q.y,m.y,f,h,k);e.z=b(l.z,n.z,q.z,m.z,f,h,k);return e};this.getControlPointsArray=function(){var a,b,c=this.points.length,d=[];for(a=0;a<c;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return d};this.getLength=function(a){var b,c,d,e=0,f=new THREE.Vector3,g=new THREE.Vector3,h=[],k=0;h[0]=0;a||(a=100);c=this.points.length*a;f.copy(this.points[0]);for(a=1;a<c;a++)b=a/c,
d=this.getPoint(b),g.copy(d),k+=g.distanceTo(f),f.copy(d),b*=this.points.length-1,b=Math.floor(b),b!==e&&(h[b]=k,e=b);h[h.length]=k;return{chunks:h,total:k}};this.reparametrizeByArcLength=function(a){var b,c,d,e,f,g,h=[],k=new THREE.Vector3,m=this.getLength();h.push(k.copy(this.points[0]).clone());for(b=1;b<this.points.length;b++){c=m.chunks[b]-m.chunks[b-1];g=Math.ceil(a*c/m.total);e=(b-1)/(this.points.length-1);f=b/(this.points.length-1);for(c=1;c<g-1;c++)d=e+1/g*c*(f-e),d=this.getPoint(d),h.push(k.copy(d).clone());
h.push(k.copy(this.points[b]).clone())}this.points=h}};THREE.Triangle=function(a,b,c){this.a=void 0!==a?a:new THREE.Vector3;this.b=void 0!==b?b:new THREE.Vector3;this.c=void 0!==c?c:new THREE.Vector3};THREE.Triangle.normal=function(){var a=new THREE.Vector3;return function(b,c,e,d){d=d||new THREE.Vector3;d.subVectors(e,c);a.subVectors(b,c);d.cross(a);b=d.lengthSq();return 0<b?d.multiplyScalar(1/Math.sqrt(b)):d.set(0,0,0)}}();
THREE.Triangle.barycoordFromPoint=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(e,d,g,f,h){a.subVectors(f,d);b.subVectors(g,d);c.subVectors(e,d);e=a.dot(a);d=a.dot(b);g=a.dot(c);var k=b.dot(b);f=b.dot(c);var l=e*k-d*d;h=h||new THREE.Vector3;if(0===l)return h.set(-2,-1,-1);l=1/l;k=(k*g-d*f)*l;e=(e*f-d*g)*l;return h.set(1-k-e,e,k)}}();
THREE.Triangle.containsPoint=function(){var a=new THREE.Vector3;return function(b,c,e,d){b=THREE.Triangle.barycoordFromPoint(b,c,e,d,a);return 0<=b.x&&0<=b.y&&1>=b.x+b.y}}();
THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,e){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[e]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,
this.b);return.5*a.cross(b).length()}}(),midpoint:function(a){return(a||new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return THREE.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return THREE.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return THREE.Triangle.containsPoint(a,this.a,this.b,this.c)},
closestPointToPoint:function(){var a,b,c,e;return function(d,g){void 0===a&&(a=new THREE.Plane,b=[new THREE.Line3,new THREE.Line3,new THREE.Line3],c=new THREE.Vector3,e=new THREE.Vector3);var f=g||new THREE.Vector3,h=Infinity;a.setFromCoplanarPoints(this.a,this.b,this.c);a.projectPoint(d,c);if(!0===this.containsPoint(c))f.copy(c);else{b[0].set(this.a,this.b);b[1].set(this.b,this.c);b[2].set(this.c,this.a);for(var k=0;k<b.length;k++){b[k].closestPointToPoint(c,!0,e);var l=c.distanceToSquared(e);l<
h&&(h=l,f.copy(e))}}return f}}(),equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}};THREE.Interpolant=function(a,b,c,e){this.parameterPositions=a;this._cachedIndex=0;this.resultBuffer=void 0!==e?e:new b.constructor(c);this.sampleValues=b;this.valueSize=c};
THREE.Interpolant.prototype={constructor:THREE.Interpolant,evaluate:function(a){var b=this.parameterPositions,c=this._cachedIndex,e=b[c],d=b[c-1];a:{b:{c:{d:if(!(a<e)){for(var g=c+2;;){if(void 0===e){if(a<d)break d;this._cachedIndex=c=b.length;return this.afterEnd_(c-1,a,d)}if(c===g)break;d=e;e=b[++c];if(a<e)break b}e=b.length;break c}if(a>=d)break a;else{g=b[1];a<g&&(c=2,d=g);for(g=c-2;;){if(void 0===d)return this._cachedIndex=0,this.beforeStart_(0,a,e);if(c===g)break;e=d;d=b[--c-1];if(a>=d)break b}e=
c;c=0}}for(;c<e;)d=c+e>>>1,a<b[d]?e=d:c=d+1;e=b[c];d=b[c-1];if(void 0===d)return this._cachedIndex=0,this.beforeStart_(0,a,e);if(void 0===e)return this._cachedIndex=c=b.length,this.afterEnd_(c-1,d,a)}this._cachedIndex=c;this.intervalChanged_(c,d,e)}return this.interpolate_(c,d,a,e)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(a){var b=this.resultBuffer,c=this.sampleValues,e=this.valueSize;a*=e;for(var d=0;d!==e;++d)b[d]=
c[a+d];return b},interpolate_:function(a,b,c,e){throw Error("call to abstract method");},intervalChanged_:function(a,b,c){}};Object.assign(THREE.Interpolant.prototype,{beforeStart_:THREE.Interpolant.prototype.copySampleValue_,afterEnd_:THREE.Interpolant.prototype.copySampleValue_});THREE.CubicInterpolant=function(a,b,c,e){THREE.Interpolant.call(this,a,b,c,e);this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0};
THREE.CubicInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.CubicInterpolant,DefaultSettings_:{endingStart:THREE.ZeroCurvatureEnding,endingEnd:THREE.ZeroCurvatureEnding},intervalChanged_:function(a,b,c){var e=this.parameterPositions,d=a-2,g=a+1,f=e[d],h=e[g];if(void 0===f)switch(this.getSettings_().endingStart){case THREE.ZeroSlopeEnding:d=a;f=2*b-c;break;case THREE.WrapAroundEnding:d=e.length-2;f=b+e[d]-e[d+1];break;default:d=a,f=c}if(void 0===h)switch(this.getSettings_().endingEnd){case THREE.ZeroSlopeEnding:g=
a;h=2*c-b;break;case THREE.WrapAroundEnding:g=1;h=c+e[1]-e[0];break;default:g=a-1,h=b}a=.5*(c-b);e=this.valueSize;this._weightPrev=a/(b-f);this._weightNext=a/(h-c);this._offsetPrev=d*e;this._offsetNext=g*e},interpolate_:function(a,b,c,e){var d=this.resultBuffer,g=this.sampleValues,f=this.valueSize;a*=f;var h=a-f,k=this._offsetPrev,l=this._offsetNext,n=this._weightPrev,q=this._weightNext,m=(c-b)/(e-b);c=m*m;e=c*m;b=-n*e+2*n*c-n*m;n=(1+n)*e+(-1.5-2*n)*c+(-.5+n)*m+1;m=(-1-q)*e+(1.5+q)*c+.5*m;q=q*e-q*
c;for(c=0;c!==f;++c)d[c]=b*g[k+c]+n*g[h+c]+m*g[a+c]+q*g[l+c];return d}});THREE.DiscreteInterpolant=function(a,b,c,e){THREE.Interpolant.call(this,a,b,c,e)};THREE.DiscreteInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.DiscreteInterpolant,interpolate_:function(a,b,c,e){return this.copySampleValue_(a-1)}});THREE.LinearInterpolant=function(a,b,c,e){THREE.Interpolant.call(this,a,b,c,e)};
THREE.LinearInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.LinearInterpolant,interpolate_:function(a,b,c,e){var d=this.resultBuffer,g=this.sampleValues,f=this.valueSize;a*=f;var h=a-f;b=(c-b)/(e-b);c=1-b;for(e=0;e!==f;++e)d[e]=g[h+e]*c+g[a+e]*b;return d}});THREE.QuaternionLinearInterpolant=function(a,b,c,e){THREE.Interpolant.call(this,a,b,c,e)};
THREE.QuaternionLinearInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.QuaternionLinearInterpolant,interpolate_:function(a,b,c,e){var d=this.resultBuffer,g=this.sampleValues,f=this.valueSize;a*=f;b=(c-b)/(e-b);for(c=a+f;a!==c;a+=4)THREE.Quaternion.slerpFlat(d,0,g,a-f,g,a,b);return d}});THREE.Clock=function(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};
THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=(performance||Date).now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=(performance||Date).now(),a=(b-this.oldTime)/1E3;this.oldTime=b;this.elapsedTime+=a}return a}};THREE.EventDispatcher=function(){};
Object.assign(THREE.EventDispatcher.prototype,{addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},removeEventListener:function(a,b){if(void 0!==this._listeners){var c=this._listeners[a];if(void 0!==c){var e=c.indexOf(b);-1!==e&&c.splice(e,1)}}},dispatchEvent:function(a){if(void 0!==
this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;var c=[],e,d=b.length;for(e=0;e<d;e++)c[e]=b[e];for(e=0;e<d;e++)c[e].call(this,a)}}}});THREE.Layers=function(){this.mask=1};THREE.Layers.prototype={constructor:THREE.Layers,set:function(a){this.mask=1<<a},enable:function(a){this.mask|=1<<a},toggle:function(a){this.mask^=1<<a},disable:function(a){this.mask&=~(1<<a)},test:function(a){return 0!==(this.mask&a.mask)}};
(function(a){function b(a,b){return a.distance-b.distance}function c(a,b,g,f){if(!1!==a.visible&&(a.raycast(b,g),!0===f)){a=a.children;f=0;for(var d=a.length;f<d;f++)c(a[f],b,g,!0)}}a.Raycaster=function(b,c,g,f){this.ray=new a.Ray(b,c);this.near=g||0;this.far=f||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})};
a.Raycaster.prototype={constructor:a.Raycaster,linePrecision:1,set:function(a,b){this.ray.set(a,b)},setFromCamera:function(b,c){c instanceof a.PerspectiveCamera?(this.ray.origin.setFromMatrixPosition(c.matrixWorld),this.ray.direction.set(b.x,b.y,.5).unproject(c).sub(this.ray.origin).normalize()):c instanceof a.OrthographicCamera?(this.ray.origin.set(b.x,b.y,(c.near+c.far)/(c.near-c.far)).unproject(c),this.ray.direction.set(0,0,-1).transformDirection(c.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},
intersectObject:function(a,d){var e=[];c(a,this,e,d);e.sort(b);return e},intersectObjects:function(a,d){var e=[];if(!1===Array.isArray(a))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),e;for(var f=0,h=a.length;f<h;f++)c(a[f],this,e,d);e.sort(b);return e}}})(THREE);
THREE.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var a=new THREE.Vector3,b=new THREE.Euler,c=new THREE.Quaternion,e=new THREE.Vector3(1,1,1);b.onChange(function(){c.setFromEuler(b,!1)});c.onChange(function(){b.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,
value:b},quaternion:{enumerable:!0,value:c},scale:{enumerable:!0,value:e},modelViewMatrix:{value:new THREE.Matrix4},normalMatrix:{value:new THREE.Matrix3}});this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=THREE.Object3D.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new THREE.Layers;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={}};
THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0);THREE.Object3D.DefaultMatrixAutoUpdate=!0;
Object.assign(THREE.Object3D.prototype,THREE.EventDispatcher.prototype,{applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=
new THREE.Quaternion;return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new THREE.Vector3;return function(b,c){a.copy(b).applyQuaternion(this.quaternion);
this.position.add(a.multiplyScalar(c));return this}}(),translateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new THREE.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),
lookAt:function(){var a=new THREE.Matrix4;return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this;a instanceof THREE.Object3D?(null!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",
a);return this},remove:function(a){if(1<arguments.length)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);b=this.children.indexOf(a);-1!==b&&(a.parent=null,a.dispatchEvent({type:"removed"}),this.children.splice(b,1))},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,e=this.children.length;c<e;c++){var d=this.children[c].getObjectByProperty(a,
b);if(void 0!==d)return d}},getWorldPosition:function(a){a=a||new THREE.Vector3;this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){c=c||new THREE.Quaternion;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,b);return c}}(),getWorldRotation:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Euler;this.getWorldQuaternion(a);return b.setFromQuaternion(a,
this.rotation.order,!1)}}(),getWorldScale:function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(c){c=c||new THREE.Vector3;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,b,c);return c}}(),getWorldDirection:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=this.children,c=0,e=b.length;c<e;c++)b[c].traverse(a)},traverseVisible:function(a){if(!1!==
this.visible){a(this);for(var b=this.children,c=0,e=b.length;c<e;c++)b[c].traverseVisible(a)}},traverseAncestors:function(a){var b=this.parent;null!==b&&(a(b),b.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,
this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},toJSON:function(a){function b(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var c=void 0===a||""===a,e={};c&&(a={geometries:{},materials:{},textures:{},images:{}},e.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var d={};d.uuid=this.uuid;d.type=this.type;""!==this.name&&(d.name=this.name);"{}"!==JSON.stringify(this.userData)&&
(d.userData=this.userData);!0===this.castShadow&&(d.castShadow=!0);!0===this.receiveShadow&&(d.receiveShadow=!0);!1===this.visible&&(d.visible=!1);d.matrix=this.matrix.toArray();void 0!==this.geometry&&(void 0===a.geometries[this.geometry.uuid]&&(a.geometries[this.geometry.uuid]=this.geometry.toJSON(a)),d.geometry=this.geometry.uuid);void 0!==this.material&&(void 0===a.materials[this.material.uuid]&&(a.materials[this.material.uuid]=this.material.toJSON(a)),d.material=this.material.uuid);if(0<this.children.length){d.children=
[];for(var g=0;g<this.children.length;g++)d.children.push(this.children[g].toJSON(a).object)}if(c){var c=b(a.geometries),g=b(a.materials),f=b(a.textures);a=b(a.images);0<c.length&&(e.geometries=c);0<g.length&&(e.materials=g);0<f.length&&(e.textures=f);0<a.length&&(e.images=a)}e.object=d;return e},clone:function(a){return(new this.constructor).copy(this,a)},copy:function(a,b){void 0===b&&(b=!0);this.name=a.name;this.up.copy(a.up);this.position.copy(a.position);this.quaternion.copy(a.quaternion);this.scale.copy(a.scale);
this.matrix.copy(a.matrix);this.matrixWorld.copy(a.matrixWorld);this.matrixAutoUpdate=a.matrixAutoUpdate;this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;this.visible=a.visible;this.castShadow=a.castShadow;this.receiveShadow=a.receiveShadow;this.frustumCulled=a.frustumCulled;this.renderOrder=a.renderOrder;this.userData=JSON.parse(JSON.stringify(a.userData));if(!0===b)for(var c=0;c<a.children.length;c++)this.add(a.children[c].clone());return this}});THREE.Object3DIdCount=0;
THREE.Face3=function(a,b,c,e,d,g){this.a=a;this.b=b;this.c=c;this.normal=e instanceof THREE.Vector3?e:new THREE.Vector3;this.vertexNormals=Array.isArray(e)?e:[];this.color=d instanceof THREE.Color?d:new THREE.Color;this.vertexColors=Array.isArray(d)?d:[];this.materialIndex=void 0!==g?g:0};
THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a=a.a;this.b=a.b;this.c=a.c;this.normal.copy(a.normal);this.color.copy(a.color);this.materialIndex=a.materialIndex;for(var b=0,c=a.vertexNormals.length;b<c;b++)this.vertexNormals[b]=a.vertexNormals[b].clone();b=0;for(c=a.vertexColors.length;b<c;b++)this.vertexColors[b]=a.vertexColors[b].clone();return this}};
THREE.BufferAttribute=function(a,b,c){this.uuid=THREE.Math.generateUUID();this.array=a;this.itemSize=b;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0;this.normalized=!0===c};
THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get count(){return this.array.length/this.itemSize},set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.itemSize=a.itemSize;this.dynamic=a.dynamic;return this},copyAt:function(a,b,c){a*=this.itemSize;c*=b.itemSize;for(var e=0,d=this.itemSize;e<d;e++)this.array[a+e]=b.array[c+e];return this},copyArray:function(a){this.array.set(a);
return this},copyColorsArray:function(a){for(var b=this.array,c=0,e=0,d=a.length;e<d;e++){var g=a[e];void 0===g&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",e),g=new THREE.Color);b[c++]=g.r;b[c++]=g.g;b[c++]=g.b}return this},copyIndicesArray:function(a){for(var b=this.array,c=0,e=0,d=a.length;e<d;e++){var g=a[e];b[c++]=g.a;b[c++]=g.b;b[c++]=g.c}return this},copyVector2sArray:function(a){for(var b=this.array,c=0,e=0,d=a.length;e<d;e++){var g=a[e];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",
e),g=new THREE.Vector2);b[c++]=g.x;b[c++]=g.y}return this},copyVector3sArray:function(a){for(var b=this.array,c=0,e=0,d=a.length;e<d;e++){var g=a[e];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",e),g=new THREE.Vector3);b[c++]=g.x;b[c++]=g.y;b[c++]=g.z}return this},copyVector4sArray:function(a){for(var b=this.array,c=0,e=0,d=a.length;e<d;e++){var g=a[e];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",e),g=new THREE.Vector4);
b[c++]=g.x;b[c++]=g.y;b[c++]=g.z;b[c++]=g.w}return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},getX:function(a){return this.array[a*this.itemSize]},setX:function(a,b){this.array[a*this.itemSize]=b;return this},getY:function(a){return this.array[a*this.itemSize+1]},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},getZ:function(a){return this.array[a*this.itemSize+2]},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},getW:function(a){return this.array[a*
this.itemSize+3]},setW:function(a,b){this.array[a*this.itemSize+3]=b;return this},setXY:function(a,b,c){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;return this},setXYZ:function(a,b,c,e){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=e;return this},setXYZW:function(a,b,c,e,d){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=e;this.array[a+3]=d;return this},clone:function(){return(new this.constructor).copy(this)}};
THREE.Int8Attribute=function(a,b){return new THREE.BufferAttribute(new Int8Array(a),b)};THREE.Uint8Attribute=function(a,b){return new THREE.BufferAttribute(new Uint8Array(a),b)};THREE.Uint8ClampedAttribute=function(a,b){return new THREE.BufferAttribute(new Uint8ClampedArray(a),b)};THREE.Int16Attribute=function(a,b){return new THREE.BufferAttribute(new Int16Array(a),b)};THREE.Uint16Attribute=function(a,b){return new THREE.BufferAttribute(new Uint16Array(a),b)};
THREE.Int32Attribute=function(a,b){return new THREE.BufferAttribute(new Int32Array(a),b)};THREE.Uint32Attribute=function(a,b){return new THREE.BufferAttribute(new Uint32Array(a),b)};THREE.Float32Attribute=function(a,b){return new THREE.BufferAttribute(new Float32Array(a),b)};THREE.Float64Attribute=function(a,b){return new THREE.BufferAttribute(new Float64Array(a),b)};
THREE.DynamicBufferAttribute=function(a,b){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");return(new THREE.BufferAttribute(a,b)).setDynamic(!0)};THREE.InstancedBufferAttribute=function(a,b,c){THREE.BufferAttribute.call(this,a,b);this.meshPerAttribute=c||1};THREE.InstancedBufferAttribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.InstancedBufferAttribute.prototype.constructor=THREE.InstancedBufferAttribute;
THREE.InstancedBufferAttribute.prototype.copy=function(a){THREE.BufferAttribute.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};THREE.InterleavedBuffer=function(a,b){this.uuid=THREE.Math.generateUUID();this.array=a;this.stride=b;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0};
THREE.InterleavedBuffer.prototype={constructor:THREE.InterleavedBuffer,get length(){return this.array.length},get count(){return this.array.length/this.stride},set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.stride=a.stride;this.dynamic=a.dynamic;return this},copyAt:function(a,b,c){a*=this.stride;c*=b.stride;for(var e=0,d=this.stride;e<d;e++)this.array[a+e]=b.array[c+e];return this},set:function(a,
b){void 0===b&&(b=0);this.array.set(a,b);return this},clone:function(){return(new this.constructor).copy(this)}};THREE.InstancedInterleavedBuffer=function(a,b,c){THREE.InterleavedBuffer.call(this,a,b);this.meshPerAttribute=c||1};THREE.InstancedInterleavedBuffer.prototype=Object.create(THREE.InterleavedBuffer.prototype);THREE.InstancedInterleavedBuffer.prototype.constructor=THREE.InstancedInterleavedBuffer;
THREE.InstancedInterleavedBuffer.prototype.copy=function(a){THREE.InterleavedBuffer.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};THREE.InterleavedBufferAttribute=function(a,b,c,e){this.uuid=THREE.Math.generateUUID();this.data=a;this.itemSize=b;this.offset=c;this.normalized=!0===e};
THREE.InterleavedBufferAttribute.prototype={constructor:THREE.InterleavedBufferAttribute,get length(){console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count.");return this.array.length},get count(){return this.data.count},get array(){return this.data.array},setX:function(a,b){this.data.array[a*this.data.stride+this.offset]=b;return this},setY:function(a,b){this.data.array[a*this.data.stride+this.offset+1]=b;return this},setZ:function(a,b){this.data.array[a*this.data.stride+
this.offset+2]=b;return this},setW:function(a,b){this.data.array[a*this.data.stride+this.offset+3]=b;return this},getX:function(a){return this.data.array[a*this.data.stride+this.offset]},getY:function(a){return this.data.array[a*this.data.stride+this.offset+1]},getZ:function(a){return this.data.array[a*this.data.stride+this.offset+2]},getW:function(a){return this.data.array[a*this.data.stride+this.offset+3]},setXY:function(a,b,c){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+
1]=c;return this},setXYZ:function(a,b,c,e){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=e;return this},setXYZW:function(a,b,c,e,d){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=e;this.data.array[a+3]=d;return this}};
THREE.Geometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=
this.elementsNeedUpdate=!1};
Object.assign(THREE.Geometry.prototype,THREE.EventDispatcher.prototype,{applyMatrix:function(a){for(var b=(new THREE.Matrix3).getNormalMatrix(a),c=0,e=this.vertices.length;c<e;c++)this.vertices[c].applyMatrix4(a);c=0;for(e=this.faces.length;c<e;c++){a=this.faces[c];a.normal.applyMatrix3(b).normalize();for(var d=0,g=a.vertexNormals.length;d<g;d++)a.vertexNormals[d].applyMatrix3(b).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();
this.normalsNeedUpdate=this.verticesNeedUpdate=!0;return this},rotateX:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationX(b);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationY(b);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(b,
c,e){void 0===a&&(a=new THREE.Matrix4);a.makeTranslation(b,c,e);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(b,c,e){void 0===a&&(a=new THREE.Matrix4);a.makeScale(b,c,e);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(b){void 0===a&&(a=new THREE.Object3D);a.lookAt(b);a.updateMatrix();this.applyMatrix(a.matrix)}}(),fromBufferGeometry:function(a){function b(a,b,d,e){var g=void 0!==f?[n[a].clone(),n[b].clone(),n[d].clone()]:[],p=void 0!==h?[c.colors[a].clone(),
c.colors[b].clone(),c.colors[d].clone()]:[];e=new THREE.Face3(a,b,d,g,p,e);c.faces.push(e);void 0!==k&&c.faceVertexUvs[0].push([q[a].clone(),q[b].clone(),q[d].clone()]);void 0!==l&&c.faceVertexUvs[1].push([m[a].clone(),m[b].clone(),m[d].clone()])}var c=this,e=null!==a.index?a.index.array:void 0,d=a.attributes,g=d.position.array,f=void 0!==d.normal?d.normal.array:void 0,h=void 0!==d.color?d.color.array:void 0,k=void 0!==d.uv?d.uv.array:void 0,l=void 0!==d.uv2?d.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=
[]);for(var n=[],q=[],m=[],p=d=0;d<g.length;d+=3,p+=2)c.vertices.push(new THREE.Vector3(g[d],g[d+1],g[d+2])),void 0!==f&&n.push(new THREE.Vector3(f[d],f[d+1],f[d+2])),void 0!==h&&c.colors.push(new THREE.Color(h[d],h[d+1],h[d+2])),void 0!==k&&q.push(new THREE.Vector2(k[p],k[p+1])),void 0!==l&&m.push(new THREE.Vector2(l[p],l[p+1]));if(void 0!==e)if(g=a.groups,0<g.length)for(d=0;d<g.length;d++)for(var r=g[d],t=r.start,w=r.count,p=t,t=t+w;p<t;p+=3)b(e[p],e[p+1],e[p+2],r.materialIndex);else for(d=0;d<
e.length;d+=3)b(e[d],e[d+1],e[d+2]);else for(d=0;d<g.length/3;d+=3)b(d,d+1,d+2);this.computeFaceNormals();null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());return this},center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.translate(a.x,a.y,a.z);return a},normalize:function(){this.computeBoundingSphere();var a=this.boundingSphere.center,b=this.boundingSphere.radius,b=0===b?1:1/
b,c=new THREE.Matrix4;c.set(b,0,0,-b*a.x,0,b,0,-b*a.y,0,0,b,-b*a.z,0,0,0,1);this.applyMatrix(c);return this},computeFaceNormals:function(){for(var a=new THREE.Vector3,b=new THREE.Vector3,c=0,e=this.faces.length;c<e;c++){var d=this.faces[c],g=this.vertices[d.a],f=this.vertices[d.b];a.subVectors(this.vertices[d.c],f);b.subVectors(g,f);a.cross(b);a.normalize();d.normal.copy(a)}},computeVertexNormals:function(a){void 0===a&&(a=!0);var b,c,e;e=Array(this.vertices.length);b=0;for(c=this.vertices.length;b<
c;b++)e[b]=new THREE.Vector3;if(a){var d,g,f,h=new THREE.Vector3,k=new THREE.Vector3;a=0;for(b=this.faces.length;a<b;a++)c=this.faces[a],d=this.vertices[c.a],g=this.vertices[c.b],f=this.vertices[c.c],h.subVectors(f,g),k.subVectors(d,g),h.cross(k),e[c.a].add(h),e[c.b].add(h),e[c.c].add(h)}else for(a=0,b=this.faces.length;a<b;a++)c=this.faces[a],e[c.a].add(c.normal),e[c.b].add(c.normal),e[c.c].add(c.normal);b=0;for(c=this.vertices.length;b<c;b++)e[b].normalize();a=0;for(b=this.faces.length;a<b;a++)c=
this.faces[a],d=c.vertexNormals,3===d.length?(d[0].copy(e[c.a]),d[1].copy(e[c.b]),d[2].copy(e[c.c])):(d[0]=e[c.a].clone(),d[1]=e[c.b].clone(),d[2]=e[c.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var a,b,c,e,d;c=0;for(e=this.faces.length;c<e;c++)for(d=this.faces[c],d.__originalFaceNormal?d.__originalFaceNormal.copy(d.normal):d.__originalFaceNormal=d.normal.clone(),d.__originalVertexNormals||(d.__originalVertexNormals=[]),a=0,b=d.vertexNormals.length;a<
b;a++)d.__originalVertexNormals[a]?d.__originalVertexNormals[a].copy(d.vertexNormals[a]):d.__originalVertexNormals[a]=d.vertexNormals[a].clone();var g=new THREE.Geometry;g.faces=this.faces;a=0;for(b=this.morphTargets.length;a<b;a++){if(!this.morphNormals[a]){this.morphNormals[a]={};this.morphNormals[a].faceNormals=[];this.morphNormals[a].vertexNormals=[];d=this.morphNormals[a].faceNormals;var f=this.morphNormals[a].vertexNormals,h,k;c=0;for(e=this.faces.length;c<e;c++)h=new THREE.Vector3,k={a:new THREE.Vector3,
b:new THREE.Vector3,c:new THREE.Vector3},d.push(h),f.push(k)}f=this.morphNormals[a];g.vertices=this.morphTargets[a].vertices;g.computeFaceNormals();g.computeVertexNormals();c=0;for(e=this.faces.length;c<e;c++)d=this.faces[c],h=f.faceNormals[c],k=f.vertexNormals[c],h.copy(d.normal),k.a.copy(d.vertexNormals[0]),k.b.copy(d.vertexNormals[1]),k.c.copy(d.vertexNormals[2])}c=0;for(e=this.faces.length;c<e;c++)d=this.faces[c],d.normal=d.__originalFaceNormal,d.vertexNormals=d.__originalVertexNormals},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},
computeLineDistances:function(){for(var a=0,b=this.vertices,c=0,e=b.length;c<e;c++)0<c&&(a+=b[c].distanceTo(b[c-1])),this.lineDistances[c]=a},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,b,c){if(!1===a instanceof THREE.Geometry)console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",
a);else{var e,d=this.vertices.length,g=this.vertices,f=a.vertices,h=this.faces,k=a.faces,l=this.faceVertexUvs[0];a=a.faceVertexUvs[0];void 0===c&&(c=0);void 0!==b&&(e=(new THREE.Matrix3).getNormalMatrix(b));for(var n=0,q=f.length;n<q;n++){var m=f[n].clone();void 0!==b&&m.applyMatrix4(b);g.push(m)}n=0;for(q=k.length;n<q;n++){var f=k[n],p,r=f.vertexNormals,t=f.vertexColors,m=new THREE.Face3(f.a+d,f.b+d,f.c+d);m.normal.copy(f.normal);void 0!==e&&m.normal.applyMatrix3(e).normalize();b=0;for(g=r.length;b<
g;b++)p=r[b].clone(),void 0!==e&&p.applyMatrix3(e).normalize(),m.vertexNormals.push(p);m.color.copy(f.color);b=0;for(g=t.length;b<g;b++)p=t[b],m.vertexColors.push(p.clone());m.materialIndex=f.materialIndex+c;h.push(m)}n=0;for(q=a.length;n<q;n++)if(c=a[n],e=[],void 0!==c){b=0;for(g=c.length;b<g;b++)e.push(c[b].clone());l.push(e)}}},mergeMesh:function(a){!1===a instanceof THREE.Mesh?console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",a):(a.matrixAutoUpdate&&a.updateMatrix(),
this.merge(a.geometry,a.matrix))},mergeVertices:function(){var a={},b=[],c=[],e,d=Math.pow(10,4),g,f;g=0;for(f=this.vertices.length;g<f;g++)e=this.vertices[g],e=Math.round(e.x*d)+"_"+Math.round(e.y*d)+"_"+Math.round(e.z*d),void 0===a[e]?(a[e]=g,b.push(this.vertices[g]),c[g]=b.length-1):c[g]=c[a[e]];a=[];g=0;for(f=this.faces.length;g<f;g++)for(d=this.faces[g],d.a=c[d.a],d.b=c[d.b],d.c=c[d.c],d=[d.a,d.b,d.c],e=0;3>e;e++)if(d[e]===d[(e+1)%3]){a.push(g);break}for(g=a.length-1;0<=g;g--)for(d=a[g],this.faces.splice(d,
1),c=0,f=this.faceVertexUvs.length;c<f;c++)this.faceVertexUvs[c].splice(d,1);g=this.vertices.length-b.length;this.vertices=b;return g},sortFacesByMaterialIndex:function(){for(var a=this.faces,b=a.length,c=0;c<b;c++)a[c]._id=c;a.sort(function(a,b){return a.materialIndex-b.materialIndex});var e=this.faceVertexUvs[0],d=this.faceVertexUvs[1],g,f;e&&e.length===b&&(g=[]);d&&d.length===b&&(f=[]);for(c=0;c<b;c++){var h=a[c]._id;g&&g.push(e[h]);f&&f.push(d[h])}g&&(this.faceVertexUvs[0]=g);f&&(this.faceVertexUvs[1]=
f)},toJSON:function(){function a(a,b,c){return c?a|1<<b:a&~(1<<b)}function b(a){var b=a.x.toString()+a.y.toString()+a.z.toString();if(void 0!==l[b])return l[b];l[b]=k.length/3;k.push(a.x,a.y,a.z);return l[b]}function c(a){var b=a.r.toString()+a.g.toString()+a.b.toString();if(void 0!==q[b])return q[b];q[b]=n.length;n.push(a.getHex());return q[b]}function e(a){var b=a.x.toString()+a.y.toString();if(void 0!==p[b])return p[b];p[b]=m.length/2;m.push(a.x,a.y);return p[b]}var d={metadata:{version:4.4,type:"Geometry",
generator:"Geometry.toJSON"}};d.uuid=this.uuid;d.type=this.type;""!==this.name&&(d.name=this.name);if(void 0!==this.parameters){var g=this.parameters,f;for(f in g)void 0!==g[f]&&(d[f]=g[f]);return d}g=[];for(f=0;f<this.vertices.length;f++){var h=this.vertices[f];g.push(h.x,h.y,h.z)}var h=[],k=[],l={},n=[],q={},m=[],p={};for(f=0;f<this.faces.length;f++){var r=this.faces[f],t=void 0!==this.faceVertexUvs[0][f],w=0<r.normal.length(),v=0<r.vertexNormals.length,u=1!==r.color.r||1!==r.color.g||1!==r.color.b,
z=0<r.vertexColors.length,x=0,x=a(x,0,0),x=a(x,1,!0),x=a(x,2,!1),x=a(x,3,t),x=a(x,4,w),x=a(x,5,v),x=a(x,6,u),x=a(x,7,z);h.push(x);h.push(r.a,r.b,r.c);h.push(r.materialIndex);t&&(t=this.faceVertexUvs[0][f],h.push(e(t[0]),e(t[1]),e(t[2])));w&&h.push(b(r.normal));v&&(w=r.vertexNormals,h.push(b(w[0]),b(w[1]),b(w[2])));u&&h.push(c(r.color));z&&(r=r.vertexColors,h.push(c(r[0]),c(r[1]),c(r[2])))}d.data={};d.data.vertices=g;d.data.normals=k;0<n.length&&(d.data.colors=n);0<m.length&&(d.data.uvs=[m]);d.data.faces=
h;return d},clone:function(){return(new THREE.Geometry).copy(this)},copy:function(a){this.vertices=[];this.faces=[];this.faceVertexUvs=[[]];for(var b=a.vertices,c=0,e=b.length;c<e;c++)this.vertices.push(b[c].clone());b=a.faces;c=0;for(e=b.length;c<e;c++)this.faces.push(b[c].clone());c=0;for(e=a.faceVertexUvs.length;c<e;c++){b=a.faceVertexUvs[c];void 0===this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]);for(var d=0,g=b.length;d<g;d++){for(var f=b[d],h=[],k=0,l=f.length;k<l;k++)h.push(f[k].clone());
this.faceVertexUvs[c].push(h)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});THREE.GeometryIdCount=0;
THREE.DirectGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="DirectGeometry";this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1};
Object.assign(THREE.DirectGeometry.prototype,THREE.EventDispatcher.prototype,{computeBoundingBox:THREE.Geometry.prototype.computeBoundingBox,computeBoundingSphere:THREE.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},computeGroups:function(a){var b,
c=[],e;a=a.faces;for(var d=0;d<a.length;d++){var g=a[d];g.materialIndex!==e&&(e=g.materialIndex,void 0!==b&&(b.count=3*d-b.start,c.push(b)),b={start:3*d,materialIndex:e})}void 0!==b&&(b.count=3*d-b.start,c.push(b));this.groups=c},fromGeometry:function(a){var b=a.faces,c=a.vertices,e=a.faceVertexUvs,d=e[0]&&0<e[0].length,g=e[1]&&0<e[1].length,f=a.morphTargets,h=f.length,k;if(0<h){k=[];for(var l=0;l<h;l++)k[l]=[];this.morphTargets.position=k}var n=a.morphNormals,q=n.length,m;if(0<q){m=[];for(l=0;l<
q;l++)m[l]=[];this.morphTargets.normal=m}for(var p=a.skinIndices,r=a.skinWeights,t=p.length===c.length,w=r.length===c.length,l=0;l<b.length;l++){var v=b[l];this.vertices.push(c[v.a],c[v.b],c[v.c]);var u=v.vertexNormals;3===u.length?this.normals.push(u[0],u[1],u[2]):(u=v.normal,this.normals.push(u,u,u));u=v.vertexColors;3===u.length?this.colors.push(u[0],u[1],u[2]):(u=v.color,this.colors.push(u,u,u));!0===d&&(u=e[0][l],void 0!==u?this.uvs.push(u[0],u[1],u[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",
l),this.uvs.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2)));!0===g&&(u=e[1][l],void 0!==u?this.uvs2.push(u[0],u[1],u[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",l),this.uvs2.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2)));for(u=0;u<h;u++){var z=f[u].vertices;k[u].push(z[v.a],z[v.b],z[v.c])}for(u=0;u<q;u++)z=n[u].vertexNormals[l],m[u].push(z.a,z.b,z.c);t&&this.skinIndices.push(p[v.a],p[v.b],p[v.c]);w&&this.skinWeights.push(r[v.a],r[v.b],
r[v.c])}this.computeGroups(a);this.verticesNeedUpdate=a.verticesNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=a.colorsNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});
THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity}};
Object.assign(THREE.BufferGeometry.prototype,THREE.EventDispatcher.prototype,{getIndex:function(){return this.index},setIndex:function(a){this.index=a},addAttribute:function(a,b,c){if(!1===b instanceof THREE.BufferAttribute&&!1===b instanceof THREE.InterleavedBufferAttribute)console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(a,new THREE.BufferAttribute(b,c));else if("index"===a)console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),
this.setIndex(b);else return this.attributes[a]=b,this},getAttribute:function(a){return this.attributes[a]},removeAttribute:function(a){delete this.attributes[a];return this},addGroup:function(a,b,c){this.groups.push({start:a,count:b,materialIndex:void 0!==c?c:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(a,b){this.drawRange.start=a;this.drawRange.count=b},applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),b.needsUpdate=!0);b=this.attributes.normal;
void 0!==b&&((new THREE.Matrix3).getNormalMatrix(a).applyToVector3Array(b.array),b.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return this},rotateX:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationX(b);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationY(b);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;
return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(b,c,e){void 0===a&&(a=new THREE.Matrix4);a.makeTranslation(b,c,e);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(b,c,e){void 0===a&&(a=new THREE.Matrix4);a.makeScale(b,c,e);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(b){void 0===a&&(a=new THREE.Object3D);a.lookAt(b);a.updateMatrix();this.applyMatrix(a.matrix)}}(),
center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.translate(a.x,a.y,a.z);return a},setFromObject:function(a){var b=a.geometry;if(a instanceof THREE.Points||a instanceof THREE.Line){a=new THREE.Float32Attribute(3*b.vertices.length,3);var c=new THREE.Float32Attribute(3*b.colors.length,3);this.addAttribute("position",a.copyVector3sArray(b.vertices));this.addAttribute("color",c.copyColorsArray(b.colors));b.lineDistances&&b.lineDistances.length===b.vertices.length&&
(a=new THREE.Float32Attribute(b.lineDistances.length,1),this.addAttribute("lineDistance",a.copyArray(b.lineDistances)));null!==b.boundingSphere&&(this.boundingSphere=b.boundingSphere.clone());null!==b.boundingBox&&(this.boundingBox=b.boundingBox.clone())}else a instanceof THREE.Mesh&&b instanceof THREE.Geometry&&this.fromGeometry(b);return this},updateFromObject:function(a){var b=a.geometry;if(a instanceof THREE.Mesh){var c=b.__directGeometry;if(void 0===c||!0===b.elementsNeedUpdate)return this.fromGeometry(b);
c.verticesNeedUpdate=b.verticesNeedUpdate||b.elementsNeedUpdate;c.normalsNeedUpdate=b.normalsNeedUpdate||b.elementsNeedUpdate;c.colorsNeedUpdate=b.colorsNeedUpdate||b.elementsNeedUpdate;c.uvsNeedUpdate=b.uvsNeedUpdate||b.elementsNeedUpdate;c.groupsNeedUpdate=b.groupsNeedUpdate||b.elementsNeedUpdate;b.elementsNeedUpdate=!1;b.verticesNeedUpdate=!1;b.normalsNeedUpdate=!1;b.colorsNeedUpdate=!1;b.uvsNeedUpdate=!1;b.groupsNeedUpdate=!1;b=c}!0===b.verticesNeedUpdate&&(c=this.attributes.position,void 0!==
c&&(c.copyVector3sArray(b.vertices),c.needsUpdate=!0),b.verticesNeedUpdate=!1);!0===b.normalsNeedUpdate&&(c=this.attributes.normal,void 0!==c&&(c.copyVector3sArray(b.normals),c.needsUpdate=!0),b.normalsNeedUpdate=!1);!0===b.colorsNeedUpdate&&(c=this.attributes.color,void 0!==c&&(c.copyColorsArray(b.colors),c.needsUpdate=!0),b.colorsNeedUpdate=!1);b.uvsNeedUpdate&&(c=this.attributes.uv,void 0!==c&&(c.copyVector2sArray(b.uvs),c.needsUpdate=!0),b.uvsNeedUpdate=!1);b.lineDistancesNeedUpdate&&(c=this.attributes.lineDistance,
void 0!==c&&(c.copyArray(b.lineDistances),c.needsUpdate=!0),b.lineDistancesNeedUpdate=!1);b.groupsNeedUpdate&&(b.computeGroups(a.geometry),this.groups=b.groups,b.groupsNeedUpdate=!1);return this},fromGeometry:function(a){a.__directGeometry=(new THREE.DirectGeometry).fromGeometry(a);return this.fromDirectGeometry(a.__directGeometry)},fromDirectGeometry:function(a){var b=new Float32Array(3*a.vertices.length);this.addAttribute("position",(new THREE.BufferAttribute(b,3)).copyVector3sArray(a.vertices));
0<a.normals.length&&(b=new Float32Array(3*a.normals.length),this.addAttribute("normal",(new THREE.BufferAttribute(b,3)).copyVector3sArray(a.normals)));0<a.colors.length&&(b=new Float32Array(3*a.colors.length),this.addAttribute("color",(new THREE.BufferAttribute(b,3)).copyColorsArray(a.colors)));0<a.uvs.length&&(b=new Float32Array(2*a.uvs.length),this.addAttribute("uv",(new THREE.BufferAttribute(b,2)).copyVector2sArray(a.uvs)));0<a.uvs2.length&&(b=new Float32Array(2*a.uvs2.length),this.addAttribute("uv2",
(new THREE.BufferAttribute(b,2)).copyVector2sArray(a.uvs2)));0<a.indices.length&&(b=new (65535<a.vertices.length?Uint32Array:Uint16Array)(3*a.indices.length),this.setIndex((new THREE.BufferAttribute(b,1)).copyIndicesArray(a.indices)));this.groups=a.groups;for(var c in a.morphTargets){for(var b=[],e=a.morphTargets[c],d=0,g=e.length;d<g;d++){var f=e[d],h=new THREE.Float32Attribute(3*f.length,3);b.push(h.copyVector3sArray(f))}this.morphAttributes[c]=b}0<a.skinIndices.length&&(c=new THREE.Float32Attribute(4*
a.skinIndices.length,4),this.addAttribute("skinIndex",c.copyVector4sArray(a.skinIndices)));0<a.skinWeights.length&&(c=new THREE.Float32Attribute(4*a.skinWeights.length,4),this.addAttribute("skinWeight",c.copyVector4sArray(a.skinWeights)));null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());return this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var a=this.attributes.position.array;
void 0!==a?this.boundingBox.setFromArray(a):this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var a=new THREE.Box3,b=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var c=this.attributes.position;
if(c){var c=c.array,e=this.boundingSphere.center;a.setFromArray(c);a.center(e);for(var d=0,g=0,f=c.length;g<f;g+=3)b.fromArray(c,g),d=Math.max(d,e.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(d);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var a=this.index,b=this.attributes,c=this.groups;
if(b.position){var e=b.position.array;if(void 0===b.normal)this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(e.length),3));else for(var d=b.normal.array,g=0,f=d.length;g<f;g++)d[g]=0;var d=b.normal.array,h,k,l,n=new THREE.Vector3,q=new THREE.Vector3,m=new THREE.Vector3,p=new THREE.Vector3,r=new THREE.Vector3;if(a){a=a.array;0===c.length&&this.addGroup(0,a.length);for(var t=0,w=c.length;t<w;++t)for(g=c[t],f=g.start,h=g.count,g=f,f+=h;g<f;g+=3)h=3*a[g+0],k=3*a[g+1],l=3*a[g+2],n.fromArray(e,
h),q.fromArray(e,k),m.fromArray(e,l),p.subVectors(m,q),r.subVectors(n,q),p.cross(r),d[h]+=p.x,d[h+1]+=p.y,d[h+2]+=p.z,d[k]+=p.x,d[k+1]+=p.y,d[k+2]+=p.z,d[l]+=p.x,d[l+1]+=p.y,d[l+2]+=p.z}else for(g=0,f=e.length;g<f;g+=9)n.fromArray(e,g),q.fromArray(e,g+3),m.fromArray(e,g+6),p.subVectors(m,q),r.subVectors(n,q),p.cross(r),d[g]=p.x,d[g+1]=p.y,d[g+2]=p.z,d[g+3]=p.x,d[g+4]=p.y,d[g+5]=p.z,d[g+6]=p.x,d[g+7]=p.y,d[g+8]=p.z;this.normalizeNormals();b.normal.needsUpdate=!0}},merge:function(a,b){if(!1===a instanceof
THREE.BufferGeometry)console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",a);else{void 0===b&&(b=0);var c=this.attributes,e;for(e in c)if(void 0!==a.attributes[e])for(var d=c[e].array,g=a.attributes[e],f=g.array,h=0,g=g.itemSize*b;h<f.length;h++,g++)d[g]=f[h];return this}},normalizeNormals:function(){for(var a=this.attributes.normal.array,b,c,e,d=0,g=a.length;d<g;d+=3)b=a[d],c=a[d+1],e=a[d+2],b=1/Math.sqrt(b*b+c*c+e*e),a[d]*=b,a[d+1]*=b,a[d+2]*=b},toNonIndexed:function(){if(null===
this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var a=new THREE.BufferGeometry,b=this.index.array,c=this.attributes,e;for(e in c){for(var d=c[e],g=d.array,d=d.itemSize,f=new g.constructor(b.length*d),h,k=0,l=0,n=b.length;l<n;l++){h=b[l]*d;for(var q=0;q<d;q++)f[k++]=g[h++]}a.addAttribute(e,new THREE.BufferAttribute(f,d))}return a},toJSON:function(){var a={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};a.uuid=
this.uuid;a.type=this.type;""!==this.name&&(a.name=this.name);if(void 0!==this.parameters){var b=this.parameters,c;for(c in b)void 0!==b[c]&&(a[c]=b[c]);return a}a.data={attributes:{}};var e=this.index;null!==e&&(b=Array.prototype.slice.call(e.array),a.data.index={type:e.array.constructor.name,array:b});e=this.attributes;for(c in e){var d=e[c],b=Array.prototype.slice.call(d.array);a.data.attributes[c]={itemSize:d.itemSize,type:d.array.constructor.name,array:b,normalized:d.normalized}}c=this.groups;
0<c.length&&(a.data.groups=JSON.parse(JSON.stringify(c)));c=this.boundingSphere;null!==c&&(a.data.boundingSphere={center:c.center.toArray(),radius:c.radius});return a},clone:function(){return(new THREE.BufferGeometry).copy(this)},copy:function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var b=a.attributes,c;for(c in b)this.addAttribute(c,b[c].clone());a=a.groups;c=0;for(b=a.length;c<b;c++){var e=a[c];this.addGroup(e.start,e.count,e.materialIndex)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});
THREE.BufferGeometry.MaxIndex=65535;THREE.InstancedBufferGeometry=function(){THREE.BufferGeometry.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=void 0};THREE.InstancedBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.InstancedBufferGeometry.prototype.constructor=THREE.InstancedBufferGeometry;THREE.InstancedBufferGeometry.prototype.addGroup=function(a,b,c){this.groups.push({start:a,count:b,instances:c})};
THREE.InstancedBufferGeometry.prototype.copy=function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var b=a.attributes,c;for(c in b)this.addAttribute(c,b[c].clone());a=a.groups;c=0;for(b=a.length;c<b;c++){var e=a[c];this.addGroup(e.start,e.count,e.instances)}return this};THREE.Uniform=function(a,b){"string"===typeof a&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),a=b);this.value=a;this.dynamic=!1};
THREE.Uniform.prototype={constructor:THREE.Uniform,onUpdate:function(a){this.dynamic=!0;this.onUpdateCallback=a;return this}};THREE.AnimationAction=function(){throw Error("THREE.AnimationAction: Use mixer.clipAction for construction.");};
THREE.AnimationAction._new=function(a,b,c){this._mixer=a;this._clip=b;this._localRoot=c||null;a=b.tracks;b=a.length;c=Array(b);for(var e={endingStart:THREE.ZeroCurvatureEnding,endingEnd:THREE.ZeroCurvatureEnding},d=0;d!==b;++d){var g=a[d].createInterpolant(null);c[d]=g;g.settings=e}this._interpolantSettings=e;this._interpolants=c;this._propertyBindings=Array(b);this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null;this.loop=THREE.LoopRepeat;this._loopCount=
-1;this._startTime=null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0};
THREE.AnimationAction._new.prototype={constructor:THREE.AnimationAction._new,play:function(){this._mixer._activateAction(this);return this},stop:function(){this._mixer._deactivateAction(this);return this.reset()},reset:function(){this.paused=!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},
startAt:function(a){this._startTime=a;return this},setLoop:function(a,b){this.loop=a;this.repetitions=b;return this},setEffectiveWeight:function(a){this.weight=a;this._effectiveWeight=this.enabled?a:0;return this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(a){return this._scheduleFading(a,0,1)},fadeOut:function(a){return this._scheduleFading(a,1,0)},crossFadeFrom:function(a,b,c){a.fadeOut(b);this.fadeIn(b);if(c){c=this._clip.duration;var e=a._clip.duration,
d=c/e;a.warp(1,e/c,b);this.warp(d,1,b)}return this},crossFadeTo:function(a,b,c){return a.crossFadeFrom(this,b,c)},stopFading:function(){var a=this._weightInterpolant;null!==a&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},setEffectiveTimeScale:function(a){this.timeScale=a;this._effectiveTimeScale=this.paused?0:a;return this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(a){this.timeScale=this._clip.duration/
a;return this.stopWarping()},syncWith:function(a){this.time=a.time;this.timeScale=a.timeScale;return this.stopWarping()},halt:function(a){return this.warp(this._effectiveTimeScale,0,a)},warp:function(a,b,c){var e=this._mixer,d=e.time,g=this._timeScaleInterpolant,f=this.timeScale;null===g&&(this._timeScaleInterpolant=g=e._lendControlInterpolant());e=g.parameterPositions;g=g.sampleValues;e[0]=d;e[1]=d+c;g[0]=a/f;g[1]=b/f;return this},stopWarping:function(){var a=this._timeScaleInterpolant;null!==a&&
(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(a,b,c,e){var d=this._startTime;if(null!==d){b=(a-d)*c;if(0>b||0===c)return;this._startTime=null;b*=c}b*=this._updateTimeScale(a);c=this._updateTime(b);a=this._updateWeight(a);if(0<a){b=this._interpolants;for(var d=this._propertyBindings,g=0,f=b.length;g!==
f;++g)b[g].evaluate(c),d[g].accumulate(e,a)}},_updateWeight:function(a){var b=0;if(this.enabled){var b=this.weight,c=this._weightInterpolant;if(null!==c){var e=c.evaluate(a)[0],b=b*e;a>c.parameterPositions[1]&&(this.stopFading(),0===e&&(this.enabled=!1))}}return this._effectiveWeight=b},_updateTimeScale:function(a){var b=0;if(!this.paused){var b=this.timeScale,c=this._timeScaleInterpolant;if(null!==c){var e=c.evaluate(a)[0],b=b*e;a>c.parameterPositions[1]&&(this.stopWarping(),0===b?this.paused=!0:
this.timeScale=b)}}return this._effectiveTimeScale=b},_updateTime:function(a){var b=this.time+a;if(0===a)return b;var c=this._clip.duration,e=this.loop,d=this._loopCount;if(e===THREE.LoopOnce)a:{if(-1===d&&(this.loopCount=0,this._setEndings(!0,!0,!1)),b>=c)b=c;else if(0>b)b=0;else break a;this.clampWhenFinished?this.paused=!0:this.enabled=!1;this._mixer.dispatchEvent({type:"finished",action:this,direction:0>a?-1:1})}else{e=e===THREE.LoopPingPong;-1===d&&(0<=a?(d=0,this._setEndings(!0,0===this.repetitions,
e)):this._setEndings(0===this.repetitions,!0,e));if(b>=c||0>b){var g=Math.floor(b/c),b=b-c*g,d=d+Math.abs(g),f=this.repetitions-d;0>f?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,b=0<a?c:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<a?1:-1})):(0===f?(a=0>a,this._setEndings(a,!a,e)):this._setEndings(!1,!1,e),this._loopCount=d,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:g}))}if(e&&1===(d&1))return this.time=b,c-b}return this.time=b},_setEndings:function(a,
b,c){var e=this._interpolantSettings;c?(e.endingStart=THREE.ZeroSlopeEnding,e.endingEnd=THREE.ZeroSlopeEnding):(e.endingStart=a?this.zeroSlopeAtStart?THREE.ZeroSlopeEnding:THREE.ZeroCurvatureEnding:THREE.WrapAroundEnding,e.endingEnd=b?this.zeroSlopeAtEnd?THREE.ZeroSlopeEnding:THREE.ZeroCurvatureEnding:THREE.WrapAroundEnding)},_scheduleFading:function(a,b,c){var e=this._mixer,d=e.time,g=this._weightInterpolant;null===g&&(this._weightInterpolant=g=e._lendControlInterpolant());e=g.parameterPositions;
g=g.sampleValues;e[0]=d;g[0]=b;e[1]=d+a;g[1]=c;return this}};THREE.AnimationClip=function(a,b,c){this.name=a;this.tracks=c;this.duration=void 0!==b?b:-1;this.uuid=THREE.Math.generateUUID();0>this.duration&&this.resetDuration();this.trim();this.optimize()};
THREE.AnimationClip.prototype={constructor:THREE.AnimationClip,resetDuration:function(){for(var a=0,b=0,c=this.tracks.length;b!==c;++b)var e=this.tracks[b],a=Math.max(a,e.times[e.times.length-1]);this.duration=a},trim:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this},optimize:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}};
Object.assign(THREE.AnimationClip,{parse:function(a){for(var b=[],c=a.tracks,e=1/(a.fps||1),d=0,g=c.length;d!==g;++d)b.push(THREE.KeyframeTrack.parse(c[d]).scale(e));return new THREE.AnimationClip(a.name,a.duration,b)},toJSON:function(a){var b=[],c=a.tracks;a={name:a.name,duration:a.duration,tracks:b};for(var e=0,d=c.length;e!==d;++e)b.push(THREE.KeyframeTrack.toJSON(c[e]));return a},CreateFromMorphTargetSequence:function(a,b,c,e){for(var d=b.length,g=[],f=0;f<d;f++){var h=[],k=[];h.push((f+d-1)%
d,f,(f+1)%d);k.push(0,1,0);var l=THREE.AnimationUtils.getKeyframeOrder(h),h=THREE.AnimationUtils.sortedArray(h,1,l),k=THREE.AnimationUtils.sortedArray(k,1,l);e||0!==h[0]||(h.push(d),k.push(k[0]));g.push((new THREE.NumberKeyframeTrack(".morphTargetInfluences["+b[f].name+"]",h,k)).scale(1/c))}return new THREE.AnimationClip(a,-1,g)},findByName:function(a,b){var c=a;Array.isArray(a)||(c=a.geometry&&a.geometry.animations||a.animations);for(var e=0;e<c.length;e++)if(c[e].name===b)return c[e];return null},
CreateClipsFromMorphTargetSequences:function(a,b,c){for(var e={},d=/^([\w-]*?)([\d]+)$/,g=0,f=a.length;g<f;g++){var h=a[g],k=h.name.match(d);if(k&&1<k.length){var l=k[1];(k=e[l])||(e[l]=k=[]);k.push(h)}}a=[];for(l in e)a.push(THREE.AnimationClip.CreateFromMorphTargetSequence(l,e[l],b,c));return a},parseAnimation:function(a,b,c){if(!a)return console.error("  no animation in JSONLoader data"),null;c=function(a,b,c,d,e){if(0!==c.length){var f=[],g=[];THREE.AnimationUtils.flattenJSON(c,f,g,d);0!==f.length&&
e.push(new a(b,f,g))}};var e=[],d=a.name||"default",g=a.length||-1,f=a.fps||30;a=a.hierarchy||[];for(var h=0;h<a.length;h++){var k=a[h].keys;if(k&&0!==k.length)if(k[0].morphTargets){for(var g={},l=0;l<k.length;l++)if(k[l].morphTargets)for(var n=0;n<k[l].morphTargets.length;n++)g[k[l].morphTargets[n]]=-1;for(var q in g){for(var m=[],p=[],n=0;n!==k[l].morphTargets.length;++n){var r=k[l];m.push(r.time);p.push(r.morphTarget===q?1:0)}e.push(new THREE.NumberKeyframeTrack(".morphTargetInfluence["+q+"]",
m,p))}g=g.length*(f||1)}else l=".bones["+b[h].name+"]",c(THREE.VectorKeyframeTrack,l+".position",k,"pos",e),c(THREE.QuaternionKeyframeTrack,l+".quaternion",k,"rot",e),c(THREE.VectorKeyframeTrack,l+".scale",k,"scl",e)}return 0===e.length?null:new THREE.AnimationClip(d,g,e)}});THREE.AnimationMixer=function(a){this._root=a;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1};
Object.assign(THREE.AnimationMixer.prototype,THREE.EventDispatcher.prototype,{clipAction:function(a,b){var c=b||this._root,e=c.uuid,d="string"===typeof a?THREE.AnimationClip.findByName(c,a):a,c=null!==d?d.uuid:a,g=this._actionsByClip[c],f=null;if(void 0!==g){f=g.actionByRoot[e];if(void 0!==f)return f;f=g.knownActions[0];null===d&&(d=f._clip)}if(null===d)return null;d=new THREE.AnimationMixer._Action(this,d,b);this._bindAction(d,f);this._addInactiveAction(d,c,e);return d},existingAction:function(a,
b){var c=b||this._root,e=c.uuid,c="string"===typeof a?THREE.AnimationClip.findByName(c,a):a,c=this._actionsByClip[c?c.uuid:a];return void 0!==c?c.actionByRoot[e]||null:null},stopAllAction:function(){for(var a=this._actions,b=this._nActiveActions,c=this._bindings,e=this._nActiveBindings,d=this._nActiveBindings=this._nActiveActions=0;d!==b;++d)a[d].reset();for(d=0;d!==e;++d)c[d].useCount=0;return this},update:function(a){a*=this.timeScale;for(var b=this._actions,c=this._nActiveActions,e=this.time+=
a,d=Math.sign(a),g=this._accuIndex^=1,f=0;f!==c;++f){var h=b[f];h.enabled&&h._update(e,a,d,g)}a=this._bindings;b=this._nActiveBindings;for(f=0;f!==b;++f)a[f].apply(g);return this},getRoot:function(){return this._root},uncacheClip:function(a){var b=this._actions;a=a.uuid;var c=this._actionsByClip,e=c[a];if(void 0!==e){for(var e=e.knownActions,d=0,g=e.length;d!==g;++d){var f=e[d];this._deactivateAction(f);var h=f._cacheIndex,k=b[b.length-1];f._cacheIndex=null;f._byClipCacheIndex=null;k._cacheIndex=
h;b[h]=k;b.pop();this._removeInactiveBindingsForAction(f)}delete c[a]}},uncacheRoot:function(a){a=a.uuid;var b=this._actionsByClip,c;for(c in b){var e=b[c].actionByRoot[a];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}c=this._bindingsByRootAndName[a];if(void 0!==c)for(var d in c)a=c[d],a.restoreOriginalState(),this._removeInactiveBinding(a)},uncacheAction:function(a,b){var c=this.existingAction(a,b);null!==c&&(this._deactivateAction(c),this._removeInactiveAction(c))}});
THREE.AnimationMixer._Action=THREE.AnimationAction._new;
Object.assign(THREE.AnimationMixer.prototype,{_bindAction:function(a,b){var c=a._localRoot||this._root,e=a._clip.tracks,d=e.length,g=a._propertyBindings,f=a._interpolants,h=c.uuid,k=this._bindingsByRootAndName,l=k[h];void 0===l&&(l={},k[h]=l);for(k=0;k!==d;++k){var n=e[k],q=n.name,m=l[q];if(void 0===m){m=g[k];if(void 0!==m){null===m._cacheIndex&&(++m.referenceCount,this._addInactiveBinding(m,h,q));continue}m=new THREE.PropertyMixer(THREE.PropertyBinding.create(c,q,b&&b._propertyBindings[k].binding.parsedPath),
n.ValueTypeName,n.getValueSize());++m.referenceCount;this._addInactiveBinding(m,h,q)}g[k]=m;f[k].resultBuffer=m.buffer}},_activateAction:function(a){if(!this._isActiveAction(a)){if(null===a._cacheIndex){var b=(a._localRoot||this._root).uuid,c=a._clip.uuid,e=this._actionsByClip[c];this._bindAction(a,e&&e.knownActions[0]);this._addInactiveAction(a,c,b)}b=a._propertyBindings;c=0;for(e=b.length;c!==e;++c){var d=b[c];0===d.useCount++&&(this._lendBinding(d),d.saveOriginalState())}this._lendAction(a)}},
_deactivateAction:function(a){if(this._isActiveAction(a)){for(var b=a._propertyBindings,c=0,e=b.length;c!==e;++c){var d=b[c];0===--d.useCount&&(d.restoreOriginalState(),this._takeBackBinding(d))}this._takeBackAction(a)}},_initMemoryManager:function(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var a=this;this.stats={actions:{get total(){return a._actions.length},
get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}},_isActiveAction:function(a){a=a._cacheIndex;return null!==a&&a<this._nActiveActions},_addInactiveAction:function(a,b,c){var e=this._actions,d=this._actionsByClip,g=d[b];void 0===g?(g={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,d[b]=g):(b=
g.knownActions,a._byClipCacheIndex=b.length,b.push(a));a._cacheIndex=e.length;e.push(a);g.actionByRoot[c]=a},_removeInactiveAction:function(a){var b=this._actions,c=b[b.length-1],e=a._cacheIndex;c._cacheIndex=e;b[e]=c;b.pop();a._cacheIndex=null;var c=a._clip.uuid,e=this._actionsByClip,d=e[c],g=d.knownActions,f=g[g.length-1],h=a._byClipCacheIndex;f._byClipCacheIndex=h;g[h]=f;g.pop();a._byClipCacheIndex=null;delete d.actionByRoot[(b._localRoot||this._root).uuid];0===g.length&&delete e[c];this._removeInactiveBindingsForAction(a)},
_removeInactiveBindingsForAction:function(a){a=a._propertyBindings;for(var b=0,c=a.length;b!==c;++b){var e=a[b];0===--e.referenceCount&&this._removeInactiveBinding(e)}},_lendAction:function(a){var b=this._actions,c=a._cacheIndex,e=this._nActiveActions++,d=b[e];a._cacheIndex=e;b[e]=a;d._cacheIndex=c;b[c]=d},_takeBackAction:function(a){var b=this._actions,c=a._cacheIndex,e=--this._nActiveActions,d=b[e];a._cacheIndex=e;b[e]=a;d._cacheIndex=c;b[c]=d},_addInactiveBinding:function(a,b,c){var e=this._bindingsByRootAndName,
d=e[b],g=this._bindings;void 0===d&&(d={},e[b]=d);d[c]=a;a._cacheIndex=g.length;g.push(a)},_removeInactiveBinding:function(a){var b=this._bindings,c=a.binding,e=c.rootNode.uuid,c=c.path,d=this._bindingsByRootAndName,g=d[e],f=b[b.length-1];a=a._cacheIndex;f._cacheIndex=a;b[a]=f;b.pop();delete g[c];a:{for(var h in g)break a;delete d[e]}},_lendBinding:function(a){var b=this._bindings,c=a._cacheIndex,e=this._nActiveBindings++,d=b[e];a._cacheIndex=e;b[e]=a;d._cacheIndex=c;b[c]=d},_takeBackBinding:function(a){var b=
this._bindings,c=a._cacheIndex,e=--this._nActiveBindings,d=b[e];a._cacheIndex=e;b[e]=a;d._cacheIndex=c;b[c]=d},_lendControlInterpolant:function(){var a=this._controlInterpolants,b=this._nActiveControlInterpolants++,c=a[b];void 0===c&&(c=new THREE.LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),c.__cacheIndex=b,a[b]=c);return c},_takeBackControlInterpolant:function(a){var b=this._controlInterpolants,c=a.__cacheIndex,e=--this._nActiveControlInterpolants,
d=b[e];a.__cacheIndex=e;b[e]=a;d.__cacheIndex=c;b[c]=d},_controlInterpolantsResultBuffer:new Float32Array(1)});
THREE.AnimationObjectGroup=function(a){this.uuid=THREE.Math.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var b={};this._indicesByUUID=b;for(var c=0,e=arguments.length;c!==e;++c)b[arguments[c].uuid]=c;this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var d=this;this.stats={objects:{get total(){return d._objects.length},get inUse(){return this.total-d.nCachedObjects_}},get bindingsPerObject(){return d._bindings.length}}};
THREE.AnimationObjectGroup.prototype={constructor:THREE.AnimationObjectGroup,add:function(a){for(var b=this._objects,c=b.length,e=this.nCachedObjects_,d=this._indicesByUUID,g=this._paths,f=this._parsedPaths,h=this._bindings,k=h.length,l=0,n=arguments.length;l!==n;++l){var q=arguments[l],m=q.uuid,p=d[m];if(void 0===p){p=c++;d[m]=p;b.push(q);for(var m=0,r=k;m!==r;++m)h[m].push(new THREE.PropertyBinding(q,g[m],f[m]))}else if(p<e){var t=b[p],w=--e,r=b[w];d[r.uuid]=p;b[p]=r;d[m]=w;b[w]=q;m=0;for(r=k;m!==
r;++m){var v=h[m],u=v[p];v[p]=v[w];void 0===u&&(u=new THREE.PropertyBinding(q,g[m],f[m]));v[w]=u}}else b[p]!==t&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=e},remove:function(a){for(var b=this._objects,c=this.nCachedObjects_,e=this._indicesByUUID,d=this._bindings,g=d.length,f=0,h=arguments.length;f!==h;++f){var k=arguments[f],l=k.uuid,n=e[l];if(void 0!==n&&n>=c){var q=c++,m=b[q];e[m.uuid]=
n;b[n]=m;e[l]=q;b[q]=k;k=0;for(l=g;k!==l;++k){var m=d[k],p=m[n];m[n]=m[q];m[q]=p}}}this.nCachedObjects_=c},uncache:function(a){for(var b=this._objects,c=b.length,e=this.nCachedObjects_,d=this._indicesByUUID,g=this._bindings,f=g.length,h=0,k=arguments.length;h!==k;++h){var l=arguments[h].uuid,n=d[l];if(void 0!==n)if(delete d[l],n<e){var l=--e,q=b[l],m=--c,p=b[m];d[q.uuid]=n;b[n]=q;d[p.uuid]=l;b[l]=p;b.pop();q=0;for(p=f;q!==p;++q){var r=g[q],t=r[m];r[n]=r[l];r[l]=t;r.pop()}}else for(m=--c,p=b[m],d[p.uuid]=
n,b[n]=p,b.pop(),q=0,p=f;q!==p;++q)r=g[q],r[n]=r[m],r.pop()}this.nCachedObjects_=e},subscribe_:function(a,b){var c=this._bindingsIndicesByPath,e=c[a],d=this._bindings;if(void 0!==e)return d[e];var g=this._paths,f=this._parsedPaths,h=this._objects,k=this.nCachedObjects_,l=Array(h.length),e=d.length;c[a]=e;g.push(a);f.push(b);d.push(l);c=k;for(e=h.length;c!==e;++c)l[c]=new THREE.PropertyBinding(h[c],a,b);return l},unsubscribe_:function(a){var b=this._bindingsIndicesByPath,c=b[a];if(void 0!==c){var e=
this._paths,d=this._parsedPaths,g=this._bindings,f=g.length-1,h=g[f];b[a[f]]=c;g[c]=h;g.pop();d[c]=d[f];d.pop();e[c]=e[f];e.pop()}}};
THREE.AnimationUtils={arraySlice:function(a,b,c){return THREE.AnimationUtils.isTypedArray(a)?new a.constructor(a.subarray(b,c)):a.slice(b,c)},convertArray:function(a,b,c){return!a||!c&&a.constructor===b?a:"number"===typeof b.BYTES_PER_ELEMENT?new b(a):Array.prototype.slice.call(a)},isTypedArray:function(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)},getKeyframeOrder:function(a){for(var b=a.length,c=Array(b),e=0;e!==b;++e)c[e]=e;c.sort(function(b,c){return a[b]-a[c]});return c},sortedArray:function(a,
b,c){for(var e=a.length,d=new a.constructor(e),g=0,f=0;f!==e;++g)for(var h=c[g]*b,k=0;k!==b;++k)d[f++]=a[h+k];return d},flattenJSON:function(a,b,c,e){for(var d=1,g=a[0];void 0!==g&&void 0===g[e];)g=a[d++];if(void 0!==g){var f=g[e];if(void 0!==f)if(Array.isArray(f)){do f=g[e],void 0!==f&&(b.push(g.time),c.push.apply(c,f)),g=a[d++];while(void 0!==g)}else if(void 0!==f.toArray){do f=g[e],void 0!==f&&(b.push(g.time),f.toArray(c,c.length)),g=a[d++];while(void 0!==g)}else{do f=g[e],void 0!==f&&(b.push(g.time),
c.push(f)),g=a[d++];while(void 0!==g)}}}};THREE.KeyframeTrack=function(a,b,c,e){if(void 0===a)throw Error("track name is undefined");if(void 0===b||0===b.length)throw Error("no keyframes in track named "+a);this.name=a;this.times=THREE.AnimationUtils.convertArray(b,this.TimeBufferType);this.values=THREE.AnimationUtils.convertArray(c,this.ValueBufferType);this.setInterpolation(e||this.DefaultInterpolation);this.validate();this.optimize()};
THREE.KeyframeTrack.prototype={constructor:THREE.KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:THREE.InterpolateLinear,InterpolantFactoryMethodDiscrete:function(a){return new THREE.DiscreteInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodLinear:function(a){return new THREE.LinearInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:function(a){return new THREE.CubicInterpolant(this.times,
this.values,this.getValueSize(),a)},setInterpolation:function(a){var b;switch(a){case THREE.InterpolateDiscrete:b=this.InterpolantFactoryMethodDiscrete;break;case THREE.InterpolateLinear:b=this.InterpolantFactoryMethodLinear;break;case THREE.InterpolateSmooth:b=this.InterpolantFactoryMethodSmooth}if(void 0===b){b="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);
else throw Error(b);console.warn(b)}else this.createInterpolant=b},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return THREE.InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return THREE.InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return THREE.InterpolateSmooth}},getValueSize:function(){return this.values.length/this.times.length},shift:function(a){if(0!==a)for(var b=this.times,c=0,e=b.length;c!==e;++c)b[c]+=a;return this},
scale:function(a){if(1!==a)for(var b=this.times,c=0,e=b.length;c!==e;++c)b[c]*=a;return this},trim:function(a,b){for(var c=this.times,e=c.length,d=0,g=e-1;d!==e&&c[d]<a;)++d;for(;-1!==g&&c[g]>b;)--g;++g;if(0!==d||g!==e)d>=g&&(g=Math.max(g,1),d=g-1),e=this.getValueSize(),this.times=THREE.AnimationUtils.arraySlice(c,d,g),this.values=THREE.AnimationUtils.arraySlice(this.values,d*e,g*e);return this},validate:function(){var a=!0,b=this.getValueSize();0!==b-Math.floor(b)&&(console.error("invalid value size in track",
this),a=!1);var c=this.times,b=this.values,e=c.length;0===e&&(console.error("track is empty",this),a=!1);for(var d=null,g=0;g!==e;g++){var f=c[g];if("number"===typeof f&&isNaN(f)){console.error("time is not a valid number",this,g,f);a=!1;break}if(null!==d&&d>f){console.error("out of order keys",this,g,f,d);a=!1;break}d=f}if(void 0!==b&&THREE.AnimationUtils.isTypedArray(b))for(g=0,c=b.length;g!==c;++g)if(e=b[g],isNaN(e)){console.error("value is not a valid number",this,g,e);a=!1;break}return a},optimize:function(){for(var a=
this.times,b=this.values,c=this.getValueSize(),e=1,d=1,g=a.length-1;d<=g;++d){var f=!1,h=a[d];if(h!==a[d+1]&&(1!==d||h!==h[0]))for(var k=d*c,l=k-c,n=k+c,h=0;h!==c;++h){var q=b[k+h];if(q!==b[l+h]||q!==b[n+h]){f=!0;break}}if(f){if(d!==e)for(a[e]=a[d],f=d*c,k=e*c,h=0;h!==c;++h)b[k+h]=b[f+h];++e}}e!==a.length&&(this.times=THREE.AnimationUtils.arraySlice(a,0,e),this.values=THREE.AnimationUtils.arraySlice(b,0,e*c));return this}};
Object.assign(THREE.KeyframeTrack,{parse:function(a){if(void 0===a.type)throw Error("track type undefined, can not parse");var b=THREE.KeyframeTrack._getTrackTypeForValueTypeName(a.type);if(void 0===a.times){var c=[],e=[];THREE.AnimationUtils.flattenJSON(a.keys,c,e,"value");a.times=c;a.values=e}return void 0!==b.parse?b.parse(a):new b(a.name,a.times,a.values,a.interpolation)},toJSON:function(a){var b=a.constructor;if(void 0!==b.toJSON)b=b.toJSON(a);else{var b={name:a.name,times:THREE.AnimationUtils.convertArray(a.times,
Array),values:THREE.AnimationUtils.convertArray(a.values,Array)},c=a.getInterpolation();c!==a.DefaultInterpolation&&(b.interpolation=c)}b.type=a.ValueTypeName;return b},_getTrackTypeForValueTypeName:function(a){switch(a.toLowerCase()){case "scalar":case "double":case "float":case "number":case "integer":return THREE.NumberKeyframeTrack;case "vector":case "vector2":case "vector3":case "vector4":return THREE.VectorKeyframeTrack;case "color":return THREE.ColorKeyframeTrack;case "quaternion":return THREE.QuaternionKeyframeTrack;
case "bool":case "boolean":return THREE.BooleanKeyframeTrack;case "string":return THREE.StringKeyframeTrack}throw Error("Unsupported typeName: "+a);}});THREE.PropertyBinding=function(a,b,c){this.path=b;this.parsedPath=c||THREE.PropertyBinding.parseTrackName(b);this.node=THREE.PropertyBinding.findNode(a,this.parsedPath.nodeName)||a;this.rootNode=a};
THREE.PropertyBinding.prototype={constructor:THREE.PropertyBinding,getValue:function(a,b){this.bind();this.getValue(a,b)},setValue:function(a,b){this.bind();this.setValue(a,b)},bind:function(){var a=this.node,b=this.parsedPath,c=b.objectName,e=b.propertyName,d=b.propertyIndex;a||(this.node=a=THREE.PropertyBinding.findNode(this.rootNode,b.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(a){if(c){var g=b.objectIndex;switch(c){case "materials":if(!a.material){console.error("  can not bind to material as node does not have a material",
this);return}if(!a.material.materials){console.error("  can not bind to material.materials as node.material does not have a materials array",this);return}a=a.material.materials;break;case "bones":if(!a.skeleton){console.error("  can not bind to bones as node does not have a skeleton",this);return}a=a.skeleton.bones;for(c=0;c<a.length;c++)if(a[c].name===g){g=c;break}break;default:if(void 0===a[c]){console.error("  can not bind to objectName of node, undefined",this);return}a=a[c]}if(void 0!==g){if(void 0===
a[g]){console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,a);return}a=a[g]}}g=a[e];if(void 0===g)console.error("  trying to update property for track: "+b.nodeName+"."+e+" but it wasn't found.",a);else{b=this.Versioning.None;void 0!==a.needsUpdate?(b=this.Versioning.NeedsUpdate,this.targetObject=a):void 0!==a.matrixWorldNeedsUpdate&&(b=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=a);c=this.BindingType.Direct;if(void 0!==d){if("morphTargetInfluences"===
e){if(!a.geometry){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this);return}if(!a.geometry.morphTargets){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);return}for(c=0;c<this.node.geometry.morphTargets.length;c++)if(a.geometry.morphTargets[c].name===d){d=c;break}}c=this.BindingType.ArrayElement;this.resolvedProperty=g;this.propertyIndex=d}else void 0!==g.fromArray&&void 0!==g.toArray?
(c=this.BindingType.HasFromToArray,this.resolvedProperty=g):void 0!==g.length?(c=this.BindingType.EntireArray,this.resolvedProperty=g):this.propertyName=e;this.getValue=this.GetterByBindingType[c];this.setValue=this.SetterByBindingTypeAndVersioning[c][b]}}else console.error("  trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}};
Object.assign(THREE.PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:THREE.PropertyBinding.prototype.getValue,_setValue_unbound:THREE.PropertyBinding.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(a,b){a[b]=this.node[this.propertyName]},function(a,b){for(var c=this.resolvedProperty,e=0,d=c.length;e!==d;++e)a[b++]=
c[e]},function(a,b){a[b]=this.resolvedProperty[this.propertyIndex]},function(a,b){this.resolvedProperty.toArray(a,b)}],SetterByBindingTypeAndVersioning:[[function(a,b){this.node[this.propertyName]=a[b]},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){for(var c=this.resolvedProperty,e=0,d=c.length;e!==d;++e)c[e]=a[b++]},function(a,b){for(var c=this.resolvedProperty,
e=0,d=c.length;e!==d;++e)c[e]=a[b++];this.targetObject.needsUpdate=!0},function(a,b){for(var c=this.resolvedProperty,e=0,d=c.length;e!==d;++e)c[e]=a[b++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty[this.propertyIndex]=a[b]},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty.fromArray(a,
b)},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.matrixWorldNeedsUpdate=!0}]]});THREE.PropertyBinding.Composite=function(a,b,c){c=c||THREE.PropertyBinding.parseTrackName(b);this._targetGroup=a;this._bindings=a.subscribe_(b,c)};
THREE.PropertyBinding.Composite.prototype={constructor:THREE.PropertyBinding.Composite,getValue:function(a,b){this.bind();var c=this._bindings[this._targetGroup.nCachedObjects_];void 0!==c&&c.getValue(a,b)},setValue:function(a,b){for(var c=this._bindings,e=this._targetGroup.nCachedObjects_,d=c.length;e!==d;++e)c[e].setValue(a,b)},bind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].bind()},unbind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,
c=a.length;b!==c;++b)a[b].unbind()}};THREE.PropertyBinding.create=function(a,b,c){return a instanceof THREE.AnimationObjectGroup?new THREE.PropertyBinding.Composite(a,b,c):new THREE.PropertyBinding(a,b,c)};
THREE.PropertyBinding.parseTrackName=function(a){var b=/^(([\w]+\/)*)([\w-\d]+)?(\.([\w]+)(\[([\w\d\[\]\_.:\- ]+)\])?)?(\.([\w.]+)(\[([\w\d\[\]\_. ]+)\])?)$/,c=b.exec(a);if(!c)throw Error("cannot parse trackName at all: "+a);c.index===b.lastIndex&&b.lastIndex++;b={nodeName:c[3],objectName:c[5],objectIndex:c[7],propertyName:c[9],propertyIndex:c[11]};if(null===b.propertyName||0===b.propertyName.length)throw Error("can not parse propertyName from trackName: "+a);return b};
THREE.PropertyBinding.findNode=function(a,b){if(!b||""===b||"root"===b||"."===b||-1===b||b===a.name||b===a.uuid)return a;if(a.skeleton){var c=function(a){for(var c=0;c<a.bones.length;c++){var d=a.bones[c];if(d.name===b)return d}return null}(a.skeleton);if(c)return c}if(a.children){var e=function(a){for(var c=0;c<a.length;c++){var d=a[c];if(d.name===b||d.uuid===b||(d=e(d.children)))return d}return null};if(c=e(a.children))return c}return null};
THREE.PropertyMixer=function(a,b,c){this.binding=a;this.valueSize=c;a=Float64Array;switch(b){case "quaternion":b=this._slerp;break;case "string":case "bool":a=Array;b=this._select;break;default:b=this._lerp}this.buffer=new a(4*c);this._mixBufferRegion=b;this.referenceCount=this.useCount=this.cumulativeWeight=0};
THREE.PropertyMixer.prototype={constructor:THREE.PropertyMixer,accumulate:function(a,b){var c=this.buffer,e=this.valueSize,d=a*e+e,g=this.cumulativeWeight;if(0===g){for(g=0;g!==e;++g)c[d+g]=c[g];g=b}else g+=b,this._mixBufferRegion(c,d,0,b/g,e);this.cumulativeWeight=g},apply:function(a){var b=this.valueSize,c=this.buffer;a=a*b+b;var e=this.cumulativeWeight,d=this.binding;this.cumulativeWeight=0;1>e&&this._mixBufferRegion(c,a,3*b,1-e,b);for(var e=b,g=b+b;e!==g;++e)if(c[e]!==c[e+b]){d.setValue(c,a);
break}},saveOriginalState:function(){var a=this.buffer,b=this.valueSize,c=3*b;this.binding.getValue(a,c);for(var e=b;e!==c;++e)a[e]=a[c+e%b];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(a,b,c,e,d){if(.5<=e)for(e=0;e!==d;++e)a[b+e]=a[c+e]},_slerp:function(a,b,c,e,d){THREE.Quaternion.slerpFlat(a,b,a,b,a,c,e)},_lerp:function(a,b,c,e,d){for(var g=1-e,f=0;f!==d;++f){var h=b+f;a[h]=a[h]*g+a[c+f]*e}}};
THREE.BooleanKeyframeTrack=function(a,b,c){THREE.KeyframeTrack.call(this,a,b,c)};THREE.BooleanKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:THREE.InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});THREE.ColorKeyframeTrack=function(a,b,c,e){THREE.KeyframeTrack.call(this,a,b,c,e)};
THREE.ColorKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.ColorKeyframeTrack,ValueTypeName:"color"});THREE.NumberKeyframeTrack=function(a,b,c,e){THREE.KeyframeTrack.call(this,a,b,c,e)};THREE.NumberKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.NumberKeyframeTrack,ValueTypeName:"number"});THREE.QuaternionKeyframeTrack=function(a,b,c,e){THREE.KeyframeTrack.call(this,a,b,c,e)};
THREE.QuaternionKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:THREE.InterpolateLinear,InterpolantFactoryMethodLinear:function(a){return new THREE.QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:void 0});THREE.StringKeyframeTrack=function(a,b,c,e){THREE.KeyframeTrack.call(this,a,b,c,e)};
THREE.StringKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:THREE.InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});THREE.VectorKeyframeTrack=function(a,b,c,e){THREE.KeyframeTrack.call(this,a,b,c,e)};
THREE.VectorKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.VectorKeyframeTrack,ValueTypeName:"vector"});
THREE.Audio=function(a){THREE.Object3D.call(this);this.type="Audio";this.context=a.context;this.source=this.context.createBufferSource();this.source.onended=this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(a.getInput());this.autoplay=!1;this.startTime=0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=!0;this.sourceType="empty";this.filters=[]};
THREE.Audio.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Audio,getOutput:function(){return this.gain},setNodeSource:function(a){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=a;this.connect();return this},setBuffer:function(a){this.source.buffer=a;this.sourceType="buffer";this.autoplay&&this.play();return this},play:function(){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");
else{var a=this.context.createBufferSource();a.buffer=this.source.buffer;a.loop=this.source.loop;a.onended=this.source.onended;a.start(0,this.startTime);a.playbackRate.value=this.playbackRate;this.isPlaying=!0;this.source=a;return this.connect()}},pause:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this},stop:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");
else return this.source.stop(),this.startTime=0,this.isPlaying=!1,this},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-
1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(a){a||(a=[]);!0===this.isPlaying?(this.disconnect(),this.filters=a,this.connect()):this.filters=a;return this},getFilter:function(){return this.getFilters()[0]},setFilter:function(a){return this.setFilters(a?[a]:[])},setPlaybackRate:function(a){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");
else return this.playbackRate=a,!0===this.isPlaying&&(this.source.playbackRate.value=this.playbackRate),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.source.loop},setLoop:function(a){!1===this.hasPlaybackControl?console.warn("THREE.Audio: this Audio has no playback control."):this.source.loop=a},getVolume:function(){return this.gain.gain.value},
setVolume:function(a){this.gain.gain.value=a;return this}});THREE.AudioAnalyser=function(a,b){this.analyser=a.context.createAnalyser();this.analyser.fftSize=void 0!==b?b:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);a.getOutput().connect(this.analyser)};
Object.assign(THREE.AudioAnalyser.prototype,{getFrequencyData:function(){this.analyser.getByteFrequencyData(this.data);return this.data},getAverageFrequency:function(){for(var a=0,b=this.getFrequencyData(),c=0;c<b.length;c++)a+=b[c];return a/b.length}});Object.defineProperty(THREE,"AudioContext",{get:function(){var a;return function(){void 0===a&&(a=new (window.AudioContext||window.webkitAudioContext));return a}}()});
THREE.PositionalAudio=function(a){THREE.Audio.call(this,a);this.panner=this.context.createPanner();this.panner.connect(this.gain)};
THREE.PositionalAudio.prototype=Object.assign(Object.create(THREE.Audio.prototype),{constructor:THREE.PositionalAudio,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(a){this.panner.refDistance=a},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(a){this.panner.rolloffFactor=a},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(a){this.panner.distanceModel=
a},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(a){this.panner.maxDistance=a},updateMatrixWorld:function(){var a=new THREE.Vector3;return function(b){THREE.Object3D.prototype.updateMatrixWorld.call(this,b);a.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(a.x,a.y,a.z)}}()});
THREE.AudioListener=function(){THREE.Object3D.call(this);this.type="AudioListener";this.context=THREE.AudioContext;this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null};
THREE.AudioListener.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.AudioListener,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(a){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):
this.gain.disconnect(this.context.destination);this.filter=a;this.gain.connect(this.filter);this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(a){this.gain.gain.value=a},updateMatrixWorld:function(){var a=new THREE.Vector3,b=new THREE.Quaternion,c=new THREE.Vector3,e=new THREE.Vector3;return function(d){THREE.Object3D.prototype.updateMatrixWorld.call(this,d);d=this.context.listener;var g=this.up;this.matrixWorld.decompose(a,
b,c);e.set(0,0,-1).applyQuaternion(b);d.setPosition(a.x,a.y,a.z);d.setOrientation(e.x,e.y,e.z,g.x,g.y,g.z)}}()});THREE.Camera=function(){THREE.Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.constructor=THREE.Camera;
THREE.Camera.prototype.getWorldDirection=function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,-1).applyQuaternion(a)}}();THREE.Camera.prototype.lookAt=function(){var a=new THREE.Matrix4;return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();THREE.Camera.prototype.clone=function(){return(new this.constructor).copy(this)};
THREE.Camera.prototype.copy=function(a){THREE.Object3D.prototype.copy.call(this,a);this.matrixWorldInverse.copy(a.matrixWorldInverse);this.projectionMatrix.copy(a.projectionMatrix);return this};
THREE.CubeCamera=function(a,b,c){THREE.Object3D.call(this);this.type="CubeCamera";var e=new THREE.PerspectiveCamera(90,1,a,b);e.up.set(0,-1,0);e.lookAt(new THREE.Vector3(1,0,0));this.add(e);var d=new THREE.PerspectiveCamera(90,1,a,b);d.up.set(0,-1,0);d.lookAt(new THREE.Vector3(-1,0,0));this.add(d);var g=new THREE.PerspectiveCamera(90,1,a,b);g.up.set(0,0,1);g.lookAt(new THREE.Vector3(0,1,0));this.add(g);var f=new THREE.PerspectiveCamera(90,1,a,b);f.up.set(0,0,-1);f.lookAt(new THREE.Vector3(0,-1,0));
this.add(f);var h=new THREE.PerspectiveCamera(90,1,a,b);h.up.set(0,-1,0);h.lookAt(new THREE.Vector3(0,0,1));this.add(h);var k=new THREE.PerspectiveCamera(90,1,a,b);k.up.set(0,-1,0);k.lookAt(new THREE.Vector3(0,0,-1));this.add(k);this.renderTarget=new THREE.WebGLRenderTargetCube(c,c,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(a,b){null===this.parent&&this.updateMatrixWorld();var c=this.renderTarget,m=c.texture.generateMipmaps;c.texture.generateMipmaps=
!1;c.activeCubeFace=0;a.render(b,e,c);c.activeCubeFace=1;a.render(b,d,c);c.activeCubeFace=2;a.render(b,g,c);c.activeCubeFace=3;a.render(b,f,c);c.activeCubeFace=4;a.render(b,h,c);c.texture.generateMipmaps=m;c.activeCubeFace=5;a.render(b,k,c);a.setRenderTarget(null)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CubeCamera.prototype.constructor=THREE.CubeCamera;
THREE.OrthographicCamera=function(a,b,c,e,d,g){THREE.Camera.call(this);this.type="OrthographicCamera";this.zoom=1;this.view=null;this.left=a;this.right=b;this.top=c;this.bottom=e;this.near=void 0!==d?d:.1;this.far=void 0!==g?g:2E3;this.updateProjectionMatrix()};
THREE.OrthographicCamera.prototype=Object.assign(Object.create(THREE.Camera.prototype),{constructor:THREE.OrthographicCamera,copy:function(a){THREE.Camera.prototype.copy.call(this,a);this.left=a.left;this.right=a.right;this.top=a.top;this.bottom=a.bottom;this.near=a.near;this.far=a.far;this.zoom=a.zoom;this.view=null===a.view?null:Object.assign({},a.view);return this},setViewOffset:function(a,b,c,e,d,g){this.view={fullWidth:a,fullHeight:b,offsetX:c,offsetY:e,width:d,height:g};this.updateProjectionMatrix()},
clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,e=(this.top+this.bottom)/2,d=c-a,c=c+a,a=e+b,b=e-b;if(null!==this.view)var c=this.zoom/(this.view.width/this.view.fullWidth),b=this.zoom/(this.view.height/this.view.fullHeight),g=(this.right-this.left)/this.view.width,e=(this.top-this.bottom)/this.view.height,d=d+this.view.offsetX/c*g,
c=d+this.view.width/c*g,a=a-this.view.offsetY/b*e,b=a-this.view.height/b*e;this.projectionMatrix.makeOrthographic(d,c,a,b,this.near,this.far)},toJSON:function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.zoom=this.zoom;a.object.left=this.left;a.object.right=this.right;a.object.top=this.top;a.object.bottom=this.bottom;a.object.near=this.near;a.object.far=this.far;null!==this.view&&(a.object.view=Object.assign({},this.view));return a}});
THREE.PerspectiveCamera=function(a,b,c,e){THREE.Camera.call(this);this.type="PerspectiveCamera";this.fov=void 0!==a?a:50;this.zoom=1;this.near=void 0!==c?c:.1;this.far=void 0!==e?e:2E3;this.focus=10;this.aspect=void 0!==b?b:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()};
THREE.PerspectiveCamera.prototype=Object.assign(Object.create(THREE.Camera.prototype),{constructor:THREE.PerspectiveCamera,copy:function(a){THREE.Camera.prototype.copy.call(this,a);this.fov=a.fov;this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.focus=a.focus;this.aspect=a.aspect;this.view=null===a.view?null:Object.assign({},a.view);this.filmGauge=a.filmGauge;this.filmOffset=a.filmOffset;return this},setFocalLength:function(a){a=.5*this.getFilmHeight()/a;this.fov=2*THREE.Math.RAD2DEG*Math.atan(a);
this.updateProjectionMatrix()},getFocalLength:function(){var a=Math.tan(.5*THREE.Math.DEG2RAD*this.fov);return.5*this.getFilmHeight()/a},getEffectiveFOV:function(){return 2*THREE.Math.RAD2DEG*Math.atan(Math.tan(.5*THREE.Math.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(a,b,c,e,d,g){this.aspect=a/b;this.view={fullWidth:a,fullHeight:b,offsetX:c,offsetY:e,
width:d,height:g};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=this.near,b=a*Math.tan(.5*THREE.Math.DEG2RAD*this.fov)/this.zoom,c=2*b,e=this.aspect*c,d=-.5*e,g=this.view;if(null!==g)var f=g.fullWidth,h=g.fullHeight,d=d+g.offsetX*e/f,b=b-g.offsetY*c/h,e=g.width/f*e,c=g.height/h*c;g=this.filmOffset;0!==g&&(d+=a*g/this.getFilmWidth());this.projectionMatrix.makeFrustum(d,d+e,b-c,b,a,this.far)},toJSON:function(a){a=
THREE.Object3D.prototype.toJSON.call(this,a);a.object.fov=this.fov;a.object.zoom=this.zoom;a.object.near=this.near;a.object.far=this.far;a.object.focus=this.focus;a.object.aspect=this.aspect;null!==this.view&&(a.object.view=Object.assign({},this.view));a.object.filmGauge=this.filmGauge;a.object.filmOffset=this.filmOffset;return a}});
THREE.StereoCamera=function(){this.type="StereoCamera";this.aspect=1;this.cameraL=new THREE.PerspectiveCamera;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new THREE.PerspectiveCamera;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=!1};
Object.assign(THREE.StereoCamera.prototype,{update:function(){var a,b,c,e,d,g=new THREE.Matrix4,f=new THREE.Matrix4;return function(h){if(a!==h.focus||b!==h.fov||c!==h.aspect*this.aspect||e!==h.near||d!==h.far){a=h.focus;b=h.fov;c=h.aspect*this.aspect;e=h.near;d=h.far;var k=h.projectionMatrix.clone(),l=.032*e/a,n=e*Math.tan(THREE.Math.DEG2RAD*b*.5),q,m;f.elements[12]=-.032;g.elements[12]=.032;q=-n*c+l;m=n*c+l;k.elements[0]=2*e/(m-q);k.elements[8]=(m+q)/(m-q);this.cameraL.projectionMatrix.copy(k);
q=-n*c-l;m=n*c-l;k.elements[0]=2*e/(m-q);k.elements[8]=(m+q)/(m-q);this.cameraR.projectionMatrix.copy(k)}this.cameraL.matrixWorld.copy(h.matrixWorld).multiply(f);this.cameraR.matrixWorld.copy(h.matrixWorld).multiply(g)}}()});THREE.Light=function(a,b){THREE.Object3D.call(this);this.type="Light";this.color=new THREE.Color(a);this.intensity=void 0!==b?b:1;this.receiveShadow=void 0};
THREE.Light.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Light,copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.color.copy(a.color);this.intensity=a.intensity;return this},toJSON:function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.color=this.color.getHex();a.object.intensity=this.intensity;void 0!==this.groundColor&&(a.object.groundColor=this.groundColor.getHex());void 0!==this.distance&&(a.object.distance=this.distance);void 0!==
this.angle&&(a.object.angle=this.angle);void 0!==this.decay&&(a.object.decay=this.decay);void 0!==this.penumbra&&(a.object.penumbra=this.penumbra);return a}});THREE.LightShadow=function(a){this.camera=a;this.bias=0;this.radius=1;this.mapSize=new THREE.Vector2(512,512);this.map=null;this.matrix=new THREE.Matrix4};Object.assign(THREE.LightShadow.prototype,{copy:function(a){this.camera=a.camera.clone();this.bias=a.bias;this.radius=a.radius;this.mapSize.copy(a.mapSize);return this},clone:function(){return(new this.constructor).copy(this)}});
THREE.AmbientLight=function(a,b){THREE.Light.call(this,a,b);this.type="AmbientLight";this.castShadow=void 0};THREE.AmbientLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.AmbientLight});THREE.DirectionalLight=function(a,b){THREE.Light.call(this,a,b);this.type="DirectionalLight";this.position.copy(THREE.Object3D.DefaultUp);this.updateMatrix();this.target=new THREE.Object3D;this.shadow=new THREE.DirectionalLightShadow};
THREE.DirectionalLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.DirectionalLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});THREE.DirectionalLightShadow=function(a){THREE.LightShadow.call(this,new THREE.OrthographicCamera(-5,5,5,-5,.5,500))};THREE.DirectionalLightShadow.prototype=Object.assign(Object.create(THREE.LightShadow.prototype),{constructor:THREE.DirectionalLightShadow});
THREE.HemisphereLight=function(a,b,c){THREE.Light.call(this,a,c);this.type="HemisphereLight";this.castShadow=void 0;this.position.copy(THREE.Object3D.DefaultUp);this.updateMatrix();this.groundColor=new THREE.Color(b)};THREE.HemisphereLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.HemisphereLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.groundColor.copy(a.groundColor);return this}});
THREE.PointLight=function(a,b,c,e){THREE.Light.call(this,a,b);this.type="PointLight";Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(a){this.intensity=a/(4*Math.PI)}});this.distance=void 0!==c?c:0;this.decay=void 0!==e?e:1;this.shadow=new THREE.LightShadow(new THREE.PerspectiveCamera(90,1,.5,500))};
THREE.PointLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.PointLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.distance=a.distance;this.decay=a.decay;this.shadow=a.shadow.clone();return this}});
THREE.SpotLight=function(a,b,c,e,d,g){THREE.Light.call(this,a,b);this.type="SpotLight";this.position.copy(THREE.Object3D.DefaultUp);this.updateMatrix();this.target=new THREE.Object3D;Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(a){this.intensity=a/Math.PI}});this.distance=void 0!==c?c:0;this.angle=void 0!==e?e:Math.PI/3;this.penumbra=void 0!==d?d:0;this.decay=void 0!==g?g:1;this.shadow=new THREE.SpotLightShadow};
THREE.SpotLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.SpotLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.distance=a.distance;this.angle=a.angle;this.penumbra=a.penumbra;this.decay=a.decay;this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});THREE.SpotLightShadow=function(){THREE.LightShadow.call(this,new THREE.PerspectiveCamera(50,1,.5,500))};
THREE.SpotLightShadow.prototype=Object.assign(Object.create(THREE.LightShadow.prototype),{constructor:THREE.SpotLightShadow,update:function(a){var b=2*THREE.Math.RAD2DEG*a.angle,c=this.mapSize.width/this.mapSize.height;a=a.distance||500;var e=this.camera;if(b!==e.fov||c!==e.aspect||a!==e.far)e.fov=b,e.aspect=c,e.far=a,e.updateProjectionMatrix()}});THREE.AudioLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
Object.assign(THREE.AudioLoader.prototype,{load:function(a,b,c,e){var d=new THREE.XHRLoader(this.manager);d.setResponseType("arraybuffer");d.load(a,function(a){THREE.AudioContext.decodeAudioData(a,function(a){b(a)})},c,e)}});THREE.Cache={enabled:!1,files:{},add:function(a,b){!1!==this.enabled&&(this.files[a]=b)},get:function(a){if(!1!==this.enabled)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}};
THREE.Loader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};
THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:void 0,extractUrlBase:function(a){a=a.split("/");if(1===a.length)return"./";a.pop();return a.join("/")+"/"},initMaterials:function(a,b,c){for(var e=[],d=0;d<a.length;++d)e[d]=this.createMaterial(a[d],b,c);return e},createMaterial:function(){var a,b,c;return function(e,d,g){function f(a,c,e,f,k){a=d+a;var m=THREE.Loader.Handlers.get(a);null!==m?a=m.load(a):(b.setCrossOrigin(g),a=b.load(a));void 0!==c&&(a.repeat.fromArray(c),1!==c[0]&&(a.wrapS=
THREE.RepeatWrapping),1!==c[1]&&(a.wrapT=THREE.RepeatWrapping));void 0!==e&&a.offset.fromArray(e);void 0!==f&&("repeat"===f[0]&&(a.wrapS=THREE.RepeatWrapping),"mirror"===f[0]&&(a.wrapS=THREE.MirroredRepeatWrapping),"repeat"===f[1]&&(a.wrapT=THREE.RepeatWrapping),"mirror"===f[1]&&(a.wrapT=THREE.MirroredRepeatWrapping));void 0!==k&&(a.anisotropy=k);c=THREE.Math.generateUUID();h[c]=a;return c}void 0===a&&(a=new THREE.Color);void 0===b&&(b=new THREE.TextureLoader);void 0===c&&(c=new THREE.MaterialLoader);
var h={},k={uuid:THREE.Math.generateUUID(),type:"MeshLambertMaterial"},l;for(l in e){var n=e[l];switch(l){case "DbgColor":case "DbgIndex":case "opticalDensity":case "illumination":break;case "DbgName":k.name=n;break;case "blending":k.blending=THREE[n];break;case "colorAmbient":case "mapAmbient":console.warn("THREE.Loader.createMaterial:",l,"is no longer supported.");break;case "colorDiffuse":k.color=a.fromArray(n).getHex();break;case "colorSpecular":k.specular=a.fromArray(n).getHex();break;case "colorEmissive":k.emissive=
a.fromArray(n).getHex();break;case "specularCoef":k.shininess=n;break;case "shading":"basic"===n.toLowerCase()&&(k.type="MeshBasicMaterial");"phong"===n.toLowerCase()&&(k.type="MeshPhongMaterial");"standard"===n.toLowerCase()&&(k.type="MeshStandardMaterial");break;case "mapDiffuse":k.map=f(n,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy);break;case "mapDiffuseRepeat":case "mapDiffuseOffset":case "mapDiffuseWrap":case "mapDiffuseAnisotropy":break;case "mapEmissive":k.emissiveMap=
f(n,e.mapEmissiveRepeat,e.mapEmissiveOffset,e.mapEmissiveWrap,e.mapEmissiveAnisotropy);break;case "mapEmissiveRepeat":case "mapEmissiveOffset":case "mapEmissiveWrap":case "mapEmissiveAnisotropy":break;case "mapLight":k.lightMap=f(n,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy);break;case "mapLightRepeat":case "mapLightOffset":case "mapLightWrap":case "mapLightAnisotropy":break;case "mapAO":k.aoMap=f(n,e.mapAORepeat,e.mapAOOffset,e.mapAOWrap,e.mapAOAnisotropy);break;case "mapAORepeat":case "mapAOOffset":case "mapAOWrap":case "mapAOAnisotropy":break;
case "mapBump":k.bumpMap=f(n,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy);break;case "mapBumpScale":k.bumpScale=n;break;case "mapBumpRepeat":case "mapBumpOffset":case "mapBumpWrap":case "mapBumpAnisotropy":break;case "mapNormal":k.normalMap=f(n,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy);break;case "mapNormalFactor":k.normalScale=[n,n];break;case "mapNormalRepeat":case "mapNormalOffset":case "mapNormalWrap":case "mapNormalAnisotropy":break;case "mapSpecular":k.specularMap=
f(n,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy);break;case "mapSpecularRepeat":case "mapSpecularOffset":case "mapSpecularWrap":case "mapSpecularAnisotropy":break;case "mapMetalness":k.metalnessMap=f(n,e.mapMetalnessRepeat,e.mapMetalnessOffset,e.mapMetalnessWrap,e.mapMetalnessAnisotropy);break;case "mapMetalnessRepeat":case "mapMetalnessOffset":case "mapMetalnessWrap":case "mapMetalnessAnisotropy":break;case "mapRoughness":k.roughnessMap=f(n,e.mapRoughnessRepeat,
e.mapRoughnessOffset,e.mapRoughnessWrap,e.mapRoughnessAnisotropy);break;case "mapRoughnessRepeat":case "mapRoughnessOffset":case "mapRoughnessWrap":case "mapRoughnessAnisotropy":break;case "mapAlpha":k.alphaMap=f(n,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy);break;case "mapAlphaRepeat":case "mapAlphaOffset":case "mapAlphaWrap":case "mapAlphaAnisotropy":break;case "flipSided":k.side=THREE.BackSide;break;case "doubleSided":k.side=THREE.DoubleSide;break;case "transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity");
k.opacity=n;break;case "depthTest":case "depthWrite":case "colorWrite":case "opacity":case "reflectivity":case "transparent":case "visible":case "wireframe":k[l]=n;break;case "vertexColors":!0===n&&(k.vertexColors=THREE.VertexColors);"face"===n&&(k.vertexColors=THREE.FaceColors);break;default:console.error("THREE.Loader.createMaterial: Unsupported",l,n)}}"MeshBasicMaterial"===k.type&&delete k.emissive;"MeshPhongMaterial"!==k.type&&delete k.specular;1>k.opacity&&(k.transparent=!0);c.setTextures(h);
return c.parse(k)}}()};THREE.Loader.Handlers={handlers:[],add:function(a,b){this.handlers.push(a,b)},get:function(a){for(var b=this.handlers,c=0,e=b.length;c<e;c+=2){var d=b[c+1];if(b[c].test(a))return d}return null}};THREE.XHRLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
Object.assign(THREE.XHRLoader.prototype,{load:function(a,b,c,e){void 0!==this.path&&(a=this.path+a);var d=this,g=THREE.Cache.get(a);if(void 0!==g)return d.manager.itemStart(a),setTimeout(function(){b&&b(g);d.manager.itemEnd(a)},0),g;var f=new XMLHttpRequest;f.overrideMimeType("text/plain");f.open("GET",a,!0);f.addEventListener("load",function(c){var f=c.target.response;THREE.Cache.add(a,f);200===this.status?(b&&b(f),d.manager.itemEnd(a)):0===this.status?(console.warn("THREE.XHRLoader: HTTP Status 0 received."),
b&&b(f),d.manager.itemEnd(a)):(e&&e(c),d.manager.itemError(a))},!1);void 0!==c&&f.addEventListener("progress",function(a){c(a)},!1);f.addEventListener("error",function(b){e&&e(b);d.manager.itemError(a)},!1);void 0!==this.responseType&&(f.responseType=this.responseType);void 0!==this.withCredentials&&(f.withCredentials=this.withCredentials);f.send(null);d.manager.itemStart(a);return f},setPath:function(a){this.path=a;return this},setResponseType:function(a){this.responseType=a;return this},setWithCredentials:function(a){this.withCredentials=
a;return this}});THREE.FontLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};Object.assign(THREE.FontLoader.prototype,{load:function(a,b,c,e){var d=this;(new THREE.XHRLoader(this.manager)).load(a,function(a){var c;try{c=JSON.parse(a)}catch(h){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),c=JSON.parse(a.substring(65,a.length-2))}a=d.parse(c);b&&b(a)},c,e)},parse:function(a){return new THREE.Font(a)}});
THREE.ImageLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
Object.assign(THREE.ImageLoader.prototype,{load:function(a,b,c,e){var d=this,g=document.createElementNS("http://www.w3.org/1999/xhtml","img");g.onload=function(){URL.revokeObjectURL(g.src);b&&b(g);d.manager.itemEnd(a)};if(0===a.indexOf("data:"))g.src=a;else{var f=new THREE.XHRLoader;f.setPath(this.path);f.setResponseType("blob");f.load(a,function(a){g.src=URL.createObjectURL(a)},c,e)}d.manager.itemStart(a);return g},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=
a;return this}});THREE.JSONLoader=function(a){"boolean"===typeof a&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),a=void 0);this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.withCredentials=!1};
Object.assign(THREE.JSONLoader.prototype,{load:function(a,b,c,e){var d=this,g=this.texturePath&&"string"===typeof this.texturePath?this.texturePath:THREE.Loader.prototype.extractUrlBase(a),f=new THREE.XHRLoader(this.manager);f.setWithCredentials(this.withCredentials);f.load(a,function(c){c=JSON.parse(c);var e=c.metadata;if(void 0!==e&&(e=e.type,void 0!==e)){if("object"===e.toLowerCase()){console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.ObjectLoader instead.");return}if("scene"===
e.toLowerCase()){console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.SceneLoader instead.");return}}c=d.parse(c,g);b(c.geometry,c.materials)},c,e)},setTexturePath:function(a){this.texturePath=a},parse:function(a,b){var c=new THREE.Geometry,e=void 0!==a.scale?1/a.scale:1;(function(b){var d,e,h,k,l,n,q,m,p,r,t,w,v,u=a.faces;n=a.vertices;var z=a.normals,x=a.colors,A=0;if(void 0!==a.uvs){for(d=0;d<a.uvs.length;d++)a.uvs[d].length&&A++;for(d=0;d<A;d++)c.faceVertexUvs[d]=[]}k=0;for(l=n.length;k<
l;)d=new THREE.Vector3,d.x=n[k++]*b,d.y=n[k++]*b,d.z=n[k++]*b,c.vertices.push(d);k=0;for(l=u.length;k<l;)if(b=u[k++],p=b&1,h=b&2,d=b&8,q=b&16,r=b&32,n=b&64,b&=128,p){p=new THREE.Face3;p.a=u[k];p.b=u[k+1];p.c=u[k+3];t=new THREE.Face3;t.a=u[k+1];t.b=u[k+2];t.c=u[k+3];k+=4;h&&(h=u[k++],p.materialIndex=h,t.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<A;d++)for(w=a.uvs[d],c.faceVertexUvs[d][h]=[],c.faceVertexUvs[d][h+1]=[],e=0;4>e;e++)m=u[k++],v=w[2*m],m=w[2*m+1],v=new THREE.Vector2(v,m),2!==e&&c.faceVertexUvs[d][h].push(v),
0!==e&&c.faceVertexUvs[d][h+1].push(v);q&&(q=3*u[k++],p.normal.set(z[q++],z[q++],z[q]),t.normal.copy(p.normal));if(r)for(d=0;4>d;d++)q=3*u[k++],r=new THREE.Vector3(z[q++],z[q++],z[q]),2!==d&&p.vertexNormals.push(r),0!==d&&t.vertexNormals.push(r);n&&(n=u[k++],n=x[n],p.color.setHex(n),t.color.setHex(n));if(b)for(d=0;4>d;d++)n=u[k++],n=x[n],2!==d&&p.vertexColors.push(new THREE.Color(n)),0!==d&&t.vertexColors.push(new THREE.Color(n));c.faces.push(p);c.faces.push(t)}else{p=new THREE.Face3;p.a=u[k++];p.b=
u[k++];p.c=u[k++];h&&(h=u[k++],p.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<A;d++)for(w=a.uvs[d],c.faceVertexUvs[d][h]=[],e=0;3>e;e++)m=u[k++],v=w[2*m],m=w[2*m+1],v=new THREE.Vector2(v,m),c.faceVertexUvs[d][h].push(v);q&&(q=3*u[k++],p.normal.set(z[q++],z[q++],z[q]));if(r)for(d=0;3>d;d++)q=3*u[k++],r=new THREE.Vector3(z[q++],z[q++],z[q]),p.vertexNormals.push(r);n&&(n=u[k++],p.color.setHex(x[n]));if(b)for(d=0;3>d;d++)n=u[k++],p.vertexColors.push(new THREE.Color(x[n]));c.faces.push(p)}})(e);(function(){var b=
void 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var e=0,f=a.skinWeights.length;e<f;e+=b)c.skinWeights.push(new THREE.Vector4(a.skinWeights[e],1<b?a.skinWeights[e+1]:0,2<b?a.skinWeights[e+2]:0,3<b?a.skinWeights[e+3]:0));if(a.skinIndices)for(e=0,f=a.skinIndices.length;e<f;e+=b)c.skinIndices.push(new THREE.Vector4(a.skinIndices[e],1<b?a.skinIndices[e+1]:0,2<b?a.skinIndices[e+2]:0,3<b?a.skinIndices[e+3]:0));c.bones=a.bones;c.bones&&0<c.bones.length&&(c.skinWeights.length!==
c.skinIndices.length||c.skinIndices.length!==c.vertices.length)&&console.warn("When skinning, number of vertices ("+c.vertices.length+"), skinIndices ("+c.skinIndices.length+"), and skinWeights ("+c.skinWeights.length+") should match.")})();(function(b){if(void 0!==a.morphTargets)for(var d=0,e=a.morphTargets.length;d<e;d++){c.morphTargets[d]={};c.morphTargets[d].name=a.morphTargets[d].name;c.morphTargets[d].vertices=[];for(var h=c.morphTargets[d].vertices,k=a.morphTargets[d].vertices,l=0,n=k.length;l<
n;l+=3){var q=new THREE.Vector3;q.x=k[l]*b;q.y=k[l+1]*b;q.z=k[l+2]*b;h.push(q)}}if(void 0!==a.morphColors&&0<a.morphColors.length)for(console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.'),b=c.faces,h=a.morphColors[0].colors,d=0,e=b.length;d<e;d++)b[d].color.fromArray(h,3*d)})(e);(function(){var b=[],e=[];void 0!==a.animation&&e.push(a.animation);void 0!==a.animations&&(a.animations.length?e=e.concat(a.animations):e.push(a.animations));for(var f=0;f<e.length;f++){var h=
THREE.AnimationClip.parseAnimation(e[f],c.bones);h&&b.push(h)}c.morphTargets&&(e=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(c.morphTargets,10),b=b.concat(e));0<b.length&&(c.animations=b)})();c.computeFaceNormals();c.computeBoundingSphere();if(void 0===a.materials||0===a.materials.length)return{geometry:c};e=THREE.Loader.prototype.initMaterials(a.materials,b,this.crossOrigin);return{geometry:c,materials:e}}});
THREE.LoadingManager=function(a,b,c){var e=this,d=!1,g=0,f=0;this.onStart=void 0;this.onLoad=a;this.onProgress=b;this.onError=c;this.itemStart=function(a){f++;if(!1===d&&void 0!==e.onStart)e.onStart(a,g,f);d=!0};this.itemEnd=function(a){g++;if(void 0!==e.onProgress)e.onProgress(a,g,f);if(g===f&&(d=!1,void 0!==e.onLoad))e.onLoad()};this.itemError=function(a){if(void 0!==e.onError)e.onError(a)}};THREE.DefaultLoadingManager=new THREE.LoadingManager;
THREE.BufferGeometryLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
Object.assign(THREE.BufferGeometryLoader.prototype,{load:function(a,b,c,e){var d=this;(new THREE.XHRLoader(d.manager)).load(a,function(a){b(d.parse(JSON.parse(a)))},c,e)},parse:function(a){var b=new THREE.BufferGeometry,c=a.data.index,e={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};void 0!==c&&(c=new e[c.type](c.array),b.setIndex(new THREE.BufferAttribute(c,
1)));var d=a.data.attributes,g;for(g in d){var f=d[g],c=new e[f.type](f.array);b.addAttribute(g,new THREE.BufferAttribute(c,f.itemSize,f.normalized))}e=a.data.groups||a.data.drawcalls||a.data.offsets;if(void 0!==e)for(g=0,c=e.length;g!==c;++g)d=e[g],b.addGroup(d.start,d.count,d.materialIndex);a=a.data.boundingSphere;void 0!==a&&(e=new THREE.Vector3,void 0!==a.center&&e.fromArray(a.center),b.boundingSphere=new THREE.Sphere(e,a.radius));return b}});
THREE.MaterialLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.textures={}};
Object.assign(THREE.MaterialLoader.prototype,{load:function(a,b,c,e){var d=this;(new THREE.XHRLoader(d.manager)).load(a,function(a){b(d.parse(JSON.parse(a)))},c,e)},setTextures:function(a){this.textures=a},getTexture:function(a){var b=this.textures;void 0===b[a]&&console.warn("THREE.MaterialLoader: Undefined texture",a);return b[a]},parse:function(a){var b=new THREE[a.type];void 0!==a.uuid&&(b.uuid=a.uuid);void 0!==a.name&&(b.name=a.name);void 0!==a.color&&b.color.setHex(a.color);void 0!==a.roughness&&
(b.roughness=a.roughness);void 0!==a.metalness&&(b.metalness=a.metalness);void 0!==a.emissive&&b.emissive.setHex(a.emissive);void 0!==a.specular&&b.specular.setHex(a.specular);void 0!==a.shininess&&(b.shininess=a.shininess);void 0!==a.uniforms&&(b.uniforms=a.uniforms);void 0!==a.vertexShader&&(b.vertexShader=a.vertexShader);void 0!==a.fragmentShader&&(b.fragmentShader=a.fragmentShader);void 0!==a.vertexColors&&(b.vertexColors=a.vertexColors);void 0!==a.shading&&(b.shading=a.shading);void 0!==a.blending&&
(b.blending=a.blending);void 0!==a.side&&(b.side=a.side);void 0!==a.opacity&&(b.opacity=a.opacity);void 0!==a.transparent&&(b.transparent=a.transparent);void 0!==a.alphaTest&&(b.alphaTest=a.alphaTest);void 0!==a.depthTest&&(b.depthTest=a.depthTest);void 0!==a.depthWrite&&(b.depthWrite=a.depthWrite);void 0!==a.colorWrite&&(b.colorWrite=a.colorWrite);void 0!==a.wireframe&&(b.wireframe=a.wireframe);void 0!==a.wireframeLinewidth&&(b.wireframeLinewidth=a.wireframeLinewidth);void 0!==a.size&&(b.size=a.size);
void 0!==a.sizeAttenuation&&(b.sizeAttenuation=a.sizeAttenuation);void 0!==a.map&&(b.map=this.getTexture(a.map));void 0!==a.alphaMap&&(b.alphaMap=this.getTexture(a.alphaMap),b.transparent=!0);void 0!==a.bumpMap&&(b.bumpMap=this.getTexture(a.bumpMap));void 0!==a.bumpScale&&(b.bumpScale=a.bumpScale);void 0!==a.normalMap&&(b.normalMap=this.getTexture(a.normalMap));if(void 0!==a.normalScale){var c=a.normalScale;!1===Array.isArray(c)&&(c=[c,c]);b.normalScale=(new THREE.Vector2).fromArray(c)}void 0!==a.displacementMap&&
(b.displacementMap=this.getTexture(a.displacementMap));void 0!==a.displacementScale&&(b.displacementScale=a.displacementScale);void 0!==a.displacementBias&&(b.displacementBias=a.displacementBias);void 0!==a.roughnessMap&&(b.roughnessMap=this.getTexture(a.roughnessMap));void 0!==a.metalnessMap&&(b.metalnessMap=this.getTexture(a.metalnessMap));void 0!==a.emissiveMap&&(b.emissiveMap=this.getTexture(a.emissiveMap));void 0!==a.emissiveIntensity&&(b.emissiveIntensity=a.emissiveIntensity);void 0!==a.specularMap&&
(b.specularMap=this.getTexture(a.specularMap));void 0!==a.envMap&&(b.envMap=this.getTexture(a.envMap),b.combine=THREE.MultiplyOperation);void 0!==a.reflectivity&&(b.reflectivity=a.reflectivity);void 0!==a.lightMap&&(b.lightMap=this.getTexture(a.lightMap));void 0!==a.lightMapIntensity&&(b.lightMapIntensity=a.lightMapIntensity);void 0!==a.aoMap&&(b.aoMap=this.getTexture(a.aoMap));void 0!==a.aoMapIntensity&&(b.aoMapIntensity=a.aoMapIntensity);if(void 0!==a.materials)for(var c=0,e=a.materials.length;c<
e;c++)b.materials.push(this.parse(a.materials[c]));return b}});THREE.ObjectLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.texturePath=""};
Object.assign(THREE.ObjectLoader.prototype,{load:function(a,b,c,e){""===this.texturePath&&(this.texturePath=a.substring(0,a.lastIndexOf("/")+1));var d=this;(new THREE.XHRLoader(d.manager)).load(a,function(a){d.parse(JSON.parse(a),b)},c,e)},setTexturePath:function(a){this.texturePath=a},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a,b){var c=this.parseGeometries(a.geometries),e=this.parseImages(a.images,function(){void 0!==b&&b(d)}),e=this.parseTextures(a.textures,e),e=this.parseMaterials(a.materials,
e),d=this.parseObject(a.object,c,e);a.animations&&(d.animations=this.parseAnimations(a.animations));void 0!==a.images&&0!==a.images.length||void 0===b||b(d);return d},parseGeometries:function(a){var b={};if(void 0!==a)for(var c=new THREE.JSONLoader,e=new THREE.BufferGeometryLoader,d=0,g=a.length;d<g;d++){var f,h=a[d];switch(h.type){case "PlaneGeometry":case "PlaneBufferGeometry":f=new THREE[h.type](h.width,h.height,h.widthSegments,h.heightSegments);break;case "BoxGeometry":case "BoxBufferGeometry":case "CubeGeometry":f=
new THREE[h.type](h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case "CircleGeometry":case "CircleBufferGeometry":f=new THREE[h.type](h.radius,h.segments,h.thetaStart,h.thetaLength);break;case "CylinderGeometry":case "CylinderBufferGeometry":f=new THREE[h.type](h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case "ConeGeometry":case "ConeBufferGeometry":f=new THREE[h.type](h.radius,h.height,h.radialSegments,
h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case "SphereGeometry":case "SphereBufferGeometry":f=new THREE[h.type](h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case "DodecahedronGeometry":case "IcosahedronGeometry":case "OctahedronGeometry":case "TetrahedronGeometry":f=new THREE[h.type](h.radius,h.detail);break;case "RingGeometry":case "RingBufferGeometry":f=new THREE[h.type](h.innerRadius,h.outerRadius,h.thetaSegments,h.phiSegments,
h.thetaStart,h.thetaLength);break;case "TorusGeometry":case "TorusBufferGeometry":f=new THREE[h.type](h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case "TorusKnotGeometry":case "TorusKnotBufferGeometry":f=new THREE[h.type](h.radius,h.tube,h.tubularSegments,h.radialSegments,h.p,h.q);break;case "LatheGeometry":case "LatheBufferGeometry":f=new THREE[h.type](h.points,h.segments,h.phiStart,h.phiLength);break;case "BufferGeometry":f=e.parse(h);break;case "Geometry":f=c.parse(h.data,this.texturePath).geometry;
break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+h.type+'"');continue}f.uuid=h.uuid;void 0!==h.name&&(f.name=h.name);b[h.uuid]=f}return b},parseMaterials:function(a,b){var c={};if(void 0!==a){var e=new THREE.MaterialLoader;e.setTextures(b);for(var d=0,g=a.length;d<g;d++){var f=e.parse(a[d]);c[f.uuid]=f}}return c},parseAnimations:function(a){for(var b=[],c=0;c<a.length;c++){var e=THREE.AnimationClip.parse(a[c]);b.push(e)}return b},parseImages:function(a,b){function c(a){e.manager.itemStart(a);
return f.load(a,function(){e.manager.itemEnd(a)})}var e=this,d={};if(void 0!==a&&0<a.length){var g=new THREE.LoadingManager(b),f=new THREE.ImageLoader(g);f.setCrossOrigin(this.crossOrigin);for(var g=0,h=a.length;g<h;g++){var k=a[g],l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(k.url)?k.url:e.texturePath+k.url;d[k.uuid]=c(l)}}return d},parseTextures:function(a,b){function c(a){if("number"===typeof a)return a;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",a);return THREE[a]}
var e={};if(void 0!==a)for(var d=0,g=a.length;d<g;d++){var f=a[d];void 0===f.image&&console.warn('THREE.ObjectLoader: No "image" specified for',f.uuid);void 0===b[f.image]&&console.warn("THREE.ObjectLoader: Undefined image",f.image);var h=new THREE.Texture(b[f.image]);h.needsUpdate=!0;h.uuid=f.uuid;void 0!==f.name&&(h.name=f.name);void 0!==f.mapping&&(h.mapping=c(f.mapping));void 0!==f.offset&&h.offset.fromArray(f.offset);void 0!==f.repeat&&h.repeat.fromArray(f.repeat);void 0!==f.wrap&&(h.wrapS=c(f.wrap[0]),
h.wrapT=c(f.wrap[1]));void 0!==f.minFilter&&(h.minFilter=c(f.minFilter));void 0!==f.magFilter&&(h.magFilter=c(f.magFilter));void 0!==f.anisotropy&&(h.anisotropy=f.anisotropy);void 0!==f.flipY&&(h.flipY=f.flipY);e[f.uuid]=h}return e},parseObject:function(){var a=new THREE.Matrix4;return function(b,c,e){function d(a){void 0===c[a]&&console.warn("THREE.ObjectLoader: Undefined geometry",a);return c[a]}function g(a){if(void 0!==a)return void 0===e[a]&&console.warn("THREE.ObjectLoader: Undefined material",
a),e[a]}var f;switch(b.type){case "Scene":f=new THREE.Scene;break;case "PerspectiveCamera":f=new THREE.PerspectiveCamera(b.fov,b.aspect,b.near,b.far);void 0!==b.focus&&(f.focus=b.focus);void 0!==b.zoom&&(f.zoom=b.zoom);void 0!==b.filmGauge&&(f.filmGauge=b.filmGauge);void 0!==b.filmOffset&&(f.filmOffset=b.filmOffset);void 0!==b.view&&(f.view=Object.assign({},b.view));break;case "OrthographicCamera":f=new THREE.OrthographicCamera(b.left,b.right,b.top,b.bottom,b.near,b.far);break;case "AmbientLight":f=
new THREE.AmbientLight(b.color,b.intensity);break;case "DirectionalLight":f=new THREE.DirectionalLight(b.color,b.intensity);break;case "PointLight":f=new THREE.PointLight(b.color,b.intensity,b.distance,b.decay);break;case "SpotLight":f=new THREE.SpotLight(b.color,b.intensity,b.distance,b.angle,b.penumbra,b.decay);break;case "HemisphereLight":f=new THREE.HemisphereLight(b.color,b.groundColor,b.intensity);break;case "Mesh":f=d(b.geometry);var h=g(b.material);f=f.bones&&0<f.bones.length?new THREE.SkinnedMesh(f,
h):new THREE.Mesh(f,h);break;case "LOD":f=new THREE.LOD;break;case "Line":f=new THREE.Line(d(b.geometry),g(b.material),b.mode);break;case "PointCloud":case "Points":f=new THREE.Points(d(b.geometry),g(b.material));break;case "Sprite":f=new THREE.Sprite(g(b.material));break;case "Group":f=new THREE.Group;break;default:f=new THREE.Object3D}f.uuid=b.uuid;void 0!==b.name&&(f.name=b.name);void 0!==b.matrix?(a.fromArray(b.matrix),a.decompose(f.position,f.quaternion,f.scale)):(void 0!==b.position&&f.position.fromArray(b.position),
void 0!==b.rotation&&f.rotation.fromArray(b.rotation),void 0!==b.scale&&f.scale.fromArray(b.scale));void 0!==b.castShadow&&(f.castShadow=b.castShadow);void 0!==b.receiveShadow&&(f.receiveShadow=b.receiveShadow);void 0!==b.visible&&(f.visible=b.visible);void 0!==b.userData&&(f.userData=b.userData);if(void 0!==b.children)for(var k in b.children)f.add(this.parseObject(b.children[k],c,e));if("LOD"===b.type)for(b=b.levels,h=0;h<b.length;h++){var l=b[h];k=f.getObjectByProperty("uuid",l.object);void 0!==
k&&f.addLevel(k,l.distance)}return f}}()});THREE.TextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
Object.assign(THREE.TextureLoader.prototype,{load:function(a,b,c,e){var d=new THREE.Texture,g=new THREE.ImageLoader(this.manager);g.setCrossOrigin(this.crossOrigin);g.setPath(this.path);g.load(a,function(c){var e=0<a.search(/\.(jpg|jpeg)$/)||0===a.search(/^data\:image\/jpeg/);d.format=e?THREE.RGBFormat:THREE.RGBAFormat;d.image=c;d.needsUpdate=!0;void 0!==b&&b(d)},c,e);return d},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});
THREE.CubeTextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
Object.assign(THREE.CubeTextureLoader.prototype,{load:function(a,b,c,e){function d(c){f.load(a[c],function(a){g.images[c]=a;h++;6===h&&(g.needsUpdate=!0,b&&b(g))},void 0,e)}var g=new THREE.CubeTexture,f=new THREE.ImageLoader(this.manager);f.setCrossOrigin(this.crossOrigin);f.setPath(this.path);var h=0;for(c=0;c<a.length;++c)d(c);return g},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});
THREE.DataTextureLoader=THREE.BinaryTextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this._parser=null};
Object.assign(THREE.BinaryTextureLoader.prototype,{load:function(a,b,c,e){var d=this,g=new THREE.DataTexture,f=new THREE.XHRLoader(this.manager);f.setResponseType("arraybuffer");f.load(a,function(a){if(a=d._parser(a))void 0!==a.image?g.image=a.image:void 0!==a.data&&(g.image.width=a.width,g.image.height=a.height,g.image.data=a.data),g.wrapS=void 0!==a.wrapS?a.wrapS:THREE.ClampToEdgeWrapping,g.wrapT=void 0!==a.wrapT?a.wrapT:THREE.ClampToEdgeWrapping,g.magFilter=void 0!==a.magFilter?a.magFilter:THREE.LinearFilter,
g.minFilter=void 0!==a.minFilter?a.minFilter:THREE.LinearMipMapLinearFilter,g.anisotropy=void 0!==a.anisotropy?a.anisotropy:1,void 0!==a.format&&(g.format=a.format),void 0!==a.type&&(g.type=a.type),void 0!==a.mipmaps&&(g.mipmaps=a.mipmaps),1===a.mipmapCount&&(g.minFilter=THREE.LinearFilter),g.needsUpdate=!0,b&&b(g,a)},c,e);return g}});THREE.CompressedTextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this._parser=null};
Object.assign(THREE.CompressedTextureLoader.prototype,{load:function(a,b,c,e){function d(d){k.load(a[d],function(a){a=g._parser(a,!0);f[d]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps};l+=1;6===l&&(1===a.mipmapCount&&(h.minFilter=THREE.LinearFilter),h.format=a.format,h.needsUpdate=!0,b&&b(h))},c,e)}var g=this,f=[],h=new THREE.CompressedTexture;h.image=f;var k=new THREE.XHRLoader(this.manager);k.setPath(this.path);k.setResponseType("arraybuffer");if(Array.isArray(a))for(var l=0,
n=0,q=a.length;n<q;++n)d(n);else k.load(a,function(a){a=g._parser(a,!0);if(a.isCubemap)for(var c=a.mipmaps.length/a.mipmapCount,d=0;d<c;d++){f[d]={mipmaps:[]};for(var e=0;e<a.mipmapCount;e++)f[d].mipmaps.push(a.mipmaps[d*a.mipmapCount+e]),f[d].format=a.format,f[d].width=a.width,f[d].height=a.height}else h.image.width=a.width,h.image.height=a.height,h.mipmaps=a.mipmaps;1===a.mipmapCount&&(h.minFilter=THREE.LinearFilter);h.format=a.format;h.needsUpdate=!0;b&&b(h)},c,e);return h},setPath:function(a){this.path=
a;return this}});
THREE.Material=function(){Object.defineProperty(this,"id",{value:THREE.MaterialIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Material";this.lights=this.fog=!0;this.blending=THREE.NormalBlending;this.side=THREE.FrontSide;this.shading=THREE.SmoothShading;this.vertexColors=THREE.NoColors;this.opacity=1;this.transparent=!1;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.blendEquationAlpha=this.blendDstAlpha=
this.blendSrcAlpha=null;this.depthFunc=THREE.LessEqualDepth;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=!1;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.premultipliedAlpha=!1;this.overdraw=0;this._needsUpdate=this.visible=!0};
THREE.Material.prototype={constructor:THREE.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(a){!0===a&&this.update();this._needsUpdate=a},setValues:function(a){if(void 0!==a)for(var b in a){var c=a[b];if(void 0===c)console.warn("THREE.Material: '"+b+"' parameter is undefined.");else{var e=this[b];void 0===e?console.warn("THREE."+this.type+": '"+b+"' is not a property of this material."):e instanceof THREE.Color?e.set(c):e instanceof THREE.Vector3&&c instanceof THREE.Vector3?e.copy(c):
this[b]="overdraw"===b?Number(c):c}}},toJSON:function(a){function b(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var c=void 0===a;c&&(a={textures:{},images:{}});var e={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};e.uuid=this.uuid;e.type=this.type;""!==this.name&&(e.name=this.name);this.color instanceof THREE.Color&&(e.color=this.color.getHex());void 0!==this.roughness&&(e.roughness=this.roughness);void 0!==this.metalness&&(e.metalness=this.metalness);
this.emissive instanceof THREE.Color&&(e.emissive=this.emissive.getHex());this.specular instanceof THREE.Color&&(e.specular=this.specular.getHex());void 0!==this.shininess&&(e.shininess=this.shininess);this.map instanceof THREE.Texture&&(e.map=this.map.toJSON(a).uuid);this.alphaMap instanceof THREE.Texture&&(e.alphaMap=this.alphaMap.toJSON(a).uuid);this.lightMap instanceof THREE.Texture&&(e.lightMap=this.lightMap.toJSON(a).uuid);this.bumpMap instanceof THREE.Texture&&(e.bumpMap=this.bumpMap.toJSON(a).uuid,
e.bumpScale=this.bumpScale);this.normalMap instanceof THREE.Texture&&(e.normalMap=this.normalMap.toJSON(a).uuid,e.normalScale=this.normalScale.toArray());this.displacementMap instanceof THREE.Texture&&(e.displacementMap=this.displacementMap.toJSON(a).uuid,e.displacementScale=this.displacementScale,e.displacementBias=this.displacementBias);this.roughnessMap instanceof THREE.Texture&&(e.roughnessMap=this.roughnessMap.toJSON(a).uuid);this.metalnessMap instanceof THREE.Texture&&(e.metalnessMap=this.metalnessMap.toJSON(a).uuid);
this.emissiveMap instanceof THREE.Texture&&(e.emissiveMap=this.emissiveMap.toJSON(a).uuid);this.specularMap instanceof THREE.Texture&&(e.specularMap=this.specularMap.toJSON(a).uuid);this.envMap instanceof THREE.Texture&&(e.envMap=this.envMap.toJSON(a).uuid,e.reflectivity=this.reflectivity);void 0!==this.size&&(e.size=this.size);void 0!==this.sizeAttenuation&&(e.sizeAttenuation=this.sizeAttenuation);this.blending!==THREE.NormalBlending&&(e.blending=this.blending);this.shading!==THREE.SmoothShading&&
(e.shading=this.shading);this.side!==THREE.FrontSide&&(e.side=this.side);this.vertexColors!==THREE.NoColors&&(e.vertexColors=this.vertexColors);1>this.opacity&&(e.opacity=this.opacity);!0===this.transparent&&(e.transparent=this.transparent);0<this.alphaTest&&(e.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(e.premultipliedAlpha=this.premultipliedAlpha);!0===this.wireframe&&(e.wireframe=this.wireframe);1<this.wireframeLinewidth&&(e.wireframeLinewidth=this.wireframeLinewidth);c&&(c=b(a.textures),
a=b(a.images),0<c.length&&(e.textures=c),0<a.length&&(e.images=a));return e},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.name=a.name;this.fog=a.fog;this.lights=a.lights;this.blending=a.blending;this.side=a.side;this.shading=a.shading;this.vertexColors=a.vertexColors;this.opacity=a.opacity;this.transparent=a.transparent;this.blendSrc=a.blendSrc;this.blendDst=a.blendDst;this.blendEquation=a.blendEquation;this.blendSrcAlpha=a.blendSrcAlpha;this.blendDstAlpha=a.blendDstAlpha;
this.blendEquationAlpha=a.blendEquationAlpha;this.depthFunc=a.depthFunc;this.depthTest=a.depthTest;this.depthWrite=a.depthWrite;this.colorWrite=a.colorWrite;this.precision=a.precision;this.polygonOffset=a.polygonOffset;this.polygonOffsetFactor=a.polygonOffsetFactor;this.polygonOffsetUnits=a.polygonOffsetUnits;this.alphaTest=a.alphaTest;this.premultipliedAlpha=a.premultipliedAlpha;this.overdraw=a.overdraw;this.visible=a.visible;this.clipShadows=a.clipShadows;a=a.clippingPlanes;var b=null;if(null!==
a)for(var c=a.length,b=Array(c),e=0;e!==c;++e)b[e]=a[e].clone();this.clippingPlanes=b;return this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};Object.assign(THREE.Material.prototype,THREE.EventDispatcher.prototype);THREE.MaterialIdCount=0;
THREE.LineBasicMaterial=function(a){THREE.Material.call(this);this.type="LineBasicMaterial";this.color=new THREE.Color(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.lights=!1;this.setValues(a)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;
THREE.LineBasicMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.linecap=a.linecap;this.linejoin=a.linejoin;return this};THREE.LineDashedMaterial=function(a){THREE.Material.call(this);this.type="LineDashedMaterial";this.color=new THREE.Color(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.lights=!1;this.setValues(a)};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.LineDashedMaterial.prototype.constructor=THREE.LineDashedMaterial;THREE.LineDashedMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.scale=a.scale;this.dashSize=a.dashSize;this.gapSize=a.gapSize;return this};
THREE.MeshBasicMaterial=function(a){THREE.Material.call(this);this.type="MeshBasicMaterial";this.color=new THREE.Color(16777215);this.aoMap=this.map=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.lights=this.morphTargets=this.skinning=!1;this.setValues(a)};
THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;
THREE.MeshBasicMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;
this.skinning=a.skinning;this.morphTargets=a.morphTargets;return this};THREE.MeshDepthMaterial=function(a){THREE.Material.call(this);this.type="MeshDepthMaterial";this.depthPacking=THREE.BasicDepthPacking;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.setValues(a)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;THREE.MeshDepthMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.depthPacking=a.depthPacking;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};
THREE.MeshLambertMaterial=function(a){THREE.Material.call(this);this.type="MeshLambertMaterial";this.color=new THREE.Color(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new THREE.Color(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap=
"round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;
THREE.MeshLambertMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=
a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};THREE.MeshNormalMaterial=function(a){THREE.Material.call(this,a);this.type="MeshNormalMaterial";this.wireframe=!1;this.wireframeLinewidth=1;this.morphTargets=this.lights=this.fog=!1;this.setValues(a)};
THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshNormalMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};
THREE.MeshPhongMaterial=function(a){THREE.Material.call(this);this.type="MeshPhongMaterial";this.color=new THREE.Color(16777215);this.specular=new THREE.Color(1118481);this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new THREE.Color(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=
0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;
THREE.MeshPhongMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.specular.copy(a.specular);this.shininess=a.shininess;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);
this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;
this.morphNormals=a.morphNormals;return this};
THREE.MeshStandardMaterial=function(a){THREE.Material.call(this);this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=new THREE.Color(16777215);this.metalness=this.roughness=.5;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new THREE.Color(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.displacementMap=null;this.displacementScale=
1;this.displacementBias=0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshStandardMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshStandardMaterial.prototype.constructor=THREE.MeshStandardMaterial;
THREE.MeshStandardMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.defines={STANDARD:""};this.color.copy(a.color);this.roughness=a.roughness;this.metalness=a.metalness;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=
a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.roughnessMap=a.roughnessMap;this.metalnessMap=a.metalnessMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.envMapIntensity=a.envMapIntensity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;
this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};THREE.MeshPhysicalMaterial=function(a){THREE.MeshStandardMaterial.call(this);this.defines={PHYSICAL:""};this.type="MeshPhysicalMaterial";this.reflectivity=.5;this.clearCoatRoughness=this.clearCoat=0;this.setValues(a)};THREE.MeshPhysicalMaterial.prototype=Object.create(THREE.MeshStandardMaterial.prototype);THREE.MeshPhysicalMaterial.prototype.constructor=THREE.MeshPhysicalMaterial;
THREE.MeshPhysicalMaterial.prototype.copy=function(a){THREE.MeshStandardMaterial.prototype.copy.call(this,a);this.defines={PHYSICAL:""};this.reflectivity=a.reflectivity;this.clearCoat=a.clearCoat;this.clearCoatRoughness=a.clearCoatRoughness;return this};THREE.MultiMaterial=function(a){this.uuid=THREE.Math.generateUUID();this.type="MultiMaterial";this.materials=a instanceof Array?a:[];this.visible=!0};
THREE.MultiMaterial.prototype={constructor:THREE.MultiMaterial,toJSON:function(a){for(var b={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},c=this.materials,e=0,d=c.length;e<d;e++){var g=c[e].toJSON(a);delete g.metadata;b.materials.push(g)}b.visible=this.visible;return b},clone:function(){for(var a=new this.constructor,b=0;b<this.materials.length;b++)a.materials.push(this.materials[b].clone());a.visible=this.visible;return a}};
THREE.PointsMaterial=function(a){THREE.Material.call(this);this.type="PointsMaterial";this.color=new THREE.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.lights=!1;this.setValues(a)};THREE.PointsMaterial.prototype=Object.create(THREE.Material.prototype);THREE.PointsMaterial.prototype.constructor=THREE.PointsMaterial;
THREE.PointsMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.size=a.size;this.sizeAttenuation=a.sizeAttenuation;return this};
THREE.ShaderMaterial=function(a){THREE.Material.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,
drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;void 0!==a&&(void 0!==a.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(a))};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial;
THREE.ShaderMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.fragmentShader=a.fragmentShader;this.vertexShader=a.vertexShader;this.uniforms=THREE.UniformsUtils.clone(a.uniforms);this.defines=a.defines;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.lights=a.lights;this.clipping=a.clipping;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;this.extensions=a.extensions;return this};
THREE.ShaderMaterial.prototype.toJSON=function(a){a=THREE.Material.prototype.toJSON.call(this,a);a.uniforms=this.uniforms;a.vertexShader=this.vertexShader;a.fragmentShader=this.fragmentShader;return a};THREE.RawShaderMaterial=function(a){THREE.ShaderMaterial.call(this,a);this.type="RawShaderMaterial"};THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);THREE.RawShaderMaterial.prototype.constructor=THREE.RawShaderMaterial;
THREE.SpriteMaterial=function(a){THREE.Material.call(this);this.type="SpriteMaterial";this.color=new THREE.Color(16777215);this.map=null;this.rotation=0;this.lights=this.fog=!1;this.setValues(a)};THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteMaterial.prototype.constructor=THREE.SpriteMaterial;THREE.SpriteMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.rotation=a.rotation;return this};
THREE.ShadowMaterial=function(){THREE.ShaderMaterial.call(this,{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.lights,{opacity:{value:1}}]),vertexShader:THREE.ShaderChunk.shadow_vert,fragmentShader:THREE.ShaderChunk.shadow_frag});this.transparent=this.lights=!0;Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(a){this.uniforms.opacity.value=a}}})};THREE.ShadowMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);
THREE.ShadowMaterial.prototype.constructor=THREE.ShadowMaterial;
THREE.Texture=function(a,b,c,e,d,g,f,h,k,l){Object.defineProperty(this,"id",{value:THREE.TextureIdCount++});this.uuid=THREE.Math.generateUUID();this.sourceFile=this.name="";this.image=void 0!==a?a:THREE.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==b?b:THREE.Texture.DEFAULT_MAPPING;this.wrapS=void 0!==c?c:THREE.ClampToEdgeWrapping;this.wrapT=void 0!==e?e:THREE.ClampToEdgeWrapping;this.magFilter=void 0!==d?d:THREE.LinearFilter;this.minFilter=void 0!==g?g:THREE.LinearMipMapLinearFilter;
this.anisotropy=void 0!==k?k:1;this.format=void 0!==f?f:THREE.RGBAFormat;this.type=void 0!==h?h:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==l?l:THREE.LinearEncoding;this.version=0;this.onUpdate=null};THREE.Texture.DEFAULT_IMAGE=void 0;THREE.Texture.DEFAULT_MAPPING=THREE.UVMapping;
THREE.Texture.prototype={constructor:THREE.Texture,set needsUpdate(a){!0===a&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.image=a.image;this.mipmaps=a.mipmaps.slice(0);this.mapping=a.mapping;this.wrapS=a.wrapS;this.wrapT=a.wrapT;this.magFilter=a.magFilter;this.minFilter=a.minFilter;this.anisotropy=a.anisotropy;this.format=a.format;this.type=a.type;this.offset.copy(a.offset);this.repeat.copy(a.repeat);this.generateMipmaps=a.generateMipmaps;this.premultiplyAlpha=
a.premultiplyAlpha;this.flipY=a.flipY;this.unpackAlignment=a.unpackAlignment;this.encoding=a.encoding;return this},toJSON:function(a){if(void 0!==a.textures[this.uuid])return a.textures[this.uuid];var b={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};
if(void 0!==this.image){var c=this.image;void 0===c.uuid&&(c.uuid=THREE.Math.generateUUID());if(void 0===a.images[c.uuid]){var e=a.images,d=c.uuid,g=c.uuid,f;void 0!==c.toDataURL?f=c:(f=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),f.width=c.width,f.height=c.height,f.getContext("2d").drawImage(c,0,0,c.width,c.height));f=2048<f.width||2048<f.height?f.toDataURL("image/jpeg",.6):f.toDataURL("image/png");e[d]={uuid:g,url:f}}b.image=c.uuid}return a.textures[this.uuid]=b},dispose:function(){this.dispatchEvent({type:"dispose"})},
transformUv:function(a){if(this.mapping===THREE.UVMapping){a.multiply(this.repeat);a.add(this.offset);if(0>a.x||1<a.x)switch(this.wrapS){case THREE.RepeatWrapping:a.x-=Math.floor(a.x);break;case THREE.ClampToEdgeWrapping:a.x=0>a.x?0:1;break;case THREE.MirroredRepeatWrapping:1===Math.abs(Math.floor(a.x)%2)?a.x=Math.ceil(a.x)-a.x:a.x-=Math.floor(a.x)}if(0>a.y||1<a.y)switch(this.wrapT){case THREE.RepeatWrapping:a.y-=Math.floor(a.y);break;case THREE.ClampToEdgeWrapping:a.y=0>a.y?0:1;break;case THREE.MirroredRepeatWrapping:1===
Math.abs(Math.floor(a.y)%2)?a.y=Math.ceil(a.y)-a.y:a.y-=Math.floor(a.y)}this.flipY&&(a.y=1-a.y)}}};Object.assign(THREE.Texture.prototype,THREE.EventDispatcher.prototype);THREE.TextureIdCount=0;
THREE.DepthTexture=function(a,b,c,e,d,g,f,h,k){THREE.Texture.call(this,null,e,d,g,f,h,THREE.DepthFormat,c,k);this.image={width:a,height:b};this.type=void 0!==c?c:THREE.UnsignedShortType;this.magFilter=void 0!==f?f:THREE.NearestFilter;this.minFilter=void 0!==h?h:THREE.NearestFilter;this.generateMipmaps=this.flipY=!1};THREE.DepthTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DepthTexture.prototype.constructor=THREE.DepthTexture;
THREE.CanvasTexture=function(a,b,c,e,d,g,f,h,k){THREE.Texture.call(this,a,b,c,e,d,g,f,h,k);this.needsUpdate=!0};THREE.CanvasTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CanvasTexture.prototype.constructor=THREE.CanvasTexture;THREE.CubeTexture=function(a,b,c,e,d,g,f,h,k,l){a=void 0!==a?a:[];b=void 0!==b?b:THREE.CubeReflectionMapping;THREE.Texture.call(this,a,b,c,e,d,g,f,h,k,l);this.flipY=!1};THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype);
THREE.CubeTexture.prototype.constructor=THREE.CubeTexture;Object.defineProperty(THREE.CubeTexture.prototype,"images",{get:function(){return this.image},set:function(a){this.image=a}});THREE.CompressedTexture=function(a,b,c,e,d,g,f,h,k,l,n,q){THREE.Texture.call(this,null,g,f,h,k,l,e,d,n,q);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.constructor=THREE.CompressedTexture;
THREE.DataTexture=function(a,b,c,e,d,g,f,h,k,l,n,q){THREE.Texture.call(this,null,g,f,h,k,l,e,d,n,q);this.image={data:a,width:b,height:c};this.magFilter=void 0!==k?k:THREE.NearestFilter;this.minFilter=void 0!==l?l:THREE.NearestFilter;this.generateMipmaps=this.flipY=!1};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.constructor=THREE.DataTexture;
THREE.VideoTexture=function(a,b,c,e,d,g,f,h,k){function l(){requestAnimationFrame(l);a.readyState>=a.HAVE_CURRENT_DATA&&(n.needsUpdate=!0)}THREE.Texture.call(this,a,b,c,e,d,g,f,h,k);this.generateMipmaps=!1;var n=this;l()};THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype);THREE.VideoTexture.prototype.constructor=THREE.VideoTexture;THREE.Group=function(){THREE.Object3D.call(this);this.type="Group"};THREE.Group.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Group});
THREE.Points=function(a,b){THREE.Object3D.call(this);this.type="Points";this.geometry=void 0!==a?a:new THREE.BufferGeometry;this.material=void 0!==b?b:new THREE.PointsMaterial({color:16777215*Math.random()})};
THREE.Points.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Points,raycast:function(){var a=new THREE.Matrix4,b=new THREE.Ray,c=new THREE.Sphere;return function(e,d){function g(a,c){var g=b.distanceSqToPoint(a);if(g<n){var h=b.closestPointToPoint(a);h.applyMatrix4(k);var m=e.ray.origin.distanceTo(h);m<e.near||m>e.far||d.push({distance:m,distanceToRay:Math.sqrt(g),point:h.clone(),index:c,face:null,object:f})}}var f=this,h=this.geometry,k=this.matrixWorld,l=e.params.Points.threshold;
null===h.boundingSphere&&h.computeBoundingSphere();c.copy(h.boundingSphere);c.applyMatrix4(k);if(!1!==e.ray.intersectsSphere(c)){a.getInverse(k);b.copy(e.ray).applyMatrix4(a);var l=l/((this.scale.x+this.scale.y+this.scale.z)/3),n=l*l,l=new THREE.Vector3;if(h instanceof THREE.BufferGeometry){var q=h.index,h=h.attributes.position.array;if(null!==q)for(var m=q.array,q=0,p=m.length;q<p;q++){var r=m[q];l.fromArray(h,3*r);g(l,r)}else for(q=0,m=h.length/3;q<m;q++)l.fromArray(h,3*q),g(l,q)}else for(l=h.vertices,
q=0,m=l.length;q<m;q++)g(l[q],q)}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});THREE.Line=function(a,b,c){if(1===c)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new THREE.LineSegments(a,b);THREE.Object3D.call(this);this.type="Line";this.geometry=void 0!==a?a:new THREE.BufferGeometry;this.material=void 0!==b?b:new THREE.LineBasicMaterial({color:16777215*Math.random()})};
THREE.Line.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Line,raycast:function(){var a=new THREE.Matrix4,b=new THREE.Ray,c=new THREE.Sphere;return function(e,d){var g=e.linePrecision,g=g*g,f=this.geometry,h=this.matrixWorld;null===f.boundingSphere&&f.computeBoundingSphere();c.copy(f.boundingSphere);c.applyMatrix4(h);if(!1!==e.ray.intersectsSphere(c)){a.getInverse(h);b.copy(e.ray).applyMatrix4(a);var k=new THREE.Vector3,l=new THREE.Vector3,h=new THREE.Vector3,n=
new THREE.Vector3,q=this instanceof THREE.LineSegments?2:1;if(f instanceof THREE.BufferGeometry){var m=f.index,p=f.attributes.position.array;if(null!==m)for(var m=m.array,f=0,r=m.length-1;f<r;f+=q){var t=m[f+1];k.fromArray(p,3*m[f]);l.fromArray(p,3*t);t=b.distanceSqToSegment(k,l,n,h);t>g||(n.applyMatrix4(this.matrixWorld),t=e.ray.origin.distanceTo(n),t<e.near||t>e.far||d.push({distance:t,point:h.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}else for(f=0,r=
p.length/3-1;f<r;f+=q)k.fromArray(p,3*f),l.fromArray(p,3*f+3),t=b.distanceSqToSegment(k,l,n,h),t>g||(n.applyMatrix4(this.matrixWorld),t=e.ray.origin.distanceTo(n),t<e.near||t>e.far||d.push({distance:t,point:h.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}else if(f instanceof THREE.Geometry)for(k=f.vertices,l=k.length,f=0;f<l-1;f+=q)t=b.distanceSqToSegment(k[f],k[f+1],n,h),t>g||(n.applyMatrix4(this.matrixWorld),t=e.ray.origin.distanceTo(n),t<e.near||t>e.far||
d.push({distance:t,point:h.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});THREE.LineSegments=function(a,b){THREE.Line.call(this,a,b);this.type="LineSegments"};THREE.LineSegments.prototype=Object.assign(Object.create(THREE.Line.prototype),{constructor:THREE.LineSegments});
THREE.Mesh=function(a,b){THREE.Object3D.call(this);this.type="Mesh";this.geometry=void 0!==a?a:new THREE.BufferGeometry;this.material=void 0!==b?b:new THREE.MeshBasicMaterial({color:16777215*Math.random()});this.drawMode=THREE.TrianglesDrawMode;this.updateMorphTargets()};
THREE.Mesh.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Mesh,setDrawMode:function(a){this.drawMode=a},copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.drawMode=a.drawMode;return this},updateMorphTargets:function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),
this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}},getMorphTargetIndexByName:function(a){if(void 0!==this.morphTargetDictionary[a])return this.morphTargetDictionary[a];console.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0},raycast:function(){function a(a,b,c,d,e,f,g){THREE.Triangle.barycoordFromPoint(a,b,c,d,t);e.multiplyScalar(t.x);f.multiplyScalar(t.y);g.multiplyScalar(t.z);e.add(f).add(g);return e.clone()}function b(a,b,c,
d,e,f,g){var h=a.material;if(null===(h.side===THREE.BackSide?c.intersectTriangle(f,e,d,!0,g):c.intersectTriangle(d,e,f,h.side!==THREE.DoubleSide,g)))return null;v.copy(g);v.applyMatrix4(a.matrixWorld);c=b.ray.origin.distanceTo(v);return c<b.near||c>b.far?null:{distance:c,point:v.clone(),object:a}}function c(c,d,e,g,l,n,q,t){f.fromArray(g,3*n);h.fromArray(g,3*q);k.fromArray(g,3*t);if(c=b(c,d,e,f,h,k,w))l&&(m.fromArray(l,2*n),p.fromArray(l,2*q),r.fromArray(l,2*t),c.uv=a(w,f,h,k,m,p,r)),c.face=new THREE.Face3(n,
q,t,THREE.Triangle.normal(f,h,k)),c.faceIndex=n;return c}var e=new THREE.Matrix4,d=new THREE.Ray,g=new THREE.Sphere,f=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector3,n=new THREE.Vector3,q=new THREE.Vector3,m=new THREE.Vector2,p=new THREE.Vector2,r=new THREE.Vector2,t=new THREE.Vector3,w=new THREE.Vector3,v=new THREE.Vector3;return function(t,v){var u=this.geometry,z=this.material,y=this.matrixWorld;if(void 0!==z&&(null===u.boundingSphere&&u.computeBoundingSphere(),g.copy(u.boundingSphere),
g.applyMatrix4(y),!1!==t.ray.intersectsSphere(g)&&(e.getInverse(y),d.copy(t.ray).applyMatrix4(e),null===u.boundingBox||!1!==d.intersectsBox(u.boundingBox)))){var B,C;if(u instanceof THREE.BufferGeometry){var F,H,z=u.index,y=u.attributes,u=y.position.array;void 0!==y.uv&&(B=y.uv.array);if(null!==z)for(var y=z.array,K=0,M=y.length;K<M;K+=3){if(z=y[K],F=y[K+1],H=y[K+2],C=c(this,t,d,u,B,z,F,H))C.faceIndex=Math.floor(K/3),v.push(C)}else for(K=0,M=u.length;K<M;K+=9)if(z=K/3,F=z+1,H=z+2,C=c(this,t,d,u,B,
z,F,H))C.index=z,v.push(C)}else if(u instanceof THREE.Geometry){var O,I,y=z instanceof THREE.MultiMaterial,K=!0===y?z.materials:null,M=u.vertices;F=u.faces;H=u.faceVertexUvs[0];0<H.length&&(B=H);for(var D=0,J=F.length;D<J;D++){var N=F[D];C=!0===y?K[N.materialIndex]:z;if(void 0!==C){H=M[N.a];O=M[N.b];I=M[N.c];if(!0===C.morphTargets){C=u.morphTargets;var S=this.morphTargetInfluences;f.set(0,0,0);h.set(0,0,0);k.set(0,0,0);for(var Q=0,R=C.length;Q<R;Q++){var G=S[Q];if(0!==G){var P=C[Q].vertices;f.addScaledVector(l.subVectors(P[N.a],
H),G);h.addScaledVector(n.subVectors(P[N.b],O),G);k.addScaledVector(q.subVectors(P[N.c],I),G)}}f.add(H);h.add(O);k.add(I);H=f;O=h;I=k}if(C=b(this,t,d,H,O,I,w))B&&(S=B[D],m.copy(S[0]),p.copy(S[1]),r.copy(S[2]),C.uv=a(w,H,O,I,m,p,r)),C.face=N,C.faceIndex=D,v.push(C)}}}}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});THREE.Bone=function(a){THREE.Object3D.call(this);this.type="Bone";this.skin=a};
THREE.Bone.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Bone,copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.skin=a.skin;return this}});
THREE.Skeleton=function(a,b,c){this.useVertexTexture=void 0!==c?c:!0;this.identityMatrix=new THREE.Matrix4;a=a||[];this.bones=a.slice(0);this.useVertexTexture?(a=Math.sqrt(4*this.bones.length),a=THREE.Math.nextPowerOfTwo(Math.ceil(a)),this.boneTextureHeight=this.boneTextureWidth=Math.max(a,4),this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType)):
this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===b)this.calculateInverses();else if(this.bones.length===b.length)this.boneInverses=b.slice(0);else for(console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[],b=0,a=this.bones.length;b<a;b++)this.boneInverses.push(new THREE.Matrix4)};
Object.assign(THREE.Skeleton.prototype,{calculateInverses:function(){this.boneInverses=[];for(var a=0,b=this.bones.length;a<b;a++){var c=new THREE.Matrix4;this.bones[a]&&c.getInverse(this.bones[a].matrixWorld);this.boneInverses.push(c)}},pose:function(){for(var a,b=0,c=this.bones.length;b<c;b++)(a=this.bones[b])&&a.matrixWorld.getInverse(this.boneInverses[b]);b=0;for(c=this.bones.length;b<c;b++)if(a=this.bones[b])a.parent instanceof THREE.Bone?(a.matrix.getInverse(a.parent.matrixWorld),a.matrix.multiply(a.matrixWorld)):
a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale)},update:function(){var a=new THREE.Matrix4;return function(){for(var b=0,c=this.bones.length;b<c;b++)a.multiplyMatrices(this.bones[b]?this.bones[b].matrixWorld:this.identityMatrix,this.boneInverses[b]),a.toArray(this.boneMatrices,16*b);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),clone:function(){return new THREE.Skeleton(this.bones,this.boneInverses,this.useVertexTexture)}});
THREE.SkinnedMesh=function(a,b,c){THREE.Mesh.call(this,a,b);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new THREE.Matrix4;this.bindMatrixInverse=new THREE.Matrix4;a=[];if(this.geometry&&void 0!==this.geometry.bones){for(var e,d=0,g=this.geometry.bones.length;d<g;++d)e=this.geometry.bones[d],b=new THREE.Bone(this),a.push(b),b.name=e.name,b.position.fromArray(e.pos),b.quaternion.fromArray(e.rotq),void 0!==e.scl&&b.scale.fromArray(e.scl);d=0;for(g=this.geometry.bones.length;d<g;++d)e=
this.geometry.bones[d],-1!==e.parent&&null!==e.parent&&void 0!==a[e.parent]?a[e.parent].add(a[d]):this.add(a[d])}this.normalizeSkinWeights();this.updateMatrixWorld(!0);this.bind(new THREE.Skeleton(a,void 0,c),this.matrixWorld)};
THREE.SkinnedMesh.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.SkinnedMesh,bind:function(a,b){this.skeleton=a;void 0===b&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),b=this.matrixWorld);this.bindMatrix.copy(b);this.bindMatrixInverse.getInverse(b)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry instanceof THREE.Geometry)for(var a=0;a<this.geometry.skinWeights.length;a++){var b=this.geometry.skinWeights[a],c=
1/b.lengthManhattan();Infinity!==c?b.multiplyScalar(c):b.set(1,0,0,0)}else if(this.geometry instanceof THREE.BufferGeometry)for(var b=new THREE.Vector4,e=this.geometry.attributes.skinWeight,a=0;a<e.count;a++)b.x=e.getX(a),b.y=e.getY(a),b.z=e.getZ(a),b.w=e.getW(a),c=1/b.lengthManhattan(),Infinity!==c?b.multiplyScalar(c):b.set(1,0,0,0),e.setXYZW(a,b.x,b.y,b.z,b.w)},updateMatrixWorld:function(a){THREE.Mesh.prototype.updateMatrixWorld.call(this,!0);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):
"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},clone:function(){return(new this.constructor(this.geometry,this.material,this.skeleton.useVertexTexture)).copy(this)}});THREE.LOD=function(){THREE.Object3D.call(this);this.type="LOD";Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})};
THREE.LOD.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.LOD,copy:function(a){THREE.Object3D.prototype.copy.call(this,a,!1);a=a.levels;for(var b=0,c=a.length;b<c;b++){var e=a[b];this.addLevel(e.object.clone(),e.distance)}return this},addLevel:function(a,b){void 0===b&&(b=0);b=Math.abs(b);for(var c=this.levels,e=0;e<c.length&&!(b<c[e].distance);e++);c.splice(e,0,{distance:b,object:a});this.add(a)},getObjectForDistance:function(a){for(var b=this.levels,c=1,e=b.length;c<
e&&!(a<b[c].distance);c++);return b[c-1].object},raycast:function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var e=b.ray.origin.distanceTo(a);this.getObjectForDistance(e).raycast(b,c)}}(),update:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){var e=this.levels;if(1<e.length){a.setFromMatrixPosition(c.matrixWorld);b.setFromMatrixPosition(this.matrixWorld);c=a.distanceTo(b);e[0].object.visible=!0;for(var d=1,g=e.length;d<g;d++)if(c>=
e[d].distance)e[d-1].object.visible=!1,e[d].object.visible=!0;else break;for(;d<g;d++)e[d].object.visible=!1}}}(),toJSON:function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.levels=[];for(var b=this.levels,c=0,e=b.length;c<e;c++){var d=b[c];a.object.levels.push({object:d.object.uuid,distance:d.distance})}return a}});THREE.Sprite=function(a){THREE.Object3D.call(this);this.type="Sprite";this.material=void 0!==a?a:new THREE.SpriteMaterial};
THREE.Sprite.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Sprite,raycast:function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var e=b.ray.distanceSqToPoint(a);e>this.scale.x*this.scale.y/4||c.push({distance:Math.sqrt(e),point:this.position,face:null,object:this})}}(),clone:function(){return(new this.constructor(this.material)).copy(this)}});
THREE.LensFlare=function(a,b,c,e,d){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=void 0;void 0!==a&&this.add(a,b,c,e,d)};
THREE.LensFlare.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.LensFlare,copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.positionScreen.copy(a.positionScreen);this.customUpdateCallback=a.customUpdateCallback;for(var b=0,c=a.lensFlares.length;b<c;b++)this.lensFlares.push(a.lensFlares[b]);return this},add:function(a,b,c,e,d,g){void 0===b&&(b=-1);void 0===c&&(c=0);void 0===g&&(g=1);void 0===d&&(d=new THREE.Color(16777215));void 0===e&&(e=THREE.NormalBlending);
c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:a,size:b,distance:c,x:0,y:0,z:0,scale:1,rotation:0,opacity:g,color:d,blending:e})},updateLensFlares:function(){var a,b=this.lensFlares.length,c,e=2*-this.positionScreen.x,d=2*-this.positionScreen.y;for(a=0;a<b;a++)c=this.lensFlares[a],c.x=this.positionScreen.x+e*c.distance,c.y=this.positionScreen.y+d*c.distance,c.wantedRotation=c.x*Math.PI*.25,c.rotation+=.25*(c.wantedRotation-c.rotation)}});
THREE.Scene=function(){THREE.Object3D.call(this);this.type="Scene";this.overrideMaterial=this.fog=this.background=null;this.autoUpdate=!0};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.constructor=THREE.Scene;
THREE.Scene.prototype.copy=function(a,b){THREE.Object3D.prototype.copy.call(this,a,b);null!==a.background&&(this.background=a.background.clone());null!==a.fog&&(this.fog=a.fog.clone());null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone());this.autoUpdate=a.autoUpdate;this.matrixAutoUpdate=a.matrixAutoUpdate;return this};THREE.Fog=function(a,b,c){this.name="";this.color=new THREE.Color(a);this.near=void 0!==b?b:1;this.far=void 0!==c?c:1E3};
THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)};THREE.FogExp2=function(a,b){this.name="";this.color=new THREE.Color(a);this.density=void 0!==b?b:2.5E-4};THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)};THREE.ShaderChunk={};THREE.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n";THREE.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n";
THREE.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n";THREE.ShaderChunk.aomap_fragment="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n";
THREE.ShaderChunk.aomap_pars_fragment="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif";THREE.ShaderChunk.begin_vertex="\nvec3 transformed = vec3( position );\n";THREE.ShaderChunk.beginnormal_vertex="\nvec3 objectNormal = vec3( normal );\n";THREE.ShaderChunk.bsdfs="bool testLightInRange( const in float lightDistance, const in float cutoffDistance ) {\n\treturn any( bvec2( cutoffDistance == 0.0, lightDistance < cutoffDistance ) );\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n";
THREE.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n";
THREE.ShaderChunk.clipping_planes_fragment="#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n#endif\n";THREE.ShaderChunk.clipping_planes_pars_fragment="#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n";
THREE.ShaderChunk.clipping_planes_pars_vertex="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n";THREE.ShaderChunk.clipping_planes_vertex="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n";THREE.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif";THREE.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n";
THREE.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif";THREE.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif";THREE.ShaderChunk.common="#define PI 3.14159265359\n#define PI2 6.28318530718\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\n";
THREE.ShaderChunk.cube_uv_reflection_fragment="#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n";
THREE.ShaderChunk.defaultnormal_vertex="#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n";THREE.ShaderChunk.displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n";THREE.ShaderChunk.displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n";
THREE.ShaderChunk.emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n";THREE.ShaderChunk.emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n";THREE.ShaderChunk.encodings_pars_fragment="\nvec4 LinearToLinear( in vec4 value ) {\n  return value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n  float maxComponent = max( max( value.r, value.g ), value.b );\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n  float maxRGB = max( value.x, max( value.g, value.b ) );\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n  M            = ceil( M * 255.0 ) / 255.0;\n  return vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n    float maxRGB = max( value.x, max( value.g, value.b ) );\n    float D      = max( maxRange / maxRGB, 1.0 );\n    D            = min( floor( D ) / 255.0, 1.0 );\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n  vec4 vResult;\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n  vResult.w = fract(Le);\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n  return vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n  float Le = value.z * 255.0 + value.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n  return vec4( max(vRGB, 0.0), 1.0 );\n}\n";
THREE.ShaderChunk.encodings_fragment="  gl_FragColor = linearToOutputTexel( gl_FragColor );\n";THREE.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n";
THREE.ShaderChunk.envmap_pars_fragment="#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntenstiy;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n";
THREE.ShaderChunk.envmap_pars_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n";THREE.ShaderChunk.envmap_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n";
THREE.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n";
THREE.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif";THREE.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n";THREE.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif";
THREE.ShaderChunk.lights_lambert_vertex="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n";
THREE.ShaderChunk.lights_pars="uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tif ( testLightInRange( lightDistance, pointLight.distance ) ) {\n\t\t\tdirectLight.color = pointLight.color;\n\t\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( all( bvec2( angleCos > spotLight.coneCos, testLightInRange( lightDistance, spotLight.distance ) ) ) ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\t#include <normal_flip>\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\t#include <normal_flip>\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n";
THREE.ShaderChunk.lights_phong_fragment="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n";THREE.ShaderChunk.lights_phong_pars_fragment="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n";
THREE.ShaderChunk.lights_physical_fragment="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n";
THREE.ShaderChunk.lights_physical_pars_fragment="struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n";
THREE.ShaderChunk.lights_template="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t \tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\t\t\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n";
THREE.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif";THREE.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n";THREE.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif";
THREE.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n";THREE.ShaderChunk.map_fragment="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n";
THREE.ShaderChunk.map_pars_fragment="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n";THREE.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n";THREE.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n";THREE.ShaderChunk.metalnessmap_fragment="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.r;\n#endif\n";
THREE.ShaderChunk.metalnessmap_pars_fragment="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif";THREE.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n";
THREE.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif";THREE.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n";
THREE.ShaderChunk.normal_flip="#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n";THREE.ShaderChunk.normal_fragment="#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n";
THREE.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n";
THREE.ShaderChunk.packing="vec3 packNormalToRGB( const in vec3 normal ) {\n  return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n  return 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n  return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n  return linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n";
THREE.ShaderChunk.premultiplied_alpha_fragment="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n";THREE.ShaderChunk.project_vertex="#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n";THREE.ShaderChunk.roughnessmap_fragment="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.r;\n#endif\n";
THREE.ShaderChunk.roughnessmap_pars_fragment="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif";THREE.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n";
THREE.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n";
THREE.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n";
THREE.ShaderChunk.shadowmask_pars_fragment="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n";
THREE.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif";THREE.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n";
THREE.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n";THREE.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n";
THREE.ShaderChunk.specularmap_fragment="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif";THREE.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif";THREE.ShaderChunk.tonemapping_fragment="#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n";
THREE.ShaderChunk.tonemapping_pars_fragment="#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n  return toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  color = max( vec3( 0.0 ), color - 0.004 );\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n";
THREE.ShaderChunk.uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif";THREE.ShaderChunk.uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif";THREE.ShaderChunk.uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif";THREE.ShaderChunk.uv_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif";
THREE.ShaderChunk.uv_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n";THREE.ShaderChunk.uv_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif";
THREE.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n";
THREE.UniformsUtils={merge:function(a){for(var b={},c=0;c<a.length;c++){var e=this.clone(a[c]),d;for(d in e)b[d]=e[d]}return b},clone:function(a){var b={},c;for(c in a){b[c]={};for(var e in a[c]){var d=a[c][e];d instanceof THREE.Color||d instanceof THREE.Vector2||d instanceof THREE.Vector3||d instanceof THREE.Vector4||d instanceof THREE.Matrix3||d instanceof THREE.Matrix4||d instanceof THREE.Texture?b[c][e]=d.clone():Array.isArray(d)?b[c][e]=d.slice():b[c][e]=d}}return b}};
THREE.UniformsLib={common:{diffuse:{value:new THREE.Color(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new THREE.Vector4(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},
normalScale:{value:new THREE.Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},fog:{fogDensity:{value:2.5E-4},fogNear:{value:1},fogFar:{value:2E3},fogColor:{value:new THREE.Color(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},
directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},
skyColor:{},groundColor:{}}}},points:{diffuse:{value:new THREE.Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new THREE.Vector4(0,0,1,1)}}};THREE.ShaderChunk.cube_frag="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n";
THREE.ShaderChunk.cube_vert="varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n";THREE.ShaderChunk.depth_frag="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n";
THREE.ShaderChunk.depth_vert="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n";
THREE.ShaderChunk.distanceRGBA_frag="uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n";THREE.ShaderChunk.distanceRGBA_vert="varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n";
THREE.ShaderChunk.equirect_frag="uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n";THREE.ShaderChunk.equirect_vert="varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n";
THREE.ShaderChunk.linedashed_frag="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
THREE.ShaderChunk.linedashed_vert="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n";
THREE.ShaderChunk.meshbasic_frag="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight;\n\treflectedLight.directDiffuse = vec3( 0.0 );\n\treflectedLight.directSpecular = vec3( 0.0 );\n\treflectedLight.indirectDiffuse = diffuseColor.rgb;\n\treflectedLight.indirectSpecular = vec3( 0.0 );\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
THREE.ShaderChunk.meshbasic_vert="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n}\n";
THREE.ShaderChunk.meshlambert_frag="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
THREE.ShaderChunk.meshlambert_vert="#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n}\n";
THREE.ShaderChunk.meshphong_frag="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
THREE.ShaderChunk.meshphong_vert="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n}\n";
THREE.ShaderChunk.meshphysical_frag="#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nuniform float envMapIntensity;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
THREE.ShaderChunk.meshphysical_vert="#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n";
THREE.ShaderChunk.normal_frag="uniform float opacity;\nvarying vec3 vNormal;\n#include <common>\n#include <packing>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( vNormal ), opacity );\n\t#include <logdepthbuf_fragment>\n}\n";THREE.ShaderChunk.normal_vert="varying vec3 vNormal;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvNormal = normalize( normalMatrix * normal );\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n";
THREE.ShaderChunk.points_frag="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
THREE.ShaderChunk.points_vert="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n";
THREE.ShaderChunk.shadow_frag="uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0  - getShadowMask() ) );\n}\n";THREE.ShaderChunk.shadow_vert="#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n";
THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.fog]),vertexShader:THREE.ShaderChunk.meshbasic_vert,fragmentShader:THREE.ShaderChunk.meshbasic_frag},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{value:new THREE.Color(0)}}]),vertexShader:THREE.ShaderChunk.meshlambert_vert,
fragmentShader:THREE.ShaderChunk.meshlambert_frag},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.bumpmap,THREE.UniformsLib.normalmap,THREE.UniformsLib.displacementmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{value:new THREE.Color(0)},specular:{value:new THREE.Color(1118481)},shininess:{value:30}}]),vertexShader:THREE.ShaderChunk.meshphong_vert,fragmentShader:THREE.ShaderChunk.meshphong_frag},
standard:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.bumpmap,THREE.UniformsLib.normalmap,THREE.UniformsLib.displacementmap,THREE.UniformsLib.roughnessmap,THREE.UniformsLib.metalnessmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{value:new THREE.Color(0)},roughness:{value:.5},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:THREE.ShaderChunk.meshphysical_vert,
fragmentShader:THREE.ShaderChunk.meshphysical_frag},points:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.points,THREE.UniformsLib.fog]),vertexShader:THREE.ShaderChunk.points_vert,fragmentShader:THREE.ShaderChunk.points_frag},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:THREE.ShaderChunk.linedashed_vert,fragmentShader:THREE.ShaderChunk.linedashed_frag},depth:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,
THREE.UniformsLib.displacementmap]),vertexShader:THREE.ShaderChunk.depth_vert,fragmentShader:THREE.ShaderChunk.depth_frag},normal:{uniforms:{opacity:{value:1}},vertexShader:THREE.ShaderChunk.normal_vert,fragmentShader:THREE.ShaderChunk.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:THREE.ShaderChunk.cube_vert,fragmentShader:THREE.ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:THREE.ShaderChunk.equirect_vert,
fragmentShader:THREE.ShaderChunk.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new THREE.Vector3}},vertexShader:THREE.ShaderChunk.distanceRGBA_vert,fragmentShader:THREE.ShaderChunk.distanceRGBA_frag}};THREE.ShaderLib.physical={uniforms:THREE.UniformsUtils.merge([THREE.ShaderLib.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:THREE.ShaderChunk.meshphysical_vert,fragmentShader:THREE.ShaderChunk.meshphysical_frag};
THREE.WebGLRenderer=function(a){function b(a,b,c,d){!0===C&&(a*=d,b*=d,c*=d);X.clearColor(a,b,c,d)}function c(){X.init();X.scissor(Y.copy(ua).multiplyScalar(da));X.viewport(ba.copy(ya).multiplyScalar(da));b(U.r,U.g,U.b,Z)}function e(){V=Q=null;T="";P=-1;X.reset()}function d(a){a.preventDefault();e();c();ha.clear()}function g(a){a=a.target;a.removeEventListener("dispose",g);f(a);ha["delete"](a)}function f(a){var b=ha.get(a).program;a.program=void 0;void 0!==b&&qa.releaseProgram(b)}function h(a,b){return Math.abs(b[0])-
Math.abs(a[0])}function k(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.material.program&&b.material.program&&a.material.program!==b.material.program?a.material.program.id-b.material.program.id:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function l(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function n(a,b,c,d,e){var f;c.transparent?
(d=O,f=++I):(d=K,f=++M);f=d[f];void 0!==f?(f.id=a.id,f.object=a,f.geometry=b,f.material=c,f.z=ga.z,f.group=e):(f={id:a.id,object:a,geometry:b,material:c,z:ga.z,group:e},d.push(f))}function q(a){if(!Ea.intersectsSphere(a))return!1;var b=na.numPlanes;if(0===b)return!0;var c=S.clippingPlanes,d=a.center;a=-a.radius;var e=0;do if(c[e].distanceToPoint(d)<a)return!1;while(++e!==b);return!0}function m(a,b){if(!1!==a.visible){if(a.layers.test(b.layers))if(a instanceof THREE.Light)H.push(a);else if(a instanceof
THREE.Sprite){var c;(c=!1===a.frustumCulled)||(va.center.set(0,0,0),va.radius=.7071067811865476,va.applyMatrix4(a.matrixWorld),c=!0===q(va));c&&J.push(a)}else if(a instanceof THREE.LensFlare)N.push(a);else if(a instanceof THREE.ImmediateRenderObject)!0===S.sortObjects&&(ga.setFromMatrixPosition(a.matrixWorld),ga.applyProjection(Aa)),n(a,null,a.material,ga.z,null);else if(a instanceof THREE.Mesh||a instanceof THREE.Line||a instanceof THREE.Points)if(a instanceof THREE.SkinnedMesh&&a.skeleton.update(),
(c=!1===a.frustumCulled)||(c=a.geometry,null===c.boundingSphere&&c.computeBoundingSphere(),va.copy(c.boundingSphere).applyMatrix4(a.matrixWorld),c=!0===q(va)),c){var d=a.material;if(!0===d.visible)if(!0===S.sortObjects&&(ga.setFromMatrixPosition(a.matrixWorld),ga.applyProjection(Aa)),c=pa.update(a),d instanceof THREE.MultiMaterial)for(var e=c.groups,f=d.materials,d=0,g=e.length;d<g;d++){var h=e[d],k=f[h.materialIndex];!0===k.visible&&n(a,c,k,ga.z,h)}else n(a,c,d,ga.z,null)}c=a.children;d=0;for(g=
c.length;d<g;d++)m(c[d],b)}}function p(a,b,c,d){for(var e=0,f=a.length;e<f;e++){var g=a[e],h=g.object,k=g.geometry,m=void 0===d?g.material:d,g=g.group;h.modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,h.matrixWorld);h.normalMatrix.getNormalMatrix(h.modelViewMatrix);if(h instanceof THREE.ImmediateRenderObject){r(m);var p=t(b,c,m,h);T="";h.render(function(a){S.renderBufferImmediate(a,p,m)})}else S.renderBufferDirect(b,c,k,m,h,g)}}function r(a){a.side!==THREE.DoubleSide?X.enable(E.CULL_FACE):X.disable(E.CULL_FACE);
X.setFlipSided(a.side===THREE.BackSide);!0===a.transparent?X.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,a.blendSrcAlpha,a.blendDstAlpha,a.premultipliedAlpha):X.setBlending(THREE.NoBlending);X.setDepthFunc(a.depthFunc);X.setDepthTest(a.depthTest);X.setDepthWrite(a.depthWrite);X.setColorWrite(a.colorWrite);X.setPolygonOffset(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}function t(a,b,c,d){L=0;var e=ha.get(c);za&&((Ba||a!==V)&&na.setState(c.clippingPlanes,
c.clipShadows,a,e,a===V&&c.id===P),void 0!==e.numClippingPlanes&&e.numClippingPlanes!==na.numPlanes&&(c.needsUpdate=!0));void 0===e.program&&(c.needsUpdate=!0);void 0!==e.lightsHash&&e.lightsHash!==aa.hash&&(c.needsUpdate=!0);if(c.needsUpdate){a:{var h=ha.get(c),k=qa.getParameters(c,aa,b,na.numPlanes,d),m=qa.getProgramCode(c,k),p=h.program,l=!0;if(void 0===p)c.addEventListener("dispose",g);else if(p.code!==m)f(c);else if(void 0!==k.shaderID)break a;else l=!1;l&&(k.shaderID?(p=THREE.ShaderLib[k.shaderID],
h.__webglShader={name:c.type,uniforms:THREE.UniformsUtils.clone(p.uniforms),vertexShader:p.vertexShader,fragmentShader:p.fragmentShader}):h.__webglShader={name:c.type,uniforms:c.uniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader},c.__webglShader=h.__webglShader,p=qa.acquireProgram(c,k,m),h.program=p,c.program=p);k=p.getAttributes();if(c.morphTargets)for(m=c.numSupportedMorphTargets=0;m<S.maxMorphTargets;m++)0<=k["morphTarget"+m]&&c.numSupportedMorphTargets++;if(c.morphNormals)for(m=
c.numSupportedMorphNormals=0;m<S.maxMorphNormals;m++)0<=k["morphNormal"+m]&&c.numSupportedMorphNormals++;k=h.__webglShader.uniforms;(c instanceof THREE.ShaderMaterial||c instanceof THREE.RawShaderMaterial)&&!0!==c.clipping||(h.numClippingPlanes=na.numPlanes,k.clippingPlanes=na.uniform);c.lights&&(h.lightsHash=aa.hash,k.ambientLightColor.value=aa.ambient,k.directionalLights.value=aa.directional,k.spotLights.value=aa.spot,k.pointLights.value=aa.point,k.hemisphereLights.value=aa.hemi,k.directionalShadowMap.value=
aa.directionalShadowMap,k.directionalShadowMatrix.value=aa.directionalShadowMatrix,k.spotShadowMap.value=aa.spotShadowMap,k.spotShadowMatrix.value=aa.spotShadowMatrix,k.pointShadowMap.value=aa.pointShadowMap,k.pointShadowMatrix.value=aa.pointShadowMatrix);m=h.program.getUniforms();m=THREE.WebGLUniforms.seqWithValue(m.seq,k);h.uniformsList=m;h.dynamicUniforms=THREE.WebGLUniforms.splitDynamic(m,k)}c.needsUpdate=!1}var n=!1,l=p=!1,h=e.program,m=h.getUniforms(),k=e.__webglShader.uniforms;h.id!==Q&&(E.useProgram(h.program),
Q=h.id,l=p=n=!0);c.id!==P&&(P=c.id,p=!0);if(n||a!==V){m.set(E,a,"projectionMatrix");la.logarithmicDepthBuffer&&m.setValue(E,"logDepthBufFC",2/(Math.log(a.far+1)/Math.LN2));a!==V&&(V=a,l=p=!0);if(c instanceof THREE.ShaderMaterial||c instanceof THREE.MeshPhongMaterial||c instanceof THREE.MeshStandardMaterial||c.envMap)n=m.map.cameraPosition,void 0!==n&&n.setValue(E,ga.setFromMatrixPosition(a.matrixWorld));(c instanceof THREE.MeshPhongMaterial||c instanceof THREE.MeshLambertMaterial||c instanceof THREE.MeshBasicMaterial||
c instanceof THREE.MeshStandardMaterial||c instanceof THREE.ShaderMaterial||c.skinning)&&m.setValue(E,"viewMatrix",a.matrixWorldInverse);m.set(E,S,"toneMappingExposure");m.set(E,S,"toneMappingWhitePoint")}c.skinning&&(m.setOptional(E,d,"bindMatrix"),m.setOptional(E,d,"bindMatrixInverse"),n=d.skeleton)&&(la.floatVertexTextures&&n.useVertexTexture?(m.set(E,n,"boneTexture"),m.set(E,n,"boneTextureWidth"),m.set(E,n,"boneTextureHeight")):m.setOptional(E,n,"boneMatrices"));if(p){c.lights&&(p=l,k.ambientLightColor.needsUpdate=
p,k.directionalLights.needsUpdate=p,k.pointLights.needsUpdate=p,k.spotLights.needsUpdate=p,k.hemisphereLights.needsUpdate=p);b&&c.fog&&(k.fogColor.value=b.color,b instanceof THREE.Fog?(k.fogNear.value=b.near,k.fogFar.value=b.far):b instanceof THREE.FogExp2&&(k.fogDensity.value=b.density));if(c instanceof THREE.MeshBasicMaterial||c instanceof THREE.MeshLambertMaterial||c instanceof THREE.MeshPhongMaterial||c instanceof THREE.MeshStandardMaterial||c instanceof THREE.MeshDepthMaterial){k.opacity.value=
c.opacity;k.diffuse.value=c.color;c.emissive&&k.emissive.value.copy(c.emissive).multiplyScalar(c.emissiveIntensity);k.map.value=c.map;k.specularMap.value=c.specularMap;k.alphaMap.value=c.alphaMap;c.aoMap&&(k.aoMap.value=c.aoMap,k.aoMapIntensity.value=c.aoMapIntensity);var r;c.map?r=c.map:c.specularMap?r=c.specularMap:c.displacementMap?r=c.displacementMap:c.normalMap?r=c.normalMap:c.bumpMap?r=c.bumpMap:c.roughnessMap?r=c.roughnessMap:c.metalnessMap?r=c.metalnessMap:c.alphaMap?r=c.alphaMap:c.emissiveMap&&
(r=c.emissiveMap);void 0!==r&&(r instanceof THREE.WebGLRenderTarget&&(r=r.texture),b=r.offset,r=r.repeat,k.offsetRepeat.value.set(b.x,b.y,r.x,r.y));k.envMap.value=c.envMap;k.flipEnvMap.value=c.envMap instanceof THREE.CubeTexture?-1:1;k.reflectivity.value=c.reflectivity;k.refractionRatio.value=c.refractionRatio}c instanceof THREE.LineBasicMaterial?(k.diffuse.value=c.color,k.opacity.value=c.opacity):c instanceof THREE.LineDashedMaterial?(k.diffuse.value=c.color,k.opacity.value=c.opacity,k.dashSize.value=
c.dashSize,k.totalSize.value=c.dashSize+c.gapSize,k.scale.value=c.scale):c instanceof THREE.PointsMaterial?(k.diffuse.value=c.color,k.opacity.value=c.opacity,k.size.value=c.size*da,k.scale.value=.5*u.clientHeight,k.map.value=c.map,null!==c.map&&(r=c.map.offset,c=c.map.repeat,k.offsetRepeat.value.set(r.x,r.y,c.x,c.y))):c instanceof THREE.MeshLambertMaterial?(c.lightMap&&(k.lightMap.value=c.lightMap,k.lightMapIntensity.value=c.lightMapIntensity),c.emissiveMap&&(k.emissiveMap.value=c.emissiveMap)):c instanceof
THREE.MeshPhongMaterial?(k.specular.value=c.specular,k.shininess.value=Math.max(c.shininess,1E-4),c.lightMap&&(k.lightMap.value=c.lightMap,k.lightMapIntensity.value=c.lightMapIntensity),c.emissiveMap&&(k.emissiveMap.value=c.emissiveMap),c.bumpMap&&(k.bumpMap.value=c.bumpMap,k.bumpScale.value=c.bumpScale),c.normalMap&&(k.normalMap.value=c.normalMap,k.normalScale.value.copy(c.normalScale)),c.displacementMap&&(k.displacementMap.value=c.displacementMap,k.displacementScale.value=c.displacementScale,k.displacementBias.value=
c.displacementBias)):c instanceof THREE.MeshPhysicalMaterial?(k.clearCoat.value=c.clearCoat,k.clearCoatRoughness.value=c.clearCoatRoughness,w(k,c)):c instanceof THREE.MeshStandardMaterial?w(k,c):c instanceof THREE.MeshDepthMaterial?c.displacementMap&&(k.displacementMap.value=c.displacementMap,k.displacementScale.value=c.displacementScale,k.displacementBias.value=c.displacementBias):c instanceof THREE.MeshNormalMaterial&&(k.opacity.value=c.opacity);THREE.WebGLUniforms.upload(E,e.uniformsList,k,S)}m.set(E,
d,"modelViewMatrix");m.set(E,d,"normalMatrix");m.setValue(E,"modelMatrix",d.matrixWorld);e=e.dynamicUniforms;null!==e&&(THREE.WebGLUniforms.evalDynamic(e,k,d,a),THREE.WebGLUniforms.upload(E,e,k,S));return h}function w(a,b){a.roughness.value=b.roughness;a.metalness.value=b.metalness;b.roughnessMap&&(a.roughnessMap.value=b.roughnessMap);b.metalnessMap&&(a.metalnessMap.value=b.metalnessMap);b.lightMap&&(a.lightMap.value=b.lightMap,a.lightMapIntensity.value=b.lightMapIntensity);b.emissiveMap&&(a.emissiveMap.value=
b.emissiveMap);b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale);b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale));b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias);b.envMap&&(a.envMapIntensity.value=b.envMapIntensity)}function v(a){var b;if(a===THREE.RepeatWrapping)return E.REPEAT;if(a===THREE.ClampToEdgeWrapping)return E.CLAMP_TO_EDGE;if(a===
THREE.MirroredRepeatWrapping)return E.MIRRORED_REPEAT;if(a===THREE.NearestFilter)return E.NEAREST;if(a===THREE.NearestMipMapNearestFilter)return E.NEAREST_MIPMAP_NEAREST;if(a===THREE.NearestMipMapLinearFilter)return E.NEAREST_MIPMAP_LINEAR;if(a===THREE.LinearFilter)return E.LINEAR;if(a===THREE.LinearMipMapNearestFilter)return E.LINEAR_MIPMAP_NEAREST;if(a===THREE.LinearMipMapLinearFilter)return E.LINEAR_MIPMAP_LINEAR;if(a===THREE.UnsignedByteType)return E.UNSIGNED_BYTE;if(a===THREE.UnsignedShort4444Type)return E.UNSIGNED_SHORT_4_4_4_4;
if(a===THREE.UnsignedShort5551Type)return E.UNSIGNED_SHORT_5_5_5_1;if(a===THREE.UnsignedShort565Type)return E.UNSIGNED_SHORT_5_6_5;if(a===THREE.ByteType)return E.BYTE;if(a===THREE.ShortType)return E.SHORT;if(a===THREE.UnsignedShortType)return E.UNSIGNED_SHORT;if(a===THREE.IntType)return E.INT;if(a===THREE.UnsignedIntType)return E.UNSIGNED_INT;if(a===THREE.FloatType)return E.FLOAT;b=fa.get("OES_texture_half_float");if(null!==b&&a===THREE.HalfFloatType)return b.HALF_FLOAT_OES;if(a===THREE.AlphaFormat)return E.ALPHA;
if(a===THREE.RGBFormat)return E.RGB;if(a===THREE.RGBAFormat)return E.RGBA;if(a===THREE.LuminanceFormat)return E.LUMINANCE;if(a===THREE.LuminanceAlphaFormat)return E.LUMINANCE_ALPHA;if(a===THREE.DepthFormat)return E.DEPTH_COMPONENT;if(a===THREE.AddEquation)return E.FUNC_ADD;if(a===THREE.SubtractEquation)return E.FUNC_SUBTRACT;if(a===THREE.ReverseSubtractEquation)return E.FUNC_REVERSE_SUBTRACT;if(a===THREE.ZeroFactor)return E.ZERO;if(a===THREE.OneFactor)return E.ONE;if(a===THREE.SrcColorFactor)return E.SRC_COLOR;
if(a===THREE.OneMinusSrcColorFactor)return E.ONE_MINUS_SRC_COLOR;if(a===THREE.SrcAlphaFactor)return E.SRC_ALPHA;if(a===THREE.OneMinusSrcAlphaFactor)return E.ONE_MINUS_SRC_ALPHA;if(a===THREE.DstAlphaFactor)return E.DST_ALPHA;if(a===THREE.OneMinusDstAlphaFactor)return E.ONE_MINUS_DST_ALPHA;if(a===THREE.DstColorFactor)return E.DST_COLOR;if(a===THREE.OneMinusDstColorFactor)return E.ONE_MINUS_DST_COLOR;if(a===THREE.SrcAlphaSaturateFactor)return E.SRC_ALPHA_SATURATE;b=fa.get("WEBGL_compressed_texture_s3tc");
if(null!==b){if(a===THREE.RGB_S3TC_DXT1_Format)return b.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT1_Format)return b.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT3_Format)return b.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===THREE.RGBA_S3TC_DXT5_Format)return b.COMPRESSED_RGBA_S3TC_DXT5_EXT}b=fa.get("WEBGL_compressed_texture_pvrtc");if(null!==b){if(a===THREE.RGB_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===THREE.RGB_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;
if(a===THREE.RGBA_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===THREE.RGBA_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}b=fa.get("WEBGL_compressed_texture_etc1");if(null!==b&&a===THREE.RGB_ETC1_Format)return b.COMPRESSED_RGB_ETC1_WEBGL;b=fa.get("EXT_blend_minmax");if(null!==b){if(a===THREE.MinEquation)return b.MIN_EXT;if(a===THREE.MaxEquation)return b.MAX_EXT}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION);a=a||{};var u=void 0!==a.canvas?a.canvas:
document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),z=void 0!==a.context?a.context:null,x=void 0!==a.alpha?a.alpha:!1,A=void 0!==a.depth?a.depth:!0,y=void 0!==a.stencil?a.stencil:!0,B=void 0!==a.antialias?a.antialias:!1,C=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,F=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,H=[],K=[],M=-1,O=[],I=-1,D=new Float32Array(8),J=[],N=[];this.domElement=u;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=
this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1;this.toneMapping=THREE.LinearToneMapping;this.toneMappingWhitePoint=this.toneMappingExposure=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var S=this,Q=null,R=null,G=null,P=-1,T="",V=null,Y=new THREE.Vector4,W=null,ba=new THREE.Vector4,L=0,U=new THREE.Color(0),Z=0,ca=u.width,ea=u.height,da=1,ua=new THREE.Vector4(0,0,ca,ea),
Da=!1,ya=new THREE.Vector4(0,0,ca,ea),Ea=new THREE.Frustum,na=new THREE.WebGLClipping,za=!1,Ba=!1,va=new THREE.Sphere,Aa=new THREE.Matrix4,ga=new THREE.Vector3,aa={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},ia={calls:0,vertices:0,faces:0,points:0};this.info={render:ia,memory:{geometries:0,textures:0},programs:null};var E;try{x={alpha:x,depth:A,
stencil:y,antialias:B,premultipliedAlpha:C,preserveDrawingBuffer:F};E=z||u.getContext("webgl",x)||u.getContext("experimental-webgl",x);if(null===E){if(null!==u.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";throw"Error creating WebGL context.";}void 0===E.getShaderPrecisionFormat&&(E.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});u.addEventListener("webglcontextlost",d,!1)}catch(xa){console.error("THREE.WebGLRenderer: "+xa)}var fa=
new THREE.WebGLExtensions(E);fa.get("WEBGL_depth_texture");fa.get("OES_texture_float");fa.get("OES_texture_float_linear");fa.get("OES_texture_half_float");fa.get("OES_texture_half_float_linear");fa.get("OES_standard_derivatives");fa.get("ANGLE_instanced_arrays");fa.get("OES_element_index_uint")&&(THREE.BufferGeometry.MaxIndex=4294967296);var la=new THREE.WebGLCapabilities(E,fa,a),X=new THREE.WebGLState(E,fa,v),ha=new THREE.WebGLProperties,ka=new THREE.WebGLTextures(E,fa,X,ha,la,v,this.info),pa=new THREE.WebGLObjects(E,
ha,this.info),qa=new THREE.WebGLPrograms(this,la),oa=new THREE.WebGLLights;this.info.programs=qa.programs;var Fa=new THREE.WebGLBufferRenderer(E,fa,ia),wa=new THREE.WebGLIndexedBufferRenderer(E,fa,ia),Ca=new THREE.OrthographicCamera(-1,1,1,-1,0,1),ra=new THREE.PerspectiveCamera,ma=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1}));a=THREE.ShaderLib.cube;var ja=new THREE.Mesh(new THREE.BoxBufferGeometry(5,5,5),new THREE.ShaderMaterial({uniforms:a.uniforms,
vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,side:THREE.BackSide,depthTest:!1,depthWrite:!1,fog:!1}));c();this.context=E;this.capabilities=la;this.extensions=fa;this.properties=ha;this.state=X;var sa=new THREE.WebGLShadowMap(this,aa,pa,la);this.shadowMap=sa;var Ga=new THREE.SpritePlugin(this,J),ta=new THREE.LensFlarePlugin(this,N);this.getContext=function(){return E};this.getContextAttributes=function(){return E.getContextAttributes()};this.forceContextLoss=function(){fa.get("WEBGL_lose_context").loseContext()};
this.getMaxAnisotropy=function(){return la.getMaxAnisotropy()};this.getPrecision=function(){return la.precision};this.getPixelRatio=function(){return da};this.setPixelRatio=function(a){void 0!==a&&(da=a,this.setSize(ya.z,ya.w,!1))};this.getSize=function(){return{width:ca,height:ea}};this.setSize=function(a,b,c){ca=a;ea=b;u.width=a*da;u.height=b*da;!1!==c&&(u.style.width=a+"px",u.style.height=b+"px");this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){X.viewport(ya.set(a,b,c,d))};this.setScissor=
function(a,b,c,d){X.scissor(ua.set(a,b,c,d))};this.setScissorTest=function(a){X.setScissorTest(Da=a)};this.getClearColor=function(){return U};this.setClearColor=function(a,c){U.set(a);Z=void 0!==c?c:1;b(U.r,U.g,U.b,Z)};this.getClearAlpha=function(){return Z};this.setClearAlpha=function(a){Z=a;b(U.r,U.g,U.b,Z)};this.clear=function(a,b,c){var d=0;if(void 0===a||a)d|=E.COLOR_BUFFER_BIT;if(void 0===b||b)d|=E.DEPTH_BUFFER_BIT;if(void 0===c||c)d|=E.STENCIL_BUFFER_BIT;E.clear(d)};this.clearColor=function(){this.clear(!0,
!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.clearTarget=function(a,b,c,d){this.setRenderTarget(a);this.clear(b,c,d)};this.resetGLState=e;this.dispose=function(){O=[];I=-1;K=[];M=-1;u.removeEventListener("webglcontextlost",d,!1)};this.renderBufferImmediate=function(a,b,c){X.initAttributes();var d=ha.get(a);a.hasPositions&&!d.position&&(d.position=E.createBuffer());a.hasNormals&&!d.normal&&(d.normal=E.createBuffer());a.hasUvs&&!d.uv&&
(d.uv=E.createBuffer());a.hasColors&&!d.color&&(d.color=E.createBuffer());b=b.getAttributes();a.hasPositions&&(E.bindBuffer(E.ARRAY_BUFFER,d.position),E.bufferData(E.ARRAY_BUFFER,a.positionArray,E.DYNAMIC_DRAW),X.enableAttribute(b.position),E.vertexAttribPointer(b.position,3,E.FLOAT,!1,0,0));if(a.hasNormals){E.bindBuffer(E.ARRAY_BUFFER,d.normal);if("MeshPhongMaterial"!==c.type&&"MeshStandardMaterial"!==c.type&&"MeshPhysicalMaterial"!==c.type&&c.shading===THREE.FlatShading)for(var e=0,f=3*a.count;e<
f;e+=9){var g=a.normalArray,h=(g[e+0]+g[e+3]+g[e+6])/3,k=(g[e+1]+g[e+4]+g[e+7])/3,m=(g[e+2]+g[e+5]+g[e+8])/3;g[e+0]=h;g[e+1]=k;g[e+2]=m;g[e+3]=h;g[e+4]=k;g[e+5]=m;g[e+6]=h;g[e+7]=k;g[e+8]=m}E.bufferData(E.ARRAY_BUFFER,a.normalArray,E.DYNAMIC_DRAW);X.enableAttribute(b.normal);E.vertexAttribPointer(b.normal,3,E.FLOAT,!1,0,0)}a.hasUvs&&c.map&&(E.bindBuffer(E.ARRAY_BUFFER,d.uv),E.bufferData(E.ARRAY_BUFFER,a.uvArray,E.DYNAMIC_DRAW),X.enableAttribute(b.uv),E.vertexAttribPointer(b.uv,2,E.FLOAT,!1,0,0));
a.hasColors&&c.vertexColors!==THREE.NoColors&&(E.bindBuffer(E.ARRAY_BUFFER,d.color),E.bufferData(E.ARRAY_BUFFER,a.colorArray,E.DYNAMIC_DRAW),X.enableAttribute(b.color),E.vertexAttribPointer(b.color,3,E.FLOAT,!1,0,0));X.disableUnusedAttributes();E.drawArrays(E.TRIANGLES,0,a.count);a.count=0};this.renderBufferDirect=function(a,b,c,d,e,f){r(d);var g=t(a,b,d,e),k=!1;a=c.id+"_"+g.id+"_"+d.wireframe;a!==T&&(T=a,k=!0);b=e.morphTargetInfluences;if(void 0!==b){a=[];for(var m=0,k=b.length;m<k;m++){var p=b[m];
a.push([p,m])}a.sort(h);8<a.length&&(a.length=8);for(var l=c.morphAttributes,m=0,k=a.length;m<k;m++)p=a[m],D[m]=p[0],0!==p[0]?(b=p[1],!0===d.morphTargets&&l.position&&c.addAttribute("morphTarget"+m,l.position[b]),!0===d.morphNormals&&l.normal&&c.addAttribute("morphNormal"+m,l.normal[b])):(!0===d.morphTargets&&c.removeAttribute("morphTarget"+m),!0===d.morphNormals&&c.removeAttribute("morphNormal"+m));g.getUniforms().setValue(E,"morphTargetInfluences",D);k=!0}b=c.index;m=c.attributes.position;!0===
d.wireframe&&(b=pa.getWireframeAttribute(c));null!==b?(a=wa,a.setIndex(b)):a=Fa;if(k){var k=void 0,n;if(c instanceof THREE.InstancedBufferGeometry&&(n=fa.get("ANGLE_instanced_arrays"),null===n))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{void 0===k&&(k=0);X.initAttributes();var p=c.attributes,g=g.getAttributes(),l=d.defaultAttributeValues,q;for(q in g){var u=g[q];if(0<=u){var v=
p[q];if(void 0!==v){var w=E.FLOAT,x=v.array,z=v.normalized;x instanceof Float32Array?w=E.FLOAT:x instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):x instanceof Uint16Array?w=E.UNSIGNED_SHORT:x instanceof Int16Array?w=E.SHORT:x instanceof Uint32Array?w=E.UNSIGNED_INT:x instanceof Int32Array?w=E.INT:x instanceof Int8Array?w=E.BYTE:x instanceof Uint8Array&&(w=E.UNSIGNED_BYTE);var x=v.itemSize,y=pa.getAttributeBuffer(v);if(v instanceof THREE.InterleavedBufferAttribute){var N=
v.data,B=N.stride,v=v.offset;N instanceof THREE.InstancedInterleavedBuffer?(X.enableAttributeAndDivisor(u,N.meshPerAttribute,n),void 0===c.maxInstancedCount&&(c.maxInstancedCount=N.meshPerAttribute*N.count)):X.enableAttribute(u);E.bindBuffer(E.ARRAY_BUFFER,y);E.vertexAttribPointer(u,x,w,z,B*N.array.BYTES_PER_ELEMENT,(k*B+v)*N.array.BYTES_PER_ELEMENT)}else v instanceof THREE.InstancedBufferAttribute?(X.enableAttributeAndDivisor(u,v.meshPerAttribute,n),void 0===c.maxInstancedCount&&(c.maxInstancedCount=
v.meshPerAttribute*v.count)):X.enableAttribute(u),E.bindBuffer(E.ARRAY_BUFFER,y),E.vertexAttribPointer(u,x,w,z,0,k*x*v.array.BYTES_PER_ELEMENT)}else if(void 0!==l&&(w=l[q],void 0!==w))switch(w.length){case 2:E.vertexAttrib2fv(u,w);break;case 3:E.vertexAttrib3fv(u,w);break;case 4:E.vertexAttrib4fv(u,w);break;default:E.vertexAttrib1fv(u,w)}}}X.disableUnusedAttributes()}null!==b&&E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,pa.getAttributeBuffer(b))}n=Infinity;null!==b?n=b.count:void 0!==m&&(n=m.count);q=c.drawRange.start;
b=c.drawRange.count;m=null!==f?f.start:0;k=null!==f?f.count:Infinity;f=Math.max(0,q,m);n=Math.min(0+n,q+b,m+k)-1;n=Math.max(0,n-f+1);if(e instanceof THREE.Mesh)if(!0===d.wireframe)X.setLineWidth(d.wireframeLinewidth*(null===R?da:1)),a.setMode(E.LINES);else switch(e.drawMode){case THREE.TrianglesDrawMode:a.setMode(E.TRIANGLES);break;case THREE.TriangleStripDrawMode:a.setMode(E.TRIANGLE_STRIP);break;case THREE.TriangleFanDrawMode:a.setMode(E.TRIANGLE_FAN)}else e instanceof THREE.Line?(d=d.linewidth,
void 0===d&&(d=1),X.setLineWidth(d*(null===R?da:1)),e instanceof THREE.LineSegments?a.setMode(E.LINES):a.setMode(E.LINE_STRIP)):e instanceof THREE.Points&&a.setMode(E.POINTS);c instanceof THREE.InstancedBufferGeometry?0<c.maxInstancedCount&&a.renderInstances(c,f,n):a.render(f,n)};this.render=function(a,c,d,e){if(!1===c instanceof THREE.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var f=a.fog;T="";P=-1;V=null;!0===a.autoUpdate&&a.updateMatrixWorld();
null===c.parent&&c.updateMatrixWorld();c.matrixWorldInverse.getInverse(c.matrixWorld);Aa.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);Ea.setFromMatrix(Aa);H.length=0;I=M=-1;J.length=0;N.length=0;Ba=this.localClippingEnabled;za=na.init(this.clippingPlanes,Ba,c);m(a,c);K.length=M+1;O.length=I+1;!0===S.sortObjects&&(K.sort(k),O.sort(l));za&&na.beginShadows();for(var g=H,h=0,n=0,r=g.length;n<r;n++){var q=g[n];q.castShadow&&(aa.shadows[h++]=q)}aa.shadows.length=h;sa.render(a,c);for(var g=
H,t=q=0,u=0,v,w,x,z,y=c.matrixWorldInverse,B=0,F=0,D=0,G=0,h=0,n=g.length;h<n;h++)if(r=g[h],v=r.color,w=r.intensity,x=r.distance,z=r.shadow&&r.shadow.map?r.shadow.map.texture:null,r instanceof THREE.AmbientLight)q+=v.r*w,t+=v.g*w,u+=v.b*w;else if(r instanceof THREE.DirectionalLight){var A=oa.get(r);A.color.copy(r.color).multiplyScalar(r.intensity);A.direction.setFromMatrixPosition(r.matrixWorld);ga.setFromMatrixPosition(r.target.matrixWorld);A.direction.sub(ga);A.direction.transformDirection(y);if(A.shadow=
r.castShadow)A.shadowBias=r.shadow.bias,A.shadowRadius=r.shadow.radius,A.shadowMapSize=r.shadow.mapSize;aa.directionalShadowMap[B]=z;aa.directionalShadowMatrix[B]=r.shadow.matrix;aa.directional[B++]=A}else if(r instanceof THREE.SpotLight){A=oa.get(r);A.position.setFromMatrixPosition(r.matrixWorld);A.position.applyMatrix4(y);A.color.copy(v).multiplyScalar(w);A.distance=x;A.direction.setFromMatrixPosition(r.matrixWorld);ga.setFromMatrixPosition(r.target.matrixWorld);A.direction.sub(ga);A.direction.transformDirection(y);
A.coneCos=Math.cos(r.angle);A.penumbraCos=Math.cos(r.angle*(1-r.penumbra));A.decay=0===r.distance?0:r.decay;if(A.shadow=r.castShadow)A.shadowBias=r.shadow.bias,A.shadowRadius=r.shadow.radius,A.shadowMapSize=r.shadow.mapSize;aa.spotShadowMap[D]=z;aa.spotShadowMatrix[D]=r.shadow.matrix;aa.spot[D++]=A}else if(r instanceof THREE.PointLight){A=oa.get(r);A.position.setFromMatrixPosition(r.matrixWorld);A.position.applyMatrix4(y);A.color.copy(r.color).multiplyScalar(r.intensity);A.distance=r.distance;A.decay=
0===r.distance?0:r.decay;if(A.shadow=r.castShadow)A.shadowBias=r.shadow.bias,A.shadowRadius=r.shadow.radius,A.shadowMapSize=r.shadow.mapSize;aa.pointShadowMap[F]=z;void 0===aa.pointShadowMatrix[F]&&(aa.pointShadowMatrix[F]=new THREE.Matrix4);ga.setFromMatrixPosition(r.matrixWorld).negate();aa.pointShadowMatrix[F].identity().setPosition(ga);aa.point[F++]=A}else r instanceof THREE.HemisphereLight&&(A=oa.get(r),A.direction.setFromMatrixPosition(r.matrixWorld),A.direction.transformDirection(y),A.direction.normalize(),
A.skyColor.copy(r.color).multiplyScalar(w),A.groundColor.copy(r.groundColor).multiplyScalar(w),aa.hemi[G++]=A);aa.ambient[0]=q;aa.ambient[1]=t;aa.ambient[2]=u;aa.directional.length=B;aa.spot.length=D;aa.point.length=F;aa.hemi.length=G;aa.hash=B+","+F+","+D+","+G+","+aa.shadows.length;za&&na.endShadows();ia.calls=0;ia.vertices=0;ia.faces=0;ia.points=0;void 0===d&&(d=null);this.setRenderTarget(d);g=a.background;null===g?b(U.r,U.g,U.b,Z):g instanceof THREE.Color&&b(g.r,g.g,g.b,1);(this.autoClear||e)&&
this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);g instanceof THREE.CubeTexture?(ra.projectionMatrix.copy(c.projectionMatrix),ra.matrixWorld.extractRotation(c.matrixWorld),ra.matrixWorldInverse.getInverse(ra.matrixWorld),ja.material.uniforms.tCube.value=g,ja.modelViewMatrix.multiplyMatrices(ra.matrixWorldInverse,ja.matrixWorld),pa.update(ja),S.renderBufferDirect(ra,null,ja.geometry,ja.material,ja,null)):g instanceof THREE.Texture&&(ma.material.map=g,pa.update(ma),S.renderBufferDirect(Ca,
null,ma.geometry,ma.material,ma,null));a.overrideMaterial?(e=a.overrideMaterial,p(K,c,f,e),p(O,c,f,e)):(X.setBlending(THREE.NoBlending),p(K,c,f),p(O,c,f));Ga.render(a,c);ta.render(a,c,ba);d&&ka.updateRenderTargetMipmap(d);X.setDepthTest(!0);X.setDepthWrite(!0);X.setColorWrite(!0)}};this.setFaceCulling=function(a,b){X.setCullFace(a);X.setFlipSided(b===THREE.FrontFaceDirectionCW)};this.allocTextureUnit=function(){var a=L;a>=la.maxTextures&&console.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+
la.maxTextures);L+=1;return a};this.setTexture2D=function(){var a=!1;return function(b,c){b instanceof THREE.WebGLRenderTarget&&(a||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),a=!0),b=b.texture);ka.setTexture2D(b,c)}}();this.setTexture=function(){var a=!1;return function(b,c){a||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),a=!0);ka.setTexture2D(b,c)}}();this.setTextureCube=
function(){var a=!1;return function(b,c){b instanceof THREE.WebGLRenderTargetCube&&(a||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),a=!0),b=b.texture);b instanceof THREE.CubeTexture||Array.isArray(b.image)&&6===b.image.length?ka.setTextureCube(b,c):ka.setTextureCubeDynamic(b,c)}}();this.getCurrentRenderTarget=function(){return R};this.setRenderTarget=function(a){(R=a)&&void 0===ha.get(a).__webglFramebuffer&&ka.setupRenderTarget(a);
var b=a instanceof THREE.WebGLRenderTargetCube,c;a?(c=ha.get(a),c=b?c.__webglFramebuffer[a.activeCubeFace]:c.__webglFramebuffer,Y.copy(a.scissor),W=a.scissorTest,ba.copy(a.viewport)):(c=null,Y.copy(ua).multiplyScalar(da),W=Da,ba.copy(ya).multiplyScalar(da));G!==c&&(E.bindFramebuffer(E.FRAMEBUFFER,c),G=c);X.scissor(Y);X.setScissorTest(W);X.viewport(ba);b&&(b=ha.get(a.texture),E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+a.activeCubeFace,b.__webglTexture,a.activeMipMapLevel))};
this.readRenderTargetPixels=function(a,b,c,d,e,f){if(!1===a instanceof THREE.WebGLRenderTarget)console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");else{var g=ha.get(a).__webglFramebuffer;if(g){var h=!1;g!==G&&(E.bindFramebuffer(E.FRAMEBUFFER,g),h=!0);try{var k=a.texture;k.format!==THREE.RGBAFormat&&v(k.format)!==E.getParameter(E.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):
k.type===THREE.UnsignedByteType||v(k.type)===E.getParameter(E.IMPLEMENTATION_COLOR_READ_TYPE)||k.type===THREE.FloatType&&fa.get("WEBGL_color_buffer_float")||k.type===THREE.HalfFloatType&&fa.get("EXT_color_buffer_half_float")?E.checkFramebufferStatus(E.FRAMEBUFFER)===E.FRAMEBUFFER_COMPLETE?0<=b&&b<=a.width-d&&0<=c&&c<=a.height-e&&E.readPixels(b,c,d,e,v(k.format),v(k.type),f):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):
console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{h&&E.bindFramebuffer(E.FRAMEBUFFER,G)}}}}};
THREE.WebGLRenderTarget=function(a,b,c){this.uuid=THREE.Math.generateUUID();this.width=a;this.height=b;this.scissor=new THREE.Vector4(0,0,a,b);this.scissorTest=!1;this.viewport=new THREE.Vector4(0,0,a,b);c=c||{};void 0===c.minFilter&&(c.minFilter=THREE.LinearFilter);this.texture=new THREE.Texture(void 0,void 0,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.encoding);this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:
!0;this.depthTexture=null};
Object.assign(THREE.WebGLRenderTarget.prototype,THREE.EventDispatcher.prototype,{setSize:function(a,b){if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.dispose();this.viewport.set(0,0,a,b);this.scissor.set(0,0,a,b)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.width=a.width;this.height=a.height;this.viewport.copy(a.viewport);this.texture=a.texture.clone();this.depthBuffer=a.depthBuffer;this.stencilBuffer=a.stencilBuffer;this.depthTexture=a.depthTexture;
return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});THREE.WebGLRenderTargetCube=function(a,b,c){THREE.WebGLRenderTarget.call(this,a,b,c);this.activeMipMapLevel=this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube;
THREE.WebGLBufferRenderer=function(a,b,c){var e;this.setMode=function(a){e=a};this.render=function(b,g){a.drawArrays(e,b,g);c.calls++;c.vertices+=g;e===a.TRIANGLES&&(c.faces+=g/3)};this.renderInstances=function(d){var g=b.get("ANGLE_instanced_arrays");if(null===g)console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{var f=d.attributes.position,f=f instanceof THREE.InterleavedBufferAttribute?f.data.count:
f.count;g.drawArraysInstancedANGLE(e,0,f,d.maxInstancedCount);c.calls++;c.vertices+=f*d.maxInstancedCount;e===a.TRIANGLES&&(c.faces+=d.maxInstancedCount*f/3)}}};
THREE.WebGLClipping=function(){function a(){l.value!==e&&(l.value=e,l.needsUpdate=0<d);c.numPlanes=d}function b(a,b,d,e){var f=null!==a?a.length:0,g=null;if(0!==f){g=l.value;if(!0!==e||null===g){e=d+4*f;b=b.matrixWorldInverse;k.getNormalMatrix(b);if(null===g||g.length<e)g=new Float32Array(e);for(e=0;e!==f;++e,d+=4)h.copy(a[e]).applyMatrix4(b,k),h.normal.toArray(g,d),g[d+3]=h.constant}l.value=g;l.needsUpdate=!0}c.numPlanes=f;return g}var c=this,e=null,d=0,g=!1,f=!1,h=new THREE.Plane,k=new THREE.Matrix3,
l={value:null,needsUpdate:!1};this.uniform=l;this.numPlanes=0;this.init=function(a,c,f){var h=0!==a.length||c||0!==d||g;g=c;e=b(a,f,0);d=a.length;return h};this.beginShadows=function(){f=!0;b(null)};this.endShadows=function(){f=!1;a()};this.setState=function(c,h,k,p,r){if(!g||null===c||0===c.length||f&&!h)f?b(null):a();else{h=f?0:d;var m=4*h,n=p.clippingState||null;l.value=n;n=b(c,k,m,r);for(c=0;c!==m;++c)n[c]=e[c];p.clippingState=n;this.numPlanes+=h}}};
THREE.WebGLIndexedBufferRenderer=function(a,b,c){var e,d,g;this.setMode=function(a){e=a};this.setIndex=function(c){c.array instanceof Uint32Array&&b.get("OES_element_index_uint")?(d=a.UNSIGNED_INT,g=4):(d=a.UNSIGNED_SHORT,g=2)};this.render=function(b,h){a.drawElements(e,h,d,b*g);c.calls++;c.vertices+=h;e===a.TRIANGLES&&(c.faces+=h/3)};this.renderInstances=function(f,h,k){var l=b.get("ANGLE_instanced_arrays");null===l?console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):
(l.drawElementsInstancedANGLE(e,k,d,h*g,f.maxInstancedCount),c.calls++,c.vertices+=k*f.maxInstancedCount,e===a.TRIANGLES&&(c.faces+=f.maxInstancedCount*k/3))}};
THREE.WebGLExtensions=function(a){var b={};this.get=function(c){if(void 0!==b[c])return b[c];var e;switch(c){case "WEBGL_depth_texture":e=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");break;case "EXT_texture_filter_anisotropic":e=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":e=
a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case "WEBGL_compressed_texture_pvrtc":e=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case "WEBGL_compressed_texture_etc1":e=a.getExtension("WEBGL_compressed_texture_etc1");break;default:e=a.getExtension(c)}null===e&&console.warn("THREE.WebGLRenderer: "+c+" extension not supported.");
return b[c]=e}};
THREE.WebGLCapabilities=function(a,b,c){function e(b){if("highp"===b){if(0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision)return"highp";b="mediump"}return"mediump"===b&&0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision?"mediump":"lowp"}var d;this.getMaxAnisotropy=function(){if(void 0!==d)return d;var c=b.get("EXT_texture_filter_anisotropic");
return d=null!==c?a.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0};this.getMaxPrecision=e;this.precision=void 0!==c.precision?c.precision:"highp";this.logarithmicDepthBuffer=void 0!==c.logarithmicDepthBuffer?c.logarithmicDepthBuffer:!1;this.maxTextures=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);this.maxVertexTextures=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);this.maxCubemapSize=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);this.maxAttributes=
a.getParameter(a.MAX_VERTEX_ATTRIBS);this.maxVertexUniforms=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);this.maxVaryings=a.getParameter(a.MAX_VARYING_VECTORS);this.maxFragmentUniforms=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS);this.vertexTextures=0<this.maxVertexTextures;this.floatFragmentTextures=!!b.get("OES_texture_float");this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;c=e(this.precision);c!==this.precision&&(console.warn("THREE.WebGLRenderer:",this.precision,"not supported, using",
c,"instead."),this.precision=c);this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!b.get("EXT_frag_depth"))};
THREE.WebGLGeometries=function(a,b,c){function e(a){var f=a.target;a=g[f.id];null!==a.index&&d(a.index);var k=a.attributes,l;for(l in k)d(k[l]);f.removeEventListener("dispose",e);delete g[f.id];l=b.get(f);l.wireframe&&d(l.wireframe);b["delete"](f);f=b.get(a);f.wireframe&&d(f.wireframe);b["delete"](a);c.memory.geometries--}function d(c){var d;d=c instanceof THREE.InterleavedBufferAttribute?b.get(c.data).__webglBuffer:b.get(c).__webglBuffer;void 0!==d&&(a.deleteBuffer(d),c instanceof THREE.InterleavedBufferAttribute?
b["delete"](c.data):b["delete"](c))}var g={};this.get=function(a){var b=a.geometry;if(void 0!==g[b.id])return g[b.id];b.addEventListener("dispose",e);var d;b instanceof THREE.BufferGeometry?d=b:b instanceof THREE.Geometry&&(void 0===b._bufferGeometry&&(b._bufferGeometry=(new THREE.BufferGeometry).setFromObject(a)),d=b._bufferGeometry);g[b.id]=d;c.memory.geometries++;return d}};
THREE.WebGLLights=function(){var a={};this.get=function(b){if(void 0!==a[b.id])return a[b.id];var c;switch(b.type){case "DirectionalLight":c={direction:new THREE.Vector3,color:new THREE.Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case "SpotLight":c={position:new THREE.Vector3,direction:new THREE.Vector3,color:new THREE.Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case "PointLight":c=
{position:new THREE.Vector3,color:new THREE.Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case "HemisphereLight":c={direction:new THREE.Vector3,skyColor:new THREE.Color,groundColor:new THREE.Color}}return a[b.id]=c}};
THREE.WebGLObjects=function(a,b,c){function e(c,d){var e=c instanceof THREE.InterleavedBufferAttribute?c.data:c,f=b.get(e);void 0===f.__webglBuffer?(f.__webglBuffer=a.createBuffer(),a.bindBuffer(d,f.__webglBuffer),a.bufferData(d,e.array,e.dynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW),f.version=e.version):f.version!==e.version&&(a.bindBuffer(d,f.__webglBuffer),!1===e.dynamic||-1===e.updateRange.count?a.bufferSubData(d,0,e.array):0===e.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):
(a.bufferSubData(d,e.updateRange.offset*e.array.BYTES_PER_ELEMENT,e.array.subarray(e.updateRange.offset,e.updateRange.offset+e.updateRange.count)),e.updateRange.count=0),f.version=e.version)}function d(a,b,c){if(b>c){var d=b;b=c;c=d}d=a[b];return void 0===d?(a[b]=[c],!0):-1===d.indexOf(c)?(d.push(c),!0):!1}var g=new THREE.WebGLGeometries(a,b,c);this.getAttributeBuffer=function(a){return a instanceof THREE.InterleavedBufferAttribute?b.get(a.data).__webglBuffer:b.get(a).__webglBuffer};this.getWireframeAttribute=
function(c){var f=b.get(c);if(void 0!==f.wireframe)return f.wireframe;var g=[],l=c.index,n=c.attributes;c=n.position;if(null!==l)for(var n={},l=l.array,q=0,m=l.length;q<m;q+=3){var p=l[q+0],r=l[q+1],t=l[q+2];d(n,p,r)&&g.push(p,r);d(n,r,t)&&g.push(r,t);d(n,t,p)&&g.push(t,p)}else for(l=n.position.array,q=0,m=l.length/3-1;q<m;q+=3)p=q+0,r=q+1,t=q+2,g.push(p,r,r,t,t,p);g=new THREE.BufferAttribute(new (65535<c.count?Uint32Array:Uint16Array)(g),1);e(g,a.ELEMENT_ARRAY_BUFFER);return f.wireframe=g};this.update=
function(b){var c=g.get(b);b.geometry instanceof THREE.Geometry&&c.updateFromObject(b);b=c.index;var d=c.attributes;null!==b&&e(b,a.ELEMENT_ARRAY_BUFFER);for(var f in d)e(d[f],a.ARRAY_BUFFER);b=c.morphAttributes;for(f in b)for(var d=b[f],n=0,q=d.length;n<q;n++)e(d[n],a.ARRAY_BUFFER);return c}};
THREE.WebGLProgram=function(){function a(a){switch(a){case THREE.LinearEncoding:return["Linear","( value )"];case THREE.sRGBEncoding:return["sRGB","( value )"];case THREE.RGBEEncoding:return["RGBE","( value )"];case THREE.RGBM7Encoding:return["RGBM","( value, 7.0 )"];case THREE.RGBM16Encoding:return["RGBM","( value, 16.0 )"];case THREE.RGBDEncoding:return["RGBD","( value, 256.0 )"];case THREE.GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+
a);}}function b(b,c){var d=a(c);return"vec4 "+b+"( vec4 value ) { return "+d[0]+"ToLinear"+d[1]+"; }"}function c(b,c){var d=a(c);return"vec4 "+b+"( vec4 value ) { return LinearTo"+d[0]+d[1]+"; }"}function e(a,b){var c;switch(b){case THREE.LinearToneMapping:c="Linear";break;case THREE.ReinhardToneMapping:c="Reinhard";break;case THREE.Uncharted2ToneMapping:c="Uncharted2";break;case THREE.CineonToneMapping:c="OptimizedCineon";break;default:throw Error("unsupported toneMapping: "+b);}return"vec3 "+a+
"( vec3 color ) { return "+c+"ToneMapping( color ); }"}function d(a,b,c){a=a||{};return[a.derivatives||b.envMapCubeUV||b.bumpMap||b.normalMap||b.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(a.fragDepth||b.logarithmicDepthBuffer)&&c.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",a.drawBuffers&&c.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(a.shaderTextureLOD||b.envMap)&&c.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":
""].filter(f).join("\n")}function g(a){var b=[],c;for(c in a){var d=a[c];!1!==d&&b.push("#define "+c+" "+d)}return b.join("\n")}function f(a){return""!==a}function h(a,b){return a.replace(/NUM_DIR_LIGHTS/g,b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,b.numSpotLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,b.numHemiLights)}function k(a){return a.replace(/#include +<([\w\d.]+)>/g,function(a,b){var c=THREE.ShaderChunk[b];if(void 0===c)throw Error("Can not resolve #include <"+
b+">");return k(c)})}function l(a){return a.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(a,b,c,d){a="";for(b=parseInt(b);b<parseInt(c);b++)a+=d.replace(/\[ i \]/g,"[ "+b+" ]");return a})}var n=0;return function(a,m,p,r){var q=a.context,w=p.extensions,v=p.defines,u=p.__webglShader.vertexShader,z=p.__webglShader.fragmentShader,x="SHADOWMAP_TYPE_BASIC";r.shadowMapType===THREE.PCFShadowMap?x="SHADOWMAP_TYPE_PCF":r.shadowMapType===THREE.PCFSoftShadowMap&&(x="SHADOWMAP_TYPE_PCF_SOFT");
var A="ENVMAP_TYPE_CUBE",y="ENVMAP_MODE_REFLECTION",B="ENVMAP_BLENDING_MULTIPLY";if(r.envMap){switch(p.envMap.mapping){case THREE.CubeReflectionMapping:case THREE.CubeRefractionMapping:A="ENVMAP_TYPE_CUBE";break;case THREE.CubeUVReflectionMapping:case THREE.CubeUVRefractionMapping:A="ENVMAP_TYPE_CUBE_UV";break;case THREE.EquirectangularReflectionMapping:case THREE.EquirectangularRefractionMapping:A="ENVMAP_TYPE_EQUIREC";break;case THREE.SphericalReflectionMapping:A="ENVMAP_TYPE_SPHERE"}switch(p.envMap.mapping){case THREE.CubeRefractionMapping:case THREE.EquirectangularRefractionMapping:y=
"ENVMAP_MODE_REFRACTION"}switch(p.combine){case THREE.MultiplyOperation:B="ENVMAP_BLENDING_MULTIPLY";break;case THREE.MixOperation:B="ENVMAP_BLENDING_MIX";break;case THREE.AddOperation:B="ENVMAP_BLENDING_ADD"}}var C=0<a.gammaFactor?a.gammaFactor:1,w=d(w,r,a.extensions),F=g(v),H=q.createProgram();p instanceof THREE.RawShaderMaterial?(v=[F].filter(f).join("\n"),x=[F].filter(f).join("\n")):(v=["precision "+r.precision+" float;","precision "+r.precision+" int;","#define SHADER_NAME "+p.__webglShader.name,
F,r.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+C,"#define MAX_BONES "+r.maxBones,r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+y:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":
"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+
r.numClippingPlanes,r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+x:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;",
"attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;",
"\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(f).join("\n"),x=[w,"precision "+r.precision+" float;","precision "+r.precision+" int;","#define SHADER_NAME "+p.__webglShader.name,F,r.alphaTest?"#define ALPHATEST "+r.alphaTest:"","#define GAMMA_FACTOR "+C,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp?"#define FOG_EXP2":"",r.map?"#define USE_MAP":
"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+A:"",r.envMap?"#define "+y:"",r.envMap?"#define "+B:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":
"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+r.numClippingPlanes,r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+x:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":
"",r.envMap&&a.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",r.toneMapping!==THREE.NoToneMapping?"#define TONE_MAPPING":"",r.toneMapping!==THREE.NoToneMapping?THREE.ShaderChunk.tonemapping_pars_fragment:"",r.toneMapping!==THREE.NoToneMapping?e("toneMapping",r.toneMapping):"",r.outputEncoding||r.mapEncoding||r.envMapEncoding||r.emissiveMapEncoding?THREE.ShaderChunk.encodings_pars_fragment:"",r.mapEncoding?b("mapTexelToLinear",
r.mapEncoding):"",r.envMapEncoding?b("envMapTexelToLinear",r.envMapEncoding):"",r.emissiveMapEncoding?b("emissiveMapTexelToLinear",r.emissiveMapEncoding):"",r.outputEncoding?c("linearToOutputTexel",r.outputEncoding):"",r.depthPacking?"#define DEPTH_PACKING "+p.depthPacking:"","\n"].filter(f).join("\n"));u=k(u,r);u=h(u,r);z=k(z,r);z=h(z,r);!1===p instanceof THREE.ShaderMaterial&&(u=l(u),z=l(z));z=x+z;u=THREE.WebGLShader(q,q.VERTEX_SHADER,v+u);z=THREE.WebGLShader(q,q.FRAGMENT_SHADER,z);q.attachShader(H,
u);q.attachShader(H,z);void 0!==p.index0AttributeName?q.bindAttribLocation(H,0,p.index0AttributeName):!0===r.morphTargets&&q.bindAttribLocation(H,0,"position");q.linkProgram(H);r=q.getProgramInfoLog(H);A=q.getShaderInfoLog(u);y=q.getShaderInfoLog(z);C=B=!0;if(!1===q.getProgramParameter(H,q.LINK_STATUS))B=!1,console.error("THREE.WebGLProgram: shader error: ",q.getError(),"gl.VALIDATE_STATUS",q.getProgramParameter(H,q.VALIDATE_STATUS),"gl.getProgramInfoLog",r,A,y);else if(""!==r)console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",
r);else if(""===A||""===y)C=!1;C&&(this.diagnostics={runnable:B,material:p,programLog:r,vertexShader:{log:A,prefix:v},fragmentShader:{log:y,prefix:x}});q.deleteShader(u);q.deleteShader(z);var K;this.getUniforms=function(){void 0===K&&(K=new THREE.WebGLUniforms(q,H,a));return K};var M;this.getAttributes=function(){if(void 0===M){for(var a={},b=q.getProgramParameter(H,q.ACTIVE_ATTRIBUTES),c=0;c<b;c++){var d=q.getActiveAttrib(H,c).name;a[d]=q.getAttribLocation(H,d)}M=a}return M};this.destroy=function(){q.deleteProgram(H);
this.program=void 0};Object.defineProperties(this,{uniforms:{get:function(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");return this.getUniforms()}},attributes:{get:function(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.id=n++;this.code=m;this.usedTimes=1;this.program=H;this.vertexShader=u;this.fragmentShader=z;return this}}();
THREE.WebGLPrograms=function(a,b){function c(a,b){var c;a?a instanceof THREE.Texture?c=a.encoding:a instanceof THREE.WebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),c=a.texture.encoding):c=THREE.LinearEncoding;c===THREE.LinearEncoding&&b&&(c=THREE.GammaEncoding);return c}var e=[],d={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",
MeshPhongMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},g="precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap displacementMap specularMap roughnessMap metalnessMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes depthPacking".split(" ");
this.getParameters=function(e,g,k,l,n){var f=d[e.type],h;b.floatVertexTextures&&n&&n.skeleton&&n.skeleton.useVertexTexture?h=1024:(h=Math.floor((b.maxVertexUniforms-20)/4),void 0!==n&&n instanceof THREE.SkinnedMesh&&(h=Math.min(n.skeleton.bones.length,h),h<n.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+n.skeleton.bones.length+", this GPU supports just "+h+" (try OpenGL instead of ANGLE)")));var p=a.getPrecision();null!==e.precision&&(p=b.getMaxPrecision(e.precision),p!==
e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",p,"instead."));var r=a.getCurrentRenderTarget();return{shaderID:f,precision:p,supportsVertexTextures:b.vertexTextures,outputEncoding:c(r?r.texture:null,a.gammaOutput),map:!!e.map,mapEncoding:c(e.map,a.gammaInput),envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,envMapEncoding:c(e.envMap,a.gammaInput),envMapCubeUV:!!e.envMap&&(e.envMap.mapping===THREE.CubeUVReflectionMapping||e.envMap.mapping===
THREE.CubeUVRefractionMapping),lightMap:!!e.lightMap,aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:c(e.emissiveMap,a.gammaInput),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,combine:e.combine,vertexColors:e.vertexColors,fog:!!k,useFog:e.fog,fogExp:k instanceof THREE.FogExp2,flatShading:e.shading===THREE.FlatShading,sizeAttenuation:e.sizeAttenuation,
logarithmicDepthBuffer:b.logarithmicDepthBuffer,skinning:e.skinning,maxBones:h,useVertexTexture:b.floatVertexTextures&&n&&n.skeleton&&n.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:g.directional.length,numPointLights:g.point.length,numSpotLights:g.spot.length,numHemiLights:g.hemi.length,numClippingPlanes:l,shadowMapEnabled:a.shadowMap.enabled&&n.receiveShadow&&0<g.shadows.length,shadowMapType:a.shadowMap.type,
toneMapping:a.toneMapping,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide,depthPacking:void 0!==e.depthPacking?e.depthPacking:!1}};this.getProgramCode=function(a,b){var c=[];b.shaderID?c.push(b.shaderID):(c.push(a.fragmentShader),c.push(a.vertexShader));if(void 0!==a.defines)for(var d in a.defines)c.push(d),c.push(a.defines[d]);for(d=0;d<g.length;d++)c.push(b[g[d]]);
return c.join()};this.acquireProgram=function(b,c,d){for(var f,g=0,h=e.length;g<h;g++){var k=e[g];if(k.code===d){f=k;++f.usedTimes;break}}void 0===f&&(f=new THREE.WebGLProgram(a,d,b,c),e.push(f));return f};this.releaseProgram=function(a){if(0===--a.usedTimes){var b=e.indexOf(a);e[b]=e[e.length-1];e.pop();a.destroy()}};this.programs=e};
THREE.WebGLProperties=function(){var a={};this.get=function(b){b=b.uuid;var c=a[b];void 0===c&&(c={},a[b]=c);return c};this["delete"]=function(b){delete a[b.uuid]};this.clear=function(){a={}}};
THREE.WebGLShader=function(){function a(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+": "+a[b];return a.join("\n")}return function(b,c,e){var d=b.createShader(c);b.shaderSource(d,e);b.compileShader(d);!1===b.getShaderParameter(d,b.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");""!==b.getShaderInfoLog(d)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",c===b.VERTEX_SHADER?"vertex":"fragment",b.getShaderInfoLog(d),a(e));return d}}();
THREE.WebGLShadowMap=function(a,b,c,e){function d(b,c,d,e){var f=b.geometry,g;g=w;var h=b.customDepthMaterial;d&&(g=v,h=b.customDistanceMaterial);h?g=h:(h=!1,c.morphTargets&&(f instanceof THREE.BufferGeometry?h=f.morphAttributes&&f.morphAttributes.position&&0<f.morphAttributes.position.length:f instanceof THREE.Geometry&&(h=f.morphTargets&&0<f.morphTargets.length)),b=b instanceof THREE.SkinnedMesh&&c.skinning,f=0,h&&(f|=1),b&&(f|=2),g=g[f]);a.localClippingEnabled&&!0===c.clipShadows&&0!==c.clippingPlanes.length&&
(h=g.uuid,b=c.uuid,f=u[h],void 0===f&&(f={},u[h]=f),h=f[b],void 0===h&&(h=g.clone(),f[b]=h),g=h);g.visible=c.visible;g.wireframe=c.wireframe;b=c.side;K.renderSingleSided&&b==THREE.DoubleSide&&(b=THREE.FrontSide);K.renderReverseSided&&(b===THREE.FrontSide?b=THREE.BackSide:b===THREE.BackSide&&(b=THREE.FrontSide));g.side=b;g.clipShadows=c.clipShadows;g.clippingPlanes=c.clippingPlanes;g.wireframeLinewidth=c.wireframeLinewidth;g.linewidth=c.linewidth;d&&void 0!==g.uniforms.lightPos&&g.uniforms.lightPos.value.copy(e);
return g}function g(a,b,c){if(!1!==a.visible){a.layers.test(b.layers)&&(a instanceof THREE.Mesh||a instanceof THREE.Line||a instanceof THREE.Points)&&a.castShadow&&(!1===a.frustumCulled||!0===k.intersectsObject(a))&&!0===a.material.visible&&(a.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,a.matrixWorld),t.push(a));a=a.children;for(var d=0,e=a.length;d<e;d++)g(a[d],b,c)}}var f=a.context,h=a.state,k=new THREE.Frustum,l=new THREE.Matrix4,n=b.shadows,q=new THREE.Vector2,m=new THREE.Vector2(e.maxTextureSize,
e.maxTextureSize),p=new THREE.Vector3,r=new THREE.Vector3,t=[],w=Array(4),v=Array(4),u={},z=[new THREE.Vector3(1,0,0),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,-1),new THREE.Vector3(0,1,0),new THREE.Vector3(0,-1,0)],x=[new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,-1)],A=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4];
b=new THREE.MeshDepthMaterial;b.depthPacking=THREE.RGBADepthPacking;b.clipping=!0;e=THREE.ShaderLib.distanceRGBA;for(var y=THREE.UniformsUtils.clone(e.uniforms),B=0;4!==B;++B){var C=0!==(B&1),F=0!==(B&2),H=b.clone();H.morphTargets=C;H.skinning=F;w[B]=H;C=new THREE.ShaderMaterial({defines:{USE_SHADOWMAP:""},uniforms:y,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,morphTargets:C,skinning:F,clipping:!0});v[B]=C}var K=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=
THREE.PCFShadowMap;this.renderSingleSided=this.renderReverseSided=!0;this.render=function(b,e){if(!1!==K.enabled&&(!1!==K.autoUpdate||!1!==K.needsUpdate)&&0!==n.length){h.clearColor(1,1,1,1);h.disable(f.BLEND);h.setDepthTest(!0);h.setScissorTest(!1);for(var u,v,w=0,y=n.length;w<y;w++){var B=n[w],F=B.shadow;if(void 0===F)console.warn("THREE.WebGLShadowMap:",B,"has no shadow.");else{var R=F.camera;q.copy(F.mapSize);q.min(m);if(B instanceof THREE.PointLight){u=6;v=!0;var G=q.x,C=q.y;A[0].set(2*G,C,G,
C);A[1].set(0,C,G,C);A[2].set(3*G,C,G,C);A[3].set(G,C,G,C);A[4].set(3*G,0,G,C);A[5].set(G,0,G,C);q.x*=4;q.y*=2}else u=1,v=!1;null===F.map&&(F.map=new THREE.WebGLRenderTarget(q.x,q.y,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat}),R.updateProjectionMatrix());F instanceof THREE.SpotLightShadow&&F.update(B);G=F.map;F=F.matrix;r.setFromMatrixPosition(B.matrixWorld);R.position.copy(r);a.setRenderTarget(G);a.clear();for(G=0;G<u;G++){v?(p.copy(R.position),p.add(z[G]),
R.up.copy(x[G]),R.lookAt(p),h.viewport(A[G])):(p.setFromMatrixPosition(B.target.matrixWorld),R.lookAt(p));R.updateMatrixWorld();R.matrixWorldInverse.getInverse(R.matrixWorld);F.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);F.multiply(R.projectionMatrix);F.multiply(R.matrixWorldInverse);l.multiplyMatrices(R.projectionMatrix,R.matrixWorldInverse);k.setFromMatrix(l);t.length=0;g(b,e,R);for(var C=0,H=t.length;C<H;C++){var M=t[C],O=c.update(M),W=M.material;if(W instanceof THREE.MultiMaterial)for(var ba=O.groups,
W=W.materials,L=0,U=ba.length;L<U;L++){var Z=ba[L],ca=W[Z.materialIndex];!0===ca.visible&&(ca=d(M,ca,v,r),a.renderBufferDirect(R,null,O,ca,M,Z))}else ca=d(M,W,v,r),a.renderBufferDirect(R,null,O,ca,M,null)}}}}u=a.getClearColor();v=a.getClearAlpha();a.setClearColor(u,v);K.needsUpdate=!1}}};
THREE.WebGLState=function(a,b,c){function e(b,c,d){var e=new Uint8Array(4),f=a.createTexture();a.bindTexture(b,f);a.texParameteri(b,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(b,a.TEXTURE_MAG_FILTER,a.NEAREST);for(b=0;b<d;b++)a.texImage2D(c+b,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,e);return f}var d=this;this.buffers={color:new THREE.WebGLColorBuffer(a,this),depth:new THREE.WebGLDepthBuffer(a,this),stencil:new THREE.WebGLStencilBuffer(a,this)};var g=a.getParameter(a.MAX_VERTEX_ATTRIBS),f=new Uint8Array(g),
h=new Uint8Array(g),k=new Uint8Array(g),l={},n=null,q=null,m=null,p=null,r=null,t=null,w=null,v=null,u=!1,z=null,x=null,A=null,y=null,B=null,C=null,F=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),H=null,K={},M=new THREE.Vector4,O=new THREE.Vector4,I={};I[a.TEXTURE_2D]=e(a.TEXTURE_2D,a.TEXTURE_2D,1);I[a.TEXTURE_CUBE_MAP]=e(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6);this.init=function(){this.clearColor(0,0,0,1);this.clearDepth(1);this.clearStencil(0);this.enable(a.DEPTH_TEST);this.setDepthFunc(THREE.LessEqualDepth);
this.setFlipSided(!1);this.setCullFace(THREE.CullFaceBack);this.enable(a.CULL_FACE);this.enable(a.BLEND);this.setBlending(THREE.NormalBlending)};this.initAttributes=function(){for(var a=0,b=f.length;a<b;a++)f[a]=0};this.enableAttribute=function(c){f[c]=1;0===h[c]&&(a.enableVertexAttribArray(c),h[c]=1);0!==k[c]&&(b.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(c,0),k[c]=0)};this.enableAttributeAndDivisor=function(b,c,d){f[b]=1;0===h[b]&&(a.enableVertexAttribArray(b),h[b]=1);k[b]!==c&&(d.vertexAttribDivisorANGLE(b,
c),k[b]=c)};this.disableUnusedAttributes=function(){for(var b=0,c=h.length;b!==c;++b)h[b]!==f[b]&&(a.disableVertexAttribArray(b),h[b]=0)};this.enable=function(b){!0!==l[b]&&(a.enable(b),l[b]=!0)};this.disable=function(b){!1!==l[b]&&(a.disable(b),l[b]=!1)};this.getCompressedTextureFormats=function(){if(null===n&&(n=[],b.get("WEBGL_compressed_texture_pvrtc")||b.get("WEBGL_compressed_texture_s3tc")||b.get("WEBGL_compressed_texture_etc1")))for(var c=a.getParameter(a.COMPRESSED_TEXTURE_FORMATS),d=0;d<
c.length;d++)n.push(c[d]);return n};this.setBlending=function(b,d,e,f,g,h,k,l){if(b!==THREE.NoBlending){this.enable(a.BLEND);if(b!==q||l!==u)b===THREE.AdditiveBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE,a.ONE,a.ONE)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):b===THREE.SubtractiveBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),
a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):b===THREE.MultiplyBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.SRC_COLOR,a.ZERO,a.SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),
q=b,u=l;if(b===THREE.CustomBlending){g=g||d;h=h||e;k=k||f;if(d!==m||g!==t)a.blendEquationSeparate(c(d),c(g)),m=d,t=g;if(e!==p||f!==r||h!==w||k!==v)a.blendFuncSeparate(c(e),c(f),c(h),c(k)),p=e,r=f,w=h,v=k}else v=w=t=r=p=m=null}else this.disable(a.BLEND),q=b};this.setColorWrite=function(a){this.buffers.color.setMask(a)};this.setDepthTest=function(a){this.buffers.depth.setTest(a)};this.setDepthWrite=function(a){this.buffers.depth.setMask(a)};this.setDepthFunc=function(a){this.buffers.depth.setFunc(a)};
this.setStencilTest=function(a){this.buffers.stencil.setTest(a)};this.setStencilWrite=function(a){this.buffers.stencil.setMask(a)};this.setStencilFunc=function(a,b,c){this.buffers.stencil.setFunc(a,b,c)};this.setStencilOp=function(a,b,c){this.buffers.stencil.setOp(a,b,c)};this.setFlipSided=function(b){z!==b&&(b?a.frontFace(a.CW):a.frontFace(a.CCW),z=b)};this.setCullFace=function(b){b!==THREE.CullFaceNone?(this.enable(a.CULL_FACE),b!==x&&(b===THREE.CullFaceBack?a.cullFace(a.BACK):b===THREE.CullFaceFront?
a.cullFace(a.FRONT):a.cullFace(a.FRONT_AND_BACK))):this.disable(a.CULL_FACE);x=b};this.setLineWidth=function(b){b!==A&&(a.lineWidth(b),A=b)};this.setPolygonOffset=function(b,c,d){if(b){if(this.enable(a.POLYGON_OFFSET_FILL),y!==c||B!==d)a.polygonOffset(c,d),y=c,B=d}else this.disable(a.POLYGON_OFFSET_FILL)};this.getScissorTest=function(){return C};this.setScissorTest=function(b){(C=b)?this.enable(a.SCISSOR_TEST):this.disable(a.SCISSOR_TEST)};this.activeTexture=function(b){void 0===b&&(b=a.TEXTURE0+
F-1);H!==b&&(a.activeTexture(b),H=b)};this.bindTexture=function(b,c){null===H&&d.activeTexture();var e=K[H];void 0===e&&(e={type:void 0,texture:void 0},K[H]=e);if(e.type!==b||e.texture!==c)a.bindTexture(b,c||I[b]),e.type=b,e.texture=c};this.compressedTexImage2D=function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(D){console.error(D)}};this.texImage2D=function(){try{a.texImage2D.apply(a,arguments)}catch(D){console.error(D)}};this.clearColor=function(a,b,c,d){this.buffers.color.setClear(a,
b,c,d)};this.clearDepth=function(a){this.buffers.depth.setClear(a)};this.clearStencil=function(a){this.buffers.stencil.setClear(a)};this.scissor=function(b){!1===M.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),M.copy(b))};this.viewport=function(b){!1===O.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),O.copy(b))};this.reset=function(){for(var b=0;b<h.length;b++)1===h[b]&&(a.disableVertexAttribArray(b),h[b]=0);l={};H=n=null;K={};x=z=q=null;this.buffers.color.reset();this.buffers.depth.reset();this.buffers.stencil.reset()}};
THREE.WebGLColorBuffer=function(a,b){var c=!1,e=new THREE.Vector4,d=null,g=new THREE.Vector4;this.setMask=function(b){d===b||c||(a.colorMask(b,b,b,b),d=b)};this.setLocked=function(a){c=a};this.setClear=function(b,c,d,l){e.set(b,c,d,l);!1===g.equals(e)&&(a.clearColor(b,c,d,l),g.copy(e))};this.reset=function(){c=!1;d=null;g=new THREE.Vector4}};
THREE.WebGLDepthBuffer=function(a,b){var c=!1,e=null,d=null,g=null;this.setTest=function(c){c?b.enable(a.DEPTH_TEST):b.disable(a.DEPTH_TEST)};this.setMask=function(b){e===b||c||(a.depthMask(b),e=b)};this.setFunc=function(b){if(d!==b){if(b)switch(b){case THREE.NeverDepth:a.depthFunc(a.NEVER);break;case THREE.AlwaysDepth:a.depthFunc(a.ALWAYS);break;case THREE.LessDepth:a.depthFunc(a.LESS);break;case THREE.LessEqualDepth:a.depthFunc(a.LEQUAL);break;case THREE.EqualDepth:a.depthFunc(a.EQUAL);break;case THREE.GreaterEqualDepth:a.depthFunc(a.GEQUAL);
break;case THREE.GreaterDepth:a.depthFunc(a.GREATER);break;case THREE.NotEqualDepth:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}else a.depthFunc(a.LEQUAL);d=b}};this.setLocked=function(a){c=a};this.setClear=function(b){g!==b&&(a.clearDepth(b),g=b)};this.reset=function(){c=!1;g=d=e=null}};
THREE.WebGLStencilBuffer=function(a,b){var c=!1,e=null,d=null,g=null,f=null,h=null,k=null,l=null,n=null;this.setTest=function(c){c?b.enable(a.STENCIL_TEST):b.disable(a.STENCIL_TEST)};this.setMask=function(b){e===b||c||(a.stencilMask(b),e=b)};this.setFunc=function(b,c,e){if(d!==b||g!==c||f!==e)a.stencilFunc(b,c,e),d=b,g=c,f=e};this.setOp=function(b,c,d){if(h!==b||k!==c||l!==d)a.stencilOp(b,c,d),h=b,k=c,l=d};this.setLocked=function(a){c=a};this.setClear=function(b){n!==b&&(a.clearStencil(b),n=b)};this.reset=
function(){c=!1;n=l=k=h=f=g=d=e=null}};
THREE.WebGLTextures=function(a,b,c,e,d,g,f){function h(a,b){if(a.width>b||a.height>b){var c=b/Math.max(a.width,a.height),d=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");d.width=Math.floor(a.width*c);d.height=Math.floor(a.height*c);d.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,d.width,d.height);console.warn("THREE.WebGLRenderer: image is too big ("+a.width+"x"+a.height+"). Resized to "+d.width+"x"+d.height,a);return d}return a}function k(a){return THREE.Math.isPowerOfTwo(a.width)&&THREE.Math.isPowerOfTwo(a.height)}
function l(b){return b===THREE.NearestFilter||b===THREE.NearestMipMapNearestFilter||b===THREE.NearestMipMapLinearFilter?a.NEAREST:a.LINEAR}function n(b){b=b.target;b.removeEventListener("dispose",n);a:{var c=e.get(b);if(b.image&&c.__image__webglTextureCube)a.deleteTexture(c.__image__webglTextureCube);else{if(void 0===c.__webglInit)break a;a.deleteTexture(c.__webglTexture)}e["delete"](b)}w.textures--}function q(b){b=b.target;b.removeEventListener("dispose",q);var c=e.get(b),d=e.get(b.texture);if(b){void 0!==
d.__webglTexture&&a.deleteTexture(d.__webglTexture);b.depthTexture&&b.depthTexture.dispose();if(b instanceof THREE.WebGLRenderTargetCube)for(d=0;6>d;d++)a.deleteFramebuffer(c.__webglFramebuffer[d]),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer[d]);else a.deleteFramebuffer(c.__webglFramebuffer),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer);e["delete"](b.texture);e["delete"](b)}w.textures--}function m(b,f){var m=e.get(b);if(0<b.version&&m.__version!==b.version){var l=
b.image;if(void 0===l)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",b);else if(!1===l.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",b);else{void 0===m.__webglInit&&(m.__webglInit=!0,b.addEventListener("dispose",n),m.__webglTexture=a.createTexture(),w.textures++);c.activeTexture(a.TEXTURE0+f);c.bindTexture(a.TEXTURE_2D,m.__webglTexture);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
b.premultiplyAlpha);a.pixelStorei(a.UNPACK_ALIGNMENT,b.unpackAlignment);var r=h(b.image,d.maxTextureSize);if((b.wrapS!==THREE.ClampToEdgeWrapping||b.wrapT!==THREE.ClampToEdgeWrapping||b.minFilter!==THREE.NearestFilter&&b.minFilter!==THREE.LinearFilter)&&!1===k(r))if(l=r,l instanceof HTMLImageElement||l instanceof HTMLCanvasElement){var q=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");q.width=THREE.Math.nearestPowerOfTwo(l.width);q.height=THREE.Math.nearestPowerOfTwo(l.height);q.getContext("2d").drawImage(l,
0,0,q.width,q.height);console.warn("THREE.WebGLRenderer: image is not power of two ("+l.width+"x"+l.height+"). Resized to "+q.width+"x"+q.height,l);r=q}else r=l;var l=k(r),q=g(b.format),t=g(b.type);p(a.TEXTURE_2D,b,l);var u=b.mipmaps;if(b instanceof THREE.DepthTexture){u=a.DEPTH_COMPONENT;if(b.type===THREE.FloatType){if(!v)throw Error("Float Depth Texture only supported in WebGL2.0");u=a.DEPTH_COMPONENT32F}else v&&(u=a.DEPTH_COMPONENT16);c.texImage2D(a.TEXTURE_2D,0,u,r.width,r.height,0,q,t,null)}else if(b instanceof
THREE.DataTexture)if(0<u.length&&l){for(var z=0,K=u.length;z<K;z++)r=u[z],c.texImage2D(a.TEXTURE_2D,z,q,r.width,r.height,0,q,t,r.data);b.generateMipmaps=!1}else c.texImage2D(a.TEXTURE_2D,0,q,r.width,r.height,0,q,t,r.data);else if(b instanceof THREE.CompressedTexture)for(z=0,K=u.length;z<K;z++)r=u[z],b.format!==THREE.RGBAFormat&&b.format!==THREE.RGBFormat?-1<c.getCompressedTextureFormats().indexOf(q)?c.compressedTexImage2D(a.TEXTURE_2D,z,q,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):
c.texImage2D(a.TEXTURE_2D,z,q,r.width,r.height,0,q,t,r.data);else if(0<u.length&&l){z=0;for(K=u.length;z<K;z++)r=u[z],c.texImage2D(a.TEXTURE_2D,z,q,q,t,r);b.generateMipmaps=!1}else c.texImage2D(a.TEXTURE_2D,0,q,q,t,r);b.generateMipmaps&&l&&a.generateMipmap(a.TEXTURE_2D);m.__version=b.version;if(b.onUpdate)b.onUpdate(b);return}}c.activeTexture(a.TEXTURE0+f);c.bindTexture(a.TEXTURE_2D,m.__webglTexture)}function p(c,f,h){h?(a.texParameteri(c,a.TEXTURE_WRAP_S,g(f.wrapS)),a.texParameteri(c,a.TEXTURE_WRAP_T,
g(f.wrapT)),a.texParameteri(c,a.TEXTURE_MAG_FILTER,g(f.magFilter)),a.texParameteri(c,a.TEXTURE_MIN_FILTER,g(f.minFilter))):(a.texParameteri(c,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(c,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),f.wrapS===THREE.ClampToEdgeWrapping&&f.wrapT===THREE.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",f),a.texParameteri(c,a.TEXTURE_MAG_FILTER,l(f.magFilter)),
a.texParameteri(c,a.TEXTURE_MIN_FILTER,l(f.minFilter)),f.minFilter!==THREE.NearestFilter&&f.minFilter!==THREE.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",f));!(h=b.get("EXT_texture_filter_anisotropic"))||f.type===THREE.FloatType&&null===b.get("OES_texture_float_linear")||f.type===THREE.HalfFloatType&&null===b.get("OES_texture_half_float_linear")||!(1<f.anisotropy||e.get(f).__currentAnisotropy)||
(a.texParameterf(c,h.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(f.anisotropy,d.getMaxAnisotropy())),e.get(f).__currentAnisotropy=f.anisotropy)}function r(b,d,f,h){var k=g(d.texture.format),m=g(d.texture.type);c.texImage2D(h,0,k,d.width,d.height,0,k,m,null);a.bindFramebuffer(a.FRAMEBUFFER,b);a.framebufferTexture2D(a.FRAMEBUFFER,f,h,e.get(d.texture).__webglTexture,0);a.bindFramebuffer(a.FRAMEBUFFER,null)}function t(b,c){a.bindRenderbuffer(a.RENDERBUFFER,b);c.depthBuffer&&!c.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,
a.DEPTH_COMPONENT16,c.width,c.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,b)):c.depthBuffer&&c.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,c.width,c.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,b)):a.renderbufferStorage(a.RENDERBUFFER,a.RGBA4,c.width,c.height);a.bindRenderbuffer(a.RENDERBUFFER,null)}var w=f.memory,v="undefined"!==typeof WebGL2RenderingContext&&a instanceof WebGL2RenderingContext;
this.setTexture2D=m;this.setTextureCube=function(b,f){var m=e.get(b);if(6===b.image.length)if(0<b.version&&m.__version!==b.version){m.__image__webglTextureCube||(b.addEventListener("dispose",n),m.__image__webglTextureCube=a.createTexture(),w.textures++);c.activeTexture(a.TEXTURE0+f);c.bindTexture(a.TEXTURE_CUBE_MAP,m.__image__webglTextureCube);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);for(var l=b instanceof THREE.CompressedTexture,r=b.image[0]instanceof THREE.DataTexture,q=[],t=0;6>t;t++)q[t]=
l||r?r?b.image[t].image:b.image[t]:h(b.image[t],d.maxCubemapSize);var u=k(q[0]),v=g(b.format),z=g(b.type);p(a.TEXTURE_CUBE_MAP,b,u);for(t=0;6>t;t++)if(l)for(var M,O=q[t].mipmaps,I=0,D=O.length;I<D;I++)M=O[I],b.format!==THREE.RGBAFormat&&b.format!==THREE.RGBFormat?-1<c.getCompressedTextureFormats().indexOf(v)?c.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+t,I,v,M.width,M.height,0,M.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):
c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+t,I,v,M.width,M.height,0,v,z,M.data);else r?c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,v,q[t].width,q[t].height,0,v,z,q[t].data):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,v,v,z,q[t]);b.generateMipmaps&&u&&a.generateMipmap(a.TEXTURE_CUBE_MAP);m.__version=b.version;if(b.onUpdate)b.onUpdate(b)}else c.activeTexture(a.TEXTURE0+f),c.bindTexture(a.TEXTURE_CUBE_MAP,m.__image__webglTextureCube)};this.setTextureCubeDynamic=function(b,d){c.activeTexture(a.TEXTURE0+
d);c.bindTexture(a.TEXTURE_CUBE_MAP,e.get(b).__webglTexture)};this.setupRenderTarget=function(b){var d=e.get(b),f=e.get(b.texture);b.addEventListener("dispose",q);f.__webglTexture=a.createTexture();w.textures++;var g=b instanceof THREE.WebGLRenderTargetCube,h=k(b);if(g){d.__webglFramebuffer=[];for(var l=0;6>l;l++)d.__webglFramebuffer[l]=a.createFramebuffer()}else d.__webglFramebuffer=a.createFramebuffer();if(g){c.bindTexture(a.TEXTURE_CUBE_MAP,f.__webglTexture);p(a.TEXTURE_CUBE_MAP,b.texture,h);for(l=
0;6>l;l++)r(d.__webglFramebuffer[l],b,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+l);b.texture.generateMipmaps&&h&&a.generateMipmap(a.TEXTURE_CUBE_MAP);c.bindTexture(a.TEXTURE_CUBE_MAP,null)}else c.bindTexture(a.TEXTURE_2D,f.__webglTexture),p(a.TEXTURE_2D,b.texture,h),r(d.__webglFramebuffer,b,a.COLOR_ATTACHMENT0,a.TEXTURE_2D),b.texture.generateMipmaps&&h&&a.generateMipmap(a.TEXTURE_2D),c.bindTexture(a.TEXTURE_2D,null);if(b.depthBuffer){d=e.get(b);f=b instanceof THREE.WebGLRenderTargetCube;if(b.depthTexture){if(f)throw Error("target.depthTexture not supported in Cube render targets");
if(b instanceof THREE.WebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported!");a.bindFramebuffer(a.FRAMEBUFFER,d.__webglFramebuffer);if(!(b.depthTexture instanceof THREE.DepthTexture))throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");e.get(b.depthTexture).__webglTexture&&b.depthTexture.image.width===b.width&&b.depthTexture.image.height===b.height||(b.depthTexture.image.width=b.width,b.depthTexture.image.height=b.height,b.depthTexture.needsUpdate=
!0);m(b.depthTexture,0);b=e.get(b.depthTexture).__webglTexture;a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,b,0)}else if(f)for(d.__webglDepthbuffer=[],f=0;6>f;f++)a.bindFramebuffer(a.FRAMEBUFFER,d.__webglFramebuffer[f]),d.__webglDepthbuffer[f]=a.createRenderbuffer(),t(d.__webglDepthbuffer[f],b);else a.bindFramebuffer(a.FRAMEBUFFER,d.__webglFramebuffer),d.__webglDepthbuffer=a.createRenderbuffer(),t(d.__webglDepthbuffer,b);a.bindFramebuffer(a.FRAMEBUFFER,null)}};this.updateRenderTargetMipmap=
function(b){var d=b.texture;d.generateMipmaps&&k(b)&&d.minFilter!==THREE.NearestFilter&&d.minFilter!==THREE.LinearFilter&&(b=b instanceof THREE.WebGLRenderTargetCube?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D,d=e.get(d).__webglTexture,c.bindTexture(b,d),a.generateMipmap(b),c.bindTexture(b,null))}};
THREE.WebGLUniforms=function(){var a=new THREE.Texture,b=new THREE.CubeTexture,c=[],e=[],d=function(a,b,d){var e=a[0];if(0>=e||0<e)return a;var f=b*d,g=c[f];void 0===g&&(g=new Float32Array(f),c[f]=g);if(0!==b)for(e.toArray(g,0),e=1,f=0;e!==b;++e)f+=d,a[e].toArray(g,f);return g},g=function(a,b){var c=e[b];void 0===c&&(c=new Int32Array(b),e[b]=c);for(var d=0;d!==b;++d)c[d]=a.allocTextureUnit();return c},f=function(a,b){a.uniform1f(this.addr,b)},h=function(a,b){a.uniform1i(this.addr,b)},k=function(a,
b){void 0===b.x?a.uniform2fv(this.addr,b):a.uniform2f(this.addr,b.x,b.y)},l=function(a,b){void 0!==b.x?a.uniform3f(this.addr,b.x,b.y,b.z):void 0!==b.r?a.uniform3f(this.addr,b.r,b.g,b.b):a.uniform3fv(this.addr,b)},n=function(a,b){void 0===b.x?a.uniform4fv(this.addr,b):a.uniform4f(this.addr,b.x,b.y,b.z,b.w)},q=function(a,b){a.uniformMatrix2fv(this.addr,!1,b.elements||b)},m=function(a,b){a.uniformMatrix3fv(this.addr,!1,b.elements||b)},p=function(a,b){a.uniformMatrix4fv(this.addr,!1,b.elements||b)},r=
function(b,c,d){var e=d.allocTextureUnit();b.uniform1i(this.addr,e);d.setTexture2D(c||a,e)},t=function(a,c,d){var e=d.allocTextureUnit();a.uniform1i(this.addr,e);d.setTextureCube(c||b,e)},w=function(a,b){a.uniform2iv(this.addr,b)},v=function(a,b){a.uniform3iv(this.addr,b)},u=function(a,b){a.uniform4iv(this.addr,b)},z=function(a){switch(a){case 5126:return f;case 35664:return k;case 35665:return l;case 35666:return n;case 35674:return q;case 35675:return m;case 35676:return p;case 35678:return r;case 35680:return t;
case 5124:case 35670:return h;case 35667:case 35671:return w;case 35668:case 35672:return v;case 35669:case 35673:return u}},x=function(a,b){a.uniform1fv(this.addr,b)},A=function(a,b){a.uniform1iv(this.addr,b)},y=function(a,b){a.uniform2fv(this.addr,d(b,this.size,2))},B=function(a,b){a.uniform3fv(this.addr,d(b,this.size,3))},C=function(a,b){a.uniform4fv(this.addr,d(b,this.size,4))},F=function(a,b){a.uniformMatrix2fv(this.addr,!1,d(b,this.size,4))},H=function(a,b){a.uniformMatrix3fv(this.addr,!1,d(b,
this.size,9))},K=function(a,b){a.uniformMatrix4fv(this.addr,!1,d(b,this.size,16))},M=function(b,c,d){var e=c.length,f=g(d,e);b.uniform1iv(this.addr,f);for(b=0;b!==e;++b)d.setTexture2D(c[b]||a,f[b])},O=function(a,c,d){var e=c.length,f=g(d,e);a.uniform1iv(this.addr,f);for(a=0;a!==e;++a)d.setTextureCube(c[a]||b,f[a])},I=function(a){switch(a){case 5126:return x;case 35664:return y;case 35665:return B;case 35666:return C;case 35674:return F;case 35675:return H;case 35676:return K;case 35678:return M;case 35680:return O;
case 5124:case 35670:return A;case 35667:case 35671:return w;case 35668:case 35672:return v;case 35669:case 35673:return u}},D=function(a,b,c){this.id=a;this.addr=c;this.setValue=z(b.type)},J=function(a,b,c){this.id=a;this.addr=c;this.size=b.size;this.setValue=I(b.type)},N=function(a){this.id=a;this.seq=[];this.map={}};N.prototype.setValue=function(a,b){for(var c=this.seq,d=0,e=c.length;d!==e;++d){var f=c[d];f.setValue(a,b[f.id])}};var S=/([\w\d_]+)(\])?(\[|\.)?/g,Q=function(a,b,c){this.seq=[];this.map=
{};this.renderer=c;c=a.getProgramParameter(b,a.ACTIVE_UNIFORMS);for(var d=0;d!==c;++d){var e=a.getActiveUniform(b,d),f=a.getUniformLocation(b,e.name),g=this,h=e.name,k=h.length;for(S.lastIndex=0;;){var m=S.exec(h),p=S.lastIndex,l=m[1],n=m[3];"]"===m[2]&&(l|=0);if(void 0===n||"["===n&&p+2===k){h=g;e=void 0===n?new D(l,e,f):new J(l,e,f);h.seq.push(e);h.map[e.id]=e;break}else n=g.map[l],void 0===n&&(n=new N(l),l=g,g=n,l.seq.push(g),l.map[g.id]=g),g=n}}};Q.prototype.setValue=function(a,b,c){b=this.map[b];
void 0!==b&&b.setValue(a,c,this.renderer)};Q.prototype.set=function(a,b,c){var d=this.map[c];void 0!==d&&d.setValue(a,b[c],this.renderer)};Q.prototype.setOptional=function(a,b,c){b=b[c];void 0!==b&&this.setValue(a,c,b)};Q.upload=function(a,b,c,d){for(var e=0,f=b.length;e!==f;++e){var g=b[e],h=c[g.id];!1!==h.needsUpdate&&g.setValue(a,h.value,d)}};Q.seqWithValue=function(a,b){for(var c=[],d=0,e=a.length;d!==e;++d){var f=a[d];f.id in b&&c.push(f)}return c};Q.splitDynamic=function(a,b){for(var c=null,
d=a.length,e=0,f=0;f!==d;++f){var g=a[f],h=b[g.id];h&&!0===h.dynamic?(null===c&&(c=[]),c.push(g)):(e<f&&(a[e]=g),++e)}e<d&&(a.length=e);return c};Q.evalDynamic=function(a,b,c,d){for(var e=0,f=a.length;e!==f;++e){var g=b[a[e].id],h=g.onUpdateCallback;void 0!==h&&h.call(g,c,d)}};return Q}();
THREE.LensFlarePlugin=function(a,b){var c,e,d,g,f,h,k,l,n,q,m=a.context,p=a.state,r,t,w,v,u;this.render=function(z,x,A){if(0!==b.length){z=new THREE.Vector3;var y=A.w/A.z,B=.5*A.z,C=.5*A.w,F=16/A.w,H=new THREE.Vector2(F*y,F),K=new THREE.Vector3(1,1,0),M=new THREE.Vector2(1,1),O=new THREE.Box2;O.min.set(0,0);O.max.set(A.z-16,A.w-16);if(void 0===w){var F=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),I=new Uint16Array([0,1,2,0,2,3]);r=m.createBuffer();t=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,
r);m.bufferData(m.ARRAY_BUFFER,F,m.STATIC_DRAW);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,t);m.bufferData(m.ELEMENT_ARRAY_BUFFER,I,m.STATIC_DRAW);v=m.createTexture();u=m.createTexture();p.bindTexture(m.TEXTURE_2D,v);m.texImage2D(m.TEXTURE_2D,0,m.RGB,16,16,0,m.RGB,m.UNSIGNED_BYTE,null);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,
m.NEAREST);p.bindTexture(m.TEXTURE_2D,u);m.texImage2D(m.TEXTURE_2D,0,m.RGBA,16,16,0,m.RGBA,m.UNSIGNED_BYTE,null);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST);var F={vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},I=m.createProgram(),D=m.createShader(m.FRAGMENT_SHADER),
J=m.createShader(m.VERTEX_SHADER),N="precision "+a.getPrecision()+" float;\n";m.shaderSource(D,N+F.fragmentShader);m.shaderSource(J,N+F.vertexShader);m.compileShader(D);m.compileShader(J);m.attachShader(I,D);m.attachShader(I,J);m.linkProgram(I);w=I;n=m.getAttribLocation(w,"position");q=m.getAttribLocation(w,"uv");c=m.getUniformLocation(w,"renderType");e=m.getUniformLocation(w,"map");d=m.getUniformLocation(w,"occlusionMap");g=m.getUniformLocation(w,"opacity");f=m.getUniformLocation(w,"color");h=m.getUniformLocation(w,
"scale");k=m.getUniformLocation(w,"rotation");l=m.getUniformLocation(w,"screenPosition")}m.useProgram(w);p.initAttributes();p.enableAttribute(n);p.enableAttribute(q);p.disableUnusedAttributes();m.uniform1i(d,0);m.uniform1i(e,1);m.bindBuffer(m.ARRAY_BUFFER,r);m.vertexAttribPointer(n,2,m.FLOAT,!1,16,0);m.vertexAttribPointer(q,2,m.FLOAT,!1,16,8);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,t);p.disable(m.CULL_FACE);p.setDepthWrite(!1);I=0;for(D=b.length;I<D;I++)if(F=16/A.w,H.set(F*y,F),J=b[I],z.set(J.matrixWorld.elements[12],
J.matrixWorld.elements[13],J.matrixWorld.elements[14]),z.applyMatrix4(x.matrixWorldInverse),z.applyProjection(x.projectionMatrix),K.copy(z),M.x=A.x+K.x*B+B-8,M.y=A.y+K.y*C+C-8,!0===O.containsPoint(M)){p.activeTexture(m.TEXTURE0);p.bindTexture(m.TEXTURE_2D,null);p.activeTexture(m.TEXTURE1);p.bindTexture(m.TEXTURE_2D,v);m.copyTexImage2D(m.TEXTURE_2D,0,m.RGB,M.x,M.y,16,16,0);m.uniform1i(c,0);m.uniform2f(h,H.x,H.y);m.uniform3f(l,K.x,K.y,K.z);p.disable(m.BLEND);p.enable(m.DEPTH_TEST);m.drawElements(m.TRIANGLES,
6,m.UNSIGNED_SHORT,0);p.activeTexture(m.TEXTURE0);p.bindTexture(m.TEXTURE_2D,u);m.copyTexImage2D(m.TEXTURE_2D,0,m.RGBA,M.x,M.y,16,16,0);m.uniform1i(c,1);p.disable(m.DEPTH_TEST);p.activeTexture(m.TEXTURE1);p.bindTexture(m.TEXTURE_2D,v);m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0);J.positionScreen.copy(K);J.customUpdateCallback?J.customUpdateCallback(J):J.updateLensFlares();m.uniform1i(c,2);p.enable(m.BLEND);for(var N=0,S=J.lensFlares.length;N<S;N++){var Q=J.lensFlares[N];.001<Q.opacity&&.001<Q.scale&&
(K.x=Q.x,K.y=Q.y,K.z=Q.z,F=Q.size*Q.scale/A.w,H.x=F*y,H.y=F,m.uniform3f(l,K.x,K.y,K.z),m.uniform2f(h,H.x,H.y),m.uniform1f(k,Q.rotation),m.uniform1f(g,Q.opacity),m.uniform3f(f,Q.color.r,Q.color.g,Q.color.b),p.setBlending(Q.blending,Q.blendEquation,Q.blendSrc,Q.blendDst),a.setTexture2D(Q.texture,1),m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0))}}p.enable(m.CULL_FACE);p.enable(m.DEPTH_TEST);p.setDepthWrite(!0);a.resetGLState()}}};
THREE.SpritePlugin=function(a,b){function c(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:b.id-a.id}var e,d,g,f,h,k,l,n,q,m,p,r,t,w,v,u,z,x=a.context,A=a.state,y,B,C,F,H=new THREE.Vector3,K=new THREE.Quaternion,M=new THREE.Vector3;this.render=function(O,I){if(0!==b.length){if(void 0===C){var D=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),J=new Uint16Array([0,1,2,0,2,3]);y=x.createBuffer();B=x.createBuffer();x.bindBuffer(x.ARRAY_BUFFER,y);
x.bufferData(x.ARRAY_BUFFER,D,x.STATIC_DRAW);x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,B);x.bufferData(x.ELEMENT_ARRAY_BUFFER,J,x.STATIC_DRAW);var D=x.createProgram(),J=x.createShader(x.VERTEX_SHADER),N=x.createShader(x.FRAGMENT_SHADER);x.shaderSource(J,["precision "+a.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));
x.shaderSource(N,["precision "+a.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));
x.compileShader(J);x.compileShader(N);x.attachShader(D,J);x.attachShader(D,N);x.linkProgram(D);C=D;u=x.getAttribLocation(C,"position");z=x.getAttribLocation(C,"uv");e=x.getUniformLocation(C,"uvOffset");d=x.getUniformLocation(C,"uvScale");g=x.getUniformLocation(C,"rotation");f=x.getUniformLocation(C,"scale");h=x.getUniformLocation(C,"color");k=x.getUniformLocation(C,"map");l=x.getUniformLocation(C,"opacity");n=x.getUniformLocation(C,"modelViewMatrix");q=x.getUniformLocation(C,"projectionMatrix");m=
x.getUniformLocation(C,"fogType");p=x.getUniformLocation(C,"fogDensity");r=x.getUniformLocation(C,"fogNear");t=x.getUniformLocation(C,"fogFar");w=x.getUniformLocation(C,"fogColor");v=x.getUniformLocation(C,"alphaTest");D=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");D.width=8;D.height=8;J=D.getContext("2d");J.fillStyle="white";J.fillRect(0,0,8,8);F=new THREE.Texture(D);F.needsUpdate=!0}x.useProgram(C);A.initAttributes();A.enableAttribute(u);A.enableAttribute(z);A.disableUnusedAttributes();
A.disable(x.CULL_FACE);A.enable(x.BLEND);x.bindBuffer(x.ARRAY_BUFFER,y);x.vertexAttribPointer(u,2,x.FLOAT,!1,16,0);x.vertexAttribPointer(z,2,x.FLOAT,!1,16,8);x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,B);x.uniformMatrix4fv(q,!1,I.projectionMatrix.elements);A.activeTexture(x.TEXTURE0);x.uniform1i(k,0);J=D=0;(N=O.fog)?(x.uniform3f(w,N.color.r,N.color.g,N.color.b),N instanceof THREE.Fog?(x.uniform1f(r,N.near),x.uniform1f(t,N.far),x.uniform1i(m,1),J=D=1):N instanceof THREE.FogExp2&&(x.uniform1f(p,N.density),
x.uniform1i(m,2),J=D=2)):(x.uniform1i(m,0),J=D=0);for(var N=0,S=b.length;N<S;N++){var Q=b[N];Q.modelViewMatrix.multiplyMatrices(I.matrixWorldInverse,Q.matrixWorld);Q.z=-Q.modelViewMatrix.elements[14]}b.sort(c);for(var R=[],N=0,S=b.length;N<S;N++){var Q=b[N],G=Q.material;!1!==G.visible&&(x.uniform1f(v,G.alphaTest),x.uniformMatrix4fv(n,!1,Q.modelViewMatrix.elements),Q.matrixWorld.decompose(H,K,M),R[0]=M.x,R[1]=M.y,Q=0,O.fog&&G.fog&&(Q=J),D!==Q&&(x.uniform1i(m,Q),D=Q),null!==G.map?(x.uniform2f(e,G.map.offset.x,
G.map.offset.y),x.uniform2f(d,G.map.repeat.x,G.map.repeat.y)):(x.uniform2f(e,0,0),x.uniform2f(d,1,1)),x.uniform1f(l,G.opacity),x.uniform3f(h,G.color.r,G.color.g,G.color.b),x.uniform1f(g,G.rotation),x.uniform2fv(f,R),A.setBlending(G.blending,G.blendEquation,G.blendSrc,G.blendDst),A.setDepthTest(G.depthTest),A.setDepthWrite(G.depthWrite),G.map?a.setTexture2D(G.map,0):a.setTexture2D(F,0),x.drawElements(x.TRIANGLES,6,x.UNSIGNED_SHORT,0))}A.enable(x.CULL_FACE);a.resetGLState()}}};
Object.assign(THREE,{Face4:function(a,b,c,e,d,g,f){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new THREE.Face3(a,b,c,d,g,f)},LineStrip:0,LinePieces:1,MeshFaceMaterial:THREE.MultiMaterial,PointCloud:function(a,b){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new THREE.Points(a,b)},Particle:THREE.Sprite,ParticleSystem:function(a,b){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new THREE.Points(a,
b)},PointCloudMaterial:function(a){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new THREE.PointsMaterial(a)},ParticleBasicMaterial:function(a){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new THREE.PointsMaterial(a)},ParticleSystemMaterial:function(a){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new THREE.PointsMaterial(a)},Vertex:function(a,b,c){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");
return new THREE.Vector3(a,b,c)}});Object.assign(THREE.Box2.prototype,{empty:function(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(a){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)}});
Object.assign(THREE.Box3.prototype,{empty:function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(a){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionSphere:function(a){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)}});
Object.assign(THREE.Matrix3.prototype,{multiplyVector3:function(a){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)}});
Object.assign(THREE.Matrix4.prototype,{extractPosition:function(a){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(a)},setRotationFromQuaternion:function(a){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(a)},multiplyVector3:function(a){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");
return a.applyProjection(this)},multiplyVector4:function(a){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},rotateAxis:function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");
a.transformDirection(this)},crossVector:function(a){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},translate:function(a){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(a){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(a){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(a){console.error("THREE.Matrix4: .rotateZ() has been removed.")},
rotateByAxis:function(a,b){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")}});Object.assign(THREE.Plane.prototype,{isIntersectionLine:function(a){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");return this.intersectsLine(a)}});Object.assign(THREE.Quaternion.prototype,{multiplyVector3:function(a){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return a.applyQuaternion(this)}});
Object.assign(THREE.Ray.prototype,{isIntersectionBox:function(a){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionPlane:function(a){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");return this.intersectsPlane(a)},isIntersectionSphere:function(a){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)}});
Object.assign(THREE.Vector3.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(a)},
getScaleFromMatrix:function(a){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(b,a)}});
Object.assign(THREE.Object3D.prototype,{getChildByName:function(a){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(a)},renderDepth:function(a){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(a,b){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(b,a)}});
Object.defineProperties(THREE.Object3D.prototype,{eulerOrder:{get:function(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function(a){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=a}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(a){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});
Object.defineProperties(THREE.LOD.prototype,{objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}});THREE.PerspectiveCamera.prototype.setLens=function(a,b){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");void 0!==b&&(this.filmGauge=b);this.setFocalLength(a)};
Object.defineProperties(THREE.Light.prototype,{onlyShadow:{set:function(a){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(a){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");this.shadow.camera.fov=a}},shadowCameraLeft:{set:function(a){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=a}},shadowCameraRight:{set:function(a){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");
this.shadow.camera.right=a}},shadowCameraTop:{set:function(a){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");this.shadow.camera.top=a}},shadowCameraBottom:{set:function(a){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");this.shadow.camera.bottom=a}},shadowCameraNear:{set:function(a){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=a}},shadowCameraFar:{set:function(a){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");
this.shadow.camera.far=a}},shadowCameraVisible:{set:function(a){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(a){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");this.shadow.bias=a}},shadowDarkness:{set:function(a){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(a){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");
this.shadow.mapSize.width=a}},shadowMapHeight:{set:function(a){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=a}}});Object.defineProperties(THREE.BufferAttribute.prototype,{length:{get:function(){console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count.");return this.array.length}}});
Object.assign(THREE.BufferGeometry.prototype,{addIndex:function(a){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(a)},addDrawCall:function(a,b,c){void 0!==c&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.");console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(a,b)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},
computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}});Object.defineProperties(THREE.BufferGeometry.prototype,{drawcalls:{get:function(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups}}});
Object.defineProperties(THREE.Material.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(a){console.warn("THREE."+this.type+": .wrapAround has been removed.")}},wrapRGB:{get:function(){console.warn("THREE."+this.type+": .wrapRGB has been removed.");return new THREE.Color}}});
Object.defineProperties(THREE.MeshPhongMaterial.prototype,{metal:{get:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.");return!1},set:function(a){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});
Object.defineProperties(THREE.ShaderMaterial.prototype,{derivatives:{get:function(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");return this.extensions.derivatives},set:function(a){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=a}}});
THREE.EventDispatcher.prototype=Object.assign(Object.create({constructor:THREE.EventDispatcher,apply:function(a){console.warn("THREE.EventDispatcher: .apply is deprecated, just inherit or Object.assign the prototype to mix-in.");Object.assign(a,this)}}),THREE.EventDispatcher.prototype);
Object.assign(THREE.WebGLRenderer.prototype,{supportsFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");
return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")},
supportsBlendMinMax:function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return this.capabilities.vertexTextures},supportsInstancedArrays:function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(a){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");
this.setScissorTest(a)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}});
Object.defineProperties(THREE.WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=a}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");this.shadowMap.type=a}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.");
this.shadowMap.cullFace=a}}});Object.defineProperties(THREE.WebGLShadowMap.prototype,{cullFace:{get:function(){return this.renderReverseSided?THREE.CullFaceFront:THREE.CullFaceBack},set:function(a){a=a!==THREE.CullFaceBack;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+a+".");this.renderReverseSided=a}}});
Object.defineProperties(THREE.WebGLRenderTarget.prototype,{wrapS:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=a}},wrapT:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=
a}},magFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");return this.texture.magFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=a}},minFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=
a}},anisotropy:{get:function(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");return this.texture.anisotropy},set:function(a){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=a}},offset:{get:function(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function(a){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=
a}},repeat:{get:function(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},set:function(a){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=a}},format:{get:function(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function(a){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=a}},type:{get:function(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");
return this.texture.type},set:function(a){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");this.texture.type=a}},generateMipmaps:{get:function(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set:function(a){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=a}}});
Object.assign(THREE.Audio.prototype,{load:function(a){console.warn("THREE.Audio: .load has been deprecated. Please use THREE.AudioLoader.");var b=this;(new THREE.AudioLoader).load(a,function(a){b.setBuffer(a)});return this}});Object.assign(THREE.AudioAnalyser.prototype,{getData:function(a){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()}});
THREE.GeometryUtils={merge:function(a,b,c){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var e;b instanceof THREE.Mesh&&(b.matrixAutoUpdate&&b.updateMatrix(),e=b.matrix,b=b.geometry);a.merge(b,e,c)},center:function(a){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return a.center()}};
THREE.ImageUtils={crossOrigin:void 0,loadTexture:function(a,b,c,e){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var d=new THREE.TextureLoader;d.setCrossOrigin(this.crossOrigin);a=d.load(a,c,void 0,e);b&&(a.mapping=b);return a},loadTextureCube:function(a,b,c,e){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var d=new THREE.CubeTextureLoader;d.setCrossOrigin(this.crossOrigin);a=d.load(a,
c,void 0,e);b&&(a.mapping=b);return a},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};
THREE.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};this.pickingRay=function(a,b){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};
THREE.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};
THREE.CurveUtils={tangentQuadraticBezier:function(a,b,c,e){return 2*(1-a)*(c-b)+2*a*(e-c)},tangentCubicBezier:function(a,b,c,e,d){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*e*(1-a)-3*a*a*e+3*a*a*d},tangentSpline:function(a,b,c,e,d){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(a,b,c,e,d){a=.5*(c-a);e=.5*(e-b);var g=d*d;return(2*b-2*c+a+e)*d*g+(-3*b+3*c-2*a-e)*g+a*d+b}};
THREE.SceneUtils={createMultiMaterialObject:function(a,b){for(var c=new THREE.Group,e=0,d=b.length;e<d;e++)c.add(new THREE.Mesh(a,b[e]));return c},detach:function(a,b,c){a.applyMatrix(b.matrixWorld);b.remove(a);c.add(a)},attach:function(a,b,c){var e=new THREE.Matrix4;e.getInverse(c.matrixWorld);a.applyMatrix(e);b.remove(a);c.add(a)}};
THREE.ShapeUtils={area:function(a){for(var b=a.length,c=0,e=b-1,d=0;d<b;e=d++)c+=a[e].x*a[d].y-a[d].x*a[e].y;return.5*c},triangulate:function(){return function(a,b){var c=a.length;if(3>c)return null;var e=[],d=[],g=[],f,h,k;if(0<THREE.ShapeUtils.area(a))for(h=0;h<c;h++)d[h]=h;else for(h=0;h<c;h++)d[h]=c-1-h;var l=2*c;for(h=c-1;2<c;){if(0>=l--){console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()");break}f=h;c<=f&&(f=0);h=f+1;c<=h&&(h=0);k=h+1;c<=k&&(k=0);var n;a:{var q,
m,p,r,t,w,v,u;q=a[d[f]].x;m=a[d[f]].y;p=a[d[h]].x;r=a[d[h]].y;t=a[d[k]].x;w=a[d[k]].y;if(Number.EPSILON>(p-q)*(w-m)-(r-m)*(t-q))n=!1;else{var z,x,A,y,B,C,F,H,K,M=void 0;K=H=F=u=v=void 0;z=t-p;x=w-r;A=q-t;y=m-w;B=p-q;C=r-m;for(n=0;n<c;n++)if(v=a[d[n]].x,u=a[d[n]].y,!(v===q&&u===m||v===p&&u===r||v===t&&u===w)&&(F=v-q,H=u-m,K=v-p,M=u-r,v-=t,u-=w,K=z*M-x*K,F=B*H-C*F,H=A*u-y*v,K>=-Number.EPSILON&&H>=-Number.EPSILON&&F>=-Number.EPSILON)){n=!1;break a}n=!0}}if(n){e.push([a[d[f]],a[d[h]],a[d[k]]]);g.push([d[f],
d[h],d[k]]);f=h;for(k=h+1;k<c;f++,k++)d[f]=d[k];c--;l=2*c}}return b?g:e}}(),triangulateShape:function(a,b){function c(a){var b=a.length;2<b&&a[b-1].equals(a[0])&&a.pop()}function e(a,b,c){return a.x!==b.x?a.x<b.x?a.x<=c.x&&c.x<=b.x:b.x<=c.x&&c.x<=a.x:a.y<b.y?a.y<=c.y&&c.y<=b.y:b.y<=c.y&&c.y<=a.y}function d(a,b,c,d,f){var g=b.x-a.x,h=b.y-a.y,k=d.x-c.x,m=d.y-c.y,p=a.x-c.x,l=a.y-c.y,n=h*k-g*m,r=h*p-g*l;if(Math.abs(n)>Number.EPSILON){if(0<n){if(0>r||r>n)return[];k=m*p-k*l;if(0>k||k>n)return[]}else{if(0<
r||r<n)return[];k=m*p-k*l;if(0<k||k<n)return[]}if(0===k)return!f||0!==r&&r!==n?[a]:[];if(k===n)return!f||0!==r&&r!==n?[b]:[];if(0===r)return[c];if(r===n)return[d];f=k/n;return[{x:a.x+f*g,y:a.y+f*h}]}if(0!==r||m*p!==k*l)return[];h=0===g&&0===h;k=0===k&&0===m;if(h&&k)return a.x!==c.x||a.y!==c.y?[]:[a];if(h)return e(c,d,a)?[a]:[];if(k)return e(a,b,c)?[c]:[];0!==g?(a.x<b.x?(g=a,k=a.x,h=b,a=b.x):(g=b,k=b.x,h=a,a=a.x),c.x<d.x?(b=c,n=c.x,m=d,c=d.x):(b=d,n=d.x,m=c,c=c.x)):(a.y<b.y?(g=a,k=a.y,h=b,a=b.y):(g=
b,k=b.y,h=a,a=a.y),c.y<d.y?(b=c,n=c.y,m=d,c=d.y):(b=d,n=d.y,m=c,c=c.y));return k<=n?a<n?[]:a===n?f?[]:[b]:a<=c?[b,h]:[b,m]:k>c?[]:k===c?f?[]:[g]:a<=c?[g,h]:[g,m]}function g(a,b,c,d){var e=b.x-a.x,f=b.y-a.y;b=c.x-a.x;c=c.y-a.y;var g=d.x-a.x;d=d.y-a.y;a=e*c-f*b;e=e*d-f*g;return Math.abs(a)>Number.EPSILON?(b=g*c-d*b,0<a?0<=e&&0<=b:0<=e||0<=b):0<e}c(a);b.forEach(c);var f,h,k,l,n,q={};k=a.concat();f=0;for(h=b.length;f<h;f++)Array.prototype.push.apply(k,b[f]);f=0;for(h=k.length;f<h;f++)n=k[f].x+":"+k[f].y,
void 0!==q[n]&&console.warn("THREE.ShapeUtils: Duplicate point",n,f),q[n]=f;f=function(a,b){function c(a,b){var c=h.length-1,d=a-1;0>d&&(d=c);var e=a+1;e>c&&(e=0);c=g(h[a],h[d],h[e],k[b]);if(!c)return!1;c=k.length-1;d=b-1;0>d&&(d=c);e=b+1;e>c&&(e=0);return g(k[b],k[d],k[e],h[a])?!0:!1}function e(a,b){var c,e;for(c=0;c<h.length;c++)if(e=c+1,e%=h.length,e=d(a,b,h[c],h[e],!0),0<e.length)return!0;return!1}function f(a,c){var e,f,g,h;for(e=0;e<m.length;e++)for(f=b[m[e]],g=0;g<f.length;g++)if(h=g+1,h%=
f.length,h=d(a,c,f[g],f[h],!0),0<h.length)return!0;return!1}var h=a.concat(),k,m=[],p,l,n,r,q,H=[],K,M,O,I=0;for(p=b.length;I<p;I++)m.push(I);K=0;for(var D=2*m.length;0<m.length;){D--;if(0>D){console.log("Infinite Loop! Holes left:"+m.length+", Probably Hole outside Shape!");break}for(l=K;l<h.length;l++){n=h[l];p=-1;for(I=0;I<m.length;I++)if(r=m[I],q=n.x+":"+n.y+":"+r,void 0===H[q]){k=b[r];for(M=0;M<k.length;M++)if(r=k[M],c(l,M)&&!e(n,r)&&!f(n,r)){p=M;m.splice(I,1);K=h.slice(0,l+1);r=h.slice(l);M=
k.slice(p);O=k.slice(0,p+1);h=K.concat(M).concat(O).concat(r);K=l;break}if(0<=p)break;H[q]=!0}if(0<=p)break}}return h}(a,b);var m=THREE.ShapeUtils.triangulate(f,!1);f=0;for(h=m.length;f<h;f++)for(l=m[f],k=0;3>k;k++)n=l[k].x+":"+l[k].y,n=q[n],void 0!==n&&(l[k]=n);return m.concat()},isClockWise:function(a){return 0>THREE.ShapeUtils.area(a)},b2:function(){return function(a,b,c,e){var d=1-a;return d*d*b+2*(1-a)*a*c+a*a*e}}(),b3:function(){return function(a,b,c,e,d){var g=1-a,f=1-a;return g*g*g*b+3*f*
f*a*c+3*(1-a)*a*a*e+a*a*a*d}}()};THREE.Curve=function(){};
THREE.Curve.prototype={constructor:THREE.Curve,getPoint:function(a){console.warn("THREE.Curve: Warning, getPoint() not implemented!");return null},getPointAt:function(a){a=this.getUtoTmapping(a);return this.getPoint(a)},getPoints:function(a){a||(a=5);for(var b=[],c=0;c<=a;c++)b.push(this.getPoint(c/a));return b},getSpacedPoints:function(a){a||(a=5);for(var b=[],c=0;c<=a;c++)b.push(this.getPointAt(c/a));return b},getLength:function(){var a=this.getLengths();return a[a.length-1]},getLengths:function(a){a||
(a=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b=[],c,e=this.getPoint(0),d,g=0;b.push(0);for(d=1;d<=a;d++)c=this.getPoint(d/a),g+=c.distanceTo(e),b.push(g),e=c;return this.cacheArcLengths=b},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(a,b){var c=this.getLengths(),e=0,d=c.length,g;g=b?b:a*c[d-1];for(var f=0,h=d-
1,k;f<=h;)if(e=Math.floor(f+(h-f)/2),k=c[e]-g,0>k)f=e+1;else if(0<k)h=e-1;else{h=e;break}e=h;if(c[e]===g)return e/(d-1);f=c[e];return(e+(g-f)/(c[e+1]-f))/(d-1)},getTangent:function(a){var b=a-1E-4;a+=1E-4;0>b&&(b=0);1<a&&(a=1);b=this.getPoint(b);return this.getPoint(a).clone().sub(b).normalize()},getTangentAt:function(a){a=this.getUtoTmapping(a);return this.getTangent(a)}};
THREE.Curve.create=function(a,b){a.prototype=Object.create(THREE.Curve.prototype);a.prototype.constructor=a;a.prototype.getPoint=b;return a};THREE.CurvePath=function(){this.curves=[];this.autoClose=!1};
THREE.CurvePath.prototype=Object.assign(Object.create(THREE.Curve.prototype),{constructor:THREE.CurvePath,add:function(a){this.curves.push(a)},closePath:function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new THREE.LineCurve(b,a))},getPoint:function(a){var b=a*this.getLength(),c=this.getCurveLengths();for(a=0;a<c.length;){if(c[a]>=b)return b=c[a]-b,a=this.curves[a],c=a.getLength(),a.getPointAt(0===c?0:1-b/c);a++}return null},getLength:function(){var a=
this.getCurveLengths();return a[a.length-1]},updateArcLengths:function(){this.needsUpdate=!0;this.cacheLengths=null;this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var a=[],b=0,c=0,e=this.curves.length;c<e;c++)b+=this.curves[c].getLength(),a.push(b);return this.cacheLengths=a},getSpacedPoints:function(a){a||(a=40);for(var b=[],c=0;c<=a;c++)b.push(this.getPoint(c/a));this.autoClose&&b.push(b[0]);return b},
getPoints:function(a){a=a||12;for(var b=[],c,e=0,d=this.curves;e<d.length;e++)for(var g=d[e],g=g.getPoints(g instanceof THREE.EllipseCurve?2*a:g instanceof THREE.LineCurve?1:g instanceof THREE.SplineCurve?a*g.points.length:a),f=0;f<g.length;f++){var h=g[f];c&&c.equals(h)||(b.push(h),c=h)}this.autoClose&&1<b.length&&!b[b.length-1].equals(b[0])&&b.push(b[0]);return b},createPointsGeometry:function(a){a=this.getPoints(a);return this.createGeometry(a)},createSpacedPointsGeometry:function(a){a=this.getSpacedPoints(a);
return this.createGeometry(a)},createGeometry:function(a){for(var b=new THREE.Geometry,c=0,e=a.length;c<e;c++){var d=a[c];b.vertices.push(new THREE.Vector3(d.x,d.y,d.z||0))}return b}});THREE.Font=function(a){this.data=a};
Object.assign(THREE.Font.prototype,{generateShapes:function(a,b,c){void 0===b&&(b=100);void 0===c&&(c=4);var e=this.data;a=String(a).split("");var d=b/e.resolution,g=0;b=[];for(var f=0;f<a.length;f++){var h;h=d;var k=g,l=e.glyphs[a[f]]||e.glyphs["?"];if(l){var n=new THREE.ShapePath,q=[],m=THREE.ShapeUtils.b2,p=THREE.ShapeUtils.b3,r,t,w;t=r=void 0;var v,u=void 0,z=void 0,x=void 0,A=void 0;if(l.o)for(var y=l._cachedOutline||(l._cachedOutline=l.o.split(" ")),B=0,C=y.length;B<C;)switch(y[B++]){case "m":r=
y[B++]*h+k;t=y[B++]*h;n.moveTo(r,t);break;case "l":r=y[B++]*h+k;t=y[B++]*h;n.lineTo(r,t);break;case "q":r=y[B++]*h+k;t=y[B++]*h;u=y[B++]*h+k;z=y[B++]*h;n.quadraticCurveTo(u,z,r,t);if(v=q[q.length-1]){w=v.x;v=v.y;for(var F=1;F<=c;F++){var H=F/c;m(H,w,u,r);m(H,v,z,t)}}break;case "b":if(r=y[B++]*h+k,t=y[B++]*h,u=y[B++]*h+k,z=y[B++]*h,x=y[B++]*h+k,A=y[B++]*h,n.bezierCurveTo(u,z,x,A,r,t),v=q[q.length-1])for(w=v.x,v=v.y,F=1;F<=c;F++)H=F/c,p(H,w,u,x,r),p(H,v,z,A,t)}h={offset:l.ha*h,path:n}}else h=void 0;
g+=h.offset;b.push(h.path)}c=[];e=0;for(a=b.length;e<a;e++)Array.prototype.push.apply(c,b[e].toShapes());return c}});THREE.Path=function(a){THREE.CurvePath.call(this);this.currentPoint=new THREE.Vector2;a&&this.fromPoints(a)};
THREE.Path.prototype=Object.assign(Object.create(THREE.CurvePath.prototype),{constructor:THREE.Path,fromPoints:function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y)},moveTo:function(a,b){this.currentPoint.set(a,b)},lineTo:function(a,b){var c=new THREE.LineCurve(this.currentPoint.clone(),new THREE.Vector2(a,b));this.curves.push(c);this.currentPoint.set(a,b)},quadraticCurveTo:function(a,b,c,e){a=new THREE.QuadraticBezierCurve(this.currentPoint.clone(),new THREE.Vector2(a,
b),new THREE.Vector2(c,e));this.curves.push(a);this.currentPoint.set(c,e)},bezierCurveTo:function(a,b,c,e,d,g){a=new THREE.CubicBezierCurve(this.currentPoint.clone(),new THREE.Vector2(a,b),new THREE.Vector2(c,e),new THREE.Vector2(d,g));this.curves.push(a);this.currentPoint.set(d,g)},splineThru:function(a){var b=[this.currentPoint.clone()].concat(a),b=new THREE.SplineCurve(b);this.curves.push(b);this.currentPoint.copy(a[a.length-1])},arc:function(a,b,c,e,d,g){this.absarc(a+this.currentPoint.x,b+this.currentPoint.y,
c,e,d,g)},absarc:function(a,b,c,e,d,g){this.absellipse(a,b,c,c,e,d,g)},ellipse:function(a,b,c,e,d,g,f,h){this.absellipse(a+this.currentPoint.x,b+this.currentPoint.y,c,e,d,g,f,h)},absellipse:function(a,b,c,e,d,g,f,h){a=new THREE.EllipseCurve(a,b,c,e,d,g,f,h);0<this.curves.length&&(b=a.getPoint(0),b.equals(this.currentPoint)||this.lineTo(b.x,b.y));this.curves.push(a);a=a.getPoint(1);this.currentPoint.copy(a)}});THREE.ShapePath=function(){this.subPaths=[];this.currentPath=null};
THREE.ShapePath.prototype={moveTo:function(a,b){this.currentPath=new THREE.Path;this.subPaths.push(this.currentPath);this.currentPath.moveTo(a,b)},lineTo:function(a,b){this.currentPath.lineTo(a,b)},quadraticCurveTo:function(a,b,c,e){this.currentPath.quadraticCurveTo(a,b,c,e)},bezierCurveTo:function(a,b,c,e,d,g){this.currentPath.bezierCurveTo(a,b,c,e,d,g)},splineThru:function(a){this.currentPath.splineThru(a)},toShapes:function(a,b){function c(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c],f=new THREE.Shape;
f.curves=e.curves;b.push(f)}return b}function e(a,b){for(var c=b.length,d=!1,e=c-1,f=0;f<c;e=f++){var g=b[e],h=b[f],k=h.x-g.x,m=h.y-g.y;if(Math.abs(m)>Number.EPSILON){if(0>m&&(g=b[f],k=-k,h=b[e],m=-m),!(a.y<g.y||a.y>h.y))if(a.y===g.y){if(a.x===g.x)return!0}else{e=m*(a.x-g.x)-k*(a.y-g.y);if(0===e)return!0;0>e||(d=!d)}}else if(a.y===g.y&&(h.x<=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=h.x))return!0}return d}var d=THREE.ShapeUtils.isClockWise,g=this.subPaths;if(0===g.length)return[];if(!0===b)return c(g);var f,
h,k,l=[];if(1===g.length)return h=g[0],k=new THREE.Shape,k.curves=h.curves,l.push(k),l;var n=!d(g[0].getPoints()),n=a?!n:n;k=[];var q=[],m=[],p=0,r;q[p]=void 0;m[p]=[];for(var t=0,w=g.length;t<w;t++)h=g[t],r=h.getPoints(),f=d(r),(f=a?!f:f)?(!n&&q[p]&&p++,q[p]={s:new THREE.Shape,p:r},q[p].s.curves=h.curves,n&&p++,m[p]=[]):m[p].push({h:h,p:r[0]});if(!q[0])return c(g);if(1<q.length){t=!1;h=[];d=0;for(g=q.length;d<g;d++)k[d]=[];d=0;for(g=q.length;d<g;d++)for(f=m[d],n=0;n<f.length;n++){p=f[n];r=!0;for(w=
0;w<q.length;w++)e(p.p,q[w].p)&&(d!==w&&h.push({froms:d,tos:w,hole:n}),r?(r=!1,k[w].push(p)):t=!0);r&&k[d].push(p)}0<h.length&&(t||(m=k))}t=0;for(d=q.length;t<d;t++)for(k=q[t].s,l.push(k),h=m[t],g=0,f=h.length;g<f;g++)k.holes.push(h[g].h);return l}};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};
THREE.Shape.prototype=Object.assign(Object.create(THREE.Path.prototype),{constructor:THREE.Shape,extrude:function(a){return new THREE.ExtrudeGeometry(this,a)},makeGeometry:function(a){return new THREE.ShapeGeometry(this,a)},getPointsHoles:function(a){for(var b=[],c=0,e=this.holes.length;c<e;c++)b[c]=this.holes[c].getPoints(a);return b},extractAllPoints:function(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}},extractPoints:function(a){return this.extractAllPoints(a)}});
THREE.LineCurve=function(a,b){this.v1=a;this.v2=b};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.constructor=THREE.LineCurve;THREE.LineCurve.prototype.getPoint=function(a){if(1===a)return this.v2.clone();var b=this.v2.clone().sub(this.v1);b.multiplyScalar(a).add(this.v1);return b};THREE.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)};THREE.LineCurve.prototype.getTangent=function(a){return this.v2.clone().sub(this.v1).normalize()};
THREE.QuadraticBezierCurve=function(a,b,c){this.v0=a;this.v1=b;this.v2=c};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve;THREE.QuadraticBezierCurve.prototype.getPoint=function(a){var b=THREE.ShapeUtils.b2;return new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))};
THREE.QuadraticBezierCurve.prototype.getTangent=function(a){var b=THREE.CurveUtils.tangentQuadraticBezier;return(new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))).normalize()};THREE.CubicBezierCurve=function(a,b,c,e){this.v0=a;this.v1=b;this.v2=c;this.v3=e};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve;
THREE.CubicBezierCurve.prototype.getPoint=function(a){var b=THREE.ShapeUtils.b3;return new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))};THREE.CubicBezierCurve.prototype.getTangent=function(a){var b=THREE.CurveUtils.tangentCubicBezier;return(new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))).normalize()};THREE.SplineCurve=function(a){this.points=void 0==a?[]:a};
THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.constructor=THREE.SplineCurve;THREE.SplineCurve.prototype.getPoint=function(a){var b=this.points;a*=b.length-1;var c=Math.floor(a);a-=c;var e=b[0===c?c:c-1],d=b[c],g=b[c>b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=THREE.CurveUtils.interpolate;return new THREE.Vector2(c(e.x,d.x,g.x,b.x,a),c(e.y,d.y,g.y,b.y,a))};
THREE.EllipseCurve=function(a,b,c,e,d,g,f,h){this.aX=a;this.aY=b;this.xRadius=c;this.yRadius=e;this.aStartAngle=d;this.aEndAngle=g;this.aClockwise=f;this.aRotation=h||0};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.constructor=THREE.EllipseCurve;
THREE.EllipseCurve.prototype.getPoint=function(a){for(var b=2*Math.PI,c=this.aEndAngle-this.aStartAngle,e=Math.abs(c)<Number.EPSILON;0>c;)c+=b;for(;c>b;)c-=b;c<Number.EPSILON&&(c=e?0:b);!0!==this.aClockwise||e||(c=c===b?-b:c-b);b=this.aStartAngle+a*c;a=this.aX+this.xRadius*Math.cos(b);var d=this.aY+this.yRadius*Math.sin(b);0!==this.aRotation&&(b=Math.cos(this.aRotation),c=Math.sin(this.aRotation),e=a-this.aX,d-=this.aY,a=e*b-d*c+this.aX,d=e*c+d*b+this.aY);return new THREE.Vector2(a,d)};
THREE.ArcCurve=function(a,b,c,e,d,g){THREE.EllipseCurve.call(this,a,b,c,c,e,d,g)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.ArcCurve.prototype.constructor=THREE.ArcCurve;THREE.LineCurve3=THREE.Curve.create(function(a,b){this.v1=a;this.v2=b},function(a){if(1===a)return this.v2.clone();var b=new THREE.Vector3;b.subVectors(this.v2,this.v1);b.multiplyScalar(a);b.add(this.v1);return b});
THREE.QuadraticBezierCurve3=THREE.Curve.create(function(a,b,c){this.v0=a;this.v1=b;this.v2=c},function(a){var b=THREE.ShapeUtils.b2;return new THREE.Vector3(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y),b(a,this.v0.z,this.v1.z,this.v2.z))});
THREE.CubicBezierCurve3=THREE.Curve.create(function(a,b,c,e){this.v0=a;this.v1=b;this.v2=c;this.v3=e},function(a){var b=THREE.ShapeUtils.b3;return new THREE.Vector3(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),b(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z))});
THREE.SplineCurve3=THREE.Curve.create(function(a){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3");this.points=void 0==a?[]:a},function(a){var b=this.points;a*=b.length-1;var c=Math.floor(a);a-=c;var e=b[0==c?c:c-1],d=b[c],g=b[c>b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=THREE.CurveUtils.interpolate;return new THREE.Vector3(c(e.x,d.x,g.x,b.x,a),c(e.y,d.y,g.y,b.y,a),c(e.z,d.z,g.z,b.z,a))});
THREE.CatmullRomCurve3=function(){function a(){}var b=new THREE.Vector3,c=new a,e=new a,d=new a;a.prototype.init=function(a,b,c,d){this.c0=a;this.c1=c;this.c2=-3*a+3*b-2*c-d;this.c3=2*a-2*b+c+d};a.prototype.initNonuniformCatmullRom=function(a,b,c,d,e,n,q){this.init(b,c,((b-a)/e-(c-a)/(e+n)+(c-b)/n)*n,((c-b)/n-(d-b)/(n+q)+(d-c)/q)*n)};a.prototype.initCatmullRom=function(a,b,c,d,e){this.init(b,c,e*(c-a),e*(d-b))};a.prototype.calc=function(a){var b=a*a;return this.c0+this.c1*a+this.c2*b+this.c3*b*a};
return THREE.Curve.create(function(a){this.points=a||[];this.closed=!1},function(a){var f=this.points,g,k;k=f.length;2>k&&console.log("duh, you need at least 2 points");a*=k-(this.closed?0:1);g=Math.floor(a);a-=g;this.closed?g+=0<g?0:(Math.floor(Math.abs(g)/f.length)+1)*f.length:0===a&&g===k-1&&(g=k-2,a=1);var l,n,q;this.closed||0<g?l=f[(g-1)%k]:(b.subVectors(f[0],f[1]).add(f[0]),l=b);n=f[g%k];q=f[(g+1)%k];this.closed||g+2<k?f=f[(g+2)%k]:(b.subVectors(f[k-1],f[k-2]).add(f[k-1]),f=b);if(void 0===this.type||
"centripetal"===this.type||"chordal"===this.type){var m="chordal"===this.type?.5:.25;k=Math.pow(l.distanceToSquared(n),m);g=Math.pow(n.distanceToSquared(q),m);m=Math.pow(q.distanceToSquared(f),m);1E-4>g&&(g=1);1E-4>k&&(k=g);1E-4>m&&(m=g);c.initNonuniformCatmullRom(l.x,n.x,q.x,f.x,k,g,m);e.initNonuniformCatmullRom(l.y,n.y,q.y,f.y,k,g,m);d.initNonuniformCatmullRom(l.z,n.z,q.z,f.z,k,g,m)}else"catmullrom"===this.type&&(k=void 0!==this.tension?this.tension:.5,c.initCatmullRom(l.x,n.x,q.x,f.x,k),e.initCatmullRom(l.y,
n.y,q.y,f.y,k),d.initCatmullRom(l.z,n.z,q.z,f.z,k));return new THREE.Vector3(c.calc(a),e.calc(a),d.calc(a))})}();THREE.ClosedSplineCurve3=function(a){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Please use THREE.CatmullRomCurve3.");THREE.CatmullRomCurve3.call(this,a);this.type="catmullrom";this.closed=!0};THREE.ClosedSplineCurve3.prototype=Object.create(THREE.CatmullRomCurve3.prototype);
THREE.BoxGeometry=function(a,b,c,e,d,g){THREE.Geometry.call(this);this.type="BoxGeometry";this.parameters={width:a,height:b,depth:c,widthSegments:e,heightSegments:d,depthSegments:g};this.fromBufferGeometry(new THREE.BoxBufferGeometry(a,b,c,e,d,g));this.mergeVertices()};THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.BoxGeometry.prototype.constructor=THREE.BoxGeometry;THREE.CubeGeometry=THREE.BoxGeometry;
THREE.BoxBufferGeometry=function(a,b,c,e,d,g){function f(a,b,c,d,e,f,g,k,l,M,O){var x=f/l,z=g/M,y=f/2,N=g/2,B=k/2;g=l+1;for(var F=M+1,A=f=0,C=new THREE.Vector3,H=0;H<F;H++)for(var K=H*z-N,V=0;V<g;V++)C[a]=(V*x-y)*d,C[b]=K*e,C[c]=B,q[r]=C.x,q[r+1]=C.y,q[r+2]=C.z,C[a]=0,C[b]=0,C[c]=0<k?1:-1,m[r]=C.x,m[r+1]=C.y,m[r+2]=C.z,p[t]=V/l,p[t+1]=1-H/M,r+=3,t+=2,f+=1;for(H=0;H<M;H++)for(V=0;V<l;V++)a=v+V+g*(H+1),b=v+(V+1)+g*(H+1),c=v+(V+1)+g*H,n[w]=v+V+g*H,n[w+1]=a,n[w+2]=c,n[w+3]=a,n[w+4]=b,n[w+5]=c,w+=6,A+=
6;h.addGroup(u,A,O);u+=A;v+=f}THREE.BufferGeometry.call(this);this.type="BoxBufferGeometry";this.parameters={width:a,height:b,depth:c,widthSegments:e,heightSegments:d,depthSegments:g};var h=this;e=Math.floor(e)||1;d=Math.floor(d)||1;g=Math.floor(g)||1;var k=0+(e+1)*(d+1)*2+(e+1)*(g+1)*2+(g+1)*(d+1)*2,l=6*(0+e*d*2+e*g*2+g*d*2),n=new (65535<l?Uint32Array:Uint16Array)(l),q=new Float32Array(3*k),m=new Float32Array(3*k),p=new Float32Array(2*k),r=0,t=0,w=0,v=0,u=0;f("z","y","x",-1,-1,c,b,a,g,d,0);f("z",
"y","x",1,-1,c,b,-a,g,d,1);f("x","z","y",1,1,a,c,b,e,g,2);f("x","z","y",1,-1,a,c,-b,e,g,3);f("x","y","z",1,-1,a,b,c,e,d,4);f("x","y","z",-1,-1,a,b,-c,e,d,5);this.setIndex(new THREE.BufferAttribute(n,1));this.addAttribute("position",new THREE.BufferAttribute(q,3));this.addAttribute("normal",new THREE.BufferAttribute(m,3));this.addAttribute("uv",new THREE.BufferAttribute(p,2))};THREE.BoxBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);
THREE.BoxBufferGeometry.prototype.constructor=THREE.BoxBufferGeometry;THREE.CircleGeometry=function(a,b,c,e){THREE.Geometry.call(this);this.type="CircleGeometry";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:e};this.fromBufferGeometry(new THREE.CircleBufferGeometry(a,b,c,e))};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CircleGeometry.prototype.constructor=THREE.CircleGeometry;
THREE.CircleBufferGeometry=function(a,b,c,e){THREE.BufferGeometry.call(this);this.type="CircleBufferGeometry";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:e};a=a||50;b=void 0!==b?Math.max(3,b):8;c=void 0!==c?c:0;e=void 0!==e?e:2*Math.PI;var d=b+2,g=new Float32Array(3*d),f=new Float32Array(3*d),d=new Float32Array(2*d);f[2]=1;d[0]=.5;d[1]=.5;for(var h=0,k=3,l=2;h<=b;h++,k+=3,l+=2){var n=c+h/b*e;g[k]=a*Math.cos(n);g[k+1]=a*Math.sin(n);f[k+2]=1;d[l]=(g[k]/a+1)/2;d[l+1]=(g[k+1]/a+1)/2}c=
[];for(k=1;k<=b;k++)c.push(k,k+1,0);this.setIndex(new THREE.BufferAttribute(new Uint16Array(c),1));this.addAttribute("position",new THREE.BufferAttribute(g,3));this.addAttribute("normal",new THREE.BufferAttribute(f,3));this.addAttribute("uv",new THREE.BufferAttribute(d,2));this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a)};THREE.CircleBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.CircleBufferGeometry.prototype.constructor=THREE.CircleBufferGeometry;
THREE.CylinderBufferGeometry=function(a,b,c,e,d,g,f,h){function k(c){var d,g,k,m=new THREE.Vector2,n=new THREE.Vector3,q=0,z=!0===c?a:b,y=!0===c?1:-1;g=v;for(d=1;d<=e;d++)r.setXYZ(v,0,x*y,0),t.setXYZ(v,0,y,0),m.x=.5,m.y=.5,w.setXY(v,m.x,m.y),v++;k=v;for(d=0;d<=e;d++){var D=d/e*h+f,J=Math.cos(D),D=Math.sin(D);n.x=z*D;n.y=x*y;n.z=z*J;r.setXYZ(v,n.x,n.y,n.z);t.setXYZ(v,0,y,0);m.x=.5*J+.5;m.y=.5*D*y+.5;w.setXY(v,m.x,m.y);v++}for(d=0;d<e;d++)m=g+d,n=k+d,!0===c?(p.setX(u,n),u++,p.setX(u,n+1)):(p.setX(u,
n+1),u++,p.setX(u,n)),u++,p.setX(u,m),u++,q+=3;l.addGroup(A,q,!0===c?1:2);A+=q}THREE.BufferGeometry.call(this);this.type="CylinderBufferGeometry";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:e,heightSegments:d,openEnded:g,thetaStart:f,thetaLength:h};var l=this;a=void 0!==a?a:20;b=void 0!==b?b:20;c=void 0!==c?c:100;e=Math.floor(e)||8;d=Math.floor(d)||1;g=void 0!==g?g:!1;f=void 0!==f?f:0;h=void 0!==h?h:2*Math.PI;var n=0;!1===g&&(0<a&&n++,0<b&&n++);var q=function(){var a=(e+1)*
(d+1);!1===g&&(a+=(e+1)*n+e*n);return a}(),m=function(){var a=e*d*6;!1===g&&(a+=e*n*3);return a}(),p=new THREE.BufferAttribute(new (65535<m?Uint32Array:Uint16Array)(m),1),r=new THREE.BufferAttribute(new Float32Array(3*q),3),t=new THREE.BufferAttribute(new Float32Array(3*q),3),w=new THREE.BufferAttribute(new Float32Array(2*q),2),v=0,u=0,z=[],x=c/2,A=0;(function(){var g,k,m=new THREE.Vector3,n=new THREE.Vector3,q=0,K=(b-a)/c;for(k=0;k<=d;k++){var M=[],O=k/d,I=O*(b-a)+a;for(g=0;g<=e;g++){var D=g/e;n.x=
I*Math.sin(D*h+f);n.y=-O*c+x;n.z=I*Math.cos(D*h+f);r.setXYZ(v,n.x,n.y,n.z);m.copy(n);if(0===a&&0===k||0===b&&k===d)m.x=Math.sin(D*h+f),m.z=Math.cos(D*h+f);m.setY(Math.sqrt(m.x*m.x+m.z*m.z)*K).normalize();t.setXYZ(v,m.x,m.y,m.z);w.setXY(v,D,1-O);M.push(v);v++}z.push(M)}for(g=0;g<e;g++)for(k=0;k<d;k++)m=z[k+1][g],n=z[k+1][g+1],K=z[k][g+1],p.setX(u,z[k][g]),u++,p.setX(u,m),u++,p.setX(u,K),u++,p.setX(u,m),u++,p.setX(u,n),u++,p.setX(u,K),u++,q+=6;l.addGroup(A,q,0);A+=q})();!1===g&&(0<a&&k(!0),0<b&&k(!1));
this.setIndex(p);this.addAttribute("position",r);this.addAttribute("normal",t);this.addAttribute("uv",w)};THREE.CylinderBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.CylinderBufferGeometry.prototype.constructor=THREE.CylinderBufferGeometry;
THREE.CylinderGeometry=function(a,b,c,e,d,g,f,h){THREE.Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:e,heightSegments:d,openEnded:g,thetaStart:f,thetaLength:h};this.fromBufferGeometry(new THREE.CylinderBufferGeometry(a,b,c,e,d,g,f,h));this.mergeVertices()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry;
THREE.ConeBufferGeometry=function(a,b,c,e,d,g,f){THREE.CylinderBufferGeometry.call(this,0,a,b,c,e,d,g,f);this.type="ConeBufferGeometry";this.parameters={radius:a,height:b,radialSegments:c,heightSegments:e,thetaStart:g,thetaLength:f}};THREE.ConeBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.ConeBufferGeometry.prototype.constructor=THREE.ConeBufferGeometry;
THREE.ConeGeometry=function(a,b,c,e,d,g,f){THREE.CylinderGeometry.call(this,0,a,b,c,e,d,g,f);this.type="ConeGeometry";this.parameters={radius:a,height:b,radialSegments:c,heightSegments:e,openEnded:d,thetaStart:g,thetaLength:f}};THREE.ConeGeometry.prototype=Object.create(THREE.CylinderGeometry.prototype);THREE.ConeGeometry.prototype.constructor=THREE.ConeGeometry;
THREE.EdgesGeometry=function(a,b){function c(a,b){return a-b}THREE.BufferGeometry.call(this);var e=Math.cos(THREE.Math.DEG2RAD*(void 0!==b?b:1)),d=[0,0],g={},f=["a","b","c"],h;a instanceof THREE.BufferGeometry?(h=new THREE.Geometry,h.fromBufferGeometry(a)):h=a.clone();h.mergeVertices();h.computeFaceNormals();var k=h.vertices;h=h.faces;for(var l=0,n=h.length;l<n;l++)for(var q=h[l],m=0;3>m;m++){d[0]=q[f[m]];d[1]=q[f[(m+1)%3]];d.sort(c);var p=d.toString();void 0===g[p]?g[p]={vert1:d[0],vert2:d[1],face1:l,
face2:void 0}:g[p].face2=l}d=[];for(p in g)if(f=g[p],void 0===f.face2||h[f.face1].normal.dot(h[f.face2].normal)<=e)l=k[f.vert1],d.push(l.x),d.push(l.y),d.push(l.z),l=k[f.vert2],d.push(l.x),d.push(l.y),d.push(l.z);this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(d),3))};THREE.EdgesGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.EdgesGeometry.prototype.constructor=THREE.EdgesGeometry;
THREE.ExtrudeGeometry=function(a,b){"undefined"!==typeof a&&(THREE.Geometry.call(this),this.type="ExtrudeGeometry",a=Array.isArray(a)?a:[a],this.addShapeList(a,b),this.computeFaceNormals())};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry;THREE.ExtrudeGeometry.prototype.addShapeList=function(a,b){for(var c=a.length,e=0;e<c;e++)this.addShape(a[e],b)};
THREE.ExtrudeGeometry.prototype.addShape=function(a,b){function c(a,b,c){b||console.error("THREE.ExtrudeGeometry: vec does not exist");return b.clone().multiplyScalar(c).add(a)}function e(a,b,c){var d;d=a.x-b.x;var e=a.y-b.y,f=c.x-a.x,g=c.y-a.y,h=d*d+e*e;if(Math.abs(d*g-e*f)>Number.EPSILON){var k=Math.sqrt(h),m=Math.sqrt(f*f+g*g),h=b.x-e/k;b=b.y+d/k;f=((c.x-g/m-h)*g-(c.y+f/m-b)*f)/(d*g-e*f);c=h+d*f-a.x;a=b+e*f-a.y;d=c*c+a*a;if(2>=d)return new THREE.Vector2(c,a);d=Math.sqrt(d/2)}else a=!1,d>Number.EPSILON?
f>Number.EPSILON&&(a=!0):d<-Number.EPSILON?f<-Number.EPSILON&&(a=!0):Math.sign(e)===Math.sign(g)&&(a=!0),a?(c=-e,a=d,d=Math.sqrt(h)):(c=d,a=e,d=Math.sqrt(h/2));return new THREE.Vector2(c/d,a/d)}function d(a,b){var c,d;for(P=a.length;0<=--P;){c=P;d=P-1;0>d&&(d=a.length-1);var e,f=p+2*n;for(e=0;e<f;e++){var g=Q*e,h=Q*(e+1),k=b+c+g,g=b+d+g,m=b+d+h,h=b+c+h,k=k+H,g=g+H,m=m+H,h=h+H;F.faces.push(new THREE.Face3(k,g,h,null,null,1));F.faces.push(new THREE.Face3(g,m,h,null,null,1));k=v.generateSideWallUV(F,
k,g,m,h);F.faceVertexUvs[0].push([k[0],k[1],k[3]]);F.faceVertexUvs[0].push([k[1],k[2],k[3]])}}}function g(a,b,c){F.vertices.push(new THREE.Vector3(a,b,c))}function f(a,b,c){a+=H;b+=H;c+=H;F.faces.push(new THREE.Face3(a,b,c,null,null,0));a=v.generateTopUV(F,a,b,c);F.faceVertexUvs[0].push(a)}var h=void 0!==b.amount?b.amount:100,k=void 0!==b.bevelThickness?b.bevelThickness:6,l=void 0!==b.bevelSize?b.bevelSize:k-2,n=void 0!==b.bevelSegments?b.bevelSegments:3,q=void 0!==b.bevelEnabled?b.bevelEnabled:!0,
m=void 0!==b.curveSegments?b.curveSegments:12,p=void 0!==b.steps?b.steps:1,r=b.extrudePath,t,w=!1,v=void 0!==b.UVGenerator?b.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator,u,z,x,A;r&&(t=r.getSpacedPoints(p),w=!0,q=!1,u=void 0!==b.frames?b.frames:new THREE.TubeGeometry.FrenetFrames(r,p,!1),z=new THREE.Vector3,x=new THREE.Vector3,A=new THREE.Vector3);q||(l=k=n=0);var y,B,C,F=this,H=this.vertices.length,r=a.extractPoints(m),m=r.shape,K=r.holes;if(r=!THREE.ShapeUtils.isClockWise(m)){m=m.reverse();
B=0;for(C=K.length;B<C;B++)y=K[B],THREE.ShapeUtils.isClockWise(y)&&(K[B]=y.reverse());r=!1}var M=THREE.ShapeUtils.triangulateShape(m,K),O=m;B=0;for(C=K.length;B<C;B++)y=K[B],m=m.concat(y);var I,D,J,N,S,Q=m.length,R,G=M.length,r=[],P=0;J=O.length;I=J-1;for(D=P+1;P<J;P++,I++,D++)I===J&&(I=0),D===J&&(D=0),r[P]=e(O[P],O[I],O[D]);var T=[],V,Y=r.concat();B=0;for(C=K.length;B<C;B++){y=K[B];V=[];P=0;J=y.length;I=J-1;for(D=P+1;P<J;P++,I++,D++)I===J&&(I=0),D===J&&(D=0),V[P]=e(y[P],y[I],y[D]);T.push(V);Y=Y.concat(V)}for(I=
0;I<n;I++){J=I/n;N=k*(1-J);D=l*Math.sin(J*Math.PI/2);P=0;for(J=O.length;P<J;P++)S=c(O[P],r[P],D),g(S.x,S.y,-N);B=0;for(C=K.length;B<C;B++)for(y=K[B],V=T[B],P=0,J=y.length;P<J;P++)S=c(y[P],V[P],D),g(S.x,S.y,-N)}D=l;for(P=0;P<Q;P++)S=q?c(m[P],Y[P],D):m[P],w?(x.copy(u.normals[0]).multiplyScalar(S.x),z.copy(u.binormals[0]).multiplyScalar(S.y),A.copy(t[0]).add(x).add(z),g(A.x,A.y,A.z)):g(S.x,S.y,0);for(J=1;J<=p;J++)for(P=0;P<Q;P++)S=q?c(m[P],Y[P],D):m[P],w?(x.copy(u.normals[J]).multiplyScalar(S.x),z.copy(u.binormals[J]).multiplyScalar(S.y),
A.copy(t[J]).add(x).add(z),g(A.x,A.y,A.z)):g(S.x,S.y,h/p*J);for(I=n-1;0<=I;I--){J=I/n;N=k*(1-J);D=l*Math.sin(J*Math.PI/2);P=0;for(J=O.length;P<J;P++)S=c(O[P],r[P],D),g(S.x,S.y,h+N);B=0;for(C=K.length;B<C;B++)for(y=K[B],V=T[B],P=0,J=y.length;P<J;P++)S=c(y[P],V[P],D),w?g(S.x,S.y+t[p-1].y,t[p-1].x+N):g(S.x,S.y,h+N)}(function(){if(q){var a;a=0*Q;for(P=0;P<G;P++)R=M[P],f(R[2]+a,R[1]+a,R[0]+a);a=p+2*n;a*=Q;for(P=0;P<G;P++)R=M[P],f(R[0]+a,R[1]+a,R[2]+a)}else{for(P=0;P<G;P++)R=M[P],f(R[2],R[1],R[0]);for(P=
0;P<G;P++)R=M[P],f(R[0]+Q*p,R[1]+Q*p,R[2]+Q*p)}})();(function(){var a=0;d(O,a);a+=O.length;B=0;for(C=K.length;B<C;B++)y=K[B],d(y,a),a+=y.length})()};
THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(a,b,c,e){a=a.vertices;b=a[b];c=a[c];e=a[e];return[new THREE.Vector2(b.x,b.y),new THREE.Vector2(c.x,c.y),new THREE.Vector2(e.x,e.y)]},generateSideWallUV:function(a,b,c,e,d){a=a.vertices;b=a[b];c=a[c];e=a[e];d=a[d];return.01>Math.abs(b.y-c.y)?[new THREE.Vector2(b.x,1-b.z),new THREE.Vector2(c.x,1-c.z),new THREE.Vector2(e.x,1-e.z),new THREE.Vector2(d.x,1-d.z)]:[new THREE.Vector2(b.y,1-b.z),new THREE.Vector2(c.y,1-c.z),new THREE.Vector2(e.y,
1-e.z),new THREE.Vector2(d.y,1-d.z)]}};THREE.ShapeGeometry=function(a,b){THREE.Geometry.call(this);this.type="ShapeGeometry";!1===Array.isArray(a)&&(a=[a]);this.addShapeList(a,b);this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.constructor=THREE.ShapeGeometry;THREE.ShapeGeometry.prototype.addShapeList=function(a,b){for(var c=0,e=a.length;c<e;c++)this.addShape(a[c],b);return this};
THREE.ShapeGeometry.prototype.addShape=function(a,b){void 0===b&&(b={});var c=b.material,e=void 0===b.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:b.UVGenerator,d,g,f,h=this.vertices.length;d=a.extractPoints(void 0!==b.curveSegments?b.curveSegments:12);var k=d.shape,l=d.holes;if(!THREE.ShapeUtils.isClockWise(k))for(k=k.reverse(),d=0,g=l.length;d<g;d++)f=l[d],THREE.ShapeUtils.isClockWise(f)&&(l[d]=f.reverse());var n=THREE.ShapeUtils.triangulateShape(k,l);d=0;for(g=l.length;d<g;d++)f=l[d],k=k.concat(f);
l=k.length;g=n.length;for(d=0;d<l;d++)f=k[d],this.vertices.push(new THREE.Vector3(f.x,f.y,0));for(d=0;d<g;d++)l=n[d],k=l[0]+h,f=l[1]+h,l=l[2]+h,this.faces.push(new THREE.Face3(k,f,l,null,null,c)),this.faceVertexUvs[0].push(e.generateTopUV(this,k,f,l))};
THREE.LatheBufferGeometry=function(a,b,c,e){THREE.BufferGeometry.call(this);this.type="LatheBufferGeometry";this.parameters={points:a,segments:b,phiStart:c,phiLength:e};b=Math.floor(b)||12;c=c||0;e=e||2*Math.PI;e=THREE.Math.clamp(e,0,2*Math.PI);for(var d=(b+1)*a.length,g=b*a.length*6,f=new THREE.BufferAttribute(new (65535<g?Uint32Array:Uint16Array)(g),1),h=new THREE.BufferAttribute(new Float32Array(3*d),3),k=new THREE.BufferAttribute(new Float32Array(2*d),2),l=0,n=0,q=1/b,m=new THREE.Vector3,p=new THREE.Vector2,
d=0;d<=b;d++)for(var g=c+d*q*e,r=Math.sin(g),t=Math.cos(g),g=0;g<=a.length-1;g++)m.x=a[g].x*r,m.y=a[g].y,m.z=a[g].x*t,h.setXYZ(l,m.x,m.y,m.z),p.x=d/b,p.y=g/(a.length-1),k.setXY(l,p.x,p.y),l++;for(d=0;d<b;d++)for(g=0;g<a.length-1;g++)c=g+d*a.length,l=c+a.length,q=c+a.length+1,m=c+1,f.setX(n,c),n++,f.setX(n,l),n++,f.setX(n,m),n++,f.setX(n,l),n++,f.setX(n,q),n++,f.setX(n,m),n++;this.setIndex(f);this.addAttribute("position",h);this.addAttribute("uv",k);this.computeVertexNormals();if(e===2*Math.PI)for(e=
this.attributes.normal.array,f=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,c=b*a.length*3,g=d=0;d<a.length;d++,g+=3)f.x=e[g+0],f.y=e[g+1],f.z=e[g+2],h.x=e[c+g+0],h.y=e[c+g+1],h.z=e[c+g+2],k.addVectors(f,h).normalize(),e[g+0]=e[c+g+0]=k.x,e[g+1]=e[c+g+1]=k.y,e[g+2]=e[c+g+2]=k.z};THREE.LatheBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.LatheBufferGeometry.prototype.constructor=THREE.LatheBufferGeometry;
THREE.LatheGeometry=function(a,b,c,e){THREE.Geometry.call(this);this.type="LatheGeometry";this.parameters={points:a,segments:b,phiStart:c,phiLength:e};this.fromBufferGeometry(new THREE.LatheBufferGeometry(a,b,c,e));this.mergeVertices()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry;
THREE.PlaneGeometry=function(a,b,c,e){THREE.Geometry.call(this);this.type="PlaneGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:e};this.fromBufferGeometry(new THREE.PlaneBufferGeometry(a,b,c,e))};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry;
THREE.PlaneBufferGeometry=function(a,b,c,e){THREE.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:e};var d=a/2,g=b/2;c=Math.floor(c)||1;e=Math.floor(e)||1;var f=c+1,h=e+1,k=a/c,l=b/e;b=new Float32Array(f*h*3);a=new Float32Array(f*h*3);for(var n=new Float32Array(f*h*2),q=0,m=0,p=0;p<h;p++)for(var r=p*l-g,t=0;t<f;t++)b[q]=t*k-d,b[q+1]=-r,a[q+2]=1,n[m]=t/c,n[m+1]=1-p/e,q+=3,m+=2;q=0;d=new (65535<b.length/3?Uint32Array:Uint16Array)(c*
e*6);for(p=0;p<e;p++)for(t=0;t<c;t++)g=t+f*(p+1),h=t+1+f*(p+1),k=t+1+f*p,d[q]=t+f*p,d[q+1]=g,d[q+2]=k,d[q+3]=g,d[q+4]=h,d[q+5]=k,q+=6;this.setIndex(new THREE.BufferAttribute(d,1));this.addAttribute("position",new THREE.BufferAttribute(b,3));this.addAttribute("normal",new THREE.BufferAttribute(a,3));this.addAttribute("uv",new THREE.BufferAttribute(n,2))};THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry;
THREE.RingBufferGeometry=function(a,b,c,e,d,g){THREE.BufferGeometry.call(this);this.type="RingBufferGeometry";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:e,thetaStart:d,thetaLength:g};a=a||20;b=b||50;d=void 0!==d?d:0;g=void 0!==g?g:2*Math.PI;c=void 0!==c?Math.max(3,c):8;e=void 0!==e?Math.max(1,e):1;var f=(c+1)*(e+1),h=c*e*6,h=new THREE.BufferAttribute(new (65535<h?Uint32Array:Uint16Array)(h),1),k=new THREE.BufferAttribute(new Float32Array(3*f),3),l=new THREE.BufferAttribute(new Float32Array(3*
f),3),f=new THREE.BufferAttribute(new Float32Array(2*f),2),n=0,q=0,m,p=a,r=(b-a)/e,t=new THREE.Vector3,w=new THREE.Vector2,v;for(a=0;a<=e;a++){for(v=0;v<=c;v++)m=d+v/c*g,t.x=p*Math.cos(m),t.y=p*Math.sin(m),k.setXYZ(n,t.x,t.y,t.z),l.setXYZ(n,0,0,1),w.x=(t.x/b+1)/2,w.y=(t.y/b+1)/2,f.setXY(n,w.x,w.y),n++;p+=r}for(a=0;a<e;a++)for(b=a*(c+1),v=0;v<c;v++)d=m=v+b,g=m+c+1,n=m+c+2,m+=1,h.setX(q,d),q++,h.setX(q,g),q++,h.setX(q,n),q++,h.setX(q,d),q++,h.setX(q,n),q++,h.setX(q,m),q++;this.setIndex(h);this.addAttribute("position",
k);this.addAttribute("normal",l);this.addAttribute("uv",f)};THREE.RingBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.RingBufferGeometry.prototype.constructor=THREE.RingBufferGeometry;THREE.RingGeometry=function(a,b,c,e,d,g){THREE.Geometry.call(this);this.type="RingGeometry";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:e,thetaStart:d,thetaLength:g};this.fromBufferGeometry(new THREE.RingBufferGeometry(a,b,c,e,d,g))};
THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.RingGeometry.prototype.constructor=THREE.RingGeometry;THREE.SphereGeometry=function(a,b,c,e,d,g,f){THREE.Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:e,phiLength:d,thetaStart:g,thetaLength:f};this.fromBufferGeometry(new THREE.SphereBufferGeometry(a,b,c,e,d,g,f))};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry;
THREE.SphereBufferGeometry=function(a,b,c,e,d,g,f){THREE.BufferGeometry.call(this);this.type="SphereBufferGeometry";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:e,phiLength:d,thetaStart:g,thetaLength:f};a=a||50;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||6);e=void 0!==e?e:0;d=void 0!==d?d:2*Math.PI;g=void 0!==g?g:0;f=void 0!==f?f:Math.PI;for(var h=g+f,k=(b+1)*(c+1),l=new THREE.BufferAttribute(new Float32Array(3*k),3),n=new THREE.BufferAttribute(new Float32Array(3*
k),3),k=new THREE.BufferAttribute(new Float32Array(2*k),2),q=0,m=[],p=new THREE.Vector3,r=0;r<=c;r++){for(var t=[],w=r/c,v=0;v<=b;v++){var u=v/b,z=-a*Math.cos(e+u*d)*Math.sin(g+w*f),x=a*Math.cos(g+w*f),A=a*Math.sin(e+u*d)*Math.sin(g+w*f);p.set(z,x,A).normalize();l.setXYZ(q,z,x,A);n.setXYZ(q,p.x,p.y,p.z);k.setXY(q,u,1-w);t.push(q);q++}m.push(t)}e=[];for(r=0;r<c;r++)for(v=0;v<b;v++)d=m[r][v+1],f=m[r][v],q=m[r+1][v],p=m[r+1][v+1],(0!==r||0<g)&&e.push(d,f,p),(r!==c-1||h<Math.PI)&&e.push(f,q,p);this.setIndex(new (65535<
l.count?THREE.Uint32Attribute:THREE.Uint16Attribute)(e,1));this.addAttribute("position",l);this.addAttribute("normal",n);this.addAttribute("uv",k);this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a)};THREE.SphereBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.SphereBufferGeometry.prototype.constructor=THREE.SphereBufferGeometry;
THREE.TextGeometry=function(a,b){b=b||{};var c=b.font;if(!1===c instanceof THREE.Font)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new THREE.Geometry;c=c.generateShapes(a,b.size,b.curveSegments);b.amount=void 0!==b.height?b.height:50;void 0===b.bevelThickness&&(b.bevelThickness=10);void 0===b.bevelSize&&(b.bevelSize=8);void 0===b.bevelEnabled&&(b.bevelEnabled=!1);THREE.ExtrudeGeometry.call(this,c,b);this.type="TextGeometry"};
THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TextGeometry.prototype.constructor=THREE.TextGeometry;
THREE.TorusBufferGeometry=function(a,b,c,e,d){THREE.BufferGeometry.call(this);this.type="TorusBufferGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:e,arc:d};a=a||100;b=b||40;c=Math.floor(c)||8;e=Math.floor(e)||6;d=d||2*Math.PI;var g=(c+1)*(e+1),f=c*e*6,f=new (65535<f?Uint32Array:Uint16Array)(f),h=new Float32Array(3*g),k=new Float32Array(3*g),g=new Float32Array(2*g),l=0,n=0,q=0,m=new THREE.Vector3,p=new THREE.Vector3,r=new THREE.Vector3,t,w;for(t=0;t<=c;t++)for(w=0;w<=e;w++){var v=
w/e*d,u=t/c*Math.PI*2;p.x=(a+b*Math.cos(u))*Math.cos(v);p.y=(a+b*Math.cos(u))*Math.sin(v);p.z=b*Math.sin(u);h[l]=p.x;h[l+1]=p.y;h[l+2]=p.z;m.x=a*Math.cos(v);m.y=a*Math.sin(v);r.subVectors(p,m).normalize();k[l]=r.x;k[l+1]=r.y;k[l+2]=r.z;g[n]=w/e;g[n+1]=t/c;l+=3;n+=2}for(t=1;t<=c;t++)for(w=1;w<=e;w++)a=(e+1)*(t-1)+w-1,b=(e+1)*(t-1)+w,d=(e+1)*t+w,f[q]=(e+1)*t+w-1,f[q+1]=a,f[q+2]=d,f[q+3]=a,f[q+4]=b,f[q+5]=d,q+=6;this.setIndex(new THREE.BufferAttribute(f,1));this.addAttribute("position",new THREE.BufferAttribute(h,
3));this.addAttribute("normal",new THREE.BufferAttribute(k,3));this.addAttribute("uv",new THREE.BufferAttribute(g,2))};THREE.TorusBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.TorusBufferGeometry.prototype.constructor=THREE.TorusBufferGeometry;
THREE.TorusGeometry=function(a,b,c,e,d){THREE.Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:e,arc:d};this.fromBufferGeometry(new THREE.TorusBufferGeometry(a,b,c,e,d))};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry;
THREE.TorusKnotBufferGeometry=function(a,b,c,e,d,g){function f(a,b,c,d,e){var f=Math.cos(a),g=Math.sin(a);a*=c/b;b=Math.cos(a);e.x=d*(2+b)*.5*f;e.y=d*(2+b)*g*.5;e.z=d*Math.sin(a)*.5}THREE.BufferGeometry.call(this);this.type="TorusKnotBufferGeometry";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:e,p:d,q:g};a=a||100;b=b||40;c=Math.floor(c)||64;e=Math.floor(e)||8;d=d||2;g=g||3;var h=(e+1)*(c+1),k=e*c*6,k=new THREE.BufferAttribute(new (65535<k?Uint32Array:Uint16Array)(k),1),l=new THREE.BufferAttribute(new Float32Array(3*
h),3),n=new THREE.BufferAttribute(new Float32Array(3*h),3),h=new THREE.BufferAttribute(new Float32Array(2*h),2),q,m,p=0,r=0,t=new THREE.Vector3,w=new THREE.Vector3,v=new THREE.Vector2,u=new THREE.Vector3,z=new THREE.Vector3,x=new THREE.Vector3,A=new THREE.Vector3,y=new THREE.Vector3;for(q=0;q<=c;++q)for(m=q/c*d*Math.PI*2,f(m,d,g,a,u),f(m+.01,d,g,a,z),A.subVectors(z,u),y.addVectors(z,u),x.crossVectors(A,y),y.crossVectors(x,A),x.normalize(),y.normalize(),m=0;m<=e;++m){var B=m/e*Math.PI*2,C=-b*Math.cos(B),
B=b*Math.sin(B);t.x=u.x+(C*y.x+B*x.x);t.y=u.y+(C*y.y+B*x.y);t.z=u.z+(C*y.z+B*x.z);l.setXYZ(p,t.x,t.y,t.z);w.subVectors(t,u).normalize();n.setXYZ(p,w.x,w.y,w.z);v.x=q/c;v.y=m/e;h.setXY(p,v.x,v.y);p++}for(m=1;m<=c;m++)for(q=1;q<=e;q++)a=(e+1)*m+(q-1),b=(e+1)*m+q,d=(e+1)*(m-1)+q,k.setX(r,(e+1)*(m-1)+(q-1)),r++,k.setX(r,a),r++,k.setX(r,d),r++,k.setX(r,a),r++,k.setX(r,b),r++,k.setX(r,d),r++;this.setIndex(k);this.addAttribute("position",l);this.addAttribute("normal",n);this.addAttribute("uv",h)};
THREE.TorusKnotBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.TorusKnotBufferGeometry.prototype.constructor=THREE.TorusKnotBufferGeometry;
THREE.TorusKnotGeometry=function(a,b,c,e,d,g,f){THREE.Geometry.call(this);this.type="TorusKnotGeometry";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:e,p:d,q:g};void 0!==f&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.");this.fromBufferGeometry(new THREE.TorusKnotBufferGeometry(a,b,c,e,d,g));this.mergeVertices()};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry;
THREE.TubeGeometry=function(a,b,c,e,d,g){THREE.Geometry.call(this);this.type="TubeGeometry";this.parameters={path:a,segments:b,radius:c,radialSegments:e,closed:d,taper:g};b=b||64;c=c||1;e=e||8;d=d||!1;g=g||THREE.TubeGeometry.NoTaper;var f=[],h,k,l=b+1,n,q,m,p,r,t=new THREE.Vector3,w,v,u;w=new THREE.TubeGeometry.FrenetFrames(a,b,d);v=w.normals;u=w.binormals;this.tangents=w.tangents;this.normals=v;this.binormals=u;for(w=0;w<l;w++)for(f[w]=[],n=w/(l-1),r=a.getPointAt(n),h=v[w],k=u[w],m=c*g(n),n=0;n<
e;n++)q=n/e*2*Math.PI,p=-m*Math.cos(q),q=m*Math.sin(q),t.copy(r),t.x+=p*h.x+q*k.x,t.y+=p*h.y+q*k.y,t.z+=p*h.z+q*k.z,f[w][n]=this.vertices.push(new THREE.Vector3(t.x,t.y,t.z))-1;for(w=0;w<b;w++)for(n=0;n<e;n++)g=d?(w+1)%b:w+1,l=(n+1)%e,a=f[w][n],c=f[g][n],g=f[g][l],l=f[w][l],t=new THREE.Vector2(w/b,n/e),v=new THREE.Vector2((w+1)/b,n/e),u=new THREE.Vector2((w+1)/b,(n+1)/e),h=new THREE.Vector2(w/b,(n+1)/e),this.faces.push(new THREE.Face3(a,c,l)),this.faceVertexUvs[0].push([t,v,h]),this.faces.push(new THREE.Face3(c,
g,l)),this.faceVertexUvs[0].push([v.clone(),u,h.clone()]);this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry;THREE.TubeGeometry.NoTaper=function(a){return 1};THREE.TubeGeometry.SinusoidalTaper=function(a){return Math.sin(Math.PI*a)};
THREE.TubeGeometry.FrenetFrames=function(a,b,c){var e=new THREE.Vector3,d=[],g=[],f=[],h=new THREE.Vector3,k=new THREE.Matrix4;b+=1;var l,n,q;this.tangents=d;this.normals=g;this.binormals=f;for(l=0;l<b;l++)n=l/(b-1),d[l]=a.getTangentAt(n),d[l].normalize();g[0]=new THREE.Vector3;f[0]=new THREE.Vector3;a=Number.MAX_VALUE;l=Math.abs(d[0].x);n=Math.abs(d[0].y);q=Math.abs(d[0].z);l<=a&&(a=l,e.set(1,0,0));n<=a&&(a=n,e.set(0,1,0));q<=a&&e.set(0,0,1);h.crossVectors(d[0],e).normalize();g[0].crossVectors(d[0],
h);f[0].crossVectors(d[0],g[0]);for(l=1;l<b;l++)g[l]=g[l-1].clone(),f[l]=f[l-1].clone(),h.crossVectors(d[l-1],d[l]),h.length()>Number.EPSILON&&(h.normalize(),e=Math.acos(THREE.Math.clamp(d[l-1].dot(d[l]),-1,1)),g[l].applyMatrix4(k.makeRotationAxis(h,e))),f[l].crossVectors(d[l],g[l]);if(c)for(e=Math.acos(THREE.Math.clamp(g[0].dot(g[b-1]),-1,1)),e/=b-1,0<d[0].dot(h.crossVectors(g[0],g[b-1]))&&(e=-e),l=1;l<b;l++)g[l].applyMatrix4(k.makeRotationAxis(d[l],e*l)),f[l].crossVectors(d[l],g[l])};
THREE.PolyhedronGeometry=function(a,b,c,e){function d(a){var b=a.normalize().clone();b.index=k.vertices.push(b)-1;var c=Math.atan2(a.z,-a.x)/2/Math.PI+.5;a=Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5;b.uv=new THREE.Vector2(c,1-a);return b}function g(a,b,c){var d=new THREE.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);k.faces.push(d);w.copy(a).add(b).add(c).divideScalar(3);d=Math.atan2(w.z,-w.x);k.faceVertexUvs[0].push([h(a.uv,a,d),h(b.uv,b,d),h(c.uv,c,d)])}function f(a,
b){for(var c=Math.pow(2,b),e=d(k.vertices[a.a]),f=d(k.vertices[a.b]),h=d(k.vertices[a.c]),m=[],p=0;p<=c;p++){m[p]=[];for(var l=d(e.clone().lerp(h,p/c)),n=d(f.clone().lerp(h,p/c)),r=c-p,q=0;q<=r;q++)m[p][q]=0===q&&p===c?l:d(l.clone().lerp(n,q/r))}for(p=0;p<c;p++)for(q=0;q<2*(c-p)-1;q++)e=Math.floor(q/2),0===q%2?g(m[p][e+1],m[p+1][e],m[p][e]):g(m[p][e+1],m[p+1][e+1],m[p+1][e])}function h(a,b,c){0>c&&1===a.x&&(a=new THREE.Vector2(a.x-1,a.y));0===b.x&&0===b.z&&(a=new THREE.Vector2(c/2/Math.PI+.5,a.y));
return a.clone()}THREE.Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:a,indices:b,radius:c,detail:e};c=c||1;e=e||0;for(var k=this,l=0,n=a.length;l<n;l+=3)d(new THREE.Vector3(a[l],a[l+1],a[l+2]));a=this.vertices;for(var q=[],m=l=0,n=b.length;l<n;l+=3,m++){var p=a[b[l]],r=a[b[l+1]],t=a[b[l+2]];q[m]=new THREE.Face3(p.index,r.index,t.index,[p.clone(),r.clone(),t.clone()])}for(var w=new THREE.Vector3,l=0,n=q.length;l<n;l++)f(q[l],e);l=0;for(n=this.faceVertexUvs[0].length;l<
n;l++)b=this.faceVertexUvs[0][l],e=b[0].x,a=b[1].x,q=b[2].x,m=Math.max(e,a,q),p=Math.min(e,a,q),.9<m&&.1>p&&(.2>e&&(b[0].x+=1),.2>a&&(b[1].x+=1),.2>q&&(b[2].x+=1));l=0;for(n=this.vertices.length;l<n;l++)this.vertices[l].multiplyScalar(c);this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry;
THREE.DodecahedronGeometry=function(a,b){var c=(1+Math.sqrt(5))/2,e=1/c;THREE.PolyhedronGeometry.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-e,-c,0,-e,c,0,e,-c,0,e,c,-e,-c,0,-e,c,0,e,-c,0,e,c,0,-c,0,-e,c,0,-e,-c,0,e,c,0,e],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,
12,14,1,14,5,1,5,9],a,b);this.type="DodecahedronGeometry";this.parameters={radius:a,detail:b}};THREE.DodecahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.DodecahedronGeometry.prototype.constructor=THREE.DodecahedronGeometry;
THREE.IcosahedronGeometry=function(a,b){var c=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type="IcosahedronGeometry";this.parameters={radius:a,detail:b}};THREE.IcosahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);
THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry;THREE.OctahedronGeometry=function(a,b){THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,b);this.type="OctahedronGeometry";this.parameters={radius:a,detail:b}};THREE.OctahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry;
THREE.TetrahedronGeometry=function(a,b){THREE.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,b);this.type="TetrahedronGeometry";this.parameters={radius:a,detail:b}};THREE.TetrahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry;
THREE.ParametricGeometry=function(a,b,c){THREE.Geometry.call(this);this.type="ParametricGeometry";this.parameters={func:a,slices:b,stacks:c};var e=this.vertices,d=this.faces,g=this.faceVertexUvs[0],f,h,k,l,n=b+1;for(f=0;f<=c;f++)for(l=f/c,h=0;h<=b;h++)k=h/b,k=a(k,l),e.push(k);var q,m,p,r;for(f=0;f<c;f++)for(h=0;h<b;h++)a=f*n+h,e=f*n+h+1,l=(f+1)*n+h+1,k=(f+1)*n+h,q=new THREE.Vector2(h/b,f/c),m=new THREE.Vector2((h+1)/b,f/c),p=new THREE.Vector2((h+1)/b,(f+1)/c),r=new THREE.Vector2(h/b,(f+1)/c),d.push(new THREE.Face3(a,
e,k)),g.push([q,m,r]),d.push(new THREE.Face3(e,l,k)),g.push([m.clone(),p,r.clone()]);this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry;
THREE.WireframeGeometry=function(a){function b(a,b){return a-b}THREE.BufferGeometry.call(this);var c=[0,0],e={},d=["a","b","c"];if(a instanceof THREE.Geometry){var g=a.vertices,f=a.faces,h=0,k=new Uint32Array(6*f.length);a=0;for(var l=f.length;a<l;a++)for(var n=f[a],q=0;3>q;q++){c[0]=n[d[q]];c[1]=n[d[(q+1)%3]];c.sort(b);var m=c.toString();void 0===e[m]&&(k[2*h]=c[0],k[2*h+1]=c[1],e[m]=!0,h++)}c=new Float32Array(6*h);a=0;for(l=h;a<l;a++)for(q=0;2>q;q++)e=g[k[2*a+q]],h=6*a+3*q,c[h+0]=e.x,c[h+1]=e.y,
c[h+2]=e.z;this.addAttribute("position",new THREE.BufferAttribute(c,3))}else if(a instanceof THREE.BufferGeometry){if(null!==a.index){l=a.index.array;g=a.attributes.position;d=a.groups;h=0;0===d.length&&a.addGroup(0,l.length);k=new Uint32Array(2*l.length);f=0;for(n=d.length;f<n;++f){a=d[f];q=a.start;m=a.count;a=q;for(var p=q+m;a<p;a+=3)for(q=0;3>q;q++)c[0]=l[a+q],c[1]=l[a+(q+1)%3],c.sort(b),m=c.toString(),void 0===e[m]&&(k[2*h]=c[0],k[2*h+1]=c[1],e[m]=!0,h++)}c=new Float32Array(6*h);a=0;for(l=h;a<
l;a++)for(q=0;2>q;q++)h=6*a+3*q,e=k[2*a+q],c[h+0]=g.getX(e),c[h+1]=g.getY(e),c[h+2]=g.getZ(e)}else for(g=a.attributes.position.array,h=g.length/3,k=h/3,c=new Float32Array(6*h),a=0,l=k;a<l;a++)for(q=0;3>q;q++)h=18*a+6*q,k=9*a+3*q,c[h+0]=g[k],c[h+1]=g[k+1],c[h+2]=g[k+2],e=9*a+(q+1)%3*3,c[h+3]=g[e],c[h+4]=g[e+1],c[h+5]=g[e+2];this.addAttribute("position",new THREE.BufferAttribute(c,3))}};THREE.WireframeGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);
THREE.WireframeGeometry.prototype.constructor=THREE.WireframeGeometry;THREE.AxisHelper=function(a){a=a||1;var b=new Float32Array([0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a]),c=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.BufferAttribute(b,3));a.addAttribute("color",new THREE.BufferAttribute(c,3));b=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.LineSegments.call(this,a,b)};THREE.AxisHelper.prototype=Object.create(THREE.LineSegments.prototype);
THREE.AxisHelper.prototype.constructor=THREE.AxisHelper;
THREE.ArrowHelper=function(){var a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,1,0],3));var b=new THREE.CylinderBufferGeometry(0,.5,1,5,1);b.translate(0,-.5,0);return function(c,e,d,g,f,h){THREE.Object3D.call(this);void 0===g&&(g=16776960);void 0===d&&(d=1);void 0===f&&(f=.2*d);void 0===h&&(h=.2*f);this.position.copy(e);this.line=new THREE.Line(a,new THREE.LineBasicMaterial({color:g}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new THREE.Mesh(b,
new THREE.MeshBasicMaterial({color:g}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(c);this.setLength(d,f,h)}}();THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper;
THREE.ArrowHelper.prototype.setDirection=function(){var a=new THREE.Vector3,b;return function(c){.99999<c.y?this.quaternion.set(0,0,0,1):-.99999>c.y?this.quaternion.set(1,0,0,0):(a.set(c.z,0,-c.x).normalize(),b=Math.acos(c.y),this.quaternion.setFromAxisAngle(a,b))}}();THREE.ArrowHelper.prototype.setLength=function(a,b,c){void 0===b&&(b=.2*a);void 0===c&&(c=.2*b);this.line.scale.set(1,Math.max(0,a-b),1);this.line.updateMatrix();this.cone.scale.set(c,b,c);this.cone.position.y=a;this.cone.updateMatrix()};
THREE.ArrowHelper.prototype.setColor=function(a){this.line.material.color.copy(a);this.cone.material.color.copy(a)};THREE.BoxHelper=function(a,b){void 0===b&&(b=16776960);var c=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),e=new Float32Array(24),d=new THREE.BufferGeometry;d.setIndex(new THREE.BufferAttribute(c,1));d.addAttribute("position",new THREE.BufferAttribute(e,3));THREE.LineSegments.call(this,d,new THREE.LineBasicMaterial({color:b}));void 0!==a&&this.update(a)};
THREE.BoxHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.BoxHelper.prototype.constructor=THREE.BoxHelper;
THREE.BoxHelper.prototype.update=function(){var a=new THREE.Box3;return function(b){b instanceof THREE.Box3?a.copy(b):a.setFromObject(b);if(!a.isEmpty()){b=a.min;var c=a.max,e=this.geometry.attributes.position,d=e.array;d[0]=c.x;d[1]=c.y;d[2]=c.z;d[3]=b.x;d[4]=c.y;d[5]=c.z;d[6]=b.x;d[7]=b.y;d[8]=c.z;d[9]=c.x;d[10]=b.y;d[11]=c.z;d[12]=c.x;d[13]=c.y;d[14]=b.z;d[15]=b.x;d[16]=c.y;d[17]=b.z;d[18]=b.x;d[19]=b.y;d[20]=b.z;d[21]=c.x;d[22]=b.y;d[23]=b.z;e.needsUpdate=!0;this.geometry.computeBoundingSphere()}}}();
THREE.BoundingBoxHelper=function(a,b){var c=void 0!==b?b:8947848;this.object=a;this.box=new THREE.Box3;THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:c,wireframe:!0}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.constructor=THREE.BoundingBoxHelper;THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};
THREE.CameraHelper=function(a){function b(a,b,d){c(a,d);c(b,d)}function c(a,b){e.vertices.push(new THREE.Vector3);e.colors.push(new THREE.Color(b));void 0===g[a]&&(g[a]=[]);g[a].push(e.vertices.length-1)}var e=new THREE.Geometry,d=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),g={};b("n1","n2",16755200);b("n2","n4",16755200);b("n4","n3",16755200);b("n3","n1",16755200);b("f1","f2",16755200);b("f2","f4",16755200);b("f4","f3",16755200);b("f3","f1",16755200);b("n1","f1",16755200);
b("n2","f2",16755200);b("n3","f3",16755200);b("n4","f4",16755200);b("p","n1",16711680);b("p","n2",16711680);b("p","n3",16711680);b("p","n4",16711680);b("u1","u2",43775);b("u2","u3",43775);b("u3","u1",43775);b("c","t",16777215);b("p","c",3355443);b("cn1","cn2",3355443);b("cn3","cn4",3355443);b("cf1","cf2",3355443);b("cf3","cf4",3355443);THREE.LineSegments.call(this,e,d);this.camera=a;this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix();this.matrix=a.matrixWorld;this.matrixAutoUpdate=
!1;this.pointMap=g;this.update()};THREE.CameraHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.CameraHelper.prototype.constructor=THREE.CameraHelper;
THREE.CameraHelper.prototype.update=function(){function a(a,f,h,k){e.set(f,h,k).unproject(d);a=c[a];if(void 0!==a)for(f=0,h=a.length;f<h;f++)b.vertices[a[f]].copy(e)}var b,c,e=new THREE.Vector3,d=new THREE.Camera;return function(){b=this.geometry;c=this.pointMap;d.projectionMatrix.copy(this.camera.projectionMatrix);a("c",0,0,-1);a("t",0,0,1);a("n1",-1,-1,-1);a("n2",1,-1,-1);a("n3",-1,1,-1);a("n4",1,1,-1);a("f1",-1,-1,1);a("f2",1,-1,1);a("f3",-1,1,1);a("f4",1,1,1);a("u1",.7,1.1,-1);a("u2",-.7,1.1,
-1);a("u3",0,2,-1);a("cf1",-1,0,1);a("cf2",1,0,1);a("cf3",0,-1,1);a("cf4",0,1,1);a("cn1",-1,0,-1);a("cn2",1,0,-1);a("cn3",0,-1,-1);a("cn4",0,1,-1);b.verticesNeedUpdate=!0}}();
THREE.DirectionalLightHelper=function(a,b){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;void 0===b&&(b=1);var c=new THREE.BufferGeometry;c.addAttribute("position",new THREE.Float32Attribute([-b,b,0,b,b,0,b,-b,0,-b,-b,0,-b,b,0],3));var e=new THREE.LineBasicMaterial({fog:!1});this.add(new THREE.Line(c,e));c=new THREE.BufferGeometry;c.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,0,1],3));this.add(new THREE.Line(c,
e));this.update()};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.DirectionalLightHelper.prototype.constructor=THREE.DirectionalLightHelper;THREE.DirectionalLightHelper.prototype.dispose=function(){var a=this.children[0],b=this.children[1];a.geometry.dispose();a.material.dispose();b.geometry.dispose();b.material.dispose()};
THREE.DirectionalLightHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);c.subVectors(b,a);var e=this.children[0],d=this.children[1];e.lookAt(c);e.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);d.lookAt(c);d.scale.z=c.length()}}();
THREE.EdgesHelper=function(a,b,c){b=void 0!==b?b:16777215;THREE.LineSegments.call(this,new THREE.EdgesGeometry(a.geometry,c),new THREE.LineBasicMaterial({color:b}));this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1};THREE.EdgesHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.EdgesHelper.prototype.constructor=THREE.EdgesHelper;
THREE.FaceNormalsHelper=function(a,b,c,e){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16776960;e=void 0!==e?e:1;b=0;c=this.object.geometry;c instanceof THREE.Geometry?b=c.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");c=new THREE.BufferGeometry;b=new THREE.Float32Attribute(6*b,3);c.addAttribute("position",b);THREE.LineSegments.call(this,c,new THREE.LineBasicMaterial({color:a,linewidth:e}));this.matrixAutoUpdate=
!1;this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.FaceNormalsHelper.prototype.constructor=THREE.FaceNormalsHelper;
THREE.FaceNormalsHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(){this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);for(var e=this.object.matrixWorld,d=this.geometry.attributes.position,g=this.object.geometry,f=g.vertices,g=g.faces,h=0,k=0,l=g.length;k<l;k++){var n=g[k],q=n.normal;a.copy(f[n.a]).add(f[n.b]).add(f[n.c]).divideScalar(3).applyMatrix4(e);b.copy(q).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);
d.setXYZ(h,a.x,a.y,a.z);h+=1;d.setXYZ(h,b.x,b.y,b.z);h+=1}d.needsUpdate=!0;return this}}();
THREE.GridHelper=function(a,b,c,e){b=b||1;c=new THREE.Color(void 0!==c?c:4473924);e=new THREE.Color(void 0!==e?e:8947848);for(var d=b/2,g=2*a/b,f=[],h=[],k=0,l=0,n=-a;k<=b;k++,n+=g){f.push(-a,0,n,a,0,n);f.push(n,0,-a,n,0,a);var q=k===d?c:e;q.toArray(h,l);l+=3;q.toArray(h,l);l+=3;q.toArray(h,l);l+=3;q.toArray(h,l);l+=3}a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.Float32Attribute(f,3));a.addAttribute("color",new THREE.Float32Attribute(h,3));f=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});
THREE.LineSegments.call(this,a,f)};THREE.GridHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.GridHelper.prototype.constructor=THREE.GridHelper;THREE.GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};
THREE.HemisphereLightHelper=function(a,b){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.colors=[new THREE.Color,new THREE.Color];var c=new THREE.SphereGeometry(b,4,2);c.rotateX(-Math.PI/2);for(var e=0;8>e;e++)c.faces[e].color=this.colors[4>e?0:1];e=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(c,e);this.add(this.lightSphere);this.update()};
THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.constructor=THREE.HemisphereLightHelper;THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};
THREE.HemisphereLightHelper.prototype.update=function(){var a=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=!0}}();
THREE.PointLightHelper=function(a,b){this.light=a;this.light.updateMatrixWorld();var c=new THREE.SphereBufferGeometry(b,4,2),e=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});e.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,c,e);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.constructor=THREE.PointLightHelper;
THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};
THREE.SkeletonHelper=function(a){this.bones=this.getBoneList(a);for(var b=new THREE.Geometry,c=0;c<this.bones.length;c++)this.bones[c].parent instanceof THREE.Bone&&(b.vertices.push(new THREE.Vector3),b.vertices.push(new THREE.Vector3),b.colors.push(new THREE.Color(0,0,1)),b.colors.push(new THREE.Color(0,1,0)));b.dynamic=!0;c=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});THREE.LineSegments.call(this,b,c);this.root=a;this.matrix=a.matrixWorld;
this.matrixAutoUpdate=!1;this.update()};THREE.SkeletonHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.SkeletonHelper.prototype.constructor=THREE.SkeletonHelper;THREE.SkeletonHelper.prototype.getBoneList=function(a){var b=[];a instanceof THREE.Bone&&b.push(a);for(var c=0;c<a.children.length;c++)b.push.apply(b,this.getBoneList(a.children[c]));return b};
THREE.SkeletonHelper.prototype.update=function(){for(var a=this.geometry,b=(new THREE.Matrix4).getInverse(this.root.matrixWorld),c=new THREE.Matrix4,e=0,d=0;d<this.bones.length;d++){var g=this.bones[d];g.parent instanceof THREE.Bone&&(c.multiplyMatrices(b,g.matrixWorld),a.vertices[e].setFromMatrixPosition(c),c.multiplyMatrices(b,g.parent.matrixWorld),a.vertices[e+1].setFromMatrixPosition(c),e+=2)}a.verticesNeedUpdate=!0;a.computeBoundingSphere()};
THREE.SpotLightHelper=function(a){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;a=new THREE.BufferGeometry;for(var b=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],c=0,e=1;32>c;c++,e++){var d=c/32*Math.PI*2,g=e/32*Math.PI*2;b.push(Math.cos(d),Math.sin(d),1,Math.cos(g),Math.sin(g),1)}a.addAttribute("position",new THREE.Float32Attribute(b,3));b=new THREE.LineBasicMaterial({fog:!1});this.cone=new THREE.LineSegments(a,
b);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.SpotLightHelper.prototype.constructor=THREE.SpotLightHelper;THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};
THREE.SpotLightHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){var c=this.light.distance?this.light.distance:1E3,e=c*Math.tan(this.light.angle);this.cone.scale.set(e,e,c);a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(b.sub(a));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();
THREE.VertexNormalsHelper=function(a,b,c,e){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16711680;e=void 0!==e?e:1;b=0;c=this.object.geometry;c instanceof THREE.Geometry?b=3*c.faces.length:c instanceof THREE.BufferGeometry&&(b=c.attributes.normal.count);c=new THREE.BufferGeometry;b=new THREE.Float32Attribute(6*b,3);c.addAttribute("position",b);THREE.LineSegments.call(this,c,new THREE.LineBasicMaterial({color:a,linewidth:e}));this.matrixAutoUpdate=!1;this.update()};
THREE.VertexNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.VertexNormalsHelper.prototype.constructor=THREE.VertexNormalsHelper;
THREE.VertexNormalsHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(){var e=["a","b","c"];this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);var d=this.object.matrixWorld,g=this.geometry.attributes.position,f=this.object.geometry;if(f instanceof THREE.Geometry)for(var h=f.vertices,k=f.faces,l=f=0,n=k.length;l<n;l++)for(var q=k[l],m=0,p=q.vertexNormals.length;m<p;m++){var r=q.vertexNormals[m];a.copy(h[q[e[m]]]).applyMatrix4(d);
b.copy(r).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);g.setXYZ(f,a.x,a.y,a.z);f+=1;g.setXYZ(f,b.x,b.y,b.z);f+=1}else if(f instanceof THREE.BufferGeometry)for(e=f.attributes.position,h=f.attributes.normal,m=f=0,p=e.count;m<p;m++)a.set(e.getX(m),e.getY(m),e.getZ(m)).applyMatrix4(d),b.set(h.getX(m),h.getY(m),h.getZ(m)),b.applyMatrix3(c).normalize().multiplyScalar(this.size).add(a),g.setXYZ(f,a.x,a.y,a.z),f+=1,g.setXYZ(f,b.x,b.y,b.z),f+=1;g.needsUpdate=!0;return this}}();
THREE.WireframeHelper=function(a,b){var c=void 0!==b?b:16777215;THREE.LineSegments.call(this,new THREE.WireframeGeometry(a.geometry),new THREE.LineBasicMaterial({color:c}));this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1};THREE.WireframeHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.WireframeHelper.prototype.constructor=THREE.WireframeHelper;THREE.ImmediateRenderObject=function(a){THREE.Object3D.call(this);this.material=a;this.render=function(a){}};
THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject;THREE.MorphBlendMesh=function(a,b){THREE.Mesh.call(this,a,b);this.animationsMap={};this.animationsList=[];var c=this.geometry.morphTargets.length;this.createAnimation("__default",0,c-1,c/1);this.setAnimationWeight("__default",1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh;
THREE.MorphBlendMesh.prototype.createAnimation=function(a,b,c,e){b={start:b,end:c,length:c-b+1,fps:e,duration:(c-b)/e,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[a]=b;this.animationsList.push(b)};
THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(a){for(var b=/([a-z]+)_?(\d+)/i,c,e={},d=this.geometry,g=0,f=d.morphTargets.length;g<f;g++){var h=d.morphTargets[g].name.match(b);if(h&&1<h.length){var k=h[1];e[k]||(e[k]={start:Infinity,end:-Infinity});h=e[k];g<h.start&&(h.start=g);g>h.end&&(h.end=g);c||(c=k)}}for(k in e)h=e[k],this.createAnimation(k,h.start,h.end,a);this.firstAnimation=c};
THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){if(a=this.animationsMap[a])a.direction=1,a.directionBackwards=!1};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(a){if(a=this.animationsMap[a])a.direction=-1,a.directionBackwards=!0};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];c&&(c.fps=b,c.duration=(c.end-c.start)/c.fps)};
THREE.MorphBlendMesh.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];c&&(c.duration=b,c.fps=(c.end-c.start)/c.duration)};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];c&&(c.weight=b)};THREE.MorphBlendMesh.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];c&&(c.time=b)};THREE.MorphBlendMesh.prototype.getAnimationTime=function(a){var b=0;if(a=this.animationsMap[a])b=a.time;return b};
THREE.MorphBlendMesh.prototype.getAnimationDuration=function(a){var b=-1;if(a=this.animationsMap[a])b=a.duration;return b};THREE.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];b?(b.time=0,b.active=!0):console.warn("THREE.MorphBlendMesh: animation["+a+"] undefined in .playAnimation()")};THREE.MorphBlendMesh.prototype.stopAnimation=function(a){if(a=this.animationsMap[a])a.active=!1};
THREE.MorphBlendMesh.prototype.update=function(a){for(var b=0,c=this.animationsList.length;b<c;b++){var e=this.animationsList[b];if(e.active){var d=e.duration/e.length;e.time+=e.direction*a;if(e.mirroredLoop){if(e.time>e.duration||0>e.time)e.direction*=-1,e.time>e.duration&&(e.time=e.duration,e.directionBackwards=!0),0>e.time&&(e.time=0,e.directionBackwards=!1)}else e.time%=e.duration,0>e.time&&(e.time+=e.duration);var g=e.start+THREE.Math.clamp(Math.floor(e.time/d),0,e.length-1),f=e.weight;g!==e.currentFrame&&
(this.morphTargetInfluences[e.lastFrame]=0,this.morphTargetInfluences[e.currentFrame]=1*f,this.morphTargetInfluences[g]=0,e.lastFrame=e.currentFrame,e.currentFrame=g);d=e.time%d/d;e.directionBackwards&&(d=1-d);e.currentFrame!==e.lastFrame?(this.morphTargetInfluences[e.currentFrame]=d*f,this.morphTargetInfluences[e.lastFrame]=(1-d)*f):this.morphTargetInfluences[e.currentFrame]=f}}};
Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(a){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");a.id="webgl-error-message";a.style.fontFamily="monospace";a.style.fontSize="13px";a.style.fontWeight="normal";a.style.textAlign="center";a.style.background=
"#fff";a.style.color="#000";a.style.padding="1.5em";a.style.width="400px";a.style.margin="5em auto 0";this.webgl||(a.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return a},addGetWebGLMessage:function(a){var b,c;a=a||{};b=void 0!==a.parent?a.parent:document.body;a=void 0!==a.id?a.id:"oldie";c=Detector.getWebGLErrorMessage();c.id=a;b.appendChild(c)}};
function TimeSeries(a){a=a||{};a.resetBoundsInterval=a.resetBoundsInterval||3E3;a.resetBounds=void 0===a.resetBounds?!0:a.resetBounds;this.options=a;this.data=[];this.label=a.label||"";this.maxDataLength=a.maxDataLength||1E3;this.dataPool=[];this.minValue=this.maxValue=Number.NaN;a.resetBounds&&(this.boundsTimer=setInterval(function(a){return function(){a.resetBounds()}}(this),a.resetBoundsInterval))}
TimeSeries.prototype.resetBounds=function(){this.minValue=this.maxValue=Number.NaN;for(var a=0;a<this.data.length;a++)this.maxValue=isNaN(this.maxValue)?this.data[a][1]:Math.max(this.maxValue,this.data[a][1]),this.minValue=isNaN(this.minValue)?this.data[a][1]:Math.min(this.minValue,this.data[a][1])};
TimeSeries.prototype.append=function(a,b){this.lastTimeStamp=a;var c=this.dataPool.length?this.dataPool.pop():[a,b];c[0]=a;c[1]=b;this.data.push(c);this.maxValue=isNaN(this.maxValue)?b:Math.max(this.maxValue,b);for(this.minValue=isNaN(this.minValue)?b:Math.min(this.minValue,b);this.data.length>this.maxDataLength;)this.dataPool.push(this.data.shift())};
function SmoothieChart(a){a=a||{};a.grid=a.grid||{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:1,millisPerLine:1E3,verticalSections:2};a.millisPerPixel=a.millisPerPixel||20;a.fps=a.fps||50;a.maxValueScale=a.maxValueScale||1;a.minValue=a.minValue;a.maxValue=a.maxValue;a.labels=a.labels||{fillStyle:"#ffffff"};a.interpolation=a.interpolation||"bezier";a.scaleSmoothing=a.scaleSmoothing||.125;a.maxDataSetLength=a.maxDataSetLength||2;a.timestampFormatter=a.timestampFormatter||null;this.options=a;
this.seriesSet=[];this.currentValueRange=1;this.currentVisMinValue=0}SmoothieChart.prototype.addTimeSeries=function(a,b){this.seriesSet.push({timeSeries:a,options:b||{}})};SmoothieChart.prototype.removeTimeSeries=function(a){this.seriesSet.splice(this.seriesSet.indexOf(a),1)};SmoothieChart.prototype.streamTo=function(a,b){var c=this;this.render_on_tick=function(){c.render(a,c.seriesSet[0].timeSeries.lastTimeStamp)};this.start()};
SmoothieChart.prototype.start=function(){this.timer||(this.timer=setInterval(this.render_on_tick,1E3/this.options.fps))};SmoothieChart.prototype.stop=function(){this.timer&&(clearInterval(this.timer),this.timer=void 0)};SmoothieChart.timeFormatter=function(a){function b(a){return(10>a?"0":"")+a}return b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())};
SmoothieChart.prototype.render=function(a,b){var c=a.getContext("2d"),e=this.options,d=a.clientWidth,g=a.clientHeight;c.save();b-=b%e.millisPerPixel;c.translate(0,0);c.beginPath();c.rect(0,0,d,g);c.clip();c.save();c.fillStyle=e.grid.fillStyle;c.clearRect(0,0,d,g);c.fillRect(0,0,d,g);c.restore();c.save();c.lineWidth=e.grid.lineWidth||1;c.strokeStyle=e.grid.strokeStyle||"#ffffff";if(0<e.grid.millisPerLine)for(var f=b-b%e.grid.millisPerLine;f>=b-d*e.millisPerPixel;f-=e.grid.millisPerLine){c.beginPath();
var h=Math.round(d-(b-f)/e.millisPerPixel);c.moveTo(h,0);c.lineTo(h,g);c.stroke();if(e.timestampFormatter){var k=e.timestampFormatter(new Date(f)),l=c.measureText(k).width/2+c.measureText(u).width+4;h<d-l&&(c.fillStyle=e.labels.fillStyle,c.fillText(k,h-c.measureText(k).width/2,g-2))}c.closePath()}for(u=1;u<e.grid.verticalSections;u++)f=Math.round(u*g/e.grid.verticalSections),c.beginPath(),c.moveTo(0,f),c.lineTo(d,f),c.stroke(),c.closePath();c.beginPath();c.strokeRect(0,0,d,g);c.closePath();c.restore();
u=h=Number.NaN;for(k=0;k<this.seriesSet.length;k++){var n=this.seriesSet[k].timeSeries;isNaN(n.maxValue)||(h=isNaN(h)?n.maxValue:Math.max(h,n.maxValue));isNaN(n.minValue)||(u=isNaN(u)?n.minValue:Math.min(u,n.minValue))}if(!isNaN(h)||!isNaN(u)){h=null!=e.maxValue?e.maxValue:h*e.maxValueScale;null!=e.minValue&&(u=e.minValue);this.currentValueRange+=e.scaleSmoothing*(h-u-this.currentValueRange);this.currentVisMinValue+=e.scaleSmoothing*(u-this.currentVisMinValue);for(var l=this.currentValueRange,q=this.currentVisMinValue,
k=0;k<this.seriesSet.length;k++){c.save();for(var n=this.seriesSet[k].timeSeries,n=n.data,m=this.seriesSet[k].options;n.length>=e.maxDataSetLength&&n[1][0]<b-d*e.millisPerPixel;)n.splice(0,1);c.lineWidth=m.lineWidth||1;c.fillStyle=m.fillStyle;c.strokeStyle=m.strokeStyle||"#ffffff";c.beginPath();for(var p=0,r=0,t=0,f=0;f<n.length;f++){var w=Math.round(d-(b-n[f][0])/e.millisPerPixel),v=n[f][1]-q,v=Math.max(Math.min(g-(l?Math.round(v/l*g):0),g-1),1);if(0==f)p=w,c.moveTo(w,v);else switch(e.interpolation){case "line":c.lineTo(w,
v);break;default:c.bezierCurveTo(Math.round((r+w)/2),t,Math.round(r+w)/2,v,w,v)}r=w;t=v}0<n.length&&m.fillStyle&&(c.lineTo(d+m.lineWidth+1,t),c.lineTo(d+m.lineWidth+1,g+m.lineWidth+1),c.lineTo(p,g+m.lineWidth),c.fill());c.stroke();c.closePath();c.restore()}if(!e.labels.disabled){e.labelOffsetY||(e.labelOffsetY=0);c.fillStyle=e.labels.fillStyle;var f=parseFloat(h).toFixed(2),u=parseFloat(u).toFixed(2);c.fillText(f,d-c.measureText(f).width-2,10);c.fillText(u,d-c.measureText(u).width-2,g-2);for(f=0;f<
this.seriesSet.length;f++)n=this.seriesSet[f].timeSeries,d=n.label,c.fillStyle=n.options.fillStyle||"rgb(255,255,255)",d&&c.fillText(d,2,10*(f+1)+e.labelOffsetY)}}c.restore()};
var Stats=function(){var a,b,c=0,e=0,d=Date.now(),g=d,f=d,h=0,k=1E3,l=0,n,q,m,p=[[16,16,48],[0,255,255]],r=0,t=1E3,w=0,v,u,z,x=[[16,48,16],[0,255,0]];a=document.createElement("div");a.style.cursor="pointer";a.style.width="80px";a.style.opacity="0.9";a.style.zIndex="10001";a.addEventListener("mousedown",function(a){a.preventDefault();c=(c+1)%2;0==c?(n.style.display="block",v.style.display="none"):(n.style.display="none",v.style.display="block")},!1);n=document.createElement("div");n.style.textAlign=
"left";n.style.lineHeight="1.2em";n.style.backgroundColor="rgb("+Math.floor(p[0][0]/2)+","+Math.floor(p[0][1]/2)+","+Math.floor(p[0][2]/2)+")";n.style.padding="0 0 3px 3px";a.appendChild(n);q=document.createElement("div");q.style.fontFamily="Helvetica, Arial, sans-serif";q.style.fontSize="9px";q.style.color="rgb("+p[1][0]+","+p[1][1]+","+p[1][2]+")";q.style.fontWeight="bold";q.innerHTML="FPS";n.appendChild(q);m=document.createElement("div");m.style.position="relative";m.style.width="74px";m.style.height=
"30px";m.style.backgroundColor="rgb("+p[1][0]+","+p[1][1]+","+p[1][2]+")";for(n.appendChild(m);74>m.children.length;)b=document.createElement("span"),b.style.width="1px",b.style.height="30px",b.style.cssFloat="left",b.style.backgroundColor="rgb("+p[0][0]+","+p[0][1]+","+p[0][2]+")",m.appendChild(b);v=document.createElement("div");v.style.textAlign="left";v.style.lineHeight="1.2em";v.style.backgroundColor="rgb("+Math.floor(x[0][0]/2)+","+Math.floor(x[0][1]/2)+","+Math.floor(x[0][2]/2)+")";v.style.padding=
"0 0 3px 3px";v.style.display="none";a.appendChild(v);u=document.createElement("div");u.style.fontFamily="Helvetica, Arial, sans-serif";u.style.fontSize="9px";u.style.color="rgb("+x[1][0]+","+x[1][1]+","+x[1][2]+")";u.style.fontWeight="bold";u.innerHTML="MS";v.appendChild(u);z=document.createElement("div");z.style.position="relative";z.style.width="74px";z.style.height="30px";z.style.backgroundColor="rgb("+x[1][0]+","+x[1][1]+","+x[1][2]+")";for(v.appendChild(z);74>z.children.length;)b=document.createElement("span"),
b.style.width="1px",b.style.height=30*Math.random()+"px",b.style.cssFloat="left",b.style.backgroundColor="rgb("+x[0][0]+","+x[0][1]+","+x[0][2]+")",z.appendChild(b);return{domElement:a,update:function(){d=Date.now();r=d-g;t=Math.min(t,r);w=Math.max(w,r);u.textContent=r+" MS ("+t+"-"+w+")";var a=Math.min(30,30-r/200*30);z.appendChild(z.firstChild).style.height=a+"px";g=d;e++;d>f+1E3&&(h=Math.round(1E3*e/(d-f)),k=Math.min(k,h),l=Math.max(l,h),q.textContent=h+" FPS ("+k+"-"+l+")",a=Math.min(30,30-h/
100*30),m.appendChild(m.firstChild).style.height=a+"px",f=d,e=0)}}};
THREE.TrackballControls=function(a,b){function c(a){!1!==f.enabled&&(window.removeEventListener("keydown",c),n=l,l===h.NONE)&&(a.keyCode!==f.keys[h.ROTATE]||f.noRotate?a.keyCode!==f.keys[h.ZOOM]||f.noZoom?a.keyCode!==f.keys[h.PAN]||f.noPan||(l=h.PAN):l=h.ZOOM:l=h.ROTATE)}function e(a){!1!==f.enabled&&(a.preventDefault(),a.stopPropagation(),l!==h.ROTATE||f.noRotate?l!==h.ZOOM||f.noZoom?l!==h.PAN||f.noPan||z.copy(B(a.pageX,a.pageY)):t.copy(B(a.pageX,a.pageY)):p.copy(C(a.pageX,a.pageY)))}function d(a){!1!==
f.enabled&&(a.preventDefault(),a.stopPropagation(),l=h.NONE,document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",d),f.dispatchEvent(y))}function g(a){if(!1!==f.enabled){a.preventDefault();a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3);r.y+=.01*b;f.dispatchEvent(A);f.dispatchEvent(y)}}var f=this,h={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=a;this.domElement=void 0!==b?b:document;this.enabled=!0;this.screen=
{left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.staticMoving=this.noRoll=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3;var k=new THREE.Vector3,l=h.NONE,n=h.NONE,q=new THREE.Vector3,m=new THREE.Vector3,p=new THREE.Vector3,r=new THREE.Vector2,t=new THREE.Vector2,w=0,v=0,u=new THREE.Vector2,z=new THREE.Vector2;this.target0=this.target.clone();
this.position0=this.object.position.clone();this.up0=this.object.up.clone();var x={type:"change"},A={type:"start"},y={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),b=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-b.clientLeft;this.screen.top=a.top+window.pageYOffset-b.clientTop;
this.screen.width=a.width;this.screen.height=a.height}};this.handleEvent=function(a){if("function"==typeof this[a.type])this[a.type](a)};var B=function(){var a=new THREE.Vector2;return function(b,c){a.set((b-f.screen.left)/f.screen.width,(c-f.screen.top)/f.screen.height);return a}}(),C=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e){c.set((d-.5*f.screen.width-f.screen.left)/(.5*f.screen.width),(.5*f.screen.height+f.screen.top-e)/(.5*f.screen.height),
0);var g=c.length();f.noRoll?c.z=g<Math.SQRT1_2?Math.sqrt(1-g*g):.5/g:1<g?c.normalize():c.z=Math.sqrt(1-g*g);q.copy(f.object.position).sub(f.target);a.copy(f.object.up).setLength(c.y);a.add(b.copy(f.object.up).cross(q).setLength(c.x));a.add(q.setLength(c.z));return a}}();this.rotateCamera=function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(){var c=Math.acos(m.dot(p)/m.length()/p.length());c&&(a.crossVectors(m,p).normalize(),c*=f.rotateSpeed,b.setFromAxisAngle(a,-c),q.applyQuaternion(b),
f.object.up.applyQuaternion(b),p.applyQuaternion(b),f.staticMoving?m.copy(p):(b.setFromAxisAngle(a,c*(f.dynamicDampingFactor-1)),m.applyQuaternion(b)))}}();this.zoomCamera=function(){if(l===h.TOUCH_ZOOM_PAN){var a=w/v;w=v;q.multiplyScalar(a)}else a=1+(t.y-r.y)*f.zoomSpeed,1!==a&&0<a&&(q.multiplyScalar(a),f.staticMoving?r.copy(t):r.y+=(t.y-r.y)*this.dynamicDampingFactor)};this.panCamera=function(){var a=new THREE.Vector2,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.copy(z).sub(u);a.lengthSq()&&
(a.multiplyScalar(q.length()*f.panSpeed),c.copy(q).cross(f.object.up).setLength(a.x),c.add(b.copy(f.object.up).setLength(a.y)),f.object.position.add(c),f.target.add(c),f.staticMoving?u.copy(z):u.add(a.subVectors(z,u).multiplyScalar(f.dynamicDampingFactor)))}}();this.checkDistances=function(){f.noZoom&&f.noPan||(q.lengthSq()>f.maxDistance*f.maxDistance&&f.object.position.addVectors(f.target,q.setLength(f.maxDistance)),q.lengthSq()<f.minDistance*f.minDistance&&f.object.position.addVectors(f.target,
q.setLength(f.minDistance)))};this.update=function(){q.subVectors(f.object.position,f.target);f.noRotate||f.rotateCamera();f.noZoom||f.zoomCamera();f.noPan||f.panCamera();f.object.position.addVectors(f.target,q);f.checkDistances();f.object.lookAt(f.target);1E-6<k.distanceToSquared(f.object.position)&&(f.dispatchEvent(x),k.copy(f.object.position))};this.reset=function(){n=l=h.NONE;f.target.copy(f.target0);f.object.position.copy(f.position0);f.object.up.copy(f.up0);q.subVectors(f.object.position,f.target);
f.object.lookAt(f.target);f.dispatchEvent(x);k.copy(f.object.position)};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(a){!1!==f.enabled&&(a.preventDefault(),a.stopPropagation(),l===h.NONE&&(l=a.button),l!==h.ROTATE||f.noRotate?l!==h.ZOOM||f.noZoom?l!==h.PAN||f.noPan||(u.copy(B(a.pageX,a.pageY)),z.copy(u)):(r.copy(B(a.pageX,a.pageY)),t.copy(r)):(m.copy(C(a.pageX,a.pageY)),p.copy(m)),document.addEventListener("mousemove",
e,!1),document.addEventListener("mouseup",d,!1),f.dispatchEvent(A))},!1);this.domElement.addEventListener("mousewheel",g,!1);this.domElement.addEventListener("DOMMouseScroll",g,!1);this.domElement.addEventListener("touchstart",function(a){if(!1!==f.enabled){switch(a.touches.length){case 1:l=h.TOUCH_ROTATE;m.copy(C(a.touches[0].pageX,a.touches[0].pageY));p.copy(m);break;case 2:l=h.TOUCH_ZOOM_PAN;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;v=w=Math.sqrt(b*b+c*
c);u.copy(B((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));z.copy(u);break;default:l=h.NONE}f.dispatchEvent(A)}},!1);this.domElement.addEventListener("touchend",function(a){if(!1!==f.enabled){switch(a.touches.length){case 1:p.copy(C(a.touches[0].pageX,a.touches[0].pageY));m.copy(p);break;case 2:w=v=0,z.copy(B((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2)),u.copy(z)}l=h.NONE;f.dispatchEvent(y)}},!1);this.domElement.addEventListener("touchmove",
function(a){if(!1!==f.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:p.copy(C(a.touches[0].pageX,a.touches[0].pageY));break;case 2:var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;v=Math.sqrt(b*b+c*c);z.copy(B((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));break;default:l=h.NONE}},!1);window.addEventListener("keydown",c,!1);window.addEventListener("keyup",function(a){!1!==f.enabled&&(l=n,window.addEventListener("keydown",
c,!1))},!1);this.handleResize();this.update()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);var dat=dat||{};dat.gui=dat.gui||{};dat.utils=dat.utils||{};dat.controllers=dat.controllers||{};dat.dom=dat.dom||{};dat.color=dat.color||{};
dat.utils.css=function(){return{load:function(a,b){b=b||document;var c=b.createElement("link");c.type="text/css";c.rel="stylesheet";c.href=a;b.getElementsByTagName("head")[0].appendChild(c)},inject:function(a,b){b=b||document;var c=document.createElement("style");c.type="text/css";c.innerHTML=a;b.getElementsByTagName("head")[0].appendChild(c)}}}();
dat.utils.common=function(){var a=Array.prototype.forEach,b=Array.prototype.slice;return{BREAK:{},extend:function(a){this.each(b.call(arguments,1),function(b){for(var c in b)this.isUndefined(b[c])||(a[c]=b[c])},this);return a},defaults:function(a){this.each(b.call(arguments,1),function(b){for(var c in b)this.isUndefined(a[c])&&(a[c]=b[c])},this);return a},compose:function(){var a=b.call(arguments);return function(){for(var c=b.call(arguments),d=a.length-1;0<=d;d--)c=[a[d].apply(this,c)];return c[0]}},
each:function(b,e,d){if(a&&b.forEach===a)b.forEach(e,d);else if(b.length===b.length+0)for(var c=0,f=b.length;c<f&&!(c in b&&e.call(d,b[c],c)===this.BREAK);c++);else for(c in b)if(e.call(d,b[c],c)===this.BREAK)break},defer:function(a){setTimeout(a,0)},toArray:function(a){return a.toArray?a.toArray():b.call(a)},isUndefined:function(a){return void 0===a},isNull:function(a){return null===a},isNaN:function(a){return a!==a},isArray:Array.isArray||function(a){return a.constructor===Array},isObject:function(a){return a===
Object(a)},isNumber:function(a){return a===a+0},isString:function(a){return a===a+""},isBoolean:function(a){return!1===a||!0===a},isFunction:function(a){return"[object Function]"===Object.prototype.toString.call(a)}}}();
dat.controllers.Controller=function(a){var b=function(a,b){this.initialValue=a[b];this.domElement=document.createElement("div");this.object=a;this.property=b;this.__onFinishChange=this.__onChange=void 0};a.extend(b.prototype,{onChange:function(a){this.__onChange=a;return this},onFinishChange:function(a){this.__onFinishChange=a;return this},setValue:function(a){this.object[this.property]=a;this.__onChange&&this.__onChange.call(this,a);this.updateDisplay();return this},getValue:function(){return this.object[this.property]},
updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}});return b}(dat.utils.common);
dat.dom.dom=function(a){function b(b){if("0"===b||a.isUndefined(b))return 0;b=b.match(e);return a.isNull(b)?0:parseFloat(b[1])}var c={};a.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(b,d){a.each(b,function(a){c[a]=d})});var e=/(\d+(\.\d+)?)px/,d={makeSelectable:function(a,b){void 0!==a&&void 0!==a.style&&(a.onselectstart=b?function(){return!1}:function(){},a.style.MozUserSelect=b?"auto":"none",a.style.KhtmlUserSelect=
b?"auto":"none",a.unselectable=b?"on":"off")},makeFullscreen:function(b,c,d){a.isUndefined(c)&&(c=!0);a.isUndefined(d)&&(d=!0);b.style.position="absolute";c&&(b.style.left=0,b.style.right=0);d&&(b.style.top=0,b.style.bottom=0)},fakeEvent:function(b,d,e,k){e=e||{};var f=c[d];if(!f)throw Error("Event type "+d+" not supported.");var g=document.createEvent(f);switch(f){case "MouseEvents":g.initMouseEvent(d,e.bubbles||!1,e.cancelable||!0,window,e.clickCount||1,0,0,e.x||e.clientX||0,e.y||e.clientY||0,!1,
!1,!1,!1,0,null);break;case "KeyboardEvents":f=g.initKeyboardEvent||g.initKeyEvent;a.defaults(e,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0});f(d,e.bubbles||!1,e.cancelable,window,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.keyCode,e.charCode);break;default:g.initEvent(d,e.bubbles||!1,e.cancelable||!0)}a.defaults(g,k);b.dispatchEvent(g)},bind:function(a,b,c,e){a.addEventListener?a.addEventListener(b,c,e||!1):a.attachEvent&&a.attachEvent("on"+b,c);return d},
unbind:function(a,b,c,e){a.removeEventListener?a.removeEventListener(b,c,e||!1):a.detachEvent&&a.detachEvent("on"+b,c);return d},addClass:function(a,b){if(void 0===a.className)a.className=b;else if(a.className!==b){var c=a.className.split(/ +/);-1==c.indexOf(b)&&(c.push(b),a.className=c.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return d},removeClass:function(a,b){if(b){if(void 0!==a.className)if(a.className===b)a.removeAttribute("class");else{var c=a.className.split(/ +/),e=c.indexOf(b);-1!=
e&&(c.splice(e,1),a.className=c.join(" "))}}else a.className=void 0;return d},hasClass:function(a,b){return(new RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)")).test(a.className)||!1},getWidth:function(a){a=getComputedStyle(a);return b(a["border-left-width"])+b(a["border-right-width"])+b(a["padding-left"])+b(a["padding-right"])+b(a.width)},getHeight:function(a){a=getComputedStyle(a);return b(a["border-top-width"])+b(a["border-bottom-width"])+b(a["padding-top"])+b(a["padding-bottom"])+b(a.height)},getOffset:function(a){var b=
{left:0,top:0};if(a.offsetParent){do b.left+=a.offsetLeft,b.top+=a.offsetTop;while(a=a.offsetParent)}return b},isActive:function(a){return a===document.activeElement&&(a.type||a.href)}};return d}(dat.utils.common);
dat.controllers.OptionController=function(a,b,c){var e=function(a,g,f){e.superclass.call(this,a,g);var d=this;this.__select=document.createElement("select");if(c.isArray(f)){var k={};c.each(f,function(a){k[a]=a});f=k}c.each(f,function(a,b){var c=document.createElement("option");c.innerHTML=b;c.setAttribute("value",a);d.__select.appendChild(c)});this.updateDisplay();b.bind(this.__select,"change",function(){d.setValue(this.options[this.selectedIndex].value)});this.domElement.appendChild(this.__select)};
e.superclass=a;c.extend(e.prototype,a.prototype,{setValue:function(a){a=e.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());return a},updateDisplay:function(){this.__select.value=this.getValue();return e.superclass.prototype.updateDisplay.call(this)}});return e}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.NumberController=function(a,b){var c=function(a,d,g){c.superclass.call(this,a,d);g=g||{};this.__min=g.min;this.__max=g.max;this.__step=g.step;b.isUndefined(this.__step)?this.__impliedStep=0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__impliedStep=this.__step;a=this.__impliedStep;a=a.toString();a=-1<a.indexOf(".")?a.length-a.indexOf(".")-1:0;this.__precision=a};c.superclass=a;b.extend(c.prototype,a.prototype,{setValue:function(a){void 0!==
this.__min&&a<this.__min?a=this.__min:void 0!==this.__max&&a>this.__max&&(a=this.__max);void 0!==this.__step&&0!=a%this.__step&&(a=Math.round(a/this.__step)*this.__step);return c.superclass.prototype.setValue.call(this,a)},min:function(a){this.__min=a;return this},max:function(a){this.__max=a;return this},step:function(a){this.__step=a;return this}});return c}(dat.controllers.Controller,dat.utils.common);
dat.controllers.NumberControllerBox=function(a,b,c){var e=function(a,g,f){function d(){var a=parseFloat(n.__input.value);c.isNaN(a)||n.setValue(a)}function k(a){var b=q-a.clientY;n.setValue(n.getValue()+b*n.__impliedStep);q=a.clientY}function l(){b.unbind(window,"mousemove",k);b.unbind(window,"mouseup",l)}this.__truncationSuspended=!1;e.superclass.call(this,a,g,f);var n=this,q;this.__input=document.createElement("input");this.__input.setAttribute("type","text");b.bind(this.__input,"change",d);b.bind(this.__input,
"blur",function(){d();n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())});b.bind(this.__input,"mousedown",function(a){b.bind(window,"mousemove",k);b.bind(window,"mouseup",l);q=a.clientY});b.bind(this.__input,"keydown",function(a){13===a.keyCode&&(n.__truncationSuspended=!0,this.blur(),n.__truncationSuspended=!1)});this.updateDisplay();this.domElement.appendChild(this.__input)};e.superclass=a;c.extend(e.prototype,a.prototype,{updateDisplay:function(){var a=this.__input,b;if(this.__truncationSuspended)b=
this.getValue();else{b=this.getValue();var c=Math.pow(10,this.__precision);b=Math.round(b*c)/c}a.value=b;return e.superclass.prototype.updateDisplay.call(this)}});return e}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common);
dat.controllers.NumberControllerSlider=function(a,b,c,e,d){function g(a,b,c,d,e){return d+(a-b)/(c-b)*(e-d)}var f=function(a,c,d,e,q){function h(a){a.preventDefault();var c=b.getOffset(l.__background),d=b.getWidth(l.__background);l.setValue(g(a.clientX,c.left,c.left+d,l.__min,l.__max));return!1}function k(){b.unbind(window,"mousemove",h);b.unbind(window,"mouseup",k);l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}f.superclass.call(this,a,c,{min:d,max:e,step:q});var l=this;this.__background=
document.createElement("div");this.__foreground=document.createElement("div");b.bind(this.__background,"mousedown",function(a){b.bind(window,"mousemove",h);b.bind(window,"mouseup",k);h(a)});b.addClass(this.__background,"slider");b.addClass(this.__foreground,"slider-fg");this.updateDisplay();this.__background.appendChild(this.__foreground);this.domElement.appendChild(this.__background)};f.superclass=a;f.useDefaultStyles=function(){c.inject(d)};e.extend(f.prototype,a.prototype,{updateDisplay:function(){var a=
(this.getValue()-this.__min)/(this.__max-this.__min);this.__foreground.style.width=100*a+"%";return f.superclass.prototype.updateDisplay.call(this)}});return f}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");
dat.controllers.FunctionController=function(a,b,c){var e=function(a,c,f){e.superclass.call(this,a,c);var d=this;this.__button=document.createElement("div");this.__button.innerHTML=void 0===f?"Fire":f;b.bind(this.__button,"click",function(a){a.preventDefault();d.fire();return!1});b.addClass(this.__button,"button");this.domElement.appendChild(this.__button)};e.superclass=a;c.extend(e.prototype,a.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this);this.__onFinishChange&&this.__onFinishChange.call(this,
this.getValue());this.getValue().call(this.object)}});return e}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.BooleanController=function(a,b,c){var e=function(a,c){e.superclass.call(this,a,c);var d=this;this.__prev=this.getValue();this.__checkbox=document.createElement("input");this.__checkbox.setAttribute("type","checkbox");b.bind(this.__checkbox,"change",function(){d.setValue(!d.__prev)},!1);this.domElement.appendChild(this.__checkbox);this.updateDisplay()};e.superclass=a;c.extend(e.prototype,a.prototype,{setValue:function(a){a=e.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&
this.__onFinishChange.call(this,this.getValue());this.__prev=this.getValue();return a},updateDisplay:function(){!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1;return e.superclass.prototype.updateDisplay.call(this)}});return e}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.color.toString=function(a){return function(b){if(1==b.a||a.isUndefined(b.a)){for(b=b.hex.toString(16);6>b.length;)b="0"+b;return"#"+b}return"rgba("+Math.round(b.r)+","+Math.round(b.g)+","+Math.round(b.b)+","+b.a+")"}}(dat.utils.common);
dat.color.interpret=function(a,b){var c,e,d=[{litmus:b.isString,conversions:{THREE_CHAR_HEX:{read:function(a){a=a.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString()+a[1].toString()+a[2].toString()+a[2].toString()+a[3].toString()+a[3].toString())}},write:a},SIX_CHAR_HEX:{read:function(a){a=a.match(/^#([A-F0-9]{6})$/i);return null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString())}},write:a},CSS_RGB:{read:function(a){a=a.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);
return null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3])}},write:a},CSS_RGBA:{read:function(a){a=a.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3]),a:parseFloat(a[4])}},write:a}}},{litmus:b.isNumber,conversions:{HEX:{read:function(a){return{space:"HEX",hex:a,conversionName:"HEX"}},write:function(a){return a.hex}}}},{litmus:b.isArray,conversions:{RGB_ARRAY:{read:function(a){return 3!=
a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2]}},write:function(a){return[a.r,a.g,a.b]}},RGBA_ARRAY:{read:function(a){return 4!=a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2],a:a[3]}},write:function(a){return[a.r,a.g,a.b,a.a]}}}},{litmus:b.isObject,conversions:{RGBA_OBJ:{read:function(a){return b.isNumber(a.r)&&b.isNumber(a.g)&&b.isNumber(a.b)&&b.isNumber(a.a)?{space:"RGB",r:a.r,g:a.g,b:a.b,a:a.a}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b,a:a.a}}},RGB_OBJ:{read:function(a){return b.isNumber(a.r)&&
b.isNumber(a.g)&&b.isNumber(a.b)?{space:"RGB",r:a.r,g:a.g,b:a.b}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b}}},HSVA_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)&&b.isNumber(a.a)?{space:"HSV",h:a.h,s:a.s,v:a.v,a:a.a}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v,a:a.a}}},HSV_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)?{space:"HSV",h:a.h,s:a.s,v:a.v}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v}}}}}];return function(){e=!1;
var a=1<arguments.length?b.toArray(arguments):arguments[0];b.each(d,function(d){if(d.litmus(a))return b.each(d.conversions,function(d,f){c=d.read(a);if(!1===e&&!1!==c)return e=c,c.conversionName=f,c.conversion=d,b.BREAK}),b.BREAK});return e}}(dat.color.toString,dat.utils.common);
dat.GUI=dat.gui.GUI=function(a,b,c,e,d,g,f,h,k,l,n,q,m,p,r){function t(a,b,c,f){if(void 0===b[c])throw Error("Object "+b+' has no property "'+c+'"');f.color?b=new n(b,c):(b=[b,c].concat(f.factoryArgs),b=e.apply(a,b));f.before instanceof d&&(f.before=f.before.__li);u(a,b);p.addClass(b.domElement,"c");c=document.createElement("span");p.addClass(c,"property-name");c.innerHTML=b.property;var g=document.createElement("div");g.appendChild(c);g.appendChild(b.domElement);f=w(a,g,f.before);p.addClass(f,J.CLASS_CONTROLLER_ROW);
p.addClass(f,typeof b.getValue());v(a,f,b);a.__controllers.push(b);return b}function w(a,b,c){var d=document.createElement("li");b&&d.appendChild(b);c?a.__ul.insertBefore(d,params.before):a.__ul.appendChild(d);a.onResize();return d}function v(a,b,c){c.__li=b;c.__gui=a;r.extend(c,{options:function(b){if(1<arguments.length)return c.remove(),t(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[r.toArray(arguments)]});if(r.isArray(b)||r.isObject(b))return c.remove(),t(a,c.object,c.property,
{before:c.__li.nextElementSibling,factoryArgs:[b]})},name:function(a){c.__li.firstElementChild.firstElementChild.innerHTML=a;return c},listen:function(){c.__gui.listen(c);return c},remove:function(){c.__gui.remove(c);return c}});if(c instanceof k){var d=new h(c.object,c.property,{min:c.__min,max:c.__max,step:c.__step});r.each(["updateDisplay","onChange","onFinishChange"],function(a){var b=c[a],e=d[a];c[a]=d[a]=function(){var a=Array.prototype.slice.call(arguments);b.apply(c,a);return e.apply(d,a)}});
p.addClass(b,"has-slider");c.domElement.insertBefore(d.domElement,c.domElement.firstElementChild)}else if(c instanceof h){var e=function(b){return r.isNumber(c.__min)&&r.isNumber(c.__max)?(c.remove(),t(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[c.__min,c.__max,c.__step]})):b};c.min=r.compose(e,c.min);c.max=r.compose(e,c.max)}else c instanceof g?(p.bind(b,"click",function(){p.fakeEvent(c.__checkbox,"click")}),p.bind(c.__checkbox,"click",function(a){a.stopPropagation()})):
c instanceof f?(p.bind(b,"click",function(){p.fakeEvent(c.__button,"click")}),p.bind(b,"mouseover",function(){p.addClass(c.__button,"hover")}),p.bind(b,"mouseout",function(){p.removeClass(c.__button,"hover")})):c instanceof n&&(p.addClass(b,"color"),c.updateDisplay=r.compose(function(a){b.style.borderLeftColor=c.__color.toString();return a},c.updateDisplay),c.updateDisplay());c.setValue=r.compose(function(b){a.getRoot().__preset_select&&c.isModified()&&C(a.getRoot(),!0);return b},c.setValue)}function u(a,
b){var c=a.getRoot(),d=c.__rememberedObjects.indexOf(b.object);if(-1!=d){var e=c.__rememberedObjectIndecesToControllers[d];void 0===e&&(e={},c.__rememberedObjectIndecesToControllers[d]=e);e[b.property]=b;if(c.load&&c.load.remembered){c=c.load.remembered;if(c[a.preset])c=c[a.preset];else if(c.Default)c=c.Default;else return;c[d]&&void 0!==c[d][b.property]&&(d=c[d][b.property],b.initialValue=d,b.setValue(d))}}}function z(a){var b=a.__save_row=document.createElement("li");p.addClass(a.domElement,"has-save");
a.__ul.insertBefore(b,a.__ul.firstChild);p.addClass(b,"save-row");var c=document.createElement("span");c.innerHTML="&nbsp;";p.addClass(c,"button gears");var d=document.createElement("span");d.innerHTML="Save";p.addClass(d,"button");p.addClass(d,"save");var e=document.createElement("span");e.innerHTML="New";p.addClass(e,"button");p.addClass(e,"save-as");var f=document.createElement("span");f.innerHTML="Revert";p.addClass(f,"button");p.addClass(f,"revert");var g=a.__preset_select=document.createElement("select");
a.load&&a.load.remembered?r.each(a.load.remembered,function(b,c){B(a,c,c==a.preset)}):B(a,"Default",!1);p.bind(g,"change",function(){for(var b=0;b<a.__preset_select.length;b++)a.__preset_select[b].innerHTML=a.__preset_select[b].value;a.preset=this.value});b.appendChild(g);b.appendChild(c);b.appendChild(d);b.appendChild(e);b.appendChild(f);if(H){var h=function(){k.style.display=a.useLocalStorage?"block":"none"},b=document.getElementById("dg-save-locally"),k=document.getElementById("dg-local-explain");
b.style.display="block";b=document.getElementById("dg-local-storage");"true"===localStorage.getItem(document.location.href+".isLocal")&&b.setAttribute("checked","checked");h();p.bind(b,"change",function(){a.useLocalStorage=!a.useLocalStorage;h()})}var m=document.getElementById("dg-new-constructor");p.bind(m,"keydown",function(a){!a.metaKey||67!==a.which&&67!=a.keyCode||K.hide()});p.bind(c,"click",function(){m.innerHTML=JSON.stringify(a.getSaveObject(),void 0,2);K.show();m.focus();m.select()});p.bind(d,
"click",function(){a.save()});p.bind(e,"click",function(){var b=prompt("Enter a new preset name.");b&&a.saveAs(b)});p.bind(f,"click",function(){a.revert()})}function x(a){function b(b){b.preventDefault();e=b.clientX;p.addClass(a.__closeButton,J.CLASS_DRAG);p.bind(window,"mousemove",c);p.bind(window,"mouseup",d);return!1}function c(b){b.preventDefault();a.width+=e-b.clientX;a.onResize();e=b.clientX;return!1}function d(){p.removeClass(a.__closeButton,J.CLASS_DRAG);p.unbind(window,"mousemove",c);p.unbind(window,
"mouseup",d)}a.__resize_handle=document.createElement("div");r.extend(a.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var e;p.bind(a.__resize_handle,"mousedown",b);p.bind(a.__closeButton,"mousedown",b);a.domElement.insertBefore(a.__resize_handle,a.domElement.firstElementChild)}function A(a,b){a.domElement.style.width=b+"px";a.__save_row&&a.autoPlace&&(a.__save_row.style.width=b+"px");a.__closeButton&&(a.__closeButton.style.width=b+"px")}
function y(a,b){var c={};r.each(a.__rememberedObjects,function(d,e){var f={};r.each(a.__rememberedObjectIndecesToControllers[e],function(a,c){f[c]=b?a.initialValue:a.getValue()});c[e]=f});return c}function B(a,b,c){var d=document.createElement("option");d.innerHTML=b;d.value=b;a.__preset_select.appendChild(d);c&&(a.__preset_select.selectedIndex=a.__preset_select.length-1)}function C(a,b){var c=a.__preset_select[a.__preset_select.selectedIndex];c.innerHTML=b?c.value+"*":c.value}function F(a){0!=a.length&&
q(function(){F(a)});r.each(a,function(a){a.updateDisplay()})}a.inject(c);var H;try{H="localStorage"in window&&null!==window.localStorage}catch(N){H=!1}var K,M=!0,O,I=!1,D=[],J=function(a){function b(){localStorage.setItem(document.location.href+".gui",JSON.stringify(d.getSaveObject()))}function c(){var a=d.getRoot();a.width+=1;r.defer(function(){--a.width})}var d=this;this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);p.addClass(this.domElement,
"dg");this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];a=a||{};a=r.defaults(a,{autoPlace:!0,width:J.DEFAULT_WIDTH});a=r.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace});r.isUndefined(a.load)?a.load={preset:"Default"}:a.preset&&(a.load.preset=a.preset);r.isUndefined(a.parent)&&a.hideable&&D.push(this);a.resizable=r.isUndefined(a.parent)&&a.resizable;a.autoPlace&&r.isUndefined(a.scrollable)&&(a.scrollable=
!0);var e=H&&"true"===localStorage.getItem(document.location.href+".isLocal");Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},preset:{get:function(){return d.parent?d.getRoot().preset:a.load.preset},set:function(b){d.parent?d.getRoot().preset=b:a.load.preset=b;for(b=0;b<this.__preset_select.length;b++)this.__preset_select[b].value==this.preset&&(this.__preset_select.selectedIndex=
b);d.revert()}},width:{get:function(){return a.width},set:function(b){a.width=b;A(d,b)}},name:{get:function(){return a.name},set:function(b){a.name=b;g&&(g.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(b){a.closed=b;a.closed?p.addClass(d.__ul,J.CLASS_CLOSED):p.removeClass(d.__ul,J.CLASS_CLOSED);this.onResize();d.__closeButton&&(d.__closeButton.innerHTML=b?J.TEXT_OPEN:J.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return e},set:function(a){H&&
((e=a)?p.bind(window,"unload",b):p.unbind(window,"unload",b),localStorage.setItem(document.location.href+".isLocal",a))}}});if(r.isUndefined(a.parent)){a.closed=!1;p.addClass(this.domElement,J.CLASS_MAIN);p.makeSelectable(this.domElement,!1);if(H&&e){d.useLocalStorage=!0;var f=localStorage.getItem(document.location.href+".gui");f&&(a.load=JSON.parse(f))}this.__closeButton=document.createElement("div");this.__closeButton.innerHTML=J.TEXT_CLOSED;p.addClass(this.__closeButton,J.CLASS_CLOSE_BUTTON);this.domElement.appendChild(this.__closeButton);
p.bind(this.__closeButton,"click",function(){d.closed=!d.closed})}else{void 0===a.closed&&(a.closed=!0);var g=document.createTextNode(a.name);p.addClass(g,"controller-name");f=w(d,g);p.addClass(this.__ul,J.CLASS_CLOSED);p.addClass(f,"title");p.bind(f,"click",function(a){a.preventDefault();d.closed=!d.closed;return!1});a.closed||(this.closed=!1)}a.autoPlace&&(r.isUndefined(a.parent)&&(M&&(O=document.createElement("div"),p.addClass(O,"dg"),p.addClass(O,J.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(O),
M=!1),O.appendChild(this.domElement),p.addClass(this.domElement,J.CLASS_AUTO_PLACE)),this.parent||A(d,a.width));p.bind(window,"resize",function(){d.onResize()});p.bind(this.__ul,"webkitTransitionEnd",function(){d.onResize()});p.bind(this.__ul,"transitionend",function(){d.onResize()});p.bind(this.__ul,"oTransitionEnd",function(){d.onResize()});this.onResize();a.resizable&&x(this);d.getRoot();a.parent||c()};J.toggleHide=function(){I=!I;r.each(D,function(a){a.domElement.style.zIndex=I?-999:999;a.domElement.style.opacity=
I?0:1})};J.CLASS_AUTO_PLACE="a";J.CLASS_AUTO_PLACE_CONTAINER="ac";J.CLASS_MAIN="main";J.CLASS_CONTROLLER_ROW="cr";J.CLASS_TOO_TALL="taller-than-window";J.CLASS_CLOSED="closed";J.CLASS_CLOSE_BUTTON="close-button";J.CLASS_DRAG="drag";J.DEFAULT_WIDTH=245;J.TEXT_CLOSED="Close Controls";J.TEXT_OPEN="Open Controls";p.bind(window,"keydown",function(a){"text"===document.activeElement.type||72!==a.which&&72!=a.keyCode||J.toggleHide()},!1);r.extend(J.prototype,{add:function(a,b){return t(this,a,b,{factoryArgs:Array.prototype.slice.call(arguments,
2)})},addColor:function(a,b){return t(this,a,b,{color:!0})},remove:function(a){this.__ul.removeChild(a.__li);this.__controllers.slice(this.__controllers.indexOf(a),1);var b=this;r.defer(function(){b.onResize()})},destroy:function(){this.autoPlace&&O.removeChild(this.domElement)},addFolder:function(a){if(void 0!==this.__folders[a])throw Error('You already have a folder in this GUI by the name "'+a+'"');var b={name:a,parent:this};b.autoPlace=this.autoPlace;this.load&&this.load.folders&&this.load.folders[a]&&
(b.closed=this.load.folders[a].closed,b.load=this.load.folders[a]);b=new J(b);this.__folders[a]=b;a=w(this,b.domElement);p.addClass(a,"folder");return b},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var a=this.getRoot();if(a.scrollable){var b=p.getOffset(a.__ul).top,c=0;r.each(a.__ul.childNodes,function(b){a.autoPlace&&b===a.__save_row||(c+=p.getHeight(b))});window.innerHeight-b-20<c?(p.addClass(a.domElement,J.CLASS_TOO_TALL),a.__ul.style.height=window.innerHeight-
b-20+"px"):(p.removeClass(a.domElement,J.CLASS_TOO_TALL),a.__ul.style.height="auto")}a.__resize_handle&&r.defer(function(){a.__resize_handle.style.height=a.__ul.offsetHeight+"px"});a.__closeButton&&(a.__closeButton.style.width=a.width+"px")},remember:function(){r.isUndefined(K)&&(K=new m,K.domElement.innerHTML=b);if(this.parent)throw Error("You can only call remember on a top level GUI.");var a=this;r.each(Array.prototype.slice.call(arguments),function(b){0==a.__rememberedObjects.length&&z(a);-1==
a.__rememberedObjects.indexOf(b)&&a.__rememberedObjects.push(b)});this.autoPlace&&A(this,this.width)},getRoot:function(){for(var a=this;a.parent;)a=a.parent;return a},getSaveObject:function(){var a=this.load;a.closed=this.closed;0<this.__rememberedObjects.length&&(a.preset=this.preset,a.remembered||(a.remembered={}),a.remembered[this.preset]=y(this));a.folders={};r.each(this.__folders,function(b,c){a.folders[c]=b.getSaveObject()});return a},save:function(){this.load.remembered||(this.load.remembered=
{});this.load.remembered[this.preset]=y(this);C(this,!1)},saveAs:function(a){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=y(this,!0));this.load.remembered[a]=y(this);this.preset=a;B(this,a,!0)},revert:function(a){r.each(this.__controllers,function(b){this.getRoot().load.remembered?u(a||this.getRoot(),b):b.setValue(b.initialValue)},this);r.each(this.__folders,function(a){a.revert(a)});a||C(this.getRoot(),!1)},listen:function(a){var b=0==this.__listening.length;this.__listening.push(a);
b&&F(this.__listening)}});return J}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',
".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",
dat.controllers.factory=function(a,b,c,e,d,g,f){return function(h,k,l,n){var q=h[k];if(f.isArray(l)||f.isObject(l))return new a(h,k,l);if(f.isNumber(q))return f.isNumber(l)&&f.isNumber(n)?new c(h,k,l,n):new b(h,k,{min:l,max:n});if(f.isString(q))return new e(h,k);if(f.isFunction(q))return new d(h,k,"");if(f.isBoolean(q))return new g(h,k)}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(a,b,c){var e=
function(a,c){function d(){g.setValue(g.__input.value)}e.superclass.call(this,a,c);var g=this;this.__input=document.createElement("input");this.__input.setAttribute("type","text");b.bind(this.__input,"keyup",d);b.bind(this.__input,"change",d);b.bind(this.__input,"blur",function(){g.__onFinishChange&&g.__onFinishChange.call(g,g.getValue())});b.bind(this.__input,"keydown",function(a){13===a.keyCode&&this.blur()});this.updateDisplay();this.domElement.appendChild(this.__input)};e.superclass=a;c.extend(e.prototype,
a.prototype,{updateDisplay:function(){b.isActive(this.__input)||(this.__input.value=this.getValue());return e.superclass.prototype.updateDisplay.call(this)}});return e}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,
dat.controllers.ColorController=function(a,b,c,e,d){function g(a,b,c,e){a.style.background="";d.each(k,function(d){a.style.cssText+="background: "+d+"linear-gradient("+b+", "+c+" 0%, "+e+" 100%); "})}function f(a){a.style.background="";a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";
a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var h=function(a,k){function l(a){t(a);b.bind(window,"mousemove",t);b.bind(window,
"mouseup",m)}function m(){b.unbind(window,"mousemove",t);b.unbind(window,"mouseup",m)}function p(){var a=e(this.value);!1!==a?(v.__color.__state=a,v.setValue(v.__color.toOriginal())):this.value=v.__color.toString()}function n(){b.unbind(window,"mousemove",w);b.unbind(window,"mouseup",n)}function t(a){a.preventDefault();var c=b.getWidth(v.__saturation_field),d=b.getOffset(v.__saturation_field),e=(a.clientX-d.left+document.body.scrollLeft)/c;a=1-(a.clientY-d.top+document.body.scrollTop)/c;1<a?a=1:0>
a&&(a=0);1<e?e=1:0>e&&(e=0);v.__color.v=a;v.__color.s=e;v.setValue(v.__color.toOriginal());return!1}function w(a){a.preventDefault();var c=b.getHeight(v.__hue_field),d=b.getOffset(v.__hue_field);a=1-(a.clientY-d.top+document.body.scrollTop)/c;1<a?a=1:0>a&&(a=0);v.__color.h=360*a;v.setValue(v.__color.toOriginal());return!1}h.superclass.call(this,a,k);this.__color=new c(this.getValue());this.__temp=new c(0);var v=this;this.domElement=document.createElement("div");b.makeSelectable(this.domElement,!1);
this.__selector=document.createElement("div");this.__selector.className="selector";this.__saturation_field=document.createElement("div");this.__saturation_field.className="saturation-field";this.__field_knob=document.createElement("div");this.__field_knob.className="field-knob";this.__field_knob_border="2px solid ";this.__hue_knob=document.createElement("div");this.__hue_knob.className="hue-knob";this.__hue_field=document.createElement("div");this.__hue_field.className="hue-field";this.__input=document.createElement("input");
this.__input.type="text";this.__input_textShadow="0 1px 1px ";b.bind(this.__input,"keydown",function(a){13===a.keyCode&&p.call(this)});b.bind(this.__input,"blur",p);b.bind(this.__selector,"mousedown",function(a){b.addClass(this,"drag").bind(window,"mouseup",function(a){b.removeClass(v.__selector,"drag")})});var u=document.createElement("div");d.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});d.extend(this.__field_knob.style,
{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(.5>this.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});d.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});d.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});d.extend(u.style,{width:"100%",height:"100%",
background:"none"});g(u,"top","rgba(0,0,0,0)","#000");d.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"});f(this.__hue_field);d.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"});b.bind(this.__saturation_field,"mousedown",l);b.bind(this.__field_knob,"mousedown",l);b.bind(this.__hue_field,"mousedown",function(a){w(a);b.bind(window,
"mousemove",w);b.bind(window,"mouseup",n)});this.__saturation_field.appendChild(u);this.__selector.appendChild(this.__field_knob);this.__selector.appendChild(this.__saturation_field);this.__selector.appendChild(this.__hue_field);this.__hue_field.appendChild(this.__hue_knob);this.domElement.appendChild(this.__input);this.domElement.appendChild(this.__selector);this.updateDisplay()};h.superclass=a;d.extend(h.prototype,a.prototype,{updateDisplay:function(){var a=e(this.getValue());if(!1!==a){var b=!1;
d.each(c.COMPONENTS,function(c){if(!d.isUndefined(a[c])&&!d.isUndefined(this.__color.__state[c])&&a[c]!==this.__color.__state[c])return b=!0,{}},this);b&&d.extend(this.__color.__state,a)}d.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var f=.5>this.__color.v||.5<this.__color.s?255:0,h=255-f;d.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+f+
","+f+","+f+")"});this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px";this.__temp.s=1;this.__temp.v=1;g(this.__saturation_field,"left","#fff",this.__temp.toString());d.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+f+","+f+","+f+")",textShadow:this.__input_textShadow+"rgba("+h+","+h+","+h+",.7)"})}});var k=["-moz-","-o-","-webkit-","-ms-",""];return h}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(a,b,c,e){function d(a,
b,c){Object.defineProperty(a,b,{get:function(){if("RGB"===this.__state.space)return this.__state[b];f(this,b,c);return this.__state[b]},set:function(a){"RGB"!==this.__state.space&&(f(this,b,c),this.__state.space="RGB");this.__state[b]=a}})}function g(a,b){Object.defineProperty(a,b,{get:function(){if("HSV"===this.__state.space)return this.__state[b];h(this);return this.__state[b]},set:function(a){"HSV"!==this.__state.space&&(h(this),this.__state.space="HSV");this.__state[b]=a}})}function f(a,c,d){if("HEX"===
a.__state.space)a.__state[c]=b.component_from_hex(a.__state.hex,d);else if("HSV"===a.__state.space)e.extend(a.__state,b.hsv_to_rgb(a.__state.h,a.__state.s,a.__state.v));else throw"Corrupted color state";}function h(a){var c=b.rgb_to_hsv(a.r,a.g,a.b);e.extend(a.__state,{s:c.s,v:c.v});e.isNaN(c.h)?e.isUndefined(a.__state.h)&&(a.__state.h=0):a.__state.h=c.h}var k=function(){this.__state=a.apply(this,arguments);if(!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||
1};k.COMPONENTS="r g b h s v hex a".split(" ");e.extend(k.prototype,{toString:function(){return c(this)},toOriginal:function(){return this.__state.conversion.write(this)}});d(k.prototype,"r",2);d(k.prototype,"g",1);d(k.prototype,"b",0);g(k.prototype,"h");g(k.prototype,"s");g(k.prototype,"v");Object.defineProperty(k.prototype,"a",{get:function(){return this.__state.a},set:function(a){this.__state.a=a}});Object.defineProperty(k.prototype,"hex",{get:function(){this.__state.hex=b.rgb_to_hex(this.r,this.g,
this.b);return this.__state.hex},set:function(a){this.__state.space="HEX";this.__state.hex=a}});return k}(dat.color.interpret,dat.color.math=function(){var a;return{hsv_to_rgb:function(a,c,e){var b=a/60-Math.floor(a/60),g=e*(1-c),f=e*(1-b*c);c=e*(1-(1-b)*c);a=[[e,c,g],[f,e,g],[g,e,c],[g,f,e],[c,g,e],[e,g,f]][Math.floor(a/60)%6];return{r:255*a[0],g:255*a[1],b:255*a[2]}},rgb_to_hsv:function(a,c,e){var b=Math.max(a,c,e),g=b-Math.min(a,c,e);if(0==b)return{h:NaN,s:0,v:0};a=(a==b?(c-e)/g:c==b?2+(e-a)/g:
4+(a-c)/g)/6;0>a&&(a+=1);return{h:360*a,s:g/b,v:b/255}},rgb_to_hex:function(a,c,e){a=this.hex_with_component(0,2,a);a=this.hex_with_component(a,1,c);return a=this.hex_with_component(a,0,e)},component_from_hex:function(a,c){return a>>8*c&255},hex_with_component:function(b,c,e){return e<<(a=8*c)|b&~(255<<a)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1E3/60)}}(),dat.dom.CenteredDiv=function(a,b){var c=function(){this.backgroundElement=document.createElement("div");b.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"});a.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=document.createElement("div");
b.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var c=this;a.bind(this.backgroundElement,"click",function(){c.hide()})};c.prototype.show=function(){var a=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=0;this.domElement.style.webkitTransform=
"scale(1.1)";this.layout();b.defer(function(){a.backgroundElement.style.opacity=1;a.domElement.style.opacity=1;a.domElement.style.webkitTransform="scale(1)"})};c.prototype.hide=function(){var b=this,c=function(){b.domElement.style.display="none";b.backgroundElement.style.display="none";a.unbind(b.domElement,"webkitTransitionEnd",c);a.unbind(b.domElement,"transitionend",c);a.unbind(b.domElement,"oTransitionEnd",c)};a.bind(this.domElement,"webkitTransitionEnd",c);a.bind(this.domElement,"transitionend",
c);a.bind(this.domElement,"oTransitionEnd",c);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};c.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-a.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-a.getHeight(this.domElement)/2+"px"};return c}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);
function CAreYouSurePanel(a){var b,c,e,d,g,f,h;this._init=function(){g=new createjs.Container;g.alpha=0;f.addChild(g);h=new createjs.Shape;h.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);h.alpha=.5;h.on("click",function(){});g.addChild(h);var a=s_oSpriteLibrary.getSprite("msg_box");b=createBitmap(a);b.x=CANVAS_WIDTH_HALF;b.y=CANVAS_HEIGHT_HALF+100;b.regX=.5*a.width;b.regY=.5*a.height;g.addChild(b);c=new createjs.Text(TEXT_ARE_SURE,"50px "+FONT_GAME,"#ffffff");c.x=CANVAS_WIDTH/
2;c.y=CANVAS_HEIGHT_HALF-50;c.textAlign="center";c.textBaseline="middle";g.addChild(c);e=new CGfxButton(CANVAS_WIDTH/2+180,.5*CANVAS_HEIGHT+120,s_oSpriteLibrary.getSprite("but_yes"),g);e.addEventListener(ON_MOUSE_UP,this._onButYes,this);d=new CGfxButton(CANVAS_WIDTH/2-180,.5*CANVAS_HEIGHT+120,s_oSpriteLibrary.getSprite("but_no"),g);d.addEventListener(ON_MOUSE_UP,this._onButNo,this)};this.show=function(){createjs.Tween.get(g).to({alpha:1},150,createjs.quartOut).call(function(){s_oGame.pause(!0)})};
this.unload=function(){createjs.Tween.get(g).to({alpha:0},150,createjs.quartOut).call(function(){f.removeChild(g,h)})};this._onButYes=function(){createjs.Ticker.paused=!1;this.unload();s_oGame.onExit();h.removeAllEventListeners()};this._onButNo=function(){s_oGame.pause(!1);this.unload();g.visible=!1;h.removeAllEventListeners()};f=a;this._init()}
function CCreditsPanel(){var a,b,c,e,d,g,f,h;this._init=function(){h=new createjs.Container;s_oStage.addChild(h);var k=s_oSpriteLibrary.getSprite("msg_box");g=new createjs.Shape;g.graphics.beginFill("#000").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);g.alpha=.8;g.on("click",this._onLogoButRelease);g.cursor="pointer";h.addChild(g);b=createBitmap(k);b.x=CANVAS_WIDTH_HALF;b.y=CANVAS_HEIGHT_HALF+95;b.regX=.5*k.width;b.regY=.5*k.height;h.addChild(b);k=s_oSpriteLibrary.getSprite("but_exit");a=.5*CANVAS_WIDTH+
205;e=new CGfxButton(a,593,k,h);e.addEventListener(ON_MOUSE_UP,this.unload,this);d=new createjs.Text(TEXT_CREDITS_DEVELOPED,"42px "+SECONDARY_FONT,"#ffffff");d.textAlign="center";d.textBaseline="alphabetic";d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT_HALF-50;h.addChild(d);k=s_oSpriteLibrary.getSprite("logo_ctl");c=createBitmap(k);c.regX=k.width/2;c.regY=k.height/2;c.x=CANVAS_WIDTH/2;c.y=CANVAS_HEIGHT_HALF+25;h.addChild(c);f=new createjs.Text(TEXT_LINK1,"42px "+SECONDARY_FONT,"#ffffff");f.textAlign="center";
f.textBaseline="alphabetic";f.x=CANVAS_WIDTH/2;f.y=c.y+100;h.addChild(f)};this.unload=function(){g.off("click",this._onLogoButRelease);e.unload();e=null;s_oStage.removeChild(h)};this._onLogoButRelease=function(){window.open("http://www.codethislab.com/index.php?&l=en","_blank")};this._init()}
function CPin(a,b,c,e,d){var g,f,h,k,l,n,q=null,m,p,r,t=!1,w=!1;this._init=function(a,b,c){n=new createjs.Container;h.addChild(n);f=this.createPin(a,b,c);l=this.createPin(a,b,c);l.scaleY=-1;r=l.regY+=PIN_REF_REGY_FACTOR+.5;this.scale(190);p=new CANNON.Vec3;n.addChild(l,f)};this.createPin=function(){var d;d=new createjs.SpriteSheet({images:[c],frames:{width:c.width/10,height:c.height/8,regX:c.width/10/2,regY:c.height/8/2}});d=createSprite(d,0,c.width/10/2,c.height/8/2,c.width/10,c.height/8);d.stop();
d.x=a;d.y=b;return d};this.setStartPos=function(a,b){g={x:a,y:b}};this.getStartPos=function(){return g};this.resetState=function(){f.gotoAndStop(0);this.setPosition(g.x,g.y);n.alpha=1};this.isDownYet=function(){return t};this.setDown=function(a){(t=a)&&createjs.Tween.get(this).wait(750).call(function(){s_oScenario.setElementVelocity(k,{x:0,y:0,z:0})})};this.animReposition=function(a,b){createjs.Tween.get(f).to({y:a},500);createjs.Tween.get(l).wait(250).to({alpha:b},200)};this.animTake=function(a){createjs.Tween.get(f).to({y:a},
500).call(function(){n.visible=!1});createjs.Tween.get(l).to({alpha:0},200)};this.unload=function(){h.removeChild(n)};this.startPosShadowY=function(a){q=a};this.getStartShadowYPos=function(){return q};this.tweenFade=function(a,b,c){createjs.Tween.get(n).wait(c).to({alpha:a},b).call(function(){})};this.playAudio=function(){w||(playSound("pin_hitted",1,0),w=!0)};this.setPlayedSound=function(a){w=a};this.pinRotation=function(){k.quaternion.y=0;k.quaternion.toEuler(p);k.shapes[0].getAveragePointLocal(p);
p.x=Math.round(Math.degrees(2*p.x));p.y=Math.round(Math.degrees(2*p.y));p.z=Math.round(Math.degrees(2*p.z));if(0===p.x)f.gotoAndStop(0),l.gotoAndStop(0);else if(9>=p.y&&7<p.y||-9<p.y&&-7>p.y)-2<=p.x&&3>=p.x?f.gotoAndStop(29):4<=p.x&&7>=p.x?f.gotoAndStop(19):8<=p.x&&12>=p.x?f.gotoAndStop(9):13<=p.x&&15>=p.x?f.gotoAndStop(79):16<=p.x&&18>=p.x||-16>=p.x&&-18<=p.x?f.gotoAndStop(69):-15<=p.x&&-12>=p.x?f.gotoAndStop(59):-11<=p.x&&-6>=p.x?f.gotoAndStop(49):-5<=p.x&&-2>=p.x&&f.gotoAndStop(39);else if(-3<=
p.z&&3>=p.z)if(-8<=p.y&&8>=p.y)0===p.x?f.gotoAndStop(0):1===p.x?f.gotoAndStop(1):2===p.x?f.gotoAndStop(2):3===p.x?f.gotoAndStop(3):4===p.x?f.gotoAndStop(4):5===p.x?f.gotoAndStop(5):6===p.x?f.gotoAndStop(6):7===p.x?f.gotoAndStop(7):8===p.x?f.gotoAndStop(8):9===p.x?f.gotoAndStop(9):-1===p.x?f.gotoAndStop(41):-2===p.x?f.gotoAndStop(42):-3===p.x?f.gotoAndStop(43):-4===p.x?f.gotoAndStop(44):-5===p.x?f.gotoAndStop(45):-6===p.x?f.gotoAndStop(46):-7===p.x?f.gotoAndStop(47):-8===p.x?f.gotoAndStop(48):-9===
p.x&&f.gotoAndStop(49);else{if(-8>=p.y&&-18<=p.y||18>=p.y&&11<=p.y)0===p.x?f.gotoAndStop(0):1===p.x?f.gotoAndStop(41):2===p.x?f.gotoAndStop(42):3===p.x?f.gotoAndStop(43):4===p.x?f.gotoAndStop(44):5===p.x?f.gotoAndStop(45):6===p.x?f.gotoAndStop(46):7===p.x?f.gotoAndStop(47):8===p.x?f.gotoAndStop(48):9===p.x?f.gotoAndStop(49):-1===p.x?f.gotoAndStop(1):-2===p.x?f.gotoAndStop(2):-3===p.x?f.gotoAndStop(3):-4===p.x?f.gotoAndStop(4):-5===p.x?f.gotoAndStop(5):-6===p.x?f.gotoAndStop(6):-7===p.x?f.gotoAndStop(7):
-8===p.x?f.gotoAndStop(8):-9===p.x&&f.gotoAndStop(9)}else if(4<=p.z&&7>=p.z)if(-8<=p.y&&8>=p.y)0===p.x?f.gotoAndStop(10):1===p.x?f.gotoAndStop(11):2===p.x?f.gotoAndStop(12):3===p.x?f.gotoAndStop(13):4===p.x?f.gotoAndStop(14):5===p.x?f.gotoAndStop(15):6===p.x?f.gotoAndStop(16):7===p.x?f.gotoAndStop(17):8===p.x?f.gotoAndStop(18):9===p.x?f.gotoAndStop(19):-1===p.x?f.gotoAndStop(51):-2===p.x?f.gotoAndStop(52):-3===p.x?f.gotoAndStop(53):-4===p.x?f.gotoAndStop(54):-5===p.x?f.gotoAndStop(55):-6===p.x?f.gotoAndStop(56):
-7===p.x?f.gotoAndStop(57):-8===p.x?f.gotoAndStop(58):-9===p.x&&f.gotoAndStop(59);else{if(-8>=p.y&&-18<=p.y||18>=p.y&&10<=p.y)0===p.x?f.gotoAndStop(0):1===p.x?f.gotoAndStop(31):2===p.x?f.gotoAndStop(32):3===p.x?f.gotoAndStop(33):4===p.x?f.gotoAndStop(34):5===p.x?f.gotoAndStop(35):6===p.x?f.gotoAndStop(36):7===p.x?f.gotoAndStop(37):8===p.x?f.gotoAndStop(38):9===p.x?f.gotoAndStop(39):-1===p.x?f.gotoAndStop(71):-2===p.x?f.gotoAndStop(72):-3===p.x?f.gotoAndStop(73):-4===p.x?f.gotoAndStop(74):-5===p.x?
f.gotoAndStop(75):-6===p.x?f.gotoAndStop(76):-7===p.x?f.gotoAndStop(77):-8===p.x?f.gotoAndStop(78):-9===p.x&&f.gotoAndStop(79)}else if(8<=p.z&&10>=p.z)0===p.x?f.gotoAndStop(20):1===p.x?f.gotoAndStop(21):2===p.x?f.gotoAndStop(22):3===p.x?f.gotoAndStop(23):4===p.x?f.gotoAndStop(24):5===p.x?f.gotoAndStop(25):6===p.x?f.gotoAndStop(26):7===p.x?f.gotoAndStop(27):8===p.x?f.gotoAndStop(28):9===p.x?f.gotoAndStop(29):-1===p.x?f.gotoAndStop(61):-2===p.x?f.gotoAndStop(62):-3===p.x?f.gotoAndStop(63):-4===p.x?
f.gotoAndStop(64):-5===p.x?f.gotoAndStop(65):-6===p.x?f.gotoAndStop(66):-7===p.x?f.gotoAndStop(67):-8===p.x?f.gotoAndStop(68):-9===p.x&&f.gotoAndStop(69);else if(-4>=p.z&&-7<=p.z)if(-10<=p.y&&10>=p.y)0===p.x?f.gotoAndStop(70):1===p.x?f.gotoAndStop(71):2===p.x?f.gotoAndStop(72):3===p.x?f.gotoAndStop(73):4===p.x?f.gotoAndStop(74):5===p.x?f.gotoAndStop(75):6===p.x?f.gotoAndStop(76):7===p.x?f.gotoAndStop(77):8===p.x?f.gotoAndStop(78):9===p.x?f.gotoAndStop(79):-1===p.x?f.gotoAndStop(31):-2===p.x?f.gotoAndStop(32):
-3===p.x?f.gotoAndStop(33):-4===p.x?f.gotoAndStop(34):-5===p.x?f.gotoAndStop(35):-6===p.x?f.gotoAndStop(36):-7===p.x?f.gotoAndStop(37):-8===p.x?f.gotoAndStop(38):-9===p.x&&f.gotoAndStop(39);else{if(-11>=p.y&&-18<=p.y||18>=p.y&&11<=p.y)0===p.x?f.gotoAndStop(50):1===p.x?f.gotoAndStop(51):2===p.x?f.gotoAndStop(52):3===p.x?f.gotoAndStop(53):4===p.x?f.gotoAndStop(54):5===p.x?f.gotoAndStop(55):6===p.x?f.gotoAndStop(56):7===p.x?f.gotoAndStop(57):8===p.x?f.gotoAndStop(58):9===p.x?f.gotoAndStop(59):-1===p.x?
f.gotoAndStop(11):-2===p.x?f.gotoAndStop(12):-3===p.x?f.gotoAndStop(13):-4===p.x?f.gotoAndStop(14):-5===p.x?f.gotoAndStop(15):-6===p.x?f.gotoAndStop(16):-7===p.x?f.gotoAndStop(17):-8===p.x?f.gotoAndStop(18):-9===p.x&&f.gotoAndStop(19)}else-8===p.z&&(0===p.x?f.gotoAndStop(60):1===p.x?f.gotoAndStop(61):2===p.x?f.gotoAndStop(62):3===p.x?f.gotoAndStop(63):4===p.x?f.gotoAndStop(64):5===p.x?f.gotoAndStop(65):6===p.x?f.gotoAndStop(66):7===p.x?f.gotoAndStop(67):8===p.x?f.gotoAndStop(68):9===p.x?f.gotoAndStop(69):
-1===p.x?f.gotoAndStop(21):-2===p.x?f.gotoAndStop(22):-3===p.x?f.gotoAndStop(23):-4===p.x?f.gotoAndStop(24):-5===p.x?f.gotoAndStop(25):-6===p.x?f.gotoAndStop(26):-7===p.x?f.gotoAndStop(27):-8===p.x?f.gotoAndStop(28):-9===p.x&&f.gotoAndStop(29));l.gotoAndStop(f.currentFrame)};this.getPosRef=function(){return m};this.setPosRef=function(a){m=a};this.setRegYRef=function(a){l.regY=a};this.getRegYRef=function(){return r};this.setPositionReflection=function(a,b){l.x=a;l.y=b};this.setPosition=function(a,
b){f.x=a;f.y=b};this.getPhysics=function(){return k};this.setAlpha=function(a){n.alpha=a};this.setAngle=function(a){f.rotation=a};this.setVisible=function(a){n.visible=a};this.setVisibleRef=function(a){l.visible=a};this.getVisible=function(){return n.visible};this.isVisibleRef=function(){return l.visible};this.getX=function(){return f.x};this.getY=function(){return f.y};this.getStartScale=function(){return 190};this.scale=function(a){f.scaleX=a;f.scaleY=a;l.scaleX=a;l.scaleY=-a};this.setAlphaByHeight=
function(a){l.alpha=a};this.getAlphaRef=function(){return l.alpha};this.getScale=function(){return f.scaleX};this.getObject=function(){return n};this.getDepthPos=function(){return k.position.y};k=e;h=d;this._init(a,b,c);return this}
function CPowerBar(a,b,c){var e,d,g,f,h,k,l,n,q,m;this._init=function(a,b){d={x:a,y:b};e=new createjs.Container;e.x=a;e.y=b;m.addChild(e);var c=s_oSpriteLibrary.getSprite("power_bar_bg");f=createBitmap(c);f.regX=.5*c.width;f.regY=c.height;e.addChild(f);h=createBitmap(s_oSpriteLibrary.getSprite("power_bar_fill"));h.regX=.5*c.width;h.regY=c.height;e.addChild(h);l=c.width;n=c.height;g=new createjs.Shape;g.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(f.x,f.y,l,0);g.regX=.5*l;g.regY=n;e.addChild(g);
c=s_oSpriteLibrary.getSprite("power_bar_frame");k=createBitmap(c);k.regX=.5*c.width;k.regY=c.height;e.addChild(k);e.scaleY=-1;h.mask=g;this.createTextPower()};this.unload=function(){m.removeChild(e)};this.setVisible=function(a){e.visible=a};this.createTextPower=function(){q=new createjs.Text(TEXT_POWER,"36px "+FONT_GAME,"#ffffff");q.textAlign="center";q.textBaseline="middle";q.y=-n-50;q.scaleY=-1;e.addChild(q)};this.setPosition=function(a,b){e.x=a;e.y=b};this.setX=function(a){e.x=a};this.setY=function(a){e.y=
a};this.getX=function(){return e.x};this.getY=function(){return e.y};this.getStartPos=function(){return d};this.removeTweensMask=function(){createjs.Tween.removeTweens(g.graphics.command)};this.removeTweensContainer=function(){createjs.Tween.removeTweens(e)};this.animFade=function(a){createjs.Tween.get(e).to({alpha:a},250,createjs.Ease.circleOut).call(function(){0===a&&(e.visible=!1)})};this.getMaskValue=function(){return g.graphics.command.h};this.getMaskHeight=function(){return n};this.getAngle=
function(){return e.rotation};this.mask=function(a){g.graphics.clear();a=Math.floor(a*n/100);g.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(f.x,f.y,l,a)};this.animateMask=function(a){var b=this;createjs.Tween.get(g.graphics.command).to({h:n},a,createjs.Ease.cubicIn).call(function(){createjs.Tween.get(g.graphics.command).to({h:0},a,createjs.Ease.cubicOut).call(function(){b.animateMask(a)})})};this.animateRotation=function(a){var b=this;createjs.Tween.get(e).to({rotation:MAX_EFFECT_ANGLE},a,createjs.Ease.cubicInOut).call(function(){createjs.Tween.get(e).to({rotation:-MAX_EFFECT_ANGLE},
a,createjs.Ease.cubicInOut).call(function(){b.animateRotation(a)})})};m=c;this._init(a,b);return this}
function CTurnsBoard(a,b,c){var e,d,g,f;this._init=function(a,b){e={x:a,y:b};d=new createjs.Container;d.x=e.x;d.y=e.y;c.addChild(d);g=[];a=4;var h=s_oSpriteLibrary.getSprite("turn_board"),k=s_oSpriteLibrary.getSprite("last_turn_board");d.regY=h.height;for(var q=0;q<LAUNCH_TURN-1;q++)g.push(new CTurnBoard(a,0,h,!1,d)),a+=.5*h.width;g.push(new CTurnBoard(a,0,k,!0,d));f=a+=.5*h.width;g[0].changeState("on")};this.getTurnBoard=function(a){return g[a]};this.getStartPos=function(){return e};this.getLastX=
function(){return f};this.setPosition=function(a,b){d.x=a;d.y=b};this.stateTurnBoard=function(a,b){g[a].changeState(b)};this.scaleFactor=function(a){d.scaleX=d.scaleY=.5*a/EDGEBOARD_X*(TURNSBOARD_SCALE_F-1)+1};this.unload=function(){c.removeChild(d)};this._init(a,b);return this}
function CTurnBoard(a,b,c,e,d){var g,f,h;this._init=function(a,b,c,e){f=new createjs.Container;f.x=a;f.y=b;d.addChild(f);h=[];a=new createjs.SpriteSheet({images:[e],frames:{width:e.width/2,height:e.height,regX:0,regY:0},animations:{on:[0],off:[1]}});g=createSprite(a,"off",0,0,e.width/2,e.height);f.addChild(g);c?(f.addChild(h[0]=this.createText(13,21,"0",30,"center")),f.addChild(h[1]=this.createText(35,21,"",30,"center")),f.addChild(h[2]=this.createText(58,21,"",30,"center")),f.addChild(h[3]=this.createText(63,
56,"0",30,"right"))):(f.addChild(h[0]=this.createText(19,21,"0",30,"center")),f.addChild(h[1]=this.createText(54,21,"",30,"center")),f.addChild(h[2]=this.createText(63,56,"0",30,"right")))};this.changeState=function(a){g.gotoAndStop(a)};this.refreshTextByID=function(a,b){h[a].text=b};this.createText=function(a,b,c,d,e){c=new createjs.Text(c,d+"px "+FONT_GAME,"#ffffff");c.textAlign=e;c.textBaseline="middle";c.x=a;c.y=b;return c};this.unload=function(){d.removeChild(f)};this.setVisible=function(a){f.visible=
a};this._init(a,b,e,c);return this}function CTrack(a,b,c,e,d){var g,f,h;this._init=function(a,b,c){g=createBitmap(c);g.x=a;g.y=b;f.addChild(g)};this.setPosition=function(a,b){g.x=a;g.y=b};this.getPhysics=function(){return h};this.getObject=function(){return g};this.getDepthPos=function(){return WALL_TRACK_DEPTH_POSITION.y};this.getHeightPos=function(){return WALL_TRACK_DEPTH_POSITION.z};h=e;f=d;this._init(a,b,c);return this}
function CEffectArray(a,b,c,e){var d,g,f,h,k,l;this._init=function(a,b,c,e){d={x:a,y:b};h=new createjs.Container;h.x=a;h.y=b;k=e;k.addChild(h);a=SPEED_EFFECT_ARROW/FPS;a=new createjs.SpriteSheet({images:[c],frames:{width:c.width/10,height:c.height/2,regX:c.width/2/10,regY:c.height/2/2},animations:{normal:[0,19,"reverse",a],reverse:{frames:[19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0],speed:a}}});g=createSprite(a,"normal",c.width/2/10,c.height/2/2,c.width/10,c.height/2);g.y=-30;l=g.regX=c.width/
2/10;this.stopAnimation();h.addChild(g);this.createTextEffect(c)};this.getX=function(){return g.x};this.getY=function(){return g.y};this.getStartPos=function(){return d};this.playAnimation=function(){g.play()};this.stopAnimation=function(){g.stop()};this.getStoppedFrame=function(){return g.currentFrame*g.scaleX};this.removeAllEventListeners=function(){g.removeAllEventListeners()};this.setPosition=function(a,b){h.x=a;h.y=b};this.setVisible=function(a){h.visible=a};this.getScaleX=function(){return g.scaleX};
this.createTextEffect=function(a){f=new createjs.Text(TEXT_EFFECT,"36px "+FONT_GAME,"#ffffff");f.textAlign="center";f.textBaseline="middle";f.x=1.6*-l;f.y=a.height/4;h.addChild(f)};this.animArrow=function(){var a=this;g.gotoAndPlay("normal");this.onFinishAnimation(function(){g.gotoAndPlay("reverse");g.removeAllEventListeners();a.onFinishAnimation(function(){g.scaleX*=-1;g.regX=-1===g.scaleX?2*-l-14:l;g.removeAllEventListeners();a.animArrow()})})};this.changeState=function(a){var b=this;g.gotoAndPlay(a);
this.onFinishAnimation(function(){b.loopAnimArray()})};this.animFade=function(a){createjs.Tween.get(g).to({alpha:a},250,createjs.Ease.circleOut).call(function(){0===a&&(h.visible=!1)})};this.onFinishAnimation=function(a){g.on("animationend",function(){a()})};this.unload=function(){g.removeAllEventListeners();k.removeChild(h)};this._init(a,b,c,e);return this}
function CCharacter(a,b,c){var e,d=[],g,f=0,h=0;this._init=function(a,b){e={x:a,y:b};g=new createjs.Container;g.x=e.x;g.y=e.y;g.regX=20;c.addChild(g);for(var f=0;f<NUM_SPRITE_PLAYER;f++)d.push(createBitmap(s_oSpriteLibrary.getSprite("player_"+f))),d[f].visible=!1,g.addChild(d[f]);d[0].visible=!0};this.setPosition=function(a,b){g.x=a;g.y=b};this.getX=function(){return g.x};this.getY=function(){return g.y};this.getStartPos=function(){return e};this.setVisible=function(a){g.visible=a};this.animFade=
function(a){var b=this;createjs.Tween.get(g).to({alpha:a},250).call(function(){0===a&&(g.visible=!1,b.hideCharacter(NUM_SPRITE_PLAYER-1),b.viewCharacter(f))})};this.viewCharacter=function(a){d[a].visible=!0};this.hideCharacter=function(a){d[a].visible=!1};this.getFrame=function(){return f};this.animCharacter=function(){h++;if(h>=BUFFER_ANIM_PLAYER){this.hideCharacter(f);if(f+1<NUM_SPRITE_PLAYER)this.viewCharacter(f+1),f++;else return this.viewCharacter(f),h=f=0,!1;h=0}return!0};this._init(a,b);s_oAnimMonitor=
this;return this}var s_oAnimMonitor=null;
function CAnimMonitor(a,b,c){var e,d=[],g=[],f=[],h,k,l,n,q,m=0,p=0;this._init=function(a,b){e={x:a,y:b};k=new createjs.Container;k.x=e.x;k.y=e.y;c.addChild(k);l=new createjs.Container;k.addChild(l);l.visible=!1;n=new createjs.Container;k.addChild(n);n.visible=!1;q=new createjs.Container;k.addChild(q);q.visible=!1;for(var m=s_oSpriteLibrary.getSprite("pattern_monitor"),p=0;p<NUM_SPRITE_MONITOR;p++)d.push(createBitmap(s_oSpriteLibrary.getSprite("monitor_strike_"+p))),d[p].visible=!1,l.addChild(d[p]),
g.push(createBitmap(s_oSpriteLibrary.getSprite("monitor_spare_"+p))),g[p].visible=!1,n.addChild(g[p]),f.push(createBitmap(s_oSpriteLibrary.getSprite("monitor_gutterball_"+p))),f[p].visible=!1,q.addChild(f[p]);d[0].visible=!0;g[0].visible=!0;f[0].visible=!0;p=new createjs.Matrix2D;p.a=p.d=.16;h=new createjs.Shape;h.graphics.beginBitmapFill(m,"repeat",p).drawRect(0,0,790,88);h.y=1;h.alpha=.65;k.addChild(h);k.regY=s_oSpriteLibrary.getSprite("monitor_strike_0").height};this.setPosition=function(a,b){k.x=
a;k.y=b};this.getStartPos=function(){return e};this.setVisibleMonitorStrike=function(a){l.visible=a};this.setVisibleMonitorSpare=function(a){n.visible=a};this.setVisibleMonitorGutter=function(a){q.visible=a};this.viewMonitor=function(a,b){a[b].visible=!0};this.hideMonitor=function(a,b){a[b].visible=!1};this.getStrikeArray=function(){return d};this.getSpareArray=function(){return g};this.getGutterArray=function(){return f};this.scaleFactor=function(a){k.scaleX=k.scaleY=.5*a/EDGEBOARD_X*(ANIM_MONITOR_SCALE_F-
1)+1};this.disableRunningMonitor=function(){l.visible=!1;n.visible=!1;q.visible=!1};this.animMonitor=function(a){p+=s_iTimeElaps;if(p>BUFFER_ANIM_MONITOR){this.hideMonitor(a,m);if(m+1<NUM_SPRITE_MONITOR)this.viewMonitor(a,m+1),m++;else return this.disableRunningMonitor(),p=m=0,this.viewMonitor(a,m),!1;p=0}return!0};this._init(a,b);s_oAnimMonitor=this;return this}s_oAnimMonitor=null;
function CPinDragger(a,b,c,e){var d,g;this._init=function(a,b,c,e){g=e;e=30/FPS;e=new createjs.SpriteSheet({images:[c],frames:{width:c.width/8,height:c.height/4,regX:c.width/2/8,regY:c.height/2/4},animations:{up:{frames:[8,7,6,5,4,3,2,1,0],speed:e},down:[0,8,8,e-.15],throw_pins_0:[0,8,"throw_pins_1",e],throw_pins_1:[9,31,31,e]}});d=createSprite(e,"run",c.width/2/10,c.height/2/4,c.width/10,c.height/6);d.x=a;d.y=b;g.addChild(d)};this.getX=function(){return d.x};this.getY=function(){return d.y};this.animThrowPins=
function(){var a=this;d.gotoAndPlay("throw_pins_0");this.onFinishAnimation(function(){var b=s_oScenario.getPinsBinder();createjs.Tween.get(b.position).to({y:PIN_BINDER_TO_Y},900).call(function(){s_oGame.isAwakwePins(!1)});s_oGame.isAwakwePins(!0);d.gotoAndPlay("throw_pins_1");playSound("binder",1,0);d.removeAllEventListeners();a.onFinishAnimation(function(){d.gotoAndStop(31);d.removeAllEventListeners();createjs.Tween.get(this).wait(500).call(function(){s_oGame.setPinsPhysicsMovement(!1);s_oGame.repositionPins();
s_oGame.resetScene();createjs.Tween.get(this).wait(200).call(function(){d.gotoAndPlay("down");a.onFinishAnimation(function(){d.gotoAndStop(8);createjs.Tween.get(this).wait(200).call(function(){d.gotoAndPlay("up");s_oGame.updatePinsPosition();d.removeAllEventListeners();a.onFinishAnimation(function(){d.visible=!1;s_oGame.setPinsPhysicsMovement(!0);s_oGame.nextStage();d.removeAllEventListeners()})})})})})})})};this.takeRemainPinsAndRepos=function(){var a=this;d.gotoAndPlay("down");a.onFinishAnimation(function(){createjs.Tween.get(a).wait(200).call(function(){d.gotoAndPlay("up");
s_oGame.setPinsPhysicsMovement(!1);s_oGame.animUpRemainPins();d.removeAllEventListeners();a.onFinishAnimation(function(){d.gotoAndPlay("throw_pins_0");d.removeAllEventListeners();a.onFinishAnimation(function(){var b=s_oScenario.getPinsBinder();createjs.Tween.get(b.position).to({y:PIN_BINDER_TO_Y},900).call(function(){s_oGame.isAwakwePins(!1)});s_oGame.isAwakwePins(!0);d.gotoAndPlay("throw_pins_1");playSound("binder",1,0);s_oGame.setPinsPhysicsMovement(!0);d.removeAllEventListeners();a.onFinishAnimation(function(){d.gotoAndStop(31);
d.removeAllEventListeners();createjs.Tween.get(this).wait(500).call(function(){s_oScenario.getPinsBinder().collisionResponse=0;createjs.Tween.get(this).wait(200).call(function(){d.gotoAndPlay("down");s_oGame.setPinsPhysicsMovement(!1);s_oGame.repositionRemainPins();a.onFinishAnimation(function(){d.gotoAndStop(8);createjs.Tween.get(this).wait(200).call(function(){d.gotoAndPlay("up");d.removeAllEventListeners();a.onFinishAnimation(function(){d.visible=!1;s_oScenario.getPinsBinder().position.y=PINS_BINDER_POSITION.y;
s_oGame.activeControl();s_oGame.setPinsPhysicsMovement(!0);d.removeAllEventListeners()})})})})})})})})})})};this.setPosition=function(a,b){d.x=a;d.y=b};this.setVisible=function(a){d.visible=a};this.changeState=function(a){d.gotoAndPlay(a)};this.onFinishAnimation=function(a){d.on("animationend",function(){a()})};s_oPinBinder=this;this._init(a,b,c,e)}var s_oPinBinder;
function CSemaphore(a,b,c,e){var d,g,f;this._init=function(a,b,c){d=this.createSemaphore(a,b,c);f=this.createSemaphore(a,b,c);f.y+=155;f.scaleY=-.95;f.alpha=.25;g.addChild(d);g.addChildAt(f,13)};this.createSemaphore=function(a,b,c){var d=new createjs.SpriteSheet({images:[c],frames:{width:c.width/2,height:c.height,regX:c.width/2/2,regY:c.height/2},animations:{green:1,red:0}});c=createSprite(d,1,c.width/2/2,c.height/2,c.width/2,c.height);c.stop();c.x=a;c.y=b;return c};this.changeState=function(a){d.gotoAndStop(a);
f.gotoAndStop(a)};this.unload=function(){g.removeChild(d,f)};this.setPositionShadow=function(a,b){f.x=a;f.y=b};this.setPosition=function(a,b){d.x=a;d.y=b};this.setVisible=function(a){d.visible=a;f.visible=a};this.getX=function(){return d.x};this.getY=function(){return d.y};g=e;this._init(a,b,c);return this}
function CTotalScoreBoard(a,b,c,e){var d,g,f;this._init=function(a,b,c){g=new createjs.Container;g.x=a;g.y=b;e.addChild(g);d=createBitmap(c);g.regY=c.height;g.addChild(d);g.addChild(this.createText(.5*c.width,17,TEXT_TOTAL,18,"center"));g.addChild(f=this.createText(.5*c.width,.7*c.height,"0",30,"center"))};this.refreshText=function(a){f.text=a};this.createText=function(a,b,c,d,e){c=new createjs.Text(c,d+"px "+FONT_GAME,"#ffffff");c.textAlign=e;c.textBaseline="middle";c.x=a;c.y=b;return c};this.unload=
function(){e.removeChild(g)};this.setVisible=function(a){g.visible=a};this._init(a,b,c);return this}
function CEndPanel(a){var b,c,e,d,g,f,h;this._init=function(a){e=new createjs.Shape;e.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e.alpha=.7;e.on("click",function(){});b=createBitmap(a);b.x=CANVAS_WIDTH_HALF;b.y=CANVAS_HEIGHT_HALF+95;b.regX=.5*a.width;b.regY=.5*a.height;e.on("click",function(){},null,!0);d=new createjs.Text("","72px "+SECONDARY_FONT,"#fff");d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT/2-50;d.textAlign="center";d.textBaseline="alphabetic";d.lineHeight=60;d.lineWidth=
450;g=new createjs.Text("","45px "+SECONDARY_FONT,"#fff");g.x=CANVAS_WIDTH/2;g.y=CANVAS_HEIGHT/2+30;g.textAlign="center";g.textBaseline="alphabetic";g.lineHeight=60;g.lineWidth=470;c=new createjs.Container;c.alpha=0;c.visible=!1;c.addChild(e,b,g,d);a=s_oSpriteLibrary.getSprite("but_restart");f=new CGfxButton(CANVAS_WIDTH/2+170,CANVAS_HEIGHT_HALF+120,a,c);a=s_oSpriteLibrary.getSprite("but_home");h=new CGfxButton(CANVAS_WIDTH/2-170,CANVAS_HEIGHT_HALF+120,a,c);s_oStage.addChild(c)};this.unload=function(){e.off("click",
function(){});createjs.Tween.get(c).to({alpha:0},500).call(function(){h.unload();f.unload();s_oStage.removeChild(c)})};this._initListener=function(){h.addEventListener(ON_MOUSE_UP,this._onExit,this);f.addEventListener(ON_MOUSE_UP,this._onRestart,this)};this.show=function(a){d.text=TEXT_GAMEOVER;g.text=TEXT_SCORE+": "+a;c.visible=!0;var b=this;createjs.Tween.get(c).to({alpha:1},500).call(function(){b._initListener();s_iAdsLevel===NUM_LEVEL_FOR_ADS?($(s_oMain).trigger("show_interlevel_ad"),s_iAdsLevel=
1):s_iAdsLevel++});$(s_oMain).trigger("share_event",a);$(s_oMain).trigger("save_score",a)};this._onRestart=function(){this.unload();s_oGame.restartGame()};this._onExit=function(){this.unload();s_oGame.onExit()};this._init(a);return this}
function CController(){var a,b,c,e,d,g;this._init=function(){g=new createjs.Shape;g.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);g.on("mousedown",s_oGame.manageControl,s_oGame);s_oStage.addChild(g);d=new createjs.Container;s_oStage.addChild(d);a={x:CANVAS_WIDTH_HALF+310,y:CANVAS_HEIGHT-EDGEBOARD_Y+50};b={x:CANVAS_WIDTH_HALF-310,y:CANVAS_HEIGHT-EDGEBOARD_Y+50};var f=s_oSpriteLibrary.getSprite("arrow_left");c=new CGfxButton(b.x,b.y,f,d);c.addEventListener(ON_MOUSE_DOWN,
s_oGame.onLeft,this);c.addEventListener(ON_MOUSE_UP,s_oGame.dirKeyUp,this);f=s_oSpriteLibrary.getSprite("arrow_right");e=new CGfxButton(a.x,a.y,f,d);e.addEventListener(ON_MOUSE_DOWN,s_oGame.onRight,this);e.addEventListener(ON_MOUSE_UP,s_oGame.dirKeyUp,this)};this.getStartPositionControlRight=function(){return a};this.getStartPositionControlLeft=function(){return b};this.setPositionControlRight=function(a,b){e.setPosition(a,b)};this.setPositionControlLeft=function(a,b){c.setPosition(a,b)};this.arrowVisibility=
function(a){d.visible=a};this.unload=function(){c.unload();c=null;e.unload();e=null};this._init();return this}
(function(){function a(){}function b(){}function c(){this.skinIndices=[];this.skinWeights=[];this.matrices=[]}function e(){this.hierarchy=[]}function d(){this.id=this.name=this.node=null;this.vertices=[];this.indices=[];this.normals=[];this.uvs=[];this.bones=[];this.skins=null}function g(){this.index=this.node=this.ref=this.map=this.uv=null}function f(){this.index=this.node=this.ref=this.map=this.normal=null}function h(){this.attrData=this.attrFlag=this.values=this.times=this.internalId=this.id=this.version=
null}function k(){this.attr=this.id=null;this.attrZ=this.attrY=this.attrX=!1;this.curveIdx=this.containerBoneId=this.containerInternalId=this.internalId=null;this.curves=[]}function l(){this.curves={};this.length=0;this.fps=30;this.frames=0}function n(){this.textures=[];this.perGeoMap={}}function q(){this.name=this.fileName="";this.id=null;this.parentIds=[]}THREE.FBXLoader=function(a,b){THREE.Loader.call(this,a);this.manager=void 0!==b?b:THREE.DefaultLoadingManager;this.textureBasePath=this.textureLoader=
null};THREE.FBXLoader.prototype=Object.create(THREE.Loader.prototype);THREE.FBXLoader.prototype.constructor=THREE.FBXLoader;THREE.FBXLoader.prototype.load=function(a,b,c,d){var e=this;(new THREE.XHRLoader(e.manager)).load(a,function(c){e.isFbxFormatASCII(c)?e.isFbxVersionSupported(c)?(e.textureBasePath=e.extractUrlBase(a),b(e.parse(c))):console.warn("FBXLoader: !!! FBX Version below 7 not supported !!!"):console.warn("FBXLoader: !!! FBX Binary format not supported !!!")},c,d)};THREE.FBXLoader.prototype.setCrossOrigin=
function(a){this.crossOrigin=a};THREE.FBXLoader.prototype.isFbxFormatASCII=function(a){CORRECT="Kaydara\\FBX\\Binary\\\\".split("");for(var b=0,c=0;c<CORRECT.length;++c){var d=a[0];a=a.slice(b+1);b++;num=d;if(num==CORRECT[c])return!1}return!0};THREE.FBXLoader.prototype.isFbxVersionSupported=function(a){return(match=a.match(/FBXVersion: (\d+)/))?(a=parseInt(match[1]),console.log("FBXLoader: FBX version "+a),7E3<=a):!1};THREE.FBXLoader.prototype.parse=function(a){console.time("FBXLoader");console.time("FBXLoader: TextParser");
a=(new b).parse(a);console.timeEnd("FBXLoader: TextParser");console.time("FBXLoader: ObjectParser");this.hierarchy=(new e).parseHierarchy(a);this.weights=(new c).parse(a,this.hierarchy);this.animations=(new l).parse(a,this.hierarchy);this.textures=(new n).parse(a,this.hierarchy);console.timeEnd("FBXLoader: ObjectParser");console.time("FBXLoader: GeometryParser");geometries=this.parseGeometries(a);console.timeEnd("FBXLoader: GeometryParser");a=new THREE.Group;for(var d=0;d<geometries.length;++d)void 0!==
geometries[d]&&a.add(geometries[d]);console.timeEnd("FBXLoader");return a};THREE.FBXLoader.prototype.parseGeometries=function(a){if(!("Geometry"in a.Objects.subNodes))return[];var b=0,c;for(c in a.Objects.subNodes.Geometry)c.match(/^\d+$/)&&b++;var d=[];if(0<b)for(c in a.Objects.subNodes.Geometry)"Mesh"===a.Objects.subNodes.Geometry[c].attrType&&d.push(this.parseGeometry(a.Objects.subNodes.Geometry[c],a));else d.push(this.parseGeometry(a.Objects.subNodes.Geometry,a));return d};THREE.FBXLoader.prototype.parseGeometry=
function(a,b){geo=(new d).parse(a);geo.addBones(this.hierarchy.hierarchy);var c=new THREE.BufferGeometry;c.name=geo.name;c.addAttribute("position",new THREE.BufferAttribute(new Float32Array(geo.vertices),3));void 0!==geo.normals&&0<geo.normals.length&&c.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(geo.normals),3));void 0!==geo.uvs&&0<geo.uvs.length&&c.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(geo.uvs),2));void 0!==geo.indices&&65535<geo.indices.length?c.setIndex(new THREE.BufferAttribute(new Uint32Array(geo.indices),
1)):void 0!==geo.indices&&c.setIndex(new THREE.BufferAttribute(new Uint16Array(geo.indices),1));c.verticesNeedUpdate=!0;c.computeBoundingSphere();c.computeBoundingBox();var e,f=this.textures.getById(b.searchConnectionParent(geo.id));void 0!==f&&0<f.length&&(null===this.textureLoader&&(this.textureLoader=new THREE.TextureLoader),e=this.textureLoader.load(this.textureBasePath+"/"+f[0].fileName));e=void 0!==e?new THREE.MeshBasicMaterial({map:e}):new THREE.MeshBasicMaterial({color:3342591});c=(new THREE.Geometry).fromBufferGeometry(c);
c.bones=geo.bones;c.skinIndices=this.weights.skinIndices;c.skinWeights=this.weights.skinWeights;if(void 0===geo.bones||void 0===geo.skins||void 0===this.animations||0===this.animations.length){var c=new THREE.Mesh(c,e),f=b.Connections.properties.connections,g=b.Objects.subNodes.Model;for(e=0;e<f.length;e++)if(f[e][0]===a.id){c.name=g[f[e][1]].attrName;if(g[f[e][1]].properties.Lcl_Translation){f=g[f[e][1]].properties.Lcl_Translation.value.split(",");for(e=0;e<f.length;e++)f[e]=parseFloat(f[e]);c.position.x=
f[0];c.position.y=f[1];c.position.z=f[2]}break}}else e.skinning=!0,c=new THREE.SkinnedMesh(c,e),this.addAnimation(c,this.weights.matrices,this.animations);return c};THREE.FBXLoader.prototype.addAnimation=function(a,b,c){b={name:"animationtest",fps:30,length:c.length,hierarchy:[]};for(var d=0;d<a.geometry.bones.length;++d){var e=a.geometry.bones[d].name,e=e.replace(/.*:/,"");b.hierarchy.push({parent:a.geometry.bones[d].parent,name:e,keys:[]})}var f=function(a,b){if(void 0===a)return!1;var c;switch(b){case "S":if(void 0===
a.S)return!1;c=a.S;break;case "R":if(void 0===a.R)return!1;c=a.R;break;case "T":if(void 0===a.T)return!1;c=a.T}return void 0===c.curves.x||void 0===c.curves.y||void 0===c.curves.z?!1:!0},g=function(a,b){var c=void 0!==a.curves.y.values[b],d=void 0!==a.curves.z.values[b];return void 0!==a.curves.x.values[b]&&c&&d},e=function(a,b){var d={};d.time=frame/c.fps;d.pos=b.pos;d.rot=b.rotq;d.scl=b.scl;if(void 0===a)return d;try{if(f(a,"T")&&g(a.T,frame)){var e=new THREE.Vector3(a.T.curves.x.values[frame],
a.T.curves.y.values[frame],a.T.curves.z.values[frame]);d.pos=[e.x,e.y,e.z]}else delete d.pos;if(f(a,"R")&&g(a.R,frame)){var h=degToRad(a.R.curves.x.values[frame]),k=degToRad(a.R.curves.y.values[frame]),m=degToRad(a.R.curves.z.values[frame]),p=new THREE.Vector3(h,k,m),l=quatFromVec(p.x,p.y,p.z);d.rot=[l.x,l.y,l.z,l.w]}else delete d.rot;if(f(a,"S")&&g(a.S,frame)){var n=new THREE.Vector3(a.S.curves.x.values[frame],a.S.curves.y.values[frame],a.S.curves.z.values[frame]);d.scl=[n.x,n.y,n.z]}else delete d.scl}catch(N){console.log(b),
console.log(N)}return d},h=a.geometry.bones;for(frame=0;frame<c.frames;frame++)for(d=0;d<h.length;d++)for(var k=h[d],m=c.curves[d],p=0;p<b.hierarchy.length;p++)b.hierarchy[p].name===k.name&&b.hierarchy[p].keys.push(e(m,k));void 0===a.geometry.animations&&(a.geometry.animations=[]);a.geometry.animations.push(THREE.AnimationClip.parseAnimation(b,a.geometry.bones))};THREE.FBXLoader.prototype.parseMaterials=function(a){if(!("Material"in a.subNodes))return[];var b=0,c;for(c in a.subNodes.Materials)c.match(/^\d+$/)&&
b++;var d=[];if(0<b)for(c in a.subNodes.Material)d.push(parseMaterial(a.subNodes.Material[c]));else d.push(parseMaterial(a.subNodes.Material));return d};THREE.FBXLoader.prototype.parseMaterial=function(a){};THREE.FBXLoader.prototype.loadFile=function(a,b,c,d,e){var f=new THREE.XHRLoader(this.manager);f.setResponseType(e);return f.load(a,function(a){b(a)},c,d)};THREE.FBXLoader.prototype.loadFileAsBuffer=function(a,b,c,d){this.loadFile(a,onLoad,c,d,"arraybuffer")};THREE.FBXLoader.prototype.loadFileAsText=
function(a,b,c,d){this.loadFile(a,b,c,d,"text")};a.prototype.add=function(a,b){this[a]=b};a.prototype.searchConnectionParent=function(a){void 0===this.__cache_search_connection_parent&&(this.__cache_search_connection_parent=[]);if(void 0!==this.__cache_search_connection_parent[a])return this.__cache_search_connection_parent[a];this.__cache_search_connection_parent[a]=[];for(var b=this.Connections.properties.connections,c=[],d=0;d<b.length;++d)b[d][0]==a&&c.push(0===b[d][1]?-1:b[d][1]);if(0<c.length)return this.__cache_search_connection_parent[a]=
this.__cache_search_connection_parent[a].concat(c),c;this.__cache_search_connection_parent[a]=[-1];return[-1]};a.prototype.searchConnectionChildren=function(a){void 0===this.__cache_search_connection_children&&(this.__cache_search_connection_children=[]);if(void 0!==this.__cache_search_connection_children[a])return this.__cache_search_connection_children[a];this.__cache_search_connection_children[a]=[];for(var b=this.Connections.properties.connections,c=[],d=0;d<b.length;++d)b[d][1]==a&&c.push(0===
b[d][0]?-1:b[d][0]);if(0<c.length)return this.__cache_search_connection_children[a]=this.__cache_search_connection_children[a].concat(c),c;this.__cache_search_connection_children[a]=[-1];return[-1]};a.prototype.searchConnectionType=function(a,b){var c=a+","+b;void 0===this.__cache_search_connection_type&&(this.__cache_search_connection_type="");if(void 0!==this.__cache_search_connection_type[c])return this.__cache_search_connection_type[c];this.__cache_search_connection_type[c]="";for(var d=this.Connections.properties.connections,
e=0;e<d.length;++e)if(d[e][0]==a&&d[e][1]==b)return this.__cache_search_connection_type[c]=d[e][2],d[e][2];return this.__cache_search_connection_type[a]=null};b.prototype={getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(a){this.nodeStack.push(a);this.currentIndent+=1},popStack:function(){this.nodeStack.pop();--this.currentIndent},setCurrentProp:function(a,
b){this.currentProp=a;this.currentPropName=b},parse:function(b){this.currentIndent=0;this.allNodes=new a;this.nodeStack=[];this.currentProp=[];this.currentPropName="";b=b.split("\n");for(var c in b){var d=b[c];if(!d.match(/^[\s\t]*;/)&&!d.match(/^[\s\t]*$/))if(match=d.match(new RegExp("^\\t{"+this.currentIndent+"}(\\w+):(.*){",""))){var e=match[1].trim().replace(/^"/,"").replace(/"$/,""),f=match[2].split(",").map(function(a){return a.trim().replace(/^"/,"").replace(/"$/,"")});this.parseNodeBegin(d,
e,f||null)}else(match=d.match(new RegExp("^\\t{"+this.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)")))?(e=match[1].replace(/^"/,"").replace(/"$/,"").trim(),f=match[2].replace(/^"/,"").replace(/"$/,"").trim(),this.parseNodeProperty(d,e,f)):d.match(new RegExp("^\\t{"+(this.currentIndent-1)+"}}"))?this.nodeEnd():d.match(/^[^\s\t}]/)&&this.parseNodePropertyContinued(d)}return this.allNodes},parseNodeBegin:function(a,b,c){a={name:b,properties:{},subNodes:{}};var d=this.parseNodeAttr(c),e=this.getCurrentNode();
if(0===this.currentIndent)this.allNodes.add(b,a);else if(b in e.subNodes){var f=e.subNodes[b];this.isFlattenNode(e.subNodes[b])&&(""===d.id?(e.subNodes[b]=[],e.subNodes[b].push(f)):(e.subNodes[b]={},e.subNodes[b][f.id]=f));""===d.id?e.subNodes[b].push(a):e.subNodes[b][d.id]=a}else e.subNodes[b]=a;c&&(a.id=d.id,a.attrName=d.name,a.attrType=d.type);this.pushStack(a)},parseNodeAttr:function(a){var b=a[0];""!==a[0]&&(b=parseInt(a[0]),isNaN(b)&&(b=a[0]));var c,d;1<a.length&&(c=a[1].replace(/^(\w+)::/,
""),d=a[2]);return{id:b,name:c||"",type:d||""}},parseNodeProperty:function(a,b,c){var d=this.getCurrentNode(),e=d.name;if(void 0!==e&&e.match(/Properties(\d)+/))this.parseNodeSpecialProperty(a,b,c);else{if("C"==b){b=c.split(",").slice(1);a=parseInt(b[0]);var e=parseInt(b[1]),f=c.split(",").slice(3);b="connections";c=[a,e];c=c.concat(f);void 0===d.properties[b]&&(d.properties[b]=[])}"Node"==b&&(a=parseInt(c),d.properties.id=a,d.id=a);b in d.properties?Array.isArray(d.properties[b])?d.properties[b].push(c):
d.properties[b]+=c:Array.isArray(d.properties[b])?d.properties[b].push(c):d.properties[b]=c;this.setCurrentProp(d.properties,b)}},parseNodePropertyContinued:function(a){this.currentProp[this.currentPropName]+=a},parseNodeSpecialProperty:function(a,b,c){var d=c.split('",').map(function(a){return a.trim().replace(/^\"/,"").replace(/\s/,"_")});a=d[0];b=d[1];c=d[2];var e=d[3],d=d[4];switch(b){case "int":d=parseInt(d);break;case "double":d=parseFloat(d);break;case "ColorRGB":case "Vector3D":d=d.split(","),
d=new THREE.Vector3(d[0],d[1],d[2])}this.getPrevNode().properties[a]={type:b,type2:c,flag:e,value:d};this.setCurrentProp(this.getPrevNode().properties,a)},nodeEnd:function(a){this.popStack()},isFlattenNode:function(a){return"subNodes"in a&&"properties"in a?!0:!1}};c.prototype.parseCluster=function(a,b,c){a=a.searchConnectionParent(b);var d=toInt(c.subNodes.Indexes.properties.a.split(",")),e=toFloat(c.subNodes.Weights.properties.a.split(",")),f=toMat44(toFloat(c.subNodes.Transform.properties.a.split(","))),
g=toMat44(toFloat(c.subNodes.TransformLink.properties.a.split(",")));return{parent:a,id:parseInt(b),indices:d,weights:e,transform:f,transformlink:g,linkMode:c.properties.Mode}};c.prototype.parse=function(a,b){this.skinIndices=[];this.skinWeights=[];this.matrices=[];var c=a.Objects.subNodes.Deformer,d={},e;for(e in c)if("Cluster"===c[e].attrType&&"Indexes"in c[e].subNodes){var f=this.parseCluster(a,e,c[e]),g=a.searchConnectionChildren(f.id)[0];d[g]=f}c=[];e=b.hierarchy;for(f=0;f<e.length;++f)if(g=
e[f].internalId,void 0===d[g])this.matrices.push(new THREE.Matrix4);else{g=d[g];this.matrices.push(g.transform);for(var h=0;h<g.indices.length;++h){void 0===c[g.indices[h]]&&(c[g.indices[h]]={},c[g.indices[h]].joint=[],c[g.indices[h]].weight=[]);var k=a.searchConnectionChildren(g.id);1<k.length&&console.warn("FBXLoader: node "+g.id+" have many weight kids: "+k);c[g.indices[h]].joint.push(b.getBoneIdfromInternalId(a,k[0]));c[g.indices[h]].weight.push(g.weights[h])}}for(d=0;d<c.length;d++)e=new THREE.Vector4(c[d].joint[0]?
c[d].joint[0]:0,c[d].joint[1]?c[d].joint[1]:0,c[d].joint[2]?c[d].joint[2]:0,c[d].joint[3]?c[d].joint[3]:0),f=new THREE.Vector4(c[d].weight[0]?c[d].weight[0]:0,c[d].weight[1]?c[d].weight[1]:0,c[d].weight[2]?c[d].weight[2]:0,c[d].weight[3]?c[d].weight[3]:0),this.skinIndices.push(e),this.skinWeights.push(f);return this};e.prototype.parseHierarchy=function(a){var b=a.Objects.subNodes.Model,c=[],d;for(d in b)void 0!==b[d].attrType&&c.push(b[d]);this.hierarchy=[];for(b=0;b<c.length;++b){d=c[b];var e=a.searchConnectionParent(d.id)[0],
f=[0,0,0],g=[0,0,0,1],h=[1,1,1];"Lcl_Translation"in d.properties&&(f=toFloat(d.properties.Lcl_Translation.value.split(",")));if("Lcl_Rotation"in d.properties){var g=toRad(toFloat(d.properties.Lcl_Rotation.value.split(","))),k=new THREE.Quaternion;k.setFromEuler(new THREE.Euler(g[0],g[1],g[2],"ZYX"));g=[k.x,k.y,k.z,k.w]}"Lcl_Scaling"in d.properties&&(h=toFloat(d.properties.Lcl_Scaling.value.split(",")));k=d.attrName;k=k.replace(/:/,"");k=k.replace(/_/,"");k=k.replace(/-/,"");this.hierarchy.push({parent:e,
name:k,pos:f,rotq:g,scl:h,internalId:d.id})}this.reindexParentId();this.restoreBindPose(a);return this};e.prototype.reindexParentId=function(){for(var a=0;a<this.hierarchy.length;a++)for(var b=0;b<this.hierarchy.length;++b)if(this.hierarchy[a].parent==this.hierarchy[b].internalId){this.hierarchy[a].parent=b;break}};e.prototype.restoreBindPose=function(a){var b=a.Objects.subNodes.Pose;if(void 0!==b){for(var c=b.subNodes.PoseNode,b={},d={},e=0;e<c.length;++e){var f=toMat44(c[e].subNodes.Matrix.properties.a.split(",")),
g=toMat44(c[e].subNodes.Matrix.properties.a.split(","));b[c[e].id]=f;d[c[e].id]=g}for(c=0;c<this.hierarchy.length;++c)if(e=this.hierarchy[c],f=e.internalId,void 0!==d[f]){for(var g=new THREE.Vector3(0,0,0),h=new THREE.Quaternion,k=new THREE.Vector3(1,1,1),m,l=a.searchConnectionParent(f),n=0;n<l.length;++n)if(this.isBoneNode(l[n])){m=l[n];break}void 0!==m&&void 0!==b[m]&&(l=new THREE.Matrix4,l.getInverse(d[m]),l.multiply(b[f]),b[f]=l);b[f].decompose(g,h,k);e.pos=[g.x,g.y,g.z];e.rotq=[h.x,h.y,h.z,h.w];
e.scl=[k.x,k.y,k.z]}}};e.prototype.searchRealId=function(a){for(var b=0;b<this.hierarchy.length;b++)if(a==this.hierarchy[b].internalId)return b;return-1};e.prototype.getByInternalId=function(a){for(var b=0;b<this.hierarchy.length;b++)if(a==this.hierarchy[b].internalId)return this.hierarchy[b];return null};e.prototype.isBoneNode=function(a){for(var b=0;b<this.hierarchy.length;++b)if(a===this.hierarchy[b].internalId)return!0;return!1};e.prototype.getBoneIdfromInternalId=function(a,b){void 0===a.__cache_get_boneid_from_internalid&&
(a.__cache_get_boneid_from_internalid=[]);if(void 0!==a.__cache_get_boneid_from_internalid[b])return a.__cache_get_boneid_from_internalid[b];for(var c=0;c<this.hierarchy.length;++c)if(this.hierarchy[c].internalId==b)return a.__cache_get_boneid_from_internalid[b]=c;return-1};d.prototype.parse=function(a){this.node=a;this.name=a.attrName;this.id=a.id;this.vertices=this.getVertices();if(void 0===this.vertices)console.log("FBXLoader: Geometry.parse(): pass"+this.node.id);else return this.indices=this.getPolygonVertexIndices(),
this.uvs=(new g).parse(this.node,this),this.normals=(new f).parse(this.node,this),3<this.getPolygonTopologyMax()&&(this.indices=this.convertPolyIndicesToTri(this.indices,this.getPolygonTopologyArray())),this};d.prototype.getVertices=function(){if(this.node.__cache_vertices)return this.node.__cache_vertices;if(void 0===this.node.subNodes.Vertices)return console.warn("this.node: "+this.node.attrName+"("+this.node.id+") does not have Vertices"),this.node.__cache_vertices=void 0,null;var a=this.node.subNodes.Vertices.properties.a.split(",").map(function(a){return parseFloat(a)});
this.node.__cache_vertices=a;return this.node.__cache_vertices};d.prototype.getPolygonVertexIndices=function(){if(this.node.__cache_indices&&this.node.__cache_poly_topology_max)return this.node.__cache_indices;if(void 0===this.node.subNodes)console.error("this.node.subNodes undefined"),console.log(this.node);else if(void 0===this.node.subNodes.PolygonVertexIndex)console.warn("this.node: "+this.node.attrName+"("+this.node.id+") does not have PolygonVertexIndex "),this.node.__cache_indices=void 0;else{for(var a=
this.node.subNodes.PolygonVertexIndex.properties.a.split(","),b=1,c=null,d=[],e=0;e<a.length;++e){var f=parseInt(a[e]);0>f?(b>c&&(c=b),a[e]=f^-1,d.push(b),b=1):(a[e]=f,b++)}null===c&&(console.warn("FBXLoader: topology N not found: "+this.node.attrName),console.warn(this.node),c=3);this.node.__cache_poly_topology_max=c;this.node.__cache_poly_topology_arr=d;this.node.__cache_indices=a;return this.node.__cache_indices}};d.prototype.getPolygonTopologyMax=function(){if(this.node.__cache_indices&&this.node.__cache_poly_topology_max)return this.node.__cache_poly_topology_max;
this.getPolygonVertexIndices(this.node);return this.node.__cache_poly_topology_max};d.prototype.getPolygonTopologyArray=function(){if(this.node.__cache_indices&&this.node.__cache_poly_topology_max)return this.node.__cache_poly_topology_arr;this.getPolygonVertexIndices(this.node);return this.node.__cache_poly_topology_arr};d.prototype.convertPolyIndicesToTri=function(a,b){for(var c=[],d=0,e=0,f;d<a.length;){f=b[e];for(var g=0;g<=f-3;g++)c.push(a[d]),c.push(a[d+(f-2-g)]),c.push(a[d+(f-1-g)]);e++;d+=
f}return c};d.prototype.addBones=function(a){this.bones=a};g.prototype.getUV=function(a){return this.node&&this.uv&&this.map&&this.ref?this.uv:this._parseText(a)};g.prototype.getMap=function(a){this.node&&this.uv&&this.map&&this.ref||this._parseText(a);return this.map};g.prototype.getRef=function(a){this.node&&this.uv&&this.map&&this.ref||this._parseText(a);return this.ref};g.prototype.getIndex=function(a){this.node&&this.uv&&this.map&&this.ref||this._parseText(a);return this.index};g.prototype.getNode=
function(a){return null!==this.node?this.node:this.node=a.subNodes.LayerElementUV};g.prototype._parseText=function(a){a=this.getNode(a);if(void 0===a)return[];var b=0,c;for(c in a)c.match(/^\d+$/)&&b++;0<b&&(console.warn("multi uv not supported"),a=a[c]);c=a.subNodes.UVIndex.properties.a;var b=a.properties.MappingInformationType,d=a.properties.ReferenceInformationType;this.uv=toFloat(a.subNodes.UV.properties.a.split(","));this.index=toInt(c.split(","));this.map=b;this.ref=d;return this.uv};g.prototype.parse=
function(a,b){this.uvNode=this.getNode(a);this.uv=this.getUV(a);var c=this.getMap(a),d=this.getRef(a),e=this.getIndex(a),f=b.getPolygonTopologyArray();switch(c){case "ByPolygonVertex":switch(d){case "Direct":this.uv=this.parseUV_ByPolygonVertex_Direct(this.uv,e,f,2);break;case "IndexToDirect":this.uv=this.parseUV_ByPolygonVertex_IndexToDirect(this.uv,e)}for(var g=this.uv,h=b.getPolygonVertexIndices(a),c={},d=[],f=e=0;f<h.length;++f)if(!(h[f]in c)){c[h[f]]={};for(var k=0;2>k;++k)c[h[f]][k]=g[2*f+k];
e=e<h[f]?h[f]:e}try{for(f=0;f<=e;f++)for(g=0;2>g;g++)d.push(c[f][g])}catch(A){}this.uv=d;break;case "ByPolygon":switch(d){case "Direct":this.uv=this.parseUV_ByPolygon_Direct();break;case "IndexToDirect":this.uv=this.parseUV_ByPolygon_IndexToDirect()}}return this.uv};g.prototype.parseUV_ByPolygonVertex_Direct=function(a,b,c,d){return parse_Data_ByPolygonVertex_Direct(a,b,c,d)};g.prototype.parseUV_ByPolygonVertex_IndexToDirect=function(a,b){for(var c=[],d=0;d<b.length;++d)for(var e=0;2>e;++e)c.push(a[2*
b[d]+e]);return c};g.prototype.parseUV_ByPolygon_Direct=function(a){console.warn("not implemented");return a};g.prototype.parseUV_ByPolygon_IndexToDirect=function(a){console.warn("not implemented");return a};g.prototype.parseUV_ByVertex_Direct=function(a){console.warn("not implemented");return a};f.prototype.getNormal=function(a){this.node&&this.normal&&this.map&&this.ref||this._parseText(a);return this.normal};f.prototype.getMap=function(a){this.node&&this.normal&&this.map&&this.ref||this._parseText(a);
return this.map};f.prototype.getRef=function(a){this.node&&this.normal&&this.map&&this.ref||this._parseText(a);return this.ref};f.prototype.getNode=function(a){return this.node?this.node:this.node=a.subNodes.LayerElementNormal};f.prototype._parseText=function(a){var b=this.getNode(a);if(void 0===b)console.warn("node: "+a.attrName+"("+a.id+") does not have LayerElementNormal");else{a=b.properties.MappingInformationType;var c=b.properties.ReferenceInformationType;this.normal=toFloat(b.subNodes.Normals.properties.a.split(","));
this.map=a;this.ref=c}};f.prototype.parse=function(a,b){var c=this.getNormal(a);this.getNode(a);var d=this.getMap(a),e=this.getRef(a),f=b.getPolygonVertexIndices(a),g=b.getPolygonTopologyArray(a);switch(d){case "ByPolygonVertex":switch(e){case "Direct":c=this.parseNormal_ByPolygonVertex_Direct(c,f,g,3);break;case "IndexToDirect":c=this.parseNormal_ByPolygonVertex_IndexToDirect()}break;case "ByPolygon":switch(e){case "Direct":c=this.parseNormal_ByPolygon_Direct();break;case "IndexToDirect":c=this.parseNormal_ByPolygon_IndexToDirect()}}return c};
f.prototype.parseNormal_ByPolygonVertex_Direct=function(a,b,c,d){return parse_Data_ByPolygonVertex_Direct(a,b,c,d)};f.prototype.parseNormal_ByPolygonVertex_IndexToDirect=function(a){console.warn("not implemented");return a};f.prototype.parseNormal_ByPolygon_Direct=function(a){console.warn("not implemented");return a};f.prototype.parseNormal_ByPolygon_IndexToDirect=function(a){console.warn("not implemented");return a};f.prototype.parseNormal_ByVertex_Direct=function(a){console.warn("not implemented");
return a};h.prototype.fromNode=function(a){this.internalId=this.id=a.id;this.times=a.subNodes.KeyTime.properties.a;this.values=a.subNodes.KeyValueFloat.properties.a;this.attrFlag=a.subNodes.KeyAttrFlags.properties.a;this.attrData=a.subNodes.KeyAttrDataFloat.properties.a;this.times=toFloat(this.times.split(","));this.values=toFloat(this.values.split(","));this.attrData=toFloat(this.attrData.split(","));this.attrFlag=toInt(this.attrFlag.split(","));this.times=this.times.map(function(a){return a/46186158E3});
return this};h.prototype.getLength=function(){return this.times[this.times.length-1]};k.prototype.fromNode=function(a,b,c){this.id=b.id;this.attr=b.attrName;this.internalId=b.id;if(this.attr.match(/S|R|T/))for(var d in b.properties)d.match(/X/)&&(this.attrX=!0),d.match(/Y/)&&(this.attrY=!0),d.match(/Z/)&&(this.attrZ=!0);else return null;this.containerIndices=a.searchConnectionParent(this.id);this.curveIdx=a.searchConnectionChildren(this.id);for(a=this.containerIndices.length-1;0<=a&&!(b=c.searchRealId(this.containerIndices[a]),
0<=b&&(this.containerBoneId=b,this.containerId=this.containerIndices[a]),0<=b);--a);return this};k.prototype.setCurve=function(a){this.curves.push(a)};l.prototype.parse=function(a,b){var c=a.Objects.subNodes.AnimationCurveNode,d=a.Objects.subNodes.AnimationCurve,e=[],f;for(f in c)if(f.match(/\d+/)){var g=(new k).fromNode(a,c[f],b);e.push(g)}c={};for(g=0;g<e.length;++g)null!==e[g]&&(c[e[g].id]=e[g]);g=[];e=0;for(f in d)if(f.match(/\d+/)){var l=(new h).fromNode(d[f]);g.push(l);var e=l.getLength()?l.getLength():
e,m=a.searchConnectionParent(l.id)[0],p=a.searchConnectionType(l.id,m);p.match(/X/)&&(p="x");p.match(/Y/)&&(p="y");p.match(/Z/)&&(p="z");c[m].curves[p]=l}for(var n in c)d=c[n].containerBoneId,void 0===this.curves[d]&&(this.curves[d]={}),this.curves[d][c[n].attr]=c[n];this.length=e;this.frames=this.length*this.fps;return this};n.prototype.add=function(a){void 0===this.textures&&(this.textures=[]);this.textures.push(a);for(var b=0;b<a.parentIds.length;++b)void 0===this.perGeoMap[a.parentIds[b]]&&(this.perGeoMap[a.parentIds[b]]=
[]),this.perGeoMap[a.parentIds[b]].push(this.textures[this.textures.length-1])};n.prototype.parse=function(a,b){var c=a.Objects.subNodes.Texture,d;for(d in c){var e=(new q).parse(c[d],a);this.add(e)}return this};n.prototype.getById=function(a){return this.perGeoMap[a]};q.prototype.parse=function(a,b){this.id=a.id;this.name=a.attrName;this.fileName=this.parseFileName(a.properties.FileName);this.parentIds=this.searchParents(this.id,b);return this};q.prototype.parseFileName=function(a){if(void 0===a)return"";
var b=a.split(/[\\\/]/);return 0<b.length?b[b.length-1]:a};q.prototype.searchParents=function(a,b){return b.searchConnectionParent(a)};parse_Data_ByPolygonVertex_Direct=function(a,b,c,d){c=[];for(var e=0,f=0;f<b.length;++f){c[b[f]]=[];for(var g=0;g<d;++g)c[b[f]][g]=a[e+g];e+=d}a=[];for(b=0;b<c.length;++b)if(void 0!==c[b])for(e=0;e<d;++e)void 0!==c[b][e]&&a.push(c[b][e]);return a};degToRad=function(a){return a*Math.PI/180};radToDeg=function(a){return 180*a/Math.PI};quatFromVec=function(a,b,c){a=new THREE.Euler(a,
b,c,"ZYX");b=new THREE.Quaternion;b.setFromEuler(a);return b};toInt=function(a){return a.map(function(a){return parseInt(a)})};toFloat=function(a){return a.map(function(a){return parseFloat(a)})};toRad=function(a){return a.map(function(a){return degToRad(a)})};toMat44=function(a){var b=new THREE.Matrix4;b.set(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]);return b}})();
(function(){var a=function(a){THREE.MeshBasicMaterial.call(this);this.depthWrite=this.depthTest=!1;this.side=THREE.FrontSide;this.transparent=!0;this.setValues(a);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(a){a?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};a.prototype=Object.create(THREE.MeshBasicMaterial.prototype);a.prototype.constructor=a;var b=function(a){THREE.LineBasicMaterial.call(this);this.depthWrite=
this.depthTest=!1;this.transparent=!0;this.linewidth=1;this.setValues(a);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(a){a?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};b.prototype=Object.create(THREE.LineBasicMaterial.prototype);b.prototype.constructor=b;var c=new a({visible:!1,transparent:!1});THREE.TransformGizmo=function(){this.init=function(){THREE.Object3D.call(this);this.handles=new THREE.Object3D;
this.pickers=new THREE.Object3D;this.planes=new THREE.Object3D;this.add(this.handles);this.add(this.pickers);this.add(this.planes);var a=new THREE.PlaneBufferGeometry(50,50,2,2),b=new THREE.MeshBasicMaterial({visible:!1,side:THREE.DoubleSide}),a={XY:new THREE.Mesh(a,b),YZ:new THREE.Mesh(a,b),XZ:new THREE.Mesh(a,b),XYZE:new THREE.Mesh(a,b)};this.activePlane=a.XYZE;a.YZ.rotation.set(0,Math.PI/2,0);a.XZ.rotation.set(-Math.PI/2,0,0);for(var c in a)a[c].name=c,this.planes.add(a[c]),this.planes[c]=a[c];
a=function(a,b){for(var d in a)for(c=a[d].length;c--;){var e=a[d][c][0],f=a[d][c][1],g=a[d][c][2];e.name=d;f&&e.position.set(f[0],f[1],f[2]);g&&e.rotation.set(g[0],g[1],g[2]);b.add(e)}};a(this.handleGizmos,this.handles);a(this.pickerGizmos,this.pickers);this.traverse(function(a){if(a instanceof THREE.Mesh){a.updateMatrix();var b=a.geometry.clone();b.applyMatrix(a.matrix);a.geometry=b;a.position.set(0,0,0);a.rotation.set(0,0,0);a.scale.set(1,1,1)}})};this.highlight=function(a){this.traverse(function(b){b.material&&
b.material.highlight&&(b.name===a?b.material.highlight(!0):b.material.highlight(!1))})}};THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype);THREE.TransformGizmo.prototype.constructor=THREE.TransformGizmo;THREE.TransformGizmo.prototype.update=function(a,b){var c=new THREE.Vector3(0,0,0),d=new THREE.Vector3(0,1,0),e=new THREE.Matrix4;this.traverse(function(f){-1!==f.name.search("E")?f.quaternion.setFromRotationMatrix(e.lookAt(b,c,d)):-1===f.name.search("X")&&-1===f.name.search("Y")&&
-1===f.name.search("Z")||f.quaternion.setFromEuler(a)})};THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this);var e=new THREE.Geometry,d=new THREE.Mesh(new THREE.CylinderGeometry(0,.05,.2,12,1,!1));d.position.y=.5;d.updateMatrix();e.merge(d.geometry,d.matrix);d=new THREE.BufferGeometry;d.addAttribute("position",new THREE.Float32Attribute([0,0,0,1,0,0],3));var g=new THREE.BufferGeometry;g.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,1,0],3));var f=new THREE.BufferGeometry;
f.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,0,1],3));this.handleGizmos={X:[[new THREE.Mesh(e,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(d,new b({color:16711680}))]],Y:[[new THREE.Mesh(e,new a({color:65280})),[0,.5,0]],[new THREE.Line(g,new b({color:65280}))]],Z:[[new THREE.Mesh(e,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(f,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new a({color:16777215,opacity:.25})),
[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),c),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,
0,1,4,1,!1),c),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),c),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),c)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),c),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),c),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),c),[.2,0,.2],[-Math.PI/2,0,0]]]};this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld)));
"X"===a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ));"Y"===a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ));"Z"===a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ));"XYZ"===a&&(this.activePlane=this.planes.XYZE);"XY"===a&&(this.activePlane=this.planes.XY);"YZ"===a&&(this.activePlane=this.planes.YZ);"XZ"===a&&(this.activePlane=this.planes.XZ)};this.init()};
THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoTranslate.prototype.constructor=THREE.TransformGizmoTranslate;THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this);var a=function(a,b,c){var d=new THREE.BufferGeometry,e=[];c=c?c:1;for(var f=0;f<=64*c;++f)"x"===b&&e.push(0,Math.cos(f/32*Math.PI)*a,Math.sin(f/32*Math.PI)*a),"y"===b&&e.push(Math.cos(f/32*Math.PI)*a,0,Math.sin(f/32*Math.PI)*a),"z"===b&&e.push(Math.sin(f/32*Math.PI)*
a,Math.cos(f/32*Math.PI)*a,0);d.addAttribute("position",new THREE.Float32Attribute(e,3));return d};this.handleGizmos={X:[[new THREE.Line(new a(1,"x",.5),new b({color:16711680}))]],Y:[[new THREE.Line(new a(1,"y",.5),new b({color:65280}))]],Z:[[new THREE.Line(new a(1,"z",.5),new b({color:255}))]],E:[[new THREE.Line(new a(1.25,"z",1),new b({color:13421568}))]],XYZE:[[new THREE.Line(new a(1,"z",1),new b({color:7895160}))]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,
Math.PI),c),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),c),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),c),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1.25,.12,2,24),c)]],XYZE:[[new THREE.Mesh(new THREE.Geometry)]]};this.setActivePlane=function(a){"E"===a&&(this.activePlane=this.planes.XYZE);"X"===a&&(this.activePlane=this.planes.YZ);"Y"===a&&(this.activePlane=
this.planes.XZ);"Z"===a&&(this.activePlane=this.planes.XY)};this.update=function(a,b){THREE.TransformGizmo.prototype.update.apply(this,arguments);var c=new THREE.Matrix4,d=new THREE.Euler(0,0,1),e=new THREE.Quaternion,g=new THREE.Vector3(1,0,0),n=new THREE.Vector3(0,1,0),q=new THREE.Vector3(0,0,1),m=new THREE.Quaternion,p=new THREE.Quaternion,r=new THREE.Quaternion,t=b.clone();d.copy(this.planes.XY.rotation);e.setFromEuler(d);c.makeRotationFromQuaternion(e).getInverse(c);t.applyMatrix4(c);this.traverse(function(a){e.setFromEuler(d);
"X"===a.name&&(m.setFromAxisAngle(g,Math.atan2(-t.y,t.z)),e.multiplyQuaternions(e,m),a.quaternion.copy(e));"Y"===a.name&&(p.setFromAxisAngle(n,Math.atan2(t.x,t.z)),e.multiplyQuaternions(e,p),a.quaternion.copy(e));"Z"===a.name&&(r.setFromAxisAngle(q,Math.atan2(t.y,t.x)),e.multiplyQuaternions(e,r),a.quaternion.copy(e))})};this.init()};THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoRotate.prototype.constructor=THREE.TransformGizmoRotate;THREE.TransformGizmoScale=
function(){THREE.TransformGizmo.call(this);var e=new THREE.Geometry,d=new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125));d.position.y=.5;d.updateMatrix();e.merge(d.geometry,d.matrix);d=new THREE.BufferGeometry;d.addAttribute("position",new THREE.Float32Attribute([0,0,0,1,0,0],3));var g=new THREE.BufferGeometry;g.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,1,0],3));var f=new THREE.BufferGeometry;f.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,0,1],3));this.handleGizmos=
{X:[[new THREE.Mesh(e,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(d,new b({color:16711680}))]],Y:[[new THREE.Mesh(e,new a({color:65280})),[0,.5,0]],[new THREE.Line(g,new b({color:65280}))]],Z:[[new THREE.Mesh(e,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(f,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),new a({color:16777215,opacity:.25}))]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,
1,4,1,!1),c),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),c),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),c),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.4,.4,.4),c)]]};this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld)));"X"===a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=
this.planes.XZ));"Y"===a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ));"Z"===a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ));"XYZ"===a&&(this.activePlane=this.planes.XYZE)};this.init()};THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoScale.prototype.constructor=THREE.TransformGizmoScale;THREE.TransformControls=function(a,b){function c(a){if(void 0!==
n.object&&!0!==m&&(void 0===a.button||0===a.button)){var b=l(a.changedTouches?a.changedTouches[0]:a,p[q].pickers.children),c=null;b&&(c=b.object.name,a.preventDefault());n.axis!==c&&(n.axis=c,n.update(),n.dispatchEvent(w))}}function d(a){if(void 0!==n.object&&!0!==m&&(void 0===a.button||0===a.button)){var b=a.changedTouches?a.changedTouches[0]:a;if(0===b.button||void 0===b.button){var c=l(b,p[q].pickers.children);c&&(a.preventDefault(),a.stopPropagation(),n.dispatchEvent(v),n.axis=c.object.name,n.update(),
M.copy(ea).sub(U).normalize(),p[q].setActivePlane(n.axis,M),a=l(b,[p[q].activePlane]))&&(V.copy(n.object.position),Y.copy(n.object.scale),W.extractRotation(n.object.matrix),ca.extractRotation(n.object.matrixWorld),ba.extractRotation(n.object.parent.matrixWorld),L.setFromMatrixScale(O.getInverse(n.object.parent.matrixWorld)),B.copy(a.point))}m=!0}}function e(a){if(void 0!==n.object&&null!==n.axis&&!1!==m&&(void 0===a.button||0===a.button)){var b=l(a.changedTouches?a.changedTouches[0]:a,[p[q].activePlane]);
if(!1!==b){a.preventDefault();a.stopPropagation();y.copy(b.point);if("translate"===q){y.sub(B);y.multiply(L);"local"===n.space&&(y.applyMatrix4(O.getInverse(ca)),-1===n.axis.search("X")&&(y.x=0),-1===n.axis.search("Y")&&(y.y=0),-1===n.axis.search("Z")&&(y.z=0),y.applyMatrix4(W),n.object.position.copy(V),n.object.position.add(y),n.body.position.copy(n.object.position));if("world"===n.space||-1!==n.axis.search("XYZ"))-1===n.axis.search("X")&&(y.x=0),-1===n.axis.search("Y")&&(y.y=0),-1===n.axis.search("Z")&&
(y.z=0),y.applyMatrix4(O.getInverse(ba)),n.object.position.copy(V),n.object.position.add(y),n.body.position.copy(n.object.position);null!==n.translationSnap&&("local"===n.space&&n.object.position.applyMatrix4(O.getInverse(ca)),-1!==n.axis.search("X")&&(n.object.position.x=Math.round(n.object.position.x/n.translationSnap)*n.translationSnap),-1!==n.axis.search("Y")&&(n.object.position.y=Math.round(n.object.position.y/n.translationSnap)*n.translationSnap),-1!==n.axis.search("Z")&&(n.object.position.z=
Math.round(n.object.position.z/n.translationSnap)*n.translationSnap),"local"===n.space&&n.object.position.applyMatrix4(ca))}else"scale"===q?(y.sub(B),y.multiply(L),"local"===n.space&&("XYZ"===n.axis?(H=1+y.y/Math.max(Y.x,Y.y,Y.z),n.object.scale.x=Y.x*H,n.object.scale.y=Y.y*H,n.object.scale.z=Y.z*H):(y.applyMatrix4(O.getInverse(ca)),"X"===n.axis&&(n.object.scale.x=Y.x*(1+y.x/Y.x)),"Y"===n.axis&&(n.object.scale.y=Y.y*(1+y.y/Y.y)),"Z"===n.axis&&(n.object.scale.z=Y.z*(1+y.z/Y.z))))):"rotate"===q&&(y.sub(U),
y.multiply(L),I.copy(B).sub(U),I.multiply(L),"E"===n.axis?(y.applyMatrix4(O.getInverse(K)),I.applyMatrix4(O.getInverse(K)),C.set(Math.atan2(y.z,y.y),Math.atan2(y.x,y.z),Math.atan2(y.y,y.x)),F.set(Math.atan2(I.z,I.y),Math.atan2(I.x,I.z),Math.atan2(I.y,I.x)),D.setFromRotationMatrix(O.getInverse(ba)),T.setFromAxisAngle(M,C.z-F.z),Q.setFromRotationMatrix(ca),D.multiplyQuaternions(D,T),D.multiplyQuaternions(D,Q),n.object.quaternion.copy(D),n.body.quaternion.copy(D)):"XYZE"===n.axis?(T.setFromEuler(y.clone().cross(I).normalize()),
D.setFromRotationMatrix(O.getInverse(ba)),R.setFromAxisAngle(T,-y.clone().angleTo(I)),Q.setFromRotationMatrix(ca),D.multiplyQuaternions(D,R),D.multiplyQuaternions(D,Q),n.object.quaternion.copy(D),n.body.quaternion.copy(D)):"local"===n.space?(y.applyMatrix4(O.getInverse(ca)),I.applyMatrix4(O.getInverse(ca)),C.set(Math.atan2(y.z,y.y),Math.atan2(y.x,y.z),Math.atan2(y.y,y.x)),F.set(Math.atan2(I.z,I.y),Math.atan2(I.x,I.z),Math.atan2(I.y,I.x)),Q.setFromRotationMatrix(W),null!==n.rotationSnap?(R.setFromAxisAngle(J,
Math.round((C.x-F.x)/n.rotationSnap)*n.rotationSnap),G.setFromAxisAngle(N,Math.round((C.y-F.y)/n.rotationSnap)*n.rotationSnap),P.setFromAxisAngle(S,Math.round((C.z-F.z)/n.rotationSnap)*n.rotationSnap)):(R.setFromAxisAngle(J,C.x-F.x),G.setFromAxisAngle(N,C.y-F.y),P.setFromAxisAngle(S,C.z-F.z)),"X"===n.axis&&Q.multiplyQuaternions(Q,R),"Y"===n.axis&&Q.multiplyQuaternions(Q,G),"Z"===n.axis&&Q.multiplyQuaternions(Q,P),n.object.quaternion.copy(Q),n.body.quaternion.copy(Q)):"world"===n.space&&(C.set(Math.atan2(y.z,
y.y),Math.atan2(y.x,y.z),Math.atan2(y.y,y.x)),F.set(Math.atan2(I.z,I.y),Math.atan2(I.x,I.z),Math.atan2(I.y,I.x)),D.setFromRotationMatrix(O.getInverse(ba)),null!==n.rotationSnap?(R.setFromAxisAngle(J,Math.round((C.x-F.x)/n.rotationSnap)*n.rotationSnap),G.setFromAxisAngle(N,Math.round((C.y-F.y)/n.rotationSnap)*n.rotationSnap),P.setFromAxisAngle(S,Math.round((C.z-F.z)/n.rotationSnap)*n.rotationSnap)):(R.setFromAxisAngle(J,C.x-F.x),G.setFromAxisAngle(N,C.y-F.y),P.setFromAxisAngle(S,C.z-F.z)),Q.setFromRotationMatrix(ca),
"X"===n.axis&&D.multiplyQuaternions(D,R),"Y"===n.axis&&D.multiplyQuaternions(D,G),"Z"===n.axis&&D.multiplyQuaternions(D,P),D.multiplyQuaternions(D,Q),n.object.quaternion.copy(D),n.body.quaternion.copy(D)));n.update();n.dispatchEvent(w);n.dispatchEvent(z)}}}function k(a){a.preventDefault();if(void 0===a.button||0===a.button)m&&null!==n.axis&&(u.mode=q,n.dispatchEvent(u)),m=!1,a instanceof TouchEvent?(n.axis=null,n.update(),n.dispatchEvent(w)):c(a)}function l(c,d){var e=b.getBoundingClientRect();A.set((c.clientX-
e.left)/e.width*2-1,-((c.clientY-e.top)/e.height*2)+1);x.setFromCamera(A,a);e=x.intersectObjects(d,!0);return e[0]?e[0]:!1}THREE.Object3D.call(this);b=void 0!==b?b:document;this.object=this.body=void 0;this.visible=!1;this.rotationSnap=this.translationSnap=null;this.space="world";this.size=1;this.axis=null;var n=this,q="translate",m=!1,p={translate:new THREE.TransformGizmoTranslate,rotate:new THREE.TransformGizmoRotate,scale:new THREE.TransformGizmoScale},r;for(r in p){var t=p[r];t.visible=r===q;
this.add(t)}var w={type:"change"},v={type:"mouseDown"},u={type:"mouseUp",mode:q},z={type:"objectChange"},x=new THREE.Raycaster,A=new THREE.Vector2,y=new THREE.Vector3,B=new THREE.Vector3,C=new THREE.Vector3,F=new THREE.Vector3,H=1,K=new THREE.Matrix4,M=new THREE.Vector3,O=new THREE.Matrix4,I=new THREE.Vector3,D=new THREE.Quaternion,J=new THREE.Vector3(1,0,0),N=new THREE.Vector3(0,1,0),S=new THREE.Vector3(0,0,1),Q=new THREE.Quaternion,R=new THREE.Quaternion,G=new THREE.Quaternion,P=new THREE.Quaternion,
T=new THREE.Quaternion,V=new THREE.Vector3,Y=new THREE.Vector3,W=new THREE.Matrix4,ba=new THREE.Matrix4,L=new THREE.Vector3,U=new THREE.Vector3,Z=new THREE.Euler,ca=new THREE.Matrix4,ea=new THREE.Vector3,da=new THREE.Euler;b.addEventListener("mousedown",d,!1);b.addEventListener("touchstart",d,!1);b.addEventListener("mousemove",c,!1);b.addEventListener("touchmove",c,!1);b.addEventListener("mousemove",e,!1);b.addEventListener("touchmove",e,!1);b.addEventListener("mouseup",k,!1);b.addEventListener("mouseout",
k,!1);b.addEventListener("touchend",k,!1);b.addEventListener("touchcancel",k,!1);b.addEventListener("touchleave",k,!1);this.dispose=function(){b.removeEventListener("mousedown",d);b.removeEventListener("touchstart",d);b.removeEventListener("mousemove",c);b.removeEventListener("touchmove",c);b.removeEventListener("mousemove",e);b.removeEventListener("touchmove",e);b.removeEventListener("mouseup",k);b.removeEventListener("mouseout",k);b.removeEventListener("touchend",k);b.removeEventListener("touchcancel",
k);b.removeEventListener("touchleave",k)};this.attach=function(a,b){this.body=b;this.object=a;this.visible=!0;this.update()};this.detach=function(){this.object=this.body=void 0;this.visible=!1;this.axis=null};this.getMode=function(){return q};this.setMode=function(a){q=a?a:q;"scale"===q&&(n.space="local");for(var b in p)p[b].visible=b===q;this.update();n.dispatchEvent(w)};this.setTranslationSnap=function(a){n.translationSnap=a};this.setRotationSnap=function(a){n.rotationSnap=a};this.setSize=function(a){n.size=
a;this.update();n.dispatchEvent(w)};this.setSpace=function(a){n.space=a;this.update();n.dispatchEvent(w)};this.update=function(){void 0!==n.object&&(n.object.updateMatrixWorld(),U.setFromMatrixPosition(n.object.matrixWorld),Z.setFromRotationMatrix(O.extractRotation(n.object.matrixWorld)),a.updateMatrixWorld(),ea.setFromMatrixPosition(a.matrixWorld),da.setFromRotationMatrix(O.extractRotation(a.matrixWorld)),H=U.distanceTo(ea)/6*n.size,this.position.copy(U),this.scale.set(H,H,H),M.copy(ea).sub(U).normalize(),
"local"===n.space?p[q].update(Z,M):"world"===n.space&&p[q].update(new THREE.Euler,M),p[q].highlight(n.axis))}};THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype);THREE.TransformControls.prototype.constructor=THREE.TransformControls})();
