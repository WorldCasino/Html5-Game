var s_iOffsetX=0,s_iOffsetY=0,s_fInverseScaling=0;
(function(b){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(b.substr(0,4))})(navigator.userAgent||
navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(b){console.log(b)}function isIOS(){for(var b="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");b.length;)if(navigator.platform===b.pop())return s_bIsIphone=!0;return s_bIsIphone=!1}window.addEventListener("orientationchange",onOrientationChange);
function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}
function getSize(b){var n=b.toLowerCase(),g=window.document,h=g.documentElement;if(void 0===window["inner"+b])b=h["client"+b];else if(window["inner"+b]!=h["client"+b]){var d=g.createElement("body");d.id="vpw-test-b";d.style.cssText="overflow:scroll";var c=g.createElement("div");c.id="vpw-test-d";c.style.cssText="position:absolute;top:-1000px";c.innerHTML="<style>@media("+n+":"+h["client"+b]+"px){body#vpw-test-b div#vpw-test-d{"+n+":7px!important}}</style>";d.appendChild(c);h.insertBefore(d,g.head);
b=7==c["offset"+b]?h["client"+b]:window["inner"+b];h.removeChild(d)}else b=window["inner"+b];return b}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}function getHeightOfIOSToolbars(){var b=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<b?b:0}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var b;b=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?getIOSWindowHeight():getSize("Height");var n=getSize("Width");s_iScaleFactor=Math.min(b/CANVAS_HEIGHT,n/CANVAS_WIDTH);var g=CANVAS_WIDTH*s_iScaleFactor,h=CANVAS_HEIGHT*s_iScaleFactor,d;h<b?(d=b-h,h+=d,g+=CANVAS_WIDTH/CANVAS_HEIGHT*d):g<n&&(d=n-g,g+=d,h+=CANVAS_HEIGHT/CANVAS_WIDTH*d);d=b/2-h/2;var c=n/2-g/2,m=CANVAS_WIDTH/g;if(c*m<-EDGEBOARD_X||d*m<-EDGEBOARD_Y)s_iScaleFactor=Math.min(b/
(CANVAS_HEIGHT-2*EDGEBOARD_Y),n/(CANVAS_WIDTH-2*EDGEBOARD_X)),g=CANVAS_WIDTH*s_iScaleFactor,h=CANVAS_HEIGHT*s_iScaleFactor,d=(b-h)/2,c=(n-g)/2,m=CANVAS_WIDTH/g;s_fInverseScaling=m;s_iOffsetX=-1*c*m;s_iOffsetY=-1*d*m;0<=d&&(s_iOffsetY=0);0<=c&&(s_iOffsetX=0);null!==s_oInterface&&s_oInterface.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oLevelMenu&&s_oLevelMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oHelp&&s_oHelp.refreshButtonPos(s_iOffsetX,
s_iOffsetY);$("#canvas").css("width",g+"px");$("#canvas").css("height",h+"px");0>d?($("#canvas").css("top",d+"px"),s_iCanvasOffsetHeight=d):($("#canvas").css("top","0px"),s_iCanvasOffsetHeight=0);$("#canvas").css("left",c+"px");resizeCanvas3D();s_iCanvasResizeWidth=g;s_iCanvasResizeHeight=h;s_iCanvasOffsetWidth=c}}
function createBitmap(b,n,g){var h=new createjs.Bitmap(b),d=new createjs.Shape;n&&g?d.graphics.beginFill("#fff").drawRect(-n/2,-g/2,n,g):d.graphics.beginFill("#ff0").drawRect(0,0,b.width,b.height);h.hitArea=d;return h}function createSprite(b,n,g,h,d,c){b=null!==n?new createjs.Sprite(b,n):new createjs.Sprite(b);n=new createjs.Shape;n.graphics.beginFill("#000000").drawRect(-g,-h,d,c);b.hitArea=n;return b}
function randomFloatBetween(b,n,g){"undefined"===typeof g&&(g=2);return parseFloat(Math.min(b+Math.random()*(n-b),n).toFixed(g))}function shuffle(b){for(var n=b.length,g,h;0!==n;)h=Math.floor(Math.random()*n),--n,g=b[n],b[n]=b[h],b[h]=g;return b}function formatTime(b){b/=1E3;var n=Math.floor(b/60);b=parseFloat(b-60*n).toFixed(1);var g="",g=10>n?g+("0"+n+":"):g+(n+":");return 10>b?g+("0"+b):g+b}function degreesToRadians(b){return b*Math.PI/180}
function checkRectCollision(b,n){var g,h;g=getBounds(b,.9);h=getBounds(n,.98);return calculateIntersection(g,h)}function calculateIntersection(b,n){var g,h,d,c,m,a,l,p;g=b.x+(d=b.width/2);h=b.y+(c=b.height/2);m=n.x+(a=n.width/2);l=n.y+(p=n.height/2);g=Math.abs(g-m)-(d+a);h=Math.abs(h-l)-(c+p);return 0>g&&0>h?(g=Math.min(Math.min(b.width,n.width),-g),h=Math.min(Math.min(b.height,n.height),-h),{x:Math.max(b.x,n.x),y:Math.max(b.y,n.y),width:g,height:h,rect1:b,rect2:n}):null}
function getBounds(b,n){var g={x:Infinity,y:Infinity,width:0,height:0};if(b instanceof createjs.Container){g.x2=-Infinity;g.y2=-Infinity;var h=b.children,d=h.length,c,m;for(m=0;m<d;m++)c=getBounds(h[m],1),c.x<g.x&&(g.x=c.x),c.y<g.y&&(g.y=c.y),c.x+c.width>g.x2&&(g.x2=c.x+c.width),c.y+c.height>g.y2&&(g.y2=c.y+c.height);Infinity==g.x&&(g.x=0);Infinity==g.y&&(g.y=0);Infinity==g.x2&&(g.x2=0);Infinity==g.y2&&(g.y2=0);g.width=g.x2-g.x;g.height=g.y2-g.y;delete g.x2;delete g.y2}else{var a,l;b instanceof createjs.Bitmap?
(d=b.sourceRect||b.image,m=d.width*n,a=d.height*n):b instanceof createjs.Sprite?b.spriteSheet._frames&&b.spriteSheet._frames[b.currentFrame]&&b.spriteSheet._frames[b.currentFrame].image?(d=b.spriteSheet.getFrame(b.currentFrame),m=d.rect.width,a=d.rect.height,h=d.regX,l=d.regY):(g.x=b.x||0,g.y=b.y||0):(g.x=b.x||0,g.y=b.y||0);h=h||0;m=m||0;l=l||0;a=a||0;g.regX=h;g.regY=l;d=b.localToGlobal(0-h,0-l);c=b.localToGlobal(m-h,a-l);m=b.localToGlobal(m-h,0-l);h=b.localToGlobal(0-h,a-l);g.x=Math.min(Math.min(Math.min(d.x,
c.x),m.x),h.x);g.y=Math.min(Math.min(Math.min(d.y,c.y),m.y),h.y);g.width=Math.max(Math.max(Math.max(d.x,c.x),m.x),h.x)-g.x;g.height=Math.max(Math.max(Math.max(d.y,c.y),m.y),h.y)-g.y}return g}function NoClickDelay(b){this.element=b;window.Touch&&this.element.addEventListener("touchstart",this,!1)}
NoClickDelay.prototype={handleEvent:function(b){switch(b.type){case "touchstart":this.onTouchStart(b);break;case "touchmove":this.onTouchMove(b);break;case "touchend":this.onTouchEnd(b)}},onTouchStart:function(b){b.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(b){this.moved=!0},onTouchEnd:function(b){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){b=document.elementFromPoint(b.changedTouches[0].clientX,b.changedTouches[0].clientY);3==b.nodeType&&(b=b.parentNode);var n=document.createEvent("MouseEvents");n.initEvent("click",!0,!0);b.dispatchEvent(n)}}};
(function(){function b(b){var h={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};b=b||window.event;b.type in h?document.body.className=h[b.type]:(document.body.className=this[n]?"hidden":"visible","hidden"===document.body.className?s_oMain.stopUpdate():s_oMain.startUpdate())}var n="hidden";n in document?document.addEventListener("visibilitychange",b):(n="mozHidden")in document?document.addEventListener("mozvisibilitychange",b):(n="webkitHidden")in
document?document.addEventListener("webkitvisibilitychange",b):(n="msHidden")in document?document.addEventListener("msvisibilitychange",b):"onfocusin"in document?document.onfocusin=document.onfocusout=b:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=b})();function playSound(b,n,g){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?createjs.Sound.play(b,{loop:g,volume:n}):null}function stopSound(b){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||b.stop()}
function setVolume(b,n){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)b.volume=n}function setMute(b,n){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||b.setMute(n)}function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}function getParamValue(b){for(var n=window.location.search.substring(1).split("&"),g=0;g<n.length;g++){var h=n[g].split("=");if(h[0]==b)return h[1]}}
function rotateVector2D(b,n){return{x:n.x*Math.cos(b)+n.y*Math.sin(b),y:n.x*-Math.sin(b)+n.y*Math.cos(b)}}function normalize(b,n){0<n&&(b.x/=n,b.y/=n);return b}function length(b){return Math.sqrt(b.x*b.x+b.y*b.y)}function findNearestIntersectingObject(b,n,g,h){var d=CANVAS_RESIZE_WIDTH+2*OFFSET_WIDTH,c=CANVAS_RESIZE_HEIGHT+2*OFFSET_HEIGHT,m=new THREE.Raycaster,a=new THREE.Vector3;a.x=b/d*2-1;a.y=2*-(n/c)+1;a.z=.5;m.setFromCamera(a,g);b=m.intersectObjects(h,!0);n=!1;0<b.length&&(n=b[0]);return n}
function distance(b,n,g,h){b-=g;n-=h;return Math.sqrt(b*b+n*n)}function distance2(b,n,g,h){b-=g;n-=h;return b*b+n*n}function resizeCanvas3D(){$("canvas").each(function(){"#canvas"!=$(this).attr("id")&&($(this).css("width",$("#canvas").css("width")),$(this).css("height",$("#canvas").css("height")),$(this).css("position",$("#canvas").css("position")),$(this).css("left",$("#canvas").css("left")),$(this).css("top",$("#canvas").css("top")))})}
function createOrthoGraphicCamera(){var b=new THREE.PerspectiveCamera(FOV,CANVAS_WIDTH/CANVAS_HEIGHT,NEAR,FAR);b.rotation.x=Math.PI/180*90;b.position.set(0,0,0);b.updateProjectionMatrix();b.updateMatrixWorld();return b}function rotateVector2D(b,n){return{x:n.x*Math.cos(b)+n.y*Math.sin(b),y:n.x*-Math.sin(b)+n.y*Math.cos(b),z:0}}Math.radians=function(b){return b*Math.PI/180};Math.degrees=function(b){return 180*b/Math.PI};
function distanceV3(b,n,g,h,d,c){b-=h;n-=d;g-=c;return Math.sqrt(b*b+n*n+g*g)}function distanceV2(b,n){var g=b.x-n.x,h=b.y-n.y;return Math.sqrt(g*g+h*h)}function saveItem(b,n){localStorage.setItem(b,n)}function getItem(b){return localStorage.getItem(b)}function clearAllItem(){localStorage.clear()}
function CSpriteLibrary(){var b,n,g,h,d,c;this.init=function(m,a,l){g=n=0;h=m;d=a;c=l;b={}};this.addSprite=function(d,a){b.hasOwnProperty(d)||(b[d]={szPath:a,oSprite:new Image},n++)};this.getSprite=function(d){return b.hasOwnProperty(d)?b[d].oSprite:null};this._onSpritesLoaded=function(){d.call(c)};this._onSpriteLoaded=function(){h.call(c);++g==n&&this._onSpritesLoaded()};this.loadSprites=function(){for(var d in b)b[d].oSprite.oSpriteLibrary=this,b[d].oSprite.onload=function(){this.oSpriteLibrary._onSpriteLoaded()},
b[d].oSprite.src=b[d].szPath};this.getNumSprites=function(){return n}}
var CANVAS_WIDTH=840,CANVAS_HEIGHT=1024,CANVAS_WIDTH_HALF=.5*CANVAS_WIDTH,CANVAS_HEIGHT_HALF=.5*CANVAS_HEIGHT,EDGEBOARD_X=100,EDGEBOARD_Y=90,DISABLE_SOUND_MOBILE=!1,FONT_GAME="wayoshiregular",TEXT_COLOR="#2e618a",TEXT_COLOR_1="#b7e5f8",FPS=30,FPS_TIME=1/FPS,TIME_STEP_BOX2D=1/60,ITINERATION_BOX2D=4,POSITION_ITINERATION_BOX2D=7,FISHES_ANGULAR_IMPULSE=-8.5,FORCE_CRABS_Y=-11,FORCE_CRABS_X_MULTIPLIER=-3.5,URL_LEVELS_SETTINGS="json/levels_settings.json",FISHES_TYPE=2,STATE_LOADING=0,STATE_MENU=1,STATE_HELP=
1,STATE_GAME=3,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,ON_BUT_NO_DOWN=6,ON_BUT_YES_DOWN=7,MAX_BONUS_INSTANCES=1,TIME_INTERVAL_SPAWN_FISH=.7,TWEEN_END_MACTH_Y=.5*CANVAS_HEIGHT,MAX_ASSIGNED_STAR=3,LEVEL_DIAGRAM,WALL=0,ANEMONE=1,CRABS=2,OBSTACLE=3,FLOOR=4,FISH=[5,9],BONUS_HEART=6,LEFT_WALL=7,RIGHT_WALL=8,FISH_IN_ANEMONE_ANIM_POS={x:400,y:565},CRABS_START_POSITION={x:415,y:840},CRABS_REG_OFFSET={x:10,y:30},BUBBLE_RANGE_X={min:5,max:25},BUBBLE_SPEED={min:.5,
max:3},BUBBLE_TIME={min:3E3,max:2E4},BUBBLE_SCALE={min:.5,max:1},BUBBLE_INSTANCE=20,CRABS_X_LIMIT={min:100+CRABS_REG_OFFSET.x,max:720+CRABS_REG_OFFSET.x},FISH_CATEGORY_COLLISION=1,FIELD_CATEGORY_COLLISION=2,CRABS_CATEGORY_COLLISION=3,BONUS_CATEGORY_COLLISION=4,FISH_DAMPING=[.3],FISH_ANGULAR_DAMPING=[.5],WALL_DENSITY=1,WALL_FRICTION=1,WALL_RESTITUTION=.7,WORLD_SCALE=30,STATE_INIT=0,STATE_PLAY=1,STATE_FINISH=2,STATE_PAUSE=3,TEST=!1,FIELD_DIAGRAM=[[{x:0,y:CANVAS_HEIGHT-EDGEBOARD_Y},{x:0,y:-EDGEBOARD_Y},
LEFT_WALL],[{x:0,y:-EDGEBOARD_Y},{x:CANVAS_WIDTH,y:-EDGEBOARD_Y},WALL],[{x:CANVAS_WIDTH,y:-EDGEBOARD_Y},{x:CANVAS_WIDTH,y:CANVAS_HEIGHT-EDGEBOARD_Y},RIGHT_WALL],[{x:CANVAS_WIDTH,y:CANVAS_HEIGHT-EDGEBOARD_Y},{x:0,y:CANVAS_HEIGHT-EDGEBOARD_Y},FLOOR]],SPAWN_FISHES_RANGE_X={min:1.5*EDGEBOARD_X,max:CANVAS_WIDTH-1.5*EDGEBOARD_X},COLLISION_CRABS={x:CRABS_START_POSITION.x,y:CRABS_START_POSITION.y,width:70,height:1,density:1,friction:.5,restitution:0,sensor:!1,info:{type:CRABS},angle:0,catBits:CRABS_CATEGORY_COLLISION,
maskBits:FISH_CATEGORY_COLLISION,groupId:1},COLLISION_ANEMONE={x:403,y:481,width:80,height:30,density:0,friction:0,restitution:0,sensor:!0,info:{type:ANEMONE},angle:0,catBits:CRABS_CATEGORY_COLLISION,maskBits:FISH_CATEGORY_COLLISION,groupId:1},COLLISION_FISH=[{x:0,y:0,width:20,density:.3,friction:.1,restitution:.7,info:{type:FISH[0]},linearDamping:FISH_DAMPING[0],angularDamping:FISH_ANGULAR_DAMPING[0],catBits:FISH_CATEGORY_COLLISION,maskBits:CRABS_CATEGORY_COLLISION,groupId:-1},{x:0,y:0,width:20,
density:.3,friction:.1,restitution:.7,info:{type:FISH[1]},linearDamping:FISH_DAMPING[0],angularDamping:FISH_ANGULAR_DAMPING[0],catBits:FISH_CATEGORY_COLLISION,maskBits:CRABS_CATEGORY_COLLISION,groupId:-1}],OBSTACLES_COLLISION=[{x:13,y:25,width:90,height:22,density:1,friction:.5,restitution:.3,sensor:!1,info:{type:OBSTACLE},angle:45,catBits:CRABS_CATEGORY_COLLISION,maskBits:FISH_CATEGORY_COLLISION,groupId:1},{x:15,y:28,width:174,height:22,density:1,friction:.5,restitution:.4,sensor:!1,info:{type:OBSTACLE},
angle:0,catBits:CRABS_CATEGORY_COLLISION,maskBits:FISH_CATEGORY_COLLISION,groupId:1}],COLLISION_BONUS=[{x:0,y:0,width:20,density:.3,friction:.5,restitution:.7,info:{type:BONUS_HEART},linearDamping:FISH_DAMPING[0],angularDamping:FISH_ANGULAR_DAMPING[0],catBits:CRABS_CATEGORY_COLLISION,maskBits:BONUS_CATEGORY_COLLISION,groupId:1}];TEXT_SELECT_A_LEVEL="SELECT A LEVEL";TEXT_CREDITS_DEVELOPED="Developed by";TEXT_LINK1="www.codethislab.com";TEXT_WIN="YOU WON";TEXT_LOST="YOU LOST";TEXT_SCORE="SCORE";
TEXT_PAUSE="PAUSE";TEXT_LOSE_RESULT="YOU THREW";TEXT_ARE_SURE="ARE YOU SURE?";TEXT_OF="/";TEXT_FISHES="FISHES";TEXT_WIN_RESULT="YOU THREW";TEXT_RESET="ARE YOU SURE? ALL YOUR PREVIOUS SAVINGS WILL BE DELETED!";TEXT_TOTAL_SCORE="TOTAL SCORE";TEXT_LEVEL="LEVEL";TEXT_HELP1_DESKTOP="MOVE THE CRABS WITH THE MOUSE TO BOUNCE THE FISHES";TEXT_HELP1_MOBILE="MOVE THE CRABS WITH THE FINGER TO BOUNCE THE FISHES";TEXT_HELP2="THROW THE FISHES HERE";TEXT_SHARE_IMAGE="200x200.jpg";TEXT_SHARE_TITLE="Congratulations!";
TEXT_SHARE_MSG1="You collected <strong>";TEXT_SHARE_MSG2=" points</strong>!<br><br>Share your score with your friends!";TEXT_SHARE_SHARE1="My score is ";TEXT_SHARE_SHARE2=" points! Can you do better?";
function CPreloader(){var b,n,g,h,d,c,m;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png");s_oSpriteLibrary.loadSprites();m=new createjs.Container;s_oStage.addChild(m)};this.unload=function(){m.removeAllChildren()};this.hide=function(){var a=this;setTimeout(function(){createjs.Tween.get(c).to({alpha:1},500).call(function(){a.unload();
s_oMain.gotoMenu()})},1E3)};this._onImagesLoaded=function(){};this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};this.attachSprites=function(){var a=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));m.addChild(a);a=s_oSpriteLibrary.getSprite("progress_bar");h=createBitmap(a);h.x=CANVAS_WIDTH/2-a.width/2;h.y=CANVAS_HEIGHT-200;m.addChild(h);b=a.width;n=a.height;d=new createjs.Shape;d.graphics.beginFill("rgba(255,255,255,0.01)").drawRect(h.x,h.y,1,n);m.addChild(d);h.mask=
d;g=new createjs.Text("","30px "+FONT_GAME,"#fff");g.x=CANVAS_WIDTH/2;g.y=CANVAS_HEIGHT-200;g.shadow=new createjs.Shadow("#000",2,2,2);g.textBaseline="alphabetic";g.textAlign="center";m.addChild(g);c=new createjs.Shape;c.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);c.alpha=0;m.addChild(c)};this.refreshLoader=function(a){g.text=a+"%";d.graphics.clear();a=Math.floor(a*b/100);d.graphics.beginFill("rgba(255,255,255,0.01)").drawRect(h.x,h.y,a,n)};this._init()}
function CMain(b){var n,g=0,h=0,d=STATE_LOADING,c,m,a;this.initContainer=function(){var a=document.getElementById("canvas");s_oStage=new createjs.Stage(a);createjs.Touch.enable(s_oStage);s_oStage.preventSelection=!1;a.opacity=.5;s_bMobile=jQuery.browser.mobile;!1===s_bMobile&&(s_oStage.enableMouseOver(20),$("body").on("contextmenu","#canvas",function(a){return!1}));s_iPrevTime=(new Date).getTime();createjs.Ticker.addEventListener("tick",this._update);createjs.Ticker.setFPS(30);navigator.userAgent.match(/Windows Phone/i)&&
(DISABLE_SOUND_MOBILE=!0);s_oSpriteLibrary=new CSpriteLibrary;m=new CPreloader;n=!0};this.soundLoaded=function(){g++;m.refreshLoader(Math.floor(g/h*100));if(g===h){m.unload();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)s_oSoundTrack=createjs.Sound.play("soundtrack",{loop:-1});this.gotoMenu()}};this._initSounds=function(){createjs.Sound.initializeDefaultPlugins()&&(0<navigator.userAgent.indexOf("Opera")||0<navigator.userAgent.indexOf("OPR")?(createjs.Sound.alternateExtensions=["mp3"],createjs.Sound.addEventListener("fileload",
createjs.proxy(this.soundLoaded,this)),createjs.Sound.registerSound("./sounds/click.ogg","click"),createjs.Sound.registerSound("./sounds/soundtrack.ogg","soundtrack"),createjs.Sound.registerSound("./sounds/basket.ogg","basket"),createjs.Sound.registerSound("./sounds/bounce.ogg","bounce"),createjs.Sound.registerSound("./sounds/game_over.ogg","game_over"),createjs.Sound.registerSound("./sounds/lose_life.ogg","lose_life"),createjs.Sound.registerSound("./sounds/win.ogg","win")):(createjs.Sound.alternateExtensions=
["ogg"],createjs.Sound.addEventListener("fileload",createjs.proxy(this.soundLoaded,this)),createjs.Sound.registerSound("./sounds/click.mp3","click"),createjs.Sound.registerSound("./sounds/soundtrack.mp3","soundtrack"),createjs.Sound.registerSound("./sounds/basket.mp3","basket"),createjs.Sound.registerSound("./sounds/bounce.mp3","bounce"),createjs.Sound.registerSound("./sounds/game_over.mp3","game_over"),createjs.Sound.registerSound("./sounds/lose_life.mp3","lose_life"),createjs.Sound.registerSound("./sounds/win.mp3",
"win")),h+=7)};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("but_play","./sprites/but_play.png");s_oSpriteLibrary.addSprite("but_info","./sprites/but_info.png");s_oSpriteLibrary.addSprite("but_pause","./sprites/but_pause.png");s_oSpriteLibrary.addSprite("but_yes","./sprites/but_yes.png");s_oSpriteLibrary.addSprite("but_no","./sprites/but_no.png");s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png");s_oSpriteLibrary.addSprite("bg_menu",
"./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("bg_game","./sprites/bg_game.jpg");s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png");s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png");s_oSpriteLibrary.addSprite("but_home","./sprites/but_home.png");s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png");s_oSpriteLibrary.addSprite("but_level","./sprites/but_level.png");s_oSpriteLibrary.addSprite("but_continue","./sprites/but_continue.png");s_oSpriteLibrary.addSprite("but_continue_big",
"./sprites/but_continue_big.png");s_oSpriteLibrary.addSprite("arrow_right","./sprites/arrow_right.png");s_oSpriteLibrary.addSprite("arrow_left","./sprites/arrow_left.png");s_oSpriteLibrary.addSprite("keyboard","./sprites/keyboard.png");s_oSpriteLibrary.addSprite("score_board","./sprites/score_board.png");s_oSpriteLibrary.addSprite("crabs","./sprites/crabs.png");s_oSpriteLibrary.addSprite("energy_bar","./sprites/energy_bar.png");s_oSpriteLibrary.addSprite("fishes_bar","./sprites/fishes_bar.png");s_oSpriteLibrary.addSprite("obstacle_0",
"./sprites/obstacle_0.png");s_oSpriteLibrary.addSprite("obstacle_1","./sprites/obstacle_1.png");s_oSpriteLibrary.addSprite("logo_ctl","./sprites/logo_ctl.png");s_oSpriteLibrary.addSprite("anemone_back","./sprites/anemone_back.png");s_oSpriteLibrary.addSprite("anemone_front","./sprites/anemone_front.png");s_oSpriteLibrary.addSprite("bonus_0","./sprites/bonus_0.png");s_oSpriteLibrary.addSprite("heart","./sprites/heart.png");s_oSpriteLibrary.addSprite("edge","./sprites/edge.png");s_oSpriteLibrary.addSprite("arrow",
"./sprites/arrow.png");s_oSpriteLibrary.addSprite("fade_help_0","./sprites/fade_help_0.png");s_oSpriteLibrary.addSprite("fade_help_1","./sprites/fade_help_1.png");s_oSpriteLibrary.addSprite("bubble_anemone","./sprites/bubble_anemone.png");s_oSpriteLibrary.addSprite("bubble","./sprites/bubble.png");for(var a=0;a<FISHES_TYPE;a++)s_oSpriteLibrary.addSprite("fish_"+a,"./sprites/fish_"+a+".png");h+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=function(){g++;m.refreshLoader(Math.floor(g/
h*100));if(g===h){m.unload();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)s_oSoundTrack=createjs.Sound.play("soundtrack",{loop:-1});this.gotoMenu()}};this._onAllImagesLoaded=function(){};this.onAllPreloaderImagesLoaded=function(){this._loadImages()};this.preloaderReady=function(){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)this._initSounds(),s_oSoundTrack=createjs.Sound.play("soundtrack",{loop:-1});this.loadJSON();this._loadImages();n=!0};this.gotoMenu=function(){new CMenu;d=STATE_MENU};this.gotoLevelMenu=
function(){new CLevelMenu(s_aLevelsDiagram.length);d=STATE_MENU};this.gotoGame=function(l){a=new CGame(c,l);d=STATE_GAME};this.gotoHelp=function(){new CHelp;d=STATE_HELP};this.loadJSON=function(){jQuery.getJSON(URL_LEVELS_SETTINGS,this.onLoadedJSON)};this.onLoadedJSON=function(a){s_aLevelsDiagram=a};this.stopUpdate=function(){n=!1;createjs.Ticker.paused=!0;$("#block_game").css("display","block");createjs.Sound.setMute(!0)};this.startUpdate=function(){s_iPrevTime=(new Date).getTime();n=!0;createjs.Ticker.paused=
!1;$("#block_game").css("display","none");s_bAudioActive&&createjs.Sound.setMute(!1)};this._update=function(l){if(!1!==n){var c=(new Date).getTime();s_iTimeElaps=c-s_iPrevTime;s_iCntTime+=s_iTimeElaps;s_iCntFps++;s_iPrevTime=c;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);d===STATE_GAME&&a.update();s_oStage.update(l)}};s_oMain=this;c=b;this.initContainer()}
var s_bMobile,s_bAudioActive=!0,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_oPhysicsController,s_iAdsLevel=1,s_aLevelsDiagram,s_iLastLevel=1,s_aScores;s_aScores=[];var s_oDrawLayer,s_oStage,s_oMain,s_oSpriteLibrary,s_oSoundTrack;
function CTextButton(b,n,g,h,d,c,m){var a,l,p;this._init=function(d,c,h,b,g,n,k){a=[];l=[];var A=createBitmap(h),B=Math.ceil(k/20),m=new createjs.Text(b,"bold "+k+"px "+g,"#000000");m.textAlign="center";m.textBaseline="alphabetic";var H=m.getBounds();m.x=h.width/2+B;m.y=Math.floor(h.height/2)+H.height/3+B;b=new createjs.Text(b,"bold "+k+"px "+g,n);b.textAlign="center";b.textBaseline="alphabetic";H=b.getBounds();b.x=h.width/2;b.y=Math.floor(h.height/2)+H.height/3;p=new createjs.Container;p.x=d;p.y=
c;p.regX=h.width/2;p.regY=h.height/2;p.addChild(A,m,b);s_bMobile||(p.cursor="pointer");s_oStage.addChild(p);this._initListener()};this.unload=function(){p.off("mousedown");p.off("pressup");s_oStage.removeChild(p)};this.setVisible=function(a){p.visible=a};this._initListener=function(){oParent=this;p.on("mousedown",this.buttonDown);p.on("pressup",this.buttonRelease)};this.addEventListener=function(d,c,h){a[d]=c;l[d]=h};this.buttonRelease=function(){p.scaleX=1;p.scaleY=1;playSound("click",1,0);a[ON_MOUSE_UP]&&
a[ON_MOUSE_UP].call(l[ON_MOUSE_UP])};this.buttonDown=function(){p.scaleX=.9;p.scaleY=.9;a[ON_MOUSE_DOWN]&&a[ON_MOUSE_DOWN].call(l[ON_MOUSE_DOWN])};this.setPosition=function(a,d){p.x=a;p.y=d};this.setX=function(a){p.x=a};this.setY=function(a){p.y=a};this.getButtonImage=function(){return p};this.getX=function(){return p.x};this.getY=function(){return p.y};this._init(b,n,g,h,d,c,m);return this}
function CToggle(b,n,g,h,d){var c,m,a,l,p;this._init=function(d,h,b,g,n){p=void 0!==n?n:s_oStage;m=[];a=[];n=new createjs.SpriteSheet({images:[b],frames:{width:b.width/2,height:b.height,regX:b.width/2/2,regY:b.height/2},animations:{state_true:[0],state_false:[1]}});c=g;l=createSprite(n,"state_"+c,b.width/2/2,b.height/2,b.width/2,b.height);l.x=d;l.y=h;l.stop();s_bMobile||(l.cursor="pointer");p.addChild(l);this._initListener()};this.unload=function(){l.off("mousedown",this.buttonDown);l.off("pressup",
this.buttonRelease);p.removeChild(l)};this._initListener=function(){l.on("mousedown",this.buttonDown);l.on("pressup",this.buttonRelease)};this.addEventListener=function(d,l,c){m[d]=l;a[d]=c};this.setCursorType=function(a){l.cursor=a};this.setActive=function(a){c=a;l.gotoAndStop("state_"+c)};this.buttonRelease=function(){l.scaleX=1;l.scaleY=1;playSound("click",1,0);c=!c;l.gotoAndStop("state_"+c);m[ON_MOUSE_UP]&&m[ON_MOUSE_UP].call(a[ON_MOUSE_UP],c)};this.buttonDown=function(){l.scaleX=.9;l.scaleY=
.9;m[ON_MOUSE_DOWN]&&m[ON_MOUSE_DOWN].call(a[ON_MOUSE_DOWN])};this.setPosition=function(a,d){l.x=a;l.y=d};this._init(b,n,g,h,d)}
function CGfxButton(b,n,g,h){var d,c,m,a,l,p,x,y=!1,w;this._init=function(a,b,h){d=[];c=[];m=createBitmap(h);m.x=a;m.y=b;p=l=1;m.regX=h.width/2;m.regY=h.height/2;s_bMobile||(m.cursor="pointer");w.addChild(m);this._initListener()};this.unload=function(){m.off("mousedown",this.buttonDown);m.off("pressup",this.buttonRelease);w.removeChild(m)};this.setVisible=function(a){m.visible=a};this.setCursorType=function(a){m.cursor=a};this._initListener=function(){m.on("mousedown",this.buttonDown);m.on("pressup",
this.buttonRelease)};this.addEventListener=function(a,l,h){d[a]=l;c[a]=h};this.addEventListenerWithParams=function(l,h,b,k){d[l]=h;c[l]=b;a=k};this.buttonRelease=function(){y||(m.scaleX=l,m.scaleY=p,playSound("click",1,0),d[ON_MOUSE_UP]&&d[ON_MOUSE_UP].call(c[ON_MOUSE_UP],a))};this.buttonDown=function(){y||(m.scaleX=.9*l,m.scaleY=.9*p,d[ON_MOUSE_DOWN]&&d[ON_MOUSE_DOWN].call(c[ON_MOUSE_DOWN],a))};this.rotation=function(a){m.rotation=a};this.getButton=function(){return m};this.setPosition=function(a,
d){m.x=a;m.y=d};this.setX=function(a){m.x=a};this.setY=function(a){m.y=a};this.getButtonImage=function(){return m};this.block=function(a){y=a;m.scaleX=l;m.scaleY=p};this.setScaleX=function(a){l=m.scaleX=a};this.setScale=function(a){m.scaleX=a;p=l=m.scaleY=a};this.getX=function(){return m.x};this.getY=function(){return m.y};this.pulseAnimation=function(){createjs.Tween.get(m).to({scaleX:.9*l,scaleY:.9*p},850,createjs.Ease.quadOut).to({scaleX:l,scaleY:p},650,createjs.Ease.quadIn).call(function(){x.pulseAnimation()})};
this.trebleAnimation=function(){createjs.Tween.get(m).to({rotation:5},75,createjs.Ease.quadOut).to({rotation:-5},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750).call(function(){x.trebleAnimation()})};this.removeAllTweens=function(){createjs.Tween.removeTweens(m)};w=h;this._init(b,n,g);x=this;return this}
function CMenu(){var b,n,g,h,d,c,m,a,l,p,x,y,w=null;this._init=function(){m=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(m);var t=s_oSpriteLibrary.getSprite("but_play");g=CANVAS_WIDTH/2;h=CANVAS_HEIGHT-300;a=new CGfxButton(g,h,t,s_oStage);a.addEventListener(ON_MOUSE_UP,this._onButPlayRelease,this);if(null!==getItem("LevelReachedFish")){s_iLastLevel=getItem("LevelReachedFish");s_aScores=JSON.parse(getItem("ScoresFish"));a.setPosition(CANVAS_WIDTH/2-200,CANVAS_HEIGHT-300);var w=
s_oSpriteLibrary.getSprite("but_continue_big");p=new CGfxButton(CANVAS_WIDTH/2+200,CANVAS_HEIGHT-300,w,s_oStage);p.addEventListener(ON_MOUSE_UP,this._onButContinueRelease,this);p.pulseAnimation()}else a.setPosition(CANVAS_WIDTH/2,584),a.pulseAnimation(),this.resetArrayScores();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)t=s_oSpriteLibrary.getSprite("audio_icon"),d=CANVAS_WIDTH-t.height/2-10,c=t.height/2+10,y=new CToggle(d,c,t,s_bAudioActive,s_oStage),y.addEventListener(ON_MOUSE_UP,this._onAudioToggle,
this);w=s_oSpriteLibrary.getSprite("but_info");b=t.height/2+10;n=t.height/2+10;l=new CGfxButton(b,n,w,s_oStage);l.addEventListener(ON_MOUSE_UP,this._onButInfoRelease,this);x=new createjs.Shape;x.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(x);createjs.Tween.get(x).to({alpha:0},1E3).call(function(){x.visible=!1});this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.refreshButtonPos=function(a,h){l.setPosition(b+a,n+h);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||
y.setPosition(d-a,h+c)};this.unload=function(){a.unload();a=null;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)y.unload(),y=null;s_oStage.removeAllChildren();s_oMenu=null};this._onAudioToggle=function(){createjs.Sound.setMute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onButInfoRelease=function(){new CCreditsPanel};this._onButPlayRelease=function(){null===getItem("LevelReachedFish")?(this.unload(),playSound("click",1,0),s_oMain.gotoLevelMenu()):null===w&&(w=new CConfirmPanel(TEXT_RESET,0),
w.addEventListener(ON_BUT_NO_DOWN,this._onButNo,this),w.addEventListener(ON_BUT_YES_DOWN,this._onButYes,this))};this._onButContinueRelease=function(){this.unload();playSound("click",1,0);s_oMain.gotoLevelMenu()};this._onButNo=function(){w.unload();w=null};this._onButYes=function(){clearAllItem();this.unload();s_iLastLevel=1;this.resetArrayScores();s_oMain.gotoLevelMenu()};this.resetArrayScores=function(){s_aScores=[];for(var a=0;a<s_aLevelsDiagram.length;a++)s_aScores[a]=0};s_oMenu=this;this._init()}
var s_oMenu=null;
function CGame(b,n){var g,h,d=!0,c,m,a,l,p,x,y,w,t,E,C,k,A,B=null,F,H,K,G,P,J,D,O,M,f=null,r,z,q,I,N;this._init=function(){$(s_oMain).trigger("start_session");g=CRABS_X_LIMIT.min;h=CRABS_X_LIMIT.max;d=!0;w=STATE_PLAY;t=y=x=l=m=c=0;p=LIVES;a=n;D=[];J=[];M=[];for(var f=0;f<a;f++)c+=s_aScores[f];C=createBitmap(s_oSpriteLibrary.getSprite("bg_game"));s_oStage.addChild(C);H=new createjs.Container;s_oStage.addChild(H);s_oPhysicsController=new CPhysicsController;k=new CPhysicsObject;k.createAContactListener();this._createAnemone();
this._createBubbleAnemone();this._createBubbleInstance();this._createCrabs();this.createField();this.createLevel();E=new CInterface(n);E.refreshLives(p);E.refreshTarget(x,y);E.refreshLevel(a+1);E.refreshScore(c);0===a?(E.createInteractiveHelp(),d=!1,w=STATE_HELP):this.activeEventListeners()};this._createCrabs=function(){var f=s_oSpriteLibrary.getSprite("crabs");F=new CCrabs(CRABS_START_POSITION.x,CRABS_START_POSITION.y,f,k.addRectangle(COLLISION_CRABS),H)};this._createBubbleAnemone=function(){P=new CAnimBubble(410,
280,s_oSpriteLibrary.getSprite("bubble_anemone"),H)};this._createAnemone=function(){A=new CAnemone(422,635,k.addRectangle(COLLISION_ANEMONE),H)};this._createBubbleInstance=function(){q=[];for(var f=s_oSpriteLibrary.getSprite("bubble"),e=0;e<BUBBLE_INSTANCE;e++)q.push(new CBubble(f,H));q[0].reset(!0)};this._createRandomOpponentTeamOrder=function(){for(var f=[],e=0,u=0;u<TOT_TEAM;u++)void 0!==u&&(f[e]=u,e++);return f=shuffle(f)};this.createField=function(){for(var f=FIELD_DIAGRAM,e=s_oSpriteLibrary.getSprite("edge"),
u=0;u<f.length;u++){var a=f[u][0],Q=f[u][1],R=f[u][2];J[u]=k.addLine(0,0,a,Q,0,WALL_DENSITY,WALL_FRICTION,WALL_RESTITUTION,R);R===RIGHT_WALL?K=new CSideWall(a.x,0,e,R,u,J[u],-e.width,s_oStage):R===LEFT_WALL&&(G=new CSideWall(Q.x,0,e,R,u,J[u],e.width,s_oStage),G.setScaleX(-1))}};this.refreshPositionSidesWalls=function(f){var e=K.getStartPos(),u=G.getStartPos();K.setPosition(e.x-f,e.y);K.setPositionPhysics(-f,e.y);G.setPosition(u.x+f,u.y);G.setPositionPhysics(f,u.y)};this.refreshLimitCrabsX=function(f){g=
CRABS_X_LIMIT.min+f;h=CRABS_X_LIMIT.max-f};this.createLevel=function(){O=[];for(var f=s_aLevelsDiagram[a].fish_instance_level,e=s_aLevelsDiagram[a].fish_spawn.length,u=0,r=0;r<e;r++){var Q=s_oSpriteLibrary.getSprite("fish_"+r);M[r]=.5*-Q.width;for(var R=0;R<f;R++)D[u]=new CFish(-Q.width,R*Q.height,Q,r,u,k.addCircle(COLLISION_FISH[r],u),H),u++;for(Q=0;Q<s_aLevelsDiagram[a].fish_spawn[r].occurance;Q++)O.push(r)}I=TIME_INTERVAL_SPAWN_FISH;y=s_aLevelsDiagram[a].saved_fishes_target;0<s_aLevelsDiagram[a].object.length&&
this.createObstacle(s_aLevelsDiagram[a].object.length);this.createBonus()};this.createObstacle=function(r){f=[];for(var e=0;e<r;e++){var u=s_aLevelsDiagram[a].object[e],q=s_oSpriteLibrary.getSprite("obstacle_"+u.type);f.push(new CObstacle(u.x,u.y,q,u.type,e,u.angle,k.addObstacle(u.x,u.y,u.angle,OBSTACLES_COLLISION[u.type]),H))}};this.createBonus=function(){r=[];z=[];for(var f=s_aLevelsDiagram[a].bonus_spawn,e=0;e<f.length;e++){var u=s_oSpriteLibrary.getSprite("bonus_"+f[e].type);r.push(new CBonus(-u.width,
e*u.height,u,f[e].type,e,k.addCircle(COLLISION_BONUS[f[e].type],e),H));for(u=0;u<f[e].occurance;u++)z.push(e)}N=this.timeSpawn(s_aLevelsDiagram[a].bonus_spawn_time)};this.unload=function(){d=!1;E.unload();this.destroyPhysicsEngine();s_oStage.removeAllChildren();createjs.Tween.removeAllTweens();!1===s_bMobile&&(document.onkeydown=null,document.onkeyup=null)};this.destroyPhysicsEngine=function(){s_oPhysicsController.destroyAllBody();s_oPhysicsController.destroyWorld();s_oPhysicsController=null};this.onExit=
function(){this.unload();this.deactiveEventListeners();$(s_oMain).trigger("show_interlevel_ad");$(s_oMain).trigger("end_session");setVolume(s_oSoundTrack,1);s_oMain.gotoMenu()};this._onExitHelp=function(){E.unloadHelp();this.unpause(!0);w=STATE_PLAY;this.activeEventListeners()};this.unpause=function(f){d=f;!0===f?this.activeEventListeners():this.deactiveEventListeners()};this.nextLevel=function(){a++;this.unloadLevel();this.createLevel();this.resetBubble();E.refreshLevel(a+1);$(s_oMain).trigger("start_level",
a)};this.resetBubble=function(){for(var f=0;f<q.length;f++)q[f].reset()};this.unloadLevel=function(){for(var a=0;a<D.length;a++)s_oPhysicsController.destroyBody(D[a].getPhysics()),D[a].unload();if(null!==f)for(a=0;a<f.length;a++)s_oPhysicsController.destroyBody(f[a].getPhysics()),f[a].unload();for(a=0;a<r.length;a++)s_oPhysicsController.destroyBody(r[a].getPhysics()),r[a].unload();D=[];r=[];f=null};this.crabsTouchFish=function(f,e,u){D[u].setTouchCrabs(!0);this.applyImpulseToFish(f,e);playSound("bounce",
1,0)};this.applyImpulseToFish=function(f,e){0<e.y||(s_oPhysicsController.setElementLinearVelocity(f,{x:0,y:0}),s_oPhysicsController.setElementAngularVelocity(f,e.x*FISHES_ANGULAR_IMPULSE),s_oPhysicsController.applyImpulse(f,{x:e.x*FORCE_CRABS_X_MULTIPLIER,y:FORCE_CRABS_Y}))};this.fishOnFloor=function(f){this.addLife(-1);s_oPhysicsController.setElementLinearVelocity(D[f].getPhysics(),{x:0,y:0});D[f].animOnFloor();2>l&&(I=TIME_INTERVAL_SPAWN_FISH);playSound("lose_life",1,0)};this.bonusDisapper=function(f){r[f].animDisappear()};
this.bonusHeart=function(){this.addLife(1)};this.addLife=function(f){p+=f;1>p&&this.lose();var e=!1;0>f&&(e=!0);E.refreshLives(p,e)};this.lose=function(){E.createLosePanel(x,y);w=STATE_FINISH;this.deactiveEventListeners();playSound("game_over",1,0);$(s_oMain).trigger("end_level",a)};this.onContinue=function(){this.nextLevel();this.resetValues();this.activeEventListeners();w=STATE_PLAY};this.won=function(){var f=!1;a>=s_aLevelsDiagram.length-1&&(f=!0);c+=m;E.createWinPanel(x,y,c,f);this.saveProgress();
w=STATE_FINISH;this.deactiveEventListeners();playSound("win",1,0);$(s_oMain).trigger("end_level",a)};this.saveProgress=function(){s_iLastLevel<a+2&&(s_iLastLevel=a+2);m>s_aScores[a]&&(s_aScores[a]=m);saveItem("LevelReachedFish",s_iLastLevel);saveItem("ScoresFish",JSON.stringify(s_aScores))};this.fishInAnemone=function(f){if(D[f].getTouchCrabs()&&!(0>s_oPhysicsController.getElementVelocity(D[f].getPhysics()).y)){playSound("basket",1,0);A.animAnemone();P.startAnimation();this.addScore(FISH_SCORE[D[f].getType()]);
D[f].setTouchCrabs(!1);var e=A.getChildIndexFront();D[f].spriteFollowPhysics(!1);D[f].setChildIndex(e);D[f].animInAnemone();2>l&&(I=TIME_INTERVAL_SPAWN_FISH);x++;x===y&&this.won();playSound("basket",1,0);E.refreshTarget(x,y)}};this.cachedFish=function(f){D[f].setCache(!0);D[f].resetPos();D[f].setAlpha(1);D[f].setTouchCrabs(!1);l--};this.cachedBonus=function(f){r[f].setCache(!0);r[f].resetPos();r[f].setAlpha(1);t--};this.activeEventListeners=function(){null===B&&(B=s_oStage.on("stagemousemove",this.onCrabsMove))};
this.deactiveEventListeners=function(){s_oStage.off("stagemousemove",B);B=null};this.addScore=function(f){var e=c;m+=f;e+=m;E.refreshScore(e)};this.cachedAllFish=function(){for(var f=0;f<D.length;f++)this.cachedFish(f)};this.cachedAllBonus=function(){for(var f=0;f<r.length;f++)this.cachedBonus(f)};this.restartLevel=function(){this.resetScene();this.resetBubble();this.activeEventListeners();p=LIVES;E.refreshLives(p);$(s_oMain).trigger("restart_level",a);w=STATE_PLAY};this.resetScene=function(){this.cachedAllFish();
this.cachedAllBonus();this.resetValues()};this.resetValues=function(){t=l=x=0;I=TIME_INTERVAL_SPAWN_FISH;m=0;E.refreshScore(c);E.refreshTarget(x,y)};this._onEnd=function(){this.onExit()};this.onCrabsMove=function(){if(s_oStage.mouseX<=g)F.x=g;else if(s_oStage.mouseX>=h)F.x=h;else{var f=F.getX();F.setPosition(s_oStage.mouseX,F.getY());f=Math.abs(f-F.getX());F.moveAnimation(f)}};this.moveFishes=function(){for(var f=0;f<D.length;f++)D[f].isCached()||D[f].update()};this.moveBonus=function(){for(var f=
0;f<r.length;f++)r[f].isCached()||r[f].update()};this.getRandomType=function(f){return f[Math.floor(Math.random()*f.length)]};this.spawnFishes=function(){if(!(l>=s_aLevelsDiagram[a].fish_instance_level||x>=s_aLevelsDiagram[a].saved_fishes_target))if(0<I)I-=FPS_TIME;else for(var f=this.getRandomType(O),e=0;e<D.length;e++)if(D[e].getType()===f&&D[e].isCached()&&null===D[e].isAnim()){this.spawnFishInstance(e);I=this.timeSpawn(s_aLevelsDiagram[a].fish_spawn[f].time);l++;break}};this.spawnFishInstance=
function(f){var e=Math.random()*(SPAWN_FISHES_RANGE_X.max-SPAWN_FISHES_RANGE_X.min)+SPAWN_FISHES_RANGE_X.min,u=F.getChildIndex()+1;D[f].setChildIndex(u);D[f].setPosition(e,M[0]);D[f].setCache(!1)};this.timeSpawn=function(f){return Math.random()*(f.max-f.min)+f.min};this.spawnBonus=function(){if(!(t>=MAX_BONUS_INSTANCES))if(0<N)N-=FPS_TIME;else for(var f=this.getRandomType(z),e=0;e<r.length;e++)if(r[e].getType()===f&&r[e].isCached()){this.spawnBonusInstance(e);N=this.timeSpawn(s_aLevelsDiagram[a].bonus_spawn_time);
t++;break}};this.spawnBonusInstance=function(f){r[f].setPosition(Math.random()*(SPAWN_FISHES_RANGE_X.max-SPAWN_FISHES_RANGE_X.min)+SPAWN_FISHES_RANGE_X.min,M[0]);r[f].setCache(!1)};this.manageBubble=function(){for(var f=0;f<q.length;f++)q[f].update()};this._updatePlay=function(){d&&(this.moveFishes(),this.moveBonus(),this.spawnFishes(),this.spawnBonus(),this.manageBubble(),s_oPhysicsController.update())};this.update=function(){switch(w){case STATE_PLAY:this._updatePlay()}};s_oGame=this;FISH_SCORE=
b.fish_score;LIVES=b.lives;BONUS_SCORE=b.bonus_scores;NUM_LEVEL_FOR_ADS=b.num_levels_for_ads;this._init()}var s_oGame;
function CInterface(b){var n,g,h,d,c,m,a,l,p,x,y,w,t,E,C,k,A,B=null,F;this._init=function(){var b=s_oSpriteLibrary.getSprite("score_board"),B=.5*b.width+10;E=new CScoreBoard(b,B,.5*b.height+11,"left",TEXT_SCORE+": 0",0);b=s_oSpriteLibrary.getSprite("energy_bar");B=B+B+.5*b.width;C=new CLifeBoard(b,B,.5*b.height+11);b=s_oSpriteLibrary.getSprite("fishes_bar");k=new CScoreBoard(b,B+b.width,.5*b.height+11,"center","10/10",18);A=new createjs.Text(TEXT_LEVEL+" 99","bold 50px "+FONT_GAME,TEXT_COLOR);A.x=
CANVAS_WIDTH/2;A.y=CANVAS_HEIGHT-A.getBounds().height-20;A.textAlign="center";c=A.y;s_oStage.addChild(A);B=s_oSpriteLibrary.getSprite("but_exit");h=CANVAS_WIDTH-B.height/2-10;d=B.height/2+10;l=new CGfxButton(h,d,B,s_oStage);l.addEventListener(ON_MOUSE_UP,this._onExit,this);B=s_oSpriteLibrary.getSprite("but_pause");n=h-B.height-10;g=d;p=new CGfxButton(n,g,B,s_oStage);p.addEventListener(ON_MOUSE_UP,this._onPause,this);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)B=s_oSpriteLibrary.getSprite("audio_icon"),
m=n-B.height-10,a=d,x=new CToggle(m,a,B,s_bAudioActive,s_oStage),x.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.setTeamsFlagScoreBoard=function(a,k){E.changeTeamsFlag(a,k)};this.refreshButtonPos=function(b,B){l.setPosition(h-b,B+d);p.setPosition(n-b,B+g);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||x.setPosition(m-b,B+a);var w=E.getStartPosition();E.setPosition(w.x+b,w.y+B);w=C.getStartPosition();C.setPosition(w.x+b,w.y+B);w=k.getStartPosition();
k.setPosition(w.x+b,w.y+B);A.y=c-B;s_oGame.refreshPositionSidesWalls(b);s_oGame.refreshLimitCrabsX(b)};this.createInteractiveHelp=function(){B=new CHelp(s_oStage)};this.unload=function(){l.unload();l=null;B&&B.unload();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)x.unload(),x=null;s_oInterface=null};this.refreshResult=function(a,k){E.refresh(_szPlayerTeam+" "+a+" - "+k+" "+_szOpponentTeam)};this.refreshTime=function(a){(void 0).refresh(a)};this.crowdEffectOn=function(){var a=_oCrowd.getPosition(),
k=s_oSpriteLibrary.getSprite("crowd_on");a.y+=.3*k.height;_oCrowd.crowOn(s_oSpriteLibrary.getSprite("crowd_on"),a.x,a.y,750)};this.createLosePanel=function(a,k){w=new CLosePanel(s_oSpriteLibrary.getSprite("msg_box"));w.show(a,k)};this.createWinPanel=function(a,k,d,l){t=new CWinPanel(s_oSpriteLibrary.getSprite("msg_box"),l);t.show(a,k,d)};this.blockAllButton=function(a){l.block(a);p.block(a)};this.getScoreBoardResult=function(){return E.getResult()};this.unloadHelp=function(){B&&(B.unload(),B=null)};
this.createGoalText=function(a,k){var d=s_oSpriteLibrary.getSprite("goal_text"),l;l=createBitmap(d);l.regX=.5*d.width;l.regY=.5*d.height;l.x=a;l.y=k;l.scaleX=0;l.scaleY=0;s_oStage.addChild(l);createjs.Tween.get(l).to({scaleX:1,scaleY:1},500,createjs.Ease.quadOut).call(function(){createjs.Tween.get(l).wait(500).to({scaleX:0,scaleY:0,alpha:0},500,createjs.Ease.quadOut).call(function(){s_oStage.removeChild(l)})})};this._onExitVsPanel=function(){y.unload();y=null};this.createStartMatchText=function(){var a=
new createjs.Container;a.x=.5*CANVAS_WIDTH;a.y=-50;var k=new createjs.Text(TEXT_KICK_OFF,"50px "+FONT_GAME,"#000000");k.x=0;k.y=0;k.textAlign="center";k.outline=5;a.addChild(k);k=new createjs.Text(TEXT_KICK_OFF,"50px "+FONT_GAME,TEXT_COLOR);k.x=0;k.y=0;k.textAlign="center";a.addChild(k);s_oStage.addChild(a);createjs.Tween.get(a).to({y:TWEEN_END_MACTH_Y},1250,createjs.Ease.elasticOut).call(function(){createjs.Tween.get(a).to({scaleX:0,scaleY:0},500,createjs.Ease.quartIn).call(function(){s_oGame.startMatch();
s_oStage.removeChild(a)})})};this.createPauseInterface=function(){F=new CPause};this.unloadPause=function(){F.unload();F=null};this._onAudioToggle=function(){createjs.Sound.setMute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this.refreshScore=function(a){E.refresh(TEXT_SCORE+": "+a)};this.refreshLives=function(a,k){C.refresh("x "+a,k)};this.refreshTarget=function(a,d){k.refresh(a+"/"+d)};this.refreshLevel=function(a){A.text=TEXT_LEVEL+" "+a};this._onExit=function(){(new CAreYouSurePanel(s_oStage)).show()};
this._onPause=function(){s_oGame.unpause(!1);this.createPauseInterface()};s_oInterface=this;this._init(b);return this}var s_oInterface=null;
function CLosePanel(b){var n,g,h,d,c=null,m,a,l=!1;this._init=function(l){a=new createjs.Shape;a.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a.alpha=0;s_oStage.addChild(a);d=new createjs.Container;d.alpha=1;d.visible=!1;d.y=CANVAS_HEIGHT;n=createBitmap(l);n.x=CANVAS_WIDTH_HALF;n.y=CANVAS_HEIGHT_HALF;n.regX=.5*l.width;n.regY=.5*l.height;d.addChild(n);g=new createjs.Text("","36px "+FONT_GAME,TEXT_COLOR);g.x=CANVAS_WIDTH/2;g.y=CANVAS_HEIGHT_HALF;g.textAlign="center";g.textBaseline=
"middle";d.addChild(g);h=new createjs.Text("","bold 65px "+FONT_GAME,TEXT_COLOR);h.x=CANVAS_WIDTH/2;h.y=CANVAS_HEIGHT_HALF-130;h.textAlign="center";d.addChild(h);s_oStage.addChild(d);l=s_oSpriteLibrary.getSprite("but_home");c=new CGfxButton(.5*CANVAS_WIDTH-210,.5*CANVAS_HEIGHT+100,l,d);c.addEventListener(ON_MOUSE_DOWN,this._onExit,this);l=s_oSpriteLibrary.getSprite("but_restart");m=new CGfxButton(.5*CANVAS_WIDTH+210,.5*CANVAS_HEIGHT+100,l,d);m.addEventListener(ON_MOUSE_DOWN,this._onRestart,this);
m.pulseAnimation()};this.unload=function(){createjs.Tween.get(d).to({alpha:0},500,createjs.Ease.cubicOut).call(function(){s_oStage.removeChild(d);null!==c&&(c.unload(),c=null);a.removeAllEventListeners();m.unload();m=null})};this.show=function(l,b){g.text=TEXT_LOSE_RESULT+" "+l+" "+TEXT_OF+" "+b+" "+TEXT_FISHES;h.text=TEXT_LOST;d.visible=!0;createjs.Tween.get(a).to({alpha:.5},500,createjs.Ease.cubicOut);a.on("click",function(){});createjs.Tween.get(d).wait(250).to({y:0},1250,createjs.Ease.elasticOut).call(function(){s_iAdsLevel===
NUM_LEVEL_FOR_ADS?($(s_oMain).trigger("show_interlevel_ad"),s_iAdsLevel=1):s_iAdsLevel++})};this._onRestart=function(){l||(l=!0,this.unload(),createjs.Tween.get(a).to({alpha:0},400,createjs.Ease.cubicOut).call(function(){s_oStage.removeChild(a)}),s_oGame.restartLevel())};this._onExit=function(){l||(l=!0,this.unload(),s_oGame.onExit())};this._init(b);return this}
function CWinPanel(b,n){var g,h,d,c,m,a,l,p;this._init=function(b,n){p=new createjs.Shape;p.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);p.alpha=0;s_oStage.addChild(p);m=new createjs.Container;m.alpha=1;m.visible=!1;m.y=CANVAS_HEIGHT;g=createBitmap(b);g.x=CANVAS_WIDTH_HALF;g.y=CANVAS_HEIGHT_HALF;g.regX=.5*b.width;g.regY=.5*b.height;m.addChild(g);d=new createjs.Text("","bold 50px "+FONT_GAME,TEXT_COLOR);d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT_HALF-130;d.textAlign="center";m.addChild(d);
h=new createjs.Text("","bold 34px "+FONT_GAME,TEXT_COLOR);h.x=CANVAS_WIDTH/2;h.y=CANVAS_HEIGHT/2-20;h.textAlign="center";h.textBaseline="middle";m.addChild(h);c=new createjs.Text("","34px "+FONT_GAME,TEXT_COLOR_1);c.x=CANVAS_WIDTH/2;c.y=CANVAS_HEIGHT/2+50;c.textAlign="center";m.addChild(c);var w=s_oSpriteLibrary.getSprite("but_continue");l=new CGfxButton(.5*CANVAS_WIDTH+210,.5*CANVAS_HEIGHT+100,w,m);l.pulseAnimation();!1===n?(w=s_oSpriteLibrary.getSprite("but_home"),a=new CGfxButton(.5*CANVAS_WIDTH-
210,.5*CANVAS_HEIGHT+100,w,m),a.addEventListener(ON_MOUSE_DOWN,this._onExit,this),l.addEventListener(ON_MOUSE_DOWN,this._onContinue,this)):l.addEventListener(ON_MOUSE_DOWN,this._onEnd,this);s_oStage.addChild(m)};this.unload=function(){s_oStage.removeChild(m);a&&(a.unload(),a=null);l&&(l.unload(),l=null)};this.show=function(a,l,b){d.text=TEXT_WIN;h.text=TEXT_WIN_RESULT+" "+a+" "+TEXT_OF+" "+l+" "+TEXT_FISHES;c.text=TEXT_TOTAL_SCORE+": "+b;m.visible=!0;p.on("click",function(){});createjs.Tween.get(p).to({alpha:.5},
500,createjs.Ease.cubicOut);createjs.Tween.get(m).wait(250).to({y:0},1250,createjs.Ease.bounceOut).call(function(){s_iAdsLevel===NUM_LEVEL_FOR_ADS?($(s_oMain).trigger("show_interlevel_ad"),s_iAdsLevel=1):s_iAdsLevel++});$(s_oMain).trigger("save_score",b);$(s_oMain).trigger("share_event",b)};this._onContinue=function(){var a=this;createjs.Tween.get(m).to({y:CANVAS_HEIGHT},750,createjs.Ease.quartIn).call(function(){a.unload()});createjs.Tween.get(p).to({alpha:0},400,createjs.Ease.cubicOut).call(function(){s_oStage.removeChild(p);
p.removeAllEventListeners()});s_oGame.onContinue()};this._onEnd=function(){this.unload();s_oGame._onEnd()};this._onExit=function(){this.unload();p.removeAllEventListeners();s_oGame.onExit()};this._init(b,n);return this}
function CPhysicsController(){var b=Box2D.Common.Math.b2Vec2,n=Box2D.Dynamics.b2World,g=Box2D.Dynamics.b2DebugDraw,h,d,c=this,m=document.getElementById("canvas").getContext("2d");this.init=function(){h=new b(0,9.81);d=new n(h,!0);d.Step(TIME_STEP_BOX2D,ITINERATION_BOX2D,POSITION_ITINERATION_BOX2D);var a=new g;a.SetSprite(m);a.SetDrawScale(30);a.SetFillAlpha(.5);a.SetLineThickness(1);a.SetFlags(g.e_shapeBit|g.e_jointBit);d.SetDebugDraw(a)};this.startComputing=function(a){a.GetBody().SetActive(!0)};
this.applyImpulse=function(a,d){a.GetBody().ApplyImpulse(d,a.GetBody().GetWorldCenter())};this.applyForce=function(a,d){a.GetBody().ApplyForce(d,a.GetBody().GetWorldCenter())};this.decreaseSpeedRotation=function(a){var d=.99*a.GetBody().GetAngularVelocity();a.GetBody().SetAngularVelocity(d)};this.activeBody=function(a,d){a.GetBody().SetActive(d);a.GetBody().SetAwake(d)};this.destroyAllBody=function(){for(var a=d.GetBodyList();a.GetNext();){var l=a.GetNext();d.DestroyBody(l)}};this.destroyAllJoint=
function(){for(var a=d.GetJointList();a.GetNext();){var l=a.GetNext();d.DestroyJoint(l)}};this.destroyWorld=function(){d=null};this.getSpeedRotation=function(a){return a.GetBody().GetAngularVelocity()};this.moveObject=function(a,d,b){d={x:d/WORLD_SCALE,y:b/WORLD_SCALE};a.GetBody().SetPosition(d)};this.moveObjectX=function(a,d){var b={x:d/WORLD_SCALE,y:a.GetBody.GetPosition().y};a.GetBody().SetPosition(b)};this.destroyBody=function(a){d.DestroyBody(a.GetBody())};this.destroyJoint=function(a){d.DestroyJoint(a)};
this.getJointAngle=function(a){return a.GetJointAngle()*(180/Math.PI)};this.getInstance=function(){null===c&&(c=new CPhysicsController);return c};this.getJointTranslation=function(a){return a.GetJointTranslation()};this.update=function(){d.Step(.05,3,3);d.ClearForces()};this.upadteDrawDebug=function(){d.DrawDebugData()};this.getWorld=function(){return d};this.setElementLinearDamping=function(a,d){a.GetBody().SetLinearDamping(d)};this.setElementAngularVelocity=function(a,d){a.GetBody().SetAngularVelocity(d)};
this.setElementPosition=function(a,d){var b={x:d.x/WORLD_SCALE,y:d.y/WORLD_SCALE};a.GetBody().SetPosition(b)};this.getElementPosition=function(a){var d=a.GetBody().GetPosition();return{x:d.x*WORLD_SCALE,y:d.y*WORLD_SCALE,angle:180*a.GetBody().GetAngle()/Math.PI}};this.setElementAngle=function(a,d){a.GetBody().SetAngle(d*Math.PI/180)};this.getElementAngle=function(a){return 180*a.GetBody().GetAngle()/Math.PI};this.getElementVelocity=function(a){return a.GetBody().GetLinearVelocity()};this.setElementLinearVelocity=
function(a,d){return a.GetBody().SetLinearVelocity(d)};this.init()}
function CPhysicsObject(){var b=Box2D.Common.Math.b2Vec2,n=Box2D.Dynamics.b2BodyDef,g=Box2D.Dynamics.b2Body,h=Box2D.Dynamics.b2FixtureDef,d=Box2D.Collision.Shapes.b2PolygonShape,c=Box2D.Collision.Shapes.b2CircleShape,m=Box2D.Dynamics.Joints.b2RevoluteJointDef,a=Box2D.Collision.b2WorldManifold,l,p;this.init=function(){p=s_oPhysicsController.getInstance();l=p.getWorld()};this.addWall=function(a,b,c,t,m,p,k,A){var B=new h;B.density=p;B.friction=k;B.restitution=A;p=new n;p.type=g.b2_staticBody;B.shape=
new d;B.shape.SetAsBox(a/WORLD_SCALE,b/WORLD_SCALE);p.position.Set(c/WORLD_SCALE,t/WORLD_SCALE);p.angle=m*Math.PI/180;l.CreateBody(p).CreateFixture(B)};this.addLine=function(a,c,w,p,m,C,k,A,B){var F=new h;F.density=C;F.friction=k;F.restitution=A;F.filter.categoryBits=FIELD_CATEGORY_COLLISION;F.filter.maskBits=-1;F.filter.groupIndex=1;C=new n;C.type=g.b2_staticBody;C.position.Set(a/WORLD_SCALE,c/WORLD_SCALE);C.angle=m*Math.PI/180;C.userData={type:B};F.shape=new d;a=[];c=new b;c.Set(w.x/WORLD_SCALE,
w.y/WORLD_SCALE);a.push(c);w=new b;w.Set(p.x/WORLD_SCALE,p.y/WORLD_SCALE);a.push(w);F.shape.SetAsBox(200,.3);F.shape.SetAsArray(a,a.length);return l.CreateBody(C).CreateFixture(F)};this.addPolygon=function(a){var c=new h;c.density=a.density;c.friction=a.friction;c.restitution=a.restitution;c.isSensor=a.sensor;c.filter.categoryBits=3;c.filter.maskBits=1;c.filter.groupIndex=1;var w=new n;w.type=g.b2_staticBody;w.position.Set(a.x/WORLD_SCALE,a.y/WORLD_SCALE);w.angle=a.angle*Math.PI/180;w.userData=a.info;
c.shape=new d;a=a.vertex;for(var p=[],m=0;m<a.length;m++){var C=new b;C.Set(a[m].x/WORLD_SCALE,a[m].y/WORLD_SCALE);p.push(C)}c.shape.SetAsArray(p,p.length);return l.CreateBody(w).CreateFixture(c)};this.addCollisionPolygon=function(a){var c=new h;c.density=a.density;c.friction=a.friction;c.restitution=a.restitution;a.info.type===PLAYER?(c.filter.categoryBits=FIELD_CATEGORY_COLLISION,c.filter.maskBits=BALL_CATEGORY_COLLISION,c.filter.groupIndex=1):a.info.type===OPPONENT&&(c.filter.categoryBits=OPPONENT_CATEGORY_COLLISION,
c.filter.maskBits=BALL_CATEGORY_COLLISION,c.filter.groupIndex=1);var p=new n;p.type=g.b2_kinematicBody;p.position.Set(a.x/WORLD_SCALE,a.y/WORLD_SCALE);p.angle=a.angle*Math.PI/180;p.userData=a.info;c.shape=new d;for(var m=a.vertex,E=[],C=0;C<m.length;C++){for(var k=[],A=0;A<m[C].length;A++){var B=new b;a.info.type===OPPONENT?B.Set(m[C][A].x/WORLD_SCALE,(m[C][A].y+11)/WORLD_SCALE):B.Set(m[C][A].x/WORLD_SCALE,m[C][A].y/WORLD_SCALE);k.push(B)}c.shape.SetAsArray(k,k.length);E[C]=l.CreateBody(p).CreateFixture(c)}return E};
this.addCollisionShape=function(a){var b=new h;b.density=a.density;b.friction=a.friction;b.restitution=a.restitution;b.filter.categoryBits=OPPONENT_CATEGORY_COLLISION;b.filter.maskBits=BALL_CATEGORY_COLLISION;b.filter.groupIndex=1;var p=new n;p.type=g.b2_dynamicBody;b.shape=new d;b.shape.SetAsBox(a.recWidth/WORLD_SCALE,a.recHeight/WORLD_SCALE);p.position.Set((a.x+a.rec_offset.x)/WORLD_SCALE,(a.y+a.rec_offset.y)/WORLD_SCALE);p.fixedRotation=!0;var t=l.CreateBody(p),E=t.CreateFixture(b),p=new n,C=new h;
C.density=a.density;C.friction=a.friction;C.restitution=a.restitution;C.filter.categoryBits=OPPONENT_CATEGORY_COLLISION;C.filter.maskBits=-1;C.filter.groupIndex=1;p.type=g.b2_dynamicBody;C.shape=new c(a.radius/WORLD_SCALE);p.position.x=(a.x+a.sph_offset.x)/WORLD_SCALE;p.position.y=(a.y+a.sph_offset.y)/WORLD_SCALE;p.fixedRotation=!0;p.allowSleep=!1;p.bullet=!0;var k=l.CreateBody(p),C=k.CreateFixture(C),p=new n;p.type=g.b2_dynamicBody;b.shape=new d;b.shape.SetAsBox(a.rec_neck.width/WORLD_SCALE,a.rec_neck.height/
WORLD_SCALE);p.position.Set((a.x+a.rec_neck.x)/WORLD_SCALE,(a.y+a.rec_neck.y)/WORLD_SCALE);p.angle=Math.PI/180*a.rec_neck.angle;p.fixedRotation=!0;a=l.CreateBody(p);b=a.CreateFixture(b);p=new m;p.Initialize(t,k,k.GetWorldCenter());k=l.CreateJoint(p);p=new m;p.Initialize(t,a,a.GetWorldCenter());t=l.CreateJoint(p);return{fixture1:E,fixture2:C,fixture3:b,jointA:k,jointB:t}};this.createAContactListener=function(){var d=new Box2D.Dynamics.b2ContactListener;d.BeginContact=function(d){var c=d.GetFixtureA().GetBody().GetUserData(),
l=d.GetFixtureB().GetBody().GetUserData();if(null!==c&&null!==l)if(c.type===CRABS&&l.type===BONUS_HEART)s_oGame.bonusHeart(),s_oGame.bonusDisapper(l.id),s_oGame.addScore(BONUS_SCORE[l.id]);else if(c.type===FLOOR&&l.type===BONUS_HEART)s_oGame.bonusDisapper(l.id);else for(var h=0;h<FISH.length;h++)if(c.type===CRABS&&l.type===FISH[h]){c=new b;h=new a;d.GetWorldManifold(h);c.Set(h.m_points[0].x,h.m_points[0].y);c=d.GetFixtureA().GetBody().GetLocalPoint(c);s_oGame.crabsTouchFish(d.GetFixtureB(),c,l.id);
break}else if(c.type===FLOOR&&l.type===FISH[h]){s_oGame.fishOnFloor(l.id);break}else if(c.type===ANEMONE&&l.type===FISH[h]){s_oGame.fishInAnemone(l.id);break}};l.SetContactListener(d)};this.addPolygon=function(a){var c=new h;c.density=a.density;c.friction=a.friction;c.restitution=a.restitution;c.isSensor=a.sensor;var p=new n;p.type=g.b2_staticBody;p.position.Set(a.x/WORLD_SCALE,a.y/WORLD_SCALE);p.angle=a.angle*Math.PI/180;p.userData=a.info;c.shape=new d;a=a.vertex;for(var m=[],E=0;E<a.length;E++){var C=
new b;C.Set(a[E].x/WORLD_SCALE,a[E].y/WORLD_SCALE);m.push(C)}c.shape.SetAsArray(m,m.length);return l.CreateBody(p).CreateFixture(c)};this.addCircle=function(a,d){var b=new h;b.density=a.density;b.friction=a.friction;b.restitution=a.restitution;b.filter.categoryBits=a.catBits;b.filter.maskBits=a.maskBits;b.filter.groupIndex=a.groupId;var p=new n,m={type:a.info.type,id:d};p.type=g.b2_dynamicBody;b.shape=new c(a.width/WORLD_SCALE);p.position.x=a.x/WORLD_SCALE;p.position.y=a.y/WORLD_SCALE;p.userData=
m;p.linearDamping=a.linearDamping;p.angularDamping=a.angularDamping;p.bullet=!0;return l.CreateBody(p).CreateFixture(b)};this.addStaticCircle=function(a,d,b,p,m,C){var k=new h;k.density=p;k.friction=m;k.restitution=C;p=new n;p.type=g.b2_staticBody;k.shape=new c(a/WORLD_SCALE);p.position.x=d/WORLD_SCALE;p.position.y=b/WORLD_SCALE;return l.CreateBody(p).CreateFixture(k)};this.addRectangle=function(a){var b=new h;b.density=a.density;b.friction=a.friction;b.restitution=a.restitution;b.isSensor=a.sensor;
b.filter.categoryBits=a.catBits;b.filter.maskBits=a.maskBits;b.filter.groupIndex=a.groupId;var c=new n;c.type=g.b2_staticBody;b.shape=new d;b.shape.SetAsBox(a.width/WORLD_SCALE,a.height/WORLD_SCALE);c.userData=a.info;c.position.Set(a.x/WORLD_SCALE,a.y/WORLD_SCALE);c.angle=a.angle*Math.PI/180;return l.CreateBody(c).CreateFixture(b)};this.addObstacle=function(a,b,c,p){var m=new h;m.density=p.density;m.friction=p.friction;m.restitution=p.restitution;m.isSensor=p.sensor;m.filter.categoryBits=p.catBits;
m.filter.maskBits=p.maskBits;m.filter.groupIndex=p.groupId;var C=new n;C.type=g.b2_staticBody;m.shape=new d;m.shape.SetAsBox(p.width/WORLD_SCALE,p.height/WORLD_SCALE);C.userData=p.info;C.position.Set(a/WORLD_SCALE,b/WORLD_SCALE);C.angle=c*Math.PI/180;return l.CreateBody(C).CreateFixture(m)};this.setRotation=function(a){this.rotation=a};this._update=function(a){};this.init()}var Box2D={};
(function(b,n){function g(){}!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(b,d,c){c.get instanceof Function&&b.__defineGetter__(d,c.get);c.set instanceof Function&&b.__defineSetter__(d,c.set)});b.inherit=function(b,d){g.prototype=d.prototype;b.prototype=new g;b.prototype.constructor=b};b.generateCallback=function(b,d){return function(){d.apply(b,arguments)}};
b.NVector=function(b){b===n&&(b=0);for(var d=Array(b||0),c=0;c<b;++c)d[c]=0;return d};b.is=function(b,d){return null===b?!1:d instanceof Function&&b instanceof d||b.constructor.__implements!=n&&b.constructor.__implements[d]?!0:!1};b.parseUInt=function(b){return Math.abs(parseInt(b))}})(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;"undefined"===typeof Box2D&&(Box2D={});"undefined"===typeof Box2D.Collision&&(Box2D.Collision={});
"undefined"===typeof Box2D.Collision.Shapes&&(Box2D.Collision.Shapes={});"undefined"===typeof Box2D.Common&&(Box2D.Common={});"undefined"===typeof Box2D.Common.Math&&(Box2D.Common.Math={});"undefined"===typeof Box2D.Dynamics&&(Box2D.Dynamics={});"undefined"===typeof Box2D.Dynamics.Contacts&&(Box2D.Dynamics.Contacts={});"undefined"===typeof Box2D.Dynamics.Controllers&&(Box2D.Dynamics.Controllers={});"undefined"===typeof Box2D.Dynamics.Joints&&(Box2D.Dynamics.Joints={});
(function(){function b(){b.b2AABB.apply(this,arguments)}function n(){n.b2Bound.apply(this,arguments)}function g(){g.b2BoundValues.apply(this,arguments);this.constructor===g&&this.b2BoundValues.apply(this,arguments)}function h(){h.b2Collision.apply(this,arguments)}function d(){d.b2ContactID.apply(this,arguments);this.constructor===d&&this.b2ContactID.apply(this,arguments)}function c(){c.b2ContactPoint.apply(this,arguments)}function m(){m.b2Distance.apply(this,arguments)}function a(){a.b2DistanceInput.apply(this,
arguments)}function l(){l.b2DistanceOutput.apply(this,arguments)}function p(){p.b2DistanceProxy.apply(this,arguments)}function x(){x.b2DynamicTree.apply(this,arguments);this.constructor===x&&this.b2DynamicTree.apply(this,arguments)}function y(){y.b2DynamicTreeBroadPhase.apply(this,arguments)}function w(){w.b2DynamicTreeNode.apply(this,arguments)}function t(){t.b2DynamicTreePair.apply(this,arguments)}function E(){E.b2Manifold.apply(this,arguments);this.constructor===E&&this.b2Manifold.apply(this,arguments)}
function C(){C.b2ManifoldPoint.apply(this,arguments);this.constructor===C&&this.b2ManifoldPoint.apply(this,arguments)}function k(){k.b2Point.apply(this,arguments)}function A(){A.b2RayCastInput.apply(this,arguments);this.constructor===A&&this.b2RayCastInput.apply(this,arguments)}function B(){B.b2RayCastOutput.apply(this,arguments)}function F(){F.b2Segment.apply(this,arguments)}function H(){H.b2SeparationFunction.apply(this,arguments)}function K(){K.b2Simplex.apply(this,arguments);this.constructor===
K&&this.b2Simplex.apply(this,arguments)}function G(){G.b2SimplexCache.apply(this,arguments)}function P(){P.b2SimplexVertex.apply(this,arguments)}function J(){J.b2TimeOfImpact.apply(this,arguments)}function D(){D.b2TOIInput.apply(this,arguments)}function O(){O.b2WorldManifold.apply(this,arguments);this.constructor===O&&this.b2WorldManifold.apply(this,arguments)}function M(){M.ClipVertex.apply(this,arguments)}function f(){f.Features.apply(this,arguments)}function r(){r.b2CircleShape.apply(this,arguments);
this.constructor===r&&this.b2CircleShape.apply(this,arguments)}function z(){z.b2EdgeChainDef.apply(this,arguments);this.constructor===z&&this.b2EdgeChainDef.apply(this,arguments)}function q(){q.b2EdgeShape.apply(this,arguments);this.constructor===q&&this.b2EdgeShape.apply(this,arguments)}function I(){I.b2MassData.apply(this,arguments)}function N(){N.b2PolygonShape.apply(this,arguments);this.constructor===N&&this.b2PolygonShape.apply(this,arguments)}function L(){L.b2Shape.apply(this,arguments);this.constructor===
L&&this.b2Shape.apply(this,arguments)}function e(){e.b2Color.apply(this,arguments);this.constructor===e&&this.b2Color.apply(this,arguments)}function u(){u.b2Settings.apply(this,arguments)}function v(){v.b2Mat22.apply(this,arguments);this.constructor===v&&this.b2Mat22.apply(this,arguments)}function Q(){Q.b2Mat33.apply(this,arguments);this.constructor===Q&&this.b2Mat33.apply(this,arguments)}function R(){R.b2Math.apply(this,arguments)}function Da(){Da.b2Sweep.apply(this,arguments)}function S(){S.b2Transform.apply(this,
arguments);this.constructor===S&&this.b2Transform.apply(this,arguments)}function T(){T.b2Vec2.apply(this,arguments);this.constructor===T&&this.b2Vec2.apply(this,arguments)}function U(){U.b2Vec3.apply(this,arguments);this.constructor===U&&this.b2Vec3.apply(this,arguments)}function V(){V.b2Body.apply(this,arguments);this.constructor===V&&this.b2Body.apply(this,arguments)}function W(){W.b2BodyDef.apply(this,arguments);this.constructor===W&&this.b2BodyDef.apply(this,arguments)}function Ea(){Ea.b2ContactFilter.apply(this,
arguments)}function Fa(){Fa.b2ContactImpulse.apply(this,arguments)}function Ga(){Ga.b2ContactListener.apply(this,arguments)}function X(){X.b2ContactManager.apply(this,arguments);this.constructor===X&&this.b2ContactManager.apply(this,arguments)}function Y(){Y.b2DebugDraw.apply(this,arguments);this.constructor===Y&&this.b2DebugDraw.apply(this,arguments)}function Ha(){Ha.b2DestructionListener.apply(this,arguments)}function Ia(){Ia.b2FilterData.apply(this,arguments)}function Z(){Z.b2Fixture.apply(this,
arguments);this.constructor===Z&&this.b2Fixture.apply(this,arguments)}function aa(){aa.b2FixtureDef.apply(this,arguments);this.constructor===aa&&this.b2FixtureDef.apply(this,arguments)}function ba(){ba.b2Island.apply(this,arguments);this.constructor===ba&&this.b2Island.apply(this,arguments)}function Ja(){Ja.b2TimeStep.apply(this,arguments)}function ca(){ca.b2World.apply(this,arguments);this.constructor===ca&&this.b2World.apply(this,arguments)}function Ka(){Ka.b2CircleContact.apply(this,arguments)}
function da(){da.b2Contact.apply(this,arguments);this.constructor===da&&this.b2Contact.apply(this,arguments)}function ea(){ea.b2ContactConstraint.apply(this,arguments);this.constructor===ea&&this.b2ContactConstraint.apply(this,arguments)}function La(){La.b2ContactConstraintPoint.apply(this,arguments)}function Ma(){Ma.b2ContactEdge.apply(this,arguments)}function fa(){fa.b2ContactFactory.apply(this,arguments);this.constructor===fa&&this.b2ContactFactory.apply(this,arguments)}function Na(){Na.b2ContactRegister.apply(this,
arguments)}function Oa(){Oa.b2ContactResult.apply(this,arguments)}function ga(){ga.b2ContactSolver.apply(this,arguments);this.constructor===ga&&this.b2ContactSolver.apply(this,arguments)}function Pa(){Pa.b2EdgeAndCircleContact.apply(this,arguments)}function ha(){ha.b2NullContact.apply(this,arguments);this.constructor===ha&&this.b2NullContact.apply(this,arguments)}function Qa(){Qa.b2PolyAndCircleContact.apply(this,arguments)}function Ra(){Ra.b2PolyAndEdgeContact.apply(this,arguments)}function Sa(){Sa.b2PolygonContact.apply(this,
arguments)}function ia(){ia.b2PositionSolverManifold.apply(this,arguments);this.constructor===ia&&this.b2PositionSolverManifold.apply(this,arguments)}function Ta(){Ta.b2BuoyancyController.apply(this,arguments)}function Ua(){Ua.b2ConstantAccelController.apply(this,arguments)}function Va(){Va.b2ConstantForceController.apply(this,arguments)}function Wa(){Wa.b2Controller.apply(this,arguments)}function Xa(){Xa.b2ControllerEdge.apply(this,arguments)}function Ya(){Ya.b2GravityController.apply(this,arguments)}
function Za(){Za.b2TensorDampingController.apply(this,arguments)}function ja(){ja.b2DistanceJoint.apply(this,arguments);this.constructor===ja&&this.b2DistanceJoint.apply(this,arguments)}function ka(){ka.b2DistanceJointDef.apply(this,arguments);this.constructor===ka&&this.b2DistanceJointDef.apply(this,arguments)}function la(){la.b2FrictionJoint.apply(this,arguments);this.constructor===la&&this.b2FrictionJoint.apply(this,arguments)}function ma(){ma.b2FrictionJointDef.apply(this,arguments);this.constructor===
ma&&this.b2FrictionJointDef.apply(this,arguments)}function na(){na.b2GearJoint.apply(this,arguments);this.constructor===na&&this.b2GearJoint.apply(this,arguments)}function oa(){oa.b2GearJointDef.apply(this,arguments);this.constructor===oa&&this.b2GearJointDef.apply(this,arguments)}function $a(){$a.b2Jacobian.apply(this,arguments)}function pa(){pa.b2Joint.apply(this,arguments);this.constructor===pa&&this.b2Joint.apply(this,arguments)}function qa(){qa.b2JointDef.apply(this,arguments);this.constructor===
qa&&this.b2JointDef.apply(this,arguments)}function ab(){ab.b2JointEdge.apply(this,arguments)}function ra(){ra.b2LineJoint.apply(this,arguments);this.constructor===ra&&this.b2LineJoint.apply(this,arguments)}function sa(){sa.b2LineJointDef.apply(this,arguments);this.constructor===sa&&this.b2LineJointDef.apply(this,arguments)}function ta(){ta.b2MouseJoint.apply(this,arguments);this.constructor===ta&&this.b2MouseJoint.apply(this,arguments)}function ua(){ua.b2MouseJointDef.apply(this,arguments);this.constructor===
ua&&this.b2MouseJointDef.apply(this,arguments)}function va(){va.b2PrismaticJoint.apply(this,arguments);this.constructor===va&&this.b2PrismaticJoint.apply(this,arguments)}function wa(){wa.b2PrismaticJointDef.apply(this,arguments);this.constructor===wa&&this.b2PrismaticJointDef.apply(this,arguments)}function xa(){xa.b2PulleyJoint.apply(this,arguments);this.constructor===xa&&this.b2PulleyJoint.apply(this,arguments)}function ya(){ya.b2PulleyJointDef.apply(this,arguments);this.constructor===ya&&this.b2PulleyJointDef.apply(this,
arguments)}function za(){za.b2RevoluteJoint.apply(this,arguments);this.constructor===za&&this.b2RevoluteJoint.apply(this,arguments)}function Aa(){Aa.b2RevoluteJointDef.apply(this,arguments);this.constructor===Aa&&this.b2RevoluteJointDef.apply(this,arguments)}function Ba(){Ba.b2WeldJoint.apply(this,arguments);this.constructor===Ba&&this.b2WeldJoint.apply(this,arguments)}function Ca(){Ca.b2WeldJointDef.apply(this,arguments);this.constructor===Ca&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase=
"Box2D.Collision.IBroadPhase";Box2D.Collision.b2AABB=b;Box2D.Collision.b2Bound=n;Box2D.Collision.b2BoundValues=g;Box2D.Collision.b2Collision=h;Box2D.Collision.b2ContactID=d;Box2D.Collision.b2ContactPoint=c;Box2D.Collision.b2Distance=m;Box2D.Collision.b2DistanceInput=a;Box2D.Collision.b2DistanceOutput=l;Box2D.Collision.b2DistanceProxy=p;Box2D.Collision.b2DynamicTree=x;Box2D.Collision.b2DynamicTreeBroadPhase=y;Box2D.Collision.b2DynamicTreeNode=w;Box2D.Collision.b2DynamicTreePair=t;Box2D.Collision.b2Manifold=
E;Box2D.Collision.b2ManifoldPoint=C;Box2D.Collision.b2Point=k;Box2D.Collision.b2RayCastInput=A;Box2D.Collision.b2RayCastOutput=B;Box2D.Collision.b2Segment=F;Box2D.Collision.b2SeparationFunction=H;Box2D.Collision.b2Simplex=K;Box2D.Collision.b2SimplexCache=G;Box2D.Collision.b2SimplexVertex=P;Box2D.Collision.b2TimeOfImpact=J;Box2D.Collision.b2TOIInput=D;Box2D.Collision.b2WorldManifold=O;Box2D.Collision.ClipVertex=M;Box2D.Collision.Features=f;Box2D.Collision.Shapes.b2CircleShape=r;Box2D.Collision.Shapes.b2EdgeChainDef=
z;Box2D.Collision.Shapes.b2EdgeShape=q;Box2D.Collision.Shapes.b2MassData=I;Box2D.Collision.Shapes.b2PolygonShape=N;Box2D.Collision.Shapes.b2Shape=L;Box2D.Common.b2internal="Box2D.Common.b2internal";Box2D.Common.b2Color=e;Box2D.Common.b2Settings=u;Box2D.Common.Math.b2Mat22=v;Box2D.Common.Math.b2Mat33=Q;Box2D.Common.Math.b2Math=R;Box2D.Common.Math.b2Sweep=Da;Box2D.Common.Math.b2Transform=S;Box2D.Common.Math.b2Vec2=T;Box2D.Common.Math.b2Vec3=U;Box2D.Dynamics.b2Body=V;Box2D.Dynamics.b2BodyDef=W;Box2D.Dynamics.b2ContactFilter=
Ea;Box2D.Dynamics.b2ContactImpulse=Fa;Box2D.Dynamics.b2ContactListener=Ga;Box2D.Dynamics.b2ContactManager=X;Box2D.Dynamics.b2DebugDraw=Y;Box2D.Dynamics.b2DestructionListener=Ha;Box2D.Dynamics.b2FilterData=Ia;Box2D.Dynamics.b2Fixture=Z;Box2D.Dynamics.b2FixtureDef=aa;Box2D.Dynamics.b2Island=ba;Box2D.Dynamics.b2TimeStep=Ja;Box2D.Dynamics.b2World=ca;Box2D.Dynamics.Contacts.b2CircleContact=Ka;Box2D.Dynamics.Contacts.b2Contact=da;Box2D.Dynamics.Contacts.b2ContactConstraint=ea;Box2D.Dynamics.Contacts.b2ContactConstraintPoint=
La;Box2D.Dynamics.Contacts.b2ContactEdge=Ma;Box2D.Dynamics.Contacts.b2ContactFactory=fa;Box2D.Dynamics.Contacts.b2ContactRegister=Na;Box2D.Dynamics.Contacts.b2ContactResult=Oa;Box2D.Dynamics.Contacts.b2ContactSolver=ga;Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=Pa;Box2D.Dynamics.Contacts.b2NullContact=ha;Box2D.Dynamics.Contacts.b2PolyAndCircleContact=Qa;Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=Ra;Box2D.Dynamics.Contacts.b2PolygonContact=Sa;Box2D.Dynamics.Contacts.b2PositionSolverManifold=
ia;Box2D.Dynamics.Controllers.b2BuoyancyController=Ta;Box2D.Dynamics.Controllers.b2ConstantAccelController=Ua;Box2D.Dynamics.Controllers.b2ConstantForceController=Va;Box2D.Dynamics.Controllers.b2Controller=Wa;Box2D.Dynamics.Controllers.b2ControllerEdge=Xa;Box2D.Dynamics.Controllers.b2GravityController=Ya;Box2D.Dynamics.Controllers.b2TensorDampingController=Za;Box2D.Dynamics.Joints.b2DistanceJoint=ja;Box2D.Dynamics.Joints.b2DistanceJointDef=ka;Box2D.Dynamics.Joints.b2FrictionJoint=la;Box2D.Dynamics.Joints.b2FrictionJointDef=
ma;Box2D.Dynamics.Joints.b2GearJoint=na;Box2D.Dynamics.Joints.b2GearJointDef=oa;Box2D.Dynamics.Joints.b2Jacobian=$a;Box2D.Dynamics.Joints.b2Joint=pa;Box2D.Dynamics.Joints.b2JointDef=qa;Box2D.Dynamics.Joints.b2JointEdge=ab;Box2D.Dynamics.Joints.b2LineJoint=ra;Box2D.Dynamics.Joints.b2LineJointDef=sa;Box2D.Dynamics.Joints.b2MouseJoint=ta;Box2D.Dynamics.Joints.b2MouseJointDef=ua;Box2D.Dynamics.Joints.b2PrismaticJoint=va;Box2D.Dynamics.Joints.b2PrismaticJointDef=wa;Box2D.Dynamics.Joints.b2PulleyJoint=
xa;Box2D.Dynamics.Joints.b2PulleyJointDef=ya;Box2D.Dynamics.Joints.b2RevoluteJoint=za;Box2D.Dynamics.Joints.b2RevoluteJointDef=Aa;Box2D.Dynamics.Joints.b2WeldJoint=Ba;Box2D.Dynamics.Joints.b2WeldJointDef=Ca})();Box2D.postDefs=[];
(function(){var b=Box2D.Collision.Shapes.b2CircleShape,n=Box2D.Collision.Shapes.b2PolygonShape,g=Box2D.Collision.Shapes.b2Shape,h=Box2D.Common.b2Settings,d=Box2D.Common.Math.b2Math,c=Box2D.Common.Math.b2Sweep,m=Box2D.Common.Math.b2Transform,a=Box2D.Common.Math.b2Vec2,l=Box2D.Collision.b2AABB,p=Box2D.Collision.b2Bound,x=Box2D.Collision.b2BoundValues,y=Box2D.Collision.b2Collision,w=Box2D.Collision.b2ContactID,t=Box2D.Collision.b2ContactPoint,E=Box2D.Collision.b2Distance,C=Box2D.Collision.b2DistanceInput,
k=Box2D.Collision.b2DistanceOutput,A=Box2D.Collision.b2DistanceProxy,B=Box2D.Collision.b2DynamicTree,F=Box2D.Collision.b2DynamicTreeBroadPhase,H=Box2D.Collision.b2DynamicTreeNode,K=Box2D.Collision.b2DynamicTreePair,G=Box2D.Collision.b2Manifold,P=Box2D.Collision.b2ManifoldPoint,J=Box2D.Collision.b2Point,D=Box2D.Collision.b2RayCastInput,O=Box2D.Collision.b2RayCastOutput,M=Box2D.Collision.b2Segment,f=Box2D.Collision.b2SeparationFunction,r=Box2D.Collision.b2Simplex,z=Box2D.Collision.b2SimplexCache,q=
Box2D.Collision.b2SimplexVertex,I=Box2D.Collision.b2TimeOfImpact,N=Box2D.Collision.b2TOIInput,L=Box2D.Collision.b2WorldManifold,e=Box2D.Collision.ClipVertex,u=Box2D.Collision.Features,v=Box2D.Collision.IBroadPhase;l.b2AABB=function(){this.lowerBound=new a;this.upperBound=new a};l.prototype.IsValid=function(){var e=this.upperBound.y-this.lowerBound.y;return 0<=this.upperBound.x-this.lowerBound.x&&0<=e&&this.lowerBound.IsValid()&&this.upperBound.IsValid()};l.prototype.GetCenter=function(){return new a((this.lowerBound.x+
this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};l.prototype.GetExtents=function(){return new a((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};l.prototype.Contains=function(e){var a;return a=(a=(a=(a=this.lowerBound.x<=e.lowerBound.x)&&this.lowerBound.y<=e.lowerBound.y)&&e.upperBound.x<=this.upperBound.x)&&e.upperBound.y<=this.upperBound.y};l.prototype.RayCast=function(e,a){var f=-Number.MAX_VALUE,u=Number.MAX_VALUE,r=a.p1.x,k=a.p1.y,q=a.p2.x-a.p1.x,
v=a.p2.y-a.p1.y,b=Math.abs(v),d=e.normal,c;if(Math.abs(q)<Number.MIN_VALUE){if(r<this.lowerBound.x||this.upperBound.x<r)return!1}else if(c=1/q,q=(this.lowerBound.x-r)*c,r=(this.upperBound.x-r)*c,c=-1,q>r&&(c=q,q=r,r=c,c=1),q>f&&(d.x=c,d.y=0,f=q),u=Math.min(u,r),f>u)return!1;if(b<Number.MIN_VALUE){if(k<this.lowerBound.y||this.upperBound.y<k)return!1}else if(c=1/v,q=(this.lowerBound.y-k)*c,r=(this.upperBound.y-k)*c,c=-1,q>r&&(c=q,q=r,r=c,c=1),q>f&&(d.y=c,d.x=0,f=q),u=Math.min(u,r),f>u)return!1;e.fraction=
f;return!0};l.prototype.TestOverlap=function(e){var a=e.lowerBound.y-this.upperBound.y,f=this.lowerBound.y-e.upperBound.y;return 0<e.lowerBound.x-this.upperBound.x||0<a||0<this.lowerBound.x-e.upperBound.x||0<f?!1:!0};l.Combine=function(e,a){var f=new l;f.Combine(e,a);return f};l.prototype.Combine=function(e,a){this.lowerBound.x=Math.min(e.lowerBound.x,a.lowerBound.x);this.lowerBound.y=Math.min(e.lowerBound.y,a.lowerBound.y);this.upperBound.x=Math.max(e.upperBound.x,a.upperBound.x);this.upperBound.y=
Math.max(e.upperBound.y,a.upperBound.y)};p.b2Bound=function(){};p.prototype.IsLower=function(){return 0==(this.value&1)};p.prototype.IsUpper=function(){return 1==(this.value&1)};p.prototype.Swap=function(e){var a=this.value,f=this.proxy,u=this.stabbingCount;this.value=e.value;this.proxy=e.proxy;this.stabbingCount=e.stabbingCount;e.value=a;e.proxy=f;e.stabbingCount=u};x.b2BoundValues=function(){};x.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number;this.lowerValues[0]=0;this.lowerValues[1]=
0;this.upperValues=new Vector_a2j_Number;this.upperValues[0]=0;this.upperValues[1]=0};y.b2Collision=function(){};y.ClipSegmentToLine=function(e,a,f,u){void 0===u&&(u=0);var r,q=0;r=a[0];var k=r.v;r=a[1];var v=r.v,b=f.x*k.x+f.y*k.y-u;r=f.x*v.x+f.y*v.y-u;0>=b&&e[q++].Set(a[0]);0>=r&&e[q++].Set(a[1]);0>b*r&&(f=b/(b-r),r=e[q],r=r.v,r.x=k.x+f*(v.x-k.x),r.y=k.y+f*(v.y-k.y),r=e[q],r.id=(0<b?a[0]:a[1]).id,++q);return q};y.EdgeSeparation=function(e,a,f,u,r){void 0===f&&(f=0);parseInt(e.m_vertexCount);var q=
e.m_vertices,k=e.m_normals;e=parseInt(u.m_vertexCount);u=u.m_vertices;var v,b;v=a.R;b=k[f];var k=v.col1.x*b.x+v.col2.x*b.y,d=v.col1.y*b.x+v.col2.y*b.y;v=r.R;var c=v.col1.x*k+v.col1.y*d;v=v.col2.x*k+v.col2.y*d;for(var l=0,z=Number.MAX_VALUE,h=0;h<e;++h)b=u[h],b=b.x*c+b.y*v,b<z&&(z=b,l=h);b=q[f];v=a.R;f=a.position.x+(v.col1.x*b.x+v.col2.x*b.y);a=a.position.y+(v.col1.y*b.x+v.col2.y*b.y);b=u[l];v=r.R;return(r.position.x+(v.col1.x*b.x+v.col2.x*b.y)-f)*k+(r.position.y+(v.col1.y*b.x+v.col2.y*b.y)-a)*d};
y.FindMaxSeparation=function(e,a,f,u,r){var v=parseInt(a.m_vertexCount),q=a.m_normals,k,b;b=r.R;k=u.m_centroid;var d=r.position.x+(b.col1.x*k.x+b.col2.x*k.y),c=r.position.y+(b.col1.y*k.x+b.col2.y*k.y);b=f.R;k=a.m_centroid;d-=f.position.x+(b.col1.x*k.x+b.col2.x*k.y);c-=f.position.y+(b.col1.y*k.x+b.col2.y*k.y);b=d*f.R.col1.x+c*f.R.col1.y;for(var c=d*f.R.col2.x+c*f.R.col2.y,d=0,l=-Number.MAX_VALUE,z=0;z<v;++z)k=q[z],k=k.x*b+k.y*c,k>l&&(l=k,d=z);q=y.EdgeSeparation(a,f,d,u,r);l=parseInt(0<=d-1?d-1:v-1);
b=y.EdgeSeparation(a,f,l,u,r);z=parseInt(d+1<v?d+1:0);c=y.EdgeSeparation(a,f,z,u,r);if(b>q&&b>c)k=-1;else if(c>q)k=1,l=z,b=c;else return e[0]=d,q;for(;;)if(d=-1==k?0<=l-1?l-1:v-1:l+1<v?l+1:0,q=y.EdgeSeparation(a,f,d,u,r),q>b)l=d,b=q;else break;e[0]=l;return b};y.FindIncidentEdge=function(e,a,f,u,r,k){void 0===u&&(u=0);parseInt(a.m_vertexCount);var b=a.m_normals,q=parseInt(r.m_vertexCount);a=r.m_vertices;r=r.m_normals;var v;v=f.R;f=b[u];var b=v.col1.x*f.x+v.col2.x*f.y,d=v.col1.y*f.x+v.col2.y*f.y;v=
k.R;f=v.col1.x*b+v.col1.y*d;d=v.col2.x*b+v.col2.y*d;b=f;v=0;for(var c=Number.MAX_VALUE,l=0;l<q;++l)f=r[l],f=b*f.x+d*f.y,f<c&&(c=f,v=l);r=parseInt(v);b=parseInt(r+1<q?r+1:0);q=e[0];f=a[r];v=k.R;q.v.x=k.position.x+(v.col1.x*f.x+v.col2.x*f.y);q.v.y=k.position.y+(v.col1.y*f.x+v.col2.y*f.y);q.id.features.referenceEdge=u;q.id.features.incidentEdge=r;q.id.features.incidentVertex=0;q=e[1];f=a[b];v=k.R;q.v.x=k.position.x+(v.col1.x*f.x+v.col2.x*f.y);q.v.y=k.position.y+(v.col1.y*f.x+v.col2.y*f.y);q.id.features.referenceEdge=
u;q.id.features.incidentEdge=b;q.id.features.incidentVertex=1};y.MakeClipPointVector=function(){var a=new Vector(2);a[0]=new e;a[1]=new e;return a};y.CollidePolygons=function(e,a,f,u,r){var v;e.m_pointCount=0;var q=a.m_radius+u.m_radius,b;y.s_edgeAO[0]=0;var k=y.FindMaxSeparation(y.s_edgeAO,a,f,u,r);b=y.s_edgeAO[0];if(!(k>q)){y.s_edgeBO[0]=0;var d=y.FindMaxSeparation(y.s_edgeBO,u,r,a,f);v=y.s_edgeBO[0];if(!(d>q)){d>.98*k+.001?(k=u,u=a,a=r,r=v,e.m_type=G.e_faceB,b=1):(k=a,a=f,f=r,r=b,e.m_type=G.e_faceA,
b=0);v=y.s_incidentEdge;y.FindIncidentEdge(v,k,a,r,u,f);d=parseInt(k.m_vertexCount);k=k.m_vertices;u=k[r];var c;c=r+1<d?k[parseInt(r+1)]:k[0];k=y.s_localTangent;k.Set(c.x-u.x,c.y-u.y);k.Normalize();d=y.s_localNormal;d.x=k.y;d.y=-k.x;var l=y.s_planePoint;l.Set(.5*(u.x+c.x),.5*(u.y+c.y));var z=y.s_tangent;r=a.R;z.x=r.col1.x*k.x+r.col2.x*k.y;z.y=r.col1.y*k.x+r.col2.y*k.y;var I=y.s_tangent2;I.x=-z.x;I.y=-z.y;k=y.s_normal;k.x=z.y;k.y=-z.x;var L=y.s_v11,g=y.s_v12;L.x=a.position.x+(r.col1.x*u.x+r.col2.x*
u.y);L.y=a.position.y+(r.col1.y*u.x+r.col2.y*u.y);g.x=a.position.x+(r.col1.x*c.x+r.col2.x*c.y);g.y=a.position.y+(r.col1.y*c.x+r.col2.y*c.y);a=k.x*L.x+k.y*L.y;r=z.x*g.x+z.y*g.y+q;c=y.s_clipPoints1;u=y.s_clipPoints2;v=y.ClipSegmentToLine(c,v,I,-z.x*L.x-z.y*L.y+q);if(!(2>v||(v=y.ClipSegmentToLine(u,c,z,r),2>v))){e.m_localPlaneNormal.SetV(d);e.m_localPoint.SetV(l);for(l=d=0;l<h.b2_maxManifoldPoints;++l)v=u[l],k.x*v.v.x+k.y*v.v.y-a<=q&&(z=e.m_points[d],r=f.R,I=v.v.x-f.position.x,L=v.v.y-f.position.y,z.m_localPoint.x=
I*r.col1.x+L*r.col1.y,z.m_localPoint.y=I*r.col2.x+L*r.col2.y,z.m_id.Set(v.id),z.m_id.features.flip=b,++d);e.m_pointCount=d}}}};y.CollideCircles=function(e,a,f,u,r){e.m_pointCount=0;var k,v;k=f.R;v=a.m_p;var q=f.position.x+(k.col1.x*v.x+k.col2.x*v.y);f=f.position.y+(k.col1.y*v.x+k.col2.y*v.y);k=r.R;v=u.m_p;q=r.position.x+(k.col1.x*v.x+k.col2.x*v.y)-q;r=r.position.y+(k.col1.y*v.x+k.col2.y*v.y)-f;k=a.m_radius+u.m_radius;q*q+r*r>k*k||(e.m_type=G.e_circles,e.m_localPoint.SetV(a.m_p),e.m_localPlaneNormal.SetZero(),
e.m_pointCount=1,e.m_points[0].m_localPoint.SetV(u.m_p),e.m_points[0].m_id.key=0)};y.CollidePolygonAndCircle=function(e,a,f,u,r){e.m_pointCount=0;var k,v,q,b;b=r.R;q=u.m_p;var d=r.position.y+(b.col1.y*q.x+b.col2.y*q.y);k=r.position.x+(b.col1.x*q.x+b.col2.x*q.y)-f.position.x;v=d-f.position.y;b=f.R;f=k*b.col1.x+v*b.col1.y;b=k*b.col2.x+v*b.col2.y;var c=0;r=-Number.MAX_VALUE;var d=a.m_radius+u.m_radius,l=parseInt(a.m_vertexCount),z=a.m_vertices;a=a.m_normals;for(var h=0;h<l;++h){q=z[h];k=f-q.x;v=b-q.y;
q=a[h];q=q.x*k+q.y*v;if(q>d)return;q>r&&(r=q,c=h)}q=parseInt(c);v=parseInt(q+1<l?q+1:0);k=z[q];z=z[v];r<Number.MIN_VALUE?(e.m_pointCount=1,e.m_type=G.e_faceA,e.m_localPlaneNormal.SetV(a[c]),e.m_localPoint.x=.5*(k.x+z.x),e.m_localPoint.y=.5*(k.y+z.y),e.m_points[0].m_localPoint.SetV(u.m_p),e.m_points[0].m_id.key=0):(r=(f-z.x)*(k.x-z.x)+(b-z.y)*(k.y-z.y),0>=(f-k.x)*(z.x-k.x)+(b-k.y)*(z.y-k.y)?(f-k.x)*(f-k.x)+(b-k.y)*(b-k.y)>d*d||(e.m_pointCount=1,e.m_type=G.e_faceA,e.m_localPlaneNormal.x=f-k.x,e.m_localPlaneNormal.y=
b-k.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(k),e.m_points[0].m_localPoint.SetV(u.m_p),e.m_points[0].m_id.key=0):0>=r?(f-z.x)*(f-z.x)+(b-z.y)*(b-z.y)>d*d||(e.m_pointCount=1,e.m_type=G.e_faceA,e.m_localPlaneNormal.x=f-z.x,e.m_localPlaneNormal.y=b-z.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(z),e.m_points[0].m_localPoint.SetV(u.m_p),e.m_points[0].m_id.key=0):(c=.5*(k.x+z.x),z=.5*(k.y+z.y),r=(f-c)*a[q].x+(b-z)*a[q].y,r>d||(e.m_pointCount=1,e.m_type=G.e_faceA,e.m_localPlaneNormal.x=
a[q].x,e.m_localPlaneNormal.y=a[q].y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.Set(c,z),e.m_points[0].m_localPoint.SetV(u.m_p),e.m_points[0].m_id.key=0)))};y.TestOverlap=function(e,a){var f=a.lowerBound,u=e.upperBound,r=f.x-u.x,k=f.y-u.y,f=e.lowerBound,u=a.upperBound,v=f.y-u.y;return 0<r||0<k||0<f.x-u.x||0<v?!1:!0};Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=y.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints1=y.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints2=
y.MakeClipPointVector();Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_localTangent=new a;Box2D.Collision.b2Collision.s_localNormal=new a;Box2D.Collision.b2Collision.s_planePoint=new a;Box2D.Collision.b2Collision.s_normal=new a;Box2D.Collision.b2Collision.s_tangent=new a;Box2D.Collision.b2Collision.s_tangent2=new a;Box2D.Collision.b2Collision.s_v11=new a;Box2D.Collision.b2Collision.s_v12=new a;
Box2D.Collision.b2Collision.b2CollidePolyTempVec=new a;Box2D.Collision.b2Collision.b2_nullFeature=255});w.b2ContactID=function(){this.features=new u};w.prototype.b2ContactID=function(){this.features._m_id=this};w.prototype.Set=function(e){this.key=e._key};w.prototype.Copy=function(){var e=new w;e.key=this.key;return e};Object.defineProperty(w.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}});Object.defineProperty(w.prototype,"key",{enumerable:!1,configurable:!0,set:function(e){void 0===
e&&(e=0);this._key=e;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}});t.b2ContactPoint=function(){this.position=new a;this.velocity=new a;this.normal=new a;this.id=new w};E.b2Distance=function(){};E.Distance=function(e,f,u){++E.b2_gjkCalls;var r=u.proxyA,k=u.proxyB,v=u.transformA,q=u.transformB,b=E.s_simplex;b.ReadCache(f,r,v,k,q);var c=b.m_vertices,
l=E.s_saveA,z=E.s_saveB,I;b.GetClosestPoint().LengthSquared();for(var L,g,N=0;20>N;){I=b.m_count;for(L=0;L<I;L++)l[L]=c[L].indexA,z[L]=c[L].indexB;switch(b.m_count){case 1:break;case 2:b.Solve2();break;case 3:b.Solve3();break;default:h.b2Assert(!1)}if(3==b.m_count)break;g=b.GetClosestPoint();g.LengthSquared();L=b.GetSearchDirection();if(L.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;g=c[b.m_count];g.indexA=r.GetSupport(d.MulTMV(v.R,L.GetNegative()));g.wA=d.MulX(v,r.GetVertex(g.indexA));
g.indexB=k.GetSupport(d.MulTMV(q.R,L));g.wB=d.MulX(q,k.GetVertex(g.indexB));g.w=d.SubtractVV(g.wB,g.wA);++N;++E.b2_gjkIters;var n=!1;for(L=0;L<I;L++)if(g.indexA==l[L]&&g.indexB==z[L]){n=!0;break}if(n)break;++b.m_count}E.b2_gjkMaxIters=d.Max(E.b2_gjkMaxIters,N);b.GetWitnessPoints(e.pointA,e.pointB);e.distance=d.SubtractVV(e.pointA,e.pointB).Length();e.iterations=N;b.WriteCache(f);u.useRadii&&(f=r.m_radius,k=k.m_radius,e.distance>f+k&&e.distance>Number.MIN_VALUE?(e.distance-=f+k,u=d.SubtractVV(e.pointB,
e.pointA),u.Normalize(),e.pointA.x+=f*u.x,e.pointA.y+=f*u.y,e.pointB.x-=k*u.x,e.pointB.y-=k*u.y):(g=new a,g.x=.5*(e.pointA.x+e.pointB.x),g.y=.5*(e.pointA.y+e.pointB.y),e.pointA.x=e.pointB.x=g.x,e.pointA.y=e.pointB.y=g.y,e.distance=0))};Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new r;Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3);Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)});C.b2DistanceInput=function(){};k.b2DistanceOutput=function(){this.pointA=
new a;this.pointB=new a};A.b2DistanceProxy=function(){};A.prototype.Set=function(e){switch(e.GetType()){case g.e_circleShape:e=e instanceof b?e:null;this.m_vertices=new Vector(1,!0);this.m_vertices[0]=e.m_p;this.m_count=1;this.m_radius=e.m_radius;break;case g.e_polygonShape:e=e instanceof n?e:null;this.m_vertices=e.m_vertices;this.m_count=e.m_vertexCount;this.m_radius=e.m_radius;break;default:h.b2Assert(!1)}};A.prototype.GetSupport=function(e){for(var f=0,a=this.m_vertices[0].x*e.x+this.m_vertices[0].y*
e.y,u=1;u<this.m_count;++u){var r=this.m_vertices[u].x*e.x+this.m_vertices[u].y*e.y;r>a&&(f=u,a=r)}return f};A.prototype.GetSupportVertex=function(e){for(var f=0,a=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,u=1;u<this.m_count;++u){var r=this.m_vertices[u].x*e.x+this.m_vertices[u].y*e.y;r>a&&(f=u,a=r)}return this.m_vertices[f]};A.prototype.GetVertexCount=function(){return this.m_count};A.prototype.GetVertex=function(e){void 0===e&&(e=0);h.b2Assert(0<=e&&e<this.m_count);return this.m_vertices[e]};
B.b2DynamicTree=function(){};B.prototype.b2DynamicTree=function(){this.m_freeList=this.m_root=null;this.m_insertionCount=this.m_path=0};B.prototype.CreateProxy=function(e,f){var a=this.AllocateNode(),u=h.b2_aabbExtension,r=h.b2_aabbExtension;a.aabb.lowerBound.x=e.lowerBound.x-u;a.aabb.lowerBound.y=e.lowerBound.y-r;a.aabb.upperBound.x=e.upperBound.x+u;a.aabb.upperBound.y=e.upperBound.y+r;a.userData=f;this.InsertLeaf(a);return a};B.prototype.DestroyProxy=function(e){this.RemoveLeaf(e);this.FreeNode(e)};
B.prototype.MoveProxy=function(e,a,f){h.b2Assert(e.IsLeaf());if(e.aabb.Contains(a))return!1;this.RemoveLeaf(e);var u=h.b2_aabbExtension+h.b2_aabbMultiplier*(0<f.x?f.x:-f.x);f=h.b2_aabbExtension+h.b2_aabbMultiplier*(0<f.y?f.y:-f.y);e.aabb.lowerBound.x=a.lowerBound.x-u;e.aabb.lowerBound.y=a.lowerBound.y-f;e.aabb.upperBound.x=a.upperBound.x+u;e.aabb.upperBound.y=a.upperBound.y+f;this.InsertLeaf(e);return!0};B.prototype.Rebalance=function(e){void 0===e&&(e=0);if(null!=this.m_root)for(var f=0;f<e;f++){for(var a=
this.m_root,u=0;0==a.IsLeaf();)a=this.m_path>>u&1?a.child2:a.child1,u=u+1&31;++this.m_path;this.RemoveLeaf(a);this.InsertLeaf(a)}};B.prototype.GetFatAABB=function(e){return e.aabb};B.prototype.GetUserData=function(e){return e.userData};B.prototype.Query=function(e,a){if(null!=this.m_root){var f=new Vector,u=0;for(f[u++]=this.m_root;0<u;){var r=f[--u];if(r.aabb.TestOverlap(a))if(r.IsLeaf()){if(!e(r))break}else f[u++]=r.child1,f[u++]=r.child2}}};B.prototype.RayCast=function(e,a){if(null!=this.m_root){var f=
a.p1,u=a.p2,r=d.SubtractVV(f,u);r.Normalize();var r=d.CrossFV(1,r),k=d.AbsV(r),v=a.maxFraction,b=new l,q;q=f.x+v*(u.x-f.x);v=f.y+v*(u.y-f.y);b.lowerBound.x=Math.min(f.x,q);b.lowerBound.y=Math.min(f.y,v);b.upperBound.x=Math.max(f.x,q);b.upperBound.y=Math.max(f.y,v);var c=new Vector,z=0;for(c[z++]=this.m_root;0<z;)if(q=c[--z],0!=q.aabb.TestOverlap(b)){var v=q.aabb.GetCenter(),h=q.aabb.GetExtents();if(!(0<Math.abs(r.x*(f.x-v.x)+r.y*(f.y-v.y))-k.x*h.x-k.y*h.y))if(q.IsLeaf()){v=new D;v.p1=a.p1;v.p2=a.p2;
v.maxFraction=a.maxFraction;v=e(v,q);if(0==v)break;0<v&&(q=f.x+v*(u.x-f.x),v=f.y+v*(u.y-f.y),b.lowerBound.x=Math.min(f.x,q),b.lowerBound.y=Math.min(f.y,v),b.upperBound.x=Math.max(f.x,q),b.upperBound.y=Math.max(f.y,v))}else c[z++]=q.child1,c[z++]=q.child2}}};B.prototype.AllocateNode=function(){if(this.m_freeList){var e=this.m_freeList;this.m_freeList=e.parent;e.parent=null;e.child1=null;e.child2=null;return e}return new H};B.prototype.FreeNode=function(e){e.parent=this.m_freeList;this.m_freeList=e};
B.prototype.InsertLeaf=function(e){++this.m_insertionCount;if(null==this.m_root)this.m_root=e,this.m_root.parent=null;else{var f=e.aabb.GetCenter(),a=this.m_root;if(0==a.IsLeaf()){do var u=a.child1,a=a.child2,a=Math.abs((u.aabb.lowerBound.x+u.aabb.upperBound.x)/2-f.x)+Math.abs((u.aabb.lowerBound.y+u.aabb.upperBound.y)/2-f.y)<Math.abs((a.aabb.lowerBound.x+a.aabb.upperBound.x)/2-f.x)+Math.abs((a.aabb.lowerBound.y+a.aabb.upperBound.y)/2-f.y)?u:a;while(0==a.IsLeaf())}f=a.parent;u=this.AllocateNode();
u.parent=f;u.userData=null;u.aabb.Combine(e.aabb,a.aabb);if(f){a.parent.child1==a?f.child1=u:f.child2=u;u.child1=a;u.child2=e;a.parent=u;e.parent=u;do{if(f.aabb.Contains(u.aabb))break;f.aabb.Combine(f.child1.aabb,f.child2.aabb);u=f;f=f.parent}while(f)}else u.child1=a,u.child2=e,a.parent=u,this.m_root=e.parent=u}};B.prototype.RemoveLeaf=function(e){if(e==this.m_root)this.m_root=null;else{var f=e.parent,a=f.parent;e=f.child1==e?f.child2:f.child1;if(a)for(a.child1==f?a.child1=e:a.child2=e,e.parent=a,
this.FreeNode(f);a;){f=a.aabb;a.aabb=l.Combine(a.child1.aabb,a.child2.aabb);if(f.Contains(a.aabb))break;a=a.parent}else this.m_root=e,e.parent=null,this.FreeNode(f)}};F.b2DynamicTreeBroadPhase=function(){this.m_tree=new B;this.m_moveBuffer=new Vector;this.m_pairBuffer=new Vector;this.m_pairCount=0};F.prototype.CreateProxy=function(e,f){var a=this.m_tree.CreateProxy(e,f);++this.m_proxyCount;this.BufferMove(a);return a};F.prototype.DestroyProxy=function(e){this.UnBufferMove(e);--this.m_proxyCount;this.m_tree.DestroyProxy(e)};
F.prototype.MoveProxy=function(e,f,a){this.m_tree.MoveProxy(e,f,a)&&this.BufferMove(e)};F.prototype.TestOverlap=function(e,f){var a=this.m_tree.GetFatAABB(e),u=this.m_tree.GetFatAABB(f);return a.TestOverlap(u)};F.prototype.GetUserData=function(e){return this.m_tree.GetUserData(e)};F.prototype.GetFatAABB=function(e){return this.m_tree.GetFatAABB(e)};F.prototype.GetProxyCount=function(){return this.m_proxyCount};F.prototype.UpdatePairs=function(e){for(var f=this,a=f.m_pairCount=0,u,a=0;a<f.m_moveBuffer.length;++a){u=
f.m_moveBuffer[a];var r=f.m_tree.GetFatAABB(u);f.m_tree.Query(function(e){if(e==u)return!0;f.m_pairCount==f.m_pairBuffer.length&&(f.m_pairBuffer[f.m_pairCount]=new K);var a=f.m_pairBuffer[f.m_pairCount];a.proxyA=e<u?e:u;a.proxyB=e>=u?e:u;++f.m_pairCount;return!0},r)}for(a=f.m_moveBuffer.length=0;a<f.m_pairCount;){var r=f.m_pairBuffer[a],k=f.m_tree.GetUserData(r.proxyA),v=f.m_tree.GetUserData(r.proxyB);e(k,v);for(++a;a<f.m_pairCount;){k=f.m_pairBuffer[a];if(k.proxyA!=r.proxyA||k.proxyB!=r.proxyB)break;
++a}}};F.prototype.Query=function(e,f){this.m_tree.Query(e,f)};F.prototype.RayCast=function(e,f){this.m_tree.RayCast(e,f)};F.prototype.Validate=function(){};F.prototype.Rebalance=function(e){void 0===e&&(e=0);this.m_tree.Rebalance(e)};F.prototype.BufferMove=function(e){this.m_moveBuffer[this.m_moveBuffer.length]=e};F.prototype.UnBufferMove=function(e){e=parseInt(this.m_moveBuffer.indexOf(e));this.m_moveBuffer.splice(e,1)};F.prototype.ComparePairs=function(e,f){return 0};F.__implements={};F.__implements[v]=
!0;H.b2DynamicTreeNode=function(){this.aabb=new l};H.prototype.IsLeaf=function(){return null==this.child1};K.b2DynamicTreePair=function(){};G.b2Manifold=function(){this.m_pointCount=0};G.prototype.b2Manifold=function(){this.m_points=new Vector(h.b2_maxManifoldPoints);for(var e=0;e<h.b2_maxManifoldPoints;e++)this.m_points[e]=new P;this.m_localPlaneNormal=new a;this.m_localPoint=new a};G.prototype.Reset=function(){for(var e=0;e<h.b2_maxManifoldPoints;e++)(this.m_points[e]instanceof P?this.m_points[e]:
null).Reset();this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_pointCount=this.m_type=0};G.prototype.Set=function(e){this.m_pointCount=e.m_pointCount;for(var f=0;f<h.b2_maxManifoldPoints;f++)(this.m_points[f]instanceof P?this.m_points[f]:null).Set(e.m_points[f]);this.m_localPlaneNormal.SetV(e.m_localPlaneNormal);this.m_localPoint.SetV(e.m_localPoint);this.m_type=e.m_type};G.prototype.Copy=function(){var e=new G;e.Set(this);return e};Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=
1;Box2D.Collision.b2Manifold.e_faceA=2;Box2D.Collision.b2Manifold.e_faceB=4});P.b2ManifoldPoint=function(){this.m_localPoint=new a;this.m_id=new w};P.prototype.b2ManifoldPoint=function(){this.Reset()};P.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_tangentImpulse=this.m_normalImpulse=0;this.m_id.key=0};P.prototype.Set=function(e){this.m_localPoint.SetV(e.m_localPoint);this.m_normalImpulse=e.m_normalImpulse;this.m_tangentImpulse=e.m_tangentImpulse;this.m_id.Set(e.m_id)};J.b2Point=function(){this.p=
new a};J.prototype.Support=function(e,f,a){return this.p};J.prototype.GetFirstVertex=function(e){return this.p};D.b2RayCastInput=function(){this.p1=new a;this.p2=new a};D.prototype.b2RayCastInput=function(e,f,a){void 0===e&&(e=null);void 0===f&&(f=null);void 0===a&&(a=1);e&&this.p1.SetV(e);f&&this.p2.SetV(f);this.maxFraction=a};O.b2RayCastOutput=function(){this.normal=new a};M.b2Segment=function(){this.p1=new a;this.p2=new a};M.prototype.TestSegment=function(e,f,a,u){void 0===u&&(u=0);var r=a.p1,
k=a.p2.x-r.x,v=a.p2.y-r.y;a=this.p2.y-this.p1.y;var q=-(this.p2.x-this.p1.x),b=100*Number.MIN_VALUE,d=-(k*a+v*q);if(d>b){var c=r.x-this.p1.x,l=r.y-this.p1.y,r=c*a+l*q;if(0<=r&&r<=u*d&&(u=-k*l+v*c,-b*d<=u&&u<=d*(1+b)))return u=Math.sqrt(a*a+q*q),e[0]=r/d,f.Set(a/u,q/u),!0}return!1};M.prototype.Extend=function(e){this.ExtendForward(e);this.ExtendBackward(e)};M.prototype.ExtendForward=function(e){var f=this.p2.x-this.p1.x,a=this.p2.y-this.p1.y;e=Math.min(0<f?(e.upperBound.x-this.p1.x)/f:0>f?(e.lowerBound.x-
this.p1.x)/f:Number.POSITIVE_INFINITY,0<a?(e.upperBound.y-this.p1.y)/a:0>a?(e.lowerBound.y-this.p1.y)/a:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+f*e;this.p2.y=this.p1.y+a*e};M.prototype.ExtendBackward=function(e){var f=-this.p2.x+this.p1.x,a=-this.p2.y+this.p1.y;e=Math.min(0<f?(e.upperBound.x-this.p2.x)/f:0>f?(e.lowerBound.x-this.p2.x)/f:Number.POSITIVE_INFINITY,0<a?(e.upperBound.y-this.p2.y)/a:0>a?(e.lowerBound.y-this.p2.y)/a:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+f*e;this.p1.y=this.p2.y+
a*e};f.b2SeparationFunction=function(){this.m_localPoint=new a;this.m_axis=new a};f.prototype.Initialize=function(e,u,r,k,v){this.m_proxyA=u;this.m_proxyB=k;u=parseInt(e.count);h.b2Assert(0<u&&3>u);var q,b,c,l;if(1==u)this.m_type=f.e_points,q=this.m_proxyA.GetVertex(e.indexA[0]),b=this.m_proxyB.GetVertex(e.indexB[0]),l=q,c=r.R,q=r.position.x+(c.col1.x*l.x+c.col2.x*l.y),r=r.position.y+(c.col1.y*l.x+c.col2.y*l.y),l=b,c=v.R,b=v.position.x+(c.col1.x*l.x+c.col2.x*l.y),v=v.position.y+(c.col1.y*l.x+c.col2.y*
l.y),this.m_axis.x=b-q,this.m_axis.y=v-r,this.m_axis.Normalize();else if(e.indexB[0]==e.indexB[1])this.m_type=f.e_faceA,u=this.m_proxyA.GetVertex(e.indexA[0]),k=this.m_proxyA.GetVertex(e.indexA[1]),b=this.m_proxyB.GetVertex(e.indexB[0]),this.m_localPoint.x=.5*(u.x+k.x),this.m_localPoint.y=.5*(u.y+k.y),this.m_axis=d.CrossVF(d.SubtractVV(k,u),1),this.m_axis.Normalize(),l=this.m_axis,c=r.R,u=c.col1.x*l.x+c.col2.x*l.y,k=c.col1.y*l.x+c.col2.y*l.y,l=this.m_localPoint,c=r.R,q=r.position.x+(c.col1.x*l.x+
c.col2.x*l.y),r=r.position.y+(c.col1.y*l.x+c.col2.y*l.y),l=b,c=v.R,b=v.position.x+(c.col1.x*l.x+c.col2.x*l.y),v=v.position.y+(c.col1.y*l.x+c.col2.y*l.y),0>(b-q)*u+(v-r)*k&&this.m_axis.NegativeSelf();else if(e.indexA[0]==e.indexA[0])this.m_type=f.e_faceB,c=this.m_proxyB.GetVertex(e.indexB[0]),l=this.m_proxyB.GetVertex(e.indexB[1]),q=this.m_proxyA.GetVertex(e.indexA[0]),this.m_localPoint.x=.5*(c.x+l.x),this.m_localPoint.y=.5*(c.y+l.y),this.m_axis=d.CrossVF(d.SubtractVV(l,c),1),this.m_axis.Normalize(),
l=this.m_axis,c=v.R,u=c.col1.x*l.x+c.col2.x*l.y,k=c.col1.y*l.x+c.col2.y*l.y,l=this.m_localPoint,c=v.R,b=v.position.x+(c.col1.x*l.x+c.col2.x*l.y),v=v.position.y+(c.col1.y*l.x+c.col2.y*l.y),l=q,c=r.R,q=r.position.x+(c.col1.x*l.x+c.col2.x*l.y),r=r.position.y+(c.col1.y*l.x+c.col2.y*l.y),0>(q-b)*u+(r-v)*k&&this.m_axis.NegativeSelf();else{u=this.m_proxyA.GetVertex(e.indexA[0]);k=this.m_proxyA.GetVertex(e.indexA[1]);c=this.m_proxyB.GetVertex(e.indexB[0]);l=this.m_proxyB.GetVertex(e.indexB[1]);d.MulX(r,q);
q=d.MulMV(r.R,d.SubtractVV(k,u));d.MulX(v,b);e=d.MulMV(v.R,d.SubtractVV(l,c));v=q.x*q.x+q.y*q.y;b=e.x*e.x+e.y*e.y;var z=d.SubtractVV(e,q);r=q.x*z.x+q.y*z.y;z=e.x*z.x+e.y*z.y;q=q.x*e.x+q.y*e.y;var I=v*b-q*q;e=0;0!=I&&(e=d.Clamp((q*z-r*b)/I,0,1));0>(q*e+z)/b&&(e=d.Clamp((q-r)/v,0,1));q=new a;q.x=u.x+e*(k.x-u.x);q.y=u.y+e*(k.y-u.y);b=new a;b.x=c.x+e*(l.x-c.x);b.y=c.y+e*(l.y-c.y);0==e||1==e?(this.m_type=f.e_faceB,this.m_axis=d.CrossVF(d.SubtractVV(l,c),1),this.m_axis.Normalize(),this.m_localPoint=b):
(this.m_type=f.e_faceA,this.m_axis=d.CrossVF(d.SubtractVV(k,u),1),this.m_localPoint=q);0>e&&this.m_axis.NegativeSelf()}};f.prototype.Evaluate=function(e,a){var u,r,k;switch(this.m_type){case f.e_points:return u=d.MulTMV(e.R,this.m_axis),r=d.MulTMV(a.R,this.m_axis.GetNegative()),u=this.m_proxyA.GetSupportVertex(u),r=this.m_proxyB.GetSupportVertex(r),u=d.MulX(e,u),r=d.MulX(a,r),k=(r.x-u.x)*this.m_axis.x+(r.y-u.y)*this.m_axis.y;case f.e_faceA:return k=d.MulMV(e.R,this.m_axis),u=d.MulX(e,this.m_localPoint),
r=d.MulTMV(a.R,k.GetNegative()),r=this.m_proxyB.GetSupportVertex(r),r=d.MulX(a,r),k=(r.x-u.x)*k.x+(r.y-u.y)*k.y;case f.e_faceB:return k=d.MulMV(a.R,this.m_axis),r=d.MulX(a,this.m_localPoint),u=d.MulTMV(e.R,k.GetNegative()),u=this.m_proxyA.GetSupportVertex(u),u=d.MulX(e,u),k=(u.x-r.x)*k.x+(u.y-r.y)*k.y;default:return h.b2Assert(!1),0}};Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1;Box2D.Collision.b2SeparationFunction.e_faceA=2;Box2D.Collision.b2SeparationFunction.e_faceB=
4});r.b2Simplex=function(){this.m_v1=new q;this.m_v2=new q;this.m_v3=new q;this.m_vertices=new Vector(3)};r.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};r.prototype.ReadCache=function(e,f,a,u,r){h.b2Assert(0<=e.count&&3>=e.count);var k,v;this.m_count=e.count;for(var q=this.m_vertices,b=0;b<this.m_count;b++){var c=q[b];c.indexA=e.indexA[b];c.indexB=e.indexB[b];k=f.GetVertex(c.indexA);v=u.GetVertex(c.indexB);c.wA=d.MulX(a,k);
c.wB=d.MulX(r,v);c.w=d.SubtractVV(c.wB,c.wA);c.a=0}1<this.m_count&&(e=e.metric,k=this.GetMetric(),k<.5*e||2*e<k||k<Number.MIN_VALUE)&&(this.m_count=0);0==this.m_count&&(c=q[0],c.indexA=0,c.indexB=0,k=f.GetVertex(0),v=u.GetVertex(0),c.wA=d.MulX(a,k),c.wB=d.MulX(r,v),c.w=d.SubtractVV(c.wB,c.wA),this.m_count=1)};r.prototype.WriteCache=function(e){e.metric=this.GetMetric();e.count=Box2D.parseUInt(this.m_count);for(var f=this.m_vertices,a=0;a<this.m_count;a++)e.indexA[a]=Box2D.parseUInt(f[a].indexA),e.indexB[a]=
Box2D.parseUInt(f[a].indexB)};r.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var e=d.SubtractVV(this.m_v2.w,this.m_v1.w);return 0<d.CrossVV(e,this.m_v1.w.GetNegative())?d.CrossFV(1,e):d.CrossVF(e,1);default:return h.b2Assert(!1),new a}};r.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return h.b2Assert(!1),new a;case 1:return this.m_v1.w;case 2:return new a(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*
this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return h.b2Assert(!1),new a}};r.prototype.GetWitnessPoints=function(e,f){switch(this.m_count){case 0:h.b2Assert(!1);break;case 1:e.SetV(this.m_v1.wA);f.SetV(this.m_v1.wB);break;case 2:e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;f.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;f.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:f.x=e.x=this.m_v1.a*this.m_v1.wA.x+
this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;f.y=e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:h.b2Assert(!1)}};r.prototype.GetMetric=function(){switch(this.m_count){case 0:return h.b2Assert(!1),0;case 1:return 0;case 2:return d.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return d.CrossVV(d.SubtractVV(this.m_v2.w,this.m_v1.w),d.SubtractVV(this.m_v3.w,this.m_v1.w));default:return h.b2Assert(!1),0}};r.prototype.Solve2=function(){var e=
this.m_v1.w,f=this.m_v2.w,a=d.SubtractVV(f,e),e=-(e.x*a.x+e.y*a.y);0>=e?this.m_count=this.m_v1.a=1:(f=f.x*a.x+f.y*a.y,0>=f?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(a=1/(f+e),this.m_v1.a=f*a,this.m_v2.a=e*a,this.m_count=2))};r.prototype.Solve3=function(){var e=this.m_v1.w,f=this.m_v2.w,a=this.m_v3.w,u=d.SubtractVV(f,e),r=d.Dot(e,u),k=d.Dot(f,u),r=-r,v=d.SubtractVV(a,e),q=d.Dot(e,v),b=d.Dot(a,v),q=-q,c=d.SubtractVV(a,f),l=d.Dot(f,c),c=d.Dot(a,c),l=-l,v=d.CrossVV(u,v),u=v*d.CrossVV(f,a),
a=v*d.CrossVV(a,e),e=v*d.CrossVV(e,f);0>=r&&0>=q?this.m_count=this.m_v1.a=1:0<k&&0<r&&0>=e?(b=1/(k+r),this.m_v1.a=k*b,this.m_v2.a=r*b,this.m_count=2):0<b&&0<q&&0>=a?(k=1/(b+q),this.m_v1.a=b*k,this.m_v3.a=q*k,this.m_count=2,this.m_v2.Set(this.m_v3)):0>=k&&0>=l?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):0>=b&&0>=c?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):0<c&&0<l&&0>=u?(k=1/(c+l),this.m_v2.a=c*k,this.m_v3.a=l*k,this.m_count=2,this.m_v1.Set(this.m_v3)):(k=1/(u+a+e),this.m_v1.a=
u*k,this.m_v2.a=a*k,this.m_v3.a=e*k,this.m_count=3)};z.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3);this.indexB=new Vector_a2j_Number(3)};q.b2SimplexVertex=function(){};q.prototype.Set=function(e){this.wA.SetV(e.wA);this.wB.SetV(e.wB);this.w.SetV(e.w);this.a=e.a;this.indexA=e.indexA;this.indexB=e.indexB};I.b2TimeOfImpact=function(){};I.TimeOfImpact=function(e){++I.b2_toiCalls;var f=e.proxyA,a=e.proxyB,u=e.sweepA,r=e.sweepB;h.b2Assert(u.t0==r.t0);h.b2Assert(1-u.t0>Number.MIN_VALUE);
var k=f.m_radius+a.m_radius;e=e.tolerance;var v=0,q=0,b=0;I.s_cache.count=0;for(I.s_distanceInput.useRadii=!1;;){u.GetTransform(I.s_xfA,v);r.GetTransform(I.s_xfB,v);I.s_distanceInput.proxyA=f;I.s_distanceInput.proxyB=a;I.s_distanceInput.transformA=I.s_xfA;I.s_distanceInput.transformB=I.s_xfB;E.Distance(I.s_distanceOutput,I.s_cache,I.s_distanceInput);if(0>=I.s_distanceOutput.distance){v=1;break}I.s_fcn.Initialize(I.s_cache,f,I.s_xfA,a,I.s_xfB);var c=I.s_fcn.Evaluate(I.s_xfA,I.s_xfB);if(0>=c){v=1;break}0==
q&&(b=c>k?d.Max(k-e,.75*k):d.Max(c-e,.02*k));if(c-b<.5*e){if(0==q){v=1;break}break}var l=v,z=v,L=1;u.GetTransform(I.s_xfA,L);r.GetTransform(I.s_xfB,L);var g=I.s_fcn.Evaluate(I.s_xfA,I.s_xfB);if(g>=b){v=1;break}for(var N=0;;){var n;n=N&1?z+(b-c)*(L-z)/(g-c):.5*(z+L);u.GetTransform(I.s_xfA,n);r.GetTransform(I.s_xfB,n);var p=I.s_fcn.Evaluate(I.s_xfA,I.s_xfB);if(d.Abs(p-b)<.025*e){l=n;break}p>b?(z=n,c=p):(L=n,g=p);++N;++I.b2_toiRootIters;if(50==N)break}I.b2_toiMaxRootIters=d.Max(I.b2_toiMaxRootIters,
N);if(l<(1+100*Number.MIN_VALUE)*v)break;v=l;q++;++I.b2_toiIters;if(1E3==q)break}I.b2_toiMaxIters=d.Max(I.b2_toiMaxIters,q);return v};Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0;Box2D.Collision.b2TimeOfImpact.b2_toiIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;Box2D.Collision.b2TimeOfImpact.s_cache=new z;Box2D.Collision.b2TimeOfImpact.s_distanceInput=new C;
Box2D.Collision.b2TimeOfImpact.s_xfA=new m;Box2D.Collision.b2TimeOfImpact.s_xfB=new m;Box2D.Collision.b2TimeOfImpact.s_fcn=new f;Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new k});N.b2TOIInput=function(){this.proxyA=new A;this.proxyB=new A;this.sweepA=new c;this.sweepB=new c};L.b2WorldManifold=function(){this.m_normal=new a};L.prototype.b2WorldManifold=function(){this.m_points=new Vector(h.b2_maxManifoldPoints);for(var e=0;e<h.b2_maxManifoldPoints;e++)this.m_points[e]=new a};L.prototype.Initialize=
function(e,f,a,u,r){void 0===a&&(a=0);void 0===r&&(r=0);if(0!=e.m_pointCount){var k,v,q,b,c,d,l,z;switch(e.m_type){case G.e_circles:q=f.R;v=e.m_localPoint;k=f.position.x+q.col1.x*v.x+q.col2.x*v.y;f=f.position.y+q.col1.y*v.x+q.col2.y*v.y;q=u.R;v=e.m_points[0].m_localPoint;e=u.position.x+q.col1.x*v.x+q.col2.x*v.y;u=u.position.y+q.col1.y*v.x+q.col2.y*v.y;v=e-k;q=u-f;b=v*v+q*q;b>Number.MIN_VALUE*Number.MIN_VALUE?(b=Math.sqrt(b),this.m_normal.x=v/b,this.m_normal.y=q/b):(this.m_normal.x=1,this.m_normal.y=
0);v=f+a*this.m_normal.y;u-=r*this.m_normal.y;this.m_points[0].x=.5*(k+a*this.m_normal.x+(e-r*this.m_normal.x));this.m_points[0].y=.5*(v+u);break;case G.e_faceA:q=f.R;v=e.m_localPlaneNormal;b=q.col1.x*v.x+q.col2.x*v.y;c=q.col1.y*v.x+q.col2.y*v.y;q=f.R;v=e.m_localPoint;d=f.position.x+q.col1.x*v.x+q.col2.x*v.y;l=f.position.y+q.col1.y*v.x+q.col2.y*v.y;this.m_normal.x=b;this.m_normal.y=c;for(k=0;k<e.m_pointCount;k++)q=u.R,v=e.m_points[k].m_localPoint,z=u.position.x+q.col1.x*v.x+q.col2.x*v.y,v=u.position.y+
q.col1.y*v.x+q.col2.y*v.y,this.m_points[k].x=z+.5*(a-(z-d)*b-(v-l)*c-r)*b,this.m_points[k].y=v+.5*(a-(z-d)*b-(v-l)*c-r)*c;break;case G.e_faceB:for(q=u.R,v=e.m_localPlaneNormal,b=q.col1.x*v.x+q.col2.x*v.y,c=q.col1.y*v.x+q.col2.y*v.y,q=u.R,v=e.m_localPoint,d=u.position.x+q.col1.x*v.x+q.col2.x*v.y,l=u.position.y+q.col1.y*v.x+q.col2.y*v.y,this.m_normal.x=-b,this.m_normal.y=-c,k=0;k<e.m_pointCount;k++)q=f.R,v=e.m_points[k].m_localPoint,z=f.position.x+q.col1.x*v.x+q.col2.x*v.y,v=f.position.y+q.col1.y*v.x+
q.col2.y*v.y,this.m_points[k].x=z+.5*(r-(z-d)*b-(v-l)*c-a)*b,this.m_points[k].y=v+.5*(r-(z-d)*b-(v-l)*c-a)*c}}};e.ClipVertex=function(){this.v=new a;this.id=new w};e.prototype.Set=function(e){this.v.SetV(e.v);this.id.Set(e.id)};u.Features=function(){};Object.defineProperty(u.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}});Object.defineProperty(u.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(e){void 0===e&&(e=0);this._referenceEdge=
e;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}});Object.defineProperty(u.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}});Object.defineProperty(u.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(e){void 0===e&&(e=0);this._incidentEdge=e;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}});Object.defineProperty(u.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}});
Object.defineProperty(u.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(e){void 0===e&&(e=0);this._incidentVertex=e;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}});Object.defineProperty(u.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}});Object.defineProperty(u.prototype,"flip",{enumerable:!1,configurable:!0,set:function(e){void 0===e&&(e=0);this._flip=e;this._m_id._key=this._m_id._key&16777215|this._flip<<24&
4278190080}})})();
(function(){var b=Box2D.Common.b2Settings,n=Box2D.Collision.Shapes.b2CircleShape,g=Box2D.Collision.Shapes.b2EdgeChainDef,h=Box2D.Collision.Shapes.b2EdgeShape,d=Box2D.Collision.Shapes.b2MassData,c=Box2D.Collision.Shapes.b2PolygonShape,m=Box2D.Collision.Shapes.b2Shape,a=Box2D.Common.Math.b2Mat22,l=Box2D.Common.Math.b2Math,p=Box2D.Common.Math.b2Transform,x=Box2D.Common.Math.b2Vec2,y=Box2D.Collision.b2Distance,w=Box2D.Collision.b2DistanceInput,t=Box2D.Collision.b2DistanceOutput,E=Box2D.Collision.b2DistanceProxy,C=
Box2D.Collision.b2SimplexCache;Box2D.inherit(n,Box2D.Collision.Shapes.b2Shape);n.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;n.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.m_p=new x};n.prototype.Copy=function(){var a=new n;a.Set(this);return a};n.prototype.Set=function(a){this.__super.Set.call(this,a);Box2D.is(a,n)&&this.m_p.SetV((a instanceof n?a:null).m_p)};n.prototype.TestPoint=function(a,b){var c=a.R,d=a.position.x+(c.col1.x*this.m_p.x+
c.col2.x*this.m_p.y),c=a.position.y+(c.col1.y*this.m_p.x+c.col2.y*this.m_p.y),d=b.x-d,c=b.y-c;return d*d+c*c<=this.m_radius*this.m_radius};n.prototype.RayCast=function(a,b,c){var d=c.R,l=b.p1.x-(c.position.x+(d.col1.x*this.m_p.x+d.col2.x*this.m_p.y));c=b.p1.y-(c.position.y+(d.col1.y*this.m_p.x+d.col2.y*this.m_p.y));var d=b.p2.x-b.p1.x,h=b.p2.y-b.p1.y,g=l*d+c*h,n=d*d+h*h,p=g*g-n*(l*l+c*c-this.m_radius*this.m_radius);if(0>p||n<Number.MIN_VALUE)return!1;g=-(g+Math.sqrt(p));return 0<=g&&g<=b.maxFraction*
n?(g/=n,a.fraction=g,a.normal.x=l+g*d,a.normal.y=c+g*h,a.normal.Normalize(),!0):!1};n.prototype.ComputeAABB=function(a,b){var c=b.R,d=b.position.x+(c.col1.x*this.m_p.x+c.col2.x*this.m_p.y),c=b.position.y+(c.col1.y*this.m_p.x+c.col2.y*this.m_p.y);a.lowerBound.Set(d-this.m_radius,c-this.m_radius);a.upperBound.Set(d+this.m_radius,c+this.m_radius)};n.prototype.ComputeMass=function(a,c){void 0===c&&(c=0);a.mass=c*b.b2_pi*this.m_radius*this.m_radius;a.center.SetV(this.m_p);a.I=a.mass*(.5*this.m_radius*
this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};n.prototype.ComputeSubmergedArea=function(a,b,c,d){void 0===b&&(b=0);c=l.MulX(c,this.m_p);var h=-(l.Dot(a,c)-b);if(h<-this.m_radius+Number.MIN_VALUE)return 0;if(h>this.m_radius)return d.SetV(c),Math.PI*this.m_radius*this.m_radius;b=this.m_radius*this.m_radius;var g=h*h,h=b*(Math.asin(h/this.m_radius)+Math.PI/2)+h*Math.sqrt(b-g);b=-2/3*Math.pow(b-g,1.5)/h;d.x=c.x+a.x*b;d.y=c.y+a.y*b;return h};n.prototype.GetLocalPosition=function(){return this.m_p};
n.prototype.SetLocalPosition=function(a){this.m_p.SetV(a)};n.prototype.GetRadius=function(){return this.m_radius};n.prototype.SetRadius=function(a){void 0===a&&(a=0);this.m_radius=a};n.prototype.b2CircleShape=function(a){void 0===a&&(a=0);this.__super.b2Shape.call(this);this.m_type=m.e_circleShape;this.m_radius=a};g.b2EdgeChainDef=function(){};g.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=!0;this.vertices=[]};Box2D.inherit(h,Box2D.Collision.Shapes.b2Shape);h.prototype.__super=
Box2D.Collision.Shapes.b2Shape.prototype;h.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new x;this.m_v1=new x;this.m_v2=new x;this.m_coreV1=new x;this.m_coreV2=new x;this.m_normal=new x;this.m_direction=new x;this.m_cornerDir1=new x;this.m_cornerDir2=new x};h.prototype.TestPoint=function(a,b){return!1};h.prototype.RayCast=function(a,b,c){var d,l=b.p2.x-b.p1.x,h=b.p2.y-b.p1.y;d=c.R;var g=c.position.x+(d.col1.x*this.m_v1.x+d.col2.x*this.m_v1.y),
n=c.position.y+(d.col1.y*this.m_v1.x+d.col2.y*this.m_v1.y),p=c.position.y+(d.col1.y*this.m_v2.x+d.col2.y*this.m_v2.y)-n;c=-(c.position.x+(d.col1.x*this.m_v2.x+d.col2.x*this.m_v2.y)-g);d=100*Number.MIN_VALUE;var m=-(l*p+h*c);if(m>d){var g=b.p1.x-g,t=b.p1.y-n,n=g*p+t*c;if(0<=n&&n<=b.maxFraction*m&&(b=-l*t+h*g,-d*m<=b&&b<=m*(1+d)))return a.fraction=n/m,b=Math.sqrt(p*p+c*c),a.normal.x=p/b,a.normal.y=c/b,!0}return!1};h.prototype.ComputeAABB=function(a,b){var c=b.R,d=b.position.x+(c.col1.x*this.m_v1.x+
c.col2.x*this.m_v1.y),l=b.position.y+(c.col1.y*this.m_v1.x+c.col2.y*this.m_v1.y),h=b.position.x+(c.col1.x*this.m_v2.x+c.col2.x*this.m_v2.y),c=b.position.y+(c.col1.y*this.m_v2.x+c.col2.y*this.m_v2.y);d<h?(a.lowerBound.x=d,a.upperBound.x=h):(a.lowerBound.x=h,a.upperBound.x=d);l<c?(a.lowerBound.y=l,a.upperBound.y=c):(a.lowerBound.y=c,a.upperBound.y=l)};h.prototype.ComputeMass=function(a,b){a.mass=0;a.center.SetV(this.m_v1);a.I=0};h.prototype.ComputeSubmergedArea=function(a,b,c,d){void 0===b&&(b=0);var h=
new x(a.x*b,a.y*b),g=l.MulX(c,this.m_v1);c=l.MulX(c,this.m_v2);var n=l.Dot(a,g)-b;a=l.Dot(a,c)-b;if(0<n){if(0<a)return 0;g.x=-a/(n-a)*g.x+n/(n-a)*c.x;g.y=-a/(n-a)*g.y+n/(n-a)*c.y}else 0<a&&(c.x=-a/(n-a)*g.x+n/(n-a)*c.x,c.y=-a/(n-a)*g.y+n/(n-a)*c.y);d.x=(h.x+g.x+c.x)/3;d.y=(h.y+g.y+c.y)/3;return.5*((g.x-h.x)*(c.y-h.y)-(g.y-h.y)*(c.x-h.x))};h.prototype.GetLength=function(){return this.m_length};h.prototype.GetVertex1=function(){return this.m_v1};h.prototype.GetVertex2=function(){return this.m_v2};h.prototype.GetCoreVertex1=
function(){return this.m_coreV1};h.prototype.GetCoreVertex2=function(){return this.m_coreV2};h.prototype.GetNormalVector=function(){return this.m_normal};h.prototype.GetDirectionVector=function(){return this.m_direction};h.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};h.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};h.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};h.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};h.prototype.GetFirstVertex=
function(a){var b=a.R;return new x(a.position.x+(b.col1.x*this.m_coreV1.x+b.col2.x*this.m_coreV1.y),a.position.y+(b.col1.y*this.m_coreV1.x+b.col2.y*this.m_coreV1.y))};h.prototype.GetNextEdge=function(){return this.m_nextEdge};h.prototype.GetPrevEdge=function(){return this.m_prevEdge};h.prototype.Support=function(a,b,c){void 0===b&&(b=0);void 0===c&&(c=0);var d=a.R,l=a.position.x+(d.col1.x*this.m_coreV1.x+d.col2.x*this.m_coreV1.y),h=a.position.y+(d.col1.y*this.m_coreV1.x+d.col2.y*this.m_coreV1.y),
g=a.position.x+(d.col1.x*this.m_coreV2.x+d.col2.x*this.m_coreV2.y);a=a.position.y+(d.col1.y*this.m_coreV2.x+d.col2.y*this.m_coreV2.y);l*b+h*c>g*b+a*c?(this.s_supportVec.x=l,this.s_supportVec.y=h):(this.s_supportVec.x=g,this.s_supportVec.y=a);return this.s_supportVec};h.prototype.b2EdgeShape=function(a,c){this.__super.b2Shape.call(this);this.m_type=m.e_edgeShape;this.m_nextEdge=this.m_prevEdge=null;this.m_v1=a;this.m_v2=c;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=
this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-b.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-b.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.Set(-b.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-b.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)};h.prototype.SetPrevEdge=function(a,
b,c,d){this.m_prevEdge=a;this.m_coreV1=b;this.m_cornerDir1=c;this.m_cornerConvex1=d};h.prototype.SetNextEdge=function(a,b,c,d){this.m_nextEdge=a;this.m_coreV2=b;this.m_cornerDir2=c;this.m_cornerConvex2=d};d.b2MassData=function(){this.mass=0;this.center=new x(0,0);this.I=0};Box2D.inherit(c,Box2D.Collision.Shapes.b2Shape);c.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;c.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};c.prototype.Copy=function(){var a=
new c;a.Set(this);return a};c.prototype.Set=function(a){this.__super.Set.call(this,a);if(Box2D.is(a,c)){a=a instanceof c?a:null;this.m_centroid.SetV(a.m_centroid);this.m_vertexCount=a.m_vertexCount;this.Reserve(this.m_vertexCount);for(var b=0;b<this.m_vertexCount;b++)this.m_vertices[b].SetV(a.m_vertices[b]),this.m_normals[b].SetV(a.m_normals[b])}};c.prototype.SetAsArray=function(a,b){void 0===b&&(b=0);var c=new Vector,d,l;for(d=0;d<a.length;++d)l=a[d],c.push(l);this.SetAsVector(c,b)};c.AsArray=function(a,
b){void 0===b&&(b=0);var d=new c;d.SetAsArray(a,b);return d};c.prototype.SetAsVector=function(a,d){void 0===d&&(d=0);0==d&&(d=a.length);b.b2Assert(2<=d);this.m_vertexCount=d;this.Reserve(d);var h;for(h=0;h<this.m_vertexCount;h++)this.m_vertices[h].SetV(a[h]);for(h=0;h<this.m_vertexCount;++h){var g=parseInt(h),n=parseInt(h+1<this.m_vertexCount?h+1:0),g=l.SubtractVV(this.m_vertices[n],this.m_vertices[g]);b.b2Assert(g.LengthSquared()>Number.MIN_VALUE);this.m_normals[h].SetV(l.CrossVF(g,1));this.m_normals[h].Normalize()}this.m_centroid=
c.ComputeCentroid(this.m_vertices,this.m_vertexCount)};c.AsVector=function(a,b){void 0===b&&(b=0);var d=new c;d.SetAsVector(a,b);return d};c.prototype.SetAsBox=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-a,-b);this.m_vertices[1].Set(a,-b);this.m_vertices[2].Set(a,b);this.m_vertices[3].Set(-a,b);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero()};c.AsBox=
function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);var d=new c;d.SetAsBox(a,b);return d};c.prototype.SetAsOrientedBox=function(a,b,c,d){void 0===a&&(a=0);void 0===b&&(b=0);void 0===c&&(c=null);void 0===d&&(d=0);this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-a,-b);this.m_vertices[1].Set(a,-b);this.m_vertices[2].Set(a,b);this.m_vertices[3].Set(-a,b);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid=c;a=new p;a.position=
c;a.R.Set(d);for(c=0;c<this.m_vertexCount;++c)this.m_vertices[c]=l.MulX(a,this.m_vertices[c]),this.m_normals[c]=l.MulMV(a.R,this.m_normals[c])};c.AsOrientedBox=function(a,b,d,l){void 0===a&&(a=0);void 0===b&&(b=0);void 0===d&&(d=null);void 0===l&&(l=0);var h=new c;h.SetAsOrientedBox(a,b,d,l);return h};c.prototype.SetAsEdge=function(a,b){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(a);this.m_vertices[1].SetV(b);this.m_centroid.x=.5*(a.x+b.x);this.m_centroid.y=.5*(a.y+b.y);this.m_normals[0]=
l.CrossVF(l.SubtractVV(b,a),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};c.AsEdge=function(a,b){var d=new c;d.SetAsEdge(a,b);return d};c.prototype.TestPoint=function(a,b){var c;c=a.R;for(var d=b.x-a.position.x,l=b.y-a.position.y,h=d*c.col1.x+l*c.col1.y,g=d*c.col2.x+l*c.col2.y,n=0;n<this.m_vertexCount;++n)if(c=this.m_vertices[n],d=h-c.x,l=g-c.y,c=this.m_normals[n],0<c.x*d+c.y*l)return!1;return!0};c.prototype.RayCast=function(a,
b,c){var d=0,l=b.maxFraction,h,g,n,p;h=b.p1.x-c.position.x;g=b.p1.y-c.position.y;n=c.R;var m=h*n.col1.x+g*n.col1.y,t=h*n.col2.x+g*n.col2.y;h=b.p2.x-c.position.x;g=b.p2.y-c.position.y;n=c.R;b=h*n.col1.x+g*n.col1.y-m;n=h*n.col2.x+g*n.col2.y-t;for(var w=-1,f=0;f<this.m_vertexCount;++f){p=this.m_vertices[f];h=p.x-m;g=p.y-t;p=this.m_normals[f];h=p.x*h+p.y*g;g=p.x*b+p.y*n;if(0==g){if(0>h)return!1}else 0>g&&h<d*g?(d=h/g,w=f):0<g&&h<l*g&&(l=h/g);if(l<d-Number.MIN_VALUE)return!1}return 0<=w?(a.fraction=d,
n=c.R,p=this.m_normals[w],a.normal.x=n.col1.x*p.x+n.col2.x*p.y,a.normal.y=n.col1.y*p.x+n.col2.y*p.y,!0):!1};c.prototype.ComputeAABB=function(a,b){for(var c=b.R,d=this.m_vertices[0],l=b.position.x+(c.col1.x*d.x+c.col2.x*d.y),h=b.position.y+(c.col1.y*d.x+c.col2.y*d.y),g=l,n=h,p=1;p<this.m_vertexCount;++p)var d=this.m_vertices[p],m=b.position.x+(c.col1.x*d.x+c.col2.x*d.y),d=b.position.y+(c.col1.y*d.x+c.col2.y*d.y),l=l<m?l:m,h=h<d?h:d,g=g>m?g:m,n=n>d?n:d;a.lowerBound.x=l-this.m_radius;a.lowerBound.y=
h-this.m_radius;a.upperBound.x=g+this.m_radius;a.upperBound.y=n+this.m_radius};c.prototype.ComputeMass=function(a,b){void 0===b&&(b=0);if(2==this.m_vertexCount)a.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),a.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),a.mass=0,a.I=0;else{for(var c=0,d=0,l=0,h=0,g=1/3,n=0;n<this.m_vertexCount;++n)var p=this.m_vertices[n],m=n+1<this.m_vertexCount?this.m_vertices[parseInt(n+1)]:this.m_vertices[0],t=p.x-0,w=p.y-0,f=m.x-0,r=m.y-0,z=t*r-w*f,q=.5*
z,l=l+q,c=c+q*g*(0+p.x+m.x),d=d+q*g*(0+p.y+m.y),p=t,h=h+z*(g*(.25*(p*p+f*p+f*f)+(0*p+0*f))+0+(g*(.25*(w*w+r*w+r*r)+(0*w+0*r))+0));a.mass=b*l;a.center.Set(1/l*c,1/l*d);a.I=b*h}};c.prototype.ComputeSubmergedArea=function(a,b,c,h){void 0===b&&(b=0);var g=l.MulTMV(c.R,a),n=b-l.Dot(a,c.position),p=new Vector_a2j_Number,m=0,t=-1;b=-1;var w=!1;for(a=0;a<this.m_vertexCount;++a){p[a]=l.Dot(g,this.m_vertices[a])-n;var y=p[a]<-Number.MIN_VALUE;0<a&&(y?w||(t=a-1,m++):w&&(b=a-1,m++));w=y}switch(m){case 0:return w?
(a=new d,this.ComputeMass(a,1),h.SetV(l.MulX(c,a.center)),a.mass):0;case 1:-1==t?t=this.m_vertexCount-1:b=this.m_vertexCount-1}a=parseInt((t+1)%this.m_vertexCount);g=parseInt((b+1)%this.m_vertexCount);n=(0-p[t])/(p[a]-p[t]);p=(0-p[b])/(p[g]-p[b]);t=new x(this.m_vertices[t].x*(1-n)+this.m_vertices[a].x*n,this.m_vertices[t].y*(1-n)+this.m_vertices[a].y*n);b=new x(this.m_vertices[b].x*(1-p)+this.m_vertices[g].x*p,this.m_vertices[b].y*(1-p)+this.m_vertices[g].y*p);p=0;n=new x;for(m=this.m_vertices[a];a!=
g;)a=(a+1)%this.m_vertexCount,w=a==g?b:this.m_vertices[a],y=.5*((m.x-t.x)*(w.y-t.y)-(m.y-t.y)*(w.x-t.x)),p+=y,n.x+=y*(t.x+m.x+w.x)/3,n.y+=y*(t.y+m.y+w.y)/3,m=w;n.Multiply(1/p);h.SetV(l.MulX(c,n));return p};c.prototype.GetVertexCount=function(){return this.m_vertexCount};c.prototype.GetVertices=function(){return this.m_vertices};c.prototype.GetNormals=function(){return this.m_normals};c.prototype.GetSupport=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_vertexCount;++d){var l=
this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;l>c&&(b=d,c=l)}return b};c.prototype.GetSupportVertex=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_vertexCount;++d){var l=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;l>c&&(b=d,c=l)}return this.m_vertices[b]};c.prototype.Validate=function(){return!1};c.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=m.e_polygonShape;this.m_centroid=new x;this.m_vertices=new Vector;this.m_normals=
new Vector};c.prototype.Reserve=function(a){void 0===a&&(a=0);for(var b=parseInt(this.m_vertices.length);b<a;b++)this.m_vertices[b]=new x,this.m_normals[b]=new x};c.ComputeCentroid=function(a,b){void 0===b&&(b=0);for(var c=new x,d=0,l=1/3,h=0;h<b;++h){var g=a[h],n=h+1<b?a[parseInt(h+1)]:a[0],p=.5*((g.x-0)*(n.y-0)-(g.y-0)*(n.x-0)),d=d+p;c.x+=p*l*(0+g.x+n.x);c.y+=p*l*(0+g.y+n.y)}c.x*=1/d;c.y*=1/d;return c};c.ComputeOBB=function(a,b,c){void 0===c&&(c=0);var d,l=new Vector(c+1);for(d=0;d<c;++d)l[d]=b[d];
l[c]=l[0];b=Number.MAX_VALUE;for(d=1;d<=c;++d){for(var h=l[parseInt(d-1)],g=l[d].x-h.x,n=l[d].y-h.y,p=Math.sqrt(g*g+n*n),g=g/p,n=n/p,m=-n,t=g,w=p=Number.MAX_VALUE,f=-Number.MAX_VALUE,r=-Number.MAX_VALUE,z=0;z<c;++z){var q=l[z].x-h.x,I=l[z].y-h.y,N=g*q+n*I,q=m*q+t*I;N<p&&(p=N);q<w&&(w=q);N>f&&(f=N);q>r&&(r=q)}z=(f-p)*(r-w);z<.95*b&&(b=z,a.R.col1.x=g,a.R.col1.y=n,a.R.col2.x=m,a.R.col2.y=t,g=.5*(p+f),n=.5*(w+r),m=a.R,a.center.x=h.x+(m.col1.x*g+m.col2.x*n),a.center.y=h.y+(m.col1.y*g+m.col2.y*n),a.extents.x=
.5*(f-p),a.extents.y=.5*(r-w))}};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new a});m.b2Shape=function(){};m.prototype.Copy=function(){return null};m.prototype.Set=function(a){this.m_radius=a.m_radius};m.prototype.GetType=function(){return this.m_type};m.prototype.TestPoint=function(a,b){return!1};m.prototype.RayCast=function(a,b,c){return!1};m.prototype.ComputeAABB=function(a,b){};m.prototype.ComputeMass=function(a,b){};m.prototype.ComputeSubmergedArea=function(a,
b,c,d){return 0};m.TestOverlap=function(a,b,c,d){var l=new w;l.proxyA=new E;l.proxyA.Set(a);l.proxyB=new E;l.proxyB.Set(c);l.transformA=b;l.transformB=d;l.useRadii=!0;a=new C;a.count=0;b=new t;y.Distance(b,a,l);return b.distance<10*Number.MIN_VALUE};m.prototype.b2Shape=function(){this.m_type=m.e_unknownShape;this.m_radius=b.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=-1;Box2D.Collision.Shapes.b2Shape.e_circleShape=0;Box2D.Collision.Shapes.b2Shape.e_polygonShape=
1;Box2D.Collision.Shapes.b2Shape.e_edgeShape=2;Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3;Box2D.Collision.Shapes.b2Shape.e_hitCollide=1;Box2D.Collision.Shapes.b2Shape.e_missCollide=0;Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=-1})})();
(function(){var b=Box2D.Common.b2Color,n=Box2D.Common.b2Settings,g=Box2D.Common.Math.b2Math;b.b2Color=function(){this._b=this._g=this._r=0};b.prototype.b2Color=function(b,d,c){void 0===b&&(b=0);void 0===d&&(d=0);void 0===c&&(c=0);this._r=Box2D.parseUInt(255*g.Clamp(b,0,1));this._g=Box2D.parseUInt(255*g.Clamp(d,0,1));this._b=Box2D.parseUInt(255*g.Clamp(c,0,1))};b.prototype.Set=function(b,d,c){void 0===b&&(b=0);void 0===d&&(d=0);void 0===c&&(c=0);this._r=Box2D.parseUInt(255*g.Clamp(b,0,1));this._g=
Box2D.parseUInt(255*g.Clamp(d,0,1));this._b=Box2D.parseUInt(255*g.Clamp(c,0,1))};Object.defineProperty(b.prototype,"r",{enumerable:!1,configurable:!0,set:function(b){void 0===b&&(b=0);this._r=Box2D.parseUInt(255*g.Clamp(b,0,1))}});Object.defineProperty(b.prototype,"g",{enumerable:!1,configurable:!0,set:function(b){void 0===b&&(b=0);this._g=Box2D.parseUInt(255*g.Clamp(b,0,1))}});Object.defineProperty(b.prototype,"b",{enumerable:!1,configurable:!0,set:function(b){void 0===b&&(b=0);this._b=Box2D.parseUInt(255*
g.Clamp(b,0,1))}});Object.defineProperty(b.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}});n.b2Settings=function(){};n.b2MixFriction=function(b,d){void 0===b&&(b=0);void 0===d&&(d=0);return Math.sqrt(b*d)};n.b2MixRestitution=function(b,d){void 0===b&&(b=0);void 0===d&&(d=0);return b>d?b:d};n.b2Assert=function(b){if(!b)throw"Assertion Failed";};Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha";Box2D.Common.b2Settings.USHRT_MAX=
65535;Box2D.Common.b2Settings.b2_pi=Math.PI;Box2D.Common.b2Settings.b2_maxManifoldPoints=2;Box2D.Common.b2Settings.b2_aabbExtension=.1;Box2D.Common.b2Settings.b2_aabbMultiplier=2;Box2D.Common.b2Settings.b2_polygonRadius=2*n.b2_linearSlop;Box2D.Common.b2Settings.b2_linearSlop=.005;Box2D.Common.b2Settings.b2_angularSlop=2/180*n.b2_pi;Box2D.Common.b2Settings.b2_toiSlop=8*n.b2_linearSlop;Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32;Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32;Box2D.Common.b2Settings.b2_velocityThreshold=
1;Box2D.Common.b2Settings.b2_maxLinearCorrection=.2;Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*n.b2_pi;Box2D.Common.b2Settings.b2_maxTranslation=2;Box2D.Common.b2Settings.b2_maxTranslationSquared=n.b2_maxTranslation*n.b2_maxTranslation;Box2D.Common.b2Settings.b2_maxRotation=.5*n.b2_pi;Box2D.Common.b2Settings.b2_maxRotationSquared=n.b2_maxRotation*n.b2_maxRotation;Box2D.Common.b2Settings.b2_contactBaumgarte=.2;Box2D.Common.b2Settings.b2_timeToSleep=.5;Box2D.Common.b2Settings.b2_linearSleepTolerance=
.01;Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*n.b2_pi})})();
(function(){var b=Box2D.Common.Math.b2Mat22,n=Box2D.Common.Math.b2Mat33,g=Box2D.Common.Math.b2Math,h=Box2D.Common.Math.b2Sweep,d=Box2D.Common.Math.b2Transform,c=Box2D.Common.Math.b2Vec2,m=Box2D.Common.Math.b2Vec3;b.b2Mat22=function(){this.col1=new c;this.col2=new c};b.prototype.b2Mat22=function(){this.SetIdentity()};b.FromAngle=function(a){void 0===a&&(a=0);var c=new b;c.Set(a);return c};b.FromVV=function(a,c){var d=new b;d.SetVV(a,c);return d};b.prototype.Set=function(a){void 0===a&&(a=0);var b=
Math.cos(a);a=Math.sin(a);this.col1.x=b;this.col2.x=-a;this.col1.y=a;this.col2.y=b};b.prototype.SetVV=function(a,b){this.col1.SetV(a);this.col2.SetV(b)};b.prototype.Copy=function(){var a=new b;a.SetM(this);return a};b.prototype.SetM=function(a){this.col1.SetV(a.col1);this.col2.SetV(a.col2)};b.prototype.AddM=function(a){this.col1.x+=a.col1.x;this.col1.y+=a.col1.y;this.col2.x+=a.col2.x;this.col2.y+=a.col2.y};b.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};
b.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};b.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};b.prototype.GetInverse=function(a){var b=this.col1.x,c=this.col2.x,d=this.col1.y,h=this.col2.y,g=b*h-c*d;0!=g&&(g=1/g);a.col1.x=g*h;a.col2.x=-g*c;a.col1.y=-g*d;a.col2.y=g*b;return a};b.prototype.Solve=function(a,b,c){void 0===b&&(b=0);void 0===c&&(c=0);var d=this.col1.x,h=this.col2.x,g=this.col1.y,n=this.col2.y,m=d*n-h*g;0!=m&&(m=1/m);
a.x=m*(n*b-h*c);a.y=m*(d*c-g*b);return a};b.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};n.b2Mat33=function(){this.col1=new m;this.col2=new m;this.col3=new m};n.prototype.b2Mat33=function(a,b,c){void 0===a&&(a=null);void 0===b&&(b=null);void 0===c&&(c=null);a||b||c?(this.col1.SetV(a),this.col2.SetV(b),this.col3.SetV(c)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())};n.prototype.SetVVV=function(a,b,c){this.col1.SetV(a);this.col2.SetV(b);this.col3.SetV(c)};n.prototype.Copy=
function(){return new n(this.col1,this.col2,this.col3)};n.prototype.SetM=function(a){this.col1.SetV(a.col1);this.col2.SetV(a.col2);this.col3.SetV(a.col3)};n.prototype.AddM=function(a){this.col1.x+=a.col1.x;this.col1.y+=a.col1.y;this.col1.z+=a.col1.z;this.col2.x+=a.col2.x;this.col2.y+=a.col2.y;this.col2.z+=a.col2.z;this.col3.x+=a.col3.x;this.col3.y+=a.col3.y;this.col3.z+=a.col3.z};n.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;
this.col1.z=0;this.col2.z=0;this.col3.z=1};n.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};n.prototype.Solve22=function(a,b,c){void 0===b&&(b=0);void 0===c&&(c=0);var d=this.col1.x,h=this.col2.x,g=this.col1.y,n=this.col2.y,m=d*n-h*g;0!=m&&(m=1/m);a.x=m*(n*b-h*c);a.y=m*(d*c-g*b);return a};n.prototype.Solve33=function(a,b,c,d){void 0===b&&(b=0);void 0===c&&(c=0);void 0===d&&(d=0);var h=this.col1.x,
g=this.col1.y,n=this.col1.z,m=this.col2.x,C=this.col2.y,k=this.col2.z,A=this.col3.x,B=this.col3.y,F=this.col3.z,H=h*(C*F-k*B)+g*(k*A-m*F)+n*(m*B-C*A);0!=H&&(H=1/H);a.x=H*(b*(C*F-k*B)+c*(k*A-m*F)+d*(m*B-C*A));a.y=H*(h*(c*F-d*B)+g*(d*A-b*F)+n*(b*B-c*A));a.z=H*(h*(C*d-k*c)+g*(k*b-m*d)+n*(m*c-C*b));return a};g.b2Math=function(){};g.IsValid=function(a){void 0===a&&(a=0);return isFinite(a)};g.Dot=function(a,b){return a.x*b.x+a.y*b.y};g.CrossVV=function(a,b){return a.x*b.y-a.y*b.x};g.CrossVF=function(a,
b){void 0===b&&(b=0);return new c(b*a.y,-b*a.x)};g.CrossFV=function(a,b){void 0===a&&(a=0);return new c(-a*b.y,a*b.x)};g.MulMV=function(a,b){return new c(a.col1.x*b.x+a.col2.x*b.y,a.col1.y*b.x+a.col2.y*b.y)};g.MulTMV=function(a,b){return new c(g.Dot(b,a.col1),g.Dot(b,a.col2))};g.MulX=function(a,b){var c=g.MulMV(a.R,b);c.x+=a.position.x;c.y+=a.position.y;return c};g.MulXT=function(a,b){var c=g.SubtractVV(b,a.position),d=c.x*a.R.col1.x+c.y*a.R.col1.y;c.y=c.x*a.R.col2.x+c.y*a.R.col2.y;c.x=d;return c};
g.AddVV=function(a,b){return new c(a.x+b.x,a.y+b.y)};g.SubtractVV=function(a,b){return new c(a.x-b.x,a.y-b.y)};g.Distance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)};g.DistanceSquared=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d};g.MulFV=function(a,b){void 0===a&&(a=0);return new c(a*b.x,a*b.y)};g.AddMM=function(a,c){return b.FromVV(g.AddVV(a.col1,c.col1),g.AddVV(a.col2,c.col2))};g.MulMM=function(a,c){return b.FromVV(g.MulMV(a,c.col1),g.MulMV(a,c.col2))};g.MulTMM=function(a,
d){var h=new c(g.Dot(a.col1,d.col1),g.Dot(a.col2,d.col1)),n=new c(g.Dot(a.col1,d.col2),g.Dot(a.col2,d.col2));return b.FromVV(h,n)};g.Abs=function(a){void 0===a&&(a=0);return 0<a?a:-a};g.AbsV=function(a){return new c(g.Abs(a.x),g.Abs(a.y))};g.AbsM=function(a){return b.FromVV(g.AbsV(a.col1),g.AbsV(a.col2))};g.Min=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);return a<b?a:b};g.MinV=function(a,b){return new c(g.Min(a.x,b.x),g.Min(a.y,b.y))};g.Max=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);
return a>b?a:b};g.MaxV=function(a,b){return new c(g.Max(a.x,b.x),g.Max(a.y,b.y))};g.Clamp=function(a,b,c){void 0===a&&(a=0);void 0===b&&(b=0);void 0===c&&(c=0);return a<b?b:a>c?c:a};g.ClampV=function(a,b,c){return g.MaxV(b,g.MinV(a,c))};g.Swap=function(a,b){var c=a[0];a[0]=b[0];b[0]=c};g.Random=function(){return 2*Math.random()-1};g.RandomRange=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);return(b-a)*Math.random()+a};g.NextPowerOfTwo=function(a){void 0===a&&(a=0);a|=a>>1&2147483647;a|=a>>2&1073741823;
a|=a>>4&268435455;a|=a>>8&16777215;return(a|a>>16&65535)+1};g.IsPowerOfTwo=function(a){void 0===a&&(a=0);return 0<a&&0==(a&a-1)};Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new c(0,0);Box2D.Common.Math.b2Math.b2Mat22_identity=b.FromVV(new c(1,0),new c(0,1));Box2D.Common.Math.b2Math.b2Transform_identity=new d(g.b2Vec2_zero,g.b2Mat22_identity)});h.b2Sweep=function(){this.localCenter=new c;this.c0=new c;this.c=new c};h.prototype.Set=function(a){this.localCenter.SetV(a.localCenter);
this.c0.SetV(a.c0);this.c.SetV(a.c);this.a0=a.a0;this.a=a.a;this.t0=a.t0};h.prototype.Copy=function(){var a=new h;a.localCenter.SetV(this.localCenter);a.c0.SetV(this.c0);a.c.SetV(this.c);a.a0=this.a0;a.a=this.a;a.t0=this.t0;return a};h.prototype.GetTransform=function(a,b){void 0===b&&(b=0);a.position.x=(1-b)*this.c0.x+b*this.c.x;a.position.y=(1-b)*this.c0.y+b*this.c.y;a.R.Set((1-b)*this.a0+b*this.a);var c=a.R;a.position.x-=c.col1.x*this.localCenter.x+c.col2.x*this.localCenter.y;a.position.y-=c.col1.y*
this.localCenter.x+c.col2.y*this.localCenter.y};h.prototype.Advance=function(a){void 0===a&&(a=0);if(this.t0<a&&1-this.t0>Number.MIN_VALUE){var b=(a-this.t0)/(1-this.t0);this.c0.x=(1-b)*this.c0.x+b*this.c.x;this.c0.y=(1-b)*this.c0.y+b*this.c.y;this.a0=(1-b)*this.a0+b*this.a;this.t0=a}};d.b2Transform=function(){this.position=new c;this.R=new b};d.prototype.b2Transform=function(a,b){void 0===a&&(a=null);void 0===b&&(b=null);a&&(this.position.SetV(a),this.R.SetM(b))};d.prototype.Initialize=function(a,
b){this.position.SetV(a);this.R.SetM(b)};d.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};d.prototype.Set=function(a){this.position.SetV(a.position);this.R.SetM(a.R)};d.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};c.b2Vec2=function(){};c.prototype.b2Vec2=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.x=a;this.y=b};c.prototype.SetZero=function(){this.y=this.x=0};c.prototype.Set=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);
this.x=a;this.y=b};c.prototype.SetV=function(a){this.x=a.x;this.y=a.y};c.prototype.GetNegative=function(){return new c(-this.x,-this.y)};c.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};c.Make=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);return new c(a,b)};c.prototype.Copy=function(){return new c(this.x,this.y)};c.prototype.Add=function(a){this.x+=a.x;this.y+=a.y};c.prototype.Subtract=function(a){this.x-=a.x;this.y-=a.y};c.prototype.Multiply=function(a){void 0===a&&(a=0);this.x*=
a;this.y*=a};c.prototype.MulM=function(a){var b=this.x;this.x=a.col1.x*b+a.col2.x*this.y;this.y=a.col1.y*b+a.col2.y*this.y};c.prototype.MulTM=function(a){var b=g.Dot(this,a.col1);this.y=g.Dot(this,a.col2);this.x=b};c.prototype.CrossVF=function(a){void 0===a&&(a=0);var b=this.x;this.x=a*this.y;this.y=-a*b};c.prototype.CrossFV=function(a){void 0===a&&(a=0);var b=this.x;this.x=-a*this.y;this.y=a*b};c.prototype.MinV=function(a){this.x=this.x<a.x?this.x:a.x;this.y=this.y<a.y?this.y:a.y};c.prototype.MaxV=
function(a){this.x=this.x>a.x?this.x:a.x;this.y=this.y>a.y?this.y:a.y};c.prototype.Abs=function(){0>this.x&&(this.x=-this.x);0>this.y&&(this.y=-this.y)};c.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};c.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};c.prototype.Normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(a<Number.MIN_VALUE)return 0;var b=1/a;this.x*=b;this.y*=b;return a};c.prototype.IsValid=function(){return g.IsValid(this.x)&&
g.IsValid(this.y)};m.b2Vec3=function(){};m.prototype.b2Vec3=function(a,b,c){void 0===a&&(a=0);void 0===b&&(b=0);void 0===c&&(c=0);this.x=a;this.y=b;this.z=c};m.prototype.SetZero=function(){this.x=this.y=this.z=0};m.prototype.Set=function(a,b,c){void 0===a&&(a=0);void 0===b&&(b=0);void 0===c&&(c=0);this.x=a;this.y=b;this.z=c};m.prototype.SetV=function(a){this.x=a.x;this.y=a.y;this.z=a.z};m.prototype.GetNegative=function(){return new m(-this.x,-this.y,-this.z)};m.prototype.NegativeSelf=function(){this.x=
-this.x;this.y=-this.y;this.z=-this.z};m.prototype.Copy=function(){return new m(this.x,this.y,this.z)};m.prototype.Add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z};m.prototype.Subtract=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z};m.prototype.Multiply=function(a){void 0===a&&(a=0);this.x*=a;this.y*=a;this.z*=a}})();
(function(){var b=Box2D.Common.Math.b2Math,n=Box2D.Common.Math.b2Sweep,g=Box2D.Common.Math.b2Transform,h=Box2D.Common.Math.b2Vec2,d=Box2D.Common.b2Color,c=Box2D.Common.b2Settings,m=Box2D.Collision.b2AABB,a=Box2D.Collision.b2ContactPoint,l=Box2D.Collision.b2DynamicTreeBroadPhase,p=Box2D.Collision.b2RayCastInput,x=Box2D.Collision.b2RayCastOutput,y=Box2D.Collision.Shapes.b2CircleShape,w=Box2D.Collision.Shapes.b2EdgeShape,t=Box2D.Collision.Shapes.b2MassData,E=Box2D.Collision.Shapes.b2PolygonShape,C=Box2D.Collision.Shapes.b2Shape,
k=Box2D.Dynamics.b2Body,A=Box2D.Dynamics.b2BodyDef,B=Box2D.Dynamics.b2ContactFilter,F=Box2D.Dynamics.b2ContactImpulse,H=Box2D.Dynamics.b2ContactListener,K=Box2D.Dynamics.b2ContactManager,G=Box2D.Dynamics.b2DebugDraw,P=Box2D.Dynamics.b2DestructionListener,J=Box2D.Dynamics.b2FilterData,D=Box2D.Dynamics.b2Fixture,O=Box2D.Dynamics.b2FixtureDef,M=Box2D.Dynamics.b2Island,f=Box2D.Dynamics.b2TimeStep,r=Box2D.Dynamics.b2World,z=Box2D.Dynamics.Contacts.b2Contact,q=Box2D.Dynamics.Contacts.b2ContactFactory,I=
Box2D.Dynamics.Contacts.b2ContactSolver,N=Box2D.Dynamics.Joints.b2Joint,L=Box2D.Dynamics.Joints.b2PulleyJoint;k.b2Body=function(){this.m_xf=new g;this.m_sweep=new n;this.m_linearVelocity=new h;this.m_force=new h};k.prototype.connectEdges=function(e,a,f){void 0===f&&(f=0);var r=Math.atan2(a.GetDirectionVector().y,a.GetDirectionVector().x);f=b.MulFV(Math.tan(.5*(r-f)),a.GetDirectionVector());f=b.SubtractVV(f,a.GetNormalVector());f=b.MulFV(c.b2_toiSlop,f);f=b.AddVV(f,a.GetVertex1());var d=b.AddVV(e.GetDirectionVector(),
a.GetDirectionVector());d.Normalize();var q=0<b.Dot(e.GetDirectionVector(),a.GetNormalVector());e.SetNextEdge(a,f,d,q);a.SetPrevEdge(e,f,d,q);return r};k.prototype.CreateFixture=function(e){if(1==this.m_world.IsLocked())return null;var a=new D;a.Create(this,this.m_xf,e);this.m_flags&k.e_activeFlag&&a.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf);a.m_next=this.m_fixtureList;this.m_fixtureList=a;++this.m_fixtureCount;a.m_body=this;0<a.m_density&&this.ResetMassData();this.m_world.m_flags|=
r.e_newFixture;return a};k.prototype.CreateFixture2=function(e,a){void 0===a&&(a=0);var f=new O;f.shape=e;f.density=a;return this.CreateFixture(f)};k.prototype.DestroyFixture=function(e){if(1!=this.m_world.IsLocked()){for(var a=this.m_fixtureList,f=null;null!=a;){if(a==e){f?f.m_next=e.m_next:this.m_fixtureList=e.m_next;break}f=a;a=a.m_next}for(a=this.m_contactList;a;){var f=a.contact,a=a.next,b=f.GetFixtureA(),c=f.GetFixtureB();e!=b&&e!=c||this.m_world.m_contactManager.Destroy(f)}this.m_flags&k.e_activeFlag&&
e.DestroyProxy(this.m_world.m_contactManager.m_broadPhase);e.Destroy();e.m_body=null;e.m_next=null;--this.m_fixtureCount;this.ResetMassData()}};k.prototype.SetPositionAndAngle=function(e,a){void 0===a&&(a=0);var f;if(1!=this.m_world.IsLocked()){this.m_xf.R.Set(a);this.m_xf.position.SetV(e);f=this.m_xf.R;var b=this.m_sweep.localCenter;this.m_sweep.c.x=f.col1.x*b.x+f.col2.x*b.y;this.m_sweep.c.y=f.col1.y*b.x+f.col2.y*b.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);
this.m_sweep.a0=this.m_sweep.a=a;b=this.m_world.m_contactManager.m_broadPhase;for(f=this.m_fixtureList;f;f=f.m_next)f.Synchronize(b,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}};k.prototype.SetTransform=function(e){this.SetPositionAndAngle(e.position,e.GetAngle())};k.prototype.GetTransform=function(){return this.m_xf};k.prototype.GetPosition=function(){return this.m_xf.position};k.prototype.SetPosition=function(e){this.SetPositionAndAngle(e,this.GetAngle())};k.prototype.GetAngle=
function(){return this.m_sweep.a};k.prototype.SetAngle=function(e){void 0===e&&(e=0);this.SetPositionAndAngle(this.GetPosition(),e)};k.prototype.GetWorldCenter=function(){return this.m_sweep.c};k.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};k.prototype.SetLinearVelocity=function(e){this.m_type!=k.b2_staticBody&&this.m_linearVelocity.SetV(e)};k.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};k.prototype.SetAngularVelocity=function(e){void 0===e&&(e=0);this.m_type!=
k.b2_staticBody&&(this.m_angularVelocity=e)};k.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};k.prototype.GetDefinition=function(){var e=new A;e.type=this.GetType();e.allowSleep=(this.m_flags&k.e_allowSleepFlag)==k.e_allowSleepFlag;e.angle=this.GetAngle();e.angularDamping=this.m_angularDamping;e.angularVelocity=this.m_angularVelocity;e.fixedRotation=(this.m_flags&k.e_fixedRotationFlag)==k.e_fixedRotationFlag;e.bullet=(this.m_flags&k.e_bulletFlag)==k.e_bulletFlag;e.awake=(this.m_flags&
k.e_awakeFlag)==k.e_awakeFlag;e.linearDamping=this.m_linearDamping;e.linearVelocity.SetV(this.GetLinearVelocity());e.position=this.GetPosition();e.userData=this.GetUserData();return e};k.prototype.ApplyForce=function(e,a){this.m_type==k.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_force.x+=e.x,this.m_force.y+=e.y,this.m_torque+=(a.x-this.m_sweep.c.x)*e.y-(a.y-this.m_sweep.c.y)*e.x)};k.prototype.ApplyTorque=function(e){void 0===e&&(e=0);this.m_type==k.b2_dynamicBody&&(0==this.IsAwake()&&
this.SetAwake(!0),this.m_torque+=e)};k.prototype.ApplyImpulse=function(e,a){this.m_type==k.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y,this.m_angularVelocity+=this.m_invI*((a.x-this.m_sweep.c.x)*e.y-(a.y-this.m_sweep.c.y)*e.x))};k.prototype.Split=function(e){for(var a=this.GetLinearVelocity().Copy(),f=this.GetAngularVelocity(),c=this.GetWorldCenter(),r=this.m_world.CreateBody(this.GetDefinition()),d,
q=this.m_fixtureList;q;)if(e(q)){var z=q.m_next;d?d.m_next=z:this.m_fixtureList=z;this.m_fixtureCount--;q.m_next=r.m_fixtureList;r.m_fixtureList=q;r.m_fixtureCount++;q.m_body=r;q=z}else d=q,q=q.m_next;this.ResetMassData();r.ResetMassData();d=this.GetWorldCenter();e=r.GetWorldCenter();d=b.AddVV(a,b.CrossFV(f,b.SubtractVV(d,c)));a=b.AddVV(a,b.CrossFV(f,b.SubtractVV(e,c)));this.SetLinearVelocity(d);r.SetLinearVelocity(a);this.SetAngularVelocity(f);r.SetAngularVelocity(f);this.SynchronizeFixtures();r.SynchronizeFixtures();
return r};k.prototype.Merge=function(e){var a;for(a=e.m_fixtureList;a;){var f=a.m_next;e.m_fixtureCount--;a.m_next=this.m_fixtureList;this.m_fixtureList=a;this.m_fixtureCount++;a.m_body=c;a=f}b.m_fixtureCount=0;var b=this,c=e;b.GetWorldCenter();c.GetWorldCenter();b.GetLinearVelocity().Copy();c.GetLinearVelocity().Copy();b.GetAngularVelocity();c.GetAngularVelocity();b.ResetMassData();this.SynchronizeFixtures()};k.prototype.GetMass=function(){return this.m_mass};k.prototype.GetInertia=function(){return this.m_I};
k.prototype.GetMassData=function(e){e.mass=this.m_mass;e.I=this.m_I;e.center.SetV(this.m_sweep.localCenter)};k.prototype.SetMassData=function(e){c.b2Assert(0==this.m_world.IsLocked());if(1!=this.m_world.IsLocked()&&this.m_type==k.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0;this.m_mass=e.mass;0>=this.m_mass&&(this.m_mass=1);this.m_invMass=1/this.m_mass;0<e.I&&0==(this.m_flags&k.e_fixedRotationFlag)&&(this.m_I=e.I-this.m_mass*(e.center.x*e.center.x+e.center.y*e.center.y),this.m_invI=1/this.m_I);
var a=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e.center);this.m_sweep.c0.SetV(b.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-a.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-a.x)}};k.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0;this.m_sweep.localCenter.SetZero();if(this.m_type!=k.b2_staticBody&&this.m_type!=k.b2_kinematicBody){for(var e=
h.Make(0,0),a=this.m_fixtureList;a;a=a.m_next)if(0!=a.m_density){var f=a.GetMassData();this.m_mass+=f.mass;e.x+=f.center.x*f.mass;e.y+=f.center.y*f.mass;this.m_I+=f.I}0<this.m_mass?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):this.m_invMass=this.m_mass=1;0<this.m_I&&0==(this.m_flags&k.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(e.x*e.x+e.y*e.y),this.m_I*=this.m_inertiaScale,c.b2Assert(0<this.m_I),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0;a=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e);
this.m_sweep.c0.SetV(b.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-a.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-a.x)}};k.prototype.GetWorldPoint=function(e){var a=this.m_xf.R;e=new h(a.col1.x*e.x+a.col2.x*e.y,a.col1.y*e.x+a.col2.y*e.y);e.x+=this.m_xf.position.x;e.y+=this.m_xf.position.y;return e};k.prototype.GetWorldVector=function(e){return b.MulMV(this.m_xf.R,e)};k.prototype.GetLocalPoint=
function(e){return b.MulXT(this.m_xf,e)};k.prototype.GetLocalVector=function(e){return b.MulTMV(this.m_xf.R,e)};k.prototype.GetLinearVelocityFromWorldPoint=function(e){return new h(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))};k.prototype.GetLinearVelocityFromLocalPoint=function(e){var a=this.m_xf.R;e=new h(a.col1.x*e.x+a.col2.x*e.y,a.col1.y*e.x+a.col2.y*e.y);e.x+=this.m_xf.position.x;e.y+=this.m_xf.position.y;
return new h(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))};k.prototype.GetLinearDamping=function(){return this.m_linearDamping};k.prototype.SetLinearDamping=function(e){void 0===e&&(e=0);this.m_linearDamping=e};k.prototype.GetAngularDamping=function(){return this.m_angularDamping};k.prototype.SetAngularDamping=function(e){void 0===e&&(e=0);this.m_angularDamping=e};k.prototype.SetType=function(e){void 0===
e&&(e=0);if(this.m_type!=e)for(this.m_type=e,this.ResetMassData(),this.m_type==k.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0,e=this.m_contactList;e;e=e.next)e.contact.FlagForFiltering()};k.prototype.GetType=function(){return this.m_type};k.prototype.SetBullet=function(e){this.m_flags=e?this.m_flags|k.e_bulletFlag:this.m_flags&~k.e_bulletFlag};k.prototype.IsBullet=function(){return(this.m_flags&k.e_bulletFlag)==
k.e_bulletFlag};k.prototype.SetSleepingAllowed=function(e){e?this.m_flags|=k.e_allowSleepFlag:(this.m_flags&=~k.e_allowSleepFlag,this.SetAwake(!0))};k.prototype.SetAwake=function(e){e?(this.m_flags|=k.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~k.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)};k.prototype.IsAwake=function(){return(this.m_flags&k.e_awakeFlag)==k.e_awakeFlag};k.prototype.SetFixedRotation=function(e){this.m_flags=
e?this.m_flags|k.e_fixedRotationFlag:this.m_flags&~k.e_fixedRotationFlag;this.ResetMassData()};k.prototype.IsFixedRotation=function(){return(this.m_flags&k.e_fixedRotationFlag)==k.e_fixedRotationFlag};k.prototype.SetActive=function(e){if(e!=this.IsActive()){var a;if(e)for(this.m_flags|=k.e_activeFlag,e=this.m_world.m_contactManager.m_broadPhase,a=this.m_fixtureList;a;a=a.m_next)a.CreateProxy(e,this.m_xf);else{this.m_flags&=~k.e_activeFlag;e=this.m_world.m_contactManager.m_broadPhase;for(a=this.m_fixtureList;a;a=
a.m_next)a.DestroyProxy(e);for(e=this.m_contactList;e;)a=e,e=e.next,this.m_world.m_contactManager.Destroy(a.contact);this.m_contactList=null}}};k.prototype.IsActive=function(){return(this.m_flags&k.e_activeFlag)==k.e_activeFlag};k.prototype.IsSleepingAllowed=function(){return(this.m_flags&k.e_allowSleepFlag)==k.e_allowSleepFlag};k.prototype.GetFixtureList=function(){return this.m_fixtureList};k.prototype.GetJointList=function(){return this.m_jointList};k.prototype.GetControllerList=function(){return this.m_controllerList};
k.prototype.GetContactList=function(){return this.m_contactList};k.prototype.GetNext=function(){return this.m_next};k.prototype.GetUserData=function(){return this.m_userData};k.prototype.SetUserData=function(e){this.m_userData=e};k.prototype.GetWorld=function(){return this.m_world};k.prototype.b2Body=function(e,a){this.m_flags=0;e.bullet&&(this.m_flags|=k.e_bulletFlag);e.fixedRotation&&(this.m_flags|=k.e_fixedRotationFlag);e.allowSleep&&(this.m_flags|=k.e_allowSleepFlag);e.awake&&(this.m_flags|=k.e_awakeFlag);
e.active&&(this.m_flags|=k.e_activeFlag);this.m_world=a;this.m_xf.position.SetV(e.position);this.m_xf.R.Set(e.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=e.angle;var f=this.m_xf.R,b=this.m_sweep.localCenter;this.m_sweep.c.x=f.col1.x*b.x+f.col2.x*b.y;this.m_sweep.c.y=f.col1.y*b.x+f.col2.y*b.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_contactList=this.m_controllerList=this.m_jointList=
null;this.m_controllerCount=0;this.m_next=this.m_prev=null;this.m_linearVelocity.SetV(e.linearVelocity);this.m_angularVelocity=e.angularVelocity;this.m_linearDamping=e.linearDamping;this.m_angularDamping=e.angularDamping;this.m_force.Set(0,0);this.m_sleepTime=this.m_torque=0;this.m_type=e.type;this.m_invMass=this.m_type==k.b2_dynamicBody?this.m_mass=1:this.m_mass=0;this.m_invI=this.m_I=0;this.m_inertiaScale=e.inertiaScale;this.m_userData=e.userData;this.m_fixtureList=null;this.m_fixtureCount=0};k.prototype.SynchronizeFixtures=
function(){var e=k.s_xf1;e.R.Set(this.m_sweep.a0);var a=e.R,f=this.m_sweep.localCenter;e.position.x=this.m_sweep.c0.x-(a.col1.x*f.x+a.col2.x*f.y);e.position.y=this.m_sweep.c0.y-(a.col1.y*f.x+a.col2.y*f.y);f=this.m_world.m_contactManager.m_broadPhase;for(a=this.m_fixtureList;a;a=a.m_next)a.Synchronize(f,e,this.m_xf)};k.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var e=this.m_xf.R,a=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(e.col1.x*a.x+e.col2.x*a.y);
this.m_xf.position.y=this.m_sweep.c.y-(e.col1.y*a.x+e.col2.y*a.y)};k.prototype.ShouldCollide=function(e){if(this.m_type!=k.b2_dynamicBody&&e.m_type!=k.b2_dynamicBody)return!1;for(var a=this.m_jointList;a;a=a.next)if(a.other==e&&0==a.joint.m_collideConnected)return!1;return!0};k.prototype.Advance=function(a){void 0===a&&(a=0);this.m_sweep.Advance(a);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=
new g;Box2D.Dynamics.b2Body.e_islandFlag=1;Box2D.Dynamics.b2Body.e_awakeFlag=2;Box2D.Dynamics.b2Body.e_allowSleepFlag=4;Box2D.Dynamics.b2Body.e_bulletFlag=8;Box2D.Dynamics.b2Body.e_fixedRotationFlag=16;Box2D.Dynamics.b2Body.e_activeFlag=32;Box2D.Dynamics.b2Body.b2_staticBody=0;Box2D.Dynamics.b2Body.b2_kinematicBody=1;Box2D.Dynamics.b2Body.b2_dynamicBody=2});A.b2BodyDef=function(){this.position=new h;this.linearVelocity=new h};A.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,
0);this.angle=0;this.linearVelocity.Set(0,0);this.angularDamping=this.linearDamping=this.angularVelocity=0;this.awake=this.allowSleep=!0;this.bullet=this.fixedRotation=!1;this.type=k.b2_staticBody;this.active=!0;this.inertiaScale=1};B.b2ContactFilter=function(){};B.prototype.ShouldCollide=function(a,f){var b=a.GetFilterData(),c=f.GetFilterData();return b.groupIndex==c.groupIndex&&0!=b.groupIndex?0<b.groupIndex:0!=(b.maskBits&c.categoryBits)&&0!=(b.categoryBits&c.maskBits)};B.prototype.RayCollide=
function(a,f){return a?this.ShouldCollide(a instanceof D?a:null,f):!0};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new B});F.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(c.b2_maxManifoldPoints);this.tangentImpulses=new Vector_a2j_Number(c.b2_maxManifoldPoints)};H.b2ContactListener=function(){};H.prototype.BeginContact=function(a){};H.prototype.EndContact=function(a){};H.prototype.PreSolve=function(a,f){};H.prototype.PostSolve=function(a,
f){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new H});K.b2ContactManager=function(){};K.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=B.b2_defaultFilter;this.m_contactListener=H.b2_defaultListener;this.m_contactFactory=new q(this.m_allocator);this.m_broadPhase=new l};K.prototype.AddPair=function(a,f){var b=a instanceof D?a:null,c=f instanceof D?f:null,r=b.GetBody(),d=c.GetBody();if(r!=d){for(var q=d.GetContactList();q;){if(q.other==
r){var z=q.contact.GetFixtureA(),h=q.contact.GetFixtureB();if(z==b&&h==c||z==c&&h==b)return}q=q.next}0!=d.ShouldCollide(r)&&0!=this.m_contactFilter.ShouldCollide(b,c)&&(q=this.m_contactFactory.Create(b,c),b=q.GetFixtureA(),c=q.GetFixtureB(),r=b.m_body,d=c.m_body,q.m_prev=null,q.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=q),this.m_world.m_contactList=q,q.m_nodeA.contact=q,q.m_nodeA.other=d,q.m_nodeA.prev=null,q.m_nodeA.next=r.m_contactList,
null!=r.m_contactList&&(r.m_contactList.prev=q.m_nodeA),r.m_contactList=q.m_nodeA,q.m_nodeB.contact=q,q.m_nodeB.other=r,q.m_nodeB.prev=null,q.m_nodeB.next=d.m_contactList,null!=d.m_contactList&&(d.m_contactList.prev=q.m_nodeB),d.m_contactList=q.m_nodeB,++this.m_world.m_contactCount)}};K.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))};K.prototype.Destroy=function(a){var f=a.GetFixtureA(),b=a.GetFixtureB(),f=f.GetBody(),b=b.GetBody();a.IsTouching()&&
this.m_contactListener.EndContact(a);a.m_prev&&(a.m_prev.m_next=a.m_next);a.m_next&&(a.m_next.m_prev=a.m_prev);a==this.m_world.m_contactList&&(this.m_world.m_contactList=a.m_next);a.m_nodeA.prev&&(a.m_nodeA.prev.next=a.m_nodeA.next);a.m_nodeA.next&&(a.m_nodeA.next.prev=a.m_nodeA.prev);a.m_nodeA==f.m_contactList&&(f.m_contactList=a.m_nodeA.next);a.m_nodeB.prev&&(a.m_nodeB.prev.next=a.m_nodeB.next);a.m_nodeB.next&&(a.m_nodeB.next.prev=a.m_nodeB.prev);a.m_nodeB==b.m_contactList&&(b.m_contactList=a.m_nodeB.next);
this.m_contactFactory.Destroy(a);--this.m_contactCount};K.prototype.Collide=function(){for(var a=this.m_world.m_contactList;a;){var f=a.GetFixtureA(),b=a.GetFixtureB(),c=f.GetBody(),r=b.GetBody();if(0==c.IsAwake()&&0==r.IsAwake())a=a.GetNext();else{if(a.m_flags&z.e_filterFlag){if(0==r.ShouldCollide(c)){f=a;a=f.GetNext();this.Destroy(f);continue}if(0==this.m_contactFilter.ShouldCollide(f,b)){f=a;a=f.GetNext();this.Destroy(f);continue}a.m_flags&=~z.e_filterFlag}0==this.m_broadPhase.TestOverlap(f.m_proxy,
b.m_proxy)?(f=a,a=f.GetNext(),this.Destroy(f)):(a.Update(this.m_contactListener),a=a.GetNext())}}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new a});G.b2DebugDraw=function(){};G.prototype.b2DebugDraw=function(){};G.prototype.SetFlags=function(a){};G.prototype.GetFlags=function(){};G.prototype.AppendFlags=function(a){};G.prototype.ClearFlags=function(a){};G.prototype.SetSprite=function(a){};G.prototype.GetSprite=function(){};G.prototype.SetDrawScale=function(a){};G.prototype.GetDrawScale=
function(){};G.prototype.SetLineThickness=function(a){};G.prototype.GetLineThickness=function(){};G.prototype.SetAlpha=function(a){};G.prototype.GetAlpha=function(){};G.prototype.SetFillAlpha=function(a){};G.prototype.GetFillAlpha=function(){};G.prototype.SetXFormScale=function(a){};G.prototype.GetXFormScale=function(){};G.prototype.DrawPolygon=function(a,f,b){};G.prototype.DrawSolidPolygon=function(a,f,b){};G.prototype.DrawCircle=function(a,f,b){};G.prototype.DrawSolidCircle=function(a,f,b,c){};
G.prototype.DrawSegment=function(a,f,b){};G.prototype.DrawTransform=function(a){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1;Box2D.Dynamics.b2DebugDraw.e_jointBit=2;Box2D.Dynamics.b2DebugDraw.e_aabbBit=4;Box2D.Dynamics.b2DebugDraw.e_pairBit=8;Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16;Box2D.Dynamics.b2DebugDraw.e_controllerBit=32});P.b2DestructionListener=function(){};P.prototype.SayGoodbyeJoint=function(a){};P.prototype.SayGoodbyeFixture=function(a){};J.b2FilterData=
function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};J.prototype.Copy=function(){var a=new J;a.categoryBits=this.categoryBits;a.maskBits=this.maskBits;a.groupIndex=this.groupIndex;return a};D.b2Fixture=function(){this.m_filter=new J};D.prototype.GetType=function(){return this.m_shape.GetType()};D.prototype.GetShape=function(){return this.m_shape};D.prototype.SetSensor=function(a){if(this.m_isSensor!=a&&(this.m_isSensor=a,null!=this.m_body))for(a=this.m_body.GetContactList();a;){var f=
a.contact,b=f.GetFixtureA(),c=f.GetFixtureB();b!=this&&c!=this||f.SetSensor(b.IsSensor()||c.IsSensor());a=a.next}};D.prototype.IsSensor=function(){return this.m_isSensor};D.prototype.SetFilterData=function(a){this.m_filter=a.Copy();if(!this.m_body)for(a=this.m_body.GetContactList();a;){var f=a.contact,b=f.GetFixtureA(),c=f.GetFixtureB();b!=this&&c!=this||f.FlagForFiltering();a=a.next}};D.prototype.GetFilterData=function(){return this.m_filter.Copy()};D.prototype.GetBody=function(){return this.m_body};
D.prototype.GetNext=function(){return this.m_next};D.prototype.GetUserData=function(){return this.m_userData};D.prototype.SetUserData=function(a){this.m_userData=a};D.prototype.TestPoint=function(a){return this.m_shape.TestPoint(this.m_body.GetTransform(),a)};D.prototype.RayCast=function(a,f){return this.m_shape.RayCast(a,f,this.m_body.GetTransform())};D.prototype.GetMassData=function(a){void 0===a&&(a=null);null==a&&(a=new t);this.m_shape.ComputeMass(a,this.m_density);return a};D.prototype.SetDensity=
function(a){void 0===a&&(a=0);this.m_density=a};D.prototype.GetDensity=function(){return this.m_density};D.prototype.GetFriction=function(){return this.m_friction};D.prototype.SetFriction=function(a){void 0===a&&(a=0);this.m_friction=a};D.prototype.GetRestitution=function(){return this.m_restitution};D.prototype.SetRestitution=function(a){void 0===a&&(a=0);this.m_restitution=a};D.prototype.GetAABB=function(){return this.m_aabb};D.prototype.b2Fixture=function(){this.m_aabb=new m;this.m_shape=this.m_next=
this.m_body=this.m_userData=null;this.m_restitution=this.m_friction=this.m_density=0};D.prototype.Create=function(a,f,b){this.m_userData=b.userData;this.m_friction=b.friction;this.m_restitution=b.restitution;this.m_body=a;this.m_next=null;this.m_filter=b.filter.Copy();this.m_isSensor=b.isSensor;this.m_shape=b.shape.Copy();this.m_density=b.density};D.prototype.Destroy=function(){this.m_shape=null};D.prototype.CreateProxy=function(a,f){this.m_shape.ComputeAABB(this.m_aabb,f);this.m_proxy=a.CreateProxy(this.m_aabb,
this)};D.prototype.DestroyProxy=function(a){null!=this.m_proxy&&(a.DestroyProxy(this.m_proxy),this.m_proxy=null)};D.prototype.Synchronize=function(a,f,c){if(this.m_proxy){var r=new m,d=new m;this.m_shape.ComputeAABB(r,f);this.m_shape.ComputeAABB(d,c);this.m_aabb.Combine(r,d);f=b.SubtractVV(c.position,f.position);a.MoveProxy(this.m_proxy,this.m_aabb,f)}};O.b2FixtureDef=function(){this.filter=new J};O.prototype.b2FixtureDef=function(){this.userData=this.shape=null;this.friction=.2;this.density=this.restitution=
0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.isSensor=!1};M.b2Island=function(){};M.prototype.b2Island=function(){this.m_bodies=new Vector;this.m_contacts=new Vector;this.m_joints=new Vector};M.prototype.Initialize=function(a,f,b,c,r,d){void 0===a&&(a=0);void 0===f&&(f=0);void 0===b&&(b=0);this.m_bodyCapacity=a;this.m_contactCapacity=f;this.m_jointCapacity=b;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_allocator=c;this.m_listener=r;this.m_contactSolver=
d;for(c=this.m_bodies.length;c<a;c++)this.m_bodies[c]=null;for(c=this.m_contacts.length;c<f;c++)this.m_contacts[c]=null;for(c=this.m_joints.length;c<b;c++)this.m_joints[c]=null};M.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0};M.prototype.Solve=function(a,f,r){var d,q,z;for(d=0;d<this.m_bodyCount;++d)q=this.m_bodies[d],q.GetType()==k.b2_dynamicBody&&(q.m_linearVelocity.x+=a.dt*(f.x+q.m_invMass*q.m_force.x),q.m_linearVelocity.y+=a.dt*(f.y+q.m_invMass*q.m_force.y),
q.m_angularVelocity+=a.dt*q.m_invI*q.m_torque,q.m_linearVelocity.Multiply(b.Clamp(1-a.dt*q.m_linearDamping,0,1)),q.m_angularVelocity*=b.Clamp(1-a.dt*q.m_angularDamping,0,1));this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contactCount,this.m_allocator);f=this.m_contactSolver;f.InitVelocityConstraints(a);for(d=0;d<this.m_jointCount;++d)z=this.m_joints[d],z.InitVelocityConstraints(a);for(d=0;d<a.velocityIterations;++d){for(q=0;q<this.m_jointCount;++q)z=this.m_joints[q],z.SolveVelocityConstraints(a);
f.SolveVelocityConstraints()}for(d=0;d<this.m_jointCount;++d)z=this.m_joints[d],z.FinalizeVelocityConstraints();f.FinalizeVelocityConstraints();for(d=0;d<this.m_bodyCount;++d)if(q=this.m_bodies[d],q.GetType()!=k.b2_staticBody){var h=a.dt*q.m_linearVelocity.x,g=a.dt*q.m_linearVelocity.y;h*h+g*g>c.b2_maxTranslationSquared&&(q.m_linearVelocity.Normalize(),q.m_linearVelocity.x=q.m_linearVelocity.x*c.b2_maxTranslation*a.inv_dt,q.m_linearVelocity.y=q.m_linearVelocity.y*c.b2_maxTranslation*a.inv_dt);h=a.dt*
q.m_angularVelocity;h*h>c.b2_maxRotationSquared&&(q.m_angularVelocity=0>q.m_angularVelocity?-c.b2_maxRotation*a.inv_dt:c.b2_maxRotation*a.inv_dt);q.m_sweep.c0.SetV(q.m_sweep.c);q.m_sweep.a0=q.m_sweep.a;q.m_sweep.c.x+=a.dt*q.m_linearVelocity.x;q.m_sweep.c.y+=a.dt*q.m_linearVelocity.y;q.m_sweep.a+=a.dt*q.m_angularVelocity;q.SynchronizeTransform()}for(d=0;d<a.positionIterations;++d){h=f.SolvePositionConstraints(c.b2_contactBaumgarte);g=!0;for(q=0;q<this.m_jointCount;++q)z=this.m_joints[q],z=z.SolvePositionConstraints(c.b2_contactBaumgarte),
g=g&&z;if(h&&g)break}this.Report(f.m_constraints);if(r){r=Number.MAX_VALUE;f=c.b2_linearSleepTolerance*c.b2_linearSleepTolerance;h=c.b2_angularSleepTolerance*c.b2_angularSleepTolerance;for(d=0;d<this.m_bodyCount;++d)q=this.m_bodies[d],q.GetType()!=k.b2_staticBody&&(0==(q.m_flags&k.e_allowSleepFlag)&&(r=q.m_sleepTime=0),0==(q.m_flags&k.e_allowSleepFlag)||q.m_angularVelocity*q.m_angularVelocity>h||b.Dot(q.m_linearVelocity,q.m_linearVelocity)>f?r=q.m_sleepTime=0:(q.m_sleepTime+=a.dt,r=b.Min(r,q.m_sleepTime)));
if(r>=c.b2_timeToSleep)for(d=0;d<this.m_bodyCount;++d)q=this.m_bodies[d],q.SetAwake(!1)}};M.prototype.SolveTOI=function(a){var f,b;this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contactCount,this.m_allocator);var q=this.m_contactSolver;for(f=0;f<this.m_jointCount;++f)this.m_joints[f].InitVelocityConstraints(a);for(f=0;f<a.velocityIterations;++f)for(q.SolveVelocityConstraints(),b=0;b<this.m_jointCount;++b)this.m_joints[b].SolveVelocityConstraints(a);for(f=0;f<this.m_bodyCount;++f)if(b=this.m_bodies[f],
b.GetType()!=k.b2_staticBody){var d=a.dt*b.m_linearVelocity.x,r=a.dt*b.m_linearVelocity.y;d*d+r*r>c.b2_maxTranslationSquared&&(b.m_linearVelocity.Normalize(),b.m_linearVelocity.x=b.m_linearVelocity.x*c.b2_maxTranslation*a.inv_dt,b.m_linearVelocity.y=b.m_linearVelocity.y*c.b2_maxTranslation*a.inv_dt);d=a.dt*b.m_angularVelocity;d*d>c.b2_maxRotationSquared&&(b.m_angularVelocity=0>b.m_angularVelocity?-c.b2_maxRotation*a.inv_dt:c.b2_maxRotation*a.inv_dt);b.m_sweep.c0.SetV(b.m_sweep.c);b.m_sweep.a0=b.m_sweep.a;
b.m_sweep.c.x+=a.dt*b.m_linearVelocity.x;b.m_sweep.c.y+=a.dt*b.m_linearVelocity.y;b.m_sweep.a+=a.dt*b.m_angularVelocity;b.SynchronizeTransform()}for(f=0;f<a.positionIterations;++f){d=q.SolvePositionConstraints(.75);r=!0;for(b=0;b<this.m_jointCount;++b)var z=this.m_joints[b].SolvePositionConstraints(c.b2_contactBaumgarte),r=r&&z;if(d&&r)break}this.Report(q.m_constraints)};M.prototype.Report=function(a){if(null!=this.m_listener)for(var f=0;f<this.m_contactCount;++f){for(var b=this.m_contacts[f],c=a[f],
q=0;q<c.pointCount;++q)M.s_impulse.normalImpulses[q]=c.points[q].normalImpulse,M.s_impulse.tangentImpulses[q]=c.points[q].tangentImpulse;this.m_listener.PostSolve(b,M.s_impulse)}};M.prototype.AddBody=function(a){a.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=a};M.prototype.AddContact=function(a){this.m_contacts[this.m_contactCount++]=a};M.prototype.AddJoint=function(a){this.m_joints[this.m_jointCount++]=a};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new F});
f.b2TimeStep=function(){};f.prototype.Set=function(a){this.dt=a.dt;this.inv_dt=a.inv_dt;this.positionIterations=a.positionIterations;this.velocityIterations=a.velocityIterations;this.warmStarting=a.warmStarting};r.b2World=function(){this.s_stack=new Vector;this.m_contactManager=new K;this.m_contactSolver=new I;this.m_island=new M};r.prototype.b2World=function(a,f){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null;this.m_controllerCount=
this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;r.m_warmStarting=!0;r.m_continuousPhysics=!0;this.m_allowSleep=f;this.m_gravity=a;this.m_inv_dt0=0;this.m_contactManager.m_world=this;var b=new A;this.m_groundBody=this.CreateBody(b)};r.prototype.SetDestructionListener=function(a){this.m_destructionListener=a};r.prototype.SetContactFilter=function(a){this.m_contactManager.m_contactFilter=a};r.prototype.SetContactListener=function(a){this.m_contactManager.m_contactListener=a};r.prototype.SetDebugDraw=
function(a){this.m_debugDraw=a};r.prototype.SetBroadPhase=function(a){var f=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=a;for(var b=this.m_bodyList;b;b=b.m_next)for(var c=b.m_fixtureList;c;c=c.m_next)c.m_proxy=a.CreateProxy(f.GetFatAABB(c.m_proxy),c)};r.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};r.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};r.prototype.CreateBody=function(a){if(1==this.IsLocked())return null;
a=new k(a,this);a.m_prev=null;if(a.m_next=this.m_bodyList)this.m_bodyList.m_prev=a;this.m_bodyList=a;++this.m_bodyCount;return a};r.prototype.DestroyBody=function(a){if(1!=this.IsLocked()){for(var f=a.m_jointList;f;){var b=f,f=f.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(b.joint);this.DestroyJoint(b.joint)}for(f=a.m_controllerList;f;)b=f,f=f.nextController,b.controller.RemoveBody(a);for(f=a.m_contactList;f;)b=f,f=f.next,this.m_contactManager.Destroy(b.contact);a.m_contactList=
null;for(f=a.m_fixtureList;f;)b=f,f=f.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(b),b.DestroyProxy(this.m_contactManager.m_broadPhase),b.Destroy();a.m_fixtureList=null;a.m_fixtureCount=0;a.m_prev&&(a.m_prev.m_next=a.m_next);a.m_next&&(a.m_next.m_prev=a.m_prev);a==this.m_bodyList&&(this.m_bodyList=a.m_next);--this.m_bodyCount}};r.prototype.CreateJoint=function(a){var f=N.Create(a,null);f.m_prev=null;if(f.m_next=this.m_jointList)this.m_jointList.m_prev=f;this.m_jointList=
f;++this.m_jointCount;f.m_edgeA.joint=f;f.m_edgeA.other=f.m_bodyB;f.m_edgeA.prev=null;if(f.m_edgeA.next=f.m_bodyA.m_jointList)f.m_bodyA.m_jointList.prev=f.m_edgeA;f.m_bodyA.m_jointList=f.m_edgeA;f.m_edgeB.joint=f;f.m_edgeB.other=f.m_bodyA;f.m_edgeB.prev=null;if(f.m_edgeB.next=f.m_bodyB.m_jointList)f.m_bodyB.m_jointList.prev=f.m_edgeB;f.m_bodyB.m_jointList=f.m_edgeB;var b=a.bodyA,c=a.bodyB;if(0==a.collideConnected)for(a=c.GetContactList();a;)a.other==b&&a.contact.FlagForFiltering(),a=a.next;return f};
r.prototype.DestroyJoint=function(a){var f=a.m_collideConnected;a.m_prev&&(a.m_prev.m_next=a.m_next);a.m_next&&(a.m_next.m_prev=a.m_prev);a==this.m_jointList&&(this.m_jointList=a.m_next);var b=a.m_bodyA,c=a.m_bodyB;b.SetAwake(!0);c.SetAwake(!0);a.m_edgeA.prev&&(a.m_edgeA.prev.next=a.m_edgeA.next);a.m_edgeA.next&&(a.m_edgeA.next.prev=a.m_edgeA.prev);a.m_edgeA==b.m_jointList&&(b.m_jointList=a.m_edgeA.next);a.m_edgeA.prev=null;a.m_edgeA.next=null;a.m_edgeB.prev&&(a.m_edgeB.prev.next=a.m_edgeB.next);
a.m_edgeB.next&&(a.m_edgeB.next.prev=a.m_edgeB.prev);a.m_edgeB==c.m_jointList&&(c.m_jointList=a.m_edgeB.next);a.m_edgeB.prev=null;a.m_edgeB.next=null;N.Destroy(a,null);--this.m_jointCount;if(0==f)for(a=c.GetContactList();a;)a.other==b&&a.contact.FlagForFiltering(),a=a.next};r.prototype.AddController=function(a){a.m_next=this.m_controllerList;a.m_prev=null;this.m_controllerList=a;a.m_world=this;this.m_controllerCount++;return a};r.prototype.RemoveController=function(a){a.m_prev&&(a.m_prev.m_next=a.m_next);
a.m_next&&(a.m_next.m_prev=a.m_prev);this.m_controllerList==a&&(this.m_controllerList=a.m_next);this.m_controllerCount--};r.prototype.CreateController=function(a){if(a.m_world!=this)throw Error("Controller can only be a member of one world");a.m_next=this.m_controllerList;a.m_prev=null;this.m_controllerList&&(this.m_controllerList.m_prev=a);this.m_controllerList=a;++this.m_controllerCount;a.m_world=this;return a};r.prototype.DestroyController=function(a){a.Clear();a.m_next&&(a.m_next.m_prev=a.m_prev);
a.m_prev&&(a.m_prev.m_next=a.m_next);a==this.m_controllerList&&(this.m_controllerList=a.m_next);--this.m_controllerCount};r.prototype.SetWarmStarting=function(a){r.m_warmStarting=a};r.prototype.SetContinuousPhysics=function(a){r.m_continuousPhysics=a};r.prototype.GetBodyCount=function(){return this.m_bodyCount};r.prototype.GetJointCount=function(){return this.m_jointCount};r.prototype.GetContactCount=function(){return this.m_contactCount};r.prototype.SetGravity=function(a){this.m_gravity=a};r.prototype.GetGravity=
function(){return this.m_gravity};r.prototype.GetGroundBody=function(){return this.m_groundBody};r.prototype.Step=function(a,f,b){void 0===a&&(a=0);void 0===f&&(f=0);void 0===b&&(b=0);this.m_flags&r.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~r.e_newFixture);this.m_flags|=r.e_locked;var c=r.s_timestep2;c.dt=a;c.velocityIterations=f;c.positionIterations=b;c.inv_dt=0<a?1/a:0;c.dtRatio=this.m_inv_dt0*a;c.warmStarting=r.m_warmStarting;this.m_contactManager.Collide();0<c.dt&&
this.Solve(c);r.m_continuousPhysics&&0<c.dt&&this.SolveTOI(c);0<c.dt&&(this.m_inv_dt0=c.inv_dt);this.m_flags&=~r.e_locked};r.prototype.ClearForces=function(){for(var a=this.m_bodyList;a;a=a.m_next)a.m_force.SetZero(),a.m_torque=0};r.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){this.m_debugDraw.m_sprite.graphics.clear();var a=this.m_debugDraw.GetFlags(),f,b,c;new h;new h;new h;var q;new m;new m;new h;new h;new h;new h;var z=new d(0,0,0);if(a&G.e_shapeBit)for(f=this.m_bodyList;f;f=
f.m_next)for(q=f.m_xf,b=f.GetFixtureList();b;b=b.m_next)c=b.GetShape(),0==f.IsActive()?z.Set(.5,.5,.3):f.GetType()==k.b2_staticBody?z.Set(.5,.9,.5):f.GetType()==k.b2_kinematicBody?z.Set(.5,.5,.9):0==f.IsAwake()?z.Set(.6,.6,.6):z.Set(.9,.7,.7),this.DrawShape(c,q,z);if(a&G.e_jointBit)for(f=this.m_jointList;f;f=f.m_next)this.DrawJoint(f);if(a&G.e_controllerBit)for(f=this.m_controllerList;f;f=f.m_next)f.Draw(this.m_debugDraw);if(a&G.e_pairBit)for(z.Set(.3,.9,.9),f=this.m_contactManager.m_contactList;f;f=
f.GetNext())c=f.GetFixtureA(),b=f.GetFixtureB(),c=c.GetAABB().GetCenter(),b=b.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(c,b,z);if(a&G.e_aabbBit)for(c=this.m_contactManager.m_broadPhase,q=[new h,new h,new h,new h],f=this.m_bodyList;f;f=f.GetNext())if(0!=f.IsActive())for(b=f.GetFixtureList();b;b=b.GetNext()){var g=c.GetFatAABB(b.m_proxy);q[0].Set(g.lowerBound.x,g.lowerBound.y);q[1].Set(g.upperBound.x,g.lowerBound.y);q[2].Set(g.upperBound.x,g.upperBound.y);q[3].Set(g.lowerBound.x,g.upperBound.y);
this.m_debugDraw.DrawPolygon(q,4,z)}if(a&G.e_centerOfMassBit)for(f=this.m_bodyList;f;f=f.m_next)q=r.s_xf,q.R=f.m_xf.R,q.position=f.GetWorldCenter(),this.m_debugDraw.DrawTransform(q)}};r.prototype.QueryAABB=function(a,f){var b=this.m_contactManager.m_broadPhase;b.Query(function(f){return a(b.GetUserData(f))},f)};r.prototype.QueryShape=function(a,f,b){void 0===b&&(b=null);null==b&&(b=new g,b.SetIdentity());var c=this.m_contactManager.m_broadPhase,q=new m;f.ComputeAABB(q,b);c.Query(function(q){q=c.GetUserData(q)instanceof
D?c.GetUserData(q):null;return C.TestOverlap(f,b,q.GetShape(),q.GetBody().GetTransform())?a(q):!0},q)};r.prototype.QueryPoint=function(a,f){var b=this.m_contactManager.m_broadPhase,q=new m;q.lowerBound.Set(f.x-c.b2_linearSlop,f.y-c.b2_linearSlop);q.upperBound.Set(f.x+c.b2_linearSlop,f.y+c.b2_linearSlop);b.Query(function(c){c=b.GetUserData(c)instanceof D?b.GetUserData(c):null;return c.TestPoint(f)?a(c):!0},q)};r.prototype.RayCast=function(a,f,b){var c=this.m_contactManager.m_broadPhase,q=new x,d=new p(f,
b);c.RayCast(function(d,r){var z=c.GetUserData(r),z=z instanceof D?z:null;if(z.RayCast(q,d)){var g=q.fraction,k=new h((1-g)*f.x+g*b.x,(1-g)*f.y+g*b.y);return a(z,k,q.normal,g)}return d.maxFraction},d)};r.prototype.RayCastOne=function(a,f){var b;this.RayCast(function(a,f,e,c){void 0===c&&(c=0);b=a;return c},a,f);return b};r.prototype.RayCastAll=function(a,f){var b=new Vector;this.RayCast(function(a,f,e,c){b[b.length]=a;return 1},a,f);return b};r.prototype.GetBodyList=function(){return this.m_bodyList};
r.prototype.GetJointList=function(){return this.m_jointList};r.prototype.GetContactList=function(){return this.m_contactList};r.prototype.IsLocked=function(){return 0<(this.m_flags&r.e_locked)};r.prototype.Solve=function(a){for(var f,b=this.m_controllerList;b;b=b.m_next)b.Step(a);b=this.m_island;b.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(f=this.m_bodyList;f;f=f.m_next)f.m_flags&=~k.e_islandFlag;for(var c=
this.m_contactList;c;c=c.m_next)c.m_flags&=~z.e_islandFlag;for(c=this.m_jointList;c;c=c.m_next)c.m_islandFlag=!1;parseInt(this.m_bodyCount);for(var c=this.s_stack,q=this.m_bodyList;q;q=q.m_next)if(!(q.m_flags&k.e_islandFlag)&&0!=q.IsAwake()&&0!=q.IsActive()&&q.GetType()!=k.b2_staticBody){b.Clear();var d=0;c[d++]=q;for(q.m_flags|=k.e_islandFlag;0<d;)if(f=c[--d],b.AddBody(f),0==f.IsAwake()&&f.SetAwake(!0),f.GetType()!=k.b2_staticBody){for(var r,h=f.m_contactList;h;h=h.next)h.contact.m_flags&z.e_islandFlag||
1==h.contact.IsSensor()||0==h.contact.IsEnabled()||0==h.contact.IsTouching()||(b.AddContact(h.contact),h.contact.m_flags|=z.e_islandFlag,r=h.other,r.m_flags&k.e_islandFlag||(c[d++]=r,r.m_flags|=k.e_islandFlag));for(f=f.m_jointList;f;f=f.next)1!=f.joint.m_islandFlag&&(r=f.other,0!=r.IsActive()&&(b.AddJoint(f.joint),f.joint.m_islandFlag=!0,r.m_flags&k.e_islandFlag||(c[d++]=r,r.m_flags|=k.e_islandFlag)))}b.Solve(a,this.m_gravity,this.m_allowSleep);for(d=0;d<b.m_bodyCount;++d)f=b.m_bodies[d],f.GetType()==
k.b2_staticBody&&(f.m_flags&=~k.e_islandFlag)}for(d=0;d<c.length&&c[d];++d)c[d]=null;for(f=this.m_bodyList;f;f=f.m_next)0!=f.IsAwake()&&0!=f.IsActive()&&f.GetType()!=k.b2_staticBody&&f.SynchronizeFixtures();this.m_contactManager.FindNewContacts()};r.prototype.SolveTOI=function(a){var f,b,q,d=this.m_island;d.Initialize(this.m_bodyCount,c.b2_maxTOIContactsPerIsland,c.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var h=r.s_queue;for(f=this.m_bodyList;f;f=
f.m_next)f.m_flags&=~k.e_islandFlag,f.m_sweep.t0=0;for(q=this.m_contactList;q;q=q.m_next)q.m_flags&=~(z.e_toiFlag|z.e_islandFlag);for(q=this.m_jointList;q;q=q.m_next)q.m_islandFlag=!1;for(;;){var g=null,l=1;for(q=this.m_contactList;q;q=q.m_next)if(1!=q.IsSensor()&&0!=q.IsEnabled()&&0!=q.IsContinuous()){if(q.m_flags&z.e_toiFlag)f=q.m_toi;else{f=q.m_fixtureA;b=q.m_fixtureB;f=f.m_body;b=b.m_body;if(!(f.GetType()==k.b2_dynamicBody&&0!=f.IsAwake()||b.GetType()==k.b2_dynamicBody&&0!=b.IsAwake()))continue;
var n=f.m_sweep.t0;f.m_sweep.t0<b.m_sweep.t0?(n=b.m_sweep.t0,f.m_sweep.Advance(n)):b.m_sweep.t0<f.m_sweep.t0&&(n=f.m_sweep.t0,b.m_sweep.Advance(n));f=q.ComputeTOI(f.m_sweep,b.m_sweep);c.b2Assert(0<=f&&1>=f);0<f&&1>f&&(f=(1-f)*n+f,1<f&&(f=1));q.m_toi=f;q.m_flags|=z.e_toiFlag}Number.MIN_VALUE<f&&f<l&&(g=q,l=f)}if(null==g||1-100*Number.MIN_VALUE<l)break;f=g.m_fixtureA;b=g.m_fixtureB;f=f.m_body;b=b.m_body;r.s_backupA.Set(f.m_sweep);r.s_backupB.Set(b.m_sweep);f.Advance(l);b.Advance(l);g.Update(this.m_contactManager.m_contactListener);
g.m_flags&=~z.e_toiFlag;if(1==g.IsSensor()||0==g.IsEnabled())f.m_sweep.Set(r.s_backupA),b.m_sweep.Set(r.s_backupB),f.SynchronizeTransform(),b.SynchronizeTransform();else if(0!=g.IsTouching()){f.GetType()!=k.b2_dynamicBody&&(f=b);d.Clear();g=q=0;h[q+g++]=f;for(f.m_flags|=k.e_islandFlag;0<g;)if(f=h[q++],--g,d.AddBody(f),0==f.IsAwake()&&f.SetAwake(!0),f.GetType()==k.b2_dynamicBody){for(b=f.m_contactList;b&&d.m_contactCount!=d.m_contactCapacity;b=b.next)b.contact.m_flags&z.e_islandFlag||1==b.contact.IsSensor()||
0==b.contact.IsEnabled()||0==b.contact.IsTouching()||(d.AddContact(b.contact),b.contact.m_flags|=z.e_islandFlag,n=b.other,n.m_flags&k.e_islandFlag||(n.GetType()!=k.b2_staticBody&&(n.Advance(l),n.SetAwake(!0)),h[q+g]=n,++g,n.m_flags|=k.e_islandFlag));for(f=f.m_jointList;f;f=f.next)d.m_jointCount!=d.m_jointCapacity&&1!=f.joint.m_islandFlag&&(n=f.other,0!=n.IsActive()&&(d.AddJoint(f.joint),f.joint.m_islandFlag=!0,n.m_flags&k.e_islandFlag||(n.GetType()!=k.b2_staticBody&&(n.Advance(l),n.SetAwake(!0)),
h[q+g]=n,++g,n.m_flags|=k.e_islandFlag)))}q=r.s_timestep;q.warmStarting=!1;q.dt=(1-l)*a.dt;q.inv_dt=1/q.dt;q.dtRatio=0;q.velocityIterations=a.velocityIterations;q.positionIterations=a.positionIterations;d.SolveTOI(q);for(l=0;l<d.m_bodyCount;++l)if(f=d.m_bodies[l],f.m_flags&=~k.e_islandFlag,0!=f.IsAwake()&&f.GetType()==k.b2_dynamicBody)for(f.SynchronizeFixtures(),b=f.m_contactList;b;b=b.next)b.contact.m_flags&=~z.e_toiFlag;for(l=0;l<d.m_contactCount;++l)q=d.m_contacts[l],q.m_flags&=~(z.e_toiFlag|z.e_islandFlag);
for(l=0;l<d.m_jointCount;++l)q=d.m_joints[l],q.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}};r.prototype.DrawJoint=function(a){var f=a.GetBodyA(),b=a.GetBodyB(),c=f.m_xf.position,q=b.m_xf.position,d=a.GetAnchorA(),z=a.GetAnchorB(),g=r.s_jointColor;switch(a.m_type){case N.e_distanceJoint:this.m_debugDraw.DrawSegment(d,z,g);break;case N.e_pulleyJoint:f=a instanceof L?a:null;a=f.GetGroundAnchorA();f=f.GetGroundAnchorB();this.m_debugDraw.DrawSegment(a,d,g);this.m_debugDraw.DrawSegment(f,
z,g);this.m_debugDraw.DrawSegment(a,f,g);break;case N.e_mouseJoint:this.m_debugDraw.DrawSegment(d,z,g);break;default:f!=this.m_groundBody&&this.m_debugDraw.DrawSegment(c,d,g),this.m_debugDraw.DrawSegment(d,z,g),b!=this.m_groundBody&&this.m_debugDraw.DrawSegment(q,z,g)}};r.prototype.DrawShape=function(a,f,c){switch(a.m_type){case C.e_circleShape:a=a instanceof y?a:null;var q=b.MulX(f,a.m_p);this.m_debugDraw.DrawSolidCircle(q,a.m_radius,f.R.col1,c);break;case C.e_polygonShape:q=a instanceof E?a:null;
a=parseInt(q.GetVertexCount());for(var d=q.GetVertices(),r=new Vector(a),q=0;q<a;++q)r[q]=b.MulX(f,d[q]);this.m_debugDraw.DrawSolidPolygon(r,a,c);break;case C.e_edgeShape:a=a instanceof w?a:null,this.m_debugDraw.DrawSegment(b.MulX(f,a.GetVertex1()),b.MulX(f,a.GetVertex2()),c)}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new f;Box2D.Dynamics.b2World.s_xf=new g;Box2D.Dynamics.b2World.s_backupA=new n;Box2D.Dynamics.b2World.s_backupB=new n;Box2D.Dynamics.b2World.s_timestep=new f;
Box2D.Dynamics.b2World.s_queue=new Vector;Box2D.Dynamics.b2World.s_jointColor=new d(.5,.8,.8);Box2D.Dynamics.b2World.e_newFixture=1;Box2D.Dynamics.b2World.e_locked=2})})();
(function(){var b=Box2D.Collision.Shapes.b2CircleShape,n=Box2D.Collision.Shapes.b2EdgeShape,g=Box2D.Collision.Shapes.b2PolygonShape,h=Box2D.Collision.Shapes.b2Shape,d=Box2D.Dynamics.Contacts.b2CircleContact,c=Box2D.Dynamics.Contacts.b2Contact,m=Box2D.Dynamics.Contacts.b2ContactConstraint,a=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,l=Box2D.Dynamics.Contacts.b2ContactEdge,p=Box2D.Dynamics.Contacts.b2ContactFactory,x=Box2D.Dynamics.Contacts.b2ContactRegister,y=Box2D.Dynamics.Contacts.b2ContactResult,
w=Box2D.Dynamics.Contacts.b2ContactSolver,t=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,E=Box2D.Dynamics.Contacts.b2NullContact,C=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,k=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,A=Box2D.Dynamics.Contacts.b2PolygonContact,B=Box2D.Dynamics.Contacts.b2PositionSolverManifold,F=Box2D.Dynamics.b2Body,H=Box2D.Dynamics.b2TimeStep,K=Box2D.Common.b2Settings,G=Box2D.Common.Math.b2Mat22,P=Box2D.Common.Math.b2Math,J=Box2D.Common.Math.b2Vec2,D=Box2D.Collision.b2Collision,
O=Box2D.Collision.b2ContactID,M=Box2D.Collision.b2Manifold,f=Box2D.Collision.b2TimeOfImpact,r=Box2D.Collision.b2TOIInput,z=Box2D.Collision.b2WorldManifold;Box2D.inherit(d,Box2D.Dynamics.Contacts.b2Contact);d.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;d.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};d.Create=function(a){return new d};d.Destroy=function(a,f){};d.prototype.Reset=function(a,f){this.__super.Reset.call(this,a,f)};d.prototype.Evaluate=
function(){var a=this.m_fixtureA.GetBody(),f=this.m_fixtureB.GetBody();D.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof b?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof b?this.m_fixtureB.GetShape():null,f.m_xf)};c.b2Contact=function(){this.m_nodeA=new l;this.m_nodeB=new l;this.m_manifold=new M;this.m_oldManifold=new M};c.prototype.GetManifold=function(){return this.m_manifold};c.prototype.GetWorldManifold=function(a){var f=this.m_fixtureA.GetBody(),
b=this.m_fixtureB.GetBody(),c=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,f.GetTransform(),c.m_radius,b.GetTransform(),e.m_radius)};c.prototype.IsTouching=function(){return(this.m_flags&c.e_touchingFlag)==c.e_touchingFlag};c.prototype.IsContinuous=function(){return(this.m_flags&c.e_continuousFlag)==c.e_continuousFlag};c.prototype.SetSensor=function(a){this.m_flags=a?this.m_flags|c.e_sensorFlag:this.m_flags&~c.e_sensorFlag};c.prototype.IsSensor=function(){return(this.m_flags&
c.e_sensorFlag)==c.e_sensorFlag};c.prototype.SetEnabled=function(a){this.m_flags=a?this.m_flags|c.e_enabledFlag:this.m_flags&~c.e_enabledFlag};c.prototype.IsEnabled=function(){return(this.m_flags&c.e_enabledFlag)==c.e_enabledFlag};c.prototype.GetNext=function(){return this.m_next};c.prototype.GetFixtureA=function(){return this.m_fixtureA};c.prototype.GetFixtureB=function(){return this.m_fixtureB};c.prototype.FlagForFiltering=function(){this.m_flags|=c.e_filterFlag};c.prototype.b2Contact=function(){};
c.prototype.Reset=function(a,f){void 0===a&&(a=null);void 0===f&&(f=null);this.m_flags=c.e_enabledFlag;if(a&&f){if(a.IsSensor()||f.IsSensor())this.m_flags|=c.e_sensorFlag;var b=a.GetBody(),d=f.GetBody();if(b.GetType()!=F.b2_dynamicBody||b.IsBullet()||d.GetType()!=F.b2_dynamicBody||d.IsBullet())this.m_flags|=c.e_continuousFlag;this.m_fixtureA=a;this.m_fixtureB=f;this.m_manifold.m_pointCount=0;this.m_next=this.m_prev=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=
null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null}else this.m_fixtureB=this.m_fixtureA=null};c.prototype.Update=function(a){var f=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=f;this.m_flags|=c.e_enabledFlag;var b=!1,f=(this.m_flags&c.e_touchingFlag)==c.e_touchingFlag,d=this.m_fixtureA.m_body,e=this.m_fixtureB.m_body,r=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&c.e_sensorFlag)r&&(b=this.m_fixtureA.GetShape(),
r=this.m_fixtureB.GetShape(),d=d.GetTransform(),e=e.GetTransform(),b=h.TestOverlap(b,d,r,e)),this.m_manifold.m_pointCount=0;else{d.GetType()!=F.b2_dynamicBody||d.IsBullet()||e.GetType()!=F.b2_dynamicBody||e.IsBullet()?this.m_flags|=c.e_continuousFlag:this.m_flags&=~c.e_continuousFlag;if(r)for(this.Evaluate(),b=0<this.m_manifold.m_pointCount,r=0;r<this.m_manifold.m_pointCount;++r){var z=this.m_manifold.m_points[r];z.m_normalImpulse=0;z.m_tangentImpulse=0;for(var g=z.m_id,k=0;k<this.m_oldManifold.m_pointCount;++k){var l=
this.m_oldManifold.m_points[k];if(l.m_id.key==g.key){z.m_normalImpulse=l.m_normalImpulse;z.m_tangentImpulse=l.m_tangentImpulse;break}}}else this.m_manifold.m_pointCount=0;b!=f&&(d.SetAwake(!0),e.SetAwake(!0))}this.m_flags=b?this.m_flags|c.e_touchingFlag:this.m_flags&~c.e_touchingFlag;0==f&&1==b&&a.BeginContact(this);1==f&&0==b&&a.EndContact(this);0==(this.m_flags&c.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)};c.prototype.Evaluate=function(){};c.prototype.ComputeTOI=function(a,b){c.s_input.proxyA.Set(this.m_fixtureA.GetShape());
c.s_input.proxyB.Set(this.m_fixtureB.GetShape());c.s_input.sweepA=a;c.s_input.sweepB=b;c.s_input.tolerance=K.b2_linearSlop;return f.TimeOfImpact(c.s_input)};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1;Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2;Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4;Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8;Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16;Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32;Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=
64;Box2D.Dynamics.Contacts.b2Contact.s_input=new r});m.b2ContactConstraint=function(){this.localPlaneNormal=new J;this.localPoint=new J;this.normal=new J;this.normalMass=new G;this.K=new G};m.prototype.b2ContactConstraint=function(){this.points=new Vector(K.b2_maxManifoldPoints);for(var f=0;f<K.b2_maxManifoldPoints;f++)this.points[f]=new a};a.b2ContactConstraintPoint=function(){this.localPoint=new J;this.rA=new J;this.rB=new J};l.b2ContactEdge=function(){};p.b2ContactFactory=function(){};p.prototype.b2ContactFactory=
function(a){this.m_allocator=a;this.InitializeRegisters()};p.prototype.AddType=function(a,f,b,c){void 0===b&&(b=0);void 0===c&&(c=0);this.m_registers[b][c].createFcn=a;this.m_registers[b][c].destroyFcn=f;this.m_registers[b][c].primary=!0;b!=c&&(this.m_registers[c][b].createFcn=a,this.m_registers[c][b].destroyFcn=f,this.m_registers[c][b].primary=!1)};p.prototype.InitializeRegisters=function(){this.m_registers=new Vector(h.e_shapeTypeCount);for(var a=0;a<h.e_shapeTypeCount;a++){this.m_registers[a]=
new Vector(h.e_shapeTypeCount);for(var f=0;f<h.e_shapeTypeCount;f++)this.m_registers[a][f]=new x}this.AddType(d.Create,d.Destroy,h.e_circleShape,h.e_circleShape);this.AddType(C.Create,C.Destroy,h.e_polygonShape,h.e_circleShape);this.AddType(A.Create,A.Destroy,h.e_polygonShape,h.e_polygonShape);this.AddType(t.Create,t.Destroy,h.e_edgeShape,h.e_circleShape);this.AddType(k.Create,k.Destroy,h.e_polygonShape,h.e_edgeShape)};p.prototype.Create=function(a,f){var b=parseInt(a.GetType()),c=parseInt(f.GetType()),
b=this.m_registers[b][c];if(b.pool)return c=b.pool,b.pool=c.m_next,b.poolCount--,c.Reset(a,f),c;c=b.createFcn;return null!=c?(b.primary?(c=c(this.m_allocator),c.Reset(a,f)):(c=c(this.m_allocator),c.Reset(f,a)),c):null};p.prototype.Destroy=function(a){0<a.m_manifold.m_pointCount&&(a.m_fixtureA.m_body.SetAwake(!0),a.m_fixtureB.m_body.SetAwake(!0));var f=parseInt(a.m_fixtureA.GetType()),b=parseInt(a.m_fixtureB.GetType()),f=this.m_registers[f][b];f.poolCount++;a.m_next=f.pool;f.pool=a;f=f.destroyFcn;
f(a,this.m_allocator)};x.b2ContactRegister=function(){};y.b2ContactResult=function(){this.position=new J;this.normal=new J;this.id=new O};w.b2ContactSolver=function(){this.m_step=new H;this.m_constraints=new Vector};w.prototype.b2ContactSolver=function(){};w.prototype.Initialize=function(a,f,b,c){void 0===b&&(b=0);var e;this.m_step.Set(a);this.m_allocator=c;for(this.m_constraintCount=b;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new m;for(a=0;a<
b;++a){e=f[a];c=e.m_fixtureA;var d=e.m_fixtureB,r=c.m_shape.m_radius,z=d.m_shape.m_radius,g=c.m_body,h=d.m_body,k=e.GetManifold(),l=K.b2MixFriction(c.GetFriction(),d.GetFriction()),n=K.b2MixRestitution(c.GetRestitution(),d.GetRestitution()),p=g.m_linearVelocity.x,t=g.m_linearVelocity.y,y=h.m_linearVelocity.x,x=h.m_linearVelocity.y,B=g.m_angularVelocity,C=h.m_angularVelocity;K.b2Assert(0<k.m_pointCount);w.s_worldManifold.Initialize(k,g.m_xf,r,h.m_xf,z);d=w.s_worldManifold.m_normal.x;e=w.s_worldManifold.m_normal.y;
c=this.m_constraints[a];c.bodyA=g;c.bodyB=h;c.manifold=k;c.normal.x=d;c.normal.y=e;c.pointCount=k.m_pointCount;c.friction=l;c.restitution=n;c.localPlaneNormal.x=k.m_localPlaneNormal.x;c.localPlaneNormal.y=k.m_localPlaneNormal.y;c.localPoint.x=k.m_localPoint.x;c.localPoint.y=k.m_localPoint.y;c.radius=r+z;c.type=k.m_type;for(r=0;r<c.pointCount;++r){l=k.m_points[r];z=c.points[r];z.normalImpulse=l.m_normalImpulse;z.tangentImpulse=l.m_tangentImpulse;z.localPoint.SetV(l.m_localPoint);var l=z.rA.x=w.s_worldManifold.m_points[r].x-
g.m_sweep.c.x,n=z.rA.y=w.s_worldManifold.m_points[r].y-g.m_sweep.c.y,A=z.rB.x=w.s_worldManifold.m_points[r].x-h.m_sweep.c.x,E=z.rB.y=w.s_worldManifold.m_points[r].y-h.m_sweep.c.y,D=l*e-n*d,F=A*e-E*d,D=D*D,F=F*F;z.normalMass=1/(g.m_invMass+h.m_invMass+g.m_invI*D+h.m_invI*F);var H=g.m_mass*g.m_invMass+h.m_mass*h.m_invMass,H=H+(g.m_mass*g.m_invI*D+h.m_mass*h.m_invI*F);z.equalizedMass=1/H;F=e;H=-d;D=l*H-n*F;F=A*H-E*F;D*=D;F*=F;z.tangentMass=1/(g.m_invMass+h.m_invMass+g.m_invI*D+h.m_invI*F);z.velocityBias=
0;l=c.normal.x*(y+-C*E-p- -B*n)+c.normal.y*(x+C*A-t-B*l);l<-K.b2_velocityThreshold&&(z.velocityBias+=-c.restitution*l)}2==c.pointCount&&(x=c.points[0],y=c.points[1],k=g.m_invMass,g=g.m_invI,p=h.m_invMass,h=h.m_invI,t=x.rA.x*e-x.rA.y*d,x=x.rB.x*e-x.rB.y*d,B=y.rA.x*e-y.rA.y*d,y=y.rB.x*e-y.rB.y*d,d=k+p+g*t*t+h*x*x,e=k+p+g*B*B+h*y*y,h=k+p+g*t*B+h*x*y,d*d<100*(d*e-h*h)?(c.K.col1.Set(d,h),c.K.col2.Set(h,e),c.K.GetInverse(c.normalMass)):c.pointCount=1)}};w.prototype.InitVelocityConstraints=function(a){for(var f=
0;f<this.m_constraintCount;++f){var b=this.m_constraints[f],c=b.bodyA,e=b.bodyB,d=c.m_invMass,r=c.m_invI,z=e.m_invMass,g=e.m_invI,h=b.normal.x,k=b.normal.y,l=k,n=-h,m,p;if(a.warmStarting)for(p=b.pointCount,m=0;m<p;++m){var t=b.points[m];t.normalImpulse*=a.dtRatio;t.tangentImpulse*=a.dtRatio;var w=t.normalImpulse*h+t.tangentImpulse*l,y=t.normalImpulse*k+t.tangentImpulse*n;c.m_angularVelocity-=r*(t.rA.x*y-t.rA.y*w);c.m_linearVelocity.x-=d*w;c.m_linearVelocity.y-=d*y;e.m_angularVelocity+=g*(t.rB.x*y-
t.rB.y*w);e.m_linearVelocity.x+=z*w;e.m_linearVelocity.y+=z*y}else for(p=b.pointCount,m=0;m<p;++m)c=b.points[m],c.normalImpulse=0,c.tangentImpulse=0}};w.prototype.SolveVelocityConstraints=function(){for(var a,f,b,c,e,d,r,z,g,h,k=0;k<this.m_constraintCount;++k){e=this.m_constraints[k];var l=e.bodyA,n=e.bodyB,m=l.m_angularVelocity,p=n.m_angularVelocity,t=l.m_linearVelocity,w=n.m_linearVelocity,y=l.m_invMass,x=l.m_invI,B=n.m_invMass,C=n.m_invI;z=e.normal.x;var A=g=e.normal.y;h=-z;r=e.friction;for(a=
0;a<e.pointCount;a++)f=e.points[a],b=w.x-p*f.rB.y-t.x+m*f.rA.y,c=w.y+p*f.rB.x-t.y-m*f.rA.x,b=b*A+c*h,b=f.tangentMass*-b,c=r*f.normalImpulse,c=P.Clamp(f.tangentImpulse+b,-c,c),b=c-f.tangentImpulse,d=b*A,b*=h,t.x-=y*d,t.y-=y*b,m-=x*(f.rA.x*b-f.rA.y*d),w.x+=B*d,w.y+=B*b,p+=C*(f.rB.x*b-f.rB.y*d),f.tangentImpulse=c;parseInt(e.pointCount);if(1==e.pointCount)f=e.points[0],b=w.x+-p*f.rB.y-t.x- -m*f.rA.y,c=w.y+p*f.rB.x-t.y-m*f.rA.x,e=b*z+c*g,b=-f.normalMass*(e-f.velocityBias),c=f.normalImpulse+b,c=0<c?c:0,
b=c-f.normalImpulse,d=b*z,b*=g,t.x-=y*d,t.y-=y*b,m-=x*(f.rA.x*b-f.rA.y*d),w.x+=B*d,w.y+=B*b,p+=C*(f.rB.x*b-f.rB.y*d),f.normalImpulse=c;else{f=e.points[0];a=e.points[1];b=f.normalImpulse;r=a.normalImpulse;var E=(w.x-p*f.rB.y-t.x+m*f.rA.y)*z+(w.y+p*f.rB.x-t.y-m*f.rA.x)*g,F=(w.x-p*a.rB.y-t.x+m*a.rA.y)*z+(w.y+p*a.rB.x-t.y-m*a.rA.x)*g;c=E-f.velocityBias;d=F-a.velocityBias;h=e.K;c-=h.col1.x*b+h.col2.x*r;for(d-=h.col1.y*b+h.col2.y*r;;){h=e.normalMass;A=-(h.col1.x*c+h.col2.x*d);h=-(h.col1.y*c+h.col2.y*d);
if(0<=A&&0<=h){b=A-b;r=h-r;e=b*z;b*=g;z*=r;g*=r;t.x-=y*(e+z);t.y-=y*(b+g);m-=x*(f.rA.x*b-f.rA.y*e+a.rA.x*g-a.rA.y*z);w.x+=B*(e+z);w.y+=B*(b+g);p+=C*(f.rB.x*b-f.rB.y*e+a.rB.x*g-a.rB.y*z);f.normalImpulse=A;a.normalImpulse=h;break}A=-f.normalMass*c;h=0;F=e.K.col1.y*A+d;if(0<=A&&0<=F){b=A-b;r=h-r;e=b*z;b*=g;z*=r;g*=r;t.x-=y*(e+z);t.y-=y*(b+g);m-=x*(f.rA.x*b-f.rA.y*e+a.rA.x*g-a.rA.y*z);w.x+=B*(e+z);w.y+=B*(b+g);p+=C*(f.rB.x*b-f.rB.y*e+a.rB.x*g-a.rB.y*z);f.normalImpulse=A;a.normalImpulse=h;break}A=0;h=
-a.normalMass*d;E=e.K.col2.x*h+c;if(0<=h&&0<=E){b=A-b;r=h-r;e=b*z;b*=g;z*=r;g*=r;t.x-=y*(e+z);t.y-=y*(b+g);m-=x*(f.rA.x*b-f.rA.y*e+a.rA.x*g-a.rA.y*z);w.x+=B*(e+z);w.y+=B*(b+g);p+=C*(f.rB.x*b-f.rB.y*e+a.rB.x*g-a.rB.y*z);f.normalImpulse=A;a.normalImpulse=h;break}h=A=0;E=c;F=d;if(0<=E&&0<=F){b=A-b;r=h-r;e=b*z;b*=g;z*=r;g*=r;t.x-=y*(e+z);t.y-=y*(b+g);m-=x*(f.rA.x*b-f.rA.y*e+a.rA.x*g-a.rA.y*z);w.x+=B*(e+z);w.y+=B*(b+g);p+=C*(f.rB.x*b-f.rB.y*e+a.rB.x*g-a.rB.y*z);f.normalImpulse=A;a.normalImpulse=h;break}break}}l.m_angularVelocity=
m;n.m_angularVelocity=p}};w.prototype.FinalizeVelocityConstraints=function(){for(var a=0;a<this.m_constraintCount;++a)for(var f=this.m_constraints[a],b=f.manifold,c=0;c<f.pointCount;++c){var e=b.m_points[c],d=f.points[c];e.m_normalImpulse=d.normalImpulse;e.m_tangentImpulse=d.tangentImpulse}};w.prototype.SolvePositionConstraints=function(a){void 0===a&&(a=0);for(var f=0,b=0;b<this.m_constraintCount;b++){var c=this.m_constraints[b],e=c.bodyA,d=c.bodyB,r=e.m_mass*e.m_invMass,z=e.m_mass*e.m_invI,g=d.m_mass*
d.m_invMass,h=d.m_mass*d.m_invI;w.s_psm.Initialize(c);for(var k=w.s_psm.m_normal,l=0;l<c.pointCount;l++){var n=c.points[l],m=w.s_psm.m_points[l],p=w.s_psm.m_separations[l],t=m.x-e.m_sweep.c.x,y=m.y-e.m_sweep.c.y,x=m.x-d.m_sweep.c.x,m=m.y-d.m_sweep.c.y,f=f<p?f:p,p=P.Clamp(a*(p+K.b2_linearSlop),-K.b2_maxLinearCorrection,0),p=-n.equalizedMass*p,n=p*k.x,p=p*k.y;e.m_sweep.c.x-=r*n;e.m_sweep.c.y-=r*p;e.m_sweep.a-=z*(t*p-y*n);e.SynchronizeTransform();d.m_sweep.c.x+=g*n;d.m_sweep.c.y+=g*p;d.m_sweep.a+=h*
(x*p-m*n);d.SynchronizeTransform()}}return f>-1.5*K.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new z;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new B});Box2D.inherit(t,Box2D.Dynamics.Contacts.b2Contact);t.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;t.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};t.Create=function(a){return new t};t.Destroy=function(a,f){};t.prototype.Reset=
function(a,f){this.__super.Reset.call(this,a,f)};t.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),f=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof b?this.m_fixtureB.GetShape():null,f.m_xf)};t.prototype.b2CollideEdgeAndCircle=function(a,f,b,c,e){};Box2D.inherit(E,Box2D.Dynamics.Contacts.b2Contact);E.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;
E.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};E.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};E.prototype.Evaluate=function(){};Box2D.inherit(C,Box2D.Dynamics.Contacts.b2Contact);C.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;C.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};C.Create=function(a){return new C};C.Destroy=function(a,f){};C.prototype.Reset=function(a,
f){this.__super.Reset.call(this,a,f);K.b2Assert(a.GetType()==h.e_polygonShape);K.b2Assert(f.GetType()==h.e_circleShape)};C.prototype.Evaluate=function(){var a=this.m_fixtureA.m_body,f=this.m_fixtureB.m_body;D.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof g?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof b?this.m_fixtureB.GetShape():null,f.m_xf)};Box2D.inherit(k,Box2D.Dynamics.Contacts.b2Contact);k.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;
k.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};k.Create=function(a){return new k};k.Destroy=function(a,f){};k.prototype.Reset=function(a,f){this.__super.Reset.call(this,a,f);K.b2Assert(a.GetType()==h.e_polygonShape);K.b2Assert(f.GetType()==h.e_edgeShape)};k.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),f=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof g?this.m_fixtureA.GetShape():
null,a.m_xf,this.m_fixtureB.GetShape()instanceof n?this.m_fixtureB.GetShape():null,f.m_xf)};k.prototype.b2CollidePolyAndEdge=function(a,f,b,c,e){};Box2D.inherit(A,Box2D.Dynamics.Contacts.b2Contact);A.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;A.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};A.Create=function(a){return new A};A.Destroy=function(a,f){};A.prototype.Reset=function(a,f){this.__super.Reset.call(this,a,f)};A.prototype.Evaluate=
function(){var a=this.m_fixtureA.GetBody(),f=this.m_fixtureB.GetBody();D.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof g?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof g?this.m_fixtureB.GetShape():null,f.m_xf)};B.b2PositionSolverManifold=function(){};B.prototype.b2PositionSolverManifold=function(){this.m_normal=new J;this.m_separations=new Vector_a2j_Number(K.b2_maxManifoldPoints);this.m_points=new Vector(K.b2_maxManifoldPoints);for(var a=0;a<K.b2_maxManifoldPoints;a++)this.m_points[a]=
new J};B.prototype.Initialize=function(a){K.b2Assert(0<a.pointCount);var f,b,c,e,d,r;switch(a.type){case M.e_circles:e=a.bodyA.m_xf.R;c=a.localPoint;f=a.bodyA.m_xf.position.x+(e.col1.x*c.x+e.col2.x*c.y);b=a.bodyA.m_xf.position.y+(e.col1.y*c.x+e.col2.y*c.y);e=a.bodyB.m_xf.R;c=a.points[0].localPoint;d=a.bodyB.m_xf.position.x+(e.col1.x*c.x+e.col2.x*c.y);e=a.bodyB.m_xf.position.y+(e.col1.y*c.x+e.col2.y*c.y);c=d-f;r=e-b;var z=c*c+r*r;z>Number.MIN_VALUE*Number.MIN_VALUE?(z=Math.sqrt(z),this.m_normal.x=
c/z,this.m_normal.y=r/z):(this.m_normal.x=1,this.m_normal.y=0);this.m_points[0].x=.5*(f+d);this.m_points[0].y=.5*(b+e);this.m_separations[0]=c*this.m_normal.x+r*this.m_normal.y-a.radius;break;case M.e_faceA:e=a.bodyA.m_xf.R;c=a.localPlaneNormal;this.m_normal.x=e.col1.x*c.x+e.col2.x*c.y;this.m_normal.y=e.col1.y*c.x+e.col2.y*c.y;e=a.bodyA.m_xf.R;c=a.localPoint;d=a.bodyA.m_xf.position.x+(e.col1.x*c.x+e.col2.x*c.y);r=a.bodyA.m_xf.position.y+(e.col1.y*c.x+e.col2.y*c.y);e=a.bodyB.m_xf.R;for(f=0;f<a.pointCount;++f)c=
a.points[f].localPoint,b=a.bodyB.m_xf.position.x+(e.col1.x*c.x+e.col2.x*c.y),c=a.bodyB.m_xf.position.y+(e.col1.y*c.x+e.col2.y*c.y),this.m_separations[f]=(b-d)*this.m_normal.x+(c-r)*this.m_normal.y-a.radius,this.m_points[f].x=b,this.m_points[f].y=c;break;case M.e_faceB:e=a.bodyB.m_xf.R;c=a.localPlaneNormal;this.m_normal.x=e.col1.x*c.x+e.col2.x*c.y;this.m_normal.y=e.col1.y*c.x+e.col2.y*c.y;e=a.bodyB.m_xf.R;c=a.localPoint;d=a.bodyB.m_xf.position.x+(e.col1.x*c.x+e.col2.x*c.y);r=a.bodyB.m_xf.position.y+
(e.col1.y*c.x+e.col2.y*c.y);e=a.bodyA.m_xf.R;for(f=0;f<a.pointCount;++f)c=a.points[f].localPoint,b=a.bodyA.m_xf.position.x+(e.col1.x*c.x+e.col2.x*c.y),c=a.bodyA.m_xf.position.y+(e.col1.y*c.x+e.col2.y*c.y),this.m_separations[f]=(b-d)*this.m_normal.x+(c-r)*this.m_normal.y-a.radius,this.m_points[f].Set(b,c);this.m_normal.x*=-1;this.m_normal.y*=-1}};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new J;Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=
new J})})();
(function(){var b=Box2D.Common.Math.b2Mat22,n=Box2D.Common.Math.b2Math,g=Box2D.Common.Math.b2Vec2,h=Box2D.Common.b2Color,d=Box2D.Dynamics.Controllers.b2BuoyancyController,c=Box2D.Dynamics.Controllers.b2ConstantAccelController,m=Box2D.Dynamics.Controllers.b2ConstantForceController,a=Box2D.Dynamics.Controllers.b2Controller,l=Box2D.Dynamics.Controllers.b2ControllerEdge,p=Box2D.Dynamics.Controllers.b2GravityController,x=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(d,Box2D.Dynamics.Controllers.b2Controller);
d.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;d.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new g(0,-1);this.density=this.offset=0;this.velocity=new g(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=!1;this.useWorldGravity=!0;this.gravity=null};d.prototype.Step=function(a){if(this.m_bodyList)for(this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy()),a=this.m_bodyList;a;a=
a.nextBody){var b=a.body;if(0!=b.IsAwake()){for(var c=new g,d=new g,h=0,k=0,l=b.GetFixtureList();l;l=l.GetNext()){var n=new g,m=l.GetShape().ComputeSubmergedArea(this.normal,this.offset,b.GetTransform(),n),h=h+m;c.x+=m*n.x;c.y+=m*n.y;k+=1*m;d.x+=m*n.x*1;d.y+=m*n.y*1}c.x/=h;c.y/=h;d.x/=k;d.y/=k;h<Number.MIN_VALUE||(k=this.gravity.GetNegative(),k.Multiply(this.density*h),b.ApplyForce(k,d),d=b.GetLinearVelocityFromWorldPoint(c),d.Subtract(this.velocity),d.Multiply(-this.linearDrag*h),b.ApplyForce(d,
c),b.ApplyTorque(-b.GetInertia()/b.GetMass()*h*b.GetAngularVelocity()*this.angularDrag))}}};d.prototype.Draw=function(a){var b=new g,c=new g;b.x=this.normal.x*this.offset+1E3*this.normal.y;b.y=this.normal.y*this.offset-1E3*this.normal.x;c.x=this.normal.x*this.offset-1E3*this.normal.y;c.y=this.normal.y*this.offset+1E3*this.normal.x;var d=new h(0,0,1);a.DrawSegment(b,c,d)};Box2D.inherit(c,Box2D.Dynamics.Controllers.b2Controller);c.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;
c.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new g(0,0)};c.prototype.Step=function(a){a=new g(this.A.x*a.dt,this.A.y*a.dt);for(var b=this.m_bodyList;b;b=b.nextBody){var c=b.body;c.IsAwake()&&c.SetLinearVelocity(new g(c.GetLinearVelocity().x+a.x,c.GetLinearVelocity().y+a.y))}};Box2D.inherit(m,Box2D.Dynamics.Controllers.b2Controller);m.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;m.b2ConstantForceController=
function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new g(0,0)};m.prototype.Step=function(a){for(a=this.m_bodyList;a;a=a.nextBody){var b=a.body;b.IsAwake()&&b.ApplyForce(this.F,b.GetWorldCenter())}};a.b2Controller=function(){};a.prototype.Step=function(a){};a.prototype.Draw=function(a){};a.prototype.AddBody=function(a){var b=new l;b.controller=this;b.body=a;b.nextBody=this.m_bodyList;b.prevBody=null;this.m_bodyList=b;b.nextBody&&(b.nextBody.prevBody=b);this.m_bodyCount++;
b.nextController=a.m_controllerList;b.prevController=null;a.m_controllerList=b;b.nextController&&(b.nextController.prevController=b);a.m_controllerCount++};a.prototype.RemoveBody=function(a){for(var b=a.m_controllerList;b&&b.controller!=this;)b=b.nextController;b.prevBody&&(b.prevBody.nextBody=b.nextBody);b.nextBody&&(b.nextBody.prevBody=b.prevBody);b.nextController&&(b.nextController.prevController=b.prevController);b.prevController&&(b.prevController.nextController=b.nextController);this.m_bodyList==
b&&(this.m_bodyList=b.nextBody);a.m_controllerList==b&&(a.m_controllerList=b.nextController);a.m_controllerCount--;this.m_bodyCount--};a.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetWorld=function(){return this.m_world};a.prototype.GetBodyList=function(){return this.m_bodyList};l.b2ControllerEdge=function(){};Box2D.inherit(p,Box2D.Dynamics.Controllers.b2Controller);p.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;
p.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=!0};p.prototype.Step=function(a){var b,c,d,h,k,l,n,m,p;if(this.invSqr)for(a=this.m_bodyList;a;a=a.nextBody)for(b=a.body,c=b.GetWorldCenter(),d=b.GetMass(),h=this.m_bodyList;h!=a;h=h.nextBody)k=h.body,l=k.GetWorldCenter(),n=l.x-c.x,m=l.y-c.y,p=n*n+m*m,p<Number.MIN_VALUE||(n=new g(n,m),n.Multiply(this.G/p/Math.sqrt(p)*d*k.GetMass()),b.IsAwake()&&b.ApplyForce(n,c),n.Multiply(-1),
k.IsAwake()&&k.ApplyForce(n,l));else for(a=this.m_bodyList;a;a=a.nextBody)for(b=a.body,c=b.GetWorldCenter(),d=b.GetMass(),h=this.m_bodyList;h!=a;h=h.nextBody)k=h.body,l=k.GetWorldCenter(),n=l.x-c.x,m=l.y-c.y,p=n*n+m*m,p<Number.MIN_VALUE||(n=new g(n,m),n.Multiply(this.G/p*d*k.GetMass()),b.IsAwake()&&b.ApplyForce(n,c),n.Multiply(-1),k.IsAwake()&&k.ApplyForce(n,l))};Box2D.inherit(x,Box2D.Dynamics.Controllers.b2Controller);x.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;x.b2TensorDampingController=
function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new b;this.maxTimestep=0};x.prototype.SetAxisAligned=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.T.col1.x=-a;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-b;this.maxTimestep=0<a||0<b?1/Math.max(a,b):0};x.prototype.Step=function(a){a=a.dt;if(!(a<=Number.MIN_VALUE)){a>this.maxTimestep&&0<this.maxTimestep&&(a=this.maxTimestep);for(var b=this.m_bodyList;b;b=b.nextBody){var c=b.body;if(c.IsAwake()){var d=
c.GetWorldVector(n.MulMV(this.T,c.GetLocalVector(c.GetLinearVelocity())));c.SetLinearVelocity(new g(c.GetLinearVelocity().x+d.x*a,c.GetLinearVelocity().y+d.y*a))}}}}})();
(function(){var b=Box2D.Common.b2Settings,n=Box2D.Common.Math.b2Mat22,g=Box2D.Common.Math.b2Mat33,h=Box2D.Common.Math.b2Math,d=Box2D.Common.Math.b2Vec2,c=Box2D.Common.Math.b2Vec3,m=Box2D.Dynamics.Joints.b2DistanceJoint,a=Box2D.Dynamics.Joints.b2DistanceJointDef,l=Box2D.Dynamics.Joints.b2FrictionJoint,p=Box2D.Dynamics.Joints.b2FrictionJointDef,x=Box2D.Dynamics.Joints.b2GearJoint,y=Box2D.Dynamics.Joints.b2GearJointDef,w=Box2D.Dynamics.Joints.b2Jacobian,t=Box2D.Dynamics.Joints.b2Joint,E=Box2D.Dynamics.Joints.b2JointDef,
C=Box2D.Dynamics.Joints.b2JointEdge,k=Box2D.Dynamics.Joints.b2LineJoint,A=Box2D.Dynamics.Joints.b2LineJointDef,B=Box2D.Dynamics.Joints.b2MouseJoint,F=Box2D.Dynamics.Joints.b2MouseJointDef,H=Box2D.Dynamics.Joints.b2PrismaticJoint,K=Box2D.Dynamics.Joints.b2PrismaticJointDef,G=Box2D.Dynamics.Joints.b2PulleyJoint,P=Box2D.Dynamics.Joints.b2PulleyJointDef,J=Box2D.Dynamics.Joints.b2RevoluteJoint,D=Box2D.Dynamics.Joints.b2RevoluteJointDef,O=Box2D.Dynamics.Joints.b2WeldJoint,M=Box2D.Dynamics.Joints.b2WeldJointDef;
Box2D.inherit(m,Box2D.Dynamics.Joints.b2Joint);m.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;m.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new d;this.m_localAnchor2=new d;this.m_u=new d};m.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};m.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};m.prototype.GetReactionForce=function(a){void 0===a&&(a=0);
return new d(a*this.m_impulse*this.m_u.x,a*this.m_impulse*this.m_u.y)};m.prototype.GetReactionTorque=function(a){return 0};m.prototype.GetLength=function(){return this.m_length};m.prototype.SetLength=function(a){void 0===a&&(a=0);this.m_length=a};m.prototype.GetFrequency=function(){return this.m_frequencyHz};m.prototype.SetFrequency=function(a){void 0===a&&(a=0);this.m_frequencyHz=a};m.prototype.GetDampingRatio=function(){return this.m_dampingRatio};m.prototype.SetDampingRatio=function(a){void 0===
a&&(a=0);this.m_dampingRatio=a};m.prototype.b2DistanceJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_length=a.length;this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_bias=this.m_gamma=this.m_impulse=0};m.prototype.InitVelocityConstraints=function(a){var c,d,q=this.m_bodyA,h=this.m_bodyB;c=q.m_xf.R;var g=this.m_localAnchor1.x-q.m_sweep.localCenter.x,k=this.m_localAnchor1.y-q.m_sweep.localCenter.y;
d=c.col1.x*g+c.col2.x*k;k=c.col1.y*g+c.col2.y*k;g=d;c=h.m_xf.R;var e=this.m_localAnchor2.x-h.m_sweep.localCenter.x,l=this.m_localAnchor2.y-h.m_sweep.localCenter.y;d=c.col1.x*e+c.col2.x*l;l=c.col1.y*e+c.col2.y*l;e=d;this.m_u.x=h.m_sweep.c.x+e-q.m_sweep.c.x-g;this.m_u.y=h.m_sweep.c.y+l-q.m_sweep.c.y-k;d=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);d>b.b2_linearSlop?this.m_u.Multiply(1/d):this.m_u.SetZero();c=g*this.m_u.y-k*this.m_u.x;var n=e*this.m_u.y-l*this.m_u.x;c=q.m_invMass+q.m_invI*
c*c+h.m_invMass+h.m_invI*n*n;this.m_mass=0!=c?1/c:0;if(0<this.m_frequencyHz){d-=this.m_length;var n=2*Math.PI*this.m_frequencyHz,m=this.m_mass*n*n;this.m_gamma=a.dt*(2*this.m_mass*this.m_dampingRatio*n+a.dt*m);this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0;this.m_bias=d*a.dt*m*this.m_gamma;this.m_mass=c+this.m_gamma;this.m_mass=0!=this.m_mass?1/this.m_mass:0}a.warmStarting?(this.m_impulse*=a.dtRatio,a=this.m_impulse*this.m_u.x,c=this.m_impulse*this.m_u.y,q.m_linearVelocity.x-=q.m_invMass*a,q.m_linearVelocity.y-=
q.m_invMass*c,q.m_angularVelocity-=q.m_invI*(g*c-k*a),h.m_linearVelocity.x+=h.m_invMass*a,h.m_linearVelocity.y+=h.m_invMass*c,h.m_angularVelocity+=h.m_invI*(e*c-l*a)):this.m_impulse=0};m.prototype.SolveVelocityConstraints=function(a){var b;a=this.m_bodyA;var c=this.m_bodyB;b=a.m_xf.R;var d=this.m_localAnchor1.x-a.m_sweep.localCenter.x,h=this.m_localAnchor1.y-a.m_sweep.localCenter.y,g=b.col1.x*d+b.col2.x*h,h=b.col1.y*d+b.col2.y*h,d=g;b=c.m_xf.R;var k=this.m_localAnchor2.x-c.m_sweep.localCenter.x,e=
this.m_localAnchor2.y-c.m_sweep.localCenter.y,g=b.col1.x*k+b.col2.x*e,e=b.col1.y*k+b.col2.y*e,k=g,g=-this.m_mass*(this.m_u.x*(c.m_linearVelocity.x+-c.m_angularVelocity*e-(a.m_linearVelocity.x+-a.m_angularVelocity*h))+this.m_u.y*(c.m_linearVelocity.y+c.m_angularVelocity*k-(a.m_linearVelocity.y+a.m_angularVelocity*d))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=g;b=g*this.m_u.x;g*=this.m_u.y;a.m_linearVelocity.x-=a.m_invMass*b;a.m_linearVelocity.y-=a.m_invMass*g;a.m_angularVelocity-=a.m_invI*
(d*g-h*b);c.m_linearVelocity.x+=c.m_invMass*b;c.m_linearVelocity.y+=c.m_invMass*g;c.m_angularVelocity+=c.m_invI*(k*g-e*b)};m.prototype.SolvePositionConstraints=function(a){var c;if(0<this.m_frequencyHz)return!0;a=this.m_bodyA;var d=this.m_bodyB;c=a.m_xf.R;var q=this.m_localAnchor1.x-a.m_sweep.localCenter.x,g=this.m_localAnchor1.y-a.m_sweep.localCenter.y,k=c.col1.x*q+c.col2.x*g,g=c.col1.y*q+c.col2.y*g,q=k;c=d.m_xf.R;var l=this.m_localAnchor2.x-d.m_sweep.localCenter.x,e=this.m_localAnchor2.y-d.m_sweep.localCenter.y,
k=c.col1.x*l+c.col2.x*e,e=c.col1.y*l+c.col2.y*e,l=k,k=d.m_sweep.c.x+l-a.m_sweep.c.x-q,n=d.m_sweep.c.y+e-a.m_sweep.c.y-g;c=Math.sqrt(k*k+n*n);k/=c;n/=c;c-=this.m_length;c=h.Clamp(c,-b.b2_maxLinearCorrection,b.b2_maxLinearCorrection);var v=-this.m_mass*c;this.m_u.Set(k,n);k=v*this.m_u.x;n=v*this.m_u.y;a.m_sweep.c.x-=a.m_invMass*k;a.m_sweep.c.y-=a.m_invMass*n;a.m_sweep.a-=a.m_invI*(q*n-g*k);d.m_sweep.c.x+=d.m_invMass*k;d.m_sweep.c.y+=d.m_invMass*n;d.m_sweep.a+=d.m_invI*(l*n-e*k);a.SynchronizeTransform();
d.SynchronizeTransform();return h.Abs(c)<b.b2_linearSlop};Box2D.inherit(a,Box2D.Dynamics.Joints.b2JointDef);a.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;a.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new d;this.localAnchorB=new d};a.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=t.e_distanceJoint;this.length=1;this.dampingRatio=this.frequencyHz=0};a.prototype.Initialize=function(a,
b,c,d){this.bodyA=a;this.bodyB=b;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(d));a=d.x-c.x;c=d.y-c.y;this.length=Math.sqrt(a*a+c*c);this.dampingRatio=this.frequencyHz=0};Box2D.inherit(l,Box2D.Dynamics.Joints.b2Joint);l.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;l.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new d;this.m_localAnchorB=new d;this.m_linearMass=new n;this.m_linearImpulse=
new d};l.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};l.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};l.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new d(a*this.m_linearImpulse.x,a*this.m_linearImpulse.y)};l.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_angularImpulse};l.prototype.SetMaxForce=function(a){void 0===a&&(a=0);this.m_maxForce=a};l.prototype.GetMaxForce=function(){return this.m_maxForce};
l.prototype.SetMaxTorque=function(a){void 0===a&&(a=0);this.m_maxTorque=a};l.prototype.GetMaxTorque=function(){return this.m_maxTorque};l.prototype.b2FrictionJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchorA.SetV(a.localAnchorA);this.m_localAnchorB.SetV(a.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=a.maxForce;this.m_maxTorque=a.maxTorque};l.prototype.InitVelocityConstraints=function(a){var b,
c,d=this.m_bodyA,h=this.m_bodyB;b=d.m_xf.R;var g=this.m_localAnchorA.x-d.m_sweep.localCenter.x,k=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*g+b.col2.x*k;k=b.col1.y*g+b.col2.y*k;g=c;b=h.m_xf.R;var e=this.m_localAnchorB.x-h.m_sweep.localCenter.x,l=this.m_localAnchorB.y-h.m_sweep.localCenter.y;c=b.col1.x*e+b.col2.x*l;l=b.col1.y*e+b.col2.y*l;e=c;b=d.m_invMass;c=h.m_invMass;var v=d.m_invI,m=h.m_invI,p=new n;p.col1.x=b+c;p.col2.x=0;p.col1.y=0;p.col2.y=b+c;p.col1.x+=v*k*k;p.col2.x+=-v*g*k;
p.col1.y+=-v*g*k;p.col2.y+=v*g*g;p.col1.x+=m*l*l;p.col2.x+=-m*e*l;p.col1.y+=-m*e*l;p.col2.y+=m*e*e;p.GetInverse(this.m_linearMass);this.m_angularMass=v+m;0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass);a.warmStarting?(this.m_linearImpulse.x*=a.dtRatio,this.m_linearImpulse.y*=a.dtRatio,this.m_angularImpulse*=a.dtRatio,a=this.m_linearImpulse,d.m_linearVelocity.x-=b*a.x,d.m_linearVelocity.y-=b*a.y,d.m_angularVelocity-=v*(g*a.y-k*a.x+this.m_angularImpulse),h.m_linearVelocity.x+=c*a.x,
h.m_linearVelocity.y+=c*a.y,h.m_angularVelocity+=m*(e*a.y-l*a.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)};l.prototype.SolveVelocityConstraints=function(a){var b,c,q=this.m_bodyA,g=this.m_bodyB,k=q.m_linearVelocity,l=q.m_angularVelocity,e=g.m_linearVelocity,n=g.m_angularVelocity,v=q.m_invMass,m=g.m_invMass,p=q.m_invI,t=g.m_invI;b=q.m_xf.R;var w=this.m_localAnchorA.x-q.m_sweep.localCenter.x,x=this.m_localAnchorA.y-q.m_sweep.localCenter.y;c=b.col1.x*w+b.col2.x*
x;x=b.col1.y*w+b.col2.y*x;w=c;b=g.m_xf.R;var y=this.m_localAnchorB.x-g.m_sweep.localCenter.x,A=this.m_localAnchorB.y-g.m_sweep.localCenter.y;c=b.col1.x*y+b.col2.x*A;A=b.col1.y*y+b.col2.y*A;y=c;c=-this.m_angularMass*(n-l);var B=this.m_angularImpulse;b=a.dt*this.m_maxTorque;this.m_angularImpulse=h.Clamp(this.m_angularImpulse+c,-b,b);c=this.m_angularImpulse-B;l-=p*c;n+=t*c;b=h.MulMV(this.m_linearMass,new d(-(e.x-n*A-k.x+l*x),-(e.y+n*y-k.y-l*w)));c=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(b);
b=a.dt*this.m_maxForce;this.m_linearImpulse.LengthSquared()>b*b&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(b));b=h.SubtractVV(this.m_linearImpulse,c);k.x-=v*b.x;k.y-=v*b.y;l-=p*(w*b.y-x*b.x);e.x+=m*b.x;e.y+=m*b.y;n+=t*(y*b.y-A*b.x);q.m_angularVelocity=l;g.m_angularVelocity=n};l.prototype.SolvePositionConstraints=function(a){return!0};Box2D.inherit(p,Box2D.Dynamics.Joints.b2JointDef);p.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;p.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments);this.localAnchorA=new d;this.localAnchorB=new d};p.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=t.e_frictionJoint;this.maxTorque=this.maxForce=0};p.prototype.Initialize=function(a,b,c){this.bodyA=a;this.bodyB=b;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c))};Box2D.inherit(x,Box2D.Dynamics.Joints.b2Joint);x.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;x.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,
arguments);this.m_groundAnchor1=new d;this.m_groundAnchor2=new d;this.m_localAnchor1=new d;this.m_localAnchor2=new d;this.m_J=new w};x.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};x.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};x.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new d(a*this.m_impulse*this.m_J.linearB.x,a*this.m_impulse*this.m_J.linearB.y)};x.prototype.GetReactionTorque=function(a){void 0===
a&&(a=0);var b=this.m_bodyB.m_xf.R,c=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,d=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,g=b.col1.x*c+b.col2.x*d,d=b.col1.y*c+b.col2.y*d;return a*(this.m_impulse*this.m_J.angularB-g*this.m_impulse*this.m_J.linearB.y+d*this.m_impulse*this.m_J.linearB.x)};x.prototype.GetRatio=function(){return this.m_ratio};x.prototype.SetRatio=function(a){void 0===a&&(a=0);this.m_ratio=a};x.prototype.b2GearJoint=function(a){this.__super.b2Joint.call(this,
a);var b=parseInt(a.joint1.m_type),c=parseInt(a.joint2.m_type);this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;this.m_ground1=a.joint1.GetBodyA();this.m_bodyA=a.joint1.GetBodyB();b==t.e_revoluteJoint?(this.m_revolute1=a.joint1 instanceof J?a.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),b=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=a.joint1 instanceof H?a.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),
this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),b=this.m_prismatic1.GetJointTranslation());this.m_ground2=a.joint2.GetBodyA();this.m_bodyB=a.joint2.GetBodyB();c==t.e_revoluteJoint?(this.m_revolute2=a.joint2 instanceof J?a.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),c=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=a.joint2 instanceof H?a.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),
this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),c=this.m_prismatic2.GetJointTranslation());this.m_ratio=a.ratio;this.m_constant=b+this.m_ratio*c;this.m_impulse=0};x.prototype.InitVelocityConstraints=function(a){var b=this.m_ground1,c=this.m_ground2,d=this.m_bodyA,g=this.m_bodyB,h,k,e,l,n,m=0;this.m_J.SetZero();this.m_revolute1?(this.m_J.angularA=-1,m+=d.m_invI):(l=b.m_xf.R,h=this.m_prismatic1.m_localXAxis1,b=l.col1.x*h.x+l.col2.x*h.y,h=l.col1.y*h.x+l.col2.y*h.y,l=d.m_xf.R,k=this.m_localAnchor1.x-
d.m_sweep.localCenter.x,e=this.m_localAnchor1.y-d.m_sweep.localCenter.y,n=l.col1.x*k+l.col2.x*e,e=l.col1.y*k+l.col2.y*e,l=n*h-e*b,this.m_J.linearA.Set(-b,-h),this.m_J.angularA=-l,m+=d.m_invMass+d.m_invI*l*l);this.m_revolute2?(this.m_J.angularB=-this.m_ratio,m+=this.m_ratio*this.m_ratio*g.m_invI):(l=c.m_xf.R,h=this.m_prismatic2.m_localXAxis1,b=l.col1.x*h.x+l.col2.x*h.y,h=l.col1.y*h.x+l.col2.y*h.y,l=g.m_xf.R,k=this.m_localAnchor2.x-g.m_sweep.localCenter.x,e=this.m_localAnchor2.y-g.m_sweep.localCenter.y,
n=l.col1.x*k+l.col2.x*e,e=l.col1.y*k+l.col2.y*e,l=n*h-e*b,this.m_J.linearB.Set(-this.m_ratio*b,-this.m_ratio*h),this.m_J.angularB=-this.m_ratio*l,m+=this.m_ratio*this.m_ratio*(g.m_invMass+g.m_invI*l*l));this.m_mass=0<m?1/m:0;a.warmStarting?(d.m_linearVelocity.x+=d.m_invMass*this.m_impulse*this.m_J.linearA.x,d.m_linearVelocity.y+=d.m_invMass*this.m_impulse*this.m_J.linearA.y,d.m_angularVelocity+=d.m_invI*this.m_impulse*this.m_J.angularA,g.m_linearVelocity.x+=g.m_invMass*this.m_impulse*this.m_J.linearB.x,
g.m_linearVelocity.y+=g.m_invMass*this.m_impulse*this.m_J.linearB.y,g.m_angularVelocity+=g.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0};x.prototype.SolveVelocityConstraints=function(a){a=this.m_bodyA;var b=this.m_bodyB,c=this.m_J.Compute(a.m_linearVelocity,a.m_angularVelocity,b.m_linearVelocity,b.m_angularVelocity),c=-this.m_mass*c;this.m_impulse+=c;a.m_linearVelocity.x+=a.m_invMass*c*this.m_J.linearA.x;a.m_linearVelocity.y+=a.m_invMass*c*this.m_J.linearA.y;a.m_angularVelocity+=a.m_invI*
c*this.m_J.angularA;b.m_linearVelocity.x+=b.m_invMass*c*this.m_J.linearB.x;b.m_linearVelocity.y+=b.m_invMass*c*this.m_J.linearB.y;b.m_angularVelocity+=b.m_invI*c*this.m_J.angularB};x.prototype.SolvePositionConstraints=function(a){a=this.m_bodyA;var c=this.m_bodyB,d,q;d=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation();q=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();d=-this.m_mass*(this.m_constant-(d+this.m_ratio*q));
a.m_sweep.c.x+=a.m_invMass*d*this.m_J.linearA.x;a.m_sweep.c.y+=a.m_invMass*d*this.m_J.linearA.y;a.m_sweep.a+=a.m_invI*d*this.m_J.angularA;c.m_sweep.c.x+=c.m_invMass*d*this.m_J.linearB.x;c.m_sweep.c.y+=c.m_invMass*d*this.m_J.linearB.y;c.m_sweep.a+=c.m_invI*d*this.m_J.angularB;a.SynchronizeTransform();c.SynchronizeTransform();return 0<b.b2_linearSlop};Box2D.inherit(y,Box2D.Dynamics.Joints.b2JointDef);y.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;y.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments)};y.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=t.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1};w.b2Jacobian=function(){this.linearA=new d;this.linearB=new d};w.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};w.prototype.Set=function(a,b,c,d){void 0===b&&(b=0);void 0===d&&(d=0);this.linearA.SetV(a);this.angularA=b;this.linearB.SetV(c);this.angularB=d};w.prototype.Compute=function(a,
b,c,d){void 0===b&&(b=0);void 0===d&&(d=0);return this.linearA.x*a.x+this.linearA.y*a.y+this.angularA*b+(this.linearB.x*c.x+this.linearB.y*c.y)+this.angularB*d};t.b2Joint=function(){this.m_edgeA=new C;this.m_edgeB=new C;this.m_localCenterA=new d;this.m_localCenterB=new d};t.prototype.GetType=function(){return this.m_type};t.prototype.GetAnchorA=function(){return null};t.prototype.GetAnchorB=function(){return null};t.prototype.GetReactionForce=function(a){return null};t.prototype.GetReactionTorque=
function(a){return 0};t.prototype.GetBodyA=function(){return this.m_bodyA};t.prototype.GetBodyB=function(){return this.m_bodyB};t.prototype.GetNext=function(){return this.m_next};t.prototype.GetUserData=function(){return this.m_userData};t.prototype.SetUserData=function(a){this.m_userData=a};t.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};t.Create=function(b,c){var d=null;switch(b.type){case t.e_distanceJoint:d=new m(b instanceof a?b:null);break;case t.e_mouseJoint:d=
new B(b instanceof F?b:null);break;case t.e_prismaticJoint:d=new H(b instanceof K?b:null);break;case t.e_revoluteJoint:d=new J(b instanceof D?b:null);break;case t.e_pulleyJoint:d=new G(b instanceof P?b:null);break;case t.e_gearJoint:d=new x(b instanceof y?b:null);break;case t.e_lineJoint:d=new k(b instanceof A?b:null);break;case t.e_weldJoint:d=new O(b instanceof M?b:null);break;case t.e_frictionJoint:d=new l(b instanceof p?b:null)}return d};t.Destroy=function(a,b){};t.prototype.b2Joint=function(a){b.b2Assert(a.bodyA!=
a.bodyB);this.m_type=a.type;this.m_next=this.m_prev=null;this.m_bodyA=a.bodyA;this.m_bodyB=a.bodyB;this.m_collideConnected=a.collideConnected;this.m_islandFlag=!1;this.m_userData=a.userData};t.prototype.InitVelocityConstraints=function(a){};t.prototype.SolveVelocityConstraints=function(a){};t.prototype.FinalizeVelocityConstraints=function(){};t.prototype.SolvePositionConstraints=function(a){return!1};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0;Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=
1;Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2;Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3;Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4;Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5;Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6;Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7;Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8;Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9;Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0;Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1;Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=
2;Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3});E.b2JointDef=function(){};E.prototype.b2JointDef=function(){this.type=t.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1};C.b2JointEdge=function(){};Box2D.inherit(k,Box2D.Dynamics.Joints.b2Joint);k.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;k.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new d;this.m_localAnchor2=new d;this.m_localXAxis1=new d;this.m_localYAxis1=
new d;this.m_axis=new d;this.m_perp=new d;this.m_K=new n;this.m_impulse=new d};k.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};k.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};k.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new d(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};
k.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_impulse.y};k.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchor1),d=b.GetWorldPoint(this.m_localAnchor2),b=d.x-c.x,c=d.y-c.y,a=a.GetWorldVector(this.m_localXAxis1);return a.x*b+a.y*c};k.prototype.GetJointSpeed=function(){var a=this.m_bodyA,b=this.m_bodyB,c;c=a.m_xf.R;var d=this.m_localAnchor1.x-a.m_sweep.localCenter.x,g=this.m_localAnchor1.y-a.m_sweep.localCenter.y,
h=c.col1.x*d+c.col2.x*g,g=c.col1.y*d+c.col2.y*g,d=h;c=b.m_xf.R;var k=this.m_localAnchor2.x-b.m_sweep.localCenter.x,e=this.m_localAnchor2.y-b.m_sweep.localCenter.y,h=c.col1.x*k+c.col2.x*e,e=c.col1.y*k+c.col2.y*e,k=h;c=b.m_sweep.c.x+k-(a.m_sweep.c.x+d);var h=b.m_sweep.c.y+e-(a.m_sweep.c.y+g),l=a.GetWorldVector(this.m_localXAxis1),n=a.m_linearVelocity,m=b.m_linearVelocity,a=a.m_angularVelocity,b=b.m_angularVelocity;return c*-a*l.y+h*a*l.x+(l.x*(m.x+-b*e-n.x- -a*g)+l.y*(m.y+b*k-n.y-a*d))};k.prototype.IsLimitEnabled=
function(){return this.m_enableLimit};k.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=a};k.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};k.prototype.GetUpperLimit=function(){return this.m_upperTranslation};k.prototype.SetLimits=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=a;this.m_upperTranslation=b};k.prototype.IsMotorEnabled=function(){return this.m_enableMotor};
k.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a};k.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a};k.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};k.prototype.SetMaxMotorForce=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=a};k.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};
k.prototype.GetMotorForce=function(){return this.m_motorImpulse};k.prototype.b2LineJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_localXAxis1.SetV(a.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=a.lowerTranslation;this.m_upperTranslation=a.upperTranslation;this.m_maxMotorForce=
a.maxMotorForce;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=t.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};k.prototype.InitVelocityConstraints=function(a){var c=this.m_bodyA,d=this.m_bodyB,q,g;this.m_localCenterA.SetV(c.GetLocalCenter());this.m_localCenterB.SetV(d.GetLocalCenter());var k=c.GetTransform();d.GetTransform();q=c.m_xf.R;var l=this.m_localAnchor1.x-this.m_localCenterA.x,e=this.m_localAnchor1.y-this.m_localCenterA.y;
g=q.col1.x*l+q.col2.x*e;e=q.col1.y*l+q.col2.y*e;l=g;q=d.m_xf.R;var n=this.m_localAnchor2.x-this.m_localCenterB.x,m=this.m_localAnchor2.y-this.m_localCenterB.y;g=q.col1.x*n+q.col2.x*m;m=q.col1.y*n+q.col2.y*m;n=g;q=d.m_sweep.c.x+n-c.m_sweep.c.x-l;g=d.m_sweep.c.y+m-c.m_sweep.c.y-e;this.m_invMassA=c.m_invMass;this.m_invMassB=d.m_invMass;this.m_invIA=c.m_invI;this.m_invIB=d.m_invI;this.m_axis.SetV(h.MulMV(k.R,this.m_localXAxis1));this.m_a1=(q+l)*this.m_axis.y-(g+e)*this.m_axis.x;this.m_a2=n*this.m_axis.y-
m*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0;this.m_perp.SetV(h.MulMV(k.R,this.m_localYAxis1));this.m_s1=(q+l)*this.m_perp.y-(g+e)*this.m_perp.x;this.m_s2=n*this.m_perp.y-m*this.m_perp.x;k=this.m_invMassA;l=this.m_invMassB;e=this.m_invIA;n=this.m_invIB;this.m_K.col1.x=k+l+e*this.m_s1*this.m_s1+n*this.m_s2*this.m_s2;this.m_K.col1.y=e*this.m_s1*
this.m_a1+n*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=k+l+e*this.m_a1*this.m_a1+n*this.m_a2*this.m_a2;this.m_enableLimit?(q=this.m_axis.x*q+this.m_axis.y*g,h.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b.b2_linearSlop?this.m_limitState=t.e_equalLimits:q<=this.m_lowerTranslation?this.m_limitState!=t.e_atLowerLimit&&(this.m_limitState=t.e_atLowerLimit,this.m_impulse.y=0):q>=this.m_upperTranslation?this.m_limitState!=t.e_atUpperLimit&&(this.m_limitState=t.e_atUpperLimit,
this.m_impulse.y=0):(this.m_limitState=t.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=t.e_inactiveLimit;0==this.m_enableMotor&&(this.m_motorImpulse=0);a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,q=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,g=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*
this.m_a1,k=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,c.m_linearVelocity.x-=this.m_invMassA*a,c.m_linearVelocity.y-=this.m_invMassA*q,c.m_angularVelocity-=this.m_invIA*g,d.m_linearVelocity.x+=this.m_invMassB*a,d.m_linearVelocity.y+=this.m_invMassB*q,d.m_angularVelocity+=this.m_invIB*k):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};k.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,c=this.m_bodyB,q=b.m_linearVelocity,g=b.m_angularVelocity,k=c.m_linearVelocity,
l=c.m_angularVelocity,e,n,m;this.m_enableMotor&&this.m_limitState!=t.e_equalLimits&&(m=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(k.x-q.x)+this.m_axis.y*(k.y-q.y)+this.m_a2*l-this.m_a1*g)),e=this.m_motorImpulse,a=a.dt*this.m_maxMotorForce,this.m_motorImpulse=h.Clamp(this.m_motorImpulse+m,-a,a),m=this.m_motorImpulse-e,e=m*this.m_axis.x,a=m*this.m_axis.y,n=m*this.m_a1,m*=this.m_a2,q.x-=this.m_invMassA*e,q.y-=this.m_invMassA*a,g-=this.m_invIA*n,k.x+=this.m_invMassB*e,k.y+=this.m_invMassB*a,
l+=this.m_invIB*m);a=this.m_perp.x*(k.x-q.x)+this.m_perp.y*(k.y-q.y)+this.m_s2*l-this.m_s1*g;this.m_enableLimit&&this.m_limitState!=t.e_inactiveLimit?(n=this.m_axis.x*(k.x-q.x)+this.m_axis.y*(k.y-q.y)+this.m_a2*l-this.m_a1*g,e=this.m_impulse.Copy(),m=this.m_K.Solve(new d,-a,-n),this.m_impulse.Add(m),this.m_limitState==t.e_atLowerLimit?this.m_impulse.y=h.Max(this.m_impulse.y,0):this.m_limitState==t.e_atUpperLimit&&(this.m_impulse.y=h.Min(this.m_impulse.y,0)),a=-a-(this.m_impulse.y-e.y)*this.m_K.col2.x,
this.m_impulse.x=0!=this.m_K.col1.x?a/this.m_K.col1.x+e.x:e.x,m.x=this.m_impulse.x-e.x,m.y=this.m_impulse.y-e.y,e=m.x*this.m_perp.x+m.y*this.m_axis.x,a=m.x*this.m_perp.y+m.y*this.m_axis.y,n=m.x*this.m_s1+m.y*this.m_a1,m=m.x*this.m_s2+m.y*this.m_a2):(m=0!=this.m_K.col1.x?-a/this.m_K.col1.x:0,this.m_impulse.x+=m,e=m*this.m_perp.x,a=m*this.m_perp.y,n=m*this.m_s1,m*=this.m_s2);q.x-=this.m_invMassA*e;q.y-=this.m_invMassA*a;g-=this.m_invIA*n;k.x+=this.m_invMassB*e;k.y+=this.m_invMassB*a;l+=this.m_invIB*
m;b.m_linearVelocity.SetV(q);b.m_angularVelocity=g;c.m_linearVelocity.SetV(k);c.m_angularVelocity=l};k.prototype.SolvePositionConstraints=function(a){a=this.m_bodyA;var c=this.m_bodyB,g=a.m_sweep.c,q=a.m_sweep.a,k=c.m_sweep.c,l=c.m_sweep.a,m,e,p,v,t,w,x=0;p=!1;var y=0,A=n.FromAngle(q);t=n.FromAngle(l);m=A;var B=this.m_localAnchor1.x-this.m_localCenterA.x;v=this.m_localAnchor1.y-this.m_localCenterA.y;e=m.col1.x*B+m.col2.x*v;v=m.col1.y*B+m.col2.y*v;B=e;m=t;t=this.m_localAnchor2.x-this.m_localCenterB.x;
w=this.m_localAnchor2.y-this.m_localCenterB.y;e=m.col1.x*t+m.col2.x*w;w=m.col1.y*t+m.col2.y*w;t=e;m=k.x+t-g.x-B;e=k.y+w-g.y-v;if(this.m_enableLimit){this.m_axis=h.MulMV(A,this.m_localXAxis1);this.m_a1=(m+B)*this.m_axis.y-(e+v)*this.m_axis.x;this.m_a2=t*this.m_axis.y-w*this.m_axis.x;var C=this.m_axis.x*m+this.m_axis.y*e;h.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b.b2_linearSlop?(y=h.Clamp(C,-b.b2_maxLinearCorrection,b.b2_maxLinearCorrection),x=h.Abs(C),p=!0):C<=this.m_lowerTranslation?
(y=h.Clamp(C-this.m_lowerTranslation+b.b2_linearSlop,-b.b2_maxLinearCorrection,0),x=this.m_lowerTranslation-C,p=!0):C>=this.m_upperTranslation&&(y=h.Clamp(C-this.m_upperTranslation+b.b2_linearSlop,0,b.b2_maxLinearCorrection),x=C-this.m_upperTranslation,p=!0)}this.m_perp=h.MulMV(A,this.m_localYAxis1);this.m_s1=(m+B)*this.m_perp.y-(e+v)*this.m_perp.x;this.m_s2=t*this.m_perp.y-w*this.m_perp.x;A=new d;B=this.m_perp.x*m+this.m_perp.y*e;x=h.Max(x,h.Abs(B));p?(p=this.m_invMassA,v=this.m_invMassB,t=this.m_invIA,
w=this.m_invIB,this.m_K.col1.x=p+v+t*this.m_s1*this.m_s1+w*this.m_s2*this.m_s2,this.m_K.col1.y=t*this.m_s1*this.m_a1+w*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=p+v+t*this.m_a1*this.m_a1+w*this.m_a2*this.m_a2,this.m_K.Solve(A,-B,-y)):(p=this.m_invMassA,v=this.m_invMassB,t=this.m_invIA,w=this.m_invIB,y=p+v+t*this.m_s1*this.m_s1+w*this.m_s2*this.m_s2,A.x=0!=y?-B/y:0,A.y=0);y=A.x*this.m_perp.x+A.y*this.m_axis.x;p=A.x*this.m_perp.y+A.y*this.m_axis.y;B=A.x*this.m_s1+A.y*this.m_a1;
A=A.x*this.m_s2+A.y*this.m_a2;g.x-=this.m_invMassA*y;g.y-=this.m_invMassA*p;q-=this.m_invIA*B;k.x+=this.m_invMassB*y;k.y+=this.m_invMassB*p;l+=this.m_invIB*A;a.m_sweep.a=q;c.m_sweep.a=l;a.SynchronizeTransform();c.SynchronizeTransform();return x<=b.b2_linearSlop&&0<=b.b2_angularSlop};Box2D.inherit(A,Box2D.Dynamics.Joints.b2JointDef);A.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;A.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=
new d;this.localAnchorB=new d;this.localAxisA=new d};A.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=t.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};A.prototype.Initialize=function(a,b,c,d){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(c);this.localAnchorB=this.bodyB.GetLocalPoint(c);this.localAxisA=this.bodyA.GetLocalVector(d)};
Box2D.inherit(B,Box2D.Dynamics.Joints.b2Joint);B.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;B.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new n;this.K1=new n;this.K2=new n;this.m_localAnchor=new d;this.m_target=new d;this.m_impulse=new d;this.m_mass=new n;this.m_C=new d};B.prototype.GetAnchorA=function(){return this.m_target};B.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};B.prototype.GetReactionForce=
function(a){void 0===a&&(a=0);return new d(a*this.m_impulse.x,a*this.m_impulse.y)};B.prototype.GetReactionTorque=function(a){return 0};B.prototype.GetTarget=function(){return this.m_target};B.prototype.SetTarget=function(a){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0);this.m_target=a};B.prototype.GetMaxForce=function(){return this.m_maxForce};B.prototype.SetMaxForce=function(a){void 0===a&&(a=0);this.m_maxForce=a};B.prototype.GetFrequency=function(){return this.m_frequencyHz};B.prototype.SetFrequency=
function(a){void 0===a&&(a=0);this.m_frequencyHz=a};B.prototype.GetDampingRatio=function(){return this.m_dampingRatio};B.prototype.SetDampingRatio=function(a){void 0===a&&(a=0);this.m_dampingRatio=a};B.prototype.b2MouseJoint=function(a){this.__super.b2Joint.call(this,a);this.m_target.SetV(a.target);var b=this.m_target.x-this.m_bodyB.m_xf.position.x,c=this.m_target.y-this.m_bodyB.m_xf.position.y,d=this.m_bodyB.m_xf.R;this.m_localAnchor.x=b*d.col1.x+c*d.col1.y;this.m_localAnchor.y=b*d.col2.x+c*d.col2.y;
this.m_maxForce=a.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_gamma=this.m_beta=0};B.prototype.InitVelocityConstraints=function(a){var b=this.m_bodyB,c=b.GetMass(),d=2*Math.PI*this.m_frequencyHz,g=c*d*d;this.m_gamma=a.dt*(2*c*this.m_dampingRatio*d+a.dt*g);this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0;this.m_beta=a.dt*g*this.m_gamma;var g=b.m_xf.R,c=this.m_localAnchor.x-b.m_sweep.localCenter.x,d=this.m_localAnchor.y-b.m_sweep.localCenter.y,
h=g.col1.x*c+g.col2.x*d,d=g.col1.y*c+g.col2.y*d,c=h,g=b.m_invMass,h=b.m_invI;this.K1.col1.x=g;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=g;this.K2.col1.x=h*d*d;this.K2.col2.x=-h*c*d;this.K2.col1.y=-h*c*d;this.K2.col2.y=h*c*c;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=b.m_sweep.c.x+c-this.m_target.x;this.m_C.y=b.m_sweep.c.y+d-this.m_target.y;b.m_angularVelocity*=.98;this.m_impulse.x*=a.dtRatio;this.m_impulse.y*=
a.dtRatio;b.m_linearVelocity.x+=g*this.m_impulse.x;b.m_linearVelocity.y+=g*this.m_impulse.y;b.m_angularVelocity+=h*(c*this.m_impulse.y-d*this.m_impulse.x)};B.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyB,c,d,g;c=b.m_xf.R;var h=this.m_localAnchor.x-b.m_sweep.localCenter.x,k=this.m_localAnchor.y-b.m_sweep.localCenter.y;d=c.col1.x*h+c.col2.x*k;k=c.col1.y*h+c.col2.y*k;h=d;d=b.m_linearVelocity.x+-b.m_angularVelocity*k;var e=b.m_linearVelocity.y+b.m_angularVelocity*h;c=this.m_mass;d=
d+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;g=e+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;e=-(c.col1.x*d+c.col2.x*g);g=-(c.col1.y*d+c.col2.y*g);c=this.m_impulse.x;d=this.m_impulse.y;this.m_impulse.x+=e;this.m_impulse.y+=g;a=a.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&this.m_impulse.Multiply(a/this.m_impulse.Length());e=this.m_impulse.x-c;g=this.m_impulse.y-d;b.m_linearVelocity.x+=b.m_invMass*e;b.m_linearVelocity.y+=b.m_invMass*g;b.m_angularVelocity+=b.m_invI*(h*
g-k*e)};B.prototype.SolvePositionConstraints=function(a){return!0};Box2D.inherit(F,Box2D.Dynamics.Joints.b2JointDef);F.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;F.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.target=new d};F.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=t.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=.7};Box2D.inherit(H,Box2D.Dynamics.Joints.b2Joint);H.prototype.__super=
Box2D.Dynamics.Joints.b2Joint.prototype;H.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new d;this.m_localAnchor2=new d;this.m_localXAxis1=new d;this.m_localYAxis1=new d;this.m_axis=new d;this.m_perp=new d;this.m_K=new g;this.m_impulse=new c};H.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};H.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};H.prototype.GetReactionForce=
function(a){void 0===a&&(a=0);return new d(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};H.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_impulse.y};H.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchor1),d=b.GetWorldPoint(this.m_localAnchor2),b=d.x-c.x,c=d.y-c.y,a=a.GetWorldVector(this.m_localXAxis1);
return a.x*b+a.y*c};H.prototype.GetJointSpeed=function(){var a=this.m_bodyA,b=this.m_bodyB,c;c=a.m_xf.R;var d=this.m_localAnchor1.x-a.m_sweep.localCenter.x,g=this.m_localAnchor1.y-a.m_sweep.localCenter.y,h=c.col1.x*d+c.col2.x*g,g=c.col1.y*d+c.col2.y*g,d=h;c=b.m_xf.R;var k=this.m_localAnchor2.x-b.m_sweep.localCenter.x,e=this.m_localAnchor2.y-b.m_sweep.localCenter.y,h=c.col1.x*k+c.col2.x*e,e=c.col1.y*k+c.col2.y*e,k=h;c=b.m_sweep.c.x+k-(a.m_sweep.c.x+d);var h=b.m_sweep.c.y+e-(a.m_sweep.c.y+g),l=a.GetWorldVector(this.m_localXAxis1),
n=a.m_linearVelocity,m=b.m_linearVelocity,a=a.m_angularVelocity,b=b.m_angularVelocity;return c*-a*l.y+h*a*l.x+(l.x*(m.x+-b*e-n.x- -a*g)+l.y*(m.y+b*k-n.y-a*d))};H.prototype.IsLimitEnabled=function(){return this.m_enableLimit};H.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=a};H.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};H.prototype.GetUpperLimit=function(){return this.m_upperTranslation};H.prototype.SetLimits=function(a,
b){void 0===a&&(a=0);void 0===b&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=a;this.m_upperTranslation=b};H.prototype.IsMotorEnabled=function(){return this.m_enableMotor};H.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a};H.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a};H.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};
H.prototype.SetMaxMotorForce=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=a};H.prototype.GetMotorForce=function(){return this.m_motorImpulse};H.prototype.b2PrismaticJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_localXAxis1.SetV(a.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=a.referenceAngle;
this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=a.lowerTranslation;this.m_upperTranslation=a.upperTranslation;this.m_maxMotorForce=a.maxMotorForce;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=t.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};H.prototype.InitVelocityConstraints=function(a){var c=this.m_bodyA,d=this.m_bodyB,g,k;this.m_localCenterA.SetV(c.GetLocalCenter());this.m_localCenterB.SetV(d.GetLocalCenter());
var l=c.GetTransform();d.GetTransform();g=c.m_xf.R;var n=this.m_localAnchor1.x-this.m_localCenterA.x,e=this.m_localAnchor1.y-this.m_localCenterA.y;k=g.col1.x*n+g.col2.x*e;e=g.col1.y*n+g.col2.y*e;n=k;g=d.m_xf.R;var m=this.m_localAnchor2.x-this.m_localCenterB.x,p=this.m_localAnchor2.y-this.m_localCenterB.y;k=g.col1.x*m+g.col2.x*p;p=g.col1.y*m+g.col2.y*p;m=k;g=d.m_sweep.c.x+m-c.m_sweep.c.x-n;k=d.m_sweep.c.y+p-c.m_sweep.c.y-e;this.m_invMassA=c.m_invMass;this.m_invMassB=d.m_invMass;this.m_invIA=c.m_invI;
this.m_invIB=d.m_invI;this.m_axis.SetV(h.MulMV(l.R,this.m_localXAxis1));this.m_a1=(g+n)*this.m_axis.y-(k+e)*this.m_axis.x;this.m_a2=m*this.m_axis.y-p*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass);this.m_perp.SetV(h.MulMV(l.R,this.m_localYAxis1));this.m_s1=(g+n)*this.m_perp.y-(k+e)*this.m_perp.x;this.m_s2=m*this.m_perp.y-p*this.m_perp.x;l=this.m_invMassA;
n=this.m_invMassB;e=this.m_invIA;m=this.m_invIB;this.m_K.col1.x=l+n+e*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2;this.m_K.col1.y=e*this.m_s1+m*this.m_s2;this.m_K.col1.z=e*this.m_s1*this.m_a1+m*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=e+m;this.m_K.col2.z=e*this.m_a1+m*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=l+n+e*this.m_a1*this.m_a1+m*this.m_a2*this.m_a2;this.m_enableLimit?(g=this.m_axis.x*g+this.m_axis.y*k,h.Abs(this.m_upperTranslation-
this.m_lowerTranslation)<2*b.b2_linearSlop?this.m_limitState=t.e_equalLimits:g<=this.m_lowerTranslation?this.m_limitState!=t.e_atLowerLimit&&(this.m_limitState=t.e_atLowerLimit,this.m_impulse.z=0):g>=this.m_upperTranslation?this.m_limitState!=t.e_atUpperLimit&&(this.m_limitState=t.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=t.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=t.e_inactiveLimit;0==this.m_enableMotor&&(this.m_motorImpulse=0);a.warmStarting?(this.m_impulse.x*=a.dtRatio,
this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,g=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,k=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,l=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,c.m_linearVelocity.x-=this.m_invMassA*a,c.m_linearVelocity.y-=this.m_invMassA*g,
c.m_angularVelocity-=this.m_invIA*k,d.m_linearVelocity.x+=this.m_invMassB*a,d.m_linearVelocity.y+=this.m_invMassB*g,d.m_angularVelocity+=this.m_invIB*l):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};H.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,g=this.m_bodyB,q=b.m_linearVelocity,k=b.m_angularVelocity,l=g.m_linearVelocity,n=g.m_angularVelocity,e,m,p;this.m_enableMotor&&this.m_limitState!=t.e_equalLimits&&(p=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(l.x-q.x)+this.m_axis.y*
(l.y-q.y)+this.m_a2*n-this.m_a1*k)),e=this.m_motorImpulse,a=a.dt*this.m_maxMotorForce,this.m_motorImpulse=h.Clamp(this.m_motorImpulse+p,-a,a),p=this.m_motorImpulse-e,e=p*this.m_axis.x,a=p*this.m_axis.y,m=p*this.m_a1,p*=this.m_a2,q.x-=this.m_invMassA*e,q.y-=this.m_invMassA*a,k-=this.m_invIA*m,l.x+=this.m_invMassB*e,l.y+=this.m_invMassB*a,n+=this.m_invIB*p);m=this.m_perp.x*(l.x-q.x)+this.m_perp.y*(l.y-q.y)+this.m_s2*n-this.m_s1*k;a=n-k;this.m_enableLimit&&this.m_limitState!=t.e_inactiveLimit?(p=this.m_axis.x*
(l.x-q.x)+this.m_axis.y*(l.y-q.y)+this.m_a2*n-this.m_a1*k,e=this.m_impulse.Copy(),p=this.m_K.Solve33(new c,-m,-a,-p),this.m_impulse.Add(p),this.m_limitState==t.e_atLowerLimit?this.m_impulse.z=h.Max(this.m_impulse.z,0):this.m_limitState==t.e_atUpperLimit&&(this.m_impulse.z=h.Min(this.m_impulse.z,0)),m=-m-(this.m_impulse.z-e.z)*this.m_K.col3.x,a=-a-(this.m_impulse.z-e.z)*this.m_K.col3.y,a=this.m_K.Solve22(new d,m,a),a.x+=e.x,a.y+=e.y,this.m_impulse.x=a.x,this.m_impulse.y=a.y,p.x=this.m_impulse.x-e.x,
p.y=this.m_impulse.y-e.y,p.z=this.m_impulse.z-e.z,e=p.x*this.m_perp.x+p.z*this.m_axis.x,a=p.x*this.m_perp.y+p.z*this.m_axis.y,m=p.x*this.m_s1+p.y+p.z*this.m_a1,p=p.x*this.m_s2+p.y+p.z*this.m_a2):(p=this.m_K.Solve22(new d,-m,-a),this.m_impulse.x+=p.x,this.m_impulse.y+=p.y,e=p.x*this.m_perp.x,a=p.x*this.m_perp.y,m=p.x*this.m_s1+p.y,p=p.x*this.m_s2+p.y);q.x-=this.m_invMassA*e;q.y-=this.m_invMassA*a;k-=this.m_invIA*m;l.x+=this.m_invMassB*e;l.y+=this.m_invMassB*a;n+=this.m_invIB*p;b.m_linearVelocity.SetV(q);
b.m_angularVelocity=k;g.m_linearVelocity.SetV(l);g.m_angularVelocity=n};H.prototype.SolvePositionConstraints=function(a){a=this.m_bodyA;var g=this.m_bodyB,k=a.m_sweep.c,q=a.m_sweep.a,l=g.m_sweep.c,m=g.m_sweep.a,p,e,u,v,t=0,w;u=!1;var x=0,y=n.FromAngle(q),A=n.FromAngle(m);p=y;w=this.m_localAnchor1.x-this.m_localCenterA.x;var B=this.m_localAnchor1.y-this.m_localCenterA.y;e=p.col1.x*w+p.col2.x*B;B=p.col1.y*w+p.col2.y*B;w=e;p=A;A=this.m_localAnchor2.x-this.m_localCenterB.x;v=this.m_localAnchor2.y-this.m_localCenterB.y;
e=p.col1.x*A+p.col2.x*v;v=p.col1.y*A+p.col2.y*v;A=e;p=l.x+A-k.x-w;e=l.y+v-k.y-B;if(this.m_enableLimit){this.m_axis=h.MulMV(y,this.m_localXAxis1);this.m_a1=(p+w)*this.m_axis.y-(e+B)*this.m_axis.x;this.m_a2=A*this.m_axis.y-v*this.m_axis.x;var C=this.m_axis.x*p+this.m_axis.y*e;h.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b.b2_linearSlop?(x=h.Clamp(C,-b.b2_maxLinearCorrection,b.b2_maxLinearCorrection),t=h.Abs(C),u=!0):C<=this.m_lowerTranslation?(x=h.Clamp(C-this.m_lowerTranslation+b.b2_linearSlop,
-b.b2_maxLinearCorrection,0),t=this.m_lowerTranslation-C,u=!0):C>=this.m_upperTranslation&&(x=h.Clamp(C-this.m_upperTranslation+b.b2_linearSlop,0,b.b2_maxLinearCorrection),t=C-this.m_upperTranslation,u=!0)}this.m_perp=h.MulMV(y,this.m_localYAxis1);this.m_s1=(p+w)*this.m_perp.y-(e+B)*this.m_perp.x;this.m_s2=A*this.m_perp.y-v*this.m_perp.x;y=new c;B=this.m_perp.x*p+this.m_perp.y*e;A=m-q-this.m_refAngle;t=h.Max(t,h.Abs(B));w=h.Abs(A);u?(u=this.m_invMassA,v=this.m_invMassB,p=this.m_invIA,e=this.m_invIB,
this.m_K.col1.x=u+v+p*this.m_s1*this.m_s1+e*this.m_s2*this.m_s2,this.m_K.col1.y=p*this.m_s1+e*this.m_s2,this.m_K.col1.z=p*this.m_s1*this.m_a1+e*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=p+e,this.m_K.col2.z=p*this.m_a1+e*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=u+v+p*this.m_a1*this.m_a1+e*this.m_a2*this.m_a2,this.m_K.Solve33(y,-B,-A,-x)):(u=this.m_invMassA,v=this.m_invMassB,p=this.m_invIA,e=this.m_invIB,x=p*this.m_s1+e*this.m_s2,
C=p+e,this.m_K.col1.Set(u+v+p*this.m_s1*this.m_s1+e*this.m_s2*this.m_s2,x,0),this.m_K.col2.Set(x,C,0),x=this.m_K.Solve22(new d,-B,-A),y.x=x.x,y.y=x.y,y.z=0);x=y.x*this.m_perp.x+y.z*this.m_axis.x;u=y.x*this.m_perp.y+y.z*this.m_axis.y;B=y.x*this.m_s1+y.y+y.z*this.m_a1;y=y.x*this.m_s2+y.y+y.z*this.m_a2;k.x-=this.m_invMassA*x;k.y-=this.m_invMassA*u;q-=this.m_invIA*B;l.x+=this.m_invMassB*x;l.y+=this.m_invMassB*u;m+=this.m_invIB*y;a.m_sweep.a=q;g.m_sweep.a=m;a.SynchronizeTransform();g.SynchronizeTransform();
return t<=b.b2_linearSlop&&w<=b.b2_angularSlop};Box2D.inherit(K,Box2D.Dynamics.Joints.b2JointDef);K.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;K.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new d;this.localAnchorB=new d;this.localAxisA=new d};K.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this);this.type=t.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=
!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};K.prototype.Initialize=function(a,b,c,d){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(c);this.localAnchorB=this.bodyB.GetLocalPoint(c);this.localAxisA=this.bodyA.GetLocalVector(d);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(G,Box2D.Dynamics.Joints.b2Joint);G.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;G.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,
arguments);this.m_groundAnchor1=new d;this.m_groundAnchor2=new d;this.m_localAnchor1=new d;this.m_localAnchor2=new d;this.m_u1=new d;this.m_u2=new d};G.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};G.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};G.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new d(a*this.m_impulse*this.m_u2.x,a*this.m_impulse*this.m_u2.y)};G.prototype.GetReactionTorque=function(a){return 0};
G.prototype.GetGroundAnchorA=function(){var a=this.m_ground.m_xf.position.Copy();a.Add(this.m_groundAnchor1);return a};G.prototype.GetGroundAnchorB=function(){var a=this.m_ground.m_xf.position.Copy();a.Add(this.m_groundAnchor2);return a};G.prototype.GetLength1=function(){var a=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),b=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),a=a.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(b*b+a*a)};G.prototype.GetLength2=function(){var a=
this.m_bodyB.GetWorldPoint(this.m_localAnchor2),b=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x),a=a.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(b*b+a*a)};G.prototype.GetRatio=function(){return this.m_ratio};G.prototype.b2PulleyJoint=function(a){this.__super.b2Joint.call(this,a);this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=a.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=a.groundAnchorA.y-this.m_ground.m_xf.position.y;
this.m_groundAnchor2.x=a.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=a.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_ratio=a.ratio;this.m_constant=a.lengthA+this.m_ratio*a.lengthB;this.m_maxLength1=h.Min(a.maxLengthA,this.m_constant-this.m_ratio*G.b2_minPulleyLength);this.m_maxLength2=h.Min(a.maxLengthB,(this.m_constant-G.b2_minPulleyLength)/this.m_ratio);this.m_limitImpulse2=this.m_limitImpulse1=
this.m_impulse=0};G.prototype.InitVelocityConstraints=function(a){var c=this.m_bodyA,d=this.m_bodyB,g;g=c.m_xf.R;var h=this.m_localAnchor1.x-c.m_sweep.localCenter.x,k=this.m_localAnchor1.y-c.m_sweep.localCenter.y,l=g.col1.x*h+g.col2.x*k,k=g.col1.y*h+g.col2.y*k,h=l;g=d.m_xf.R;var e=this.m_localAnchor2.x-d.m_sweep.localCenter.x,n=this.m_localAnchor2.y-d.m_sweep.localCenter.y,l=g.col1.x*e+g.col2.x*n,n=g.col1.y*e+g.col2.y*n,e=l;g=d.m_sweep.c.x+e;var l=d.m_sweep.c.y+n,m=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,
p=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(c.m_sweep.c.x+h-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),c.m_sweep.c.y+k-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y));this.m_u2.Set(g-m,l-p);g=this.m_u1.Length();l=this.m_u2.Length();g>b.b2_linearSlop?this.m_u1.Multiply(1/g):this.m_u1.SetZero();l>b.b2_linearSlop?this.m_u2.Multiply(1/l):this.m_u2.SetZero();0<this.m_constant-g-this.m_ratio*l?(this.m_state=t.e_inactiveLimit,this.m_impulse=0):this.m_state=t.e_atUpperLimit;
g<this.m_maxLength1?(this.m_limitState1=t.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=t.e_atUpperLimit;l<this.m_maxLength2?(this.m_limitState2=t.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=t.e_atUpperLimit;g=h*this.m_u1.y-k*this.m_u1.x;l=e*this.m_u2.y-n*this.m_u2.x;this.m_limitMass1=c.m_invMass+c.m_invI*g*g;this.m_limitMass2=d.m_invMass+d.m_invI*l*l;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=
1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;a.warmStarting?(this.m_impulse*=a.dtRatio,this.m_limitImpulse1*=a.dtRatio,this.m_limitImpulse2*=a.dtRatio,a=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,g=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,l=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,m=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,c.m_linearVelocity.x+=c.m_invMass*a,c.m_linearVelocity.y+=c.m_invMass*g,c.m_angularVelocity+=c.m_invI*
(h*g-k*a),d.m_linearVelocity.x+=d.m_invMass*l,d.m_linearVelocity.y+=d.m_invMass*m,d.m_angularVelocity+=d.m_invI*(e*m-n*l)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};G.prototype.SolveVelocityConstraints=function(a){a=this.m_bodyA;var b=this.m_bodyB,c;c=a.m_xf.R;var d=this.m_localAnchor1.x-a.m_sweep.localCenter.x,g=this.m_localAnchor1.y-a.m_sweep.localCenter.y,k=c.col1.x*d+c.col2.x*g,g=c.col1.y*d+c.col2.y*g,d=k;c=b.m_xf.R;var l=this.m_localAnchor2.x-b.m_sweep.localCenter.x,e=this.m_localAnchor2.y-
b.m_sweep.localCenter.y,k=c.col1.x*l+c.col2.x*e,e=c.col1.y*l+c.col2.y*e,l=k,n,m;this.m_state==t.e_atUpperLimit&&(c=a.m_linearVelocity.x+-a.m_angularVelocity*g,k=a.m_linearVelocity.y+a.m_angularVelocity*d,n=b.m_linearVelocity.x+-b.m_angularVelocity*e,m=b.m_linearVelocity.y+b.m_angularVelocity*l,c=-(this.m_u1.x*c+this.m_u1.y*k)-this.m_ratio*(this.m_u2.x*n+this.m_u2.y*m),m=this.m_pulleyMass*-c,c=this.m_impulse,this.m_impulse=h.Max(0,this.m_impulse+m),m=this.m_impulse-c,c=-m*this.m_u1.x,k=-m*this.m_u1.y,
n=-this.m_ratio*m*this.m_u2.x,m=-this.m_ratio*m*this.m_u2.y,a.m_linearVelocity.x+=a.m_invMass*c,a.m_linearVelocity.y+=a.m_invMass*k,a.m_angularVelocity+=a.m_invI*(d*k-g*c),b.m_linearVelocity.x+=b.m_invMass*n,b.m_linearVelocity.y+=b.m_invMass*m,b.m_angularVelocity+=b.m_invI*(l*m-e*n));this.m_limitState1==t.e_atUpperLimit&&(c=a.m_linearVelocity.x+-a.m_angularVelocity*g,k=a.m_linearVelocity.y+a.m_angularVelocity*d,c=-(this.m_u1.x*c+this.m_u1.y*k),m=-this.m_limitMass1*c,c=this.m_limitImpulse1,this.m_limitImpulse1=
h.Max(0,this.m_limitImpulse1+m),m=this.m_limitImpulse1-c,c=-m*this.m_u1.x,k=-m*this.m_u1.y,a.m_linearVelocity.x+=a.m_invMass*c,a.m_linearVelocity.y+=a.m_invMass*k,a.m_angularVelocity+=a.m_invI*(d*k-g*c));this.m_limitState2==t.e_atUpperLimit&&(n=b.m_linearVelocity.x+-b.m_angularVelocity*e,m=b.m_linearVelocity.y+b.m_angularVelocity*l,c=-(this.m_u2.x*n+this.m_u2.y*m),m=-this.m_limitMass2*c,c=this.m_limitImpulse2,this.m_limitImpulse2=h.Max(0,this.m_limitImpulse2+m),m=this.m_limitImpulse2-c,n=-m*this.m_u2.x,
m=-m*this.m_u2.y,b.m_linearVelocity.x+=b.m_invMass*n,b.m_linearVelocity.y+=b.m_invMass*m,b.m_angularVelocity+=b.m_invI*(l*m-e*n))};G.prototype.SolvePositionConstraints=function(a){a=this.m_bodyA;var c=this.m_bodyB,d,g=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,k=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,l=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,n=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,e,m,p,w,x,y,A,B=0;this.m_state==t.e_atUpperLimit&&(d=a.m_xf.R,e=this.m_localAnchor1.x-
a.m_sweep.localCenter.x,m=this.m_localAnchor1.y-a.m_sweep.localCenter.y,x=d.col1.x*e+d.col2.x*m,m=d.col1.y*e+d.col2.y*m,e=x,d=c.m_xf.R,p=this.m_localAnchor2.x-c.m_sweep.localCenter.x,w=this.m_localAnchor2.y-c.m_sweep.localCenter.y,x=d.col1.x*p+d.col2.x*w,w=d.col1.y*p+d.col2.y*w,p=x,d=a.m_sweep.c.x+e,x=a.m_sweep.c.y+m,y=c.m_sweep.c.x+p,A=c.m_sweep.c.y+w,this.m_u1.Set(d-g,x-k),this.m_u2.Set(y-l,A-n),d=this.m_u1.Length(),x=this.m_u2.Length(),d>b.b2_linearSlop?this.m_u1.Multiply(1/d):this.m_u1.SetZero(),
x>b.b2_linearSlop?this.m_u2.Multiply(1/x):this.m_u2.SetZero(),d=this.m_constant-d-this.m_ratio*x,B=h.Max(B,-d),d=h.Clamp(d+b.b2_linearSlop,-b.b2_maxLinearCorrection,0),A=-this.m_pulleyMass*d,d=-A*this.m_u1.x,x=-A*this.m_u1.y,y=-this.m_ratio*A*this.m_u2.x,A=-this.m_ratio*A*this.m_u2.y,a.m_sweep.c.x+=a.m_invMass*d,a.m_sweep.c.y+=a.m_invMass*x,a.m_sweep.a+=a.m_invI*(e*x-m*d),c.m_sweep.c.x+=c.m_invMass*y,c.m_sweep.c.y+=c.m_invMass*A,c.m_sweep.a+=c.m_invI*(p*A-w*y),a.SynchronizeTransform(),c.SynchronizeTransform());
this.m_limitState1==t.e_atUpperLimit&&(d=a.m_xf.R,e=this.m_localAnchor1.x-a.m_sweep.localCenter.x,m=this.m_localAnchor1.y-a.m_sweep.localCenter.y,x=d.col1.x*e+d.col2.x*m,m=d.col1.y*e+d.col2.y*m,e=x,d=a.m_sweep.c.x+e,x=a.m_sweep.c.y+m,this.m_u1.Set(d-g,x-k),d=this.m_u1.Length(),d>b.b2_linearSlop?(this.m_u1.x*=1/d,this.m_u1.y*=1/d):this.m_u1.SetZero(),d=this.m_maxLength1-d,B=h.Max(B,-d),d=h.Clamp(d+b.b2_linearSlop,-b.b2_maxLinearCorrection,0),A=-this.m_limitMass1*d,d=-A*this.m_u1.x,x=-A*this.m_u1.y,
a.m_sweep.c.x+=a.m_invMass*d,a.m_sweep.c.y+=a.m_invMass*x,a.m_sweep.a+=a.m_invI*(e*x-m*d),a.SynchronizeTransform());this.m_limitState2==t.e_atUpperLimit&&(d=c.m_xf.R,p=this.m_localAnchor2.x-c.m_sweep.localCenter.x,w=this.m_localAnchor2.y-c.m_sweep.localCenter.y,x=d.col1.x*p+d.col2.x*w,w=d.col1.y*p+d.col2.y*w,p=x,y=c.m_sweep.c.x+p,A=c.m_sweep.c.y+w,this.m_u2.Set(y-l,A-n),x=this.m_u2.Length(),x>b.b2_linearSlop?(this.m_u2.x*=1/x,this.m_u2.y*=1/x):this.m_u2.SetZero(),d=this.m_maxLength2-x,B=h.Max(B,-d),
d=h.Clamp(d+b.b2_linearSlop,-b.b2_maxLinearCorrection,0),A=-this.m_limitMass2*d,y=-A*this.m_u2.x,A=-A*this.m_u2.y,c.m_sweep.c.x+=c.m_invMass*y,c.m_sweep.c.y+=c.m_invMass*A,c.m_sweep.a+=c.m_invI*(p*A-w*y),c.SynchronizeTransform());return B<b.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2});Box2D.inherit(P,Box2D.Dynamics.Joints.b2JointDef);P.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;P.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments);this.groundAnchorA=new d;this.groundAnchorB=new d;this.localAnchorA=new d;this.localAnchorB=new d};P.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=t.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0;this.ratio=1;this.collideConnected=!0};P.prototype.Initialize=function(a,b,c,d,g,h,k){void 0===k&&(k=0);this.bodyA=a;this.bodyB=
b;this.groundAnchorA.SetV(c);this.groundAnchorB.SetV(d);this.localAnchorA=this.bodyA.GetLocalPoint(g);this.localAnchorB=this.bodyB.GetLocalPoint(h);a=g.x-c.x;c=g.y-c.y;this.lengthA=Math.sqrt(a*a+c*c);c=h.x-d.x;d=h.y-d.y;this.lengthB=Math.sqrt(c*c+d*d);this.ratio=k;k=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=k-this.ratio*G.b2_minPulleyLength;this.maxLengthB=(k-G.b2_minPulleyLength)/this.ratio};Box2D.inherit(J,Box2D.Dynamics.Joints.b2Joint);J.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;
J.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new n;this.K1=new n;this.K2=new n;this.K3=new n;this.impulse3=new c;this.impulse2=new d;this.reduced=new d;this.m_localAnchor1=new d;this.m_localAnchor2=new d;this.m_impulse=new c;this.m_mass=new g};J.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};J.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};J.prototype.GetReactionForce=
function(a){void 0===a&&(a=0);return new d(a*this.m_impulse.x,a*this.m_impulse.y)};J.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_impulse.z};J.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};J.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};J.prototype.IsLimitEnabled=function(){return this.m_enableLimit};J.prototype.EnableLimit=function(a){this.m_enableLimit=
a};J.prototype.GetLowerLimit=function(){return this.m_lowerAngle};J.prototype.GetUpperLimit=function(){return this.m_upperAngle};J.prototype.SetLimits=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.m_lowerAngle=a;this.m_upperAngle=b};J.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);return this.m_enableMotor};J.prototype.EnableMotor=function(a){this.m_enableMotor=a};J.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);
this.m_motorSpeed=a};J.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};J.prototype.SetMaxMotorTorque=function(a){void 0===a&&(a=0);this.m_maxMotorTorque=a};J.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};J.prototype.b2RevoluteJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_referenceAngle=a.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=a.lowerAngle;
this.m_upperAngle=a.upperAngle;this.m_maxMotorTorque=a.maxMotorTorque;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=t.e_inactiveLimit};J.prototype.InitVelocityConstraints=function(a){var c=this.m_bodyA,d=this.m_bodyB,g,k;g=c.m_xf.R;var l=this.m_localAnchor1.x-c.m_sweep.localCenter.x,n=this.m_localAnchor1.y-c.m_sweep.localCenter.y;k=g.col1.x*l+g.col2.x*n;n=g.col1.y*l+g.col2.y*n;l=k;g=d.m_xf.R;var e=this.m_localAnchor2.x-d.m_sweep.localCenter.x,
m=this.m_localAnchor2.y-d.m_sweep.localCenter.y;k=g.col1.x*e+g.col2.x*m;m=g.col1.y*e+g.col2.y*m;e=k;g=c.m_invMass;k=d.m_invMass;var p=c.m_invI,x=d.m_invI;this.m_mass.col1.x=g+k+n*n*p+m*m*x;this.m_mass.col2.x=-n*l*p-m*e*x;this.m_mass.col3.x=-n*p-m*x;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=g+k+l*l*p+e*e*x;this.m_mass.col3.y=l*p+e*x;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=p+x;this.m_motorMass=1/(p+x);0==this.m_enableMotor&&(this.m_motorImpulse=
0);if(this.m_enableLimit){var w=d.m_sweep.a-c.m_sweep.a-this.m_referenceAngle;h.Abs(this.m_upperAngle-this.m_lowerAngle)<2*b.b2_angularSlop?this.m_limitState=t.e_equalLimits:w<=this.m_lowerAngle?(this.m_limitState!=t.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=t.e_atLowerLimit):w>=this.m_upperAngle?(this.m_limitState!=t.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=t.e_atUpperLimit):(this.m_limitState=t.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=t.e_inactiveLimit;
a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x,w=this.m_impulse.y,c.m_linearVelocity.x-=g*a,c.m_linearVelocity.y-=g*w,c.m_angularVelocity-=p*(l*w-n*a+this.m_motorImpulse+this.m_impulse.z),d.m_linearVelocity.x+=k*a,d.m_linearVelocity.y+=k*w,d.m_angularVelocity+=x*(e*w-m*a+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};J.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,
c=this.m_bodyB,d,g,k,l,e,n=b.m_linearVelocity,m=b.m_angularVelocity,p=c.m_linearVelocity,x=c.m_angularVelocity,w=b.m_invMass,y=c.m_invMass,A=b.m_invI,B=c.m_invI;this.m_enableMotor&&this.m_limitState!=t.e_equalLimits&&(k=this.m_motorMass*-(x-m-this.m_motorSpeed),l=this.m_motorImpulse,a=a.dt*this.m_maxMotorTorque,this.m_motorImpulse=h.Clamp(this.m_motorImpulse+k,-a,a),k=this.m_motorImpulse-l,m-=A*k,x+=B*k);if(this.m_enableLimit&&this.m_limitState!=t.e_inactiveLimit){d=b.m_xf.R;k=this.m_localAnchor1.x-
b.m_sweep.localCenter.x;l=this.m_localAnchor1.y-b.m_sweep.localCenter.y;g=d.col1.x*k+d.col2.x*l;l=d.col1.y*k+d.col2.y*l;k=g;d=c.m_xf.R;a=this.m_localAnchor2.x-c.m_sweep.localCenter.x;e=this.m_localAnchor2.y-c.m_sweep.localCenter.y;g=d.col1.x*a+d.col2.x*e;e=d.col1.y*a+d.col2.y*e;a=g;g=p.x+-x*e-n.x- -m*l;var C=p.y+x*a-n.y-m*k;this.m_mass.Solve33(this.impulse3,-g,-C,-(x-m));this.m_limitState==t.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==t.e_atLowerLimit?(d=this.m_impulse.z+this.impulse3.z,
0>d&&(this.m_mass.Solve22(this.reduced,-g,-C),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==t.e_atUpperLimit&&(d=this.m_impulse.z+this.impulse3.z,0<d&&(this.m_mass.Solve22(this.reduced,-g,-C),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,
this.m_impulse.z=0));n.x-=w*this.impulse3.x;n.y-=w*this.impulse3.y;m-=A*(k*this.impulse3.y-l*this.impulse3.x+this.impulse3.z);p.x+=y*this.impulse3.x;p.y+=y*this.impulse3.y;x+=B*(a*this.impulse3.y-e*this.impulse3.x+this.impulse3.z)}else d=b.m_xf.R,k=this.m_localAnchor1.x-b.m_sweep.localCenter.x,l=this.m_localAnchor1.y-b.m_sweep.localCenter.y,g=d.col1.x*k+d.col2.x*l,l=d.col1.y*k+d.col2.y*l,k=g,d=c.m_xf.R,a=this.m_localAnchor2.x-c.m_sweep.localCenter.x,e=this.m_localAnchor2.y-c.m_sweep.localCenter.y,
g=d.col1.x*a+d.col2.x*e,e=d.col1.y*a+d.col2.y*e,a=g,this.m_mass.Solve22(this.impulse2,-(p.x+-x*e-n.x- -m*l),-(p.y+x*a-n.y-m*k)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,n.x-=w*this.impulse2.x,n.y-=w*this.impulse2.y,m-=A*(k*this.impulse2.y-l*this.impulse2.x),p.x+=y*this.impulse2.x,p.y+=y*this.impulse2.y,x+=B*(a*this.impulse2.y-e*this.impulse2.x);b.m_linearVelocity.SetV(n);b.m_angularVelocity=m;c.m_linearVelocity.SetV(p);c.m_angularVelocity=x};J.prototype.SolvePositionConstraints=
function(a){var c,d;a=this.m_bodyA;var g=this.m_bodyB,k=0,l,n,e;if(this.m_enableLimit&&this.m_limitState!=t.e_inactiveLimit){c=g.m_sweep.a-a.m_sweep.a-this.m_referenceAngle;var m=0;this.m_limitState==t.e_equalLimits?(c=h.Clamp(c-this.m_lowerAngle,-b.b2_maxAngularCorrection,b.b2_maxAngularCorrection),m=-this.m_motorMass*c,k=h.Abs(c)):this.m_limitState==t.e_atLowerLimit?(c-=this.m_lowerAngle,k=-c,c=h.Clamp(c+b.b2_angularSlop,-b.b2_maxAngularCorrection,0),m=-this.m_motorMass*c):this.m_limitState==t.e_atUpperLimit&&
(k=c-=this.m_upperAngle,c=h.Clamp(c-b.b2_angularSlop,0,b.b2_maxAngularCorrection),m=-this.m_motorMass*c);a.m_sweep.a-=a.m_invI*m;g.m_sweep.a+=g.m_invI*m;a.SynchronizeTransform();g.SynchronizeTransform()}d=a.m_xf.R;m=this.m_localAnchor1.x-a.m_sweep.localCenter.x;c=this.m_localAnchor1.y-a.m_sweep.localCenter.y;l=d.col1.x*m+d.col2.x*c;c=d.col1.y*m+d.col2.y*c;m=l;d=g.m_xf.R;var p=this.m_localAnchor2.x-g.m_sweep.localCenter.x,x=this.m_localAnchor2.y-g.m_sweep.localCenter.y;l=d.col1.x*p+d.col2.x*x;x=d.col1.y*
p+d.col2.y*x;p=l;n=g.m_sweep.c.x+p-a.m_sweep.c.x-m;e=g.m_sweep.c.y+x-a.m_sweep.c.y-c;var w=n*n+e*e;d=Math.sqrt(w);l=a.m_invMass;var y=g.m_invMass,A=a.m_invI,B=g.m_invI,C=10*b.b2_linearSlop;w>C*C&&(w=1/(l+y),n=w*-n,e=w*-e,a.m_sweep.c.x-=.5*l*n,a.m_sweep.c.y-=.5*l*e,g.m_sweep.c.x+=.5*y*n,g.m_sweep.c.y+=.5*y*e,n=g.m_sweep.c.x+p-a.m_sweep.c.x-m,e=g.m_sweep.c.y+x-a.m_sweep.c.y-c);this.K1.col1.x=l+y;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=l+y;this.K2.col1.x=A*c*c;this.K2.col2.x=-A*m*c;this.K2.col1.y=
-A*m*c;this.K2.col2.y=A*m*m;this.K3.col1.x=B*x*x;this.K3.col2.x=-B*p*x;this.K3.col1.y=-B*p*x;this.K3.col2.y=B*p*p;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(J.tImpulse,-n,-e);n=J.tImpulse.x;e=J.tImpulse.y;a.m_sweep.c.x-=a.m_invMass*n;a.m_sweep.c.y-=a.m_invMass*e;a.m_sweep.a-=a.m_invI*(m*e-c*n);g.m_sweep.c.x+=g.m_invMass*n;g.m_sweep.c.y+=g.m_invMass*e;g.m_sweep.a+=g.m_invI*(p*e-x*n);a.SynchronizeTransform();g.SynchronizeTransform();return d<=b.b2_linearSlop&&k<=b.b2_angularSlop};
Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new d});Box2D.inherit(D,Box2D.Dynamics.Joints.b2JointDef);D.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;D.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new d;this.localAnchorB=new d};D.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=t.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,
0);this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=!1};D.prototype.Initialize=function(a,b,c){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(c);this.localAnchorB=this.bodyB.GetLocalPoint(c);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(O,Box2D.Dynamics.Joints.b2Joint);O.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;O.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,
arguments);this.m_localAnchorA=new d;this.m_localAnchorB=new d;this.m_impulse=new c;this.m_mass=new g};O.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};O.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};O.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new d(a*this.m_impulse.x,a*this.m_impulse.y)};O.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_impulse.z};O.prototype.b2WeldJoint=
function(a){this.__super.b2Joint.call(this,a);this.m_localAnchorA.SetV(a.localAnchorA);this.m_localAnchorB.SetV(a.localAnchorB);this.m_referenceAngle=a.referenceAngle;this.m_impulse.SetZero();this.m_mass=new g};O.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_bodyA,g=this.m_bodyB;b=d.m_xf.R;var k=this.m_localAnchorA.x-d.m_sweep.localCenter.x,h=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*k+b.col2.x*h;h=b.col1.y*k+b.col2.y*h;k=c;b=g.m_xf.R;var e=this.m_localAnchorB.x-g.m_sweep.localCenter.x,
l=this.m_localAnchorB.y-g.m_sweep.localCenter.y;c=b.col1.x*e+b.col2.x*l;l=b.col1.y*e+b.col2.y*l;e=c;b=d.m_invMass;c=g.m_invMass;var n=d.m_invI,m=g.m_invI;this.m_mass.col1.x=b+c+h*h*n+l*l*m;this.m_mass.col2.x=-h*k*n-l*e*m;this.m_mass.col3.x=-h*n-l*m;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=b+c+k*k*n+e*e*m;this.m_mass.col3.y=k*n+e*m;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=n+m;a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=
a.dtRatio,this.m_impulse.z*=a.dtRatio,d.m_linearVelocity.x-=b*this.m_impulse.x,d.m_linearVelocity.y-=b*this.m_impulse.y,d.m_angularVelocity-=n*(k*this.m_impulse.y-h*this.m_impulse.x+this.m_impulse.z),g.m_linearVelocity.x+=c*this.m_impulse.x,g.m_linearVelocity.y+=c*this.m_impulse.y,g.m_angularVelocity+=m*(e*this.m_impulse.y-l*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()};O.prototype.SolveVelocityConstraints=function(a){var b,d;a=this.m_bodyA;var g=this.m_bodyB,k=a.m_linearVelocity,
h=a.m_angularVelocity,l=g.m_linearVelocity,e=g.m_angularVelocity,n=a.m_invMass,m=g.m_invMass,p=a.m_invI,t=g.m_invI;b=a.m_xf.R;var x=this.m_localAnchorA.x-a.m_sweep.localCenter.x,w=this.m_localAnchorA.y-a.m_sweep.localCenter.y;d=b.col1.x*x+b.col2.x*w;w=b.col1.y*x+b.col2.y*w;x=d;b=g.m_xf.R;var y=this.m_localAnchorB.x-g.m_sweep.localCenter.x,A=this.m_localAnchorB.y-g.m_sweep.localCenter.y;d=b.col1.x*y+b.col2.x*A;A=b.col1.y*y+b.col2.y*A;y=d;b=l.x-e*A-k.x+h*w;d=l.y+e*y-k.y-h*x;var B=e-h,C=new c;this.m_mass.Solve33(C,
-b,-d,-B);this.m_impulse.Add(C);k.x-=n*C.x;k.y-=n*C.y;h-=p*(x*C.y-w*C.x+C.z);l.x+=m*C.x;l.y+=m*C.y;e+=t*(y*C.y-A*C.x+C.z);a.m_angularVelocity=h;g.m_angularVelocity=e};O.prototype.SolvePositionConstraints=function(a){var d,g;a=this.m_bodyA;var k=this.m_bodyB;d=a.m_xf.R;var l=this.m_localAnchorA.x-a.m_sweep.localCenter.x,n=this.m_localAnchorA.y-a.m_sweep.localCenter.y;g=d.col1.x*l+d.col2.x*n;n=d.col1.y*l+d.col2.y*n;l=g;d=k.m_xf.R;var m=this.m_localAnchorB.x-k.m_sweep.localCenter.x,e=this.m_localAnchorB.y-
k.m_sweep.localCenter.y;g=d.col1.x*m+d.col2.x*e;e=d.col1.y*m+d.col2.y*e;m=g;d=a.m_invMass;g=k.m_invMass;var p=a.m_invI,t=k.m_invI,x=k.m_sweep.c.x+m-a.m_sweep.c.x-l,w=k.m_sweep.c.y+e-a.m_sweep.c.y-n,y=k.m_sweep.a-a.m_sweep.a-this.m_referenceAngle,A=10*b.b2_linearSlop,B=Math.sqrt(x*x+w*w),C=h.Abs(y);B>A&&(p*=1,t*=1);this.m_mass.col1.x=d+g+n*n*p+e*e*t;this.m_mass.col2.x=-n*l*p-e*m*t;this.m_mass.col3.x=-n*p-e*t;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=d+g+l*l*p+m*m*t;this.m_mass.col3.y=
l*p+m*t;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=p+t;A=new c;this.m_mass.Solve33(A,-x,-w,-y);a.m_sweep.c.x-=d*A.x;a.m_sweep.c.y-=d*A.y;a.m_sweep.a-=p*(l*A.y-n*A.x+A.z);k.m_sweep.c.x+=g*A.x;k.m_sweep.c.y+=g*A.y;k.m_sweep.a+=t*(m*A.y-e*A.x+A.z);a.SynchronizeTransform();k.SynchronizeTransform();return B<=b.b2_linearSlop&&C<=b.b2_angularSlop};Box2D.inherit(M,Box2D.Dynamics.Joints.b2JointDef);M.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;
M.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new d;this.localAnchorB=new d};M.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=t.e_weldJoint;this.referenceAngle=0};M.prototype.Initialize=function(a,b,c){this.bodyA=a;this.bodyB=b;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();
(function(){var b=Box2D.Dynamics.b2DebugDraw;b.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;var b=this;this.m_sprite={graphics:{clear:function(){b.m_ctx.clearRect(0,0,b.m_ctx.canvas.width,b.m_ctx.canvas.height)}}}};b.prototype._color=function(b,g){return"rgba("+((b&16711680)>>16)+","+((b&65280)>>8)+","+(b&255)+","+g+")"};b.prototype.b2DebugDraw=function(){this.m_drawFlags=0};b.prototype.SetFlags=function(b){void 0===b&&(b=0);this.m_drawFlags=
b};b.prototype.GetFlags=function(){return this.m_drawFlags};b.prototype.AppendFlags=function(b){void 0===b&&(b=0);this.m_drawFlags|=b};b.prototype.ClearFlags=function(b){void 0===b&&(b=0);this.m_drawFlags&=~b};b.prototype.SetSprite=function(b){this.m_ctx=b};b.prototype.GetSprite=function(){return this.m_ctx};b.prototype.SetDrawScale=function(b){void 0===b&&(b=0);this.m_drawScale=b};b.prototype.GetDrawScale=function(){return this.m_drawScale};b.prototype.SetLineThickness=function(b){void 0===b&&(b=
0);this.m_lineThickness=b;this.m_ctx.strokeWidth=b};b.prototype.GetLineThickness=function(){return this.m_lineThickness};b.prototype.SetAlpha=function(b){void 0===b&&(b=0);this.m_alpha=b};b.prototype.GetAlpha=function(){return this.m_alpha};b.prototype.SetFillAlpha=function(b){void 0===b&&(b=0);this.m_fillAlpha=b};b.prototype.GetFillAlpha=function(){return this.m_fillAlpha};b.prototype.SetXFormScale=function(b){void 0===b&&(b=0);this.m_xformScale=b};b.prototype.GetXFormScale=function(){return this.m_xformScale};
b.prototype.DrawPolygon=function(b,g,h){if(g){var d=this.m_ctx,c=this.m_drawScale;d.beginPath();d.strokeStyle=this._color(h.color,this.m_alpha);d.moveTo(b[0].x*c,b[0].y*c);for(h=1;h<g;h++)d.lineTo(b[h].x*c,b[h].y*c);d.lineTo(b[0].x*c,b[0].y*c);d.closePath();d.stroke()}};b.prototype.DrawSolidPolygon=function(b,g,h){if(g){var d=this.m_ctx,c=this.m_drawScale;d.beginPath();d.strokeStyle=this._color(h.color,this.m_alpha);d.fillStyle=this._color(h.color,this.m_fillAlpha);d.moveTo(b[0].x*c,b[0].y*c);for(h=
1;h<g;h++)d.lineTo(b[h].x*c,b[h].y*c);d.lineTo(b[0].x*c,b[0].y*c);d.closePath();d.fill();d.stroke()}};b.prototype.DrawCircle=function(b,g,h){if(g){var d=this.m_ctx,c=this.m_drawScale;d.beginPath();d.strokeStyle=this._color(h.color,this.m_alpha);d.arc(b.x*c,b.y*c,g*c,0,2*Math.PI,!0);d.closePath();d.stroke()}};b.prototype.DrawSolidCircle=function(b,g,h,d){if(g){var c=this.m_ctx,m=this.m_drawScale,a=b.x*m,l=b.y*m;c.moveTo(0,0);c.beginPath();c.strokeStyle=this._color(d.color,this.m_alpha);c.fillStyle=
this._color(d.color,this.m_fillAlpha);c.arc(a,l,g*m,0,2*Math.PI,!0);c.moveTo(a,l);c.lineTo((b.x+h.x*g)*m,(b.y+h.y*g)*m);c.closePath();c.fill();c.stroke()}};b.prototype.DrawSegment=function(b,g,h){var d=this.m_ctx,c=this.m_drawScale;d.strokeStyle=this._color(h.color,this.m_alpha);d.beginPath();d.moveTo(b.x*c,b.y*c);d.lineTo(g.x*c,g.y*c);d.closePath();d.stroke()};b.prototype.DrawTransform=function(b){var g=this.m_ctx,h=this.m_drawScale;g.beginPath();g.strokeStyle=this._color(16711680,this.m_alpha);
g.moveTo(b.position.x*h,b.position.y*h);g.lineTo((b.position.x+this.m_xformScale*b.R.col1.x)*h,(b.position.y+this.m_xformScale*b.R.col1.y)*h);g.strokeStyle=this._color(65280,this.m_alpha);g.moveTo(b.position.x*h,b.position.y*h);g.lineTo((b.position.x+this.m_xformScale*b.R.col2.x)*h,(b.position.y+this.m_xformScale*b.R.col2.y)*h);g.closePath();g.stroke()}})();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs;
function CAnemone(b,n,g,h){var d,c,m=!1;this._init=function(a,b){var g=s_oSpriteLibrary.getSprite("anemone_back"),m=s_oSpriteLibrary.getSprite("anemone_front");d=createBitmap(g);d.regX=.5*g.width;d.regY=g.height;d.x=a;d.y=b+.5*g.height;h.addChild(d);c=createBitmap(m);c.regX=.5*m.width;c.regY=m.height;c.x=a-1;c.y=b+8+.5*m.height;h.addChild(c)};this.unload=function(){h.removeChild(d)};this.setVisible=function(a){d.visible=a;c.visible=a};this.getX=function(){return d.x};this.getY=function(){return d.y};
this.getPhysics=function(){return g};this.getChildIndexFront=function(){return h.getChildIndex(c)};this.childIndexFront=function(a){h.setChildIndex(c,a)};this.animAnemone=function(){m&&(createjs.Tween.removeTweens(d),createjs.Tween.removeTweens(c),m=!1);m=!0;createjs.Tween.get(d).to({scaleY:1.1},800,createjs.Ease.elasticOut);createjs.Tween.get(c).to({scaleY:1.1},800,createjs.Ease.elasticOut).call(function(){createjs.Tween.get(d).to({scaleY:1},500,createjs.Ease.cubicOut);createjs.Tween.get(c).to({scaleY:1},
500,createjs.Ease.cubicOut);m=!1})};this._init(b,n);return this}
function CCrabs(b,n,g,h,d){var c,m=0,a=0;this._init=function(a,b,g){var h=new createjs.SpriteSheet({images:[g],frames:{width:g.width/2,height:g.height/2,regX:g.width/2/2+CRABS_REG_OFFSET.x,regY:g.height/2/2+CRABS_REG_OFFSET.y}});c=createSprite(h,0,g.width/2/2+CRABS_REG_OFFSET.x,g.height/2/2+CRABS_REG_OFFSET.y,g.width/2,g.height/2);c.x=a;c.y=b;c.stop();d.addChild(c)};this.unload=function(){d.removeChild(c)};this.setVisible=function(a){c.visible=a};this.setPosition=function(a,b){c.x=a;c.y=b;this.move()};
this.moveAnimation=function(b){4.5<b?this._goToNextFrame():1.5<b?(a++,3<a&&(this._goToNextFrame(),a=0)):2<b?(a++,3<a&&(this._goToNextFrame(),a=0)):1<b&&(a++,4<a&&(this._goToNextFrame(),a=0))};this._goToNextFrame=function(){4===m?m=0:m++;c.gotoAndStop(m)};this.setAngle=function(a){c.rotation=a};this.getX=function(){return c.x};this.getY=function(){return c.y};this.scale=function(a){c.scaleX=a;c.scaleY=a};this.getScale=function(){return c.scaleX};this.getPhysics=function(){return h};this.childIndex=
function(a){d.setChildIndex(c,a)};this.getChildIndex=function(){return d.getChildIndex(c)};this.move=function(){s_oPhysicsController.moveObject(h,c.x,c.y)};this._init(b,n,g);return this}
function CFish(b,n,g,h,d,c,m){var a,l,p,x=null,y,w,t,E=!0,C=!1;this._init=function(b,d,g,h,n){y=new createjs.Container;y.x=b;y.y=d;p=createBitmap(g);p.x=0;p.y=0;p.regX=.5*g.width;p.regY=.5*g.height;y.addChild(p);w=h;t=n;a=b;l=d;s_oPhysicsController.activeBody(c,!1);TEST&&(b=new createjs.Text(n,"36px "+FONT_GAME,"#000"),b.x=0,b.y=0,b.textAlign="center",b.textBaseline="middle",y.addChild(b));m.addChild(y)};this.unload=function(){m.removeChild(y)};this.setVisible=function(a){y.visible=a};this.setPosition=
function(a,b){y.x=a;y.y=b;s_oPhysicsController.setElementPosition(c,{x:a,y:b})};this.resetPos=function(){this.setPosition(a,l)};this.setAngle=function(a){p.rotation=a};this.getID=function(){return t};this.getType=function(){return w};this.isCached=function(){return E};this.setCache=function(a){E=a;this.activeBody(!a);y.visible=!a;this.setAngle(0)};this.getTouchCrabs=function(){return C};this.setTouchCrabs=function(a){C=a};this.activeBody=function(a){s_oPhysicsController.activeBody(c,a)};this.getX=
function(){return y.x};this.getY=function(){return y.y};this.scale=function(a){p.scaleX=a;p.scaleY=a};this.getScale=function(){return p.scaleX};this.getPhysics=function(){return c};this.setChildIndex=function(a){m.setChildIndex(y,a)};this.move=function(){var a=s_oPhysicsController.getElementPosition(c);y.x=a.x;y.y=a.y;p.rotation=s_oPhysicsController.getElementAngle(c)};this.spriteFollowPhysics=function(a){E=!a};this.setAlpha=function(a){p.alpha=a};this.isAnim=function(){return x};this.animInAnemone=
function(){null===x&&(x=createjs.Tween.get(y).to({x:FISH_IN_ANEMONE_ANIM_POS.x,y:FISH_IN_ANEMONE_ANIM_POS.y},400,createjs.Ease.cubicOut).call(function(){s_oGame.cachedFish(t);C=!1;x=null}))};this.animOnFloor=function(){null===x&&(x=createjs.Tween.get(p).to({alpha:0},500,createjs.Ease.cubicIn).call(function(){s_oGame.cachedFish(t);C=!1;x=null}))};this.update=function(){this.move()};this._init(b,n,g,h,d);return this}
function CScoreBoard(b,n,g,h,d,c){var m,a,l,p;this._init=function(b,c,d,g,h,n){m={x:c,y:d};a=new createjs.Container;a.x=m.x;a.y=m.y;l=createBitmap(b);l.x=0;l.y=0;l.regX=.5*b.width;l.regY=.5*b.height;a.addChild(l);p=new createjs.Text(h,"28px "+FONT_GAME,TEXT_COLOR);b=0;"left"===g&&(b=-p.getBounds().width+10);p.x=b+n;p.y=1;p.textAlign=g;p.textBaseline="middle";a.addChild(p);s_oStage.addChild(a)};this.getStartPosition=function(){return m};this.setPosition=function(b,c){a.x=b;a.y=c};this.unload=function(){s_oStage.removeChild(a)};
this.refresh=function(a){p.text=a};this._init(b,n,g,h,d,c);return this}
function CConfirmPanel(b){var n=this,g=[],h=[],d=[],c,m,a=CANVAS_WIDTH/2,l=CANVAS_HEIGHT/2+50,p,x,y,w;this._init=function(){var d=s_oSpriteLibrary.getSprite("msg_box");m=new createjs.Container;m.x=a;m.y=CANVAS_HEIGHT+.5*d.width;x=new createjs.Shape;x.graphics.beginFill("#000000").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);x.alpha=0;x.on("mousedown",this._onClick);s_oStage.addChild(x);c=createBitmap(d);c.regX=d.width/2;c.regY=d.height/2;m.addChild(c);p=new createjs.Text(b,"bold 35px "+FONT_GAME,TEXT_COLOR);
p.x=0;p.y=-85;p.textAlign="center";p.textBaseline="alphabetic";p.lineWidth=520;p.lineHeight=42;m.addChild(p);y=new CGfxButton(-180,70,s_oSpriteLibrary.getSprite("but_no"),m);y.pulseAnimation();w=new CGfxButton(180,70,s_oSpriteLibrary.getSprite("but_yes"),m);s_oStage.addChild(m);this.show()};this._initListener=function(){y.addEventListener(ON_MOUSE_DOWN,this.buttonNoDown,this);w.addEventListener(ON_MOUSE_DOWN,this.buttonYesDown,this)};this.addEventListener=function(a,b,c){g[a]=b;h[a]=c};this.buttonNoDown=
function(){playSound("click",1,0);g[ON_BUT_NO_DOWN]&&g[ON_BUT_NO_DOWN].call(h[ON_BUT_NO_DOWN],d)};this.buttonYesDown=function(){playSound("click",1,0);g[ON_BUT_YES_DOWN]&&g[ON_BUT_YES_DOWN].call(h[ON_BUT_YES_DOWN],d)};this._onClick=function(){};this.show=function(){createjs.Tween.get(x).to({alpha:.9},500,createjs.Ease.quadOut);createjs.Tween.get(m).to({y:l},500,createjs.Ease.quadOut).call(function(){n._initListener()})};this.unload=function(){createjs.Tween.get(m).to({y:1.5*CANVAS_HEIGHT},500).call(function(){s_oStage.removeChild(m)});
createjs.Tween.get(x).to({alpha:0},500,createjs.Ease.quadIn).call(function(){s_oStage.removeChild(x)})};this._init();s_oVariousHelp=this;return this}var s_oVariousHelp=null;
function CLifeBoard(b,n,g){var h,d,c,m,a;this._init=function(b,g,n){h={x:g,y:n};d=new createjs.Container;d.x=h.x;d.y=h.y;m=createBitmap(b);m.x=0;m.y=0;m.regX=.5*b.width;m.regY=.5*b.height;d.addChild(m);a=new createjs.Text("x0","28px "+FONT_GAME,TEXT_COLOR);a.x=15;a.y=1;a.textAlign="center";a.textBaseline="middle";d.addChild(a);b=s_oSpriteLibrary.getSprite("heart");c=createBitmap(b);c.x=-b.width+10;c.y=0;c.regX=.5*b.width;c.regY=.5*b.height;d.addChild(c);s_oStage.addChild(d)};this.getStartPosition=
function(){return h};this.setPosition=function(a,b){d.x=a;d.y=b};this.unload=function(){s_oStage.removeChild(d)};this.heartAnimation=function(){createjs.Tween.get(c).to({scaleX:.8,scaleY:.8},250,createjs.Ease.cubicOut).call(function(){createjs.Tween.get(c).to({scaleX:1,scaleY:1},250,createjs.Ease.cubicOut)})};this.refresh=function(b,c){a.text=b;c&&this.heartAnimation()};this._init(b,n,g);return this}
function CCreditsPanel(){var b,n,g,h,d,c,m,a;this._init=function(){a=new createjs.Container;s_oStage.addChild(a);var l=s_oSpriteLibrary.getSprite("msg_box");c=new createjs.Shape;c.graphics.beginFill("#000").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);c.alpha=.5;c.on("click",this._onLogoButRelease);c.cursor="pointer";a.addChild(c);n=createBitmap(l);n.x=CANVAS_WIDTH_HALF;n.y=CANVAS_HEIGHT_HALF;n.regX=.5*l.width;n.regY=.5*l.height;a.addChild(n);l=s_oSpriteLibrary.getSprite("but_exit");b=.5*CANVAS_WIDTH+
230;h=new CGfxButton(b,410,l,a);h.addEventListener(ON_MOUSE_UP,this.unload,this);d=new createjs.Text(TEXT_CREDITS_DEVELOPED,"32px "+FONT_GAME,TEXT_COLOR);d.textAlign="center";d.textBaseline="alphabetic";d.x=CANVAS_WIDTH/2;d.y=460;a.addChild(d);l=s_oSpriteLibrary.getSprite("logo_ctl");g=createBitmap(l);g.regX=l.width/2;g.regY=l.height/2;g.x=CANVAS_WIDTH/2;g.y=520;a.addChild(g);m=new createjs.Text(TEXT_LINK1,"42px "+FONT_GAME,TEXT_COLOR_1);m.textAlign="center";m.textBaseline="alphabetic";m.x=CANVAS_WIDTH/
2;m.y=610;a.addChild(m)};this.unload=function(){c.off("click",this._onLogoButRelease);h.unload();h=null;s_oStage.removeChild(a)};this._onLogoButRelease=function(){window.open("http://www.codethislab.com/index.php?&l=en","_blank")};this._init()}
function CPause(){var b,n;this._init=function(){var g=new createjs.Container;g.alpha=0;b=new createjs.Shape;b.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);b.alpha=.5;var h=new createjs.Shape;h.graphics.beginFill("#0f0f0f").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);b.hitArea=h;b.on("click",function(){});g.addChild(b);var h=s_oSpriteLibrary.getSprite("msg_box"),d=createBitmap(h);d.x=CANVAS_WIDTH_HALF;d.y=CANVAS_HEIGHT_HALF;d.regX=.5*h.width;d.regY=.5*h.height;g.addChild(d);h=
new createjs.Text(TEXT_PAUSE,"80px "+FONT_GAME,TEXT_COLOR);h.x=.5*CANVAS_WIDTH;h.y=.5*CANVAS_HEIGHT-130;h.textAlign="center";g.addChild(h);h=s_oSpriteLibrary.getSprite("but_continue_big");n=new CGfxButton(.5*CANVAS_WIDTH,.5*CANVAS_HEIGHT+70,h,g);n.addEventListenerWithParams(ON_MOUSE_UP,this._onLeavePause,this,g);n.setScale(.6);n.pulseAnimation();s_oStage.addChild(g);createjs.Tween.get(g).to({alpha:1},300,createjs.quartOut)};this.unload=function(){b.removeAllEventListeners();n.unload();n=null;s_oStage.removeChild(void 0)};
this._onLeavePause=function(b){createjs.Tween.get(b).to({alpha:0},300,createjs.quartIn).call(function(){s_oInterface.unloadPause();s_oGame.unpause(!0)})};this._init();return this}
function CAreYouSurePanel(b){var n,g,h,d,c,m,a;this._init=function(){c=new createjs.Container;c.alpha=0;m.addChild(c);a=new createjs.Shape;a.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a.alpha=.5;a.on("click",function(){});c.addChild(a);var b=s_oSpriteLibrary.getSprite("msg_box");n=createBitmap(b);n.x=CANVAS_WIDTH_HALF;n.y=CANVAS_HEIGHT_HALF+50;n.regX=.5*b.width;n.regY=.5*b.height;c.addChild(n);g=new createjs.Text(TEXT_ARE_SURE,"bold 60px "+FONT_GAME,TEXT_COLOR);g.x=CANVAS_WIDTH/
2;g.y=CANVAS_HEIGHT_HALF-40;g.textAlign="center";g.textBaseline="middle";c.addChild(g);h=new CGfxButton(CANVAS_WIDTH/2+180,.5*CANVAS_HEIGHT+120,s_oSpriteLibrary.getSprite("but_yes"),c);h.addEventListener(ON_MOUSE_UP,this._onButYes,this);d=new CGfxButton(CANVAS_WIDTH/2-180,.5*CANVAS_HEIGHT+120,s_oSpriteLibrary.getSprite("but_no"),c);d.addEventListener(ON_MOUSE_UP,this._onButNo,this)};this.show=function(){s_oGame.unpause(!1);createjs.Tween.get(c).to({alpha:1},150,createjs.quartOut).call(function(){})};
this.unload=function(){createjs.Tween.get(c).to({alpha:0},150,createjs.quartOut).call(function(){m.removeChild(c,a)})};this._onButYes=function(){this.unload();s_oGame.onExit();a.removeAllEventListeners()};this._onButNo=function(){s_oGame.unpause(!0);this.unload();a.removeAllEventListeners()};m=b;this._init()}var NUM_ROWS_PAGE_LEVEL=4,NUM_COLS_PAGE_LEVEL=5;
function CLevelMenu(b){var n,g,h,d,c,m,a,l,p,x,y,w,t,E,C,k,A,B=null,F=null,H,K,G;this._init=function(){y=0;K=new createjs.Container;s_oStage.addChild(K);var t=createBitmap(s_oSpriteLibrary.getSprite("bg_game"));K.addChild(t);p=CANVAS_WIDTH/2;x=CANVAS_HEIGHT_HALF-255;H=new createjs.Text(TEXT_SELECT_A_LEVEL,"60px "+FONT_GAME,TEXT_COLOR);H.x=p;H.y=x;H.textAlign="center";s_oStage.addChild(H);t=s_oSpriteLibrary.getSprite("but_exit");a=CANVAS_WIDTH-t.height/2-15;l=t.height/2+15;k=new CGfxButton(a,l,t,s_oStage);
k.addEventListener(ON_MOUSE_UP,this._onExit,this);w=t.height;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)c=k.getX()-t.width-15,m=t.height/2+15,A=new CToggle(c,m,s_oSpriteLibrary.getSprite("audio_icon"),s_bAudioActive,s_oStage),A.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);this._checkBoundLimits();E=[];for(var t=Math.floor((CANVAS_WIDTH+EDGEBOARD_X)/NUM_COLS_PAGE_LEVEL)/2,J=.5*-EDGEBOARD_X,D=0;D<NUM_COLS_PAGE_LEVEL;D++)E.push(J),J+=t;C=[];this._createNewLevelPage(0,b);if(1<C.length){for(t=
1;t<C.length;t++)C[t].visible=!1;h=CANVAS_WIDTH-80;d=CANVAS_HEIGHT-80;B=new CGfxButton(h,d,s_oSpriteLibrary.getSprite("arrow_right"),s_oStage);B.addEventListener(ON_MOUSE_UP,this._onRight,this);n=80;g=CANVAS_HEIGHT-80;F=new CGfxButton(n,g,s_oSpriteLibrary.getSprite("arrow_left"),s_oStage);F.addEventListener(ON_MOUSE_UP,this._onLeft,this)}G=new createjs.Shape;G.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(G);createjs.Tween.get(G).to({alpha:0},1E3).call(function(){s_oStage.removeChild(G);
G=null});this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){for(var a=0;a<t.length;a++)t[a].unload();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)A.unload(),A=null;k.unload();k=null;null!==F&&(F.unload(),B.unload());s_oLevelMenu=null;s_oStage.removeAllChildren()};this.refreshButtonPos=function(b,p){k.setPosition(a-b,l+p);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||A.setPosition(c-b,p+m);null!==F&&(B.setPosition(h-b,d-p),F.setPosition(n+b,g-p))};this._checkBoundLimits=function(){for(var a=
s_oSpriteLibrary.getSprite("but_level"),b=0,c=CANVAS_HEIGHT-2*EDGEBOARD_Y-2*w,d=0;b<c;)b+=a.height+20,d++;NUM_ROWS_PAGE_LEVEL>d&&(NUM_ROWS_PAGE_LEVEL=d);c=b=0;d=CANVAS_WIDTH-2*EDGEBOARD_X;for(a=s_oSpriteLibrary.getSprite("but_level");c<d;)c+=a.width/2+5,b++;NUM_COLS_PAGE_LEVEL>b&&(NUM_COLS_PAGE_LEVEL=b)};this._createNewLevelPage=function(a,b){var c=new createjs.Container;K.addChild(c);C.push(c);t=[];for(var d=0,g=-190,f=1,h=!1,k=s_oSpriteLibrary.getSprite("but_level"),l=a;l<b;l++){var m=new CLevelBut(E[d]+
k.width/2,g+k.height/2,l+1,k,l+1>s_iLastLevel?!1:!0,c);m.addEventListenerWithParams(ON_MOUSE_UP,this._onButLevelRelease,this,l);t.push(m);d++;if(d===E.length&&(d=0,g+=k.height+20,f++,f>NUM_ROWS_PAGE_LEVEL&&l<b-1)){h=!0;break}}c.x=CANVAS_WIDTH/2;c.y=520;c.regX=c.getBounds().width/2;h&&this._createNewLevelPage(l+1,b)};this._onRight=function(){C[y].visible=!1;y++;y>=C.length&&(y=0);C[y].visible=!0};this._onLeft=function(){C[y].visible=!1;y--;0>y&&(y=C.length-1);C[y].visible=!0};this._onButLevelRelease=
function(a){playSound("click",1,0);this.unload();s_oMain.gotoGame(a)};this._onAudioToggle=function(){createjs.Sound.setMute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){this.unload();s_oMain.gotoMenu()};s_oLevelMenu=this;this._init()}var s_oLevelMenu=null;
function CLevelBut(b,n,g,h,d,c){var m,a,l,p=[],x=[],y,w,t,E,C,k;this._init=function(b,c,d,g,h){a=[];l=[];t=new createjs.Container;E.addChild(t);var k=new createjs.SpriteSheet({images:[g],frames:{width:g.width/2,height:g.height,regX:g.width/2/2,regY:g.height/2},animations:{state_true:[0],state_false:[1]}});m=h;w=createSprite(k,"state_"+m,g.width/2/2,g.height/2,g.width/2,g.height);w.mouseEnabled=h;w.x=b;w.y=c;w.stop();s_bMobile||(t.cursor="pointer");t.addChild(w);p.push(w);y=new createjs.Text(d,"50px "+
FONT_GAME,TEXT_COLOR);y.x=b;y.y=c+23;y.textAlign="center";y.textBaseline="alphabetic";y.lineWidth=200;t.addChild(y);h||(y.color="#888888");this._initListener()};this.unload=function(){t.off("mousedown",C);t.off("pressup",k);t.removeChild(w)};this._initListener=function(){C=t.on("mousedown",this.buttonDown);k=t.on("pressup",this.buttonRelease)};this.viewBut=function(a){t.addChild(a)};this.addEventListener=function(b,c,d){a[b]=c;l[b]=d};this.addEventListenerWithParams=function(b,c,d,g){a[b]=c;l[b]=
d;x=g};this.ifClickable=function(){return!0===t.mouseEnabled?1:0};this.setActive=function(a,b){m=b;p[a].gotoAndStop("state_"+m);p[a].mouseEnabled=!0;m?(y.color="#69b8d5",_oLevelTextStruct.color="#004e6f"):(y.color="#b4b4b4",_oLevelTextStruct.color="#606161")};this.buttonRelease=function(){m&&a[ON_MOUSE_UP]&&a[ON_MOUSE_UP].call(l[ON_MOUSE_UP],x)};this.buttonDown=function(){a[ON_MOUSE_DOWN]&&a[ON_MOUSE_DOWN].call(l[ON_MOUSE_DOWN],x)};this.setPosition=function(a,b){t.x=a;t.y=b};this.setVisible=function(a){t.visible=
a};E=c;this._init(b,n,g,h,d,c)}
function CObstacle(b,n,g,h,d,c,m,a){var l,p,x,y,w;this._init=function(b,c,d,g,h,m){x=createBitmap(d);x.x=b;x.y=c;x.regX=.5*d.width;x.regY=.5*d.height;this.setAngle(m);y=g;w=h;l=b;p=c;a.addChild(x)};this.unload=function(){a.removeChild(x)};this.setVisible=function(a){x.visible=a};this.setPosition=function(a,b){x.x=a;x.y=b;s_oPhysicsController.setElementPosition(m,{x:a,y:b})};this.resetPos=function(){this.setPosition(l,p)};this.setAngle=function(a){x.rotation=a};this.getID=function(){return w};this.getType=
function(){return y};this.getX=function(){return x.x};this.getY=function(){return x.y};this.scale=function(a){x.scaleX=a;x.scaleY=a};this.getScale=function(){return x.scaleX};this.getPhysics=function(){return m};this.setChildIndex=function(b){a.setChildIndex(x,b)};this.setAlpha=function(a){x.alpha=a};this._init(b,n,g,h,d,c);return this}
function CBonus(b,n,g,h,d,c,m){var a,l,p,x=null,y,w,t=!0;this._init=function(b,d,g,h,n){p=createBitmap(g);p.x=b;p.y=d;p.regX=.5*g.width;p.regY=.5*g.height;y=h;w=n;a=b;l=d;s_oPhysicsController.activeBody(c,!1);m.addChild(p)};this.unload=function(){m.removeChild(p)};this.setVisible=function(a){p.visible=a};this.setPosition=function(a,b){p.x=a;p.y=b;s_oPhysicsController.setElementPosition(c,{x:a,y:b})};this.resetPos=function(){this.setPosition(a,l)};this.setAngle=function(a){p.rotation=a};this.getID=
function(){return w};this.getType=function(){return y};this.isCached=function(){return t};this.setCache=function(a){t=a;this.activeBody(!a);p.visible=!a;this.setAngle(0)};this.activeBody=function(a){s_oPhysicsController.activeBody(c,a)};this.getX=function(){return p.x};this.getY=function(){return p.y};this.scale=function(a){p.scaleX=a;p.scaleY=a};this.getScale=function(){return p.scaleX};this.getPhysics=function(){return c};this.setChildIndex=function(a){m.setChildIndex(p,a)};this.move=function(){var a=
s_oPhysicsController.getElementPosition(c);p.x=a.x;p.y=a.y;p.rotation=s_oPhysicsController.getElementAngle(c)};this.spriteFollowPhysics=function(a){t=!a};this.setAlpha=function(a){p.alpha=a};this.animDisappear=function(){null===x&&(x=createjs.Tween.get(p).to({alpha:0},250,createjs.Ease.cubicIn).call(function(){s_oGame.cachedBonus(w);x=null}))};this.update=function(){this.move()};this._init(b,n,g,h,d);return this}
function CSideWall(b,n,g,h,d,c,m,a){var l,p,x,y;this._init=function(b,c,d,g,h,m){p=createBitmap(d);p.x=b+m;p.y=c;x=g;y=h;l={x:p.x,y:c};a.addChild(p)};this.unload=function(){a.removeChild(p)};this.setVisible=function(a){p.visible=a};this.setPosition=function(a,b){p.x=a;p.y=b};this.setPositionPhysics=function(a,b){s_oPhysicsController.setElementPosition(c,{x:a+m,y:b})};this.getPosPhysics=function(){return s_oPhysicsController.getElementPosition(c)};this.getStartPos=function(){return l};this.setAngle=
function(a){p.rotation=a};this.getID=function(){return y};this.getType=function(){return x};this.getX=function(){return p.x};this.getY=function(){return p.y};this.scale=function(a){p.scaleX=a;p.scaleY=a};this.setScaleX=function(a){p.scaleX=a};this.getPhysics=function(){return c};this.setChildIndex=function(b){a.setChildIndex(p,b)};this.setAlpha=function(a){p.alpha=a};this._init(b,n,g,h,d,m);return this}
function CArrow(b,n,g,h){var d,c,m,a,l,p;this._init=function(a,b,c){l=createBitmap(c);l.x=a;l.y=b;l.regY=.5*c.height;l.regX=.5*c.width;p.addChild(l)};this.unload=function(){p.removeChild(l)};this.setVisible=function(a){l.visible=a};this.setAngle=function(a){l.rotation=a};this.setPosition=function(a,b){l.x=a;l.y=b};this.setX=function(a){l.x=a};this.setY=function(a){l.y=a};this.getX=function(){return l.x};this.getY=function(){return l.y};this.unload=function(){p.removeChild(l)};this.setStartPosTween=
function(b,c){m=b;a=c};this.setEndPosTween=function(a,b){d=a;c=b};this.animatePos=function(b){var g=this;createjs.Tween.get(l).to({x:d,y:c},b,createjs.Ease.cubicInOut).call(function(){createjs.Tween.get(l).to({x:m,y:a},b,createjs.Ease.cubicInOut).call(function(){g.animatePos(b)})})};this.removeTween=function(){createjs.Tween.removeTweens(l)};p=h;this._init(b,n,g);return this}
function CHelp(b){var n,g,h,d,c,m,a,l=null,p=null,x,y,w,t,E,C,k;this._init=function(){c=new createjs.Container;c.alpha=1;t.addChild(c);w=new createjs.Shape;w.graphics.beginFill("#000").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);w.alpha=.01;w.on("click",function(){});w.cursor="pointer";c.addChild(w);x=createBitmap(s_oSpriteLibrary.getSprite("fade_help_0"));x.alpha=0;x.visible=!1;c.addChild(x);y=createBitmap(s_oSpriteLibrary.getSprite("fade_help_1"));y.alpha=0;y.visible=!1;c.addChild(y);h=.5*CANVAS_WIDTH+
340;d=.5*CANVAS_HEIGHT+440;var a=s_oSpriteLibrary.getSprite("but_continue_big");E=new CGfxButton(h,d,a,c);E.addEventListenerWithParams(ON_MOUSE_DOWN,this.onPressButton,this,!0);E.setScale(.7);E.pulseAnimation();n=.5*CANVAS_WIDTH-340;g=.5*CANVAS_HEIGHT+440;C=new CGfxButton(n,g,a,c);C.addEventListenerWithParams(ON_MOUSE_DOWN,this.onPressButton,this,!1);C.setScale(.7);C.setScaleX(-.7);this.showHelp1();this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.showHelp1=function(){k=1;if(null===l){l=new createjs.Container;
l.alpha=0;c.addChild(l);var a=TEXT_HELP1_DESKTOP;s_bMobile&&(a=TEXT_HELP1_MOBILE);a=new createjs.Text(a,"32px "+FONT_GAME,TEXT_COLOR_1);a.x=CANVAS_WIDTH_HALF;a.y=CANVAS_HEIGHT_HALF+100;a.textAlign="center";a.textBaseline="middle";a.lineWidth=400;a.lineHeight=30;l.addChild(a);a=s_oSpriteLibrary.getSprite("arrow");m=new CArrow(CANVAS_WIDTH_HALF,CANVAS_HEIGHT_HALF+190,a,l);m.setAngle(90)}C.setVisible(!1);this.leavePage2();createjs.Tween.get(l).wait(300).to({alpha:1},500,createjs.Ease.cubicIn);x.visible=
!0;createjs.Tween.get(x).to({alpha:1},500,createjs.Ease.cubicIn).call(function(){m.setStartPosTween(CANVAS_WIDTH_HALF,CANVAS_HEIGHT_HALF+190);m.setEndPosTween(CANVAS_WIDTH_HALF,CANVAS_HEIGHT_HALF+240);m.animatePos(1E3)})};this.showHelp2=function(){k=2;this.leavePage1();if(null===p){p=new createjs.Container;p.alpha=0;c.addChild(p);var b=new createjs.Text(TEXT_HELP2,"32px "+FONT_GAME,TEXT_COLOR);b.x=CANVAS_WIDTH_HALF;b.y=CANVAS_HEIGHT_HALF-230;b.textAlign="center";b.textBaseline="middle";b.lineWidth=
400;b.lineHeight=30;p.addChild(b);b=s_oSpriteLibrary.getSprite("arrow");a=new CArrow(CANVAS_WIDTH_HALF,CANVAS_HEIGHT_HALF-170,b,p);a.setAngle(90)}C.setVisible(!0);createjs.Tween.get(p).wait(300).to({alpha:1},500,createjs.Ease.cubicIn);y.visible=!0;createjs.Tween.get(y).to({alpha:1},500,createjs.Ease.cubicIn).call(function(){a.setStartPosTween(CANVAS_WIDTH_HALF,CANVAS_HEIGHT_HALF-170);a.setEndPosTween(CANVAS_WIDTH_HALF,CANVAS_HEIGHT_HALF-130);a.animatePos(1E3)})};this.leavePage1=function(){createjs.Tween.get(l).to({alpha:0},
500,createjs.Ease.cubicIn).call(function(){m.removeTween()});createjs.Tween.get(x).to({alpha:0},500,createjs.Ease.cubicIn).call(function(){x.visible=!1})};this.leavePage2=function(){null!==p&&(createjs.Tween.get(p).to({alpha:0},500,createjs.Ease.cubicIn).call(function(){a.removeTween()}),createjs.Tween.get(y).to({alpha:0},500,createjs.Ease.cubicIn).call(function(){y.visible=!1}))};this.refreshButtonPos=function(a,b){E.setPosition(h-a,d-b);C.setPosition(n+a,g-b)};this.unload=function(){createjs.Tween.get(c).to({alpha:0},
150,createjs.quartOut).call(function(){t.removeChild(c);E.unload();C.unload();C=E=null;w.removeAllEventListeners()});s_oHelp=null};this.onPressButton=function(a){switch(k){case 1:this.showHelp2();break;case 2:a?this._onExit():this.showHelp1()}};this._onExit=function(){s_oGame._onExitHelp()};t=b;this._init();return s_oHelp=this}var s_oHelp=null;
function CBubble(b,n){var g,h,d,c,m,a,l=!1;this._init=function(a){g=createBitmap(a);g.regX=.5*a.width;g.regY=.5*a.height;n.addChild(g);h=-g.regY-EDGEBOARD_Y;this.reset()};this.unload=function(){n.removeChild(g)};this.setVisible=function(a){g.visible=a};this.getX=function(){return g.x};this.getY=function(){return g.y};this.reset=function(b){l=!1;var h=Math.floor(Math.random()*(BUBBLE_TIME.max-BUBBLE_TIME.min)+BUBBLE_TIME.min);!0===b&&(h=0);m=Math.random()*CANVAS_WIDTH-(EDGEBOARD_X-g.regX)+(EDGEBOARD_X+
g.regX);g.x=m;g.y=CANVAS_HEIGHT-EDGEBOARD_Y-g.regY;d=g.scaleX=g.scaleY=0;a=Math.floor(Math.random()*(BUBBLE_RANGE_X.max-BUBBLE_RANGE_X.min)+BUBBLE_RANGE_X.min);c=Math.random()*(BUBBLE_SPEED.max-BUBBLE_SPEED.min)+BUBBLE_SPEED.min;createjs.Tween.get(this).wait(h).call(function(){this.setVisible(!0);this.bubbleAnim();l=!0})};this.bubbleAnim=function(){var a=Math.random()*(BUBBLE_SCALE.max-BUBBLE_SCALE.min)+BUBBLE_SCALE.min;createjs.Tween.get(g).to({scaleX:a,scaleY:a},500)};this.getChildIndexFront=function(){return n.getChildIndex(g)};
this.childIndexFront=function(a){n.setChildIndex(g,a)};this.update=function(){if(l)if(g.y>h){var b=Math.sin(d)*a;g.y-=c;g.x=m+b;d+=.1}else l=!1,this.reset()};this._init(b);return this}
function CAnimBubble(b,n,g,h){var d;this._init=function(b,g,a){var l=new createjs.SpriteSheet({images:[a],frames:{width:a.width/6,height:a.height/4,regX:a.width/6/2,regY:a.height/4/2},animations:{explosion:[0,23,.1]}});d=createSprite(l,0,a.width/6/2,a.height/4/2,a.width/6,a.height/4);d.x=b;d.y=g;d.stop();d.visible=!1;h.addChild(d)};this.unload=function(){h.removeChild(d)};this.setVisible=function(b){d.visible=b};this.startAnimation=function(){d.visible||(d.visible=!0,d.gotoAndPlay("explosion"),d.on("animationend",
function(){d.visible=!1;d.stop()}))};this.getX=function(){return d.x};this.getY=function(){return d.y};this._init(b,n,g);return this};
