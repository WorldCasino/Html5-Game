var s_iOffsetX=0,s_iOffsetY=0;
(function(a){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))})(navigator.userAgent||
navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(a){console.log(a)}function isIOS(){for(var a="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");a.length;)if(navigator.platform===a.pop())return s_bIsIphone=!0;return s_bIsIphone=!1}window.addEventListener("orientationchange",onOrientationChange);
function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}
function getSize(a){var b=a.toLowerCase(),c=window.document,e=c.documentElement;if(void 0===window["inner"+a])a=e["client"+a];else if(window["inner"+a]!=e["client"+a]){var d=c.createElement("body");d.id="vpw-test-b";d.style.cssText="overflow:scroll";var g=c.createElement("div");g.id="vpw-test-d";g.style.cssText="position:absolute;top:-1000px";g.innerHTML="<style>@media("+b+":"+e["client"+a]+"px){body#vpw-test-b div#vpw-test-d{"+b+":7px!important}}</style>";d.appendChild(g);e.insertBefore(d,c.head);
a=7==g["offset"+a]?e["client"+a]:window["inner"+a];e.removeChild(d)}else a=window["inner"+a];return a}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}function getHeightOfIOSToolbars(){var a=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<a?a:0}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var a;a=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?getIOSWindowHeight():getSize("Height");var b=getSize("Width");_checkOrientation(b,a);var c=Math.min(a/CANVAS_HEIGHT,b/CANVAS_WIDTH),e=CANVAS_WIDTH*c,c=CANVAS_HEIGHT*c;s_bMobile&&!s_bIsIphone?($("#canvas").css("width",e+"px"),$("#canvas").css("height",c+"px")):(s_oStage.canvas.width=e,s_oStage.canvas.height=c,s_oStage.scaleX=s_oStage.scaleY=Math.min(e/CANVAS_WIDTH,c/CANVAS_HEIGHT));
var d;c<a?(d=a-c,c+=d,e+=CANVAS_WIDTH/CANVAS_HEIGHT*d):e<b&&(d=b-e,e+=d,c+=CANVAS_HEIGHT/CANVAS_WIDTH*d);d=a/2-c/2;var g=b/2-e/2,f=CANVAS_WIDTH/e;if(g*f<-EDGEBOARD_X||d*f<-EDGEBOARD_Y)s_iScaleFactor=Math.min(a/(CANVAS_HEIGHT-2*EDGEBOARD_Y),b/(CANVAS_WIDTH-2*EDGEBOARD_X)),e=CANVAS_WIDTH*s_iScaleFactor,c=CANVAS_HEIGHT*s_iScaleFactor,d=(a-c)/2,g=(b-e)/2,f=CANVAS_WIDTH/e;s_iOffsetX=-1*g*f;s_iOffsetY=-1*d*f;0<=d&&(s_iOffsetY=0);0<=g&&(s_iOffsetX=0);null!==s_oInterface&&s_oInterface.refreshButtonPos(s_iOffsetX,
s_iOffsetY);null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oLevelMenu&&s_oLevelMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);$("#canvas").css("width",e+"px");$("#canvas").css("height",c+"px");0>d?($("#canvas").css("top",d+"px"),s_iCanvasOffsetHeight=d):($("#canvas").css("top","0px"),s_iCanvasOffsetHeight=0);$("#canvas").css("left",g+"px");resizeCanvas3D();s_iCanvasResizeWidth=e;s_iCanvasResizeHeight=c;s_iCanvasOffsetWidth=g}}
function _checkOrientation(a,b){s_bMobile&&(a>b?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()))}
function inIframe(){try{return window.self!==window.top}catch(a){return!0}}function createBitmap(a,b,c){var e=new createjs.Bitmap(a),d=new createjs.Shape;b&&c?d.graphics.beginFill("#fff").drawRect(-b/2,-c/2,b,c):d.graphics.beginFill("#ff0").drawRect(0,0,a.width,a.height);e.hitArea=d;return e}function createSprite(a,b,c,e,d,g){a=null!==b?new createjs.Sprite(a,b):new createjs.Sprite(a);b=new createjs.Shape;b.graphics.beginFill("#000000").drawRect(-c,-e,d,g);a.hitArea=b;return a}
function randomFloatBetween(a,b,c){"undefined"===typeof c&&(c=2);return parseFloat(Math.min(a+Math.random()*(b-a),b).toFixed(c))}function shuffle(a){for(var b=a.length,c,e;0!==b;)e=Math.floor(Math.random()*b),--b,c=a[b],a[b]=a[e],a[e]=c;return a}function formatTime(a){a/=1E3;var b=Math.floor(a/60);a=parseFloat(a-60*b).toFixed(1);var c="",c=10>b?c+("0"+b+":"):c+(b+":");return 10>a?c+("0"+a):c+a}function degreesToRadians(a){return a*Math.PI/180}
function checkRectCollision(a,b){var c,e;c=getBounds(a,.9);e=getBounds(b,.98);return calculateIntersection(c,e)}function calculateIntersection(a,b){var c,e,d,g,f,h,k,l;c=a.x+(d=a.width/2);e=a.y+(g=a.height/2);f=b.x+(h=b.width/2);k=b.y+(l=b.height/2);c=Math.abs(c-f)-(d+h);e=Math.abs(e-k)-(g+l);return 0>c&&0>e?(c=Math.min(Math.min(a.width,b.width),-c),e=Math.min(Math.min(a.height,b.height),-e),{x:Math.max(a.x,b.x),y:Math.max(a.y,b.y),width:c,height:e,rect1:a,rect2:b}):null}
function getBounds(a,b){var c={x:Infinity,y:Infinity,width:0,height:0};if(a instanceof createjs.Container){c.x2=-Infinity;c.y2=-Infinity;var e=a.children,d=e.length,g,f;for(f=0;f<d;f++)g=getBounds(e[f],1),g.x<c.x&&(c.x=g.x),g.y<c.y&&(c.y=g.y),g.x+g.width>c.x2&&(c.x2=g.x+g.width),g.y+g.height>c.y2&&(c.y2=g.y+g.height);Infinity==c.x&&(c.x=0);Infinity==c.y&&(c.y=0);Infinity==c.x2&&(c.x2=0);Infinity==c.y2&&(c.y2=0);c.width=c.x2-c.x;c.height=c.y2-c.y;delete c.x2;delete c.y2}else{var h,k;a instanceof createjs.Bitmap?
(d=a.sourceRect||a.image,f=d.width*b,h=d.height*b):a instanceof createjs.Sprite?a.spriteSheet._frames&&a.spriteSheet._frames[a.currentFrame]&&a.spriteSheet._frames[a.currentFrame].image?(d=a.spriteSheet.getFrame(a.currentFrame),f=d.rect.width,h=d.rect.height,e=d.regX,k=d.regY):(c.x=a.x||0,c.y=a.y||0):(c.x=a.x||0,c.y=a.y||0);e=e||0;f=f||0;k=k||0;h=h||0;c.regX=e;c.regY=k;d=a.localToGlobal(0-e,0-k);g=a.localToGlobal(f-e,h-k);f=a.localToGlobal(f-e,0-k);e=a.localToGlobal(0-e,h-k);c.x=Math.min(Math.min(Math.min(d.x,
g.x),f.x),e.x);c.y=Math.min(Math.min(Math.min(d.y,g.y),f.y),e.y);c.width=Math.max(Math.max(Math.max(d.x,g.x),f.x),e.x)-c.x;c.height=Math.max(Math.max(Math.max(d.y,g.y),f.y),e.y)-c.y}return c}function NoClickDelay(a){this.element=a;window.Touch&&this.element.addEventListener("touchstart",this,!1)}
NoClickDelay.prototype={handleEvent:function(a){switch(a.type){case "touchstart":this.onTouchStart(a);break;case "touchmove":this.onTouchMove(a);break;case "touchend":this.onTouchEnd(a)}},onTouchStart:function(a){a.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(a){this.moved=!0},onTouchEnd:function(a){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){a=document.elementFromPoint(a.changedTouches[0].clientX,a.changedTouches[0].clientY);3==a.nodeType&&(a=a.parentNode);var b=document.createEvent("MouseEvents");b.initEvent("click",!0,!0);a.dispatchEvent(b)}}};
(function(){function a(a){var c={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};a=a||window.event;a.type in c?document.body.className=c[a.type]:(document.body.className=this[b]?"hidden":"visible","hidden"===document.body.className?s_oMain.stopUpdate():s_oMain.startUpdate())}var b="hidden";b in document?document.addEventListener("visibilitychange",a):(b="mozHidden")in document?document.addEventListener("mozvisibilitychange",a):(b="webkitHidden")in
document?document.addEventListener("webkitvisibilitychange",a):(b="msHidden")in document?document.addEventListener("msvisibilitychange",a):"onfocusin"in document?document.onfocusin=document.onfocusout=a:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=a})();function playSound(a,b,c){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?createjs.Sound.play(a,{loop:c,volume:b}):null}function stopSound(a){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||a.stop()}
function setVolume(a,b){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)a.volume=b}function setMute(a,b){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||a.setMute(b)}function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}function getParamValue(a){for(var b=window.location.search.substring(1).split("&"),c=0;c<b.length;c++){var e=b[c].split("=");if(e[0]==a)return e[1]}}
function rotateVector2D(a,b){return{x:b.x*Math.cos(a)+b.y*Math.sin(a),y:b.x*-Math.sin(a)+b.y*Math.cos(a)}}function normalize(a,b){0<b&&(a.x/=b,a.y/=b);return a}function length(a){return Math.sqrt(a.x*a.x+a.y*a.y)}function findNearestIntersectingObject(a,b,c,e){var d=CANVAS_RESIZE_WIDTH+2*OFFSET_WIDTH,g=CANVAS_RESIZE_HEIGHT+2*OFFSET_HEIGHT,f=new THREE.Raycaster,h=new THREE.Vector3;h.x=a/d*2-1;h.y=2*-(b/g)+1;h.z=.5;f.setFromCamera(h,c);a=f.intersectObjects(e,!0);b=!1;0<a.length&&(b=a[0]);return b}
function distance(a,b,c,e){a-=c;b-=e;return Math.sqrt(a*a+b*b)}function distance2(a,b,c,e){a-=c;b-=e;return a*a+b*b}function resizeCanvas3D(){$("canvas").each(function(){"#canvas"!=$(this).attr("id")&&($(this).css("width",$("#canvas").css("width")),$(this).css("height",$("#canvas").css("height")),$(this).css("position",$("#canvas").css("position")),$(this).css("left",$("#canvas").css("left")),$(this).css("top",$("#canvas").css("top")))})}
function convert3dPosTo2dScreen(a,b){var c=new THREE.Vector3;c.set(a.x,a.y,a.z);c.project(b);c.x=Math.round((c.x+1)*CANVAS_WIDTH*.5);c.y=Math.round((-c.y+1)*CANVAS_HEIGHT*.5);c.z=0;return c}function convert2dPosTo3d(a,b){var c=new THREE.Vector3;c.set(a.x/CANVAS_WIDTH*2-1,2*-(a.y/CANVAS_HEIGHT)+1,.5);c.unproject(b);var c=c.sub(b.position).normalize(),e=-b.position.z/c.z,c=b.position.clone().add(c.multiplyScalar(e));return{x:c.x,y:c.y}}
function createOrthoGraphicCamera(){var a=new THREE.OrthographicCamera(CANVAS_WIDTH/-2,CANVAS_WIDTH/2,CANVAS_HEIGHT/-2,CANVAS_HEIGHT/2,1,1E3);a.rotation.x=Math.PI/180*45;a.rotation.y=Math.PI/180*-30;a.rotation.z=Math.PI/180*-30;a.zoom=6;a.left=CANVAS_WIDTH/-2;a.right=CANVAS_WIDTH/2;a.top=CANVAS_HEIGHT/2;a.bottom=CANVAS_HEIGHT/-2;a.position.set(0,0,0);a.updateProjectionMatrix();a.updateMatrixWorld();return a}function dotProductV2(a,b){return a.getX()*b.getX()+a.getY()*b.getY()}
function pointInPoly(a,b){for(var c=!1,e=-1,d=b.length,g=d-1;++e<d;g=e)(b[e].y<=a.y&&a.y<b[g].y||b[g].y<=a.y&&a.y<b[e].y)&&a.x<(b[g].x-b[e].x)*(a.y-b[e].y)/(b[g].y-b[e].y)+b[e].x&&(c=!c);return c}function angleBetweenVectors(a,b){var c=dotProductV2(a,b),e=a.getX()*b.getY()-a.getY()*b.getX();return Math.atan2(e,c)}function rotateVector2D(a,b){var c=b.getX()*Math.cos(a)+b.getY()*Math.sin(a),e=b.getX()*-Math.sin(a)+b.getY()*Math.cos(a);return{x:c,y:e,z:0}}Math.radians=function(a){return a*Math.PI/180};
Math.degrees=function(a){return 180*a/Math.PI};function distanceV3(a,b,c,e,d,g){a-=e;b-=d;c-=g;return Math.sqrt(a*a+b*b+c*c)}function distanceV2(a,b){var c=a.x-b.x,e=a.y-b.y;return Math.sqrt(c*c+e*e)}
function CSpriteLibrary(){var a={},b,c,e,d,g,f;this.init=function(a,k,l){b={};e=c=0;d=a;g=k;f=l};this.addSprite=function(d,e){a.hasOwnProperty(d)||(a[d]=b[d]={szPath:e,oSprite:new Image,bLoaded:!1},c++)};this.getSprite=function(b){return a.hasOwnProperty(b)?a[b].oSprite:null};this._onSpritesLoaded=function(){c=0;g.call(f)};this._onSpriteLoaded=function(a){d.call(f,a);++e===c&&this._onSpritesLoaded()};this.loadSprites=function(){for(var a in b)b[a].oSprite.oSpriteLibrary=this,b[a].oSprite.szKey=a,
b[a].oSprite.onload=function(){this.oSpriteLibrary.setLoaded(this.szKey);this.oSpriteLibrary._onSpriteLoaded(this.szKey)},b[a].oSprite.src=b[a].szPath};this.setLoaded=function(b){a[b].bLoaded=!0};this.isLoaded=function(b){return a[b].bLoaded};this.getNumSprites=function(){return c}}
var CANVAS_WIDTH=1600,CANVAS_HEIGHT=968,EDGEBOARD_X=150,EDGEBOARD_Y=150,DISABLE_SOUND_MOBILE=!1,PRIMARY_FONT="space_comics",FPS=60,FPS_TIME=1E3/FPS,STATE_LOADING=0,STATE_MENU=1,STATE_HELP=1,STATE_GAME=3,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,ON_CONTROLLER_END=8,ON_CONTROLLER_REMOVE=9,ON_CONTROLLER_ROLL=10,RESTART_WATER_DEPTH_VALUE=5,HOLE_DEPTH_VALUE=3,MIN_MOUSE_DISTANCE_POWER_ACTIVATED=30,MIN_MOUSE_DISTANCE_POWER_ACTIVATED_MOBILE=100,MAX_MOUSE_DISTANCE_POWER_ACTIVATED=
300,BALL_MASS=1,BALL_RADIUS=2,BALL_FRICTION=.5,BALL_RESTITUTION=.5,BALL_LINEAR_DAMPING=.5,BALL_LINEAR_DAMPING_SAND=.95,BALL_LINEAR_DAMPING_WATER=.99,BALL_LINEAR_DAMPING_HOLE=3.8,MIN_VELOCITY_FOR_LAUNCH=1.5,ARROW_DISTANCE=75,RATIO_ARROW_DISTANCE=4,TIME_FOR_LAUNCH=.2,OFFSET_ANGLE_ARROW=90,HIT_BALL_MAX_FORCE=200,HIT_BALL_MIN_FORCE=.01,SHOW_3D_RENDER=!1,CAMERA_TEST=!1,START_CAMERA_POSITION={x:-240,y:-290,z:280},NEAR=-30,FAR=2E3,FORCE_MULTIPLIER=2,PAR_POINTS,ADDED_POINTS,MAX_SHOT_POWER,ENABLE_FULLSCREEN,
NUM_HOLES=18,PAR=[],FLAGS_POS=[[{x:424,y:-488},{x:655,y:-340}],[{x:660,y:102},{x:924,y:-54}],[{x:816,y:-1212},{x:1580,y:-704}],[{x:64,y:-588},{x:464,y:-816}],[{x:693,y:-1307},{x:1308,y:-912}],[{x:175,y:-1252},{x:480,y:-1052}],[{x:-432,y:852},{x:-204,y:1010}],[{x:-1430,y:632},{x:-1200,y:788}],[{x:-856,y:1220},{x:-628,y:1372}],[{x:-2140,y:1042},{x:-1910,y:1196}],[{x:-1612,y:736},{x:-1380,y:892}],[{x:-112,y:-136},{x:125,y:20}],[{x:-1618,y:236},{x:-1390,y:392}],[{x:-1860,y:735},{x:-1396,y:1048}],[{x:692,
y:-588},{x:924,y:-440}],[{x:1930,y:-484},{x:2088,y:-384}],[{x:-1740,y:-30},{x:-1276,y:276}],[{x:960,y:-764},{x:1216,y:-590}]],CAUSTICS_POS=[null,null,{x:1148,y:-750,scale:1},null,null,null,{x:904,y:-730,scale:1},{x:468,y:-328,scale:1},{x:1392,y:108,scale:.3},{x:508,y:-272,scale:1},null,{x:-838,y:-386,scale:.7},{x:514,y:-60,scale:1},null,{x:688,y:-60,scale:.4},null,null,{x:846,y:-496,scale:1}],LOCALSTORAGE_SCORE="score";
function CLocalStorage(a){this.init=function(){var b=window.localStorage.getItem(a);null!==b&&void 0!==b&&!1!==s_bStorageAvailable||this.resetAllData()};this.setItem=function(b,c){s_bStorageAvailable&&(_bDirty=!0,window.localStorage.setItem(a+"_"+b,c))};this.getItem=function(b){return window.localStorage.getItem(a+"_"+b)};this.setItemJson=function(b,c){s_bStorageAvailable&&localStorage.setItem(a+"_"+b,JSON.stringify(c))};this.getItemJson=function(b){b=JSON.parse(localStorage.getItem(a+"_"+b));if(null===
b){b=[];for(var c=0;c<NUM_HOLES;c++)b[c]=0}return b};this.isDirty=function(){var a=s_oLocalStorage.getItemJson(LOCALSTORAGE_SCORE);if(!s_bStorageAvailable||null===a)return!1;for(var c=0;c<a.length;c++)if(0<a[c])return!0;return!1};this.resetAllData=function(){window.localStorage.setItem(a,!0);for(var b=[],c=0;c<NUM_HOLES;c++)b[c]=0;this.setItemJson(LOCALSTORAGE_SCORE,b)}}
var EASE_LINEAR=0,EASE_CUBIC_IN=1,EASE_QUART_BACKIN=2,EASE_BACKIN=3,EASE_SIN_IN=4,EASE_QUAD_IN=5,EASE_CUBIC_OUT=6,EASE_ELASTIC_OUT=7,EASE_BACKOUT=8,EASE_QUINT_OUT=9,EASE_CUBIC_INOUT=10;
function CTweenController(){this.tweenValue=function(a,b,c){return a+c*(b-a)};this.easeLinear=function(a,b,c,e){return c*a/e+b};this.easeInCubic=function(a,b,c,e){e=(a/=e)*a*a;return b+c*e};this.easeBackInQuart=function(a,b,c,e){e=(a/=e)*a;return b+c*(2*e*e+2*e*a+-3*e)};this.easeInBack=function(a,b,c,e){return c*(a/=e)*a*(2.70158*a-1.70158)+b};this.easeInSine=function(a,b,c,e){return-c*Math.cos(a/e*(Math.PI/2))+c+b};this.easeInQuad=function(a,b,c,e){return c*(a/=e)*a+b};this.easeOutCubic=function(a,
b,c,e){return c*((a=a/e-1)*a*a+1)+b};this.easeOutElastic=function(a,b,c,e){var d;if(0===a)return b;if(1===(a/=e))return b+c;d=.3*e;return c*Math.pow(2,-10*a)*Math.sin(2*(a*e-d/4)*Math.PI/d)+c+b};this.easeOutBack=function(a,b,c,e){return c*((a=a/e-1)*a*(2.70158*a+1.70158)+1)+b};this.easeInOutCubic=function(a,b,c,e){return 1>(a/=e/2)?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b};this.easeOutQuint=function(a,b,c,e){return c*((a=a/e-1)*a*a*a*a+1)+b}}
function CRollingTextController(a,b,c,e,d){var g,f,h,k,l,n,q,m,p,r,u,t;this._init=function(a,b,c,d,e){m=[];p=[];l=d;this.setUpdateInfo(c);q=e;u=a;t=b;r=[]};this.unload=function(){clearInterval(n)};this.setUpdateInfo=function(b){h=parseFloat(a.text);k=h+b;g=0;f=Math.round(l/FPS);var c=this;n=setInterval(function(){c.update()},FPS_TIME)};this.addEventListener=function(a,b,c){m[a]=b;p[a]=c};this.addRollingListener=function(a,b,c){m[ON_CONTROLLER_ROLL]=a;p[ON_CONTROLLER_ROLL]=b;r=[];for(a=0;a<c.length;a++)r[a]=
{step:c[a],flag:!1}};this.increaseValue=function(a){};this.getTarget=function(){return u};this.update=function(){g++;if(g>f)g=0,u.text=k.toFixed(0),null!==t&&(t.text=k.toFixed(0)),clearInterval(n);else{var a;switch(q){case EASE_BACKIN:a=s_oTweenController.easeInBack(g,0,1,f);break;case EASE_BACKOUT:a=s_oTweenController.easeOutBack(g,0,1,f);break;case EASE_CUBIC_IN:a=s_oTweenController.easeInCubic(g,0,1,f);break;case EASE_CUBIC_OUT:a=s_oTweenController.easeOutCubic(g,0,1,f);break;case EASE_ELASTIC_OUT:a=
s_oTweenController.easeOutElastic(g,0,1,f);break;case EASE_LINEAR:a=s_oTweenController.easeLinear(g,0,1,f);break;case EASE_QUART_BACKIN:a=s_oTweenController.easeBackInQuart(g,0,1,f);break;default:a=s_oTweenController.easeLinear(g,0,1,f)}a=s_oTweenController.tweenValue(h,k,a);for(var b=0;b<r.length;b++)a>=r[b].step&&!r[b].flag&&(r[b].flag=!0,null!==m[ON_CONTROLLER_ROLL]&&m[ON_CONTROLLER_ROLL].call(p[ON_CONTROLLER_ROLL],b));u.text=a.toFixed(0);null!==t&&(t.text=a.toFixed(0))}};this._init(a,b,c,e,d)}
TEXT_GAMEOVER="GAME OVER";TEXT_ARE_SURE="ARE YOU SURE YOU WANT TO QUIT THE GAME?";TEXT_SAVE_REMOVE="THIS WILL REMOVE ALL YOUR ACHIEVEMENTS! DO YOU WANT TO PROCEED?";TEXT_TOTAL_SCORE="TOTAL SCORE";TEXT_LAUNCH="LAUNCH";TEXT_HOLE="HOLE";TEXT_LOADING="LOADING...";TEXT_ALL_COMPLETE="ALL LEVEL COMPLETED";TEXT_SELECT_A_LEVEL="SELECT A LEVEL";TEXT_HELP1_PC="CLICK THE BALL AND DRAG TO SET POWER AND DIRECTION";TEXT_HELP1_MOBILE="TOUCH THE BALL AND DRAG THE FINGER TO SET POWER AND DIRECTION";TEXT_HELP2="CLICK AND DRAG TO HAVE A PAN VIEW";
TEXT_ERR_LS="YOUR WEB BROWSER DOES NOT SUPPORT STORING SETTING LOCALLY. IN SAFARI, THE MOST COMMON CAUSE OF THIS IS USING 'PRIVATE BROWSING MODE'. SOME INFO MAY NOT SAVE OR SOME FEATURE MAY NOT WORK PROPERLY.";TEXT_SCORE="SCORE";TEXT_COMPLETE="COMPLETE";TEXT_DEVELOPED="DEVELOPED BY";TEXT_DOUBLE_BOGEY="DOUBLE BOGEY";TEXT_BOGEY="BOGEY";TEXT_PAR="PAR";TEXT_BIRDIE="BIRDIE";TEXT_EAGLE="EAGLE";TEXT_ALBATROSS="ALBATROSS";TEXT_CONDOR="CONDOR";TEXT_PHOENIX="PHOENIX";TEXT_HOLEINONE="HOLE IN ONE";
TEXT_SHARE_IMAGE="200x200.jpg";TEXT_SHARE_TITLE="Congratulations!";TEXT_SHARE_MSG1="You collected <strong>";TEXT_SHARE_MSG2=" points</strong>!<br><br>Share your score with your friends!";TEXT_SHARE_SHARE1="My score is ";TEXT_SHARE_SHARE2=" points! Can you do better?";
function CPreloader(){var a,b,c,e,d,g,f;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png");s_oSpriteLibrary.loadSprites();f=new createjs.Container;s_oStage.addChild(f)};this.unload=function(){f.removeAllChildren()};this.hide=function(){var a=this;setTimeout(function(){createjs.Tween.get(g).to({alpha:1},500).call(function(){a.unload();
s_oMain.gotoMenu()})},1E3)};this._onImagesLoaded=function(){};this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};this.attachSprites=function(){var h=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));f.addChild(h);h=s_oSpriteLibrary.getSprite("progress_bar");e=createBitmap(h);e.x=CANVAS_WIDTH/2-h.width/2;e.y=CANVAS_HEIGHT-200;f.addChild(e);a=h.width;b=h.height;d=new createjs.Shape;d.graphics.beginFill("rgba(255,255,255,0.01)").drawRect(e.x,e.y,1,b);f.addChild(d);e.mask=
d;c=new createjs.Text("","30px "+PRIMARY_FONT,"#fff");c.x=CANVAS_WIDTH/2;c.y=CANVAS_HEIGHT-200;c.shadow=new createjs.Shadow("#000",2,2,2);c.textBaseline="alphabetic";c.textAlign="center";f.addChild(c);g=new createjs.Shape;g.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);g.alpha=0;f.addChild(g)};this.refreshLoader=function(f){c.text=f+"%";d.graphics.clear();f=Math.floor(f*a/100);d.graphics.beginFill("rgba(255,255,255,0.01)").drawRect(e.x,e.y,f,b)};this._init()}
function CLoadingScreen(a){var b=null,c,e,d;this._init=function(){d=new createjs.Container;a.addChild(d);b=new createjs.Shape;b.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);b.on("click",function(){});d.addChild(b);c=new createjs.Text(TEXT_LOADING,"30px "+PRIMARY_FONT,"#ffffff");c.x=CANVAS_WIDTH/2;c.y=CANVAS_HEIGHT/2;c.textAlign="center";c.textBaseline="alphabetic";c.alpha=0;d.addChild(c);var g=s_oSpriteLibrary.getSprite("preloader_anim");e=createBitmap(g);e.x=CANVAS_WIDTH/
2;e.y=CANVAS_HEIGHT/2+40;e.regX=.5*g.width;e.regY=.5*g.height;e.alpha=0;d.addChild(e);createjs.Tween.get(e).to({alpha:1},500);createjs.Tween.get(c).to({alpha:1},500);this.animLoad()};this.animLoad=function(){var a=this;createjs.Tween.get(e).to({rotation:e.rotation+360},1E3).call(function(){a.animLoad()})};this.unload=function(){b.removeAllEventListeners();createjs.Tween.get(d).to({alpha:0},500).call(function(){a.removeChild(d)})};this._init();return this}
function CMain(a){var b,c=0,e=0,d=STATE_LOADING,g,f,h,k,l;this.initContainer=function(){var a=document.getElementById("canvas");s_oStage=new createjs.Stage(a);createjs.Touch.enable(s_oStage);s_oStage.preventSelection=!1;s_bMobile=jQuery.browser.mobile;!1===s_bMobile&&(s_oStage.enableMouseOver(20),$("body").on("contextmenu","#canvas",function(a){return!1}));s_iPrevTime=(new Date).getTime();createjs.Ticker.addEventListener("tick",this._update);createjs.Ticker.setFPS(FPS);navigator.userAgent.match(/Windows Phone/i)&&
(DISABLE_SOUND_MOBILE=!0);f=[];s_oSpriteLibrary=new CSpriteLibrary;s_oTweenController=new CTweenController;h=new CPreloader;b=!0};this.soundLoaded=function(){c++;h.refreshLoader(Math.floor(c/e*100));if(c===e)this.onPreloadingComplete()};this._initSounds=function(){createjs.Sound.initializeDefaultPlugins()&&(0<navigator.userAgent.indexOf("Opera")||0<navigator.userAgent.indexOf("OPR")?(createjs.Sound.alternateExtensions=["mp3"],createjs.Sound.addEventListener("fileload",createjs.proxy(this.soundLoaded,
this)),createjs.Sound.registerSound("./sounds/click.ogg","click"),createjs.Sound.registerSound("./sounds/soundtrack.ogg","soundtrack"),createjs.Sound.registerSound("./sounds/win_level.ogg","win_level"),createjs.Sound.registerSound("./sounds/ambience.ogg","ambience"),createjs.Sound.registerSound("./sounds/hit_ball.ogg","hit_ball"),createjs.Sound.registerSound("./sounds/hole.ogg","hole"),createjs.Sound.registerSound("./sounds/sand.ogg","sand"),createjs.Sound.registerSound("./sounds/water.ogg","water"),
createjs.Sound.registerSound("./sounds/star.ogg","star")):(createjs.Sound.alternateExtensions=["ogg"],createjs.Sound.addEventListener("fileload",createjs.proxy(this.soundLoaded,this)),createjs.Sound.registerSound("./sounds/click.mp3","click"),createjs.Sound.registerSound("./sounds/soundtrack.mp3","soundtrack"),createjs.Sound.registerSound("./sounds/win_level.mp3","win_level"),createjs.Sound.registerSound("./sounds/ambience.mp3","ambience"),createjs.Sound.registerSound("./sounds/hit_ball.mp3","hit_ball"),
createjs.Sound.registerSound("./sounds/hole.mp3","hole"),createjs.Sound.registerSound("./sounds/sand.mp3","sand"),createjs.Sound.registerSound("./sounds/water.mp3","water"),createjs.Sound.registerSound("./sounds/star.mp3","star")),e+=9)};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("preloader_anim","./sprites/preloader_anim.png");s_oSpriteLibrary.addSprite("but_play","./sprites/but_play.png");s_oSpriteLibrary.addSprite("but_continue",
"./sprites/but_continue.png");s_oSpriteLibrary.addSprite("but_continue_big","./sprites/but_continue_big.png");s_oSpriteLibrary.addSprite("but_info","./sprites/but_info.png");s_oSpriteLibrary.addSprite("ctl_logo","./sprites/ctl_logo.png");s_oSpriteLibrary.addSprite("but_yes","./sprites/but_yes.png");s_oSpriteLibrary.addSprite("but_not","./sprites/but_not.png");s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png");s_oSpriteLibrary.addSprite("but_restart_small","./sprites/but_restart_small.png");
s_oSpriteLibrary.addSprite("but_restart_big","./sprites/but_restart_big.png");s_oSpriteLibrary.addSprite("help_touch","./sprites/help_touch.png");s_oSpriteLibrary.addSprite("star","./sprites/star.png");s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png");s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png");s_oSpriteLibrary.addSprite("but_home","./sprites/but_home.png");s_oSpriteLibrary.addSprite("ball","./sprites/ball.png");
s_oSpriteLibrary.addSprite("arrow","./sprites/arrow.png");s_oSpriteLibrary.addSprite("but_level","./sprites/but_level.png");s_oSpriteLibrary.addSprite("flag","./sprites/flag.png");s_oSpriteLibrary.addSprite("ball_shadow","./sprites/ball_shadow.png");s_oSpriteLibrary.addSprite("caustics","./sprites/caustics.png");s_oSpriteLibrary.addSprite("but_center_view","./sprites/but_center_view.png");s_oSpriteLibrary.addSprite("ball_water","./sprites/ball_water.png");s_oSpriteLibrary.addSprite("press_indicator",
"./sprites/press_indicator.png");s_oSpriteLibrary.addSprite("menu_text_minigolf","./sprites/menu_text_minigolf.png");s_oSpriteLibrary.addSprite("menu_text_world","./sprites/menu_text_world.png");s_oSpriteLibrary.addSprite("but_fullscreen","./sprites/but_fullscreen.png");s_oSpriteLibrary.addSprite("arrow","./sprites/arrow.png");s_oSpriteLibrary.addSprite("arrow_fill","./sprites/arrow_fill.png");s_oSpriteLibrary.addSprite("arrow_frame","./sprites/arrow_frame.png");e+=s_oSpriteLibrary.getNumSprites();
s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=function(){c++;h.refreshLoader(Math.floor(c/e*100));if(c===e)this.onPreloadingComplete()};this._onAllImagesLoaded=function(){};this.onAllPreloaderImagesLoaded=function(){this._loadImages()};this.onPreloadingComplete=function(){s_oLocalStorage=new CLocalStorage("minigolf_world");try{s_oLocalStorage.init()}catch(n){s_bStorageAvailable=!1}h.unload();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)s_oSoundTrack=createjs.Sound.play("soundtrack",{loop:-1});
this.gotoMenu()};this.loadSelectedLevel=function(a){s_iCurLevel=a;e=c=0;if(f[a])this.gotoGame(s_iCurLevel);else{l=new CLoadingScreen(s_oStage);s_oSpriteLibrary.init(this._onLevelLoaded,this._onAllImagesLoaded,this);a+=1;for(var b,d=1;18>=d;d++)b=d-1,10>d?s_oSpriteLibrary.addSprite("level_"+a+"_bg_"+b,"./sprites/bg_levels/level_"+a+"/bg_piece_"+("0"+d+"")+".jpg"):s_oSpriteLibrary.addSprite("level_"+a+"_bg_"+b,"./sprites/bg_levels/level_"+a+"/bg_piece_"+d+".jpg");e+=s_oSpriteLibrary.getNumSprites();
s_oSpriteLibrary.loadSprites()}};this._onLevelLoaded=function(){c++;c===e&&(f[s_iCurLevel]=!0,l.unload(),this.gotoGame(s_iCurLevel),this.loadInBackgroundLevel(s_iCurLevel+1))};this.loadInBackgroundLevel=function(a){s_iBackgroundLevel=a;e=c=0;if(!f[a]){s_oSpriteLibrary.init(this._onBackgroundLevelLoaded,this._onAllImagesLoaded,this);a+=1;for(var b,d=1;18>=d;d++)b=d-1,10>d?s_oSpriteLibrary.addSprite("level_"+a+"_bg_"+b,"./sprites/bg_levels/level_"+a+"/bg_piece_"+("0"+d+"")+".jpg"):s_oSpriteLibrary.addSprite("level_"+
a+"_bg_"+b,"./sprites/bg_levels/level_"+a+"/bg_piece_"+d+".jpg");e+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()}};this._onBackgroundLevelLoaded=function(){c++;if(c===e){for(var a=f[s_iBackgroundLevel]=!0,b=0;b<NUM_HOLES;b++)f[b]||(a=!1);a||(a=s_iBackgroundLevel+1,a<NUM_HOLES?this.loadInBackgroundLevel(a):this.loadInBackgroundLevel(1))}};this.preloaderReady=function(){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)this._initSounds(),s_oSoundTrack=createjs.Sound.play("soundtrack",
{loop:-1});this._loadImages();b=!0};this.gotoMenu=function(){new CMenu;d=STATE_MENU};this.gotoGame=function(a){k=new CGame(g,a);d=STATE_GAME};this.gotoLevelMenu=function(){new CLevelMenu;d=STATE_MENU};this.gotoHelp=function(){new CHelp;d=STATE_HELP};this.stopUpdate=function(){b=!1;createjs.Ticker.paused=!0;$("#block_game").css("display","block");createjs.Sound.setMute(!0)};this.startUpdate=function(){s_iPrevTime=(new Date).getTime();b=!0;createjs.Ticker.paused=!1;$("#block_game").css("display","none");
s_bAudioActive&&createjs.Sound.setMute(!1)};this._update=function(a){if(!1!==b){var c=(new Date).getTime();s_iTimeElaps=c-s_iPrevTime;s_iCntTime+=s_iTimeElaps;s_iCntFps++;s_iPrevTime=c;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);d===STATE_GAME&&k.update();s_oStage.update(a)}};s_oMain=this;PAR_POINTS=a.par_points;ADDED_POINTS=a.added_points;g=a;this.initContainer()}
var s_bMobile,s_bAudioActive=!0,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_oPhysicsController,s_iCanvasResizeHeight,s_iCanvasResizeWidth,s_iCanvasOffsetHeight,s_iCanvasOffsetWidth,s_iCurLevel,s_iBackgroundLevel,s_oDrawLayer,s_oStage,s_oMain,s_oSpriteLibrary,s_oSoundTrack,s_oTweenController,s_oLocalStorage,s_bFullscreen=!1,s_bStorageAvailable=!0;
function CTextButton(a,b,c,e,d,g,f){var h,k,l;this._init=function(a,b,c,d,e,f,g){h=[];k=[];var m=createBitmap(c),p=Math.ceil(g/20),q=new createjs.Text(d,"bold "+g+"px "+e,"#000000");q.textAlign="center";q.textBaseline="alphabetic";var n=q.getBounds();q.x=c.width/2+p;q.y=Math.floor(c.height/2)+n.height/3+p;d=new createjs.Text(d,"bold "+g+"px "+e,f);d.textAlign="center";d.textBaseline="alphabetic";n=d.getBounds();d.x=c.width/2;d.y=Math.floor(c.height/2)+n.height/3;l=new createjs.Container;l.x=a;l.y=
b;l.regX=c.width/2;l.regY=c.height/2;l.addChild(m,q,d);s_bMobile||(l.cursor="pointer");s_oStage.addChild(l);this._initListener()};this.unload=function(){l.off("mousedown");l.off("pressup");s_oStage.removeChild(l)};this.setVisible=function(a){l.visible=a};this._initListener=function(){oParent=this;l.on("mousedown",this.buttonDown);l.on("pressup",this.buttonRelease)};this.addEventListener=function(a,b,c){h[a]=b;k[a]=c};this.buttonRelease=function(){l.scaleX=1;l.scaleY=1;playSound("click",1,0);h[ON_MOUSE_UP]&&
h[ON_MOUSE_UP].call(k[ON_MOUSE_UP])};this.buttonDown=function(){l.scaleX=.9;l.scaleY=.9;h[ON_MOUSE_DOWN]&&h[ON_MOUSE_DOWN].call(k[ON_MOUSE_DOWN])};this.setPosition=function(a,b){l.x=a;l.y=b};this.setX=function(a){l.x=a};this.setY=function(a){l.y=a};this.getButtonImage=function(){return l};this.getX=function(){return l.x};this.getY=function(){return l.y};this._init(a,b,c,e,d,g,f);return this}
function CToggle(a,b,c,e,d){var g,f,h,k;this._init=function(a,b,c,d,e){f=[];h=[];var m=new createjs.SpriteSheet({images:[c],frames:{width:c.width/2,height:c.height,regX:c.width/2/2,regY:c.height/2},animations:{state_true:[0],state_false:[1]}});g=d;k=createSprite(m,"state_"+g,c.width/2/2,c.height/2,c.width/2,c.height);k.x=a;k.y=b;k.stop();s_bMobile||(k.cursor="pointer");e.addChild(k);this._initListener()};this.unload=function(){k.off("mousedown",this.buttonDown);k.off("pressup",this.buttonRelease);
d.removeChild(k)};this._initListener=function(){k.on("mousedown",this.buttonDown);k.on("pressup",this.buttonRelease)};this.addEventListener=function(a,b,c){f[a]=b;h[a]=c};this.setCursorType=function(a){k.cursor=a};this.setActive=function(a){g=a;k.gotoAndStop("state_"+g)};this.buttonRelease=function(){k.scaleX=1;k.scaleY=1;playSound("click",1,0);g=!g;k.gotoAndStop("state_"+g);f[ON_MOUSE_UP]&&f[ON_MOUSE_UP].call(h[ON_MOUSE_UP],g)};this.buttonDown=function(){k.scaleX=.9;k.scaleY=.9;f[ON_MOUSE_DOWN]&&
f[ON_MOUSE_DOWN].call(h[ON_MOUSE_DOWN])};this.setPosition=function(a,b){k.x=a;k.y=b};this._init(a,b,c,e,d)}
function CGfxButton(a,b,c,e){var d,g,f,h,k,l;this._init=function(a,b,c,e){g=!1;d=!0;f=[];h=[];k=createBitmap(c);k.x=a;k.y=b;k.regX=c.width/2;k.regY=c.height/2;s_bMobile||(k.cursor="pointer");e.addChild(k);this._initListener()};this.unload=function(){k.off("mousedown",this.buttonDown);k.off("pressup",this.buttonRelease);e.removeChild(k)};this.setVisible=function(a){k.visible=a};this.setCursorType=function(a){k.cursor=a};this._initListener=function(){k.on("mousedown",this.buttonDown);k.on("pressup",
this.buttonRelease)};this.addEventListener=function(a,b,c){f[a]=b;h[a]=c};this.buttonRelease=function(){g||(d?(k.scaleX=1,k.scaleY=1):(new createjs.Tween.get(k)).to({y:k.y-50},100),playSound("click",1,0),f[ON_MOUSE_UP]&&f[ON_MOUSE_UP].call(h[ON_MOUSE_UP]))};this.buttonDown=function(){g||(d?(k.scaleX=.9,k.scaleY=.9):(new createjs.Tween.get(k)).to({y:k.y+50},100),f[ON_MOUSE_DOWN]&&f[ON_MOUSE_DOWN].call(h[ON_MOUSE_DOWN]))};this.pulseAnimation=function(){createjs.Tween.get(k).to({scaleX:.9,scaleY:.9},
850,createjs.Ease.quadOut).to({scaleX:1,scaleY:1},650,createjs.Ease.quadIn).call(function(){l.pulseAnimation()})};this.trembleAnimation=function(){createjs.Tween.get(k).to({rotation:2},75,createjs.Ease.quadOut).to({rotation:-2},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750).call(function(){l.trembleAnimation()})};this.setPosition=function(a,b){k.x=a;k.y=b};this.setX=function(a){k.x=a};this.setY=function(a){k.y=a};this.setScalable=function(a){d=a};this.getButtonImage=
function(){return k};this.getX=function(){return k.x};this.getY=function(){return k.y};this.setClickable=function(a){g=!a};this._init(a,b,c,e);l=this;return this}
function CMenu(){var a,b,c,e,d,g,f,h,k,l,n,q,m,p,r,u,t,v,x,A,w,D=null,B=null;this._init=function(){n=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(n);var z=s_oSpriteLibrary.getSprite("menu_text_minigolf");v=createBitmap(z);v.regX=z.width/2;v.regY=z.height/2;v.x=CANVAS_WIDTH;v.y=-CANVAS_HEIGHT/2+200;s_oStage.addChild(v);(new createjs.Tween.get(v)).to({x:CANVAS_WIDTH/2-270,y:CANVAS_HEIGHT/2-100},2E3,createjs.Ease.cubicOut);m=new createjs.Container;m.y=CANVAS_HEIGHT/2;m.rotation=
-30;s_oStage.addChild(m);z=s_oSpriteLibrary.getSprite("ball");q=createBitmap(z);q.regX=z.width/2;q.regY=z.height/2;m.addChild(q);(new createjs.Tween.get(q)).wait(2E3).to({x:CANVAS_WIDTH+100},8E3,createjs.Ease.quintOut);(new createjs.Tween.get(q)).wait(2E3).to({y:300},1500,createjs.Ease.bounceOut);z=s_oSpriteLibrary.getSprite("menu_text_world");x=createBitmap(z);x.regX=z.width/2;x.regY=z.height/2;x.x=-CANVAS_WIDTH/2;x.y=CANVAS_HEIGHT+400;s_oStage.addChild(x);(new createjs.Tween.get(x)).wait(500).to({x:CANVAS_WIDTH/
2-40,y:CANVAS_HEIGHT/2+30},2E3,createjs.Ease.cubicOut);s_oLocalStorage.isDirty()?(z=s_oSpriteLibrary.getSprite("but_continue"),d=CANVAS_WIDTH/2+450,g=CANVAS_HEIGHT-80,r=new CGfxButton(d,g,z,s_oStage),r.addEventListener(ON_MOUSE_UP,this._onButPlayRelease,this),r.setScalable(!1),r.trembleAnimation(),z=s_oSpriteLibrary.getSprite("but_play"),f=CANVAS_WIDTH/2+210,h=CANVAS_HEIGHT+65,p=new CGfxButton(f,h,z,s_oStage),p.addEventListener(ON_MOUSE_UP,this._onButReset,this),p.setScalable(!1)):(z=s_oSpriteLibrary.getSprite("but_play"),
f=CANVAS_WIDTH/2+350,h=CANVAS_HEIGHT-10,p=new CGfxButton(f,h,z,s_oStage),p.addEventListener(ON_MOUSE_UP,this._onButPlayRelease,this),p.setScalable(!1),p.trembleAnimation());z=s_oSpriteLibrary.getSprite("but_info");c=z.height/2+10;e=z.height/2+10;A=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT-240,z,s_oStage);A.addEventListener(ON_MOUSE_UP,this._onCreditsBut,this);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)z=s_oSpriteLibrary.getSprite("audio_icon"),k=CANVAS_WIDTH-z.height/2-10,l=z.height/2+10,t=new CToggle(k,
l,z,s_bAudioActive,s_oStage),t.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);var z=window.document,F=z.documentElement;D=F.requestFullscreen||F.mozRequestFullScreen||F.webkitRequestFullScreen||F.msRequestFullscreen;B=z.exitFullscreen||z.mozCancelFullScreen||z.webkitExitFullscreen||z.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(D=!1);D&&!1===inIframe()&&(z=s_oSpriteLibrary.getSprite("but_fullscreen"),a=c+z.width/2+10,b=z.height/2+10,w=new CToggle(a,b,z,s_bFullscreen,s_oStage),w.addEventListener(ON_MOUSE_UP,
this._onFullscreenRelease,this));u=new createjs.Shape;u.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(u);createjs.Tween.get(u).to({alpha:0},1E3);s_bStorageAvailable||new CMsgBox(TEXT_ERR_LS,s_oStage);this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.refreshButtonPos=function(d,f){A.setPosition(c+d,f+e);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||t.setPosition(k-d,f+l);D&&!1===inIframe()&&w.setPosition(a+d,b+f)};this.unload=function(){p.unload();p=null;u.off("mousedown");
if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)t.unload(),t=null;D&&!1===inIframe()&&w.unload();s_oStage.removeAllChildren();s_oMenu=null};this._onAudioToggle=function(){createjs.Sound.setMute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onButPlayRelease=function(){var a=this;u.on("mousedown",function(){});createjs.Tween.get(u,{override:!0}).to({alpha:1},500).call(function(){a.unload();$(s_oMain).trigger("start_session");s_oMain.gotoLevelMenu()})};this._onButReset=function(){(new CAreYouSurePanel(s_oMenu.removeDataAndContinue)).changeMessage(TEXT_SAVE_REMOVE)};
this.removeDataAndContinue=function(){s_oLocalStorage.resetAllData();$(s_oMain).trigger("start_session");s_oMenu._onButPlayRelease()};this._onCreditsBut=function(){new CCreditsPanel};this._onFullscreenRelease=function(){s_bFullscreen?(B.call(window.document),s_bFullscreen=!1):(D.call(window.document.documentElement),s_bFullscreen=!0);sizeHandler()};s_oMenu=this;this._init()}var s_oMenu=null;
function CGame(a,b){var c,e,d,g,f,h,k,l,n,q,m,p,r,u=null,t,v,x,A,w=!1,D,B=!1,z,F,G,C,L,K,H,M,E,J,N=!1,P,Q,O=null,S,I,ba,R,V,X,aa,U,T,Y,fa,ka,ca,la,ha,ga;this._init=function(a){D=!1;S=!0;I=!1;ba=!0;l=!1;X=R=V=n=0;r=a;ga=1;U={x:0,y:0};J={x:0,y:0,z:0};E=new CScenario(r+1);$(s_oMain).trigger("start_level",r);O=camera=createOrthoGraphicCamera();resizeCanvas3D();0===r?!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(new createjs.Tween.get(s_oSoundTrack)).to({volume:.4},2E3):!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||
(new createjs.Tween.get(s_oSoundTrack)).to({volume:0},2E3);la=playSound("ambience",1,-1);K={x:0,y:0};H=!1;z=M=L=0;T=new createjs.Container;s_oStage.addChild(T);Y=new createjs.Container;s_oStage.addChild(Y);fa=new createjs.Container;s_oStage.addChild(fa);ka=new createjs.Container;s_oStage.addChild(ka);m=new CBackground(r,T);ca=new createjs.Shape;ca.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);ka.addChild(ca)};this.getCamera=function(){return O};this.get3DBall=function(){return E.ballBody()};
this.scenarioLoaded=function(){Q=0;l=!0};this.setBallSleep=function(a){(ba=a)?E.ballBody().sleep():E.ballBody().wakeUp()};this._init2DBall=function(){var a=s_oSpriteLibrary.getSprite("ball_shadow");aa=createBitmap(a);aa.regX=12;aa.regY=-5;aa.x=J.x;aa.y=J.y;T.addChild(aa);a=s_oSpriteLibrary.getSprite("ball");x=new CBall(J.x,J.y,a,T);J=convert3dPosTo2dScreen(E.ballBody().position,O);this.setBallSleep(!0)};this._initFlags=function(){p=new createjs.Container;T.addChild(p);for(var a=s_oSpriteLibrary.getSprite("flag"),
b=0;b<FLAGS_POS[r].length;b++){var c=createBitmap(a);c.regY=a.height;c.x=FLAGS_POS[r][b].x;c.y=FLAGS_POS[r][b].y;p.addChild(c)}};this.getLevel=function(){return r};this.resetDragForce=function(){!0===w&&(K={x:A.x,y:A.y});q.refreshPowerBar(0);w=!1};this.onCalculateForce=function(){if(SHOW_3D_RENDER)if(q.refreshPowerBar(0),!1===w||!0===C||K.x===J.x&&K.y===J.y)s_oGame.resetDragForce();else{var a=new CVector2(J.x-K.x,J.y-K.y);w=!1;a.scalarProduct(FORCE_MULTIPLIER);var b=a.length();b>HIT_BALL_MIN_FORCE&&
(b>HIT_BALL_MAX_FORCE&&(a.normalize(),a.scalarProduct(HIT_BALL_MAX_FORCE)),a.set(a.getX(),-a.getY()),a.rotate(Math.radians(45)),s_oGame.launchBall({x:a.getX(),y:a.getY()}),z++,q.refreshLaunch(z));K.x=0;K.y=0;s_oGame.clickBall(!1)}};this.onDragPoint=function(a){!C&&B&&A&&(K={x:a.clientX,y:a.clientY},w=!0)};this.onClickPoint=function(a){50>distance(a.clientX,a.clientY,J.x,J.y)&&(A={x:x.getX(),y:x.getY()},s_oGame.clickBall(!0))};this.unload=function(){l=!1;v&&(v.unload(),v=null);t&&(t.unload(),t=null);
s_oStage.removeAllChildren();q.unload();x.unload();null!==u&&u.unload();stopSound(la);$("html").off()};this.nextLevel=function(){r++;var a=s_oSpriteLibrary.getSprite("msg_box");r>=NUM_HOLES?(u=new CEndPanel(a,z),u.show(z,Math.floor(M),r)):(this.unload(),s_oMain.loadSelectedLevel(r))};this.angleArrow=function(){SHOW_3D_RENDER||(x.getX(),x.getY())};this.clickBall=function(a){B=a};this.launchBall=function(a){if(0===r&&0===z)x.setMoving(!0),(new CHelpPanel(fa)).stage2Help(a);else{this.setBallSleep(!1);
C=!0;var b=E.ballBody();f=b.position.x;h=b.position.y;k=b.position.z;E.addImpulse(b,a);z++;q.refreshLaunch(z)}};this.onExit=function(){P.unload();P.unloadLevel();$(s_oMain).trigger("share_event",n);$(s_oMain).trigger("end_level",r);$(s_oMain).trigger("end_session");setVolume(s_oSoundTrack,1);s_oMain.gotoMenu()};this._onExitHelp=function(){x.setVisible(!0);x.setMoving(!1);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(new createjs.Tween.get(s_oSoundTrack)).to({volume:0},1E3)};this._onExitHelp2=function(a){this.setBallSleep(!1);
C=!0;var b=E.ballBody();f=b.position.x;h=b.position.y;k=b.position.z;E.addImpulse(b,a);z++;q.refreshLaunch(z)};this.moveBall=function(){var a=J;x.setPosition(a.x,a.y)};this.levelComplete=function(){l=!1;$(s_oMain).trigger("end_level",r);var a=s_oSpriteLibrary.getSprite("msg_box");F=new CLevelCompletePanel(a);F.show(z,Math.floor(M),r)};this.unloadLevel=function(){C=!1};this.restartLevel=function(){$(s_oMain).trigger("restart_level",r);this.unload();this._init(r)};this.detectBallVelocityForLaunch=function(){if(!0===
C)G.x<MIN_VELOCITY_FOR_LAUNCH&&G.x>-MIN_VELOCITY_FOR_LAUNCH&&G.y<MIN_VELOCITY_FOR_LAUNCH&&G.y>-MIN_VELOCITY_FOR_LAUNCH&&G.z<MIN_VELOCITY_FOR_LAUNCH&&G.z>-MIN_VELOCITY_FOR_LAUNCH?0>L?(C=!1,x.setMoving(!1),H||x.pressIndicatorAnim(),E.setElementVelocity(E.ballBody(),{x:0,y:0,z:0}),E.ballBody().angularVelocity.setZero(),H||this.setBallSleep(!0)):L-=1/createjs.Ticker.framerate:L=TIME_FOR_LAUNCH;else if(G.x>MIN_VELOCITY_FOR_LAUNCH||G.x<-MIN_VELOCITY_FOR_LAUNCH)C=!0,L=TIME_FOR_LAUNCH};this.getBall=function(){return x};
this.getBallVelocity=function(){return G};this.getBallPhysics=function(){return _oBallPhysics};this.getBallInSand=function(){return N};this.ballCollideWithTerrain=function(a){R=E.ballBody().position.z;!S&&a&&(S=!0,(new createjs.Tween.get(aa,{override:!0})).to({alpha:1},100));S&&!a&&(S=!1,ba||(new createjs.Tween.get(aa,{override:!0})).to({alpha:0},100))};this.ballCollideWithSand=function(a){a&&!N?(playSound("sand",1,0),E.setElementLinearDamping(E.ballBody(),BALL_LINEAR_DAMPING_SAND)):!a&&N&&E.setElementLinearDamping(E.ballBody(),
BALL_LINEAR_DAMPING);N=a};this.ballCollideWithWater=function(a){H||(V=E.ballBody().position.z);(H=a)?(E.setElementLinearDamping(E.ballBody(),BALL_LINEAR_DAMPING_WATER),E.setGravity(-49.81),a=V-E.ballBody().position.z,x.setWaterMask(-(a/RESTART_WATER_DEPTH_VALUE)+1),a>RESTART_WATER_DEPTH_VALUE&&(E.setGravity(0),E.setElementVelocity(E.ballBody(),{x:0,y:0,z:0}),E.ballBody().force.setZero(),E.ballBody().torque.setZero(),E.ballBody().angularVelocity.setZero(),X+=1,60<X?this.repeatLastLaunch():1===X&&playSound("water",
1,0))):(E.setElementLinearDamping(E.ballBody(),BALL_LINEAR_DAMPING),E.setGravity(-98.1),x.setWaterMask(1),V=0)};this.ballCollideWithHole=function(a){D||(V=E.ballBody().position.z);D=a;var b=V-E.ballBody().position.z;a?(aa.visible=!1,x.setHoleMask(-(b/(HOLE_DEPTH_VALUE+5))+1),b>HOLE_DEPTH_VALUE&&(E.setGravity(0),E.setElementVelocity(E.ballBody(),{x:0,y:0,z:0}),playSound("hole",1,0),this.levelComplete())):(aa.visible=!0,3.5<b&&(playSound("hole",1,0),E.setGravity(0),E.setElementVelocity(E.ballBody(),
{x:0,y:0,z:0}),this.levelComplete()))};this._checkBallOutOfBorder=function(){if(-50>=E.ballBody().position.z&&!I){I=!0;var a=new createjs.Shape;a.graphics.beginFill("rgba(0,0,0,1)").r(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a.alpha=0;s_oStage.addChild(a);(new createjs.Tween.get(a)).to({alpha:1},500).call(function(){(new createjs.Tween.get(a)).to({alpha:0},500).call(function(){s_oStage.removeChild(a)});P.repeatLastLaunch()})}};this.repeatLastLaunch=function(){I=!1;x.blink();x.resetMask();X=0;x.pressIndicatorAnim();
this.centerBallView();q.setCenterBallViewVisible(!1);E.ballBody().force.setZero();E.ballBody().torque.setZero();E.ballBody().angularVelocity.setZero();E.setElementVelocity(E.ballBody(),{x:0,y:0,z:0});E.ballBody().position.set(f,h,k+15);this._updateBall2DPosition()};this._updateInit=function(){E.update();if(E.ballBody()){this._init2DBall();this._initFlags();q=new CInterface(Y);q.refreshHoleNum(r+1);q.setParText(PAR[r]);var a=new THREE.Vector3(START_CAMERA_POSITION.x+E.ballBody().position.x,START_CAMERA_POSITION.y+
E.ballBody().position.y,START_CAMERA_POSITION.z+E.ballBody().position.z);O.position.set(a.x,a.y,a.z);Q=1;var b=convert3dPosTo2dScreen({x:START_CAMERA_POSITION.x,y:START_CAMERA_POSITION.y,z:START_CAMERA_POSITION.z},O),f=convert3dPosTo2dScreen(O.position,O),a=b.x-f.x,b=b.y-f.y;m.setPos(CANVAS_WIDTH/2+a,CANVAS_HEIGHT/2+b);p.x=m.getPos().x;p.y=m.getPos().y;O.updateProjectionMatrix();O.updateMatrixWorld();c=m.getSize().width/2-CANVAS_WIDTH/2-a;e=-(m.getSize().width/2-CANVAS_WIDTH/2)-a;d=m.getSize().height/
2-CANVAS_HEIGHT/2-b;g=-(m.getSize().height/2-CANVAS_HEIGHT/2)-b;createjs.Tween.get(ca).wait(800).to({alpha:0},1300).call(function(){ga=.05;ca.visible=!1});0===r&&(new CHelpPanel(fa)).stage1Help()}};this._updatePlay=function(){l&&(E.update(),this._updateBall2DPosition(),this.moveBall(),this.angleArrow(),G=E.getBodyVelocity(E.ballBody()),this.detectBallVelocityForLaunch(),this._checkBallOutOfBorder())};this.update=function(){switch(Q){case 0:this._updateInit();break;case 1:this._updatePlay()}};this.setPanPoint=
function(a,b){var f=-J.x+CANVAS_WIDTH/2+U.x+a-T.x;T.x+f<c&&T.x+f>e&&(U.x+=a);f=-J.y+CANVAS_HEIGHT/2+U.y+b-T.y;T.y+f<d&&T.y+f>g&&(U.y+=b)};this.centerBallView=function(){U.x=0;U.y=0};this._updateBall2DPosition=function(){J=convert3dPosTo2dScreen(E.ballBody().position,O);var a={x:E.ballBody().position.x,y:E.ballBody().position.y,z:R},a=convert3dPosTo2dScreen(a,O);aa.x=a.x;aa.y=a.y;T.x+=(-J.x+CANVAS_WIDTH/2+U.x-T.x)*ga;T.x>c?T.x=c:T.x<e&&(T.x=e);T.y+=(-J.y+CANVAS_HEIGHT/2+U.y-T.y)*ga;T.y>d?T.y=d:T.y<
g&&(T.y=g)};this.panHelpAnim=function(){(new createjs.Tween.get(U,{loop:!0})).to({x:-500},700).to({x:0},700).to({y:-500},700).to({y:0},700);var a=s_oSpriteLibrary.getSprite("help_touch");ha=createBitmap(a);ha.x=300;ha.y=600;s_oStage.addChild(ha);(new createjs.Tween.get(ha,{loop:!0})).to({x:100},700).to({x:300},700).to({y:400},700).to({y:600},700)};this.stopPanAnim=function(){U.x=0;U.y=0;new createjs.Tween.removeTweens(U);s_oStage.removeChild(ha);new createjs.Tween.removeTweens(ha)};s_oGame=this;MAX_SHOT_POWER=
a.max_shot_power;160<MAX_SHOT_POWER&&(MAX_SHOT_POWER=160);PAR=a.stage_par;ENABLE_FULLSCREEN=a.fullscreen;P=this;this._init(b)}var s_oGame;
function CInterface(a){var b,c,e,d,g,f,h,k,l,n,q,m,p,r,u,t,v,x,A,w,D,B,z,F,G,C,L,K=null,H=null;this._init=function(a){p=CANVAS_WIDTH/2;r=72;G=new createjs.Text(TEXT_LAUNCH+": 0","40px "+PRIMARY_FONT,"#3e240b");G.x=p;G.y=r;G.outline=8;G.textAlign="center";G.textBaseline="alphabetic";a.addChild(G);A=new createjs.Text(TEXT_LAUNCH+": 0","40px "+PRIMARY_FONT,"#ffd800");A.x=p;A.y=r;A.textAlign="center";A.textBaseline="alphabetic";a.addChild(A);l=26;n=72;F=new createjs.Text(TEXT_PAR+": 0","40px "+PRIMARY_FONT,
"#3e240b");F.x=l;F.y=n;F.outline=8;F.textAlign="left";F.textBaseline="alphabetic";a.addChild(F);w=new createjs.Text(TEXT_PAR+": 0","40px "+PRIMARY_FONT,"#ffd800");w.x=l;w.y=n;w.textAlign="left";w.textBaseline="alphabetic";a.addChild(w);q=CANVAS_WIDTH-28;m=CANVAS_HEIGHT-35;C=new createjs.Text(TEXT_HOLE+": 1","40px "+PRIMARY_FONT,"#3e240b");C.x=q;C.y=m;C.outline=8;C.textAlign="right";C.textBaseline="alphabetic";a.addChild(C);D=new createjs.Text(TEXT_HOLE+": 1","40px "+PRIMARY_FONT,"#ffd800");D.x=q;
D.y=m;D.textAlign="right";D.textBaseline="alphabetic";a.addChild(D);var E=s_oSpriteLibrary.getSprite("but_exit");e=CANVAS_WIDTH-E.height/2-10;d=E.height/2+17;v=new CGfxButton(e,d,E,a);v.addEventListener(ON_MOUSE_UP,this._onExit,this);E=s_oSpriteLibrary.getSprite("but_restart_small");b=e-E.height-10;c=d;x=new CGfxButton(b,c,E,a);x.addEventListener(ON_MOUSE_UP,this._onRestart,this);!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(E=s_oSpriteLibrary.getSprite("audio_icon"),u=b-E.height-10,t=d,B=new CToggle(u,
t,E,s_bAudioActive,a),B.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this),g=u-E.width/2-10,f=t):(g=b-E.width/2-10,f=c);var E=window.document,M=E.documentElement;K=M.requestFullscreen||M.mozRequestFullScreen||M.webkitRequestFullScreen||M.msRequestFullscreen;H=E.exitFullscreen||E.mozCancelFullScreen||E.webkitExitFullscreen||E.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(K=!1);K&&!1===inIframe()&&(E=s_oSpriteLibrary.getSprite("but_fullscreen"),L=new CToggle(g,f,E,s_bFullscreen,a),L.addEventListener(ON_MOUSE_UP,
this._onFullscreenRelease,this));E=s_oSpriteLibrary.getSprite("but_center_view");h=E.height/2+10;k=CANVAS_HEIGHT-E.height/2-10;z=new CGfxButton(h,k,E,a);z.addEventListener(ON_MOUSE_UP,this._onCenterBall,this);z.setVisible(!1);this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.refreshButtonPos=function(a,p){v.setPosition(e-a,p+d);x.setPosition(b-a,p+c);z.setPosition(h+a,k-p);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||B.setPosition(u-a,p+t);K&&!1===inIframe()&&L.setPosition(g-a,f+p);A.y=r+p;G.y=A.y;
D.x=q-a;D.y=m-p;C.x=D.x;C.y=D.y;w.x=l+a;w.y=n+p;F.x=w.x;F.y=w.y};this.refreshPowerBar=function(a){(void 0).graphics.clear();a=Math.floor(a*(void 0).width/100);(void 0).graphics.beginFill("rgba(255,255,255,0.01)").drawRect((void 0).x,(void 0).y,a,(void 0).height)};this.unload=function(){v.unload();v=null;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)B.unload(),B=null;K&&!1===inIframe()&&L.unload();s_oInterface=null};this.refreshLaunch=function(a){A.text=TEXT_LAUNCH+": "+a;G.text=TEXT_LAUNCH+": "+a};
this.setParText=function(a){w.text=TEXT_PAR+": "+a;F.text=TEXT_PAR+": "+a};this.refreshHoleNum=function(a){D.text=TEXT_HOLE+": "+a;C.text=TEXT_HOLE+": "+a};this.setCenterBallViewVisible=function(a){z.setVisible(a)};this.onExitFromHelp=function(){(void 0).unload()};this._onAudioToggle=function(){createjs.Sound.setMute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){new CAreYouSurePanel(s_oGame.onExit)};this._onRestart=function(){s_oGame.restartLevel()};this._onCenterBall=function(){z.setVisible(!1);
s_oGame.centerBallView()};this._onFullscreenRelease=function(){s_bFullscreen?(H.call(window.document),s_bFullscreen=!1):(K.call(window.document.documentElement),s_bFullscreen=!0);sizeHandler()};s_oInterface=this;this._init(a);return this}var s_oInterface=null;
function CCreditsPanel(){var a,b,c,e;this._init=function(){a=new createjs.Shape;a.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a.alpha=0;a.on("mousedown",function(){});s_oStage.addChild(a);(new createjs.Tween.get(a)).to({alpha:.7},500);b=new createjs.Container;s_oStage.addChild(b);var d=s_oSpriteLibrary.getSprite("msg_box"),g=createBitmap(d);g.regX=d.width/2;g.regY=d.height/2;b.addChild(g);b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT/2;b.alpha=0;(new createjs.Tween.get(b)).to({alpha:1},
500);g=new createjs.Text(TEXT_DEVELOPED," 30px "+PRIMARY_FONT,"#3e240b");g.y=-d.height/2+175;g.textAlign="center";g.textBaseline="middle";g.lineWidth=500;g.outline=8;b.addChild(g);d=new createjs.Text(TEXT_DEVELOPED," 30px "+PRIMARY_FONT,"#ffd800");d.y=g.y;d.textAlign="center";d.textBaseline="middle";d.lineWidth=500;b.addChild(d);d=new createjs.Text("WWW.CODETHISLAB.COM"," 30px "+PRIMARY_FONT,"#3e240b");d.y=160;d.textAlign="center";d.textBaseline="middle";d.lineWidth=500;d.outline=8;b.addChild(d);
g=new createjs.Text("WWW.CODETHISLAB.COM"," 30px "+PRIMARY_FONT,"#ffd800");g.y=d.y;g.textAlign="center";g.textBaseline="middle";g.lineWidth=500;b.addChild(g);d=s_oSpriteLibrary.getSprite("ctl_logo");e=createBitmap(d);e.on("mousedown",this._onLogoButRelease);e.regX=d.width/2;e.regY=d.height/2;b.addChild(e);d=s_oSpriteLibrary.getSprite("but_exit");c=new CGfxButton(330,-200,d,b);c.addEventListener(ON_MOUSE_UP,this.unload,this)};this.unload=function(){c.setClickable(!1);(new createjs.Tween.get(a)).to({alpha:0},
500);(new createjs.Tween.get(b)).to({alpha:0},500).call(function(){s_oStage.removeChild(a);s_oStage.removeChild(b);c.unload()});a.off("mousedown",function(){});e.off("mousedown",this._onLogoButRelease)};this._onLogoButRelease=function(){window.open("http://www.codethislab.com/index.php?&l=en")};this._onMoreGamesReleased=function(){window.open("http://codecanyon.net/collections/5409142-games")};this._init()}
function CHelpPanel(a){var b,c,e,d,g,f;this._init=function(a){var f;f=s_bMobile?TEXT_HELP1_MOBILE:TEXT_HELP1_PC;c=new createjs.Text(f,"24px "+PRIMARY_FONT,"#3e240b");c.textAlign="center";c.lineWidth=500;c.textBaseline="alphabetic";c.outline=8;c.x=.5*CANVAS_WIDTH-200;c.y=.5*CANVAS_HEIGHT-180;b=new createjs.Text(f,"24px "+PRIMARY_FONT,"#ffd800");b.textAlign="center";b.lineWidth=500;b.textBaseline="alphabetic";b.x=c.x;b.y=c.y;d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,
CANVAS_HEIGHT);d.alpha=.7;e=new createjs.Container;e.x=0;e.y=0;e.addChild(d,c,b);a.addChild(e);s_oGame.getBall().setVisible(!1);a=s_oSpriteLibrary.getSprite("ball");g=new CBall(800,484,a,e);g.setHelpAnim();g.setMoving(!0)};this.unload=function(){a.removeChild(e);e.off("mousedown")};this.stage1Help=function(){var a=this;e.on("mousedown",function(){a._onExitHelp()})};this.stage2Help=function(a){c.text=TEXT_HELP2;b.text=TEXT_HELP2;c.visible=!1;b.visible=!1;e.off();s_oGame.getBall().setVisible(!0);g.unload();
d.alpha=0;createjs.Tween.get(d).to({alpha:.7},1E3).call(function(){c.visible=!0;b.visible=!0;e.on("mousedown",function(){f._onExitHelp2(a)});s_oGame.panHelpAnim()})};this._onExitHelp=function(){this.unload();s_oGame._onExitHelp()};this._onExitHelp2=function(a){this.unload();s_oGame.stopPanAnim();s_oGame._onExitHelp2(a)};f=this;this._init(a)}
function CEndPanel(a){var b,c,e,d,g,f;this._init=function(a){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(new createjs.Tween.get(s_oSoundTrack)).to({volume:1},1E3);f=new createjs.Shape;f.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);f.alpha=1;f.on("mousedown",function(){});s_oStage.addChild(f);b=createBitmap(a);b.regX=a.width/2;b.regY=a.height/2;b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT/2;e=new createjs.Text("","50px "+PRIMARY_FONT,"#3e240b");e.x=CANVAS_WIDTH/2;e.y=CANVAS_HEIGHT/
2-100;e.outline=10;e.textAlign="center";e.textBaseline="alphabetic";e.lineWidth=500;c=new createjs.Text("","50px "+PRIMARY_FONT,"#ffd800");c.x=e.x;c.y=e.y;c.textAlign="center";c.textBaseline="alphabetic";c.lineWidth=500;d=new createjs.Container;d.alpha=0;d.visible=!1;d.addChild(b,e,c);a=s_oSpriteLibrary.getSprite("but_home");g=new CGfxButton(.5*CANVAS_WIDTH,.5*CANVAS_HEIGHT+180,a,d);g.addEventListener(ON_MOUSE_DOWN,this._onExit,this);s_oStage.addChild(d);$(s_oMain).trigger("show_interlevel_ad")};
this.unload=function(){};this.show=function(a,b,g){e.text=TEXT_ALL_COMPLETE;c.text=TEXT_ALL_COMPLETE;d.visible=!0;createjs.Tween.get(d).to({alpha:1},500);createjs.Tween.get(f).to({alpha:.7},500)};this._onExit=function(){s_oStage.removeChild(d);g.unload();g=null;s_oGame.onExit()};this._init(a);return this}
function CAreYouSurePanel(a){var b,c,e,d,g,f,h;this._init=function(a){e=new createjs.Shape;e.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e.alpha=0;e.on("mousedown",function(){});s_oStage.addChild(e);(new createjs.Tween.get(e)).to({alpha:.7},500);f=new createjs.Container;s_oStage.addChild(f);a=s_oSpriteLibrary.getSprite("msg_box");var h=createBitmap(a);h.regX=a.width/2;h.regY=a.height/2;f.addChild(h);f.x=CANVAS_WIDTH/2;f.y=CANVAS_HEIGHT/2;f.alpha=0;(new createjs.Tween.get(f)).to({alpha:1},
500);d=new createjs.Text(TEXT_ARE_SURE," 30px "+PRIMARY_FONT,"#3e240b");d.y=-a.height/2+200;d.textAlign="center";d.textBaseline="middle";d.lineWidth=700;d.outline=8;f.addChild(d);g=new createjs.Text(TEXT_ARE_SURE," 30px "+PRIMARY_FONT,"#ffd800");g.y=d.y;g.textAlign="center";g.textBaseline="middle";g.lineWidth=d.lineWidth;f.addChild(g);b=new CGfxButton(110,180,s_oSpriteLibrary.getSprite("but_yes"),f);b.addEventListener(ON_MOUSE_UP,this._onButYes,this);c=new CGfxButton(-110,180,s_oSpriteLibrary.getSprite("but_not"),
f);c.addEventListener(ON_MOUSE_UP,this._onButNo,this);c.pulseAnimation()};this._onButYes=function(){c.setClickable(!1);b.setClickable(!1);(new createjs.Tween.get(e)).to({alpha:1},500);(new createjs.Tween.get(f)).to({alpha:0},500).call(function(){h.unload();a()})};this._onButNo=function(){c.setClickable(!1);b.setClickable(!1);(new createjs.Tween.get(e)).to({alpha:0},500);(new createjs.Tween.get(f)).to({alpha:0},500).call(function(){h.unload()})};this.unload=function(){c.unload();b.unload();s_oStage.removeChild(e);
s_oStage.removeChild(f);e.off("mousedown",function(){})};this.changeMessage=function(a){d.text=a;g.text=a};h=this;this._init(a)}var STAR_EFFECT_ALPHA=0,STAR_EFFECT_SCALE=1;
function CAchievementStars(a,b,c,e,d){var g,f,h,k,l;this._init=function(a,b,c,d,e){g=3;k=new createjs.Container;k.x=b;k.y=c;d.addChild(k);b=a.width/2;c=a.height;a=new createjs.SpriteSheet({images:[a],frames:{width:b,height:c,regX:b/2,regY:c/2},animations:{lit:[0],unlit:[1]}});f=[];for(c=0;c<g;c++)f[c]=createSprite(a,"unlit",0,0,0,0),f[c].x=-((g-1)*(b+0))/2+c*(b+0),k.addChild(f[c]);h=[];for(c=0;c<g;c++)h[c]=createSprite(a,"lit",0,0,0,0),h[c].x=-((g-1)*(b+0))/2+c*(b+0),h[c].scaleX=h[c].scaleY=0,h[c].alpha=
0,k.addChild(h[c]);h[1].y=-10;h[0].y=10;h[2].y=10;f[1].y=-10;f[0].y=10;f[2].y=10};this.unload=function(){for(var a=0;a<g;a++)new createjs.Tween.removeTweens(h[a]);e.removeChild(k)};this.getContainer=function(){return k};this.startLitStar=function(a){for(var b=0;b<a;b++)h[b].scaleX=h[b].scaleY=1,h[b].alpha=1};this.playSequentialMode=function(a,b,c){b/=a-1;switch(c){case STAR_EFFECT_SCALE:for(c=0;c<g;c++)h[c].alpha=1;for(c=0;c<a;c++)(new createjs.Tween.get(h[c])).wait(c*b).call(function(){l._playSound()}).to({scaleX:1,
scaleY:1},1500,createjs.Ease.elasticOut);break;case STAR_EFFECT_ALPHA:for(c=0;c<g;c++)h[c].scaleX=h[c].scaleY=1;for(c=0;c<a;c++)(new createjs.Tween.get(h[c])).wait(c*b).call(function(){l._playSound()}).to({alpha:1},750)}};this.playManualMode=function(a,b){switch(b){case STAR_EFFECT_SCALE:h[a].alpha=1;(new createjs.Tween.get(h[a])).to({scaleX:1,scaleY:1},1500,createjs.Ease.elasticOut);break;case STAR_EFFECT_ALPHA:h[a].scaleX=h[a].scaleY=1,(new createjs.Tween.get(h[a])).to({alpha:1},750)}this._playSound()};
this._playSound=function(){playSound(d,1,0)};l=this;this._init(a,b,c,e,d)}
function CLevelCompletePanel(a){var b,c,e,d,g,f,h,k,l,n,q,m,p,r,u,t,v;this._init=function(a){playSound("win_level",1,0);u=new createjs.Shape;u.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);u.alpha=0;u.on("mousedown",function(){});s_oStage.addChild(u);c=createBitmap(a);c.regX=a.width/2;c.regY=a.height/2;c.x=CANVAS_WIDTH/2;c.y=CANVAS_HEIGHT/2;n=new createjs.Text("","50px "+PRIMARY_FONT,"#3e240b");n.x=CANVAS_WIDTH/2;n.y=CANVAS_HEIGHT/2-80;n.outline=10;n.textAlign="center";n.textBaseline=
"alphabetic";l=new createjs.Text("","50px "+PRIMARY_FONT,"#ffd800");l.x=n.x;l.y=n.y;l.textAlign="center";l.textBaseline="alphabetic";h=new createjs.Text("","30px "+PRIMARY_FONT,"#3e240b");h.x=CANVAS_WIDTH/2;h.y=n.y+100;h.outline=10;h.textAlign="center";h.textBaseline="alphabetic";k=new createjs.Text("","30px "+PRIMARY_FONT,"#ffd800");k.x=CANVAS_WIDTH/2;k.y=h.y;k.textAlign="center";k.textBaseline="alphabetic";e=new createjs.Text("","30px "+PRIMARY_FONT,"#3e240b");e.x=CANVAS_WIDTH/2-140;e.y=n.y+160;
e.outline=10;e.textAlign="center";e.textBaseline="alphabetic";d=new createjs.Text("","30px "+PRIMARY_FONT,"#ffd800");d.x=e.x;d.y=e.y;d.textAlign="center";d.textBaseline="alphabetic";g=new createjs.Text("0","30px "+PRIMARY_FONT,"#3e240b");g.x=CANVAS_WIDTH/2+140;g.y=e.y;g.outline=10;g.textAlign="center";g.textBaseline="alphabetic";f=new createjs.Text("0","30px "+PRIMARY_FONT,"#ffd800");f.x=g.x;f.y=d.y;f.textAlign="center";f.textBaseline="alphabetic";q=new createjs.Container;q.alpha=0;q.visible=!1;q.addChild(c,
e,d,n,l,h,k,g,f);s_oStage.addChild(q);$(s_oMain).trigger("show_interlevel_ad")};this._unload=function(){createjs.Tween.get(q).to({alpha:0},300).call(function(){s_oStage.removeChild(q);u.off("mousedown",function(){});s_oStage.removeChild(u);p.unload();p=null;m.unload();m=null})};this.show=function(a,b,c){playSound("game_over",1,0);n.text=TEXT_COMPLETE;l.text=TEXT_COMPLETE;b=a-PAR[c];a=this._scoreType(b,a);h.text=a;k.text=a;e.text=TEXT_SCORE+": ";d.text=TEXT_SCORE+": ";a=this._calculateScore(b);q.visible=
!0;var x=this;createjs.Tween.get(q).to({alpha:1},500).call(function(){var a=s_oSpriteLibrary.getSprite("but_continue_big");m=new CGfxButton(.5*CANVAS_WIDTH+100,.5*CANVAS_HEIGHT+180,a,q);m.addEventListener(ON_MOUSE_DOWN,x._onNext,this);a=s_oSpriteLibrary.getSprite("but_restart_big");p=new CGfxButton(.5*CANVAS_WIDTH-100,.5*CANVAS_HEIGHT+180,a,q);p.addEventListener(ON_MOUSE_DOWN,x._onRestart,this)});createjs.Tween.get(u).to({alpha:.7},500);b=s_oSpriteLibrary.getSprite("star");t=new CAchievementStars(b,
CANVAS_WIDTH/2,CANVAS_HEIGHT/2-210,q,"star");v=new CRollingTextController(f,g,a,8E3,EASE_CUBIC_OUT);v.addEventListener(ON_CONTROLLER_END,r._onFinishRolling);v.addEventListener(ON_CONTROLLER_REMOVE,r._onFinishRolling);v.addRollingListener(r._onRollingText,r,[0,PAR_POINTS-ADDED_POINTS,PAR_POINTS]);this._sendScore(c,a)};this._scoreType=function(a,b){var c;switch(a){case -5:c=TEXT_PHOENIX;break;case -4:c=TEXT_CONDOR;break;case -3:c=TEXT_ALBATROSS;break;case -2:c=TEXT_EAGLE;break;case -1:c=TEXT_BIRDIE;
break;case 0:c=TEXT_PAR;break;case 1:c=TEXT_BOGEY;break;case 2:c=TEXT_DOUBLE_BOGEY;break;default:c=TEXT_BOGEY+" "+a}1===b&&(c=TEXT_HOLEINONE);return c};this._findMinimumScore=function(){for(var a=PAR_POINTS,b=0;0<a;)b++,a-=ADDED_POINTS;a+=ADDED_POINTS;return{score:a,iter:b}};this._calculateScore=function(a){var b=PAR_POINTS-a*ADDED_POINTS;0>=b&&(b=this._findMinimumScore(),b=Math.floor(b.score/(a-b.iter+1)));return b};this._sendScore=function(a,c){var d=s_oLocalStorage.getItemJson(LOCALSTORAGE_SCORE);
d[a]<c&&(d[a]=c,s_oLocalStorage.setItemJson(LOCALSTORAGE_SCORE,d));for(var e=b=0;e<d.length;e++)b+=d[e];$(s_oMain).trigger("save_score",b)};this._onNext=function(){createjs.Tween.get(u).to({alpha:1},300);createjs.Tween.get(q).to({alpha:0},300).wait(100).call(function(){s_oStage.removeChild(q);u.off("mousedown",function(){});s_oStage.removeChild(u);p.unload();p=null;m.unload();m=null;s_oGame.nextLevel()})};this._onRestart=function(){createjs.Tween.get(u).to({alpha:1},300);createjs.Tween.get(q).to({alpha:0},
300).wait(100).call(function(){s_oStage.removeChild(q);u.off("mousedown",function(){});s_oStage.removeChild(u);p.unload();p=null;m.unload();m=null;s_oGame.restartLevel()})};this._onFinishRolling=function(){};this._onRollingRemoved=function(){};this._onRollingText=function(a){t.playManualMode(a,STAR_EFFECT_SCALE)};r=this;this._init(a);return this}
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self);b.CANNON=a()}}(function(){return function b(c,e,d){function g(h,l){if(!e[h]){if(!c[h]){var k="function"==typeof require&&require;if(!l&&k)return k(h,!0);if(f)return f(h,!0);throw Error("Cannot find module '"+h+"'");}k=e[h]={exports:{}};c[h][0].call(k.exports,function(b){var d=c[h][1][b];return g(d?
d:b)},k,k.exports,b,c,e,d)}return e[h].exports}for(var f="function"==typeof require&&require,h=0;h<d.length;h++)g(d[h]);return g}({1:[function(b,c,e){c.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},
bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(b,c,e){c.exports={version:b("../package.json").version,AABB:b("./collision/AABB"),ArrayCollisionMatrix:b("./collision/ArrayCollisionMatrix"),
Body:b("./objects/Body"),Box:b("./shapes/Box"),Broadphase:b("./collision/Broadphase"),Constraint:b("./constraints/Constraint"),ContactEquation:b("./equations/ContactEquation"),Narrowphase:b("./world/Narrowphase"),ConeTwistConstraint:b("./constraints/ConeTwistConstraint"),ContactMaterial:b("./material/ContactMaterial"),ConvexPolyhedron:b("./shapes/ConvexPolyhedron"),Cylinder:b("./shapes/Cylinder"),DistanceConstraint:b("./constraints/DistanceConstraint"),Equation:b("./equations/Equation"),EventTarget:b("./utils/EventTarget"),
FrictionEquation:b("./equations/FrictionEquation"),GSSolver:b("./solver/GSSolver"),GridBroadphase:b("./collision/GridBroadphase"),Heightfield:b("./shapes/Heightfield"),HingeConstraint:b("./constraints/HingeConstraint"),LockConstraint:b("./constraints/LockConstraint"),Mat3:b("./math/Mat3"),Material:b("./material/Material"),NaiveBroadphase:b("./collision/NaiveBroadphase"),ObjectCollisionMatrix:b("./collision/ObjectCollisionMatrix"),Pool:b("./utils/Pool"),Particle:b("./shapes/Particle"),Plane:b("./shapes/Plane"),
PointToPointConstraint:b("./constraints/PointToPointConstraint"),Quaternion:b("./math/Quaternion"),Ray:b("./collision/Ray"),RaycastVehicle:b("./objects/RaycastVehicle"),RaycastResult:b("./collision/RaycastResult"),RigidVehicle:b("./objects/RigidVehicle"),RotationalEquation:b("./equations/RotationalEquation"),RotationalMotorEquation:b("./equations/RotationalMotorEquation"),SAPBroadphase:b("./collision/SAPBroadphase"),SPHSystem:b("./objects/SPHSystem"),Shape:b("./shapes/Shape"),Solver:b("./solver/Solver"),
Sphere:b("./shapes/Sphere"),SplitSolver:b("./solver/SplitSolver"),Spring:b("./objects/Spring"),Trimesh:b("./shapes/Trimesh"),Vec3:b("./math/Vec3"),Vec3Pool:b("./utils/Vec3Pool"),World:b("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,
"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,
"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(b,c,e){function d(b){b=b||{};
this.lowerBound=new g;b.lowerBound&&this.lowerBound.copy(b.lowerBound);this.upperBound=new g;b.upperBound&&this.upperBound.copy(b.upperBound)}var g=b("../math/Vec3");b("../utils/Utils");c.exports=d;var f=new g;d.prototype.setFromPoints=function(b,c,d,e){var g=this.lowerBound,h=this.upperBound;g.copy(b[0]);d&&d.vmult(g,g);h.copy(g);for(var k=1;k<b.length;k++){var l=b[k];d&&(d.vmult(l,f),l=f);l.x>h.x&&(h.x=l.x);l.x<g.x&&(g.x=l.x);l.y>h.y&&(h.y=l.y);l.y<g.y&&(g.y=l.y);l.z>h.z&&(h.z=l.z);l.z<g.z&&(g.z=
l.z)}c&&(c.vadd(g,g),c.vadd(h,h));e&&(g.x-=e,g.y-=e,g.z-=e,h.x+=e,h.y+=e,h.z+=e);return this};d.prototype.copy=function(b){this.lowerBound.copy(b.lowerBound);this.upperBound.copy(b.upperBound);return this};d.prototype.clone=function(){return(new d).copy(this)};d.prototype.extend=function(b){var c=b.lowerBound.x;this.lowerBound.x>c&&(this.lowerBound.x=c);c=b.upperBound.x;this.upperBound.x<c&&(this.upperBound.x=c);c=b.lowerBound.y;this.lowerBound.y>c&&(this.lowerBound.y=c);c=b.upperBound.y;this.upperBound.y<
c&&(this.upperBound.y=c);c=b.lowerBound.z;this.lowerBound.z>c&&(this.lowerBound.z=c);c=b.upperBound.z;this.upperBound.z<c&&(this.upperBound.z=c)};d.prototype.overlaps=function(b){var c=this.lowerBound,d=this.upperBound,e=b.lowerBound;b=b.upperBound;return(e.x<=d.x&&d.x<=b.x||c.x<=b.x&&b.x<=d.x)&&(e.y<=d.y&&d.y<=b.y||c.y<=b.y&&b.y<=d.y)&&(e.z<=d.z&&d.z<=b.z||c.z<=b.z&&b.z<=d.z)};d.prototype.contains=function(b){var c=this.lowerBound,d=this.upperBound,e=b.lowerBound;b=b.upperBound;return c.x<=e.x&&
d.x>=b.x&&c.y<=e.y&&d.y>=b.y&&c.z<=e.z&&d.z>=b.z};d.prototype.getCorners=function(b,c,d,e,f,g,h,u){var m=this.lowerBound,l=this.upperBound;b.copy(m);c.set(l.x,m.y,m.z);d.set(l.x,l.y,m.z);e.set(m.x,l.y,l.z);f.set(l.x,m.y,m.z);g.set(m.x,l.y,m.z);h.set(m.x,m.y,l.z);u.copy(l)};var h=[new g,new g,new g,new g,new g,new g,new g,new g];d.prototype.toLocalFrame=function(b,c){this.getCorners(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7]);for(var d=0;8!==d;d++){var e=h[d];b.pointToLocal(e,e)}return c.setFromPoints(h)};
d.prototype.toWorldFrame=function(b,c){this.getCorners(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7]);for(var d=0;8!==d;d++){var e=h[d];b.pointToWorld(e,e)}return c.setFromPoints(h)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(b,c,e){function d(){this.matrix=[]}c.exports=d;d.prototype.get=function(b,c){b=b.index;c=c.index;if(c>b){var d=c;c=b;b=d}return this.matrix[(b*(b+1)>>1)+c-1]};d.prototype.set=function(b,c,d){b=b.index;c=c.index;if(c>b){var e=c;c=b;b=e}this.matrix[(b*(b+1)>>1)+c-1]=d?1:0};
d.prototype.reset=function(){for(var b=0,c=this.matrix.length;b!==c;b++)this.matrix[b]=0};d.prototype.setNumObjects=function(b){this.matrix.length=b*(b-1)>>1}},{}],5:[function(b,c,e){function d(){this.world=null;this.useBoundingBoxes=!1;this.dirty=!0}var g=b("../objects/Body");e=b("../math/Vec3");var f=b("../math/Quaternion");b("../shapes/Shape");b("../shapes/Plane");c.exports=d;d.prototype.collisionPairs=function(b,c,d){throw Error("collisionPairs not implemented for this BroadPhase class!");};var h=
g.STATIC|g.KINEMATIC;d.prototype.needBroadphaseCollision=function(b,c){return 0!==(b.collisionFilterGroup&c.collisionFilterMask)&&0!==(c.collisionFilterGroup&b.collisionFilterMask)&&(0===(b.type&h)&&b.sleepState!==g.SLEEPING||0===(c.type&h)&&c.sleepState!==g.SLEEPING)?!0:!1};d.prototype.intersectionTest=function(b,c,d,e){this.useBoundingBoxes?this.doBoundingBoxBroadphase(b,c,d,e):this.doBoundingSphereBroadphase(b,c,d,e)};var k=new e;new e;new f;new e;d.prototype.doBoundingSphereBroadphase=function(b,
c,d,e){c.position.vsub(b.position,k);var f=Math.pow(b.boundingRadius+c.boundingRadius,2);k.norm2()<f&&(d.push(b),e.push(c))};d.prototype.doBoundingBoxBroadphase=function(b,c,d,e){b.aabbNeedsUpdate&&b.computeAABB();c.aabbNeedsUpdate&&c.computeAABB();b.aabb.overlaps(c.aabb)&&(d.push(b),e.push(c))};var l={keys:[]},n=[],q=[];d.prototype.makePairsUnique=function(b,c){for(var d=b.length,e=0;e!==d;e++)n[e]=b[e],q[e]=c[e];b.length=0;for(e=c.length=0;e!==d;e++){var f=n[e].id,g=q[e].id,f=f<g?f+","+g:g+","+
f;l[f]=e;l.keys.push(f)}for(e=0;e!==l.keys.length;e++)f=l.keys.pop(),d=l[f],b.push(n[d]),c.push(q[d]),delete l[f]};d.prototype.setWorld=function(b){};var m=new e;d.boundingSphereCheck=function(b,c){b.position.vsub(c.position,m);return Math.pow(b.shape.boundingSphereRadius+c.shape.boundingSphereRadius,2)>m.norm2()};d.prototype.aabbQuery=function(b,c,d){console.warn(".aabbQuery is not implemented in this Broadphase subclass.");return[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,
"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(b,c,e){function d(b,c,d,e,h){g.apply(this);this.nx=d||10;this.ny=e||10;this.nz=h||10;this.aabbMin=b||new f(100,100,100);this.aabbMax=c||new f(-100,-100,-100);b=this.nx*this.ny*this.nz;if(0>=b)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[];this.binLengths=[];this.bins.length=b;this.binLengths.length=b;for(c=0;c<b;c++)this.bins[c]=[],this.binLengths[c]=0}c.exports=d;var g=b("./Broadphase"),f=b("../math/Vec3"),h=b("../shapes/Shape");
d.prototype=new g;d.prototype.constructor=d;var k=new f;new f;d.prototype.collisionPairs=function(b,c,d){function e(b,c,d,e,f,g,h){b=(b-F)*L|0;c=(c-G)*K|0;d=(d-C)*H|0;e=O((e-F)*L);f=O((f-G)*K);g=O((g-C)*H);0>b?b=0:b>=q&&(b=q-1);0>c?c=0:c>=n&&(c=n-1);0>d?d=0:d>=x&&(d=x-1);0>e?e=0:e>=q&&(e=q-1);0>f?f=0:f>=n&&(f=n-1);0>g?g=0:g>=x&&(g=x-1);b*=A;c*=w;d*=1;e*=A;f*=w;for(g*=1;b<=e;b+=A)for(var m=c;m<=f;m+=w)for(var l=d;l<=g;l+=1){var k=b+m+l;P[k][Q[k]++]=h}}var f=b.numObjects();b=b.bodies;for(var g=this.aabbMax,
l=this.aabbMin,q=this.nx,n=this.ny,x=this.nz,A=n*x,w=x,D=g.x,B=g.y,z=g.z,F=l.x,G=l.y,C=l.z,L=q/(D-F),K=n/(B-G),H=x/(z-C),D=(D-F)/q,M=(B-G)/n,z=(z-C)/x,E=.5*Math.sqrt(D*D+M*M+z*z),B=h.types,J=B.SPHERE,N=B.PLANE,P=this.bins,Q=this.binLengths,B=this.bins.length,l=0;l!==B;l++)Q[l]=0;for(var O=Math.ceil,l=Math.min,g=Math.max,l=0;l!==f;l++){var g=b[l],S=g.shape;switch(S.type){case J:var I=g.position.x,ba=g.position.y,R=g.position.z,S=S.radius;e(I-S,ba-S,R-S,I+S,ba+S,R+S,g);break;case N:S.worldNormalNeedsUpdate&&
S.computeWorldNormal(g.quaternion);var R=S.worldNormal,S=G+.5*M-g.position.y,V=C+.5*z-g.position.z,X=k;X.set(F+.5*D-g.position.x,S,V);for(var aa=I=0;I!==q;I++,aa+=A,X.y=S,X.x+=D)for(var U=ba=0;ba!==n;ba++,U+=w,X.z=V,X.y+=M)for(var T=0,Y=0;T!==x;T++,Y+=1,X.z+=z)if(X.dot(R)<E){var fa=aa+U+Y;P[fa][Q[fa]++]=g}break;default:g.aabbNeedsUpdate&&g.computeAABB(),e(g.aabb.lowerBound.x,g.aabb.lowerBound.y,g.aabb.lowerBound.z,g.aabb.upperBound.x,g.aabb.upperBound.y,g.aabb.upperBound.z,g)}}for(l=0;l!==B;l++)if(f=
Q[l],1<f)for(b=P[l],I=0;I!==f;I++)for(g=b[I],ba=0;ba!==I;ba++)D=b[ba],this.needBroadphaseCollision(g,D)&&this.intersectionTest(g,D,c,d);this.makePairsUnique(c,d)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(b,c,e){function d(){g.apply(this)}c.exports=d;var g=b("./Broadphase");b=b("./AABB");d.prototype=new g;d.prototype.constructor=d;d.prototype.collisionPairs=function(b,c,d){b=b.bodies;var e=b.length,f,g,h,k;for(f=0;f!==e;f++)for(g=0;g!==f;g++)h=b[f],k=b[g],this.needBroadphaseCollision(h,
k)&&this.intersectionTest(h,k,c,d)};new b;d.prototype.aabbQuery=function(b,c,d){d=d||[];for(var e=0;e<b.bodies.length;e++){var f=b.bodies[e];f.aabbNeedsUpdate&&f.computeAABB();f.aabb.overlaps(c)&&d.push(f)}return d}},{"./AABB":3,"./Broadphase":5}],8:[function(b,c,e){function d(){this.matrix={}}c.exports=d;d.prototype.get=function(b,c){b=b.id;c=c.id;if(c>b){var d=c;c=b;b=d}return b+"-"+c in this.matrix};d.prototype.set=function(b,c,d){b=b.id;c=c.id;if(c>b){var e=c;c=b;b=e}d?this.matrix[b+"-"+c]=!0:
delete this.matrix[b+"-"+c]};d.prototype.reset=function(){this.matrix={}};d.prototype.setNumObjects=function(b){}},{}],9:[function(b,c,e){function d(b,c){this.from=b?b.clone():new f;this.to=c?c.clone():new f;this._direction=new f;this.precision=1E-4;this.checkCollisionResponse=!0;this.skipBackfaces=!1;this.collisionFilterGroup=this.collisionFilterMask=-1;this.mode=d.ANY;this.result=new k;this.hasHit=!1;this.callback=function(b){}}function g(b,c,d,e){e.vsub(c,J);d.vsub(c,q);b.vsub(c,m);b=J.dot(J);
c=J.dot(q);d=J.dot(m);e=q.dot(q);var f=q.dot(m),g,h;return 0<=(g=e*d-c*f)&&0<=(h=b*f-c*d)&&g+h<b*e-c*c}c.exports=d;var f=b("../math/Vec3");c=b("../math/Quaternion");var h=b("../math/Transform");b("../shapes/ConvexPolyhedron");b("../shapes/Box");var k=b("../collision/RaycastResult");e=b("../shapes/Shape");b=b("../collision/AABB");d.prototype.constructor=d;d.CLOSEST=1;d.ANY=2;d.ALL=4;var l=new b,n=[];d.prototype.intersectWorld=function(b,c){this.mode=c.mode||d.ANY;this.result=c.result||new k;this.skipBackfaces=
!!c.skipBackfaces;this.collisionFilterMask="undefined"!==typeof c.collisionFilterMask?c.collisionFilterMask:-1;this.collisionFilterGroup="undefined"!==typeof c.collisionFilterGroup?c.collisionFilterGroup:-1;c.from&&this.from.copy(c.from);c.to&&this.to.copy(c.to);this.callback=c.callback||function(){};this.hasHit=!1;this.result.reset();this._updateDirection();this.getAABB(l);n.length=0;b.broadphase.aabbQuery(b,l,n);this.intersectBodies(n);return this.hasHit};var q=new f,m=new f;d.pointInTriangle=g;
var p=new f,r=new c;d.prototype.intersectBody=function(b,c){c&&(this.result=c,this._updateDirection());var d=this.checkCollisionResponse;if((!d||b.collisionResponse)&&0!==(this.collisionFilterGroup&b.collisionFilterMask)&&0!==(b.collisionFilterGroup&this.collisionFilterMask))for(var e=0,f=b.shapes.length;e<f;e++){var g=b.shapes[e];if(!d||g.collisionResponse)if(b.quaternion.mult(b.shapeOrientations[e],r),b.quaternion.vmult(b.shapeOffsets[e],p),p.vadd(b.position,p),this.intersectShape(g,r,p,b),this.result._shouldStop)break}};
d.prototype.intersectBodies=function(b,c){c&&(this.result=c,this._updateDirection());for(var d=0,e=b.length;!this.result._shouldStop&&d<e;d++)this.intersectBody(b[d])};d.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction);this._direction.normalize()};d.prototype.intersectShape=function(b,c,d,e){var f=this.from,g=this._direction;d.vsub(f,J);var h=J.dot(g);g.mult(h,N);N.vadd(f,N);d.distanceTo(N)>b.boundingSphereRadius||(f=this[b.type])&&f.call(this,b,c,d,e)};new f;new f;var u=
new f,t=new f,v=new f,x=new f;new f;new k;d.prototype.intersectBox=function(b,c,d,e){return this.intersectConvex(b.convexPolyhedronRepresentation,c,d,e)};d.prototype[e.types.BOX]=d.prototype.intersectBox;d.prototype.intersectPlane=function(b,c,d,e){var g=this.from,h=this.to,m=this._direction,l=new f(0,0,1);c.vmult(l,l);var k=new f;g.vsub(d,k);c=k.dot(l);h.vsub(d,k);k=k.dot(l);if(!(0<c*k||g.distanceTo(h)<c||(k=l.dot(m),Math.abs(k)<this.precision))){var p=new f,h=new f;c=new f;g.vsub(d,p);d=-l.dot(p)/
k;m.scale(d,h);g.vadd(h,c);this.reportIntersection(l,c,b,e,-1)}};d.prototype[e.types.PLANE]=d.prototype.intersectPlane;d.prototype.getAABB=function(b){var c=this.to,d=this.from;b.lowerBound.x=Math.min(c.x,d.x);b.lowerBound.y=Math.min(c.y,d.y);b.lowerBound.z=Math.min(c.z,d.z);b.upperBound.x=Math.max(c.x,d.x);b.upperBound.y=Math.max(c.y,d.y);b.upperBound.z=Math.max(c.z,d.z)};var A={faceList:[0]};d.prototype.intersectHeightfield=function(b,c,e,g){var m=new f,l=new d(this.from,this.to);h.pointToLocalFrame(e,
c,l.from,l.from);h.pointToLocalFrame(e,c,l.to,l.to);var k=[],p=null,q=null,r=null,n=null,u=b.getIndexOfPosition(l.from.x,l.from.y,k,!1);u&&(p=k[0],q=k[1],r=k[0],n=k[1]);if(u=b.getIndexOfPosition(l.to.x,l.to.y,k,!1)){if(null===p||k[0]<p)p=k[0];if(null===r||k[0]>r)r=k[0];if(null===q||k[1]<q)q=k[1];if(null===n||k[1]>n)n=k[1]}if(null!==p)for(b.getRectMinMax(p,q,r,n,[]),l=p;l<=r;l++)for(k=q;k<=n;k++){if(this.result._shouldStop)return;b.getConvexTrianglePillar(l,k,!1);h.pointToWorldFrame(e,c,b.pillarOffset,
m);this.intersectConvex(b.pillarConvex,c,m,g,A);if(this.result._shouldStop)return;b.getConvexTrianglePillar(l,k,!0);h.pointToWorldFrame(e,c,b.pillarOffset,m);this.intersectConvex(b.pillarConvex,c,m,g,A)}};d.prototype[e.types.HEIGHTFIELD]=d.prototype.intersectHeightfield;var w=new f,D=new f;d.prototype.intersectSphere=function(b,c,d,e){c=this.from;var f=this.to,g=Math.pow(f.x-c.x,2)+Math.pow(f.y-c.y,2)+Math.pow(f.z-c.z,2),h=2*((f.x-c.x)*(c.x-d.x)+(f.y-c.y)*(c.y-d.y)+(f.z-c.z)*(c.z-d.z)),m=Math.pow(h,
2)-4*g*(Math.pow(c.x-d.x,2)+Math.pow(c.y-d.y,2)+Math.pow(c.z-d.z,2)-Math.pow(b.radius,2));if(!(0>m))if(0===m)c.lerp(f,m,w),w.vsub(d,D),D.normalize(),this.reportIntersection(D,w,b,e,-1);else{var l=(-h-Math.sqrt(m))/(2*g),g=(-h+Math.sqrt(m))/(2*g);0<=l&&1>=l&&(c.lerp(f,l,w),w.vsub(d,D),D.normalize(),this.reportIntersection(D,w,b,e,-1));!this.result._shouldStop&&0<=g&&1>=g&&(c.lerp(f,g,w),w.vsub(d,D),D.normalize(),this.reportIntersection(D,w,b,e,-1))}};d.prototype[e.types.SPHERE]=d.prototype.intersectSphere;
var B=new f;new f;new f;var z=new f;d.prototype.intersectConvex=function(b,c,d,e,f){f=f&&f.faceList||null;for(var h=b.faces,m=b.vertices,l=b.faceNormals,k=this._direction,p=this.from,q=p.distanceTo(this.to),r=f?f.length:h.length,n=this.result,w=0;!n._shouldStop&&w<r;w++){var A=f?f[w]:w,K=h[A],D=l[A],G=c,C=d;z.copy(m[K[0]]);G.vmult(z,z);z.vadd(C,z);z.vsub(p,z);G.vmult(D,B);D=k.dot(B);if(!(Math.abs(D)<this.precision||(D=B.dot(z)/D,0>D)))for(k.mult(D,u),u.vadd(p,u),t.copy(m[K[0]]),G.vmult(t,t),C.vadd(t,
t),D=1;!n._shouldStop&&D<K.length-1;D++){v.copy(m[K[D]]);x.copy(m[K[D+1]]);G.vmult(v,v);G.vmult(x,x);C.vadd(v,v);C.vadd(x,x);var N=u.distanceTo(p);!g(u,t,v,x)&&!g(u,v,t,x)||N>q||this.reportIntersection(B,u,b,e,A)}}};d.prototype[e.types.CONVEXPOLYHEDRON]=d.prototype.intersectConvex;var F=new f,G=new f,C=new f,L=new f,K=new f,H=new f;new b;var M=[],E=new h;d.prototype.intersectTrimesh=function(b,c,d,e,f){f=b.indices;var m=this.from,l=this.to,k=this._direction;E.position.copy(d);E.quaternion.copy(c);
h.vectorToLocalFrame(d,c,k,G);h.pointToLocalFrame(d,c,m,C);h.pointToLocalFrame(d,c,l,L);m=C.distanceSquared(L);b.tree.rayQuery(this,E,M);l=0;for(k=M.length;!this.result._shouldStop&&l!==k;l++){var p=M[l];b.getNormal(p,F);b.getVertex(f[3*p],t);t.vsub(C,z);var q=G.dot(F),q=F.dot(z)/q;0>q||(G.scale(q,u),u.vadd(C,u),b.getVertex(f[3*p+1],v),b.getVertex(f[3*p+2],x),q=u.distanceSquared(C),!g(u,v,t,x)&&!g(u,t,v,x)||q>m||(h.vectorToWorldFrame(c,F,K),h.pointToWorldFrame(d,c,u,H),this.reportIntersection(K,H,
b,e,p)))}M.length=0};d.prototype[e.types.TRIMESH]=d.prototype.intersectTrimesh;d.prototype.reportIntersection=function(b,c,e,f,g){var h=this.from,m=this.to,l=h.distanceTo(c),k=this.result;if(!(this.skipBackfaces&&0<b.dot(this._direction)))switch(k.hitFaceIndex="undefined"!==typeof g?g:-1,this.mode){case d.ALL:this.hasHit=!0;k.set(h,m,b,c,e,f,l);k.hasHit=!0;this.callback(k);break;case d.CLOSEST:if(l<k.distance||!k.hasHit)this.hasHit=!0,k.hasHit=!0,k.set(h,m,b,c,e,f,l);break;case d.ANY:this.hasHit=
!0,k.hasHit=!0,k.set(h,m,b,c,e,f,l),k._shouldStop=!0}};var J=new f,N=new f},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(b,c,e){function d(){this.rayFromWorld=new g;this.rayToWorld=new g;this.hitNormalWorld=new g;this.hitPointWorld=new g;this.hasHit=!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1}var g=
b("../math/Vec3");c.exports=d;d.prototype.reset=function(){this.rayFromWorld.setZero();this.rayToWorld.setZero();this.hitNormalWorld.setZero();this.hitPointWorld.setZero();this.hasHit=!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1};d.prototype.abort=function(){this._shouldStop=!0};d.prototype.set=function(b,c,d,e,g,q,m){this.rayFromWorld.copy(b);this.rayToWorld.copy(c);this.hitNormalWorld.copy(d);this.hitPointWorld.copy(e);this.shape=g;this.body=q;this.distance=
m}},{"../math/Vec3":30}],11:[function(b,c,e){function d(b){g.apply(this);this.axisList=[];this.world=null;this.axisIndex=0;var c=this.axisList;this._addBodyHandler=function(b){c.push(b.body)};this._removeBodyHandler=function(b){b=c.indexOf(b.body);-1!==b&&c.splice(b,1)};b&&this.setWorld(b)}b("../shapes/Shape");var g=b("../collision/Broadphase");c.exports=d;d.prototype=new g;d.prototype.setWorld=function(b){for(var c=this.axisList.length=0;c<b.bodies.length;c++)this.axisList.push(b.bodies[c]);b.removeEventListener("addBody",
this._addBodyHandler);b.removeEventListener("removeBody",this._removeBodyHandler);b.addEventListener("addBody",this._addBodyHandler);b.addEventListener("removeBody",this._removeBodyHandler);this.world=b;this.dirty=!0};d.insertionSortX=function(b){for(var c=1,d=b.length;c<d;c++){for(var e=b[c],f=c-1;0<=f&&!(b[f].aabb.lowerBound.x<=e.aabb.lowerBound.x);f--)b[f+1]=b[f];b[f+1]=e}return b};d.insertionSortY=function(b){for(var c=1,d=b.length;c<d;c++){for(var e=b[c],f=c-1;0<=f&&!(b[f].aabb.lowerBound.y<=
e.aabb.lowerBound.y);f--)b[f+1]=b[f];b[f+1]=e}return b};d.insertionSortZ=function(b){for(var c=1,d=b.length;c<d;c++){for(var e=b[c],f=c-1;0<=f&&!(b[f].aabb.lowerBound.z<=e.aabb.lowerBound.z);f--)b[f+1]=b[f];b[f+1]=e}return b};d.prototype.collisionPairs=function(b,c,e){b=this.axisList;var f=b.length,g=this.axisIndex,h,m;this.dirty&&(this.sortList(),this.dirty=!1);for(h=0;h!==f;h++){var k=b[h];for(m=h+1;m<f;m++){var r=b[m];if(this.needBroadphaseCollision(k,r)){if(!d.checkBounds(k,r,g))break;this.intersectionTest(k,
r,c,e)}}}};d.prototype.sortList=function(){for(var b=this.axisList,c=this.axisIndex,e=b.length,g=0;g!==e;g++){var n=b[g];n.aabbNeedsUpdate&&n.computeAABB()}0===c?d.insertionSortX(b):1===c?d.insertionSortY(b):2===c&&d.insertionSortZ(b)};d.checkBounds=function(b,c,d){var e,f;0===d?(e=b.position.x,f=c.position.x):1===d?(e=b.position.y,f=c.position.y):2===d&&(e=b.position.z,f=c.position.z);return f-c.boundingRadius<e+b.boundingRadius};d.prototype.autoDetectAxis=function(){for(var b=0,c=0,d=0,e=0,g=0,
q=0,m=this.axisList,p=m.length,r=1/p,u=0;u!==p;u++)var t=m[u],v=t.position.x,b=b+v,c=c+v*v,v=t.position.y,d=d+v,e=e+v*v,t=t.position.z,g=g+t,q=q+t*t;b=c-b*b*r;d=e-d*d*r;g=q-g*g*r;this.axisIndex=b>d?b>g?0:2:d>g?1:2};d.prototype.aabbQuery=function(b,c,d){d=d||[];this.dirty&&(this.sortList(),this.dirty=!1);b=this.axisList;for(var e=0;e<b.length;e++){var f=b[e];f.aabbNeedsUpdate&&f.computeAABB();f.aabb.overlaps(c)&&d.push(f)}return d}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(b,
c,e){function d(b,c,d){d=d||{};var e="undefined"!==typeof d.maxForce?d.maxForce:1E6,l=d.pivotA?d.pivotA.clone():new k,q=d.pivotB?d.pivotB.clone():new k;this.axisA=d.axisA?d.axisA.clone():new k;this.axisB=d.axisB?d.axisB.clone():new k;g.call(this,b,l,c,q,e);this.collideConnected=!!d.collideConnected;this.angle="undefined"!==typeof d.angle?d.angle:0;l=this.coneEquation=new f(b,c,d);b=this.twistEquation=new h(b,c,d);this.twistAngle="undefined"!==typeof d.twistAngle?d.twistAngle:0;l.maxForce=0;l.minForce=
-e;b.maxForce=0;b.minForce=-e;this.equations.push(l,b)}c.exports=d;b("./Constraint");var g=b("./PointToPointConstraint"),f=b("../equations/ConeEquation"),h=b("../equations/RotationalEquation");b("../equations/ContactEquation");var k=b("../math/Vec3");d.prototype=new g;d.constructor=d;new k;new k;d.prototype.update=function(){var b=this.bodyA,c=this.bodyB,d=this.coneEquation,e=this.twistEquation;g.prototype.update.call(this);b.vectorToWorldFrame(this.axisA,d.axisA);c.vectorToWorldFrame(this.axisB,
d.axisB);this.axisA.tangents(e.axisA,e.axisA);b.vectorToWorldFrame(e.axisA,e.axisA);this.axisB.tangents(e.axisB,e.axisB);c.vectorToWorldFrame(e.axisB,e.axisB);d.angle=this.angle;e.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(b,c,e){function d(b,c,e){e=g.defaults(e,{collideConnected:!0,wakeUpBodies:!0});this.equations=[];this.bodyA=b;
this.bodyB=c;this.id=d.idCounter++;this.collideConnected=e.collideConnected;e.wakeUpBodies&&(b&&b.wakeUp(),c&&c.wakeUp())}c.exports=d;var g=b("../utils/Utils");d.prototype.update=function(){throw Error("method update() not implmemented in this Constraint subclass!");};d.prototype.enable=function(){for(var b=this.equations,c=0;c<b.length;c++)b[c].enabled=!0};d.prototype.disable=function(){for(var b=this.equations,c=0;c<b.length;c++)b[c].enabled=!1};d.idCounter=0},{"../utils/Utils":53}],14:[function(b,
c,e){function d(b,c,d,e){g.call(this,b,c);"undefined"===typeof d&&(d=b.position.distanceTo(c.position));"undefined"===typeof e&&(e=1E6);this.distance=d;b=this.distanceEquation=new f(b,c);this.equations.push(b);b.minForce=-e;b.maxForce=e}c.exports=d;var g=b("./Constraint"),f=b("../equations/ContactEquation");d.prototype=new g;d.prototype.update=function(){var b=this.distanceEquation,c=.5*this.distance,d=b.ni;this.bodyB.position.vsub(this.bodyA.position,d);d.normalize();d.mult(c,b.ri);d.mult(-c,b.rj)}},
{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(b,c,e){function d(b,c,d){d=d||{};var e="undefined"!==typeof d.maxForce?d.maxForce:1E6,m=d.pivotA?d.pivotA.clone():new k,l=d.pivotB?d.pivotB.clone():new k;g.call(this,b,m,c,l,e);(this.axisA=d.axisA?d.axisA.clone():new k(1,0,0)).normalize();(this.axisB=d.axisB?d.axisB.clone():new k(1,0,0)).normalize();m=this.rotationalEquation1=new f(b,c,d);d=this.rotationalEquation2=new f(b,c,d);b=this.motorEquation=new h(b,c,e);b.enabled=!1;this.equations.push(m,
d,b)}c.exports=d;b("./Constraint");var g=b("./PointToPointConstraint"),f=b("../equations/RotationalEquation"),h=b("../equations/RotationalMotorEquation");b("../equations/ContactEquation");var k=b("../math/Vec3");d.prototype=new g;d.constructor=d;d.prototype.enableMotor=function(){this.motorEquation.enabled=!0};d.prototype.disableMotor=function(){this.motorEquation.enabled=!1};d.prototype.setMotorSpeed=function(b){this.motorEquation.targetVelocity=b};d.prototype.setMotorMaxForce=function(b){this.motorEquation.maxForce=
b;this.motorEquation.minForce=-b};var l=new k,n=new k;d.prototype.update=function(){var b=this.bodyA,c=this.bodyB,d=this.motorEquation,e=this.rotationalEquation1,f=this.rotationalEquation2,h=this.axisA,k=this.axisB;g.prototype.update.call(this);b.quaternion.vmult(h,l);c.quaternion.vmult(k,n);l.tangents(e.axisA,f.axisA);e.axisB.copy(n);f.axisB.copy(n);this.motorEquation.enabled&&(b.quaternion.vmult(this.axisA,d.axisA),c.quaternion.vmult(this.axisB,d.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,
"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(b,c,e){function d(b,c,d){d=d||{};var e="undefined"!==typeof d.maxForce?d.maxForce:1E6,m=new h,l=new h,k=new h;b.position.vadd(c.position,k);k.scale(.5,k);c.pointToLocalFrame(k,l);b.pointToLocalFrame(k,m);g.call(this,b,m,c,l,e);e=this.rotationalEquation1=new f(b,c,d);m=this.rotationalEquation2=new f(b,c,d);b=this.rotationalEquation3=new f(b,c,d);this.equations.push(e,m,b)}c.exports=
d;b("./Constraint");var g=b("./PointToPointConstraint"),f=b("../equations/RotationalEquation");b("../equations/RotationalMotorEquation");b("../equations/ContactEquation");var h=b("../math/Vec3");d.prototype=new g;d.constructor=d;new h;new h;d.prototype.update=function(){var b=this.bodyA,c=this.bodyB,d=this.rotationalEquation1,e=this.rotationalEquation2,f=this.rotationalEquation3;g.prototype.update.call(this);b.vectorToWorldFrame(h.UNIT_X,d.axisA);c.vectorToWorldFrame(h.UNIT_Y,d.axisB);b.vectorToWorldFrame(h.UNIT_Y,
e.axisA);c.vectorToWorldFrame(h.UNIT_Z,e.axisB);b.vectorToWorldFrame(h.UNIT_Z,f.axisA);c.vectorToWorldFrame(h.UNIT_X,f.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(b,c,e){function d(b,c,d,e,m){g.call(this,b,d);m="undefined"!==typeof m?m:1E6;this.pivotA=c?c.clone():new h;this.pivotB=e?e.clone():new h;c=this.equationX=new f(b,d);e=this.equationY=
new f(b,d);b=this.equationZ=new f(b,d);this.equations.push(c,e,b);c.minForce=e.minForce=b.minForce=-m;c.maxForce=e.maxForce=b.maxForce=m;c.ni.set(1,0,0);e.ni.set(0,1,0);b.ni.set(0,0,1)}c.exports=d;var g=b("./Constraint"),f=b("../equations/ContactEquation"),h=b("../math/Vec3");d.prototype=new g;d.prototype.update=function(){var b=this.bodyB,c=this.equationX,d=this.equationY,e=this.equationZ;this.bodyA.quaternion.vmult(this.pivotA,c.ri);b.quaternion.vmult(this.pivotB,c.rj);d.ri.copy(c.ri);d.rj.copy(c.rj);
e.ri.copy(c.ri);e.rj.copy(c.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(b,c,e){function d(b,c,d){d=d||{};var e="undefined"!==typeof d.maxForce?d.maxForce:1E6;f.call(this,b,c,-e,e);this.axisA=d.axisA?d.axisA.clone():new g(1,0,0);this.axisB=d.axisB?d.axisB.clone():new g(0,1,0);this.angle="undefined"!==typeof d.angle?d.angle:0}c.exports=d;var g=b("../math/Vec3");b("../math/Mat3");var f=b("./Equation");d.prototype=new f;d.prototype.constructor=d;var h=new g,
k=new g;d.prototype.computeB=function(b){var c=this.a,d=this.b,e=this.axisA,f=this.axisB,g=this.jacobianElementA,l=this.jacobianElementB;e.cross(f,h);f.cross(e,k);g.rotational.copy(k);l.rotational.copy(h);e=Math.cos(this.angle)-e.dot(f);f=this.computeGW();g=this.computeGiMf();return-e*c-f*d-b*g}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(b,c,e){function d(b,c,d){g.call(this,b,c,0,"undefined"!==typeof d?d:1E6);this.restitution=0;this.ri=new f;this.rj=new f;this.ni=new f}c.exports=
d;var g=b("./Equation"),f=b("../math/Vec3");b("../math/Mat3");d.prototype=new g;d.prototype.constructor=d;var h=new f,k=new f,l=new f;d.prototype.computeB=function(b){var c=this.a,d=this.b,e=this.bi,f=this.bj,g=this.ri,m=this.rj,p=e.velocity,r=e.angularVelocity,q=f.velocity,n=f.angularVelocity,u=this.jacobianElementA,L=this.jacobianElementB,K=this.ni;g.cross(K,h);m.cross(K,k);K.negate(u.spatial);h.negate(u.rotational);L.spatial.copy(K);L.rotational.copy(k);l.copy(f.position);l.vadd(m,l);l.vsub(e.position,
l);l.vsub(g,l);e=K.dot(l);f=this.restitution+1;p=f*q.dot(K)-f*p.dot(K)+n.dot(k)-r.dot(h);r=this.computeGiMf();return-e*c-p*d-b*r};var n=new f,q=new f,m=new f,p=new f,r=new f;d.prototype.getImpactVelocityAlongNormal=function(){this.bi.position.vadd(this.ri,m);this.bj.position.vadd(this.rj,p);this.bi.getVelocityAtWorldPoint(m,n);this.bj.getVelocityAtWorldPoint(p,q);n.vsub(q,r);return this.ni.dot(r)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(b,c,e){function d(b,c,e,f){this.id=
d.id++;this.minForce="undefined"===typeof e?-1E6:e;this.maxForce="undefined"===typeof f?1E6:f;this.bi=b;this.bj=c;this.eps=this.b=this.a=0;this.jacobianElementA=new g;this.jacobianElementB=new g;this.enabled=!0;this.setSpookParams(1E7,4,1/60)}c.exports=d;var g=b("../math/JacobianElement");b=b("../math/Vec3");d.prototype.constructor=d;d.id=0;d.prototype.setSpookParams=function(b,c,d){this.a=4/(d*(1+4*c));this.b=4*c/(1+4*c);this.eps=4/(d*d*b*(1+4*c))};d.prototype.computeB=function(b,c,d){var e=this.computeGW(),
f=this.computeGq(),g=this.computeGiMf();return-f*b-e*c-g*d};d.prototype.computeGq=function(){var b=this.jacobianElementB,c=this.bj.position;return this.jacobianElementA.spatial.dot(this.bi.position)+b.spatial.dot(c)};var f=new b;d.prototype.computeGW=function(){var b=this.jacobianElementB,c=this.bi,d=this.bj,e=d.velocity,d=d.angularVelocity||f;return this.jacobianElementA.multiplyVectors(c.velocity,c.angularVelocity||f)+b.multiplyVectors(e,d)};d.prototype.computeGWlambda=function(){var b=this.jacobianElementB,
c=this.bi,d=this.bj,e=d.vlambda,d=d.wlambda||f;return this.jacobianElementA.multiplyVectors(c.vlambda,c.wlambda||f)+b.multiplyVectors(e,d)};var h=new b,k=new b,l=new b,n=new b;d.prototype.computeGiMf=function(){var b=this.jacobianElementA,c=this.jacobianElementB,d=this.bi,e=this.bj,f=d.force,g=d.torque,m=e.force,q=e.torque,D=d.invMassSolve,B=e.invMassSolve;d.invInertiaWorldSolve?d.invInertiaWorldSolve.vmult(g,l):l.set(0,0,0);e.invInertiaWorldSolve?e.invInertiaWorldSolve.vmult(q,n):n.set(0,0,0);f.mult(D,
h);m.mult(B,k);return b.multiplyVectors(h,l)+c.multiplyVectors(k,n)};var q=new b;d.prototype.computeGiMGt=function(){var b=this.jacobianElementA,c=this.jacobianElementB,d=this.bi,e=this.bj,f=d.invInertiaWorldSolve,g=e.invInertiaWorldSolve,d=d.invMassSolve+e.invMassSolve;f&&(f.vmult(b.rotational,q),d+=q.dot(b.rotational));g&&(g.vmult(c.rotational,q),d+=q.dot(c.rotational));return d};var m=new b;new b;new b;new b;new b;new b;d.prototype.addToWlambda=function(b){var c=this.jacobianElementA,d=this.jacobianElementB,
e=this.bi,f=this.bj;c.spatial.mult(e.invMassSolve*b,m);e.vlambda.vadd(m,e.vlambda);d.spatial.mult(f.invMassSolve*b,m);f.vlambda.vadd(m,f.vlambda);e.invInertiaWorldSolve&&(e.invInertiaWorldSolve.vmult(c.rotational,m),m.mult(b,m),e.wlambda.vadd(m,e.wlambda));f.invInertiaWorldSolve&&(f.invInertiaWorldSolve.vmult(d.rotational,m),m.mult(b,m),f.wlambda.vadd(m,f.wlambda))};d.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(b,
c,e){function d(b,c,d){g.call(this,b,c,-d,d);this.ri=new f;this.rj=new f;this.t=new f}c.exports=d;var g=b("./Equation"),f=b("../math/Vec3");b("../math/Mat3");d.prototype=new g;d.prototype.constructor=d;var h=new f,k=new f;d.prototype.computeB=function(b){var c=this.b,d=this.rj,e=this.t;this.ri.cross(e,h);d.cross(e,k);var d=this.jacobianElementA,f=this.jacobianElementB;e.negate(d.spatial);h.negate(d.rotational);f.spatial.copy(e);f.rotational.copy(k);e=this.computeGW();d=this.computeGiMf();return-e*
c-b*d}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(b,c,e){function d(b,c,d){d=d||{};var e="undefined"!==typeof d.maxForce?d.maxForce:1E6;f.call(this,b,c,-e,e);this.axisA=d.axisA?d.axisA.clone():new g(1,0,0);this.axisB=d.axisB?d.axisB.clone():new g(0,1,0);this.maxAngle=Math.PI/2}c.exports=d;var g=b("../math/Vec3");b("../math/Mat3");var f=b("./Equation");d.prototype=new f;d.prototype.constructor=d;var h=new g,k=new g;d.prototype.computeB=function(b){var c=this.a,d=this.b,e=
this.axisA,f=this.axisB,g=this.jacobianElementA,l=this.jacobianElementB;e.cross(f,h);f.cross(e,k);g.rotational.copy(k);l.rotational.copy(h);e=Math.cos(this.maxAngle)-e.dot(f);f=this.computeGW();g=this.computeGiMf();return-e*c-f*d-b*g}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(b,c,e){function d(b,c,d){d="undefined"!==typeof d?d:1E6;f.call(this,b,c,-d,d);this.axisA=new g;this.axisB=new g;this.targetVelocity=0}c.exports=d;var g=b("../math/Vec3");b("../math/Mat3");var f=b("./Equation");
d.prototype=new f;d.prototype.constructor=d;d.prototype.computeB=function(b){var c=this.b,d=this.axisB,e=this.jacobianElementB;this.jacobianElementA.rotational.copy(this.axisA);d.negate(e.rotational);d=this.computeGW()-this.targetVelocity;e=this.computeGiMf();return-d*c-b*e}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(b,c,e){function d(b,c,e){e=g.defaults(e,{friction:.3,restitution:.3,contactEquationStiffness:1E7,contactEquationRelaxation:3,frictionEquationStiffness:1E7,frictionEquationRelaxation:3});
this.id=d.idCounter++;this.materials=[b,c];this.friction=e.friction;this.restitution=e.restitution;this.contactEquationStiffness=e.contactEquationStiffness;this.contactEquationRelaxation=e.contactEquationRelaxation;this.frictionEquationStiffness=e.frictionEquationStiffness;this.frictionEquationRelaxation=e.frictionEquationRelaxation}var g=b("../utils/Utils");c.exports=d;d.idCounter=0},{"../utils/Utils":53}],25:[function(b,c,e){function d(b){var c="";b=b||{};"string"===typeof b?(c=b,b={}):"object"===
typeof b&&(c="");this.name=c;this.id=d.idCounter++;this.friction="undefined"!==typeof b.friction?b.friction:-1;this.restitution="undefined"!==typeof b.restitution?b.restitution:-1}c.exports=d;d.idCounter=0},{}],26:[function(b,c,e){function d(){this.spatial=new g;this.rotational=new g}c.exports=d;var g=b("./Vec3");d.prototype.multiplyElement=function(b){return b.spatial.dot(this.spatial)+b.rotational.dot(this.rotational)};d.prototype.multiplyVectors=function(b,c){return b.dot(this.spatial)+c.dot(this.rotational)}},
{"./Vec3":30}],27:[function(b,c,e){function d(b){this.elements=b?b:[0,0,0,0,0,0,0,0,0]}c.exports=d;var g=b("./Vec3");d.prototype.identity=function(){var b=this.elements;b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1};d.prototype.setZero=function(){var b=this.elements;b[0]=0;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=0;b[6]=0;b[7]=0;b[8]=0};d.prototype.setTrace=function(b){var c=this.elements;c[0]=b.x;c[4]=b.y;c[8]=b.z};d.prototype.getTrace=function(b){b=b||new g;var c=this.elements;b.x=c[0];
b.y=c[4];b.z=c[8]};d.prototype.vmult=function(b,c){c=c||new g;var d=this.elements,e=b.x,f=b.y,h=b.z;c.x=d[0]*e+d[1]*f+d[2]*h;c.y=d[3]*e+d[4]*f+d[5]*h;c.z=d[6]*e+d[7]*f+d[8]*h;return c};d.prototype.smult=function(b){for(var c=0;c<this.elements.length;c++)this.elements[c]*=b};d.prototype.mmult=function(b,c){for(var e=c||new d,f=0;3>f;f++)for(var g=0;3>g;g++){for(var h=0,m=0;3>m;m++)h+=b.elements[f+3*m]*this.elements[m+3*g];e.elements[f+3*g]=h}return e};d.prototype.scale=function(b,c){c=c||new d;for(var e=
this.elements,f=c.elements,g=0;3!==g;g++)f[3*g+0]=b.x*e[3*g+0],f[3*g+1]=b.y*e[3*g+1],f[3*g+2]=b.z*e[3*g+2];return c};d.prototype.solve=function(b,c){c=c||new g;for(var d=[],e=0;12>e;e++)d.push(0);for(var f,e=0;3>e;e++)for(f=0;3>f;f++)d[e+4*f]=this.elements[e+3*f];d[3]=b.x;d[7]=b.y;d[11]=b.z;var h=3,m=h,p,r;do{e=m-h;if(0===d[e+4*e])for(f=e+1;f<m;f++)if(0!==d[e+4*f]){p=4;do r=4-p,d[r+4*e]+=d[r+4*f];while(--p);break}if(0!==d[e+4*e])for(f=e+1;f<m;f++){var u=d[e+4*f]/d[e+4*e];p=4;do r=4-p,d[r+4*f]=r<=
e?0:d[r+4*f]-d[r+4*e]*u;while(--p)}}while(--h);c.z=d[11]/d[10];c.y=(d[7]-d[6]*c.z)/d[5];c.x=(d[3]-d[2]*c.z-d[1]*c.y)/d[0];if(isNaN(c.x)||isNaN(c.y)||isNaN(c.z)||Infinity===c.x||Infinity===c.y||Infinity===c.z)throw"Could not solve equation! Got x=["+c.toString()+"], b=["+b.toString()+"], A=["+this.toString()+"]";return c};d.prototype.e=function(b,c,d){if(void 0===d)return this.elements[c+3*b];this.elements[c+3*b]=d};d.prototype.copy=function(b){for(var c=0;c<b.elements.length;c++)this.elements[c]=
b.elements[c];return this};d.prototype.toString=function(){for(var b="",c=0;9>c;c++)b+=this.elements[c]+",";return b};d.prototype.reverse=function(b){b=b||new d;for(var c=[],e=0;18>e;e++)c.push(0);for(var f,e=0;3>e;e++)for(f=0;3>f;f++)c[e+6*f]=this.elements[e+3*f];c[3]=1;c[9]=0;c[15]=0;c[4]=0;c[10]=1;c[16]=0;c[5]=0;c[11]=0;c[17]=1;var g=3,q=g,m,p;do{e=q-g;if(0===c[e+6*e])for(f=e+1;f<q;f++)if(0!==c[e+6*f]){m=6;do p=6-m,c[p+6*e]+=c[p+6*f];while(--m);break}if(0!==c[e+6*e])for(f=e+1;f<q;f++){var r=c[e+
6*f]/c[e+6*e];m=6;do p=6-m,c[p+6*f]=p<=e?0:c[p+6*f]-c[p+6*e]*r;while(--m)}}while(--g);e=2;do{f=e-1;do{r=c[e+6*f]/c[e+6*e];m=6;do p=6-m,c[p+6*f]-=c[p+6*e]*r;while(--m)}while(f--)}while(--e);e=2;do{r=1/c[e+6*e];m=6;do p=6-m,c[p+6*e]*=r;while(--m)}while(e--);e=2;do{f=2;do{p=c[3+f+6*e];if(isNaN(p)||Infinity===p)throw"Could not reverse! A=["+this.toString()+"]";b.e(e,f,p)}while(f--)}while(e--);return b};d.prototype.setRotationFromQuaternion=function(b){var c=b.x,d=b.y,e=b.z,f=b.w,g=c+c,m=d+d,p=e+e;b=c*
g;var r=c*m,c=c*p,u=d*m,d=d*p,e=e*p,g=f*g,m=f*m,f=f*p,p=this.elements;p[0]=1-(u+e);p[1]=r-f;p[2]=c+m;p[3]=r+f;p[4]=1-(b+e);p[5]=d-g;p[6]=c-m;p[7]=d+g;p[8]=1-(b+u);return this};d.prototype.transpose=function(b){b=b||new d;for(var c=b.elements,e=this.elements,f=0;3!==f;f++)for(var g=0;3!==g;g++)c[3*f+g]=e[3*g+f];return b}},{"./Vec3":30}],28:[function(b,c,e){function d(b,c,d,e){this.x=void 0!==b?b:0;this.y=void 0!==c?c:0;this.z=void 0!==d?d:0;this.w=void 0!==e?e:1}c.exports=d;var g=b("./Vec3");d.prototype.set=
function(b,c,d,e){this.x=b;this.y=c;this.z=d;this.w=e};d.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w};d.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]};d.prototype.setFromAxisAngle=function(b,c){var d=Math.sin(.5*c);this.x=b.x*d;this.y=b.y*d;this.z=b.z*d;this.w=Math.cos(.5*c)};d.prototype.toAxisAngle=function(b){b=b||new g;this.normalize();var c=2*Math.acos(this.w),d=Math.sqrt(1-this.w*this.w);.001>d?(b.x=this.x,b.y=this.y,b.z=this.z):(b.x=this.x/
d,b.y=this.y/d,b.z=this.z/d);return[b,c]};var f=new g,h=new g;d.prototype.setFromVectors=function(b,c){if(b.isAntiparallelTo(c))b.tangents(f,h),this.setFromAxisAngle(f,Math.PI);else{var d=b.cross(c);this.x=d.x;this.y=d.y;this.z=d.z;this.w=Math.sqrt(Math.pow(b.norm(),2)*Math.pow(c.norm(),2))+b.dot(c);this.normalize()}};var k=new g,l=new g,n=new g;d.prototype.mult=function(b,c){c=c||new d;var e=this.w;k.set(this.x,this.y,this.z);l.set(b.x,b.y,b.z);c.w=e*b.w-k.dot(l);k.cross(l,n);c.x=e*l.x+b.w*k.x+n.x;
c.y=e*l.y+b.w*k.y+n.y;c.z=e*l.z+b.w*k.z+n.z;return c};d.prototype.inverse=function(b){var c=this.x,e=this.y,f=this.z,g=this.w;b=b||new d;this.conjugate(b);c=1/(c*c+e*e+f*f+g*g);b.x*=c;b.y*=c;b.z*=c;b.w*=c;return b};d.prototype.conjugate=function(b){b=b||new d;b.x=-this.x;b.y=-this.y;b.z=-this.z;b.w=this.w;return b};d.prototype.normalize=function(){var b=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===b?this.w=this.z=this.y=this.x=0:(b=1/b,this.x*=b,this.y*=b,this.z*=b,this.w*=
b)};d.prototype.normalizeFast=function(){var b=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===b?this.w=this.z=this.y=this.x=0:(this.x*=b,this.y*=b,this.z*=b,this.w*=b)};d.prototype.vmult=function(b,c){c=c||new g;var d=b.x,e=b.y,f=b.z,h=this.x,m=this.y,l=this.z,k=this.w,q=k*d+m*f-l*e,n=k*e+l*d-h*f,B=k*f+h*e-m*d,d=-h*d-m*e-l*f;c.x=q*k+d*-h+n*-l-B*-m;c.y=n*k+d*-m+B*-h-q*-l;c.z=B*k+d*-l+q*-m-n*-h;return c};d.prototype.copy=function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=b.w;return this};
d.prototype.toEuler=function(b,c){c=c||"YZX";var d,e,f,g=this.x,h=this.y,m=this.z,l=this.w;switch(c){case "YZX":var k=g*h+m*l;.499<k&&(d=2*Math.atan2(g,l),e=Math.PI/2,f=0);-.499>k&&(d=-2*Math.atan2(g,l),e=-Math.PI/2,f=0);isNaN(d)&&(f=m*m,d=Math.atan2(2*h*l-2*g*m,1-2*h*h-2*f),e=Math.asin(2*k),f=Math.atan2(2*g*l-2*h*m,1-2*g*g-2*f));break;default:throw Error("Euler order "+c+" not supported yet.");}b.y=d;b.z=e;b.x=f};d.prototype.setFromEuler=function(b,c,d,e){e=e||"XYZ";var f=Math.cos(b/2),g=Math.cos(c/
2),h=Math.cos(d/2);b=Math.sin(b/2);c=Math.sin(c/2);d=Math.sin(d/2);"XYZ"===e?(this.x=b*g*h+f*c*d,this.y=f*c*h-b*g*d,this.z=f*g*d+b*c*h,this.w=f*g*h-b*c*d):"YXZ"===e?(this.x=b*g*h+f*c*d,this.y=f*c*h-b*g*d,this.z=f*g*d-b*c*h,this.w=f*g*h+b*c*d):"ZXY"===e?(this.x=b*g*h-f*c*d,this.y=f*c*h+b*g*d,this.z=f*g*d+b*c*h,this.w=f*g*h-b*c*d):"ZYX"===e?(this.x=b*g*h-f*c*d,this.y=f*c*h+b*g*d,this.z=f*g*d-b*c*h,this.w=f*g*h+b*c*d):"YZX"===e?(this.x=b*g*h+f*c*d,this.y=f*c*h+b*g*d,this.z=f*g*d-b*c*h,this.w=f*g*h-b*
c*d):"XZY"===e&&(this.x=b*g*h-f*c*d,this.y=f*c*h-b*g*d,this.z=f*g*d+b*c*h,this.w=f*g*h+b*c*d);return this};d.prototype.clone=function(){return new d(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(b,c,e){function d(b){b=b||{};this.position=new g;b.position&&this.position.copy(b.position);this.quaternion=new f;b.quaternion&&this.quaternion.copy(b.quaternion)}var g=b("./Vec3"),f=b("./Quaternion");c.exports=d;var h=new f;d.pointToLocalFrame=function(b,c,d,e){e=e||new g;d.vsub(b,e);c.conjugate(h);
h.vmult(e,e);return e};d.prototype.pointToLocal=function(b,c){return d.pointToLocalFrame(this.position,this.quaternion,b,c)};d.pointToWorldFrame=function(b,c,d,e){e=e||new g;c.vmult(d,e);e.vadd(b,e);return e};d.prototype.pointToWorld=function(b,c){return d.pointToWorldFrame(this.position,this.quaternion,b,c)};d.prototype.vectorToWorldFrame=function(b,c){c=c||new g;this.quaternion.vmult(b,c);return c};d.vectorToWorldFrame=function(b,c,d){b.vmult(c,d);return d};d.vectorToLocalFrame=function(b,c,d,e){e=
e||new g;c.w*=-1;c.vmult(d,e);c.w*=-1;return e}},{"./Quaternion":28,"./Vec3":30}],30:[function(b,c,e){function d(b,c,d){this.x=b||0;this.y=c||0;this.z=d||0}c.exports=d;var g=b("./Mat3");d.ZERO=new d(0,0,0);d.UNIT_X=new d(1,0,0);d.UNIT_Y=new d(0,1,0);d.UNIT_Z=new d(0,0,1);d.prototype.cross=function(b,c){var e=b.x,f=b.y,g=b.z,h=this.x,l=this.y,k=this.z;c=c||new d;c.x=l*g-k*f;c.y=k*e-h*g;c.z=h*f-l*e;return c};d.prototype.set=function(b,c,d){this.x=b;this.y=c;this.z=d;return this};d.prototype.setZero=
function(){this.x=this.y=this.z=0};d.prototype.vadd=function(b,c){if(c)c.x=b.x+this.x,c.y=b.y+this.y,c.z=b.z+this.z;else return new d(this.x+b.x,this.y+b.y,this.z+b.z)};d.prototype.vsub=function(b,c){if(c)c.x=this.x-b.x,c.y=this.y-b.y,c.z=this.z-b.z;else return new d(this.x-b.x,this.y-b.y,this.z-b.z)};d.prototype.crossmat=function(){return new g([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])};d.prototype.normalize=function(){var b=this.x,c=this.y,d=this.z,b=Math.sqrt(b*b+c*c+d*d);0<b?(c=1/
b,this.x*=c,this.y*=c,this.z*=c):this.z=this.y=this.x=0;return b};d.prototype.unit=function(b){b=b||new d;var c=this.x,e=this.y,f=this.z,g=Math.sqrt(c*c+e*e+f*f);0<g?(g=1/g,b.x=c*g,b.y=e*g,b.z=f*g):(b.x=1,b.y=0,b.z=0);return b};d.prototype.norm=function(){var b=this.x,c=this.y,d=this.z;return Math.sqrt(b*b+c*c+d*d)};d.prototype.length=d.prototype.norm;d.prototype.norm2=function(){return this.dot(this)};d.prototype.lengthSquared=d.prototype.norm2;d.prototype.distanceTo=function(b){var c=this.x,d=this.y,
e=this.z,f=b.x,g=b.y;b=b.z;return Math.sqrt((f-c)*(f-c)+(g-d)*(g-d)+(b-e)*(b-e))};d.prototype.distanceSquared=function(b){var c=this.x,d=this.y,e=this.z,f=b.x,g=b.y;b=b.z;return(f-c)*(f-c)+(g-d)*(g-d)+(b-e)*(b-e)};d.prototype.mult=function(b,c){c=c||new d;var e=this.y,f=this.z;c.x=b*this.x;c.y=b*e;c.z=b*f;return c};d.prototype.scale=d.prototype.mult;d.prototype.dot=function(b){return this.x*b.x+this.y*b.y+this.z*b.z};d.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z};d.prototype.negate=
function(b){b=b||new d;b.x=-this.x;b.y=-this.y;b.z=-this.z;return b};var f=new d,h=new d;d.prototype.tangents=function(b,c){var d=this.norm();0<d?(d=1/d,f.set(this.x*d,this.y*d,this.z*d),.9>Math.abs(f.x)?h.set(1,0,0):h.set(0,1,0),f.cross(h,b),f.cross(b,c)):(b.set(1,0,0),c.set(0,1,0))};d.prototype.toString=function(){return this.x+","+this.y+","+this.z};d.prototype.toArray=function(){return[this.x,this.y,this.z]};d.prototype.copy=function(b){this.x=b.x;this.y=b.y;this.z=b.z;return this};d.prototype.lerp=
function(b,c,d){var e=this.x,f=this.y,g=this.z;d.x=e+(b.x-e)*c;d.y=f+(b.y-f)*c;d.z=g+(b.z-g)*c};d.prototype.almostEquals=function(b,c){void 0===c&&(c=1E-6);return Math.abs(this.x-b.x)>c||Math.abs(this.y-b.y)>c||Math.abs(this.z-b.z)>c?!1:!0};d.prototype.almostZero=function(b){void 0===b&&(b=1E-6);return Math.abs(this.x)>b||Math.abs(this.y)>b||Math.abs(this.z)>b?!1:!0};var k=new d;d.prototype.isAntiparallelTo=function(b,c){this.negate(k);return k.almostEquals(b,c)};d.prototype.clone=function(){return new d(this.x,
this.y,this.z)}},{"./Mat3":27}],31:[function(b,c,e){function d(b){b=b||{};g.apply(this);this.id=d.idCounter++;this.postStep=this.preStep=this.world=null;this.vlambda=new f;this.collisionFilterGroup="number"===typeof b.collisionFilterGroup?b.collisionFilterGroup:1;this.collisionFilterMask="number"===typeof b.collisionFilterMask?b.collisionFilterMask:1;this.collisionResponse=!0;this.position=new f;b.position&&this.position.copy(b.position);this.previousPosition=new f;this.initPosition=new f;this.velocity=
new f;b.velocity&&this.velocity.copy(b.velocity);this.initVelocity=new f;this.force=new f;var c="number"===typeof b.mass?b.mass:0;this.mass=c;this.invMass=0<c?1/c:0;this.material=b.material||null;this.linearDamping="number"===typeof b.linearDamping?b.linearDamping:.01;this.type=0>=c?d.STATIC:d.DYNAMIC;typeof b.type===typeof d.STATIC&&(this.type=b.type);this.allowSleep="undefined"!==typeof b.allowSleep?b.allowSleep:!0;this.sleepState=0;this.sleepSpeedLimit="undefined"!==typeof b.sleepSpeedLimit?b.sleepSpeedLimit:
.1;this.sleepTimeLimit="undefined"!==typeof b.sleepTimeLimit?b.sleepTimeLimit:1;this.timeLastSleepy=0;this._wakeUpAfterNarrowphase=!1;this.torque=new f;this.quaternion=new k;b.quaternion&&this.quaternion.copy(b.quaternion);this.initQuaternion=new k;this.angularVelocity=new f;b.angularVelocity&&this.angularVelocity.copy(b.angularVelocity);this.initAngularVelocity=new f;this.interpolatedPosition=new f;this.interpolatedQuaternion=new k;this.shapes=[];this.shapeOffsets=[];this.shapeOrientations=[];this.inertia=
new f;this.invInertia=new f;this.invInertiaWorld=new h;this.invMassSolve=0;this.invInertiaSolve=new f;this.invInertiaWorldSolve=new h;this.fixedRotation="undefined"!==typeof b.fixedRotation?b.fixedRotation:!1;this.angularDamping="undefined"!==typeof b.angularDamping?b.angularDamping:.01;this.aabb=new l;this.aabbNeedsUpdate=!0;this.wlambda=new f;b.shape&&this.addShape(b.shape);this.updateMassProperties()}c.exports=d;var g=b("../utils/EventTarget");b("../shapes/Shape");var f=b("../math/Vec3"),h=b("../math/Mat3"),
k=b("../math/Quaternion");b("../material/Material");var l=b("../collision/AABB"),n=b("../shapes/Box");d.prototype=new g;d.prototype.constructor=d;d.DYNAMIC=1;d.STATIC=2;d.KINEMATIC=4;d.AWAKE=0;d.SLEEPY=1;d.SLEEPING=2;d.idCounter=0;d.prototype.wakeUp=function(){var b=this.sleepState;this.sleepState=0;b===d.SLEEPING&&this.dispatchEvent({type:"wakeup"})};d.prototype.sleep=function(){this.sleepState=d.SLEEPING;this.velocity.set(0,0,0);this.angularVelocity.set(0,0,0)};d.sleepyEvent={type:"sleepy"};d.sleepEvent=
{type:"sleep"};d.prototype.sleepTick=function(b){if(this.allowSleep){var c=this.sleepState,e=this.velocity.norm2()+this.angularVelocity.norm2(),f=Math.pow(this.sleepSpeedLimit,2);c===d.AWAKE&&e<f?(this.sleepState=d.SLEEPY,this.timeLastSleepy=b,this.dispatchEvent(d.sleepyEvent)):c===d.SLEEPY&&e>f?this.wakeUp():c===d.SLEEPY&&b-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(d.sleepEvent))}};d.prototype.updateSolveMassProperties=function(){this.sleepState===d.SLEEPING||this.type===
d.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))};d.prototype.pointToLocalFrame=function(b,c){c=c||new f;b.vsub(this.position,c);this.quaternion.conjugate().vmult(c,c);return c};d.prototype.vectorToLocalFrame=function(b,c){c=c||new f;this.quaternion.conjugate().vmult(b,c);return c};d.prototype.pointToWorldFrame=function(b,
c){c=c||new f;this.quaternion.vmult(b,c);c.vadd(this.position,c);return c};d.prototype.vectorToWorldFrame=function(b,c){c=c||new f;this.quaternion.vmult(b,c);return c};var q=new f,m=new k;d.prototype.addShape=function(b,c,d){var e=new f,g=new k;c&&e.copy(c);d&&g.copy(d);this.shapes.push(b);this.shapeOffsets.push(e);this.shapeOrientations.push(g);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=!0;return this};d.prototype.updateBoundingRadius=function(){for(var b=this.shapes,
c=this.shapeOffsets,d=b.length,e=0,f=0;f!==d;f++){var g=b[f];g.updateBoundingSphereRadius();var h=c[f].norm(),g=g.boundingSphereRadius;h+g>e&&(e=h+g)}this.boundingRadius=e};var p=new l;d.prototype.computeAABB=function(){for(var b=this.shapes,c=this.shapeOffsets,d=this.shapeOrientations,e=b.length,f=this.quaternion,g=this.aabb,h=0;h!==e;h++){var k=b[h];d[h].mult(f,m);m.vmult(c[h],q);q.vadd(this.position,q);k.calculateWorldAABB(q,m,p.lowerBound,p.upperBound);0===h?g.copy(p):g.extend(p)}this.aabbNeedsUpdate=
!1};var r=new h,u=new h;new h;d.prototype.updateInertiaWorld=function(b){var c=this.invInertia;if(c.x!==c.y||c.y!==c.z||b)r.setRotationFromQuaternion(this.quaternion),r.transpose(u),r.scale(c,r),r.mmult(u,this.invInertiaWorld)};var t=new f,v=new f;d.prototype.applyForce=function(b,c){this.type===d.DYNAMIC&&(c.vsub(this.position,t),t.cross(b,v),this.force.vadd(b,this.force),this.torque.vadd(v,this.torque))};var x=new f,A=new f;d.prototype.applyLocalForce=function(b,c){this.type===d.DYNAMIC&&(this.vectorToWorldFrame(b,
x),this.pointToWorldFrame(c,A),this.applyForce(x,A))};var w=new f,D=new f,B=new f;d.prototype.applyImpulse=function(b,c){this.type===d.DYNAMIC&&(c.vsub(this.position,w),D.copy(b),D.mult(this.invMass,D),this.velocity.vadd(D,this.velocity),w.cross(b,B),this.invInertiaWorld.vmult(B,B),this.angularVelocity.vadd(B,this.angularVelocity))};var z=new f,F=new f;d.prototype.applyLocalImpulse=function(b,c){this.type===d.DYNAMIC&&(this.vectorToWorldFrame(b,z),this.pointToWorldFrame(c,F),this.applyImpulse(z,F))};
var G=new f;d.prototype.updateMassProperties=function(){this.invMass=0<this.mass?1/this.mass:0;var b=this.inertia,c=this.fixedRotation;this.computeAABB();G.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2);n.calculateInertia(G,this.mass,b);this.invInertia.set(0<b.x&&!c?1/b.x:0,0<b.y&&!c?1/b.y:0,0<b.z&&!c?1/b.z:0);this.updateInertiaWorld(!0)};d.prototype.getVelocityAtWorldPoint=function(b,c){var d=
new f;b.vsub(this.position,d);this.angularVelocity.cross(d,c);this.velocity.vadd(c,c);return c}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(b,c,e){function d(b){this.chassisBody=b.chassisBody;this.wheelInfos=[];this.sliding=!1;this.world=null;this.indexRightAxis="undefined"!==typeof b.indexRightAxis?b.indexRightAxis:1;this.indexForwardAxis="undefined"!==
typeof b.indexForwardAxis?b.indexForwardAxis:0;this.indexUpAxis="undefined"!==typeof b.indexUpAxis?b.indexUpAxis:2}function g(b,c,d){var e=D,f=B,g=z,h=F;c.vsub(b.position,e);e.cross(d,f);b.invInertiaWorld.vmult(f,h);h.cross(e,g);return b.invMass+d.dot(g)}b("./Body");var f=b("../math/Vec3"),h=b("../math/Quaternion");b("../collision/RaycastResult");e=b("../collision/Ray");var k=b("../objects/WheelInfo");c.exports=d;new f;new f;new f;var l=new f,n=new f,q=new f;new e;d.prototype.addWheel=function(b){b=
b||{};b=new k(b);var c=this.wheelInfos.length;this.wheelInfos.push(b);return c};d.prototype.setSteeringValue=function(b,c){this.wheelInfos[c].steering=b};new f;d.prototype.applyEngineForce=function(b,c){this.wheelInfos[c].engineForce=b};d.prototype.setBrake=function(b,c){this.wheelInfos[c].brake=b};d.prototype.addToWorld=function(b){b.add(this.chassisBody);var c=this;this.preStepCallback=function(){c.updateVehicle(b.dt)};b.addEventListener("preStep",this.preStepCallback);this.world=b};d.prototype.getVehicleAxisWorld=
function(b,c){c.set(0===b?1:0,1===b?1:0,2===b?1:0);this.chassisBody.vectorToWorldFrame(c,c)};d.prototype.updateVehicle=function(b){for(var c=this.wheelInfos,d=c.length,e=this.chassisBody,g=0;g<d;g++)this.updateWheelTransform(g);this.currentVehicleSpeedKmHour=3.6*e.velocity.norm();g=new f;this.getVehicleAxisWorld(this.indexForwardAxis,g);0>g.dot(e.velocity)&&(this.currentVehicleSpeedKmHour*=-1);for(g=0;g<d;g++)this.castRay(c[g]);this.updateSuspension(b);for(var h=new f,m=new f,g=0;g<d;g++){var k=c[g],
l=k.suspensionForce;l>k.maxSuspensionForce&&(l=k.maxSuspensionForce);k.raycastResult.hitNormalWorld.scale(l*b,h);k.raycastResult.hitPointWorld.vsub(e.position,m);e.applyImpulse(h,k.raycastResult.hitPointWorld)}this.updateFriction(b);h=new f;m=new f;l=new f;for(g=0;g<d;g++){k=c[g];e.getVelocityAtWorldPoint(k.chassisConnectionPointWorld,l);var p=1;switch(this.indexUpAxis){case 1:p=-1}if(k.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,m);var r=m.dot(k.raycastResult.hitNormalWorld);k.raycastResult.hitNormalWorld.scale(r,
h);m.vsub(h,m);r=m.dot(l);k.deltaRotation=p*r*b/k.radius}!k.sliding&&k.isInContact||0===k.engineForce||!k.useCustomSlidingRotationalSpeed||(k.deltaRotation=(0<k.engineForce?1:-1)*k.customSlidingRotationalSpeed*b);Math.abs(k.brake)>Math.abs(k.engineForce)&&(k.deltaRotation=0);k.rotation+=k.deltaRotation;k.deltaRotation*=.99}};d.prototype.updateSuspension=function(b){b=this.chassisBody.mass;for(var c=this.wheelInfos,d=c.length,e=0;e<d;e++){var f=c[e];if(f.isInContact){var g;g=f.suspensionStiffness*
(f.suspensionRestLength-f.suspensionLength)*f.clippedInvContactDotSuspension;var h=f.suspensionRelativeVelocity;g-=(0>h?f.dampingCompression:f.dampingRelaxation)*h;f.suspensionForce=g*b;0>f.suspensionForce&&(f.suspensionForce=0)}else f.suspensionForce=0}};d.prototype.removeFromWorld=function(b){b.remove(this.chassisBody);b.removeEventListener("preStep",this.preStepCallback);this.world=null};var m=new f,p=new f;d.prototype.castRay=function(b){this.updateWheelTransformWorld(b);var c=this.chassisBody,
d=-1;b.directionWorld.scale(b.suspensionRestLength+b.radius,m);var e=b.chassisConnectionPointWorld;e.vadd(m,p);var g=b.raycastResult;g.reset();var h=c.collisionResponse;c.collisionResponse=!1;this.world.rayTest(e,p,g);c.collisionResponse=h;e=g.body;b.raycastResult.groundObject=0;e?(d=g.distance,b.raycastResult.hitNormalWorld=g.hitNormalWorld,b.isInContact=!0,b.suspensionLength=g.distance-b.radius,g=b.suspensionRestLength-b.maxSuspensionTravel,e=b.suspensionRestLength+b.maxSuspensionTravel,b.suspensionLength<
g&&(b.suspensionLength=g),b.suspensionLength>e&&(b.suspensionLength=e,b.raycastResult.reset()),g=b.raycastResult.hitNormalWorld.dot(b.directionWorld),e=new f,c.getVelocityAtWorldPoint(b.raycastResult.hitPointWorld,e),c=b.raycastResult.hitNormalWorld.dot(e),-.1<=g?(b.suspensionRelativeVelocity=0,b.clippedInvContactDotSuspension=10):(g=-1/g,b.suspensionRelativeVelocity=c*g,b.clippedInvContactDotSuspension=g)):(b.suspensionLength=b.suspensionRestLength+0*b.maxSuspensionTravel,b.suspensionRelativeVelocity=
0,b.directionWorld.scale(-1,b.raycastResult.hitNormalWorld),b.clippedInvContactDotSuspension=1);return d};d.prototype.updateWheelTransformWorld=function(b){b.isInContact=!1;var c=this.chassisBody;c.pointToWorldFrame(b.chassisConnectionPointLocal,b.chassisConnectionPointWorld);c.vectorToWorldFrame(b.directionLocal,b.directionWorld);c.vectorToWorldFrame(b.axleLocal,b.axleWorld)};d.prototype.updateWheelTransform=function(b){b=this.wheelInfos[b];this.updateWheelTransformWorld(b);b.directionLocal.scale(-1,
l);n.copy(b.axleLocal);l.cross(n,q);q.normalize();n.normalize();var c=b.steering,d=new h;d.setFromAxisAngle(l,c);c=new h;c.setFromAxisAngle(n,b.rotation);var e=b.worldTransform.quaternion;this.chassisBody.quaternion.mult(d,e);e.mult(c,e);e.normalize();d=b.worldTransform.position;d.copy(b.directionWorld);d.scale(b.suspensionLength,d);d.vadd(b.chassisConnectionPointWorld,d)};var r=[new f(1,0,0),new f(0,1,0),new f(0,0,1)];d.prototype.getWheelTransformWorld=function(b){return this.wheelInfos[b].worldTransform};
var u=new f,t=[],v=[];d.prototype.updateFriction=function(b){for(var c=this.wheelInfos,d=c.length,e=this.chassisBody,h=0,m=0;m<d;m++){var k=c[m],l=k.raycastResult.body;l&&h++;k.sideImpulse=0;k.forwardImpulse=0;v[m]||(v[m]=new f);t[m]||(t[m]=new f)}for(m=0;m<d;m++)if(k=c[m],l=k.raycastResult.body){var p=t[m];this.getWheelTransformWorld(m).vectorToWorldFrame(r[this.indexRightAxis],p);var h=k.raycastResult.hitNormalWorld,n=p.dot(h);h.scale(n,u);p.vsub(u,p);p.normalize();h.cross(p,v[m]);v[m].normalize();
h=k;var n=e,q=k.raycastResult.hitPointWorld,z=k.raycastResult.hitPointWorld;if(1.1<p.norm2())l=0;else{var B=G,D=C,F=L;n.getVelocityAtWorldPoint(q,B);l.getVelocityAtWorldPoint(z,D);B.vsub(D,F);l=-.2*p.dot(F)*(1/(n.invMass+l.invMass))}h.sideImpulse=l;k.sideImpulse*=1}this.sliding=!1;for(m=0;m<d;m++){k=c[m];l=k.raycastResult.body;n=0;k.slipInfo=1;if(l){var h=k.brake?k.brake:0,B=e,q=l,z=k.raycastResult.hitPointWorld,p=v[m],n=h,D=z,F=x,K=A,U=w;B.getVelocityAtWorldPoint(D,F);q.getVelocityAtWorldPoint(D,
K);F.vsub(K,U);D=p.dot(U);B=g(B,z,p);q=g(q,z,p);q=1/(B+q)*-D;n<q&&(q=n);q<-n&&(q=-n);n=q;n+=k.engineForce*b;h/=n;k.slipInfo*=h}k.forwardImpulse=0;k.skidInfo=1;l&&(k.skidInfo=1,l=k.suspensionForce*b*k.frictionSlip,h=l*l,k.forwardImpulse=n,n=.5*k.forwardImpulse,q=1*k.sideImpulse,n=n*n+q*q,k.sliding=!1,n>h&&(this.sliding=!0,k.sliding=!0,h=l/Math.sqrt(n),k.skidInfo*=h))}if(this.sliding)for(m=0;m<d;m++)k=c[m],0!==k.sideImpulse&&1>k.skidInfo&&(k.forwardImpulse*=k.skidInfo,k.sideImpulse*=k.skidInfo);for(m=
0;m<d;m++)k=c[m],b=new f,b.copy(k.raycastResult.hitPointWorld),0!==k.forwardImpulse&&(l=new f,v[m].scale(k.forwardImpulse,l),e.applyImpulse(l,b)),0!==k.sideImpulse&&(l=k.raycastResult.body,h=new f,h.copy(k.raycastResult.hitPointWorld),n=new f,t[m].scale(k.sideImpulse,n),e.pointToLocalFrame(b,b),b["xyz"[this.indexUpAxis]]*=k.rollInfluence,e.pointToWorldFrame(b,b),e.applyImpulse(n,b),n.scale(-1,n),l.applyImpulse(n,h))};var x=new f,A=new f,w=new f,D=new f,B=new f,z=new f,F=new f,G=new f,C=new f,L=new f},
{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(b,c,e){function d(b){this.wheelBodies=[];this.coordinateSystem="undefined"===typeof b.coordinateSystem?new k(1,2,3):b.coordinateSystem.clone();this.chassisBody=b.chassisBody;this.chassisBody||(b=new h(new k(5,2,.5)),this.chassisBody=new g(1,b));this.constraints=[];this.wheelAxes=[];this.wheelForces=[]}var g=b("./Body"),f=b("../shapes/Sphere"),h=b("../shapes/Box"),
k=b("../math/Vec3"),l=b("../constraints/HingeConstraint");c.exports=d;d.prototype.addWheel=function(b){b=b||{};var c=b.body;c||(c=new g(1,new f(1.2)));this.wheelBodies.push(c);this.wheelForces.push(0);new k;var d="undefined"!==typeof b.position?b.position.clone():new k,e=new k;this.chassisBody.pointToWorldFrame(d,e);c.position.set(e.x,e.y,e.z);b="undefined"!==typeof b.axis?b.axis.clone():new k(0,1,0);this.wheelAxes.push(b);c=new l(this.chassisBody,c,{pivotA:d,axisA:b,pivotB:k.ZERO,axisB:b,collideConnected:!1});
this.constraints.push(c);return this.wheelBodies.length-1};d.prototype.setSteeringValue=function(b,c){var d=this.wheelAxes[c],e=Math.cos(b),f=Math.sin(b),g=d.x,d=d.y;this.constraints[c].axisA.set(e*g-f*d,f*g+e*d,0)};d.prototype.setMotorSpeed=function(b,c){var d=this.constraints[c];d.enableMotor();d.motorTargetVelocity=b};d.prototype.disableMotor=function(b){this.constraints[b].disableMotor()};var n=new k;d.prototype.setWheelForce=function(b,c){this.wheelForces[c]=b};d.prototype.applyWheelForce=function(b,
c){var d=this.wheelBodies[c],e=d.torque;this.wheelAxes[c].scale(b,n);d.vectorToWorldFrame(n,n);e.vadd(n,e)};d.prototype.addToWorld=function(b){for(var c=this.constraints,d=this.wheelBodies.concat([this.chassisBody]),e=0;e<d.length;e++)b.add(d[e]);for(e=0;e<c.length;e++)b.addConstraint(c[e]);b.addEventListener("preStep",this._update.bind(this))};d.prototype._update=function(){for(var b=this.wheelForces,c=0;c<b.length;c++)this.applyWheelForce(b[c],c)};d.prototype.removeFromWorld=function(b){for(var c=
this.constraints,d=this.wheelBodies.concat([this.chassisBody]),e=0;e<d.length;e++)b.remove(d[e]);for(e=0;e<c.length;e++)b.removeConstraint(c[e])};var q=new k;d.prototype.getWheelSpeed=function(b){var c=this.wheelBodies[b].angularVelocity;this.chassisBody.vectorToWorldFrame(this.wheelAxes[b],q);return c.dot(q)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(b,c,e){function d(){this.particles=[];this.speedOfSound=this.smoothingRadius=
this.density=1;this.viscosity=.01;this.eps=1E-6;this.pressures=[];this.densities=[];this.neighbors=[]}c.exports=d;b("../shapes/Shape");c=b("../math/Vec3");b("../math/Quaternion");b("../shapes/Particle");b("../objects/Body");b("../material/Material");d.prototype.add=function(b){this.particles.push(b);this.neighbors.length<this.particles.length&&this.neighbors.push([])};d.prototype.remove=function(b){b=this.particles.indexOf(b);-1!==b&&(this.particles.splice(b,1),this.neighbors.length>this.particles.length&&
this.neighbors.pop())};var g=new c;d.prototype.getNeighbors=function(b,c){for(var d=this.particles.length,e=b.id,f=this.smoothingRadius*this.smoothingRadius,h=0;h!==d;h++){var m=this.particles[h];m.position.vsub(b.position,g);e!==m.id&&g.norm2()<f&&c.push(m)}};var f=new c,h=new c,k=new c,l=new c,n=new c,q=new c;d.prototype.update=function(){for(var b=this.particles.length,c=this.speedOfSound,d=this.eps,e=0;e!==b;e++){var g=this.particles[e],v=this.neighbors[e];v.length=0;this.getNeighbors(g,v);v.push(this.particles[e]);
for(var x=v.length,A=0,w=0;w!==x;w++){g.position.vsub(v[w].position,f);var D=f.norm(),D=this.w(D),A=A+v[w].mass*D}this.densities[e]=A;this.pressures[e]=c*c*(this.densities[e]-this.density)}for(e=0;e!==b;e++){c=this.particles[e];h.set(0,0,0);k.set(0,0,0);v=this.neighbors[e];x=v.length;for(w=0;w!==x;w++)A=v[w],c.position.vsub(A.position,n),D=n.norm(),g=-A.mass*(this.pressures[e]/(this.densities[e]*this.densities[e]+d)+this.pressures[w]/(this.densities[w]*this.densities[w]+d)),this.gradw(n,l),l.mult(g,
l),h.vadd(l,h),A.velocity.vsub(c.velocity,q),q.mult(1/(1E-4+this.densities[e]*this.densities[w])*this.viscosity*A.mass,q),g=this.nablaw(D),q.mult(g,q),k.vadd(q,k);k.mult(c.mass,k);h.mult(c.mass,h);c.force.vadd(k,c.force);c.force.vadd(h,c.force)}};d.prototype.w=function(b){var c=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(c,9))*Math.pow(c*c-b*b,3)};d.prototype.gradw=function(b,c){var d=b.norm(),e=this.smoothingRadius;b.mult(945/(32*Math.PI*Math.pow(e,9))*Math.pow(e*e-d*d,2),c)};d.prototype.nablaw=
function(b){var c=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(c,9))*(c*c-b*b)*(7*b*b-3*c*c)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(b,c,e){function d(b,c,d){d=d||{};this.restLength="number"===typeof d.restLength?d.restLength:1;this.stiffness=d.stiffness||100;this.damping=d.damping||1;this.bodyA=b;this.bodyB=c;this.localAnchorA=new g;this.localAnchorB=new g;d.localAnchorA&&this.localAnchorA.copy(d.localAnchorA);
d.localAnchorB&&this.localAnchorB.copy(d.localAnchorB);d.worldAnchorA&&this.setWorldAnchorA(d.worldAnchorA);d.worldAnchorB&&this.setWorldAnchorB(d.worldAnchorB)}var g=b("../math/Vec3");c.exports=d;d.prototype.setWorldAnchorA=function(b){this.bodyA.pointToLocalFrame(b,this.localAnchorA)};d.prototype.setWorldAnchorB=function(b){this.bodyB.pointToLocalFrame(b,this.localAnchorB)};d.prototype.getWorldAnchorA=function(b){this.bodyA.pointToWorldFrame(this.localAnchorA,b)};d.prototype.getWorldAnchorB=function(b){this.bodyB.pointToWorldFrame(this.localAnchorB,
b)};var f=new g,h=new g,k=new g,l=new g,n=new g,q=new g,m=new g,p=new g,r=new g,u=new g,t=new g;d.prototype.applyForce=function(){var b=this.stiffness,c=this.damping,d=this.restLength,e=this.bodyA,g=this.bodyB;this.getWorldAnchorA(n);this.getWorldAnchorB(q);n.vsub(e.position,m);q.vsub(g.position,p);q.vsub(n,f);var B=f.norm();h.copy(f);h.normalize();g.velocity.vsub(e.velocity,k);g.angularVelocity.cross(p,t);k.vadd(t,k);e.angularVelocity.cross(m,t);k.vsub(t,k);h.mult(-b*(B-d)-c*k.dot(h),l);e.force.vsub(l,
e.force);g.force.vadd(l,g.force);m.cross(l,r);p.cross(l,u);e.torque.vsub(r,e.torque);g.torque.vadd(u,g.torque)}},{"../math/Vec3":30}],36:[function(b,c,e){function d(b){b=k.defaults(b,{chassisConnectionPointLocal:new g,chassisConnectionPointWorld:new g,directionLocal:new g,directionWorld:new g,axleLocal:new g,axleWorld:new g,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1E4,steering:0,rotation:0,deltaRotation:0,
rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1});this.maxSuspensionTravel=b.maxSuspensionTravel;this.customSlidingRotationalSpeed=b.customSlidingRotationalSpeed;this.useCustomSlidingRotationalSpeed=b.useCustomSlidingRotationalSpeed;this.sliding=!1;this.chassisConnectionPointLocal=
b.chassisConnectionPointLocal.clone();this.chassisConnectionPointWorld=b.chassisConnectionPointWorld.clone();this.directionLocal=b.directionLocal.clone();this.directionWorld=b.directionWorld.clone();this.axleLocal=b.axleLocal.clone();this.axleWorld=b.axleWorld.clone();this.suspensionRestLength=b.suspensionRestLength;this.suspensionMaxLength=b.suspensionMaxLength;this.radius=b.radius;this.suspensionStiffness=b.suspensionStiffness;this.dampingCompression=b.dampingCompression;this.dampingRelaxation=
b.dampingRelaxation;this.frictionSlip=b.frictionSlip;this.deltaRotation=this.rotation=this.steering=0;this.rollInfluence=b.rollInfluence;this.maxSuspensionForce=b.maxSuspensionForce;this.brake=this.engineForce=0;this.isFrontWheel=b.isFrontWheel;this.clippedInvContactDotSuspension=1;this.forwardImpulse=this.sideImpulse=this.suspensionLength=this.skidInfo=this.suspensionForce=this.suspensionRelativeVelocity=0;this.raycastResult=new h;this.worldTransform=new f;this.isInContact=!1}var g=b("../math/Vec3"),
f=b("../math/Transform"),h=b("../collision/RaycastResult"),k=b("../utils/Utils");c.exports=d;var l=new g,n=new g,l=new g;d.prototype.updateWheel=function(b){var c=this.raycastResult;if(this.isInContact){var d=c.hitNormalWorld.dot(c.directionWorld);c.hitPointWorld.vsub(b.position,n);b.getVelocityAtWorldPoint(n,l);b=c.hitNormalWorld.dot(l);-.1<=d?(this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10):(d=-1/d,this.suspensionRelativeVelocity=b*d,this.clippedInvContactDotSuspension=
d)}else c.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,c.directionWorld.scale(-1,c.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(b,c,e){function d(b){g.call(this);this.type=g.types.BOX;this.halfExtents=b;this.convexPolyhedronRepresentation=null;this.updateConvexPolyhedronRepresentation();this.updateBoundingSphereRadius()}c.exports=d;var g=b("./Shape"),
f=b("../math/Vec3"),h=b("./ConvexPolyhedron");d.prototype=new g;d.prototype.constructor=d;d.prototype.updateConvexPolyhedronRepresentation=function(){var b=this.halfExtents.x,c=this.halfExtents.y,d=this.halfExtents.z,b=[new f(-b,-c,-d),new f(b,-c,-d),new f(b,c,-d),new f(-b,c,-d),new f(-b,-c,d),new f(b,-c,d),new f(b,c,d),new f(-b,c,d)];new f(0,0,1);new f(0,1,0);new f(1,0,0);this.convexPolyhedronRepresentation=b=new h(b,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]);b.material=this.material};
d.prototype.calculateLocalInertia=function(b,c){c=c||new f;d.calculateInertia(this.halfExtents,b,c);return c};d.calculateInertia=function(b,c,d){d.x=1/12*c*(4*b.y*b.y+4*b.z*b.z);d.y=1/12*c*(4*b.x*b.x+4*b.z*b.z);d.z=1/12*c*(4*b.y*b.y+4*b.x*b.x)};d.prototype.getSideNormals=function(b,c){var d=this.halfExtents;b[0].set(d.x,0,0);b[1].set(0,d.y,0);b[2].set(0,0,d.z);b[3].set(-d.x,0,0);b[4].set(0,-d.y,0);b[5].set(0,0,-d.z);if(void 0!==c)for(d=0;d!==b.length;d++)c.vmult(b[d],b[d]);return b};d.prototype.volume=
function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z};d.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var k=new f;new f;d.prototype.forEachWorldCorner=function(b,c,d){for(var e=this.halfExtents,e=[[e.x,e.y,e.z],[-e.x,e.y,e.z],[-e.x,-e.y,e.z],[-e.x,-e.y,-e.z],[e.x,-e.y,-e.z],[e.x,e.y,-e.z],[-e.x,e.y,-e.z],[e.x,-e.y,e.z]],f=0;f<e.length;f++)k.set(e[f][0],e[f][1],e[f][2]),c.vmult(k,k),b.vadd(k,k),d(k.x,k.y,k.z)};var l=[new f,
new f,new f,new f,new f,new f,new f,new f];d.prototype.calculateWorldAABB=function(b,c,d,e){var f=this.halfExtents;l[0].set(f.x,f.y,f.z);l[1].set(-f.x,f.y,f.z);l[2].set(-f.x,-f.y,f.z);l[3].set(-f.x,-f.y,-f.z);l[4].set(f.x,-f.y,-f.z);l[5].set(f.x,f.y,-f.z);l[6].set(-f.x,f.y,-f.z);l[7].set(f.x,-f.y,f.z);var g=l[0];c.vmult(g,g);b.vadd(g,g);e.copy(g);d.copy(g);for(f=1;8>f;f++){g=l[f];c.vmult(g,g);b.vadd(g,g);var h=g.x,m=g.y,g=g.z;h>e.x&&(e.x=h);m>e.y&&(e.y=m);g>e.z&&(e.z=g);h<d.x&&(d.x=h);m<d.y&&(d.y=
m);g<d.z&&(d.z=g)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(b,c,e){function d(b,c,d){g.call(this);this.type=g.types.CONVEXPOLYHEDRON;this.vertices=b||[];this.worldVertices=[];this.worldVerticesNeedsUpdate=!0;this.faces=c||[];this.faceNormals=[];this.computeNormals();this.worldFaceNormalsNeedsUpdate=!0;this.worldFaceNormals=[];this.uniqueEdges=[];this.uniqueAxes=d?d.slice():null;this.computeEdges();this.updateBoundingSphereRadius()}c.exports=d;var g=b("./Shape"),f=b("../math/Vec3");
b("../math/Quaternion");var h=b("../math/Transform");d.prototype=new g;d.prototype.constructor=d;var k=new f;d.prototype.computeEdges=function(){for(var b=this.faces,c=this.vertices,d=this.uniqueEdges,e=d.length=0;e!==b.length;e++)for(var f=b[e],g=f.length,h=0;h!==g;h++){c[f[h]].vsub(c[f[(h+1)%g]],k);k.normalize();for(var m=!1,l=0;l!==d.length;l++)if(d[l].almostEquals(k)||d[l].almostEquals(k)){m=!0;break}m||d.push(k.clone())}};d.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;
for(var b=0;b<this.faces.length;b++){for(var c=0;c<this.faces[b].length;c++)if(!this.vertices[this.faces[b][c]])throw Error("Vertex "+this.faces[b][c]+" not found!");c=this.faceNormals[b]||new f;this.getFaceNormal(b,c);c.negate(c);this.faceNormals[b]=c;if(0>c.dot(this.vertices[this.faces[b][0]]))for(console.error(".faceNormals["+b+"] = Vec3("+c.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),c=0;c<
this.faces[b].length;c++)console.warn(".vertices["+this.faces[b][c]+"] = Vec3("+this.vertices[this.faces[b][c]].toString()+")")}};var l=new f,n=new f;d.computeNormal=function(b,c,d,e){c.vsub(b,n);d.vsub(c,l);l.cross(n,e);e.isZero()||e.normalize()};d.prototype.getFaceNormal=function(b,c){var e=this.faces[b];return d.computeNormal(this.vertices[e[0]],this.vertices[e[1]],this.vertices[e[2]],c)};var q=new f;d.prototype.clipAgainstHull=function(b,c,d,e,g,h,m,k,l){for(var p=-1,r=-Number.MAX_VALUE,n=0;n<
d.faces.length;n++){q.copy(d.faceNormals[n]);g.vmult(q,q);var u=q.dot(h);u>r&&(r=u,p=n)}for(var r=[],n=d.faces[p],u=n.length,t=0;t<u;t++){var v=d.vertices[n[t]],x=new f;x.copy(v);g.vmult(x,x);e.vadd(x,x);r.push(x)}0<=p&&this.clipFaceAgainstHull(h,b,c,r,m,k,l)};var m=new f,p=new f,r=new f,u=new f,t=new f,v=new f;d.prototype.findSeparatingAxis=function(b,c,d,e,f,g,h,k){var l=Number.MAX_VALUE,n=0;if(this.uniqueAxes)for(x=0;x!==this.uniqueAxes.length;x++){d.vmult(this.uniqueAxes[x],m);w=this.testSepAxis(m,
b,c,d,e,f);if(!1===w)return!1;w<l&&(l=w,g.copy(m))}else for(var q=h?h.length:this.faces.length,x=0;x<q;x++){w=h?h[x]:x;m.copy(this.faceNormals[w]);d.vmult(m,m);var w=this.testSepAxis(m,b,c,d,e,f);if(!1===w)return!1;w<l&&(l=w,g.copy(m))}if(b.uniqueAxes)for(x=0;x!==b.uniqueAxes.length;x++){f.vmult(b.uniqueAxes[x],p);n++;w=this.testSepAxis(p,b,c,d,e,f);if(!1===w)return!1;w<l&&(l=w,g.copy(p))}else for(h=k?k.length:b.faces.length,x=0;x<h;x++){w=k?k[x]:x;p.copy(b.faceNormals[w]);f.vmult(p,p);n++;w=this.testSepAxis(p,
b,c,d,e,f);if(!1===w)return!1;w<l&&(l=w,g.copy(p))}for(k=0;k!==this.uniqueEdges.length;k++)for(d.vmult(this.uniqueEdges[k],u),n=0;n!==b.uniqueEdges.length;n++)if(f.vmult(b.uniqueEdges[n],t),u.cross(t,v),!v.almostZero()){v.normalize();x=this.testSepAxis(v,b,c,d,e,f);if(!1===x)return!1;x<l&&(l=x,g.copy(v))}e.vsub(c,r);0<r.dot(g)&&g.negate(g);return!0};var x=[],A=[];d.prototype.testSepAxis=function(b,c,e,f,g,h){d.project(this,b,e,f,x);d.project(c,b,g,h,A);e=x[0];b=x[1];c=A[0];f=A[1];if(e<f||c<b)return!1;
e-=f;b=c-b;return e<b?e:b};var w=new f,D=new f;d.prototype.calculateLocalInertia=function(b,c){this.computeLocalAABB(w,D);var d=D.x-w.x,e=D.y-w.y,f=D.z-w.z;c.x=1/12*b*(4*e*e+4*f*f);c.y=1/12*b*(4*d*d+4*f*f);c.z=1/12*b*(4*e*e+4*d*d)};d.prototype.getPlaneConstantOfFace=function(b){return-this.faceNormals[b].dot(this.vertices[this.faces[b][0]])};var B=new f,z=new f,F=new f,G=new f,C=new f,L=new f,K=new f,H=new f;d.prototype.clipFaceAgainstHull=function(b,c,d,e,f,g,h){for(var m=[],k=-1,l=Number.MAX_VALUE,
p=0;p<this.faces.length;p++){B.copy(this.faceNormals[p]);d.vmult(B,B);var r=B.dot(b);r<l&&(l=r,k=p)}if(!(0>k)){b=this.faces[k];b.connectedFaces=[];for(l=0;l<this.faces.length;l++)for(p=0;p<this.faces[l].length;p++)-1!==b.indexOf(this.faces[l][p])&&l!==k&&-1===b.connectedFaces.indexOf(l)&&b.connectedFaces.push(l);l=b.length;for(p=0;p<l;p++){r=this.vertices[b[p]];r.vsub(this.vertices[b[(p+1)%l]],z);F.copy(z);d.vmult(F,F);c.vadd(F,F);G.copy(this.faceNormals[k]);d.vmult(G,G);c.vadd(G,G);F.cross(G,C);
C.negate(C);L.copy(r);d.vmult(L,L);c.vadd(L,L);L.dot(C);r=b.connectedFaces[p];K.copy(this.faceNormals[r]);r=this.getPlaneConstantOfFace(r);H.copy(K);d.vmult(H,H);r-=H.dot(c);for(this.clipFaceAgainstPlane(e,m,H,r);e.length;)e.shift();for(;m.length;)e.push(m.shift())}K.copy(this.faceNormals[k]);r=this.getPlaneConstantOfFace(k);H.copy(K);d.vmult(H,H);r-=H.dot(c);for(l=0;l<e.length;l++)c=H.dot(e[l])+r,c<=f&&(console.log("clamped: depth="+c+" to minDist="+(f+"")),c=f),c<=g&&(d=e[l],0>=c&&h.push({point:d,
normal:H,depth:c}))}};d.prototype.clipFaceAgainstPlane=function(b,c,d,e){var g,h,m=b.length;if(2>m)return c;var k=b[b.length-1],l;g=d.dot(k)+e;for(var p=0;p<m;p++){l=b[p];h=d.dot(l)+e;if(0>g){if(0>h){var r=new f;r.copy(l)}else r=new f,k.lerp(l,g/(g-h),r);c.push(r)}else 0>h&&(r=new f,k.lerp(l,g/(g-h),r),c.push(r),c.push(l));k=l;g=h}return c};d.prototype.computeWorldVertices=function(b,c){for(var d=this.vertices.length;this.worldVertices.length<d;)this.worldVertices.push(new f);for(var e=this.vertices,
g=this.worldVertices,h=0;h!==d;h++)c.vmult(e[h],g[h]),b.vadd(g[h],g[h]);this.worldVerticesNeedsUpdate=!1};new f;d.prototype.computeLocalAABB=function(b,c){var d=this.vertices.length,e=this.vertices;b.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);c.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var f=0;f<d;f++){var g=e[f];g.x<b.x?b.x=g.x:g.x>c.x&&(c.x=g.x);g.y<b.y?b.y=g.y:g.y>c.y&&(c.y=g.y);g.z<b.z?b.z=g.z:g.z>c.z&&(c.z=g.z)}};d.prototype.computeWorldFaceNormals=function(b){for(var c=
this.faceNormals.length;this.worldFaceNormals.length<c;)this.worldFaceNormals.push(new f);for(var d=this.faceNormals,e=this.worldFaceNormals,g=0;g!==c;g++)b.vmult(d[g],e[g]);this.worldFaceNormalsNeedsUpdate=!1};d.prototype.updateBoundingSphereRadius=function(){for(var b=0,c=this.vertices,d=0,e=c.length;d!==e;d++){var f=c[d].norm2();f>b&&(b=f)}this.boundingSphereRadius=Math.sqrt(b)};var M=new f;d.prototype.calculateWorldAABB=function(b,c,d,e){for(var f=this.vertices.length,g=this.vertices,h,m,k,l,
p,r,n=0;n<f;n++){M.copy(g[n]);c.vmult(M,M);b.vadd(M,M);var q=M;if(q.x<h||void 0===h)h=q.x;else if(q.x>l||void 0===l)l=q.x;if(q.y<m||void 0===m)m=q.y;else if(q.y>p||void 0===p)p=q.y;if(q.z<k||void 0===k)k=q.z;else if(q.z>r||void 0===r)r=q.z}d.set(h,m,k);e.set(l,p,r)};d.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};d.prototype.getAveragePointLocal=function(b){b=b||new f;for(var c=this.vertices.length,d=this.vertices,e=0;e<c;e++)b.vadd(d[e],b);b.mult(1/c,b);return b};d.prototype.transformAllPoints=
function(b,c){var d=this.vertices.length,e=this.vertices;if(c){for(var f=0;f<d;f++){var g=e[f];c.vmult(g,g)}for(f=0;f<this.faceNormals.length;f++)g=this.faceNormals[f],c.vmult(g,g)}if(b)for(f=0;f<d;f++)g=e[f],g.vadd(b,g)};var E=new f,J=new f,N=new f;d.prototype.pointIsInside=function(b){var c,d=this.vertices,e=this.faces,f=this.faceNormals,g=this.faces.length;this.getAveragePointLocal(E);for(var h=0;h<g;h++){c=f[h];var m=d[e[h][0]],k=J;b.vsub(m,k);var k=c.dot(k),l=N;E.vsub(m,l);c=c.dot(l);if(0>k&&
0<c||0<k&&0>c)return!1}return-1};new f;var P=new f,Q=new f;d.project=function(b,c,d,e,f){var g=b.vertices.length;b=b.vertices;Q.setZero();h.vectorToLocalFrame(d,e,c,P);h.pointToLocalFrame(d,e,Q,Q);e=Q.dot(P);d=c=b[0].dot(P);for(var m=1;m<g;m++){var k=b[m].dot(P);k>c&&(c=k);k<d&&(d=k)}d-=e;c-=e;d>c&&(g=d,d=c,c=g);f[0]=c;f[1]=d}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(b,c,e){function d(b,c,d,e){var m=[],k=[],l=[],n=[],q=[],v=Math.cos,x=Math.sin;
m.push(new f(c*v(0),c*x(0),.5*-d));n.push(0);m.push(new f(b*v(0),b*x(0),.5*d));q.push(1);for(var A=0;A<e;A++){var w=2*Math.PI/e*(A+1),D=2*Math.PI/e*(A+.5);A<e-1?(m.push(new f(c*v(w),c*x(w),.5*-d)),n.push(2*A+2),m.push(new f(b*v(w),b*x(w),.5*d)),q.push(2*A+3),l.push([2*A+2,2*A+3,2*A+1,2*A])):l.push([0,1,2*A+1,2*A]);(1===e%2||A<e/2)&&k.push(new f(v(D),x(D),0))}l.push(q);k.push(new f(0,0,1));b=[];for(A=0;A<n.length;A++)b.push(n[n.length-A-1]);l.push(b);this.type=g.types.CONVEXPOLYHEDRON;h.call(this,
m,l,k)}c.exports=d;var g=b("./Shape"),f=b("../math/Vec3");b("../math/Quaternion");var h=b("./ConvexPolyhedron");d.prototype=new h},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(b,c,e){function d(b,c){c=k.defaults(c,{maxValue:null,minValue:null,elementSize:1});this.data=b;this.maxValue=c.maxValue;this.minValue=c.minValue;this.elementSize=c.elementSize;null===c.minValue&&this.updateMinValue();null===c.maxValue&&this.updateMaxValue();this.cacheEnabled=
!0;g.call(this);this.pillarConvex=new f;this.pillarOffset=new h;this.type=g.types.HEIGHTFIELD;this.updateBoundingSphereRadius();this._cachedPillars={}}var g=b("./Shape"),f=b("./ConvexPolyhedron"),h=b("../math/Vec3"),k=b("../utils/Utils");c.exports=d;d.prototype=new g;d.prototype.update=function(){this._cachedPillars={}};d.prototype.updateMinValue=function(){for(var b=this.data,c=b[0][0],d=0;d!==b.length;d++)for(var e=0;e!==b[d].length;e++){var f=b[d][e];f<c&&(c=f)}this.minValue=c};d.prototype.updateMaxValue=
function(){for(var b=this.data,c=b[0][0],d=0;d!==b.length;d++)for(var e=0;e!==b[d].length;e++){var f=b[d][e];f>c&&(c=f)}this.maxValue=c};d.prototype.setHeightValueAtIndex=function(b,c,d){this.data[b][c]=d;this.clearCachedConvexTrianglePillar(b,c,!1);0<b&&(this.clearCachedConvexTrianglePillar(b-1,c,!0),this.clearCachedConvexTrianglePillar(b-1,c,!1));0<c&&(this.clearCachedConvexTrianglePillar(b,c-1,!0),this.clearCachedConvexTrianglePillar(b,c-1,!1));0<c&&0<b&&this.clearCachedConvexTrianglePillar(b-
1,c-1,!0)};d.prototype.getRectMinMax=function(b,c,d,e,f){f=f||[];for(var g=this.data,h=this.minValue;b<=d;b++)for(var m=c;m<=e;m++){var k=g[b][m];k>h&&(h=k)}f[0]=this.minValue;f[1]=h};d.prototype.getIndexOfPosition=function(b,c,d,e){var f=this.elementSize,g=this.data;b=Math.floor(b/f);c=Math.floor(c/f);d[0]=b;d[1]=c;e&&(0>b&&(b=0),0>c&&(c=0),b>=g.length-1&&(b=g.length-1),c>=g[0].length-1&&(c=g[0].length-1));return 0>b||0>c||b>=g.length-1||c>=g[0].length-1?!1:!0};d.prototype.getHeightAt=function(b,
c,d){var e=[];this.getIndexOfPosition(b,c,e,d);b=[];this.getRectMinMax(e[0],e[1]+1,e[0],e[1]+1,b);return(b[0]+b[1])/2};d.prototype.getCacheConvexTrianglePillarKey=function(b,c,d){return b+"_"+c+"_"+(d?1:0)};d.prototype.getCachedConvexTrianglePillar=function(b,c,d){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(b,c,d)]};d.prototype.setCachedConvexTrianglePillar=function(b,c,d,e,f){this._cachedPillars[this.getCacheConvexTrianglePillarKey(b,c,d)]={convex:e,offset:f}};d.prototype.clearCachedConvexTrianglePillar=
function(b,c,d){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(b,c,d)]};d.prototype.getConvexTrianglePillar=function(b,c,d){var e=this.pillarConvex,g=this.pillarOffset;if(this.cacheEnabled){var k=this.getCachedConvexTrianglePillar(b,c,d);if(k){this.pillarConvex=k.convex;this.pillarOffset=k.offset;return}e=new f;g=new h;this.pillarConvex=e;this.pillarOffset=g}var k=this.data,l=this.elementSize,n=e.faces;e.vertices.length=6;for(var q=0;6>q;q++)e.vertices[q]||(e.vertices[q]=new h);n.length=
5;for(q=0;5>q;q++)n[q]||(n[q]=[]);var q=e.vertices,x=(Math.min(k[b][c],k[b+1][c],k[b][c+1],k[b+1][c+1])-this.minValue)/2+this.minValue;d?(g.set((b+.75)*l,(c+.75)*l,x),q[0].set(.25*l,.25*l,k[b+1][c+1]-x),q[1].set(-.75*l,.25*l,k[b][c+1]-x),q[2].set(.25*l,-.75*l,k[b+1][c]-x),q[3].set(.25*l,.25*l,-x-1),q[4].set(-.75*l,.25*l,-x-1),q[5].set(.25*l,-.75*l,-x-1),n[0][0]=0,n[0][1]=1,n[0][2]=2,n[1][0]=5,n[1][1]=4,n[1][2]=3,n[2][0]=2,n[2][1]=5,n[2][2]=3,n[2][3]=0,n[3][0]=3,n[3][1]=4,n[3][2]=1,n[3][3]=0,n[4][0]=
1,n[4][1]=4,n[4][2]=5,n[4][3]=2):(g.set((b+.25)*l,(c+.25)*l,x),q[0].set(-.25*l,-.25*l,k[b][c]-x),q[1].set(.75*l,-.25*l,k[b+1][c]-x),q[2].set(-.25*l,.75*l,k[b][c+1]-x),q[3].set(-.25*l,-.25*l,-x-1),q[4].set(.75*l,-.25*l,-x-1),q[5].set(-.25*l,.75*l,-x-1),n[0][0]=0,n[0][1]=1,n[0][2]=2,n[1][0]=5,n[1][1]=4,n[1][2]=3,n[2][0]=0,n[2][1]=2,n[2][2]=5,n[2][3]=3,n[3][0]=1,n[3][1]=0,n[3][2]=3,n[3][3]=4,n[4][0]=4,n[4][1]=5,n[4][2]=2,n[4][3]=1);e.computeNormals();e.computeEdges();e.updateBoundingSphereRadius();this.setCachedConvexTrianglePillar(b,
c,d,e,g)};d.prototype.calculateLocalInertia=function(b,c){c=c||new h;c.set(0,0,0);return c};d.prototype.volume=function(){return Number.MAX_VALUE};d.prototype.calculateWorldAABB=function(b,c,d,e){d.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};d.prototype.updateBoundingSphereRadius=function(){var b=this.data,c=this.elementSize;this.boundingSphereRadius=(new h(b.length*c,b[0].length*c,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue)))).norm()}},
{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(b,c,e){function d(){g.call(this);this.type=g.types.PARTICLE}c.exports=d;var g=b("./Shape"),f=b("../math/Vec3");d.prototype=new g;d.prototype.constructor=d;d.prototype.calculateLocalInertia=function(b,c){c=c||new f;c.set(0,0,0);return c};d.prototype.volume=function(){return 0};d.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0};d.prototype.calculateWorldAABB=function(b,c,d,e){d.copy(b);
e.copy(b)}},{"../math/Vec3":30,"./Shape":43}],42:[function(b,c,e){function d(){g.call(this);this.type=g.types.PLANE;this.worldNormal=new f;this.worldNormalNeedsUpdate=!0;this.boundingSphereRadius=Number.MAX_VALUE}c.exports=d;var g=b("./Shape"),f=b("../math/Vec3");d.prototype=new g;d.prototype.constructor=d;d.prototype.computeWorldNormal=function(b){var c=this.worldNormal;c.set(0,0,1);b.vmult(c,c);this.worldNormalNeedsUpdate=!1};d.prototype.calculateLocalInertia=function(b,c){return c=c||new f};d.prototype.volume=
function(){return Number.MAX_VALUE};var h=new f;d.prototype.calculateWorldAABB=function(b,c,d,e){h.set(0,0,1);c.vmult(h,h);c=Number.MAX_VALUE;d.set(-c,-c,-c);e.set(c,c,c);1===h.x&&(e.x=b.x);1===h.y&&(e.y=b.y);1===h.z&&(e.z=b.z);-1===h.x&&(d.x=b.x);-1===h.y&&(d.y=b.y);-1===h.z&&(d.z=b.z)};d.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(b,c,e){function d(){this.id=d.idCounter++;this.boundingSphereRadius=this.type=
0;this.collisionResponse=!0;this.material=null}c.exports=d;d=b("./Shape");b("../math/Vec3");b("../math/Quaternion");b("../material/Material");d.prototype.constructor=d;d.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type;};d.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type;};d.prototype.calculateLocalInertia=function(b,c){throw"calculateLocalInertia() not implemented for shape type "+this.type;
};d.idCounter=0;d.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(b,c,e){function d(b){g.call(this);this.radius=void 0!==b?Number(b):1;this.type=g.types.SPHERE;if(0>this.radius)throw Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}c.exports=d;var g=b("./Shape"),f=b("../math/Vec3");d.prototype=new g;d.prototype.constructor=
d;d.prototype.calculateLocalInertia=function(b,c){c=c||new f;var d=2*b*this.radius*this.radius/5;c.x=d;c.y=d;c.z=d;return c};d.prototype.volume=function(){return 4*Math.PI*this.radius/3};d.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius};d.prototype.calculateWorldAABB=function(b,c,d,e){c=this.radius;for(var f=["x","y","z"],g=0;g<f.length;g++){var h=f[g];d[h]=b[h]-c;e[h]=b[h]+c}}},{"../math/Vec3":30,"./Shape":43}],45:[function(b,c,e){function d(b,c){g.call(this);
this.type=g.types.TRIMESH;this.vertices=new Float32Array(b);this.indices=new Int16Array(c);this.normals=new Float32Array(c.length);this.aabb=new k;this.edges=null;this.scale=new f(1,1,1);this.tree=new l;this.updateEdges();this.updateNormals();this.updateAABB();this.updateBoundingSphereRadius();this.updateTree()}c.exports=d;var g=b("./Shape"),f=b("../math/Vec3");b("../math/Quaternion");var h=b("../math/Transform"),k=b("../collision/AABB"),l=b("../utils/Octree");d.prototype=new g;d.prototype.constructor=
d;var n=new f;d.prototype.updateTree=function(){var b=this.tree;b.reset();b.aabb.copy(this.aabb);var c=this.scale;b.aabb.lowerBound.x*=1/c.x;b.aabb.lowerBound.y*=1/c.y;b.aabb.lowerBound.z*=1/c.z;b.aabb.upperBound.x*=1/c.x;b.aabb.upperBound.y*=1/c.y;b.aabb.upperBound.z*=1/c.z;for(var c=new k,d=new f,e=new f,g=new f,h=[d,e,g],m=0;m<this.indices.length/3;m++){var l=3*m;this._getUnscaledVertex(this.indices[l],d);this._getUnscaledVertex(this.indices[l+1],e);this._getUnscaledVertex(this.indices[l+2],g);
c.setFromPoints(h);b.insert(c,m)}b.removeEmptyNodes()};var q=new k;d.prototype.getTrianglesInAABB=function(b,c){q.copy(b);var d=this.scale,e=d.x,f=d.y,d=d.z,g=q.lowerBound,h=q.upperBound;g.x/=e;g.y/=f;g.z/=d;h.x/=e;h.y/=f;h.z/=d;return this.tree.aabbQuery(q,c)};d.prototype.setScale=function(b){var c=b.x===b.y===b.z;this.scale.x===this.scale.y===this.scale.z&&c||this.updateNormals();this.scale.copy(b);this.updateAABB();this.updateBoundingSphereRadius()};d.prototype.updateNormals=function(){for(var b=
this.normals,c=0;c<this.indices.length/3;c++){var e=3*c,f=this.indices[e+1],g=this.indices[e+2];this.getVertex(this.indices[e],t);this.getVertex(f,v);this.getVertex(g,x);d.computeNormal(v,t,x,n);b[e]=n.x;b[e+1]=n.y;b[e+2]=n.z}};d.prototype.updateEdges=function(){for(var b={},c=function(c,d){b[f<g?f+"_"+g:g+"_"+f]=!0},d=0;d<this.indices.length/3;d++){var e=3*d,f=this.indices[e],g=this.indices[e+1],e=this.indices[e+2];c(f,g);c(g,e);c(e,f)}c=Object.keys(b);this.edges=new Int16Array(2*c.length);for(d=
0;d<c.length;d++)e=c[d].split("_"),this.edges[2*d]=parseInt(e[0],10),this.edges[2*d+1]=parseInt(e[1],10)};d.prototype.getEdgeVertex=function(b,c,d){this.getVertex(this.edges[2*b+(c?1:0)],d)};var m=new f,p=new f;d.prototype.getEdgeVector=function(b,c){this.getEdgeVertex(b,0,m);this.getEdgeVertex(b,1,p);p.vsub(m,c)};var r=new f,u=new f;d.computeNormal=function(b,c,d,e){c.vsub(b,u);d.vsub(c,r);r.cross(u,e);e.isZero()||e.normalize()};var t=new f,v=new f,x=new f;d.prototype.getVertex=function(b,c){var d=
this.scale;this._getUnscaledVertex(b,c);c.x*=d.x;c.y*=d.y;c.z*=d.z;return c};d.prototype._getUnscaledVertex=function(b,c){var d=3*b,e=this.vertices;return c.set(e[d],e[d+1],e[d+2])};d.prototype.getWorldVertex=function(b,c,d,e){this.getVertex(b,e);h.pointToWorldFrame(c,d,e,e);return e};d.prototype.getTriangleVertices=function(b,c,d,e){b*=3;this.getVertex(this.indices[b],c);this.getVertex(this.indices[b+1],d);this.getVertex(this.indices[b+2],e)};d.prototype.getNormal=function(b,c){var d=3*b;return c.set(this.normals[d],
this.normals[d+1],this.normals[d+2])};var A=new k;d.prototype.calculateLocalInertia=function(b,c){this.computeLocalAABB(A);var d=A.upperBound.x-A.lowerBound.x,e=A.upperBound.y-A.lowerBound.y,f=A.upperBound.z-A.lowerBound.z;return c.set(1/12*b*(4*e*e+4*f*f),1/12*b*(4*d*d+4*f*f),1/12*b*(4*e*e+4*d*d))};var w=new f;d.prototype.computeLocalAABB=function(b){var c=b.lowerBound;b=b.upperBound;var d=this.vertices.length;this.getVertex(0,w);c.copy(w);b.copy(w);for(var e=0;e!==d;e++)this.getVertex(e,w),w.x<
c.x?c.x=w.x:w.x>b.x&&(b.x=w.x),w.y<c.y?c.y=w.y:w.y>b.y&&(b.y=w.y),w.z<c.z?c.z=w.z:w.z>b.z&&(b.z=w.z)};d.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)};d.prototype.updateBoundingSphereRadius=function(){for(var b=0,c=this.vertices,d=new f,e=0,c=c.length/3;e!==c;e++){this.getVertex(e,d);var g=d.norm2();g>b&&(b=g)}this.boundingSphereRadius=Math.sqrt(b)};new f;var D=new h,B=new k;d.prototype.calculateWorldAABB=function(b,c,d,e){D.position=b;D.quaternion=c;this.aabb.toWorldFrame(D,B);
d.copy(B.lowerBound);e.copy(B.upperBound)};d.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};d.createTorus=function(b,c,e,f,g){b=b||1;c=c||.5;e=e||8;f=f||6;g=g||2*Math.PI;for(var h=[],m=[],k=0;k<=e;k++)for(var l=0;l<=f;l++){var p=l/f*g,r=k/e*Math.PI*2;h.push((b+c*Math.cos(r))*Math.cos(p),(b+c*Math.cos(r))*Math.sin(p),c*Math.sin(r))}for(k=1;k<=e;k++)for(l=1;l<=f;l++)b=(f+1)*(k-1)+l-1,c=(f+1)*(k-1)+l,g=(f+1)*k+l,m.push((f+1)*k+l-1,b,g),m.push(b,c,g);return new d(h,m)}},{"../collision/AABB":3,
"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(b,c,e){function d(){g.call(this);this.iterations=10;this.tolerance=1E-7}c.exports=d;b("../math/Vec3");b("../math/Quaternion");var g=b("./Solver");d.prototype=new g;var f=[],h=[],k=[];d.prototype.solve=function(b,c){var d=0,e=this.iterations,g=this.tolerance*this.tolerance,l=this.equations,n=l.length,t=c.bodies,v=t.length,x,A,w,D,B;if(0!==n)for(w=0;w!==v;w++)t[w].updateSolveMassProperties();
h.length=n;k.length=n;f.length=n;for(w=0;w!==n;w++){var z=l[w];f[w]=0;k[w]=z.computeB(b);h[w]=1/z.computeC()}if(0!==n){for(w=0;w!==v;w++)z=t[w],d=z.wlambda,z.vlambda.set(0,0,0),d&&d.set(0,0,0);for(d=0;d!==e;d++){for(var F=w=0;F!==n;F++)z=l[F],x=k[F],A=h[F],B=f[F],D=z.computeGWlambda(),x=A*(x-D-z.eps*B),B+x<z.minForce?x=z.minForce-B:B+x>z.maxForce&&(x=z.maxForce-B),f[F]+=x,w+=0<x?x:-x,z.addToWlambda(x);if(w*w<g)break}for(w=0;w!==v;w++)z=t[w],e=z.velocity,g=z.angularVelocity,e.vadd(z.vlambda,e),g&&
g.vadd(z.wlambda,g)}return d}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(b,c,e){function d(){this.equations=[]}c.exports=d;d.prototype.solve=function(b,c){return 0};d.prototype.addEquation=function(b){b.enabled&&this.equations.push(b)};d.prototype.removeEquation=function(b){var c=this.equations;b=c.indexOf(b);-1!==b&&c.splice(b,1)};d.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(b,c,e){function d(b){k.call(this);this.iterations=10;
this.tolerance=1E-7;this.subsolver=b;this.nodes=[];for(this.nodePool=[];128>this.nodePool.length;)this.nodePool.push(this.createNode())}function g(b){for(var c=b.length,d=0;d!==c;d++){var e=b[d];if(!(e.visited||e.body.type&m))return e}return!1}function f(b,c,d){c.push(b.body);c=b.eqs.length;for(var e=0;e!==c;e++){var f=b.eqs[e];-1===d.indexOf(f)&&d.push(f)}}function h(b,c){return c.id-b.id}c.exports=d;b("../math/Vec3");b("../math/Quaternion");var k=b("./Solver");b=b("../objects/Body");d.prototype=
new k;var l=[],n=[],q={bodies:[]},m=b.STATIC,p=[];d.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}};d.prototype.solve=function(b,c){for(var d=this.nodePool,e=c.bodies,m=this.equations,k=m.length,r=e.length,u=this.subsolver;d.length<r;)d.push(this.createNode());l.length=r;for(var B=0;B<r;B++)l[B]=d[B];for(B=0;B!==r;B++)d=l[B],d.body=e[B],d.children.length=0,d.eqs.length=0,d.visited=!1;for(r=0;r!==k;r++){var d=m[r],B=e.indexOf(d.bi),z=e.indexOf(d.bj),B=l[B],z=l[z];B.children.push(z);
B.eqs.push(d);z.children.push(B);z.eqs.push(d)}e=0;m=n;u.tolerance=this.tolerance;for(u.iterations=this.iterations;B=g(l);){m.length=0;q.bodies.length=0;d=B;B=f;k=q.bodies;r=m;p.push(d);d.visited=!0;for(B(d,k,r);p.length;)for(d=p.pop();z=g(d.children);)z.visited=!0,B(z,k,r),p.push(z);k=m.length;m=m.sort(h);for(B=0;B!==k;B++)u.addEquation(m[B]);u.solve(b,q);u.removeAllEquations();e++}return e}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(b,c,e){b=function(){};
c.exports=b;b.prototype={constructor:b,addEventListener:function(b,c){void 0===this._listeners&&(this._listeners={});var d=this._listeners;void 0===d[b]&&(d[b]=[]);-1===d[b].indexOf(c)&&d[b].push(c);return this},hasEventListener:function(b,c){if(void 0===this._listeners)return!1;var d=this._listeners;return void 0!==d[b]&&-1!==d[b].indexOf(c)?!0:!1},removeEventListener:function(b,c){if(void 0===this._listeners)return this;var d=this._listeners;if(void 0===d[b])return this;var e=d[b].indexOf(c);-1!==
e&&d[b].splice(e,1);return this},dispatchEvent:function(b){if(void 0===this._listeners)return this;var c=this._listeners[b.type];if(void 0!==c){b.target=this;for(var d=0,e=c.length;d<e;d++)c[d].call(this,b)}return this}}},{}],50:[function(b,c,e){function d(b){b=b||{};this.root=b.root||null;this.aabb=b.aabb?b.aabb.clone():new f;this.data=[];this.children=[]}function g(b,c){c=c||{};c.root=null;c.aabb=b;d.call(this,c);this.maxDepth="undefined"!==typeof c.maxDepth?c.maxDepth:8}var f=b("../collision/AABB"),
h=b("../math/Vec3");c.exports=g;g.prototype=new d;d.prototype.reset=function(b,c){this.children.length=this.data.length=0};d.prototype.insert=function(b,c,d){var e=this.data;d=d||0;if(!this.aabb.contains(b))return!1;var f=this.children;if(d<(this.maxDepth||this.root.maxDepth)){var g=!1;f.length||(this.subdivide(),g=!0);for(var h=0;8!==h;h++)if(f[h].insert(b,c,d+1))return!0;g&&(f.length=0)}e.push(c);return!0};var k=new h;d.prototype.subdivide=function(){var b=this.aabb,c=b.lowerBound,e=b.upperBound,
b=this.children;b.push(new d({aabb:new f({lowerBound:new h(0,0,0)})}),new d({aabb:new f({lowerBound:new h(1,0,0)})}),new d({aabb:new f({lowerBound:new h(1,1,0)})}),new d({aabb:new f({lowerBound:new h(1,1,1)})}),new d({aabb:new f({lowerBound:new h(0,1,1)})}),new d({aabb:new f({lowerBound:new h(0,0,1)})}),new d({aabb:new f({lowerBound:new h(1,0,1)})}),new d({aabb:new f({lowerBound:new h(0,1,0)})}));e.vsub(c,k);k.scale(.5,k);for(var e=this.root||this,g=0;8!==g;g++){var l=b[g];l.root=e;var u=l.aabb.lowerBound;
u.x*=k.x;u.y*=k.y;u.z*=k.z;u.vadd(c,u);u.vadd(k,l.aabb.upperBound)}};d.prototype.aabbQuery=function(b,c){for(var d=[this];d.length;){var e=d.pop();e.aabb.overlaps(b)&&Array.prototype.push.apply(c,e.data);Array.prototype.push.apply(d,e.children)}return c};var l=new f;d.prototype.rayQuery=function(b,c,d){b.getAABB(l);l.toLocalFrame(c,l);this.aabbQuery(l,d);return d};d.prototype.removeEmptyNodes=function(){for(var b=[this];b.length;){for(var c=b.pop(),d=c.children.length-1;0<=d;d--)c.children[d].data.length||
c.children.splice(d,1);Array.prototype.push.apply(b,c.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(b,c,e){function d(){this.objects=[];this.type=Object}c.exports=d;d.prototype.release=function(){for(var b=arguments.length,c=0;c!==b;c++)this.objects.push(arguments[c])};d.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()};d.prototype.constructObject=function(){throw Error("constructObject() not implemented in this Pool subclass yet!");
}},{}],52:[function(b,c,e){function d(){this.data={keys:[]}}c.exports=d;d.prototype.get=function(b,c){if(b>c){var d=c;c=b;b=d}return this.data[b+"-"+c]};d.prototype.set=function(b,c,d){if(b>c){var e=c;c=b;b=e}e=b+"-"+c;this.get(b,c)||this.data.keys.push(e);this.data[e]=d};d.prototype.reset=function(){for(var b=this.data,c=b.keys;0<c.length;){var d=c.pop();delete b[d]}}},{}],53:[function(b,c,e){function d(){}c.exports=d;d.defaults=function(b,c){b=b||{};for(var d in c)d in b||(b[d]=c[d]);return b}},
{}],54:[function(b,c,e){function d(){f.call(this);this.type=g}c.exports=d;var g=b("../math/Vec3"),f=b("./Pool");d.prototype=new f;d.prototype.constructObject=function(){return new g}},{"../math/Vec3":30,"./Pool":51}],55:[function(b,c,e){function d(b){this.contactPointPool=[];this.frictionEquationPool=[];this.result=[];this.frictionResult=[];this.v3pool=new l;this.world=b;this.currentContactMaterial=null;this.enableFrictionReduction=!1}c.exports=d;c=b("../collision/AABB");e=b("../shapes/Shape");var g=
b("../collision/Ray"),f=b("../math/Vec3"),h=b("../math/Transform");b("../shapes/ConvexPolyhedron");var k=b("../math/Quaternion");b("../solver/Solver");var l=b("../utils/Vec3Pool"),n=b("../equations/ContactEquation"),q=b("../equations/FrictionEquation");d.prototype.createContactEquation=function(b,c,d,e,f,g){var h;this.contactPointPool.length?(h=this.contactPointPool.pop(),h.bi=b,h.bj=c):h=new n(b,c);h.enabled=b.collisionResponse&&c.collisionResponse&&d.collisionResponse&&e.collisionResponse;var m=
this.currentContactMaterial;h.restitution=m.restitution;h.setSpookParams(m.contactEquationStiffness,m.contactEquationRelaxation,this.world.dt);b=d.material||b.material;c=e.material||c.material;b&&c&&0<=b.restitution&&0<=c.restitution&&(h.restitution=b.restitution*c.restitution);h.si=f||d;h.sj=g||e;return h};d.prototype.createFrictionEquationsFromContact=function(b,c){var d=b.bi,e=b.bj,f=this.world,g=this.currentContactMaterial,h=g.friction,m=b.si.material||d.material,k=b.sj.material||e.material;m&&
k&&0<=m.friction&&0<=k.friction&&(h=m.friction*k.friction);if(0<h){h*=f.gravity.length();m=d.invMass+e.invMass;0<m&&(m=1/m);var l=this.frictionEquationPool,k=l.length?l.pop():new q(d,e,h*m),l=l.length?l.pop():new q(d,e,h*m);k.bi=l.bi=d;k.bj=l.bj=e;k.minForce=l.minForce=-h*m;k.maxForce=l.maxForce=h*m;k.ri.copy(b.ri);k.rj.copy(b.rj);l.ri.copy(b.ri);l.rj.copy(b.rj);b.ni.tangents(k.t,l.t);k.setSpookParams(g.frictionEquationStiffness,g.frictionEquationRelaxation,f.dt);l.setSpookParams(g.frictionEquationStiffness,
g.frictionEquationRelaxation,f.dt);k.enabled=l.enabled=b.enabled;c.push(k,l);return!0}return!1};var m=new f,p=new f,r=new f;d.prototype.createFrictionFromAverage=function(b){var c=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(c,this.frictionResult)&&1!==b){var d=this.frictionResult[this.frictionResult.length-2],e=this.frictionResult[this.frictionResult.length-1];m.setZero();p.setZero();r.setZero();for(var f=c.bi,g=0;g!==b;g++)c=this.result[this.result.length-1-g],c.bodyA!==
f?(m.vadd(c.ni,m),p.vadd(c.ri,p),r.vadd(c.rj,r)):(m.vsub(c.ni,m),p.vadd(c.rj,p),r.vadd(c.ri,r));b=1/b;p.scale(b,d.ri);r.scale(b,d.rj);e.ri.copy(d.ri);e.rj.copy(d.rj);m.normalize();m.tangents(d.t,e.t)}};var u=new f,t=new f,v=new k,x=new k;d.prototype.getContacts=function(b,c,d,e,f,g,h){this.contactPointPool=f;this.frictionEquationPool=h;this.result=e;this.frictionResult=g;e=0;for(f=b.length;e!==f;e++){g=b[e];h=c[e];var m=null;g.material&&h.material&&(m=d.getContactMaterial(g.material,h.material)||
null);for(var k=0;k<g.shapes.length;k++){g.quaternion.mult(g.shapeOrientations[k],v);g.quaternion.vmult(g.shapeOffsets[k],u);u.vadd(g.position,u);for(var l=g.shapes[k],p=0;p<h.shapes.length;p++){h.quaternion.mult(h.shapeOrientations[p],x);h.quaternion.vmult(h.shapeOffsets[p],t);t.vadd(h.position,t);var r=h.shapes[p];if(!(u.distanceTo(t)>l.boundingSphereRadius+r.boundingSphereRadius)){var n=null;l.material&&r.material&&(n=d.getContactMaterial(l.material,r.material)||null);this.currentContactMaterial=
n||m||d.defaultContactMaterial;(n=this[l.type|r.type])&&(l.type<r.type?n.call(this,l,r,u,t,v,x,g,h,l,r):n.call(this,r,l,t,u,x,v,h,g,l,r))}}}}};d.prototype[e.types.BOX|e.types.BOX]=d.prototype.boxBox=function(b,c,d,e,f,g,h,m){b.convexPolyhedronRepresentation.material=b.material;c.convexPolyhedronRepresentation.material=c.material;b.convexPolyhedronRepresentation.collisionResponse=b.collisionResponse;c.convexPolyhedronRepresentation.collisionResponse=c.collisionResponse;this.convexConvex(b.convexPolyhedronRepresentation,
c.convexPolyhedronRepresentation,d,e,f,g,h,m,b,c)};d.prototype[e.types.BOX|e.types.CONVEXPOLYHEDRON]=d.prototype.boxConvex=function(b,c,d,e,f,g,h,m){b.convexPolyhedronRepresentation.material=b.material;b.convexPolyhedronRepresentation.collisionResponse=b.collisionResponse;this.convexConvex(b.convexPolyhedronRepresentation,c,d,e,f,g,h,m,b,c)};d.prototype[e.types.BOX|e.types.PARTICLE]=d.prototype.boxParticle=function(b,c,d,e,f,g,h,m){b.convexPolyhedronRepresentation.material=b.material;b.convexPolyhedronRepresentation.collisionResponse=
b.collisionResponse;this.convexParticle(b.convexPolyhedronRepresentation,c,d,e,f,g,h,m,b,c)};d.prototype[e.types.SPHERE]=d.prototype.sphereSphere=function(b,c,d,e,f,g,h,m){f=this.createContactEquation(h,m,b,c);e.vsub(d,f.ni);f.ni.normalize();f.ri.copy(f.ni);f.rj.copy(f.ni);f.ri.mult(b.radius,f.ri);f.rj.mult(-c.radius,f.rj);f.ri.vadd(d,f.ri);f.ri.vsub(h.position,f.ri);f.rj.vadd(e,f.rj);f.rj.vsub(m.position,f.rj);this.result.push(f);this.createFrictionEquationsFromContact(f,this.frictionResult)};var A=
new f,w=new f,D=new f;d.prototype[e.types.PLANE|e.types.TRIMESH]=d.prototype.planeTrimesh=function(b,c,d,e,g,m,k,l){var p=new f;A.set(0,0,1);g.vmult(A,A);for(g=0;g<c.vertices.length/3;g++){c.getVertex(g,p);var r=new f;r.copy(p);h.pointToWorldFrame(e,m,r,p);r=w;p.vsub(d,r);if(0>=A.dot(r)){var n=this.createContactEquation(k,l,b,c);n.ni.copy(A);var q=D;A.scale(r.dot(A),q);p.vsub(q,q);n.ri.copy(q);n.ri.vsub(k.position,n.ri);n.rj.copy(p);n.rj.vsub(l.position,n.rj);this.result.push(n);this.createFrictionEquationsFromContact(n,
this.frictionResult)}}};var B=new f,z=new f;new f;var F=new f,G=new f,C=new f,L=new f,K=new f,H=new f,M=new f,E=new f,J=new f,N=new f,P=new f,Q=new c,O=[];d.prototype[e.types.SPHERE|e.types.TRIMESH]=d.prototype.sphereTrimesh=function(b,c,d,e,f,m,k,l){h.pointToLocalFrame(e,m,d,M);f=b.radius;Q.lowerBound.set(M.x-f,M.y-f,M.z-f);Q.upperBound.set(M.x+f,M.y+f,M.z+f);c.getTrianglesInAABB(Q,O);var p=b.radius*b.radius;for(f=0;f<O.length;f++)for(var r=0;3>r;r++)if(c.getVertex(c.indices[3*O[f]+r],F),F.vsub(M,
z),z.norm2()<=p){G.copy(F);h.pointToWorldFrame(e,m,G,F);F.vsub(d,z);var n=this.createContactEquation(k,l,b,c);n.ni.copy(z);n.ni.normalize();n.ri.copy(n.ni);n.ri.scale(b.radius,n.ri);n.ri.vadd(d,n.ri);n.ri.vsub(k.position,n.ri);n.rj.copy(F);n.rj.vsub(l.position,n.rj);this.result.push(n);this.createFrictionEquationsFromContact(n,this.frictionResult)}for(f=0;f<O.length;f++)for(r=0;3>r;r++)c.getVertex(c.indices[3*O[f]+r],C),c.getVertex(c.indices[3*O[f]+(r+1)%3],L),L.vsub(C,K),M.vsub(L,E),d=E.dot(K),M.vsub(C,
E),n=E.dot(K),0<n&&0>d&&(M.vsub(C,E),H.copy(K),H.normalize(),n=E.dot(H),H.scale(n,E),E.vadd(C,E),d=E.distanceTo(M),d<b.radius&&(n=this.createContactEquation(k,l,b,c),E.vsub(M,n.ni),n.ni.normalize(),n.ni.scale(b.radius,n.ri),h.pointToWorldFrame(e,m,E,E),E.vsub(l.position,n.rj),h.vectorToWorldFrame(m,n.ni,n.ni),h.vectorToWorldFrame(m,n.ri,n.ri),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)));f=0;for(r=O.length;f!==r;f++)c.getTriangleVertices(O[f],J,N,P),c.getNormal(O[f],
B),M.vsub(J,E),d=E.dot(B),B.scale(d,E),M.vsub(E,E),d=E.distanceTo(M),g.pointInTriangle(E,J,N,P)&&d<b.radius&&(n=this.createContactEquation(k,l,b,c),E.vsub(M,n.ni),n.ni.normalize(),n.ni.scale(b.radius,n.ri),h.pointToWorldFrame(e,m,E,E),E.vsub(l.position,n.rj),h.vectorToWorldFrame(m,n.ni,n.ni),h.vectorToWorldFrame(m,n.ri,n.ri),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult));O.length=0};var S=new f,I=new f;d.prototype[e.types.SPHERE|e.types.PLANE]=d.prototype.spherePlane=
function(b,c,d,e,f,g,h,m){c=this.createContactEquation(h,m,b,c);c.ni.set(0,0,1);g.vmult(c.ni,c.ni);c.ni.negate(c.ni);c.ni.normalize();c.ni.mult(b.radius,c.ri);d.vsub(e,S);c.ni.mult(c.ni.dot(S),I);S.vsub(I,c.rj);-S.dot(c.ni)<=b.radius&&(b=c.ri,g=c.rj,b.vadd(d,b),b.vsub(h.position,b),g.vadd(e,g),g.vsub(m.position,g),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult))};var ba=new f,R=new f,V=new f,X=new f,aa=new f,U=new f,T=new f,Y=[new f,new f,new f,new f,new f,new f],
fa=new f,ka=new f,ca=new f,la=new f;d.prototype[e.types.SPHERE|e.types.BOX]=d.prototype.sphereBox=function(b,c,d,e,f,g,h,m){f=this.v3pool;d.vsub(e,X);c.getSideNormals(Y,g);g=b.radius;for(var k=!1,l=null,p=0,r=0,n=0,q=null,u=0,t=Y.length;u!==t&&!1===k;u++){var v=aa;v.copy(Y[u]);var x=v.norm();v.normalize();var w=X.dot(v);if(w<x+g&&0<w){var ta=U,B=T;ta.copy(Y[(u+1)%3]);B.copy(Y[(u+2)%3]);var A=ta.norm(),D=B.norm();ta.normalize();B.normalize();var z=X.dot(ta),Pa=X.dot(B);z<A&&z>-A&&Pa<D&&Pa>-D&&(w=Math.abs(w-
x-g),null===q||w<q)&&(q=w,r=z,n=Pa,l=x,ka.copy(v),ca.copy(ta),la.copy(B),p++)}}p&&(k=!0,p=this.createContactEquation(h,m,b,c),ka.mult(-g,p.ri),p.ni.copy(ka),p.ni.negate(p.ni),ka.mult(l,ka),ca.mult(r,ca),ka.vadd(ca,ka),la.mult(n,la),ka.vadd(la,p.rj),p.ri.vadd(d,p.ri),p.ri.vsub(h.position,p.ri),p.rj.vadd(e,p.rj),p.rj.vsub(m.position,p.rj),this.result.push(p),this.createFrictionEquationsFromContact(p,this.frictionResult));w=f.get();for(l=0;2!==l&&!k;l++)for(r=0;2!==r&&!k;r++)for(n=0;2!==n&&!k;n++)w.set(0,
0,0),l?w.vadd(Y[0],w):w.vsub(Y[0],w),r?w.vadd(Y[1],w):w.vsub(Y[1],w),n?w.vadd(Y[2],w):w.vsub(Y[2],w),e.vadd(w,fa),fa.vsub(d,fa),fa.norm2()<g*g&&(k=!0,p=this.createContactEquation(h,m,b,c),p.ri.copy(fa),p.ri.normalize(),p.ni.copy(p.ri),p.ri.mult(g,p.ri),p.rj.copy(w),p.ri.vadd(d,p.ri),p.ri.vsub(h.position,p.ri),p.rj.vadd(e,p.rj),p.rj.vsub(m.position,p.rj),this.result.push(p),this.createFrictionEquationsFromContact(p,this.frictionResult));f.release(w);q=f.get();u=f.get();p=f.get();t=f.get();w=f.get();
v=Y.length;for(l=0;l!==v&&!k;l++)for(r=0;r!==v&&!k;r++)if(l%3!==r%3){Y[r].cross(Y[l],q);q.normalize();Y[l].vadd(Y[r],u);p.copy(d);p.vsub(u,p);p.vsub(e,p);x=p.dot(q);q.mult(x,t);for(n=0;n===l%3||n===r%3;)n++;w.copy(d);w.vsub(t,w);w.vsub(u,w);w.vsub(e,w);x=Math.abs(x);ta=w.norm();x<Y[n].norm()&&ta<g&&(k=!0,n=this.createContactEquation(h,m,b,c),u.vadd(t,n.rj),n.rj.copy(n.rj),w.negate(n.ni),n.ni.normalize(),n.ri.copy(n.rj),n.ri.vadd(e,n.ri),n.ri.vsub(d,n.ri),n.ri.normalize(),n.ri.mult(g,n.ri),n.ri.vadd(d,
n.ri),n.ri.vsub(h.position,n.ri),n.rj.vadd(e,n.rj),n.rj.vsub(m.position,n.rj),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult))}f.release(q,u,p,t,w)};var ha=new f,ga=new f,qa=new f,pa=new f,va=new f,ma=new f,na=new f,ra=new f,ya=new f,sa=new f;d.prototype[e.types.SPHERE|e.types.CONVEXPOLYHEDRON]=d.prototype.sphereConvex=function(b,c,d,e,f,g,h,m){f=this.v3pool;d.vsub(e,ha);for(var k=c.faceNormals,l=c.faces,p=c.vertices,r=b.radius,n=0;n!==p.length;n++){var q=va;g.vmult(p[n],
q);e.vadd(q,q);var u=pa;q.vsub(d,u);if(u.norm2()<r*r){b=this.createContactEquation(h,m,b,c);b.ri.copy(u);b.ri.normalize();b.ni.copy(b.ri);b.ri.mult(r,b.ri);q.vsub(e,b.rj);b.ri.vadd(d,b.ri);b.ri.vsub(h.position,b.ri);b.rj.vadd(e,b.rj);b.rj.vsub(m.position,b.rj);this.result.push(b);this.createFrictionEquationsFromContact(b,this.frictionResult);return}}n=0;for(q=l.length;n!==q;n++){var u=l[n],t=ma;g.vmult(k[n],t);var v=na;g.vmult(p[u[0]],v);v.vadd(e,v);var x=ra;t.mult(-r,x);d.vadd(x,x);var w=ya;x.vsub(v,
w);x=w.dot(t);w=sa;d.vsub(v,w);if(0>x&&0<w.dot(t)){for(var v=[],w=0,ta=u.length;w!==ta;w++){var B=f.get();g.vmult(p[u[w]],B);e.vadd(B,B);v.push(B)}a:{for(var w=v,ta=t,B=d,A=null,D=w.length,z=0;z!==D;z++){var Pa=w[z],G=ba;w[(z+1)%D].vsub(Pa,G);var N=R;G.cross(ta,N);G=V;B.vsub(Pa,G);Pa=N.dot(G);if(null===A||0<Pa&&!0===A||0>=Pa&&!1===A)null===A&&(A=0<Pa);else{w=!1;break a}}w=!0}if(w){b=this.createContactEquation(h,m,b,c);t.mult(-r,b.ri);t.negate(b.ni);c=f.get();t.mult(-x,c);g=f.get();t.mult(-r,g);d.vsub(e,
b.rj);b.rj.vadd(g,b.rj);b.rj.vadd(c,b.rj);b.rj.vadd(e,b.rj);b.rj.vsub(m.position,b.rj);b.ri.vadd(d,b.ri);b.ri.vsub(h.position,b.ri);f.release(c);f.release(g);this.result.push(b);this.createFrictionEquationsFromContact(b,this.frictionResult);w=0;for(u=v.length;w!==u;w++)f.release(v[w]);break}else for(w=0;w!==u.length;w++){t=f.get();x=f.get();g.vmult(p[u[(w+1)%u.length]],t);g.vmult(p[u[(w+2)%u.length]],x);e.vadd(t,t);e.vadd(x,x);D=ga;x.vsub(t,D);A=qa;D.unit(A);ta=f.get();B=f.get();d.vsub(t,B);z=B.dot(A);
A.mult(z,ta);ta.vadd(t,ta);A=f.get();ta.vsub(d,A);if(0<z&&z*z<D.norm2()&&A.norm2()<r*r){b=this.createContactEquation(h,m,b,c);ta.vsub(e,b.rj);ta.vsub(d,b.ni);b.ni.normalize();b.ni.mult(r,b.ri);b.rj.vadd(e,b.rj);b.rj.vsub(m.position,b.rj);b.ri.vadd(d,b.ri);b.ri.vsub(h.position,b.ri);this.result.push(b);this.createFrictionEquationsFromContact(b,this.frictionResult);w=0;for(u=v.length;w!==u;w++)f.release(v[w]);f.release(t);f.release(x);f.release(ta);f.release(A);f.release(B);return}f.release(t);f.release(x);
f.release(ta);f.release(A);f.release(B)}w=0;for(u=v.length;w!==u;w++)f.release(v[w])}}};new f;new f;d.prototype[e.types.PLANE|e.types.BOX]=d.prototype.planeBox=function(b,c,d,e,f,g,h,m){c.convexPolyhedronRepresentation.material=c.material;c.convexPolyhedronRepresentation.collisionResponse=c.collisionResponse;this.planeConvex(b,c.convexPolyhedronRepresentation,d,e,f,g,h,m)};var oa=new f,da=new f,wa=new f,Ja=new f;d.prototype[e.types.PLANE|e.types.CONVEXPOLYHEDRON]=d.prototype.planeConvex=function(b,
c,d,e,f,g,h,m){da.set(0,0,1);f.vmult(da,da);for(var k=f=0;k!==c.vertices.length;k++)if(oa.copy(c.vertices[k]),g.vmult(oa,oa),e.vadd(oa,oa),oa.vsub(d,wa),0>=da.dot(wa)){var l=this.createContactEquation(h,m,b,c),p=Ja;da.mult(da.dot(wa),p);oa.vsub(p,p);p.vsub(d,l.ri);l.ni.copy(da);oa.vsub(e,l.rj);l.ri.vadd(d,l.ri);l.ri.vsub(h.position,l.ri);l.rj.vadd(e,l.rj);l.rj.vsub(m.position,l.rj);this.result.push(l);f++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(l,this.frictionResult)}this.enableFrictionReduction&&
f&&this.createFrictionFromAverage(f)};var Na=new f,ua=new f;d.prototype[e.types.CONVEXPOLYHEDRON]=d.prototype.convexConvex=function(b,c,d,e,f,g,h,m,k,l,p,r){if(!(d.distanceTo(e)>b.boundingSphereRadius+c.boundingSphereRadius)&&b.findSeparatingAxis(c,d,f,e,g,Na,p,r)){p=[];b.clipAgainstHull(d,f,c,e,g,Na,-100,100,p);for(g=f=0;g!==p.length;g++){r=this.createContactEquation(h,m,b,c,k,l);var n=r.ri,q=r.rj;Na.negate(r.ni);p[g].normal.negate(ua);ua.mult(p[g].depth,ua);p[g].point.vadd(ua,n);q.copy(p[g].point);
n.vsub(d,n);q.vsub(e,q);n.vadd(d,n);n.vsub(h.position,n);q.vadd(e,q);q.vsub(m.position,q);this.result.push(r);f++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(r,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)}};var Z=new f,Ka=new f,ia=new f;d.prototype[e.types.PLANE|e.types.PARTICLE]=d.prototype.planeParticle=function(b,c,d,e,f,g,h,m){Z.set(0,0,1);h.quaternion.vmult(Z,Z);e.vsub(h.position,Ka);0>=Z.dot(Ka)&&(b=this.createContactEquation(m,
h,c,b),b.ni.copy(Z),b.ni.negate(b.ni),b.ri.set(0,0,0),Z.mult(Z.dot(e),ia),e.vsub(ia,ia),b.rj.copy(ia),this.result.push(b),this.createFrictionEquationsFromContact(b,this.frictionResult))};var y=new f;d.prototype[e.types.PARTICLE|e.types.SPHERE]=d.prototype.sphereParticle=function(b,c,d,e,f,g,h,m){y.set(0,0,1);e.vsub(d,y);y.norm2()<=b.radius*b.radius&&(c=this.createContactEquation(m,h,c,b),y.normalize(),c.rj.copy(y),c.rj.mult(b.radius,c.rj),c.ni.copy(y),c.ni.negate(c.ni),c.ri.set(0,0,0),this.result.push(c),
this.createFrictionEquationsFromContact(c,this.frictionResult))};var ea=new k,xa=new f;new f;var W=new f,ja=new f,La=new f;d.prototype[e.types.PARTICLE|e.types.CONVEXPOLYHEDRON]=d.prototype.convexParticle=function(b,c,d,e,f,g,h,m){var k=-1;g=null;var l=0;xa.copy(e);xa.vsub(d,xa);f.conjugate(ea);ea.vmult(xa,xa);if(b.pointIsInside(xa)){b.worldVerticesNeedsUpdate&&b.computeWorldVertices(d,f);b.worldFaceNormalsNeedsUpdate&&b.computeWorldFaceNormals(f);f=0;for(var p=b.faces.length;f!==p;f++){var r=b.worldFaceNormals[f];
e.vsub(b.worldVertices[b.faces[f][0]],ja);var n=-r.dot(ja);if(null===g||Math.abs(n)<Math.abs(g))g=n,k=f,W.copy(r),l++}-1!==k?(b=this.createContactEquation(m,h,c,b),W.mult(g,La),La.vadd(e,La),La.vsub(d,La),b.rj.copy(La),W.negate(b.ni),b.ri.set(0,0,0),c=b.ri,g=b.rj,c.vadd(e,c),c.vsub(m.position,c),g.vadd(d,g),g.vsub(h.position,g),this.result.push(b),this.createFrictionEquationsFromContact(b,this.frictionResult)):console.warn("Point found inside convex, but did not find penetrating face!")}};d.prototype[e.types.BOX|
e.types.HEIGHTFIELD]=d.prototype.boxHeightfield=function(b,c,d,e,f,g,h,m){b.convexPolyhedronRepresentation.material=b.material;b.convexPolyhedronRepresentation.collisionResponse=b.collisionResponse;this.convexHeightfield(b.convexPolyhedronRepresentation,c,d,e,f,g,h,m)};var Ha=new f,za=new f,Ma=[0];d.prototype[e.types.CONVEXPOLYHEDRON|e.types.HEIGHTFIELD]=d.prototype.convexHeightfield=function(b,c,d,e,f,g,m,k){var l=c.data,p=c.elementSize,r=b.boundingSphereRadius;h.pointToLocalFrame(e,g,d,Ha);var n=
Math.floor((Ha.x-r)/p)-1,q=Math.ceil((Ha.x+r)/p)+1,u=Math.floor((Ha.y-r)/p)-1,p=Math.ceil((Ha.y+r)/p)+1;if(!(0>q||0>p||n>l.length||u>l[0].length)){0>n&&(n=0);0>q&&(q=0);0>u&&(u=0);0>p&&(p=0);n>=l.length&&(n=l.length-1);q>=l.length&&(q=l.length-1);p>=l[0].length&&(p=l[0].length-1);u>=l[0].length&&(u=l[0].length-1);l=[];c.getRectMinMax(n,u,q,p,l);var t=l[0];if(!(Ha.z-r>l[1]||Ha.z+r<t))for(r=n;r<q;r++)for(n=u;n<p;n++)c.getConvexTrianglePillar(r,n,!1),h.pointToWorldFrame(e,g,c.pillarOffset,za),d.distanceTo(za)<
c.pillarConvex.boundingSphereRadius+b.boundingSphereRadius&&this.convexConvex(b,c.pillarConvex,d,za,f,g,m,k,null,null,Ma,null),c.getConvexTrianglePillar(r,n,!0),h.pointToWorldFrame(e,g,c.pillarOffset,za),d.distanceTo(za)<c.pillarConvex.boundingSphereRadius+b.boundingSphereRadius&&this.convexConvex(b,c.pillarConvex,d,za,f,g,m,k,null,null,Ma,null)}};var Ca=new f,Ea=new f;d.prototype[e.types.SPHERE|e.types.HEIGHTFIELD]=d.prototype.sphereHeightfield=function(b,c,d,e,f,g,m,k){var l=c.data,p=b.radius,r=
c.elementSize;h.pointToLocalFrame(e,g,d,Ca);var n=Math.floor((Ca.x-p)/r)-1,q=Math.ceil((Ca.x+p)/r)+1,u=Math.floor((Ca.y-p)/r)-1,r=Math.ceil((Ca.y+p)/r)+1;if(!(0>q||0>r||n>l.length||r>l[0].length)){0>n&&(n=0);0>q&&(q=0);0>u&&(u=0);0>r&&(r=0);n>=l.length&&(n=l.length-1);q>=l.length&&(q=l.length-1);r>=l[0].length&&(r=l[0].length-1);u>=l[0].length&&(u=l[0].length-1);l=[];c.getRectMinMax(n,u,q,r,l);var t=l[0];if(!(Ca.z-p>l[1]||Ca.z+p<t))for(p=this.result;n<q;n++)for(l=u;l<r;l++)if(t=p.length,c.getConvexTrianglePillar(n,
l,!1),h.pointToWorldFrame(e,g,c.pillarOffset,Ea),d.distanceTo(Ea)<c.pillarConvex.boundingSphereRadius+b.boundingSphereRadius&&this.sphereConvex(b,c.pillarConvex,d,Ea,f,g,m,k),c.getConvexTrianglePillar(n,l,!0),h.pointToWorldFrame(e,g,c.pillarOffset,Ea),d.distanceTo(Ea)<c.pillarConvex.boundingSphereRadius+b.boundingSphereRadius&&this.sphereConvex(b,c.pillarConvex,d,Ea,f,g,m,k),2<p.length-t)return}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,
"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(b,c,e){function d(){k.apply(this);this.dt=-1;this.allowSleep=!1;this.contacts=[];this.frictionEquations=[];this.quatNormalizeSkip=0;this.quatNormalizeFast=!1;this.stepnumber=this.time=0;this.default_dt=1/60;this.nextId=0;this.gravity=new g;this.broadphase=new t;this.bodies=[];this.solver=new f;this.constraints=[];this.narrowphase=
new h(this);this.collisionMatrix=new l;this.collisionMatrixPrevious=new l;this.materials=[];this.contactmaterials=[];this.contactMaterialTable=new p;this.defaultMaterial=new n("default");this.defaultContactMaterial=new q(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0});this.doProfiling=!1;this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0};this.subsystems=[];this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",
body:null}}c.exports=d;b("../shapes/Shape");var g=b("../math/Vec3");c=b("../math/Quaternion");var f=b("../solver/GSSolver");b("../utils/Vec3Pool");b("../equations/ContactEquation");b("../equations/FrictionEquation");var h=b("./Narrowphase"),k=b("../utils/EventTarget"),l=b("../collision/ArrayCollisionMatrix"),n=b("../material/Material"),q=b("../material/ContactMaterial"),m=b("../objects/Body"),p=b("../utils/TupleDictionary"),r=b("../collision/RaycastResult");e=b("../collision/AABB");var u=b("../collision/Ray"),
t=b("../collision/NaiveBroadphase");d.prototype=new k;new e;var v=new u;d.prototype.getContactMaterial=function(b,c){return this.contactMaterialTable.get(b.id,c.id)};d.prototype.numObjects=function(){return this.bodies.length};d.prototype.collisionMatrixTick=function(){var b=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix;this.collisionMatrix=b;this.collisionMatrix.reset()};d.prototype.add=d.prototype.addBody=function(b){-1===this.bodies.indexOf(b)&&(b.index=this.bodies.length,
this.bodies.push(b),b.world=this,b.initPosition.copy(b.position),b.initVelocity.copy(b.velocity),b.timeLastSleepy=this.time,b instanceof m&&(b.initAngularVelocity.copy(b.angularVelocity),b.initQuaternion.copy(b.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=b,this.dispatchEvent(this.addBodyEvent))};d.prototype.addConstraint=function(b){this.constraints.push(b)};d.prototype.removeConstraint=function(b){b=this.constraints.indexOf(b);-1!==b&&this.constraints.splice(b,
1)};d.prototype.rayTest=function(b,c,d){d instanceof r?this.raycastClosest(b,c,{skipBackfaces:!0},d):this.raycastAll(b,c,{skipBackfaces:!0},d)};d.prototype.raycastAll=function(b,c,d,e){d.mode=u.ALL;d.from=b;d.to=c;d.callback=e;return v.intersectWorld(this,d)};d.prototype.raycastAny=function(b,c,d,e){d.mode=u.ANY;d.from=b;d.to=c;d.result=e;return v.intersectWorld(this,d)};d.prototype.raycastClosest=function(b,c,d,e){d.mode=u.CLOSEST;d.from=b;d.to=c;d.result=e;return v.intersectWorld(this,d)};d.prototype.remove=
function(b){b.world=null;var c=this.bodies.length-1,d=this.bodies,e=d.indexOf(b);if(-1!==e){d.splice(e,1);for(e=0;e!==d.length;e++)d[e].index=e;this.collisionMatrix.setNumObjects(c);this.removeBodyEvent.body=b;this.dispatchEvent(this.removeBodyEvent)}};d.prototype.removeBody=d.prototype.remove;d.prototype.addMaterial=function(b){this.materials.push(b)};d.prototype.addContactMaterial=function(b){this.contactmaterials.push(b);this.contactMaterialTable.set(b.materials[0].id,b.materials[1].id,b)};"undefined"===
typeof performance&&(performance={});if(!performance.now){var x=Date.now();performance.timing&&performance.timing.navigationStart&&(x=performance.timing.navigationStart);performance.now=function(){return Date.now()-x}}var A=new g;d.prototype.step=function(b,c,d){d=d||10;c=c||0;if(0===c)this.internalStep(b),this.time+=b;else{var e=Math.floor((this.time+c)/b)-Math.floor(this.time/b),e=Math.min(e,d);d=performance.now();for(var f=0;f!==e&&!(this.internalStep(b),performance.now()-d>1E3*b);f++);this.time+=
c;b=this.time%b/b;c=this.bodies;for(e=0;e!==c.length;e++)d=c[e],d.type!==m.STATIC&&d.sleepState!==m.SLEEPING?(d.position.vsub(d.previousPosition,A),A.scale(b,A),d.position.vadd(A,d.interpolatedPosition)):(d.interpolatedPosition.copy(d.position),d.interpolatedQuaternion.copy(d.quaternion))}};var w={type:"postStep"},D={type:"preStep"},B={type:"collide",body:null,contact:null},z=[],F=[],G=[],C=[];new g;new g;new g;new g;new g;new g;new g;new g;new g;new c;var L=new c,K=new c,H=new g;d.prototype.internalStep=
function(b){this.dt=b;var c=this.contacts,d=this.numObjects(),e=this.bodies,f=this.solver,g=this.gravity,h=this.doProfiling,k=this.profile,l=m.DYNAMIC,p,r=this.constraints;g.norm();var n=g.x,q=g.y,u=g.z;h&&(p=performance.now());for(g=0;g!==d;g++){var t=e[g];if(t.type&l){var v=t.force,t=t.mass;v.x+=t*n;v.y+=t*q;v.z+=t*u}}g=0;for(t=this.subsystems.length;g!==t;g++)this.subsystems[g].update();h&&(p=performance.now());G.length=0;C.length=0;this.broadphase.collisionPairs(this,G,C);h&&(k.broadphase=performance.now()-
p);t=r.length;for(g=0;g!==t;g++)if(n=r[g],!n.collideConnected)for(q=G.length-1;0<=q;--q)if(n.bodyA===G[q]&&n.bodyB===C[q]||n.bodyB===G[q]&&n.bodyA===C[q])G.splice(q,1),C.splice(q,1);this.collisionMatrixTick();h&&(p=performance.now());t=c.length;for(g=0;g!==t;g++)z.push(c[g]);c.length=0;t=this.frictionEquations.length;for(g=0;g!==t;g++)F.push(this.frictionEquations[g]);this.frictionEquations.length=0;this.narrowphase.getContacts(G,C,this,c,z,this.frictionEquations,F);h&&(k.narrowphase=performance.now()-
p);h&&(p=performance.now());for(g=0;g<this.frictionEquations.length;g++)f.addEquation(this.frictionEquations[g]);g=c.length;for(q=0;q!==g;q++)n=c[q],t=n.bi,u=n.bj,t.material&&u.material&&this.getContactMaterial(t.material,u.material),t.material&&u.material&&0<=t.material.restitution&&0<=u.material.restitution&&(n.restitution=t.material.restitution*u.material.restitution),f.addEquation(n),t.allowSleep&&t.type===m.DYNAMIC&&t.sleepState===m.SLEEPING&&u.sleepState===m.AWAKE&&u.type!==m.STATIC&&u.velocity.norm2()+
u.angularVelocity.norm2()>=2*Math.pow(u.sleepSpeedLimit,2)&&(t._wakeUpAfterNarrowphase=!0),u.allowSleep&&u.type===m.DYNAMIC&&u.sleepState===m.SLEEPING&&t.sleepState===m.AWAKE&&t.type!==m.STATIC&&t.velocity.norm2()+t.angularVelocity.norm2()>=2*Math.pow(t.sleepSpeedLimit,2)&&(u._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(t,u,!0),this.collisionMatrixPrevious.get(t,u)||(B.body=u,B.contact=n,t.dispatchEvent(B),B.body=t,u.dispatchEvent(B));h&&(k.makeContactConstraints=performance.now()-p,p=performance.now());
for(g=0;g!==d;g++)t=e[g],t._wakeUpAfterNarrowphase&&(t.wakeUp(),t._wakeUpAfterNarrowphase=!1);t=r.length;for(g=0;g!==t;g++)for(n=r[g],n.update(),q=0,c=n.equations.length;q!==c;q++)f.addEquation(n.equations[q]);f.solve(b,this);h&&(k.solve=performance.now()-p);f.removeAllEquations();f=Math.pow;for(g=0;g!==d;g++)if(t=e[g],t.type&l&&(r=f(1-t.linearDamping,b),c=t.velocity,c.mult(r,c),r=t.angularVelocity))c=f(1-t.angularDamping,b),r.mult(c,r);this.dispatchEvent(D);for(g=0;g!==d;g++)t=e[g],t.preStep&&t.preStep.call(t);
h&&(p=performance.now());l=m.DYNAMIC|m.KINEMATIC;f=0===this.stepnumber%(this.quatNormalizeSkip+1);r=this.quatNormalizeFast;c=.5*b;for(g=0;g!==d;g++)if(t=e[g],n=t.force,q=t.torque,t.type&l&&t.sleepState!==m.SLEEPING){var u=t.velocity,v=t.angularVelocity,x=t.position,A=t.quaternion,M=t.invMass,ca=t.invInertiaWorld;u.x+=n.x*M*b;u.y+=n.y*M*b;u.z+=n.z*M*b;t.angularVelocity&&(ca.vmult(q,H),H.mult(b,H),H.vadd(v,v));x.x+=u.x*b;x.y+=u.y*b;x.z+=u.z*b;t.angularVelocity&&(L.set(v.x,v.y,v.z,0),L.mult(A,K),A.x+=
c*K.x,A.y+=c*K.y,A.z+=c*K.z,A.w+=c*K.w,f&&(r?A.normalizeFast():A.normalize()));t.aabb&&(t.aabbNeedsUpdate=!0);t.updateInertiaWorld&&t.updateInertiaWorld()}this.clearForces();this.broadphase.dirty=!0;h&&(k.integrate=performance.now()-p);this.time+=b;this.stepnumber+=1;this.dispatchEvent(w);for(g=0;g!==d;g++)t=e[g],(b=t.postStep)&&b.call(t);if(this.allowSleep)for(g=0;g!==d;g++)e[g].sleepTick(this.time)};d.prototype.clearForces=function(){for(var b=this.bodies,c=b.length,d=0;d!==c;d++){var e=b[d];e.force.set(0,
0,0);e.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},
{},[2])(2)});CANNON=CANNON||{};var camera,scene,s_oRayCasterMesh;
CANNON.Demo=function(a){function b(){if(A){for(var a in A.__controllers)A.__controllers[a].updateDisplay();for(var b in A.__folders)for(a in A.__folders[b].__controllers)A.__folders[b].__controllers[a].updateDisplay()}}function c(a){function b(a,c){a.material&&(a.material=c);for(var d=0;d<a.children.length;d++)b(a.children[d],c)}if(-1===S.indexOf(a))throw Error("Render mode "+a+" not found!");switch(a){case "solid":m.currentMaterial=F;I.intensity=1;ba.color.setHex(2236962);break;case "wireframe":m.currentMaterial=
G,I.intensity=0,ba.color.setHex(16777215)}for(var c=0;c<v.length;c++)b(v[c],m.currentMaterial);r.rendermode=a}function e(){for(var a=t.length,b=0;b<a;b++){var c=t[b];c.position.copy(c.initPosition);c.velocity.copy(c.initVelocity);c.initAngularVelocity&&(c.angularVelocity.copy(c.initAngularVelocity),c.quaternion.copy(c.initQuaternion))}}function d(a){0===a.x&&(a.x=1E-6);0===a.y&&(a.y=1E-6);0===a.z&&(a.z=1E-6)}function g(){for(var a=t.length,b=0;b<a;b++){var c=t[b],e=v[b];e.position.copy(c.position);
c.quaternion&&e.quaternion.copy(c.quaternion)}L.restart();if(r.contacts)for(b=0;b<O.contacts.length;b++)for(a=0;2>a;a++){var e=L.request(),f=O.contacts[b],c=0===a?f.bi:f.bj,g=0===a?f.ri:f.rj;e.position.set(c.position.x+g.x,c.position.y+g.y,c.position.z+g.z)}L.hideCached();K.restart();if(r.cm2contact)for(b=0;b<O.contacts.length;b++)for(a=0;2>a;a++)e=K.request(),f=O.contacts[b],c=0===a?f.bi:f.bj,g=0===a?f.ri:f.rj,e.scale.set(g.x,g.y,g.z),d(e.scale),e.position.copy(c.position);K.hideCached();J.restart();
N.restart();if(r.constraints){for(b=0;b<O.constraints.length;b++)f=O.constraints[b],f instanceof CANNON.DistanceConstraint&&(c=f.equations.normal,a=c.bi,c=c.bj,e=J.request(),c=c.position?c.position:c,e.scale.set(c.x-a.position.x,c.y-a.position.y,c.z-a.position.z),d(e.scale),e.position.copy(a.position));for(b=0;b<O.constraints.length;b++)if(f=O.constraints[b],f instanceof CANNON.PointToPointConstraint){var g=f.equations.normal,a=g.bi,c=g.bj,e=N.request(),f=N.request(),h=N.request();e.scale.set(g.ri.x,
g.ri.y,g.ri.z);f.scale.set(g.rj.x,g.rj.y,g.rj.z);h.scale.set(-g.penetrationVec.x,-g.penetrationVec.y,-g.penetrationVec.z);d(e.scale);d(f.scale);d(h.scale);e.position.copy(a.position);f.position.copy(c.position);g.bj.position.vadd(g.rj,h.position)}}N.hideCached();J.hideCached();P.restart();if(r.normals)for(b=0;b<O.contacts.length;b++)f=O.contacts[b],a=f.bi,e=P.request(),g=f.ni,c=a,e.scale.set(g.x,g.y,g.z),d(e.scale),e.position.copy(c.position),f.ri.vadd(e.position,e.position);P.hideCached();Q.restart();
if(r.axes)for(a=0;a<t.length;a++)c=t[a],e=Q.request(),e.position.copy(c.position),c.quaternion&&e.quaternion.copy(c.quaternion);Q.hideCached();E.restart();if(r.aabbs)for(b=0;b<t.length;b++)c=t[b],c.computeAABB&&(c.aabbNeedsUpdate&&c.computeAABB(),isFinite(c.aabb.lowerBound.x)&&isFinite(c.aabb.lowerBound.y)&&isFinite(c.aabb.lowerBound.z)&&isFinite(c.aabb.upperBound.x)&&isFinite(c.aabb.upperBound.y)&&isFinite(c.aabb.upperBound.z)&&0!=c.aabb.lowerBound.x-c.aabb.upperBound.x&&0!=c.aabb.lowerBound.y-c.aabb.upperBound.y&&
0!=c.aabb.lowerBound.z-c.aabb.upperBound.z&&(e=E.request(),e.scale.set(c.aabb.lowerBound.x-c.aabb.upperBound.x,c.aabb.lowerBound.y-c.aabb.upperBound.y,c.aabb.lowerBound.z-c.aabb.upperBound.z),e.position.set(.5*(c.aabb.lowerBound.x+c.aabb.upperBound.x),.5*(c.aabb.lowerBound.y+c.aabb.upperBound.y),.5*(c.aabb.lowerBound.z+c.aabb.upperBound.z))));E.hideCached()}function f(){requestAnimationFrame(f);if(!r.paused){g();var a=1/r.stepFrequency,b=Date.now()/1E3;ca?O.step(a,b-ca,r.maxSubSteps):O.step(a);ca=
b}CAMERA_TEST&&U.update();T.clear();T.render(m.scene,camera);R.update()}function h(a){mouseX=a.clientX-fa;mouseY=a.clientY-ka}function k(a){X=s_iCanvasResizeWidth+2*s_iCanvasOffsetWidth;aa=s_iCanvasResizeHeight+2*s_iCanvasOffsetHeight;CAMERA_TEST&&(U.screen.width=X,U.screen.height=aa)}function l(a){m.dispatchEvent({type:"destroy"});r.paused=!1;b();n(a)}function n(a){for(var c=v.length,d=0;d<c;d++){O.remove(t.pop());var e=v.pop();m.scene.remove(e)}for(;O.constraints.length;)O.removeConstraint(O.constraints[0]);
x[a]();r.iterations=O.solver.iterations;r.gx=O.gravity.x+0;r.gy=O.gravity.y+0;r.gz=O.gravity.z+0;r.quatNormalizeSkip=O.quatNormalizeSkip;r.quatNormalizeFast=O.quatNormalizeFast;b();L.restart();L.hideCached();K.restart();K.hideCached();J.restart();J.hideCached();P.restart();P.hideCached()}function q(a){var b=[],c=[];this.request=function(){geo=b.length?b.pop():a();scene.add(geo);c.push(geo);return geo};this.restart=function(){for(;c.length;)b.push(c.pop())};this.hideCached=function(){for(var a=0;a<
b.length;a++)scene.remove(b[a])}}var m=this;this.addScene=function(a,b){if("string"!==typeof a)throw Error("1st argument of Demo.addScene(title,initfunc) must be a string!");if("function"!==typeof b)throw Error("2nd argument of Demo.addScene(title,initfunc) must be a function!");x.push(b);var c=x.length-1;B[a]=function(){l(c)};p.add(B,a)};this.restartCurrentScene=e;this.changeScene=l;this.start=function(){n(0)};var p,r=this.settings={stepFrequency:60,quatNormalizeSkip:2,quatNormalizeFast:!0,gx:0,
gy:0,gz:0,iterations:3,tolerance:1E-4,k:1E6,d:3,scene:0,paused:!1,rendermode:"solid",constraints:!1,contacts:!1,cm2contact:!1,normals:!1,axes:!1,particleSize:.1,shadows:!1,aabbs:!1,profiling:!1,maxSubSteps:3};a=a||{};for(var u in a)u in r&&(r[u]=a[u]);if(0!==r.stepFrequency%60)throw Error("stepFrequency must be a multiple of 60.");var t=this.bodies=[],v=this.visuals=[],x=[],A=null,w=null,D=null,B={},z=new THREE.SphereGeometry(.1,6,6);this.particleGeo=new THREE.SphereGeometry(1,16,8);var F=new THREE.MeshPhongMaterial({color:11184810,
specular:1118481,shininess:100}),G=new THREE.MeshLambertMaterial({color:16777215,wireframe:!0});this.currentMaterial=F;var C=new THREE.MeshPhongMaterial({color:16711680});this.particleMaterial=new THREE.MeshLambertMaterial({color:16711680});var L=new q(function(){return new THREE.Mesh(z,C)}),K=new q(function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:16711680}))}),H=new THREE.BoxGeometry(1,
1,1),M=new THREE.MeshBasicMaterial({color:11184810,wireframe:!0}),E=new q(function(){return new THREE.Mesh(H,M)}),J=new q(function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:16711680}))}),N=new q(function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:16711680}))}),
P=new q(function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:65280}))}),Q=new q(function(){var a=new THREE.Object3D,b=new THREE.Vector3(0,0,0),c=new THREE.Geometry,d=new THREE.Geometry,e=new THREE.Geometry;c.vertices.push(b);d.vertices.push(b);e.vertices.push(b);c.vertices.push(new THREE.Vector3(1,0,0));d.vertices.push(new THREE.Vector3(0,1,0));e.vertices.push(new THREE.Vector3(0,
0,1));b=new THREE.Line(c,new THREE.LineBasicMaterial({color:16711680}));d=new THREE.Line(d,new THREE.LineBasicMaterial({color:65280}));e=new THREE.Line(e,new THREE.LineBasicMaterial({color:255}));a.add(b);a.add(d);a.add(e);return a}),O=this.world=new CANNON.World;O.broadphase=new CANNON.NaiveBroadphase;var S=["solid","wireframe"],I,ba,R,V;Detector.webgl||Detector.addGetWebGLMessage();var X=s_iCanvasResizeWidth+2*s_iCanvasOffsetWidth,aa=s_iCanvasResizeHeight+2*s_iCanvasOffsetHeight,U,T,Y,fa=X/2,ka=
aa/2;(function(){Y=document.createElement("div");document.body.appendChild(Y);CAMERA_TEST?(NEAR=5,camera=new THREE.PerspectiveCamera(45,X/aa,NEAR,FAR),camera.lookAt(new THREE.Vector3(0,0,0)),camera.position.set(0,500,500),camera.up.set(0,0,1)):camera=createOrthoGraphicCamera();scene=m.scene=new THREE.Scene;scene.fog=new THREE.Fog(2236962,1E3,FAR);ba=new THREE.AmbientLight(4473924);scene.add(ba);I=new THREE.DirectionalLight(16777164,1);I.position.set(200,160,200);I.target.position.set(0,0,0);I.castShadow=
!0;I.shadow.camera.near=10;I.shadow.camera.far=100;I.shadow.camera.fov=30;I.shadowMapBias=.0139;I.shadowMapDarkness=.1;I.shadow.mapSize.width=1024;I.shadow.mapSize.height=1024;scene.add(I);scene.add(camera);var a=new THREE.PlaneBufferGeometry(500,500,50,50);s_oRayCasterMesh=new THREE.Mesh(a,new THREE.MeshLambertMaterial({color:16777215*Math.random()}));T=SHOW_3D_RENDER?new THREE.WebGLRenderer({clearColor:0,clearAlpha:.5,antialias:!1,alpha:!0}):new THREE.CanvasRenderer({clearColor:0,clearAlpha:.5,
antialias:!1,alpha:!0});T.setSize(X,aa);T.domElement.style.position="relative";T.domElement.style.top="0px";T.domElement.style.opacity=1;Y.appendChild(T.domElement);V=document.createElement("div");V.style.position="absolute";V.style.top="10px";V.style.width="100%";V.style.textAlign="center";V.innerHTML='<a href="http://github.com/schteppe/cannon.js">cannon.js</a> - javascript 3d physics';Y.appendChild(V);document.addEventListener("mousemove",h);window.addEventListener("resize",k);T.setClearColor(scene.fog.color,
1);T.autoClear=!1;D=document.createElement("canvas");D.width=X;D.height=aa;D.style.opacity=.5;D.style.position="absolute";D.style.top="0px";D.style.zIndex=90;Y.appendChild(D);w=new SmoothieChart({labelOffsetY:50,maxDataSetLength:100,millisPerPixel:2,grid:{strokeStyle:"none",fillStyle:"none",lineWidth:1,millisPerLine:250,verticalSections:6},labels:{fillStyle:"rgb(180, 180, 180)"}});w.streamTo(D);var b={},a=[[255,0,0],[0,255,0],[0,0,255],[255,255,0],[255,0,255],[0,255,255]],d=0,e;for(e in O.profile){var f=
a[d%a.length];b[e]=new TimeSeries({label:e,fillStyle:"rgb("+f[0]+","+f[1]+","+f[2]+")",maxDataLength:500});d++}O.addEventListener("postStep",function(a){for(var c in O.profile)b[c].append(1E3*O.time,O.profile[c])});d=0;for(e in O.profile)f=a[d%a.length],w.addTimeSeries(b[e],{strokeStyle:"rgb("+f[0]+","+f[1]+","+f[2]+")",lineWidth:2}),d++;O.doProfiling=!1;w.stop();D.style.display="none";R=new Stats;R.domElement.style.position="absolute";R.domElement.style.top="0px";R.domElement.style.zIndex=100;Y.appendChild(R.domElement);
void 0!=window.dat&&(A=new dat.GUI,A.domElement.parentNode.style.zIndex=120,e=A.addFolder("Rendering"),e.add(r,"rendermode",{Solid:"solid",Wireframe:"wireframe"}).onChange(function(a){c(a)}),e.add(r,"contacts"),e.add(r,"cm2contact"),e.add(r,"normals"),e.add(r,"constraints"),e.add(r,"axes"),e.add(r,"particleSize").min(0).max(1).onChange(function(a){for(var b=0;b<v.length;b++)t[b]instanceof CANNON.Particle&&v[b].scale.set(a,a,a)}),e.add(r,"shadows").onChange(function(a){a?T.shadowMapAutoUpdate=!0:(T.shadowMapAutoUpdate=
!1,T.clearTarget(I.shadowMap))}),e.add(r,"aabbs"),e.add(r,"profiling").onChange(function(a){a?(O.doProfiling=!0,w.start(),D.style.display="block"):(O.doProfiling=!1,w.stop(),D.style.display="none")}),e=A.addFolder("World"),e.add(r,"paused").onChange(function(a){}),e.add(r,"stepFrequency",60,600).step(60),e.add(r,"gx",-100,100).onChange(function(a){isNaN(a)||O.gravity.set(a,r.gy,r.gz)}),e.add(r,"gy",-100,100).onChange(function(a){isNaN(a)||O.gravity.set(r.gx,a,r.gz)}),e.add(r,"gz",-100,100).onChange(function(a){isNaN(a)||
O.gravity.set(r.gx,r.gy,a)}),e.add(r,"quatNormalizeSkip",0,50).step(1).onChange(function(a){isNaN(a)||(O.quatNormalizeSkip=a)}),e.add(r,"quatNormalizeFast").onChange(function(a){O.quatNormalizeFast=!!a}),e=A.addFolder("Solver"),e.add(r,"iterations",1,50).step(1).onChange(function(a){O.solver.iterations=a}),e.add(r,"k",10,1E7).onChange(function(a){m.setGlobalSpookParams(r.k,r.d,1/r.stepFrequency)}),e.add(r,"d",0,20).step(.1).onChange(function(a){m.setGlobalSpookParams(r.k,r.d,1/r.stepFrequency)}),
e.add(r,"tolerance",0,10).step(.01).onChange(function(a){O.solver.tolerance=a}),p=A.addFolder("Scenes"),p.open());CAMERA_TEST&&(U=new THREE.TrackballControls(camera,T.domElement),U.rotateSpeed=1,U.zoomSpeed=1.2,U.panSpeed=.2,U.noZoom=!1,U.noPan=!1,U.staticMoving=!1,U.dynamicDampingFactor=.3,U.minDistance=0,U.maxDistance=1E5,U.screen.width=X,U.screen.height=aa)})();f();var ca=0;document.addEventListener("keypress",function(a){if(a.keyCode)switch(a.keyCode){case 32:e();break;case 104:"none"==R.domElement.style.display?
(R.domElement.style.display="block",V.style.display="block"):(R.domElement.style.display="none",V.style.display="none");break;case 97:r.aabbs=!r.aabbs;b();break;case 99:r.constraints=!r.constraints;b();break;case 112:r.paused=!r.paused;b();break;case 115:O.step(1/r.stepFrequency);g();break;case 109:a=S.indexOf(r.rendermode);a++;a%=S.length;c(S[a]);b();break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:x.length>a.keyCode-49&&!document.activeElement.localName.match(/input/)&&
l(a.keyCode-49)}})};CANNON.Demo.prototype=new CANNON.EventTarget;CANNON.Demo.constructor=CANNON.Demo;
CANNON.Demo.prototype.setGlobalSpookParams=function(a,b,c){for(var e=this.world,d=0;d<e.constraints.length;d++)for(var g=e.constraints[d],f=0;f<g.equations.length;f++)g.equations[f].setSpookParams(a,b,c);for(d=0;d<e.contactmaterials.length;d++)c=e.contactmaterials[d],c.contactEquationStiffness=a,c.frictionEquationStiffness=a,c.contactEquationRelaxation=b,c.frictionEquationRelaxation=b;e.defaultContactMaterial.contactEquationStiffness=a;e.defaultContactMaterial.frictionEquationStiffness=a;e.defaultContactMaterial.contactEquationRelaxation=
b;e.defaultContactMaterial.frictionEquationRelaxation=b};CANNON.Demo.prototype.getWorld=function(){return this.world};CANNON.Demo.prototype.addVisual=function(a,b){var c;a instanceof CANNON.Body&&(c=this.shape2mesh(a,b));c&&(this.bodies.push(a),this.visuals.push(c),a.visualref=c,a.visualref.visualId=this.bodies.length-1,this.scene.add(c));return c};CANNON.Demo.prototype.addVisuals=function(a){for(var b=0;b<a.length;b++)this.addVisual(a[b])};
CANNON.Demo.prototype.removeVisual=function(a){if(a.visualref){for(var b=this.bodies,c=this.visuals,e=[],d=[],g=b.length,f=0;f<g;f++)e.unshift(b.pop()),d.unshift(c.pop());for(var g=a.visualref.visualId,h=0;h<e.length;h++)h!==g&&(f=h>g?h-1:h,b[f]=e[h],c[f]=d[h],b[f].visualref=e[h].visualref,b[f].visualref.visualId=f);a.visualref.visualId=null;this.scene.remove(a.visualref);a.visualref=null}};CANNON.Demo.prototype.removeAllVisuals=function(){for(;this.bodies.length;)this.removeVisual(this.bodies[0])};
CANNON.Demo.prototype.shape2mesh=function(a,b){for(var c=new THREE.Object3D,e=0;e<a.shapes.length;e++){var d=a.shapes[e];switch(d.type){case CANNON.Shape.types.SPHERE:var g=new THREE.SphereGeometry(d.radius,8,8),d=new THREE.Mesh(g,this.currentMaterial);break;case CANNON.Shape.types.PARTICLE:d=new THREE.Mesh(this.particleGeo,this.particleMaterial);g=this.settings;d.scale.set(g.particleSize,g.particleSize,g.particleSize);break;case CANNON.Shape.types.PLANE:var f=new THREE.PlaneGeometry(10,10,4,4),d=
new THREE.Object3D,g=new THREE.Object3D,f=new THREE.Mesh(f,this.currentMaterial);f.scale.set(100,100,100);g.add(f);f.castShadow=!0;f.receiveShadow=!0;d.add(g);break;case CANNON.Shape.types.BOX:g=new THREE.BoxGeometry(2*d.halfExtents.x,2*d.halfExtents.y,2*d.halfExtents.z);d=new THREE.Mesh(g,this.currentMaterial);break;case CANNON.Shape.types.CONVEXPOLYHEDRON:f=new THREE.Geometry;for(g=0;g<d.vertices.length;g++){var h=d.vertices[g];f.vertices.push(new THREE.Vector3(h.x,h.y,h.z))}for(g=0;g<d.faces.length;g++)for(var k=
d.faces[g],l=k[0],h=1;h<k.length-1;h++)f.faces.push(new THREE.Face3(l,k[h],k[h+1]));f.computeBoundingSphere();f.computeFaceNormals();d=new THREE.Mesh(f,this.currentMaterial);break;case CANNON.Shape.types.HEIGHTFIELD:for(var f=new THREE.Geometry,k=new CANNON.Vec3,l=new CANNON.Vec3,n=new CANNON.Vec3,h=0;h<d.data.length-1;h++)for(var q=0;q<d.data[h].length-1;q++)for(var m=0;2>m;m++)d.getConvexTrianglePillar(h,q,0===m),k.copy(d.pillarConvex.vertices[0]),l.copy(d.pillarConvex.vertices[1]),n.copy(d.pillarConvex.vertices[2]),
k.vadd(d.pillarOffset,k),l.vadd(d.pillarOffset,l),n.vadd(d.pillarOffset,n),f.vertices.push(new THREE.Vector3(k.x,k.y,k.z),new THREE.Vector3(l.x,l.y,l.z),new THREE.Vector3(n.x,n.y,n.z)),g=f.vertices.length-3,f.faces.push(new THREE.Face3(g,g+1,g+2));f.computeBoundingSphere();f.computeFaceNormals();d=new THREE.Mesh(f,this.currentMaterial);break;case CANNON.Shape.types.TRIMESH:f=new THREE.Geometry;k=new CANNON.Vec3;l=new CANNON.Vec3;n=new CANNON.Vec3;for(g=0;g<d.indices.length/3;g++)d.getTriangleVertices(g,
k,l,n),f.vertices.push(new THREE.Vector3(k.x,k.y,k.z),new THREE.Vector3(l.x,l.y,l.z),new THREE.Vector3(n.x,n.y,n.z)),h=f.vertices.length-3,f.faces.push(new THREE.Face3(h,h+1,h+2));f.computeBoundingSphere();f.computeFaceNormals();g=11184810;b&&(g=b);g=new THREE.MeshPhongMaterial({color:g,specular:1118481,shininess:100});d=new THREE.Mesh(f,g);break;default:throw"Visual type not recognized: "+d.type;}d.receiveShadow=!0;d.castShadow=!0;if(d.children)for(g=0;g<d.children.length;g++)if(d.children[g].castShadow=
!0,d.children[g].receiveShadow=!0,d.children[g])for(h=0;h<d.children[g].length;h++)d.children[g].children[h].castShadow=!0,d.children[g].children[h].receiveShadow=!0;g=a.shapeOffsets[e];f=a.shapeOrientations[e];d.position.set(g.x,g.y,g.z);d.quaternion.set(f.x,f.y,f.z,f.w);c.add(d)}this.camera=function(){return camera};this.getScene=function(){return scene};return c};
function CLevelMenu(){var a,b,c,e,d,g,f=[],h,k,l,n,q;this._init=function(){d=0;k=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(k);q=new createjs.Shape;q.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);q.alpha=.7;s_oStage.addChild(q);g=new createjs.Container;g.x=0;g.y=0;var m=new createjs.Text(TEXT_SELECT_A_LEVEL," 46px "+PRIMARY_FONT,"#3e240b");m.x=CANVAS_WIDTH/2;m.y=200;m.outline=10;m.textAlign="center";m.textBaseline="alphabetic";m.lineWidth=1E3;var p=
new createjs.Text(TEXT_SELECT_A_LEVEL," 46px "+PRIMARY_FONT,"#ffd800");p.x=CANVAS_WIDTH/2;p.y=200;p.textAlign="center";p.textBaseline="alphabetic";p.lineWidth=1E3;g.addChild(m,p);s_oStage.addChild(g);var m=.5*CANVAS_WIDTH-20,p=-200,r=-100;h=s_oLocalStorage.getItemJson(LOCALSTORAGE_SCORE);for(var u=0;u<h.length;u++)0<h[u]&&d++;for(var t=0,u=0;u<h.length;u++)t+=h[u];u=new createjs.Text(TEXT_TOTAL_SCORE+": "+t," 40px "+PRIMARY_FONT,"#3e240b");u.x=CANVAS_WIDTH/2;u.y=800;u.outline=10;u.textAlign="center";
u.textBaseline="alphabetic";u.lineWidth=1E3;s_oStage.addChild(u);t=new createjs.Text(TEXT_TOTAL_SCORE+": "+t," 40px "+PRIMARY_FONT,"#ffd800");t.x=CANVAS_WIDTH/2;t.y=u.y;t.textAlign="center";t.textBaseline="alphabetic";t.lineWidth=1E3;s_oStage.addChild(t);for(u=0;u<h.length;u++,p+=170)700<p&&(p=-200,r+=150),u<=d?(f[u]=new CLevelBut(m-200+p,425+r,s_oSpriteLibrary.getSprite("but_level"),!0,u+1,s_oStage),f[u].addEventListenerWithParams(ON_MOUSE_UP,this._onClick,this,u),f[u].enable()):(f[u]=new CLevelBut(m-
200+p,425+r,s_oSpriteLibrary.getSprite("but_level"),!1,u+1,s_oStage),f[u].disable()),f[u].addLevelText(u+1),f[u].disable(),f[u].addStar(0),s_bFirstTime=!0;this._setLevelInfo();m=s_oSpriteLibrary.getSprite("but_exit");c=CANVAS_WIDTH-m.height/2-10;e=m.height/2+17;l=new CGfxButton(c,e,m,s_oStage);l.addEventListener(ON_MOUSE_UP,this._onExit,this);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)m=s_oSpriteLibrary.getSprite("audio_icon"),a=c-m.height-10,b=e,n=new CToggle(a,b,m,s_bAudioActive,s_oStage),n.addEventListener(ON_MOUSE_UP,
this._onAudioToggle,this);q=new createjs.Shape;q.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(q);(new createjs.Tween.get(q)).to({alpha:0},1E3);this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){for(var a=0;a<NUM_HOLES;a++)f[a].unload();q.off("mousedown");s_oLevelMenu=null;s_oStage.removeAllChildren()};this.refreshButtonPos=function(d,f){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||n.setPosition(a-d,b+f);l.setPosition(c-d,e+f)};this._setLevelInfo=
function(){d<NUM_HOLES&&(f[d].enable(),f[d].pulseAnimation());for(var a=0;a<d;a++)f[a].enable(),0<h[a]&&h[a]<PAR_POINTS-ADDED_POINTS?f[a].addStar(1):h[a]>=PAR_POINTS-ADDED_POINTS&&h[a]<PAR_POINTS?f[a].addStar(2):f[a].addStar(3),f[a].addScore(h[a])};this._onNumModeToggle=function(a){a===NUM_ACTIVE?((void 0).setActive(!1),(void 0).setActive(!0)):((void 0).setActive(!0),(void 0).setActive(!1))};this._onAudioToggle=function(){createjs.Sound.setMute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onClick=
function(a){q.on("mousedown",function(){});createjs.Tween.get(q,{override:!0}).to({alpha:1},500).call(function(){s_oLevelMenu.unload();s_oMain.loadSelectedLevel(a)})};this._onExit=function(){s_oLevelMenu.unload();s_oMain.gotoMenu()};s_oLevelMenu=this;this._init()}var s_oLevelMenu=null;
function CLevelBut(a,b,c,e,d,g){var f,h,k,l,n=[],q,m,p=null,r=null,u,t,v;this._init=function(a,b,c,d){f=!1;h=1;k=[];l=[];q=new createjs.Container;q.x=a;q.y=b;q.scaleX=q.scaleY=h;d.addChild(q);m=new createjs.Container;m.x=a;m.y=b;m.scaleX=q.scaleY=h;d.addChild(m);a=c.width/2;b=c.height;c=new createjs.SpriteSheet({images:[c],frames:{width:a,height:b,regX:a/2,regY:b/2},animations:{on:[0],off:[1]}});u=createSprite(c,"on",a/2,b/2,a,b);q.addChild(u);e?u.gotoAndStop("on"):u.gotoAndStop("off");this._initListener()};
this.unload=function(){s_bMobile?q.off("mousedown",this.buttonDown):(q.off("mousedown",this.buttonDown),q.off("mouseover",this.buttonOver));q.off("pressup",this.buttonRelease);g.removeChild(q)};this.setVisible=function(a){q.visible=a};this.enable=function(){u.gotoAndStop("on");f=!1;null!==r&&(p.color="#3e240b",r.color="#ffd800")};this.disable=function(){f=!0;u.gotoAndStop("off");null!==r&&(p.color="#000000",r.color="#a8a8a8")};this.setClickable=function(a){f=!a};this.addStar=function(a){var b=s_oSpriteLibrary.getSprite("star");
t=new CAchievementStars(b,0,-b.height/2-14,q);t.getContainer().scaleX=t.getContainer().scaleY=.4;t.startLitStar(a)};this.addScore=function(a){var b=new createjs.Text(a," 12px "+PRIMARY_FONT,"#3e240b");b.y=c.height/2-10;b.textAlign="center";b.textBaseline="middle";b.lineWidth=200;b.outline=4;m.addChild(b);a=new createjs.Text(a," 12px "+PRIMARY_FONT,"#ffd800");a.y=b.y;a.textAlign="center";a.textBaseline="middle";a.lineWidth=200;m.addChild(a)};this.addLevelText=function(a){p=new createjs.Text(a," 30px "+
PRIMARY_FONT,"#3e240b");p.y=5;p.textAlign="center";p.textBaseline="middle";p.lineWidth=200;p.outline=8;q.addChild(p);r=new createjs.Text(a," 30px "+PRIMARY_FONT,"#ffd800");r.y=5;r.textAlign="center";r.textBaseline="middle";r.lineWidth=200;q.addChild(r)};this._initListener=function(){if(s_bMobile)q.on("mousedown",this.buttonDown);else q.on("mousedown",this.buttonDown),q.on("mouseover",this.buttonOver);q.on("pressup",this.buttonRelease)};this.addEventListener=function(a,b,c){k[a]=b;l[a]=c};this.addEventListenerWithParams=
function(a,b,c,d){k[a]=b;l[a]=c;n=d};this.buttonRelease=function(){f||(q.scaleX=h,q.scaleY=h,k[ON_MOUSE_UP]&&k[ON_MOUSE_UP].call(l[ON_MOUSE_UP],n))};this.buttonDown=function(){f||(playSound("click",1,0),q.scaleX=.9*h,q.scaleY=.9*h,k[ON_MOUSE_DOWN]&&k[ON_MOUSE_DOWN].call(l[ON_MOUSE_DOWN],n))};this.buttonOver=function(a){s_bMobile||f||(a.target.cursor="pointer")};this.pulseAnimation=function(){createjs.Tween.get(q).to({scaleX:.9*h,scaleY:.9*h},850,createjs.Ease.quadOut).to({scaleX:h,scaleY:h},650,createjs.Ease.quadIn).call(function(){v.pulseAnimation()})};
this.trembleAnimation=function(){createjs.Tween.get(q).to({rotation:5},75,createjs.Ease.quadOut).to({rotation:-5},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750).call(function(){v.trebleAnimation()})};this.setPosition=function(a,b){q.x=a;q.y=b};this.setScale=function(a){h=a;q.scaleX=q.scaleY=a};this.setX=function(a){q.x=a};this.setY=function(a){q.y=a};this.getButtonImage=function(){return q};this.getX=function(){return q.x};this.getY=function(){return q.y};v=this;this._init(a,
b,c,g);return this}
function CBall(a,b,c,e){var d,g,f,h,k,l,n,q,m,p,r,u,t,v,x,A,w,D,B,z,F,G,C,L;this._init=function(a,b,c,d){k=!1;m=3;n=0;q=MAX_MOUSE_DISTANCE_POWER_ACTIVATED-MIN_MOUSE_DISTANCE_POWER_ACTIVATED;p=c.height;r=10;L=new CVector2(-.845,.534);t=new createjs.Container;t.x=a;t.y=b;d.addChild(t);a=s_oSpriteLibrary.getSprite("press_indicator");G=createBitmap(a);G.regX=.5*a.width;G.regY=.5*a.height;G.scaleX=0;G.scaleY=0;t.addChild(G);x=new createjs.Shape;t.addChild(x);w=new createjs.Container;w.visible=!1;w.y=r;
t.addChild(w);a=s_oSpriteLibrary.getSprite("ball_water");F=createBitmap(a);F.regX=.54*a.width;F.regY=.5*a.height;t.addChild(F);v=createBitmap(c);v.regX=.5*c.width;v.regY=.5*c.height;t.addChild(v);B=new createjs.Shape;B.graphics.beginFill("rgba(255,255,255,0.01)").r(0,0,c.width,c.height);B.x=-c.width/2;B.y=-c.height/2;B.scaleY=1;t.addChild(D);z=new createjs.Shape;z.graphics.beginFill("rgba(255,0,0,0.01)").drawCircle(0,0,c.width/2);t.addChild(z);v.mask=B;A=new createjs.Shape;A.graphics.beginFill("rgba(255,0,0,0.01)").drawCircle(0,
0,100);t.addChild(A);t.on("mousedown",this._onClickPoint);t.on("pressmove",this._onDragPoint);t.on("pressup",this._onReleaseForce);c=s_oSpriteLibrary.getSprite("arrow");a=createBitmap(c);a.regY=c.height/2;a.rotation=147;w.addChild(a);D=new createjs.Shape;D.graphics.beginFill("rgba(255,255,255,0.01)").r(0,-c.height/2,c.width,c.height);D.scaleX=0;D.rotation=147;w.addChild(D);c=s_oSpriteLibrary.getSprite("arrow_fill");a=createBitmap(c);a.regY=c.height/2;a.mask=D;a.rotation=147;w.addChild(a);c=s_oSpriteLibrary.getSprite("arrow_frame");
a=createBitmap(c);a.regY=c.height/2;a.rotation=147;w.addChild(a);this.pressIndicatorAnim()};this._onClickPoint=function(a){};this._onDragPoint=function(a){if(!k){w.visible=!0;var b=s_oGame.get3DBall().position.x,c=s_oGame.get3DBall().position.y,e=s_oGame.get3DBall().position.z,m=new CVector2(a.localX,a.localY),p=Math.degrees(angleBetweenVectors(L,m)),m=rotateVector2D(Math.radians(0<p&&66>=p?13*-p/33+150:0>p&&-114<=p?13*p/56+150:66<p?13*Math.abs(p)/57+2070/19:13*-p/34+1380/17),m),b=convert3dPosTo2dScreen({x:b+
m.x,y:c-m.y,z:e},s_oGame.getCamera());d=b.x;g=b.y;f=m.x;h=m.y;l=Math.sqrt(a.localX*a.localX+a.localY*a.localY);n=(l-(s_bMobile?MIN_MOUSE_DISTANCE_POWER_ACTIVATED_MOBILE:MIN_MOUSE_DISTANCE_POWER_ACTIVATED))/q*MAX_SHOT_POWER;u._drawLine(a.localX,a.localY);u._drawArrow()}};this._onReleaseForce=function(a){k||(w.visible=!1,x.graphics.clear(),0>=n||(n>MAX_SHOT_POWER&&(n=MAX_SHOT_POWER),a=new CVector2(f,h),a.normalize(),a.scalarProduct(n),s_oGame.launchBall({x:a.getX(),y:-a.getY()}),u.setMoving(!0),u.pressIndicatorStop(),
n=0,playSound("hit_ball",1,0)))};this._drawLine=function(a,b){x.graphics.clear();x.graphics.setStrokeDash([14,14],2);x.graphics.setStrokeStyle(5);x.graphics.beginStroke("rgba(61,34,11,1)");x.graphics.moveTo(0,r);x.graphics.lineTo(a,b)};this._drawArrow=function(){var a=new CVector2(d-t.x,g-t.y),a=Math.degrees(angleBetweenVectors(L,a));w.rotation=a;D.scaleX=n/MAX_SHOT_POWER*.83+.17};this.unload=function(){t.removeAllEventListeners();e.removeChild(t);t.off("mousedown");t.off("mousemove");t.off("mouseup")};
this.removeHelpAnim=function(){new createjs.Tween.removeTweens(C);new createjs.Tween.removeTweens(D)};this.setHelpAnim=function(){var a=s_oSpriteLibrary.getSprite("help_touch");C=createBitmap(a);C.regX=.33*a.width;C.regY=.1*a.height;t.addChild(C);this._helpCursorAnim(1E3);this._helpArrowAnim(1E3)};this._helpCursorAnim=function(a){createjs.Tween.get(C).to({x:-200,y:120},a,createjs.Ease.cubicInOut).call(function(){createjs.Tween.get(C).to({x:0,y:0},a,createjs.Ease.cubicInOut).call(function(){u._helpCursorAnim(a)})})};
this._helpArrowAnim=function(a){w.visible=!0;w.rotation=180;createjs.Tween.get(D).to({scaleX:1},a,createjs.Ease.cubicInOut).call(function(){createjs.Tween.get(D).to({scaleX:0},a,createjs.Ease.cubicInOut).call(function(){u._helpArrowAnim(a)})})};this.blink=function(){createjs.Tween.get(t).to({alpha:0},100-15*m).to({alpha:1},300-45*m).wait(100-20*m).call(function(){m--;0<m?u.blink():m=3})};this.pressIndicatorAnim=function(){G.scaleX=G.scaleY=0;G.alpha=1;(new createjs.Tween.get(G)).to({scaleX:1,scaleY:1},
1500,createjs.Ease.cubicOut).call(function(){u.pressIndicatorAnim()});(new createjs.Tween.get(G)).to({alpha:0},1500,createjs.Ease.cubicOut)};this.pressIndicatorStop=function(){G.scaleX=G.scaleY=0;new createjs.Tween.removeTweens(G)};this.setMoving=function(a){k=a};this.resetMask=function(){F.visible=!1;v.mask=B;B.scaleY=1};this.setWaterMask=function(a){F.visible=!0;F.alpha=a;v.mask=z;z.y=p*a-p};this.setHoleMask=function(a){F.visible=!1;v.mask=z;z.y=p*a-p};this.setVisible=function(a){t.visible=a};this.setPosition=
function(a,b){t.x=a;t.y=b};this.setAlpha=function(a){t.alpha=a};this.setAngle=function(a){t.rotation=a};this.getX=function(){return t.x};this.getY=function(){return t.y};this.scale=function(a){t.scaleX=a;t.scaleY=a};this.getScale=function(){return t.scaleX};this.childIndex=function(a){e.setChildIndex(t,a)};this._init(a,b,c,e);u=this;return this}
function CScenario(a){var b,c,e,d,g,f,h,k,l,n,q,m,p,r,u,t,v,x,A;if(SHOW_3D_RENDER)var w=new CANNON.Demo;this.getDemo=function(){return w};this._init=function(){A=1/60;x=v=t=null;n=[];p=[];r=[];b=SHOW_3D_RENDER?w.getWorld():new CANNON.World;b.gravity.set(0,0,-98.1);b.broadphase=new CANNON.NaiveBroadphase;b.solver.iterations=10;new CANNON.Material;c=new CANNON.Material;e=new CANNON.Material;var d=new CANNON.ContactMaterial(c,e,{friction:0,restitution:.4,contactEquationStiffness:1E8,contactEquationRelaxation:3,
frictionEquationStiffness:1E8,frictionEquationRegularizationTime:3});b.addContactMaterial(d);q=[];m=[];d=new THREE.LoadingManager;d.onProgress=function(a,b,c){console.log(a,b,c)};(new THREE.FBXLoader(d)).load("models/level_"+a+".txt",function(a){s_oScenario.parseFile(a);s_oGame.scenarioLoaded()},function(a){},function(a){})};this.parseFile=function(a){for(var b=0;b<a.children.length;b++){var c=a.children[b];console.log("oMesh.name: "+c.name);"field"===c.name?s_oScenario._createFieldBody(c):"ball"===
c.name?s_oScenario._createBallBody(c):"hole"===c.name?s_oScenario._createHoleBody(c):"sand"===c.name?s_oScenario._createBigSandBody(c):"water"===c.name&&s_oScenario._createWaterBody(c)}};this._createFieldBody=function(a){k=this.__extractMeshData(a);l=new CANNON.Body({mass:0,material:e});l.addShape(k);a=new CANNON.Vec3(a.position.x,a.position.y,a.position.z);l.position.copy(a);l.addEventListener("collide",function(a){u=!0});b.addBody(l);SHOW_3D_RENDER&&w.addVisual(l)};this._createBallBody=function(a){d=
new CANNON.Sphere(BALL_RADIUS);g=new CANNON.Body({mass:BALL_MASS,material:c,linearDamping:BALL_LINEAR_DAMPING,angularDamping:BALL_LINEAR_DAMPING});a=new CANNON.Vec3(a.position.x,a.position.y,a.position.z);g.position.copy(a);g.previousPosition.copy(a);g.addShape(d);b.add(g);SHOW_3D_RENDER&&(f=w.addVisual(g))};this.testPosMesh=function(){return f};this._createHoleBody=function(a){h=new CANNON.Vec3(a.position.x,a.position.y,a.position.z);a=this.__extractMeshData(a);var c=r.length;r.push(new CANNON.Body({mass:0,
material:e}));r[c].collisionResponse=0;r[c].ID=c;r[c].addEventListener("collide",function(a){x=a.target.ID});r[c].addShape(a);r[c].position.copy(h);b.add(r[c]);SHOW_3D_RENDER&&w.addVisual(r[c],16711680)};this._createBigSandBody=function(a){var c=n.length;m[c]=new CANNON.Vec3(a.position.x,a.position.y,a.position.z);q[c]=this.__extractMeshData(a);n[c]=new CANNON.Body({mass:0,material:e});n[c].collisionResponse=0;n[c].ID=c;n[c].addEventListener("collide",function(a){t=a.target.ID});n[c].addShape(q[c]);
n[c].position.copy(m[c]);b.add(n[c]);SHOW_3D_RENDER&&w.addVisual(n[c],15636224)};this._createWaterBody=function(a){var c=new CANNON.Vec3(a.position.x,a.position.y,a.position.z);a=this.__extractMeshData(a);var d=p.length;p.push(new CANNON.Body({mass:0,material:e}));p[d].collisionResponse=0;p[d].ID=d;p[d].addEventListener("collide",function(a){v=a.target.ID});p[d].addShape(a);p[d].position.copy(c);b.add(p[d]);SHOW_3D_RENDER&&w.addVisual(p[d],255)};this.__extractMeshData=function(a){var b=a.geometry.faces;
a=a.geometry.vertices;for(var c=0;c<b.length;c++);for(var d=[],e=[],c=0;c<a.length;c++)d.push(1*a[c].x),d.push(1*a[c].y),d.push(1*a[c].z);for(c=0;c<b.length;c++)e.push(b[c].a),e.push(b[c].b),e.push(b[c].c);return new CANNON.Trimesh(d,e)};this.addImpulse=function(a,b){var c=new CANNON.Vec3(0,0,BALL_RADIUS),d=new CANNON.Vec3(b.x,b.y,0);a.applyImpulse(d,c)};this.getBodyVelocity=function(a){return a.velocity};this.ballBody=function(){return g};this.ballMesh=function(){return f};this.getCamera=function(){return w.camera()};
this.collisionWithBall=function(){s_oGame.ballCollision()};this.setElementVelocity=function(a,b){var c=new CANNON.Vec3(b.x,b.y,b.z);a.velocity=c};this.setElementLinearDamping=function(a,b){a.linearDamping=b};this.setGravity=function(a){b.gravity.set(0,0,a)};this.update=function(){b.step(A);u&&this._checkTerrainCollision();null!==t&&this._checkSandCollision();null!==v&&this._checkWaterCollision();null!==x&&this._checkHoleCollision()};this._checkTerrainCollision=function(){for(var a=0;a<b.contacts.length;a++){var c=
b.contacts[a];if(c.bi===l&&c.bj===g||c.bi===g&&c.bj===l)return s_oGame.ballCollideWithTerrain(!0),!0}s_oGame.ballCollideWithTerrain(!1);return u=!1};this._checkSandCollision=function(){for(var a=0;a<b.contacts.length;a++){var c=b.contacts[a];if(c.bi===n[t]&&c.bj===g||c.bi===g&&c.bj===n[t])return s_oGame.ballCollideWithSand(!0),!0}s_oGame.ballCollideWithSand(!1);t=null;return!1};this._checkWaterCollision=function(){for(var a=0;a<b.contacts.length;a++){var c=b.contacts[a];if(c.bi===p[v]&&c.bj===g||
c.bi===g&&c.bj===p[v])return s_oGame.ballCollideWithWater(!0),!0}s_oGame.ballCollideWithWater(!1);v=null;return!1};this._checkHoleCollision=function(){for(var a=0;a<b.contacts.length;a++){var c=b.contacts[a];if(c.bi===r[x]&&c.bj===g||c.bi===g&&c.bj===r[x])return s_oGame.ballCollideWithHole(!0),!0}s_oGame.ballCollideWithHole(!1);x=null;return!1};this.getHolePosition=function(){return h};this.getAllBigSandsPosition=function(){return m};this.getBigSandPositionByID=function(a){return m[a]};this.getWorld=
function(){return b};this.getField=function(){return l};s_oScenario=this;SHOW_3D_RENDER?(w.addScene("Test",this._init),w.start()):this._init()}var s_oScenario;"use strict";var THREE={REVISION:"75"};"function"===typeof define&&define.amd?define("three",THREE):"undefined"!==typeof exports&&"undefined"!==typeof module&&(module.exports=THREE);void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});
void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}});
void 0===Object.assign&&Object.defineProperty(Object,"assign",{writable:!0,configurable:!0,value:function(a){if(void 0===a||null===a)throw new TypeError("Cannot convert first argument to object");for(var b=Object(a),c=1,e=arguments.length;c!==e;++c){var d=arguments[c];if(void 0!==d&&null!==d)for(var d=Object(d),g=Object.keys(d),f=0,h=g.length;f!==h;++f){var k=g[f],l=Object.getOwnPropertyDescriptor(d,k);void 0!==l&&l.enumerable&&(b[k]=d[k])}}return b}});THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};
THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;
THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.MinEquation=103;THREE.MaxEquation=104;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.NeverDepth=0;THREE.AlwaysDepth=1;
THREE.LessDepth=2;THREE.LessEqualDepth=3;THREE.EqualDepth=4;THREE.GreaterEqualDepth=5;THREE.GreaterDepth=6;THREE.NotEqualDepth=7;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.NoToneMapping=0;THREE.LinearToneMapping=1;THREE.ReinhardToneMapping=2;THREE.Uncharted2ToneMapping=3;THREE.CineonToneMapping=4;THREE.UVMapping=300;THREE.CubeReflectionMapping=301;THREE.CubeRefractionMapping=302;THREE.EquirectangularReflectionMapping=303;THREE.EquirectangularRefractionMapping=304;
THREE.SphericalReflectionMapping=305;THREE.CubeUVReflectionMapping=306;THREE.CubeUVRefractionMapping=307;THREE.RepeatWrapping=1E3;THREE.ClampToEdgeWrapping=1001;THREE.MirroredRepeatWrapping=1002;THREE.NearestFilter=1003;THREE.NearestMipMapNearestFilter=1004;THREE.NearestMipMapLinearFilter=1005;THREE.LinearFilter=1006;THREE.LinearMipMapNearestFilter=1007;THREE.LinearMipMapLinearFilter=1008;THREE.UnsignedByteType=1009;THREE.ByteType=1010;THREE.ShortType=1011;THREE.UnsignedShortType=1012;
THREE.IntType=1013;THREE.UnsignedIntType=1014;THREE.FloatType=1015;THREE.HalfFloatType=1025;THREE.UnsignedShort4444Type=1016;THREE.UnsignedShort5551Type=1017;THREE.UnsignedShort565Type=1018;THREE.AlphaFormat=1019;THREE.RGBFormat=1020;THREE.RGBAFormat=1021;THREE.LuminanceFormat=1022;THREE.LuminanceAlphaFormat=1023;THREE.RGBEFormat=THREE.RGBAFormat;THREE.RGB_S3TC_DXT1_Format=2001;THREE.RGBA_S3TC_DXT1_Format=2002;THREE.RGBA_S3TC_DXT3_Format=2003;THREE.RGBA_S3TC_DXT5_Format=2004;
THREE.RGB_PVRTC_4BPPV1_Format=2100;THREE.RGB_PVRTC_2BPPV1_Format=2101;THREE.RGBA_PVRTC_4BPPV1_Format=2102;THREE.RGBA_PVRTC_2BPPV1_Format=2103;THREE.RGB_ETC1_Format=2151;THREE.LoopOnce=2200;THREE.LoopRepeat=2201;THREE.LoopPingPong=2202;THREE.InterpolateDiscrete=2300;THREE.InterpolateLinear=2301;THREE.InterpolateSmooth=2302;THREE.ZeroCurvatureEnding=2400;THREE.ZeroSlopeEnding=2401;THREE.WrapAroundEnding=2402;THREE.TrianglesDrawMode=0;THREE.TriangleStripDrawMode=1;THREE.TriangleFanDrawMode=2;
THREE.LinearEncoding=3E3;THREE.sRGBEncoding=3001;THREE.GammaEncoding=3007;THREE.RGBEEncoding=3002;THREE.LogLuvEncoding=3003;THREE.RGBM7Encoding=3004;THREE.RGBM16Encoding=3005;THREE.RGBDEncoding=3006;THREE.Color=function(a){return 3===arguments.length?this.fromArray(arguments):this.set(a)};
THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(a){a instanceof THREE.Color?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setScalar:function(a){this.b=this.g=this.r=a},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(){function a(a,c,e){0>e&&(e+=1);1<e&&--e;return e<1/6?a+6*(c-a)*e:
.5>e?c:e<2/3?a+6*(c-a)*(2/3-e):a}return function(b,c,e){b=THREE.Math.euclideanModulo(b,1);c=THREE.Math.clamp(c,0,1);e=THREE.Math.clamp(e,0,1);0===c?this.r=this.g=this.b=e:(c=.5>=e?e*(1+c):e+c-e*c,e=2*e-c,this.r=a(e,c,b+1/3),this.g=a(e,c,b),this.b=a(e,c,b-1/3));return this}}(),setStyle:function(a){function b(b){void 0!==b&&1>parseFloat(b)&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}var c;if(c=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(a)){var e=c[2];switch(c[1]){case "rgb":case "rgba":if(c=
/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(e))return this.r=Math.min(255,parseInt(c[1],10))/255,this.g=Math.min(255,parseInt(c[2],10))/255,this.b=Math.min(255,parseInt(c[3],10))/255,b(c[5]),this;if(c=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(e))return this.r=Math.min(100,parseInt(c[1],10))/100,this.g=Math.min(100,parseInt(c[2],10))/100,this.b=Math.min(100,parseInt(c[3],10))/100,b(c[5]),this;break;case "hsl":case "hsla":if(c=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(e)){var e=
parseFloat(c[1])/360,d=parseInt(c[2],10)/100,g=parseInt(c[3],10)/100;b(c[5]);return this.setHSL(e,d,g)}}}else if(c=/^\#([A-Fa-f0-9]+)$/.exec(a)){c=c[1];e=c.length;if(3===e)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}a&&0<a.length&&
(c=THREE.ColorKeywords[a],void 0!==c?this.setHex(c):console.warn("THREE.Color: Unknown color "+a));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a,b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);var c=0<b?1/b:1;this.r=Math.pow(a.r,c);this.g=Math.pow(a.g,c);this.b=Math.pow(a.b,
c);return this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var b=this.r,c=this.g,e=this.b,d=Math.max(b,c,e),g=Math.min(b,c,e),f,h=
(g+d)/2;if(g===d)g=f=0;else{var k=d-g,g=.5>=h?k/(d+g):k/(2-d-g);switch(d){case b:f=(c-e)/k+(c<e?6:0);break;case c:f=(e-b)/k+2;break;case e:f=(b-c)/k+4}f/=6}a.h=f;a.s=g;a.l=h;return a},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,b,c){var e=this.getHSL();e.h+=a;e.s+=b;e.l+=c;this.setHSL(e.h,e.s,e.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=
a.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a,b){void 0===b&&(b=0);this.r=a[b];this.g=a[b+1];this.b=a[b+2];return this},toArray:function(a,
b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a}};
THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,
darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,
grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,
lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,
palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,
tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(a,b,c,e){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==e?e:1};
THREE.Quaternion.prototype={constructor:THREE.Quaternion,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a;this.onChangeCallback()},set:function(a,b,c,e){this._x=a;this._y=b;this._z=c;this._w=e;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},
copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;this._w=a.w;this.onChangeCallback();return this},setFromEuler:function(a,b){if(!1===a instanceof THREE.Euler)throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var c=Math.cos(a._x/2),e=Math.cos(a._y/2),d=Math.cos(a._z/2),g=Math.sin(a._x/2),f=Math.sin(a._y/2),h=Math.sin(a._z/2),k=a.order;"XYZ"===k?(this._x=g*e*d+c*f*h,this._y=c*f*d-g*e*h,this._z=c*e*h+g*f*d,this._w=c*e*d-g*f*h):"YXZ"===
k?(this._x=g*e*d+c*f*h,this._y=c*f*d-g*e*h,this._z=c*e*h-g*f*d,this._w=c*e*d+g*f*h):"ZXY"===k?(this._x=g*e*d-c*f*h,this._y=c*f*d+g*e*h,this._z=c*e*h+g*f*d,this._w=c*e*d-g*f*h):"ZYX"===k?(this._x=g*e*d-c*f*h,this._y=c*f*d+g*e*h,this._z=c*e*h-g*f*d,this._w=c*e*d+g*f*h):"YZX"===k?(this._x=g*e*d+c*f*h,this._y=c*f*d+g*e*h,this._z=c*e*h-g*f*d,this._w=c*e*d-g*f*h):"XZY"===k&&(this._x=g*e*d-c*f*h,this._y=c*f*d-g*e*h,this._z=c*e*h+g*f*d,this._w=c*e*d+g*f*h);if(!1!==b)this.onChangeCallback();return this},setFromAxisAngle:function(a,
b){var c=b/2,e=Math.sin(c);this._x=a.x*e;this._y=a.y*e;this._z=a.z*e;this._w=Math.cos(c);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var e=b[8],d=b[1],g=b[5],f=b[9],h=b[2],k=b[6],b=b[10],l=c+g+b;0<l?(c=.5/Math.sqrt(l+1),this._w=.25/c,this._x=(k-f)*c,this._y=(e-h)*c,this._z=(d-a)*c):c>g&&c>b?(c=2*Math.sqrt(1+c-g-b),this._w=(k-f)/c,this._x=.25*c,this._y=(a+d)/c,this._z=(e+h)/c):g>b?(c=2*Math.sqrt(1+g-c-b),this._w=(e-h)/c,this._x=(a+d)/c,this._y=
.25*c,this._z=(f+k)/c):(c=2*Math.sqrt(1+b-c-g),this._w=(d-a)/c,this._x=(e+h)/c,this._y=(f+k)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,b;return function(c,e){void 0===a&&(a=new THREE.Vector3);b=c.dot(e)+1;1E-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,e);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=
-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},
multiply:function(a,b){return void 0!==b?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a._x,e=a._y,d=a._z,g=a._w,f=b._x,h=b._y,k=b._z,l=b._w;this._x=c*l+g*f+e*k-d*h;this._y=e*l+g*h+d*f-c*k;this._z=d*l+g*k+c*h-e*f;this._w=g*l-c*f-e*h-d*k;this.onChangeCallback();return this},slerp:function(a,b){if(0===b)return this;if(1===
b)return this.copy(a);var c=this._x,e=this._y,d=this._z,g=this._w,f=g*a._w+c*a._x+e*a._y+d*a._z;0>f?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,f=-f):this.copy(a);if(1<=f)return this._w=g,this._x=c,this._y=e,this._z=d,this;var h=Math.sqrt(1-f*f);if(.001>Math.abs(h))return this._w=.5*(g+this._w),this._x=.5*(c+this._x),this._y=.5*(e+this._y),this._z=.5*(d+this._z),this;var k=Math.atan2(h,f),f=Math.sin((1-b)*k)/h,h=Math.sin(b*k)/h;this._w=g*f+this._w*h;this._x=c*f+this._x*h;this._y=e*f+
this._y*h;this._z=d*f+this._z*h;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};
Object.assign(THREE.Quaternion,{slerp:function(a,b,c,e){return c.copy(a).slerp(b,e)},slerpFlat:function(a,b,c,e,d,g,f){var h=c[e+0],k=c[e+1],l=c[e+2];c=c[e+3];e=d[g+0];var n=d[g+1],q=d[g+2];d=d[g+3];if(c!==d||h!==e||k!==n||l!==q){g=1-f;var m=h*e+k*n+l*q+c*d,p=0<=m?1:-1,r=1-m*m;r>Number.EPSILON&&(r=Math.sqrt(r),m=Math.atan2(r,m*p),g=Math.sin(g*m)/r,f=Math.sin(f*m)/r);p*=f;h=h*g+e*p;k=k*g+n*p;l=l*g+q*p;c=c*g+d*p;g===1-f&&(f=1/Math.sqrt(h*h+k*k+l*l+c*c),h*=f,k*=f,l*=f,c*=f)}a[b]=h;a[b+1]=k;a[b+2]=l;
a[b+3]=c}});THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};
THREE.Vector2.prototype={constructor:THREE.Vector2,get width(){return this.x},set width(a){this.x=a},get height(){return this.y},set height(a){this.y=a},set:function(a,b){this.x=a;this.y=b;return this},setScalar:function(a){this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;
case 1:return this.y;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},
addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,
this.y*=a):this.y=this.x=0;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));return this},clampScalar:function(){var a,b;return function(c,e){void 0===
a&&(a=new THREE.Vector2,b=new THREE.Vector2);a.set(c,c);b.set(e,e);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();this.multiplyScalar(Math.max(a,Math.min(b,c))/c);return this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):
Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var a=Math.atan2(this.y,this.x);0>a&&(a+=
2*Math.PI);return a},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];
this.y=a[b+1];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];return this},rotateAround:function(a,b){var c=Math.cos(b),e=Math.sin(b),d=this.x-a.x,g=this.y-a.y;this.x=d*c-g*e+a.x;this.y=d*e+g*c+a.y;return this}};THREE.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};
THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setScalar:function(a){this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;
case 2:return this.z;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,
b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},
multiply:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===b instanceof THREE.Euler&&
console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.");void 0===a&&(a=new THREE.Quaternion);this.applyQuaternion(a.setFromEuler(b));return this}}(),applyAxisAngle:function(){var a;return function(b,c){void 0===a&&(a=new THREE.Quaternion);this.applyQuaternion(a.setFromAxisAngle(b,c));return this}}(),applyMatrix3:function(a){var b=this.x,c=this.y,e=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*e;this.y=a[1]*b+a[4]*c+a[7]*e;this.z=a[2]*b+a[5]*c+a[8]*
e;return this},applyMatrix4:function(a){var b=this.x,c=this.y,e=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*e+a[12];this.y=a[1]*b+a[5]*c+a[9]*e+a[13];this.z=a[2]*b+a[6]*c+a[10]*e+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,e=this.z;a=a.elements;var d=1/(a[3]*b+a[7]*c+a[11]*e+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*e+a[12])*d;this.y=(a[1]*b+a[5]*c+a[9]*e+a[13])*d;this.z=(a[2]*b+a[6]*c+a[10]*e+a[14])*d;return this},applyQuaternion:function(a){var b=this.x,c=this.y,e=this.z,d=a.x,
g=a.y,f=a.z;a=a.w;var h=a*b+g*e-f*c,k=a*c+f*b-d*e,l=a*e+d*c-g*b,b=-d*b-g*c-f*e;this.x=h*a+b*-d+k*-f-l*-g;this.y=k*a+b*-g+l*-d-h*-f;this.z=l*a+b*-f+h*-g-k*-d;return this},project:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyProjection(a)}}(),unproject:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyProjection(a)}}(),
transformDirection:function(a){var b=this.x,c=this.y,e=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*e;this.y=a[1]*b+a[5]*c+a[9]*e;this.z=a[2]*b+a[6]*c+a[10]*e;this.normalize();return this},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);
this.z=Math.max(this.z,a.z);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this},clampScalar:function(){var a,b;return function(c,e){void 0===a&&(a=new THREE.Vector3,b=new THREE.Vector3);a.set(c,c,c);b.set(e,e,e);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();this.multiplyScalar(Math.max(a,Math.min(b,c))/c);return this},floor:function(){this.x=Math.floor(this.x);
this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;
this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*
b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},cross:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var c=this.x,e=this.y,d=this.z;this.x=e*a.z-d*a.y;this.y=d*a.x-c*a.z;this.z=c*a.y-e*a.x;return this},crossVectors:function(a,b){var c=a.x,e=a.y,d=a.z,g=b.x,f=b.y,h=b.z;this.x=e*h-d*f;
this.y=d*g-c*h;this.z=c*f-e*g;return this},projectOnVector:function(){var a,b;return function(c){void 0===a&&(a=new THREE.Vector3);a.copy(c).normalize();b=this.dot(a);return this.copy(a).multiplyScalar(b)}}(),projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=
this.dot(a)/Math.sqrt(this.lengthSq()*a.lengthSq());return Math.acos(THREE.Math.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},setFromSpherical:function(a){var b=Math.sin(a.phi)*a.radius;this.x=b*Math.sin(a.theta);this.y=Math.cos(a.phi)*a.radius;this.z=b*Math.cos(a.theta);return this},setFromMatrixPosition:function(a){return this.setFromMatrixColumn(a,3)},setFromMatrixScale:function(a){var b=
this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,1).length();a=this.setFromMatrixColumn(a,2).length();this.x=b;this.y=c;this.z=a;return this},setFromMatrixColumn:function(a,b){"number"===typeof a&&(console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index )."),b=a=b);return this.fromArray(a.elements,4*b)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},
toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];return this}};THREE.Vector4=function(a,b,c,e){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==e?e:1};
THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,b,c,e){this.x=a;this.y=b;this.z=c;this.w=e;return this},setScalar:function(a){this.w=this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+
a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);
this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;this.w+=a.w*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=
a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a,this.w*=a):this.w=this.z=this.y=this.x=0;return this},applyMatrix4:function(a){var b=this.x,c=this.y,e=this.z,d=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*e+a[12]*d;this.y=a[1]*b+a[5]*c+a[9]*e+a[13]*d;this.z=
a[2]*b+a[6]*c+a[10]*e+a[14]*d;this.w=a[3]*b+a[7]*c+a[11]*e+a[15]*d;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){var b,c,e;a=a.elements;var d=a[0];e=a[4];var g=a[8],f=a[1],h=a[5],k=a[9];c=a[2];b=a[6];var l=a[10];if(.01>Math.abs(e-f)&&.01>Math.abs(g-c)&&.01>
Math.abs(k-b)){if(.1>Math.abs(e+f)&&.1>Math.abs(g+c)&&.1>Math.abs(k+b)&&.1>Math.abs(d+h+l-3))return this.set(1,0,0,0),this;a=Math.PI;d=(d+1)/2;h=(h+1)/2;l=(l+1)/2;e=(e+f)/4;g=(g+c)/4;k=(k+b)/4;d>h&&d>l?.01>d?(b=0,e=c=.707106781):(b=Math.sqrt(d),c=e/b,e=g/b):h>l?.01>h?(b=.707106781,c=0,e=.707106781):(c=Math.sqrt(h),b=e/c,e=k/c):.01>l?(c=b=.707106781,e=0):(e=Math.sqrt(l),b=g/e,c=k/e);this.set(b,c,e,a);return this}a=Math.sqrt((b-k)*(b-k)+(g-c)*(g-c)+(f-e)*(f-e));.001>Math.abs(a)&&(a=1);this.x=(b-k)/
a;this.y=(g-c)/a;this.z=(f-e)/a;this.w=Math.acos((d+h+l-1)/2);return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);this.w=Math.min(this.w,a.w);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);this.w=Math.max(this.w,a.w);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));
this.w=Math.max(a.w,Math.min(b.w,this.w));return this},clampScalar:function(){var a,b;return function(c,e){void 0===a&&(a=new THREE.Vector4,b=new THREE.Vector4);a.set(c,c,c,c);b.set(e,e,e,e);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=
Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*
a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-
this.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+
c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];this.w=a.array[b+3];return this}};THREE.Euler=function(a,b,c,e){this._x=a||0;this._y=b||0;this._z=c||0;this._order=e||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");THREE.Euler.DefaultOrder="XYZ";
THREE.Euler.prototype={constructor:THREE.Euler,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,c,e){this._x=a;this._y=b;this._z=c;this._order=e||this._order;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,
this._y,this._z,this._order)},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b,c){var e=THREE.Math.clamp,d=a.elements;a=d[0];var g=d[4],f=d[8],h=d[1],k=d[5],l=d[9],n=d[2],q=d[6],d=d[10];b=b||this._order;"XYZ"===b?(this._y=Math.asin(e(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-g,a)):(this._x=Math.atan2(q,k),this._z=0)):"YXZ"===b?(this._x=Math.asin(-e(l,-1,1)),.99999>Math.abs(l)?
(this._y=Math.atan2(f,d),this._z=Math.atan2(h,k)):(this._y=Math.atan2(-n,a),this._z=0)):"ZXY"===b?(this._x=Math.asin(e(q,-1,1)),.99999>Math.abs(q)?(this._y=Math.atan2(-n,d),this._z=Math.atan2(-g,k)):(this._y=0,this._z=Math.atan2(h,a))):"ZYX"===b?(this._y=Math.asin(-e(n,-1,1)),.99999>Math.abs(n)?(this._x=Math.atan2(q,d),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-g,k))):"YZX"===b?(this._z=Math.asin(e(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(-l,k),this._y=Math.atan2(-n,a)):(this._x=
0,this._y=Math.atan2(f,d))):"XZY"===b?(this._z=Math.asin(-e(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(q,k),this._y=Math.atan2(f,a)):(this._x=Math.atan2(-l,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+b);this._order=b;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var a;return function(b,c,e){void 0===a&&(a=new THREE.Matrix4);a.makeRotationFromQuaternion(b);this.setFromRotationMatrix(a,c,e);return this}}(),setFromVector3:function(a,
b){return this.set(a.x,a.y,a.z,b||this._order)},reorder:function(){var a=new THREE.Quaternion;return function(b){a.setFromEuler(this);this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+
3]=this._order;return a},toVector3:function(a){return a?a.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};THREE.Line3=function(a,b){this.start=void 0!==a?a:new THREE.Vector3;this.end=void 0!==b?b:new THREE.Vector3};
THREE.Line3.prototype={constructor:THREE.Line3,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},center:function(a){return(a||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},
at:function(a,b){var c=b||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,e){a.subVectors(c,this.start);b.subVectors(this.end,this.start);var d=b.dot(b),d=b.dot(a)/d;e&&(d=THREE.Math.clamp(d,0,1));return d}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);c=c||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);
this.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)}};THREE.Box2=function(a,b){this.min=void 0!==a?a:new THREE.Vector2(Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector2(-Infinity,-Infinity)};
THREE.Box2.prototype={constructor:THREE.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new THREE.Vector2;return function(b,c){var e=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(e);this.max.copy(b).add(e);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);
return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new THREE.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);
this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector2).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>
this.max.y?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector2;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&
a.max.equals(this.max)}};THREE.Box3=function(a,b){this.min=void 0!==a?a:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};
THREE.Box3.prototype={constructor:THREE.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromArray:function(a){this.makeEmpty();for(var b=Infinity,c=Infinity,e=Infinity,d=-Infinity,g=-Infinity,f=-Infinity,h=0,k=a.length;h<k;h+=3){var l=a[h],n=a[h+1],q=a[h+2];l<b&&(b=l);n<c&&(c=n);q<e&&(e=q);l>d&&(d=l);n>g&&(g=n);q>f&&(f=q)}this.min.set(b,c,e);this.max.set(d,g,f)},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},
setFromCenterAndSize:function(){var a=new THREE.Vector3;return function(b,c){var e=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(e);this.max.copy(b).add(e);return this}}(),setFromObject:function(){var a;return function(b){void 0===a&&(a=new THREE.Box3);var c=this;this.makeEmpty();b.updateMatrixWorld(!0);b.traverse(function(b){var d=b.geometry;void 0!==d&&(null===d.boundingBox&&d.computeBoundingBox(),!1===d.boundingBox.isEmpty()&&(a.copy(d.boundingBox),a.applyMatrix4(b.matrixWorld),c.union(a)))});
return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(a){return(a||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector3).subVectors(this.max,
this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=
a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector3).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0},intersectsSphere:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);this.clampPoint(b.center,a);return a.distanceToSquared(b.center)<=
b.radius*b.radius}}(),intersectsPlane:function(a){var b,c;0<a.normal.x?(b=a.normal.x*this.min.x,c=a.normal.x*this.max.x):(b=a.normal.x*this.max.x,c=a.normal.x*this.min.x);0<a.normal.y?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,c+=a.normal.y*this.min.y);0<a.normal.z?(b+=a.normal.z*this.min.z,c+=a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z);return b<=a.constant&&c>=a.constant},clampPoint:function(a,b){return(b||new THREE.Vector3).copy(a).clamp(this.min,
this.max)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new THREE.Vector3;return function(b){b=b||new THREE.Sphere;b.center=this.center();b.radius=.5*this.size(a).length();return b}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(){var a=[new THREE.Vector3,
new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(b){a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,
this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.makeEmpty();this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}};THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")};
THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(a,b,c,e,d,g,f,h,k){var l=this.elements;l[0]=a;l[1]=e;l[2]=f;l[3]=b;l[4]=d;l[5]=h;l[6]=c;l[7]=g;l[8]=k;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},setFromMatrix4:function(a){a=a.elements;this.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]);
return this},applyToVector3Array:function(){var a;return function(b,c,e){void 0===a&&(a=new THREE.Vector3);void 0===c&&(c=0);void 0===e&&(e=b.length);for(var d=0;d<e;d+=3,c+=3)a.fromArray(b,c),a.applyMatrix3(this),a.toArray(b,c);return b}}(),applyToBuffer:function(){var a;return function(b,c,e){void 0===a&&(a=new THREE.Vector3);void 0===c&&(c=0);void 0===e&&(e=b.length/b.itemSize);for(var d=0;d<e;d++,c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.applyMatrix3(this),b.setXYZ(a.x,a.y,a.z);return b}}(),
multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],e=a[2],d=a[3],g=a[4],f=a[5],h=a[6],k=a[7],a=a[8];return b*g*a-b*f*k-c*d*a+c*f*h+e*d*k-e*g*h},getInverse:function(a,b){a instanceof THREE.Matrix4&&console.warn("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var c=a.elements,e=this.elements,d=c[0],g=c[1],f=c[2],h=c[3],k=c[4],l=c[5],n=c[6],q=c[7],
c=c[8],m=c*k-l*q,p=l*n-c*h,r=q*h-k*n,u=d*m+g*p+f*r;if(0===u){if(b)throw Error("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");return this.identity()}e[0]=m;e[1]=f*q-c*g;e[2]=l*g-f*k;e[3]=p;e[4]=c*d-f*n;e[5]=f*h-l*d;e[6]=r;e[7]=g*n-q*d;e[8]=k*d-g*h;return this.multiplyScalar(1/u)},transpose:function(){var a,b=this.elements;a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=b[7];b[7]=a;return this},
flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a},getNormalMatrix:function(a){return this.setFromMatrix4(a).getInverse(this).transpose()},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;
return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]}};THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")};
THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(a,b,c,e,d,g,f,h,k,l,n,q,m,p,r,u){var t=this.elements;t[0]=a;t[4]=b;t[8]=c;t[12]=e;t[1]=d;t[5]=g;t[9]=f;t[13]=h;t[2]=k;t[6]=l;t[10]=n;t[14]=q;t[3]=m;t[7]=p;t[11]=r;t[15]=u;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)},copy:function(a){this.elements.set(a.elements);return this},copyPosition:function(a){var b=this.elements;a=a.elements;
b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,b,c){a.setFromMatrixColumn(this,0);b.setFromMatrixColumn(this,1);c.setFromMatrixColumn(this,2);return this},makeBasis:function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);var c=this.elements,e=b.elements,d=1/a.setFromMatrixColumn(b,0).length(),g=1/a.setFromMatrixColumn(b,1).length();b=1/a.setFromMatrixColumn(b,
2).length();c[0]=e[0]*d;c[1]=e[1]*d;c[2]=e[2]*d;c[4]=e[4]*g;c[5]=e[5]*g;c[6]=e[6]*g;c[8]=e[8]*b;c[9]=e[9]*b;c[10]=e[10]*b;return this}}(),makeRotationFromEuler:function(a){!1===a instanceof THREE.Euler&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,e=a.y,d=a.z,g=Math.cos(c),c=Math.sin(c),f=Math.cos(e),e=Math.sin(e),h=Math.cos(d),d=Math.sin(d);if("XYZ"===a.order){a=g*h;var k=g*d,l=c*h,n=c*d;b[0]=f*h;b[4]=
-f*d;b[8]=e;b[1]=k+l*e;b[5]=a-n*e;b[9]=-c*f;b[2]=n-a*e;b[6]=l+k*e;b[10]=g*f}else"YXZ"===a.order?(a=f*h,k=f*d,l=e*h,n=e*d,b[0]=a+n*c,b[4]=l*c-k,b[8]=g*e,b[1]=g*d,b[5]=g*h,b[9]=-c,b[2]=k*c-l,b[6]=n+a*c,b[10]=g*f):"ZXY"===a.order?(a=f*h,k=f*d,l=e*h,n=e*d,b[0]=a-n*c,b[4]=-g*d,b[8]=l+k*c,b[1]=k+l*c,b[5]=g*h,b[9]=n-a*c,b[2]=-g*e,b[6]=c,b[10]=g*f):"ZYX"===a.order?(a=g*h,k=g*d,l=c*h,n=c*d,b[0]=f*h,b[4]=l*e-k,b[8]=a*e+n,b[1]=f*d,b[5]=n*e+a,b[9]=k*e-l,b[2]=-e,b[6]=c*f,b[10]=g*f):"YZX"===a.order?(a=g*f,k=g*
e,l=c*f,n=c*e,b[0]=f*h,b[4]=n-a*d,b[8]=l*d+k,b[1]=d,b[5]=g*h,b[9]=-c*h,b[2]=-e*h,b[6]=k*d+l,b[10]=a-n*d):"XZY"===a.order&&(a=g*f,k=g*e,l=c*f,n=c*e,b[0]=f*h,b[4]=-d,b[8]=e*h,b[1]=a*d+n,b[5]=g*h,b[9]=k*d-l,b[2]=l*d-k,b[6]=c*h,b[10]=n*d+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,e=a.y,d=a.z,g=a.w,f=c+c,h=e+e,k=d+d;a=c*f;var l=c*h,c=c*k,n=e*h,e=e*k,d=d*k,f=g*f,h=g*h,g=g*k;b[0]=1-(n+d);b[4]=l-g;b[8]=c+h;b[1]=l+
g;b[5]=1-(a+d);b[9]=e-f;b[2]=c-h;b[6]=e+f;b[10]=1-(a+n);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a,b,c;return function(e,d,g){void 0===a&&(a=new THREE.Vector3);void 0===b&&(b=new THREE.Vector3);void 0===c&&(c=new THREE.Vector3);var f=this.elements;c.subVectors(e,d).normalize();0===c.lengthSq()&&(c.z=1);a.crossVectors(g,c).normalize();0===a.lengthSq()&&(c.x+=1E-4,a.crossVectors(g,c).normalize());b.crossVectors(c,a);f[0]=a.x;f[4]=b.x;f[8]=c.x;f[1]=a.y;
f[5]=b.y;f[9]=c.y;f[2]=a.z;f[6]=b.z;f[10]=c.z;return this}}(),multiply:function(a,b){return void 0!==b?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,e=b.elements,d=this.elements,g=c[0],f=c[4],h=c[8],k=c[12],l=c[1],n=c[5],q=c[9],m=c[13],p=c[2],r=c[6],u=c[10],t=c[14],v=c[3],x=c[7],A=c[11],c=c[15],w=e[0],D=e[4],B=e[8],z=e[12],F=
e[1],G=e[5],C=e[9],L=e[13],K=e[2],H=e[6],M=e[10],E=e[14],J=e[3],N=e[7],P=e[11],e=e[15];d[0]=g*w+f*F+h*K+k*J;d[4]=g*D+f*G+h*H+k*N;d[8]=g*B+f*C+h*M+k*P;d[12]=g*z+f*L+h*E+k*e;d[1]=l*w+n*F+q*K+m*J;d[5]=l*D+n*G+q*H+m*N;d[9]=l*B+n*C+q*M+m*P;d[13]=l*z+n*L+q*E+m*e;d[2]=p*w+r*F+u*K+t*J;d[6]=p*D+r*G+u*H+t*N;d[10]=p*B+r*C+u*M+t*P;d[14]=p*z+r*L+u*E+t*e;d[3]=v*w+x*F+A*K+c*J;d[7]=v*D+x*G+A*H+c*N;d[11]=v*B+x*C+A*M+c*P;d[15]=v*z+x*L+A*E+c*e;return this},multiplyToArray:function(a,b,c){var e=this.elements;this.multiplyMatrices(a,
b);c[0]=e[0];c[1]=e[1];c[2]=e[2];c[3]=e[3];c[4]=e[4];c[5]=e[5];c[6]=e[6];c[7]=e[7];c[8]=e[8];c[9]=e[9];c[10]=e[10];c[11]=e[11];c[12]=e[12];c[13]=e[13];c[14]=e[14];c[15]=e[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},applyToVector3Array:function(){var a;return function(b,c,e){void 0===a&&(a=new THREE.Vector3);void 0===c&&(c=0);void 0===
e&&(e=b.length);for(var d=0;d<e;d+=3,c+=3)a.fromArray(b,c),a.applyMatrix4(this),a.toArray(b,c);return b}}(),applyToBuffer:function(){var a;return function(b,c,e){void 0===a&&(a=new THREE.Vector3);void 0===c&&(c=0);void 0===e&&(e=b.length/b.itemSize);for(var d=0;d<e;d++,c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.applyMatrix4(this),b.setXYZ(a.x,a.y,a.z);return b}}(),determinant:function(){var a=this.elements,b=a[0],c=a[4],e=a[8],d=a[12],g=a[1],f=a[5],h=a[9],k=a[13],l=a[2],n=a[6],q=a[10],m=a[14];
return a[3]*(+d*h*n-e*k*n-d*f*q+c*k*q+e*f*m-c*h*m)+a[7]*(+b*h*m-b*k*q+d*g*q-e*g*m+e*k*l-d*h*l)+a[11]*(+b*k*n-b*f*m-d*g*n+c*g*m+d*f*l-c*k*l)+a[15]*(-e*f*l-b*h*n+b*f*q+e*g*n-c*g*q+c*h*l)},transpose:function(){var a=this.elements,b;b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=
c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a},getPosition:function(){var a;return function(){void 0===a&&(a=new THREE.Vector3);console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return a.setFromMatrixColumn(this,3)}}(),setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,
b){var c=this.elements,e=a.elements,d=e[0],g=e[1],f=e[2],h=e[3],k=e[4],l=e[5],n=e[6],q=e[7],m=e[8],p=e[9],r=e[10],u=e[11],t=e[12],v=e[13],x=e[14],e=e[15],A=p*x*q-v*r*q+v*n*u-l*x*u-p*n*e+l*r*e,w=t*r*q-m*x*q-t*n*u+k*x*u+m*n*e-k*r*e,D=m*v*q-t*p*q+t*l*u-k*v*u-m*l*e+k*p*e,B=t*p*n-m*v*n-t*l*r+k*v*r+m*l*x-k*p*x,z=d*A+g*w+f*D+h*B;if(0===z){if(b)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");
return this.identity()}c[0]=A;c[1]=v*r*h-p*x*h-v*f*u+g*x*u+p*f*e-g*r*e;c[2]=l*x*h-v*n*h+v*f*q-g*x*q-l*f*e+g*n*e;c[3]=p*n*h-l*r*h-p*f*q+g*r*q+l*f*u-g*n*u;c[4]=w;c[5]=m*x*h-t*r*h+t*f*u-d*x*u-m*f*e+d*r*e;c[6]=t*n*h-k*x*h-t*f*q+d*x*q+k*f*e-d*n*e;c[7]=k*r*h-m*n*h+m*f*q-d*r*q-k*f*u+d*n*u;c[8]=D;c[9]=t*p*h-m*v*h-t*g*u+d*v*u+m*g*e-d*p*e;c[10]=k*v*h-t*l*h+t*g*q-d*v*q-k*g*e+d*l*e;c[11]=m*l*h-k*p*h-m*g*q+d*p*q+k*g*u-d*l*u;c[12]=B;c[13]=m*v*f-t*p*f+t*g*r-d*v*r-m*g*x+d*p*x;c[14]=t*l*f-k*v*f-t*g*n+d*v*n+k*g*x-
d*l*x;c[15]=k*p*f-m*l*f+m*g*n-d*p*n-k*g*r+d*l*r;return this.multiplyScalar(1/z)},scale:function(a){var b=this.elements,c=a.x,e=a.y;a=a.z;b[0]*=c;b[4]*=e;b[8]*=a;b[1]*=c;b[5]*=e;b[9]*=a;b[2]*=c;b[6]*=e;b[10]*=a;b[3]*=c;b[7]*=e;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this},
makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b),e=Math.sin(b),d=1-c,g=a.x,f=a.y,h=a.z,k=d*g,l=d*f;this.set(k*g+c,k*f-e*h,k*h+e*f,0,k*f+e*h,l*f+c,l*h-e*g,0,k*h-
e*f,l*h+e*g,d*h*h+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a,b;return function(c,e,d){void 0===a&&(a=new THREE.Vector3);void 0===b&&(b=new THREE.Matrix4);var g=this.elements,f=a.set(g[0],g[1],g[2]).length(),h=a.set(g[4],g[5],g[6]).length(),k=a.set(g[8],g[9],g[10]).length();0>this.determinant()&&(f=-f);c.x=
g[12];c.y=g[13];c.z=g[14];b.elements.set(this.elements);c=1/f;var g=1/h,l=1/k;b.elements[0]*=c;b.elements[1]*=c;b.elements[2]*=c;b.elements[4]*=g;b.elements[5]*=g;b.elements[6]*=g;b.elements[8]*=l;b.elements[9]*=l;b.elements[10]*=l;e.setFromRotationMatrix(b);d.x=f;d.y=h;d.z=k;return this}}(),makeFrustum:function(a,b,c,e,d,g){var f=this.elements;f[0]=2*d/(b-a);f[4]=0;f[8]=(b+a)/(b-a);f[12]=0;f[1]=0;f[5]=2*d/(e-c);f[9]=(e+c)/(e-c);f[13]=0;f[2]=0;f[6]=0;f[10]=-(g+d)/(g-d);f[14]=-2*g*d/(g-d);f[3]=0;f[7]=
0;f[11]=-1;f[15]=0;return this},makePerspective:function(a,b,c,e){a=c*Math.tan(THREE.Math.degToRad(.5*a));var d=-a;return this.makeFrustum(d*b,a*b,d,a,c,e)},makeOrthographic:function(a,b,c,e,d,g){var f=this.elements,h=1/(b-a),k=1/(c-e),l=1/(g-d);f[0]=2*h;f[4]=0;f[8]=0;f[12]=-((b+a)*h);f[1]=0;f[5]=2*k;f[9]=0;f[13]=-((c+e)*k);f[2]=0;f[6]=0;f[10]=-2*l;f[14]=-((g+d)*l);f[3]=0;f[7]=0;f[11]=0;f[15]=1;return this},equals:function(a){var b=this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;
return!0},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]}};THREE.Ray=function(a,b){this.origin=void 0!==a?a:new THREE.Vector3;this.direction=void 0!==b?b:new THREE.Vector3};
THREE.Ray.prototype={constructor:THREE.Ray,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){return(b||new THREE.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(a){this.direction.copy(a).sub(this.origin).normalize()},recast:function(){var a=new THREE.Vector3;return function(b){this.origin.copy(this.at(b,
a));return this}}(),closestPointToPoint:function(a,b){var c=b||new THREE.Vector3;c.subVectors(a,this.origin);var e=c.dot(this.direction);return 0>e?c.copy(this.origin):c.copy(this.direction).multiplyScalar(e).add(this.origin)},distanceToPoint:function(a){return Math.sqrt(this.distanceSqToPoint(a))},distanceSqToPoint:function(){var a=new THREE.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceToSquared(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);
return a.distanceToSquared(b)}}(),distanceSqToSegment:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(e,d,g,f){a.copy(e).add(d).multiplyScalar(.5);b.copy(d).sub(e).normalize();c.copy(this.origin).sub(a);var h=.5*e.distanceTo(d),k=-this.direction.dot(b),l=c.dot(this.direction),n=-c.dot(b),q=c.lengthSq(),m=Math.abs(1-k*k),p;0<m?(e=k*n-l,d=k*l-n,p=h*m,0<=e?d>=-p?d<=p?(h=1/m,e*=h,d*=h,k=e*(e+k*d+2*l)+d*(k*e+d+2*n)+q):(d=h,e=Math.max(0,-(k*d+l)),k=-e*e+d*(d+2*
n)+q):(d=-h,e=Math.max(0,-(k*d+l)),k=-e*e+d*(d+2*n)+q):d<=-p?(e=Math.max(0,-(-k*h+l)),d=0<e?-h:Math.min(Math.max(-h,-n),h),k=-e*e+d*(d+2*n)+q):d<=p?(e=0,d=Math.min(Math.max(-h,-n),h),k=d*(d+2*n)+q):(e=Math.max(0,-(k*h+l)),d=0<e?h:Math.min(Math.max(-h,-n),h),k=-e*e+d*(d+2*n)+q)):(d=0<k?-h:h,e=Math.max(0,-(k*d+l)),k=-e*e+d*(d+2*n)+q);g&&g.copy(this.direction).multiplyScalar(e).add(this.origin);f&&f.copy(b).multiplyScalar(d).add(a);return k}}(),intersectSphere:function(){var a=new THREE.Vector3;return function(b,
c){a.subVectors(b.center,this.origin);var e=a.dot(this.direction),d=a.dot(a)-e*e,g=b.radius*b.radius;if(d>g)return null;g=Math.sqrt(g-d);d=e-g;e+=g;return 0>d&&0>e?null:0>d?this.at(e,c):this.at(d,c)}}(),intersectsSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0===b)return 0===a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){var c=
this.distanceToPlane(a);return null===c?null:this.at(c,b)},intersectsPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},intersectBox:function(a,b){var c,e,d,g,f;e=1/this.direction.x;g=1/this.direction.y;f=1/this.direction.z;var h=this.origin;0<=e?(c=(a.min.x-h.x)*e,e*=a.max.x-h.x):(c=(a.max.x-h.x)*e,e*=a.min.x-h.x);0<=g?(d=(a.min.y-h.y)*g,g*=a.max.y-h.y):(d=(a.max.y-h.y)*g,g*=a.min.y-h.y);if(c>g||d>e)return null;if(d>c||c!==c)c=d;if(g<e||e!==
e)e=g;0<=f?(d=(a.min.z-h.z)*f,f*=a.max.z-h.z):(d=(a.max.z-h.z)*f,f*=a.min.z-h.z);if(c>f||d>e)return null;if(d>c||c!==c)c=d;if(f<e||e!==e)e=f;return 0>e?null:this.at(0<=c?c:e,b)},intersectsBox:function(){var a=new THREE.Vector3;return function(b){return null!==this.intersectBox(b,a)}}(),intersectTriangle:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,e=new THREE.Vector3;return function(d,g,f,h,k){b.subVectors(g,d);c.subVectors(f,d);e.crossVectors(b,c);g=this.direction.dot(e);
if(0<g){if(h)return null;h=1}else if(0>g)h=-1,g=-g;else return null;a.subVectors(this.origin,d);d=h*this.direction.dot(c.crossVectors(a,c));if(0>d)return null;f=h*this.direction.dot(b.cross(a));if(0>f||d+f>g)return null;d=-h*a.dot(e);return 0>d?null:this.at(d/g,k)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}};
THREE.Sphere=function(a,b){this.center=void 0!==a?a:new THREE.Vector3;this.radius=void 0!==b?b:0};
THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new THREE.Box3;return function(b,c){var e=this.center;void 0!==c?e.copy(c):a.setFromPoints(b).center(e);for(var d=0,g=0,f=b.length;g<f;g++)d=Math.max(d,e.distanceToSquared(b[g]));this.radius=Math.sqrt(d);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},
empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},intersectsBox:function(a){return a.intersectsSphere(this)},intersectsPlane:function(a){return Math.abs(this.center.dot(a.normal)-a.constant)<=this.radius},clampPoint:function(a,b){var c=
this.center.distanceToSquared(a),e=b||new THREE.Vector3;e.copy(a);c>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center));return e},getBoundingBox:function(a){a=a||new THREE.Box3;a.set(this.center,this.center);a.expandByScalar(this.radius);return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&
a.radius===this.radius}};THREE.Frustum=function(a,b,c,e,d,g){this.planes=[void 0!==a?a:new THREE.Plane,void 0!==b?b:new THREE.Plane,void 0!==c?c:new THREE.Plane,void 0!==e?e:new THREE.Plane,void 0!==d?d:new THREE.Plane,void 0!==g?g:new THREE.Plane]};
THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(a,b,c,e,d,g){var f=this.planes;f[0].copy(a);f[1].copy(b);f[2].copy(c);f[3].copy(e);f[4].copy(d);f[5].copy(g);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){for(var b=this.planes,c=0;6>c;c++)b[c].copy(a.planes[c]);return this},setFromMatrix:function(a){var b=this.planes,c=a.elements;a=c[0];var e=c[1],d=c[2],g=c[3],f=c[4],h=c[5],k=c[6],l=c[7],n=c[8],q=c[9],m=c[10],p=c[11],r=c[12],u=c[13],t=c[14],
c=c[15];b[0].setComponents(g-a,l-f,p-n,c-r).normalize();b[1].setComponents(g+a,l+f,p+n,c+r).normalize();b[2].setComponents(g+e,l+h,p+q,c+u).normalize();b[3].setComponents(g-e,l-h,p-q,c-u).normalize();b[4].setComponents(g-d,l-k,p-m,c-t).normalize();b[5].setComponents(g+d,l+k,p+m,c+t).normalize();return this},intersectsObject:function(){var a=new THREE.Sphere;return function(b){var c=b.geometry;null===c.boundingSphere&&c.computeBoundingSphere();a.copy(c.boundingSphere);a.applyMatrix4(b.matrixWorld);
return this.intersectsSphere(a)}}(),intersectsSphere:function(a){var b=this.planes,c=a.center;a=-a.radius;for(var e=0;6>e;e++)if(b[e].distanceToPoint(c)<a)return!1;return!0},intersectsBox:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){for(var e=this.planes,d=0;6>d;d++){var g=e[d];a.x=0<g.normal.x?c.min.x:c.max.x;b.x=0<g.normal.x?c.max.x:c.min.x;a.y=0<g.normal.y?c.min.y:c.max.y;b.y=0<g.normal.y?c.max.y:c.min.y;a.z=0<g.normal.z?c.min.z:c.max.z;b.z=0<g.normal.z?c.max.z:c.min.z;
var f=g.distanceToPoint(a),g=g.distanceToPoint(b);if(0>f&&0>g)return!1}return!0}}(),containsPoint:function(a){for(var b=this.planes,c=0;6>c;c++)if(0>b[c].distanceToPoint(a))return!1;return!0}};THREE.Plane=function(a,b){this.normal=void 0!==a?a:new THREE.Vector3(1,0,0);this.constant=void 0!==b?b:0};
THREE.Plane.prototype={constructor:THREE.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,e){this.normal.set(a,b,c);this.constant=e;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,e,d){e=a.subVectors(d,e).cross(b.subVectors(c,e)).normalize();this.setFromNormalAndCoplanarPoint(e,
c);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,
b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,b){var c=this.distanceToPoint(a);return(b||new THREE.Vector3).copy(this.normal).multiplyScalar(c)},intersectLine:function(){var a=new THREE.Vector3;return function(b,c){var e=c||new THREE.Vector3,d=b.delta(a),g=this.normal.dot(d);if(0===g){if(0===this.distanceToPoint(b.start))return e.copy(b.start)}else return g=-(b.start.dot(this.normal)+this.constant)/g,0>g||1<g?void 0:e.copy(d).multiplyScalar(g).add(b.start)}}(),intersectsLine:function(a){var b=
this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectsBox:function(a){return a.intersectsPlane(this)},intersectsSphere:function(a){return a.intersectsPlane(this)},coplanarPoint:function(a){return(a||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(e,d){var g=d||c.getNormalMatrix(e),g=a.copy(this.normal).applyMatrix3(g),f=this.coplanarPoint(b);
f.applyMatrix4(e);this.setFromNormalAndCoplanarPoint(g,f);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&a.constant===this.constant}};THREE.Spherical=function(a,b,c){this.radius=void 0!==a?a:1;this.phi=void 0!==b?b:0;this.theta=void 0!==c?c:0;return this};
THREE.Spherical.prototype={constructor:THREE.Spherical,set:function(a,b,c){this.radius=a;this.phi=b;this.theta=c},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius.copy(a.radius);this.phi.copy(a.phi);this.theta.copy(a.theta);return this},makeSafe:function(){this.phi=Math.max(1E-6,Math.min(Math.PI-1E-6,this.phi))},setFromVector3:function(a){this.radius=a.length();0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(a.x,a.z),this.phi=Math.acos(THREE.Math.clamp(a.y/
this.radius,-1,1)));return this}};
THREE.Math={generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),b=Array(36),c=0,e;return function(){for(var d=0;36>d;d++)8===d||13===d||18===d||23===d?b[d]="-":14===d?b[d]="4":(2>=c&&(c=33554432+16777216*Math.random()|0),e=c&15,c>>=4,b[d]=a[19===d?e&3|8:e]);return b.join("")}}(),clamp:function(a,b,c){return Math.max(b,Math.min(c,a))},euclideanModulo:function(a,b){return(a%b+b)%b},mapLinear:function(a,b,c,e,d){return e+(a-b)*(d-e)/(c-b)},smoothstep:function(a,
b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead.");return Math.random()},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(){var a=
Math.PI/180;return function(b){return b*a}}(),radToDeg:function(){var a=180/Math.PI;return function(b){return b*a}}(),isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nearestPowerOfTwo:function(a){return Math.pow(2,Math.round(Math.log(a)/Math.LN2))},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a}};
THREE.Spline=function(a){function b(a,b,c,d,e,f,g){a=.5*(c-a);d=.5*(d-b);return(2*(b-c)+a+d)*g+(-3*(b-c)-2*a-d)*f+a*e+b}this.points=a;var c=[],e={x:0,y:0,z:0},d,g,f,h,k,l,n,q,m;this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}};this.getPoint=function(a){d=(this.points.length-1)*a;g=Math.floor(d);f=d-g;c[0]=0===g?g:g-1;c[1]=g;c[2]=g>this.points.length-2?this.points.length-1:g+1;c[3]=g>this.points.length-3?this.points.length-1:g+
2;l=this.points[c[0]];n=this.points[c[1]];q=this.points[c[2]];m=this.points[c[3]];h=f*f;k=f*h;e.x=b(l.x,n.x,q.x,m.x,f,h,k);e.y=b(l.y,n.y,q.y,m.y,f,h,k);e.z=b(l.z,n.z,q.z,m.z,f,h,k);return e};this.getControlPointsArray=function(){var a,b,c=this.points.length,d=[];for(a=0;a<c;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return d};this.getLength=function(a){var b,c,d,e=0,f=new THREE.Vector3,g=new THREE.Vector3,h=[],m=0;h[0]=0;a||(a=100);c=this.points.length*a;f.copy(this.points[0]);for(a=1;a<c;a++)b=a/c,
d=this.getPoint(b),g.copy(d),m+=g.distanceTo(f),f.copy(d),b*=this.points.length-1,b=Math.floor(b),b!==e&&(h[b]=m,e=b);h[h.length]=m;return{chunks:h,total:m}};this.reparametrizeByArcLength=function(a){var b,c,d,e,f,g,h=[],m=new THREE.Vector3,k=this.getLength();h.push(m.copy(this.points[0]).clone());for(b=1;b<this.points.length;b++){c=k.chunks[b]-k.chunks[b-1];g=Math.ceil(a*c/k.total);e=(b-1)/(this.points.length-1);f=b/(this.points.length-1);for(c=1;c<g-1;c++)d=e+1/g*c*(f-e),d=this.getPoint(d),h.push(m.copy(d).clone());
h.push(m.copy(this.points[b]).clone())}this.points=h}};THREE.Triangle=function(a,b,c){this.a=void 0!==a?a:new THREE.Vector3;this.b=void 0!==b?b:new THREE.Vector3;this.c=void 0!==c?c:new THREE.Vector3};THREE.Triangle.normal=function(){var a=new THREE.Vector3;return function(b,c,e,d){d=d||new THREE.Vector3;d.subVectors(e,c);a.subVectors(b,c);d.cross(a);b=d.lengthSq();return 0<b?d.multiplyScalar(1/Math.sqrt(b)):d.set(0,0,0)}}();
THREE.Triangle.barycoordFromPoint=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(e,d,g,f,h){a.subVectors(f,d);b.subVectors(g,d);c.subVectors(e,d);e=a.dot(a);d=a.dot(b);g=a.dot(c);var k=b.dot(b);f=b.dot(c);var l=e*k-d*d;h=h||new THREE.Vector3;if(0===l)return h.set(-2,-1,-1);l=1/l;k=(k*g-d*f)*l;e=(e*f-d*g)*l;return h.set(1-k-e,e,k)}}();
THREE.Triangle.containsPoint=function(){var a=new THREE.Vector3;return function(b,c,e,d){b=THREE.Triangle.barycoordFromPoint(b,c,e,d,a);return 0<=b.x&&0<=b.y&&1>=b.x+b.y}}();
THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,e){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[e]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,
this.b);return.5*a.cross(b).length()}}(),midpoint:function(a){return(a||new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return THREE.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return THREE.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return THREE.Triangle.containsPoint(a,this.a,this.b,this.c)},
equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}};THREE.Interpolant=function(a,b,c,e){this.parameterPositions=a;this._cachedIndex=0;this.resultBuffer=void 0!==e?e:new b.constructor(c);this.sampleValues=b;this.valueSize=c};
THREE.Interpolant.prototype={constructor:THREE.Interpolant,evaluate:function(a){var b=this.parameterPositions,c=this._cachedIndex,e=b[c],d=b[c-1];a:{b:{c:{d:if(!(a<e)){for(var g=c+2;;){if(void 0===e){if(a<d)break d;this._cachedIndex=c=b.length;return this.afterEnd_(c-1,a,d)}if(c===g)break;d=e;e=b[++c];if(a<e)break b}e=b.length;break c}if(a>=d)break a;else{g=b[1];a<g&&(c=2,d=g);for(g=c-2;;){if(void 0===d)return this._cachedIndex=0,this.beforeStart_(0,a,e);if(c===g)break;e=d;d=b[--c-1];if(a>=d)break b}e=
c;c=0}}for(;c<e;)d=c+e>>>1,a<b[d]?e=d:c=d+1;e=b[c];d=b[c-1];if(void 0===d)return this._cachedIndex=0,this.beforeStart_(0,a,e);if(void 0===e)return this._cachedIndex=c=b.length,this.afterEnd_(c-1,d,a)}this._cachedIndex=c;this.intervalChanged_(c,d,e)}return this.interpolate_(c,d,a,e)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(a){var b=this.resultBuffer,c=this.sampleValues,e=this.valueSize;a*=e;for(var d=0;d!==e;++d)b[d]=
c[a+d];return b},interpolate_:function(a,b,c,e){throw Error("call to abstract method");},intervalChanged_:function(a,b,c){}};Object.assign(THREE.Interpolant.prototype,{beforeStart_:THREE.Interpolant.prototype.copySampleValue_,afterEnd_:THREE.Interpolant.prototype.copySampleValue_});THREE.CubicInterpolant=function(a,b,c,e){THREE.Interpolant.call(this,a,b,c,e);this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0};
THREE.CubicInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.CubicInterpolant,DefaultSettings_:{endingStart:THREE.ZeroCurvatureEnding,endingEnd:THREE.ZeroCurvatureEnding},intervalChanged_:function(a,b,c){var e=this.parameterPositions,d=a-2,g=a+1,f=e[d],h=e[g];if(void 0===f)switch(this.getSettings_().endingStart){case THREE.ZeroSlopeEnding:d=a;f=2*b-c;break;case THREE.WrapAroundEnding:d=e.length-2;f=b+e[d]-e[d+1];break;default:d=a,f=c}if(void 0===h)switch(this.getSettings_().endingEnd){case THREE.ZeroSlopeEnding:g=
a;h=2*c-b;break;case THREE.WrapAroundEnding:g=1;h=c+e[1]-e[0];break;default:g=a-1,h=b}a=.5*(c-b);e=this.valueSize;this._weightPrev=a/(b-f);this._weightNext=a/(h-c);this._offsetPrev=d*e;this._offsetNext=g*e},interpolate_:function(a,b,c,e){var d=this.resultBuffer,g=this.sampleValues,f=this.valueSize;a*=f;var h=a-f,k=this._offsetPrev,l=this._offsetNext,n=this._weightPrev,q=this._weightNext,m=(c-b)/(e-b);c=m*m;e=c*m;b=-n*e+2*n*c-n*m;n=(1+n)*e+(-1.5-2*n)*c+(-.5+n)*m+1;m=(-1-q)*e+(1.5+q)*c+.5*m;q=q*e-q*
c;for(c=0;c!==f;++c)d[c]=b*g[k+c]+n*g[h+c]+m*g[a+c]+q*g[l+c];return d}});THREE.DiscreteInterpolant=function(a,b,c,e){THREE.Interpolant.call(this,a,b,c,e)};THREE.DiscreteInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.DiscreteInterpolant,interpolate_:function(a,b,c,e){return this.copySampleValue_(a-1)}});THREE.LinearInterpolant=function(a,b,c,e){THREE.Interpolant.call(this,a,b,c,e)};
THREE.LinearInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.LinearInterpolant,interpolate_:function(a,b,c,e){var d=this.resultBuffer,g=this.sampleValues,f=this.valueSize;a*=f;var h=a-f;b=(c-b)/(e-b);c=1-b;for(e=0;e!==f;++e)d[e]=g[h+e]*c+g[a+e]*b;return d}});THREE.QuaternionLinearInterpolant=function(a,b,c,e){THREE.Interpolant.call(this,a,b,c,e)};
THREE.QuaternionLinearInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.QuaternionLinearInterpolant,interpolate_:function(a,b,c,e){var d=this.resultBuffer,g=this.sampleValues,f=this.valueSize;a*=f;b=(c-b)/(e-b);for(c=a+f;a!==c;a+=4)THREE.Quaternion.slerpFlat(d,0,g,a-f,g,a,b);return d}});THREE.Clock=function(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};
THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=performance.now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=performance.now(),a=.001*(b-this.oldTime);this.oldTime=b;this.elapsedTime+=a}return a}};THREE.EventDispatcher=function(){};
THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(a){a.addEventListener=THREE.EventDispatcher.prototype.addEventListener;a.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener;a.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener;a.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&
c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},removeEventListener:function(a,b){if(void 0!==this._listeners){var c=this._listeners[a];if(void 0!==c){var e=c.indexOf(b);-1!==e&&c.splice(e,1)}}},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;for(var c=[],e=b.length,d=0;d<e;d++)c[d]=b[d];for(d=0;d<e;d++)c[d].call(this,a)}}}};
THREE.Layers=function(){this.mask=1};THREE.Layers.prototype={constructor:THREE.Layers,set:function(a){this.mask=1<<a},enable:function(a){this.mask|=1<<a},toggle:function(a){this.mask^=1<<a},disable:function(a){this.mask&=~(1<<a)},test:function(a){return 0!==(this.mask&a.mask)}};
(function(a){function b(a,b){return a.distance-b.distance}function c(a,b,g,f){if(!1!==a.visible&&(a.raycast(b,g),!0===f)){a=a.children;f=0;for(var d=a.length;f<d;f++)c(a[f],b,g,!0)}}a.Raycaster=function(b,c,g,f){this.ray=new a.Ray(b,c);this.near=g||0;this.far=f||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})};
a.Raycaster.prototype={constructor:a.Raycaster,linePrecision:1,set:function(a,b){this.ray.set(a,b)},setFromCamera:function(b,c){c instanceof a.PerspectiveCamera?(this.ray.origin.setFromMatrixPosition(c.matrixWorld),this.ray.direction.set(b.x,b.y,.5).unproject(c).sub(this.ray.origin).normalize()):c instanceof a.OrthographicCamera?(this.ray.origin.set(b.x,b.y,-1).unproject(c),this.ray.direction.set(0,0,-1).transformDirection(c.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},
intersectObject:function(a,d){var e=[];c(a,this,e,d);e.sort(b);return e},intersectObjects:function(a,d){var e=[];if(!1===Array.isArray(a))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),e;for(var f=0,h=a.length;f<h;f++)c(a[f],this,e,d);e.sort(b);return e}}})(THREE);
THREE.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var a=new THREE.Vector3,b=new THREE.Euler,c=new THREE.Quaternion,e=new THREE.Vector3(1,1,1);b.onChange(function(){c.setFromEuler(b,!1)});c.onChange(function(){b.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,
value:b},quaternion:{enumerable:!0,value:c},scale:{enumerable:!0,value:e},modelViewMatrix:{value:new THREE.Matrix4},normalMatrix:{value:new THREE.Matrix3}});this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=THREE.Object3D.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new THREE.Layers;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={}};
THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0);THREE.Object3D.DefaultMatrixAutoUpdate=!0;
THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=
new THREE.Quaternion;return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new THREE.Vector3;return function(b,c){a.copy(b).applyQuaternion(this.quaternion);
this.position.add(a.multiplyScalar(c));return this}}(),translateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new THREE.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),
lookAt:function(){var a=new THREE.Matrix4;return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this;a instanceof THREE.Object3D?(null!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",
a);return this},remove:function(a){if(1<arguments.length)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);b=this.children.indexOf(a);-1!==b&&(a.parent=null,a.dispatchEvent({type:"removed"}),this.children.splice(b,1))},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,e=this.children.length;c<e;c++){var d=this.children[c].getObjectByProperty(a,
b);if(void 0!==d)return d}},getWorldPosition:function(a){a=a||new THREE.Vector3;this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){c=c||new THREE.Quaternion;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,b);return c}}(),getWorldRotation:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Euler;this.getWorldQuaternion(a);return b.setFromQuaternion(a,
this.rotation.order,!1)}}(),getWorldScale:function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(c){c=c||new THREE.Vector3;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,b,c);return c}}(),getWorldDirection:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=this.children,c=0,e=b.length;c<e;c++)b[c].traverse(a)},traverseVisible:function(a){if(!1!==
this.visible){a(this);for(var b=this.children,c=0,e=b.length;c<e;c++)b[c].traverseVisible(a)}},traverseAncestors:function(a){var b=this.parent;null!==b&&(a(b),b.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,
this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},toJSON:function(a){function b(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var c=void 0===a,e={};c&&(a={geometries:{},materials:{},textures:{},images:{}},e.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var d={};d.uuid=this.uuid;d.type=this.type;""!==this.name&&(d.name=this.name);"{}"!==JSON.stringify(this.userData)&&(d.userData=
this.userData);!0===this.castShadow&&(d.castShadow=!0);!0===this.receiveShadow&&(d.receiveShadow=!0);!1===this.visible&&(d.visible=!1);d.matrix=this.matrix.toArray();void 0!==this.geometry&&(void 0===a.geometries[this.geometry.uuid]&&(a.geometries[this.geometry.uuid]=this.geometry.toJSON(a)),d.geometry=this.geometry.uuid);void 0!==this.material&&(void 0===a.materials[this.material.uuid]&&(a.materials[this.material.uuid]=this.material.toJSON(a)),d.material=this.material.uuid);if(0<this.children.length){d.children=
[];for(var g=0;g<this.children.length;g++)d.children.push(this.children[g].toJSON(a).object)}if(c){var c=b(a.geometries),g=b(a.materials),f=b(a.textures);a=b(a.images);0<c.length&&(e.geometries=c);0<g.length&&(e.materials=g);0<f.length&&(e.textures=f);0<a.length&&(e.images=a)}e.object=d;return e},clone:function(a){return(new this.constructor).copy(this,a)},copy:function(a,b){void 0===b&&(b=!0);this.name=a.name;this.up.copy(a.up);this.position.copy(a.position);this.quaternion.copy(a.quaternion);this.scale.copy(a.scale);
this.rotationAutoUpdate=a.rotationAutoUpdate;this.matrix.copy(a.matrix);this.matrixWorld.copy(a.matrixWorld);this.matrixAutoUpdate=a.matrixAutoUpdate;this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;this.visible=a.visible;this.castShadow=a.castShadow;this.receiveShadow=a.receiveShadow;this.frustumCulled=a.frustumCulled;this.renderOrder=a.renderOrder;this.userData=JSON.parse(JSON.stringify(a.userData));if(!0===b)for(var c=0;c<a.children.length;c++)this.add(a.children[c].clone());return this}};
THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);THREE.Object3DIdCount=0;THREE.Face3=function(a,b,c,e,d,g){this.a=a;this.b=b;this.c=c;this.normal=e instanceof THREE.Vector3?e:new THREE.Vector3;this.vertexNormals=Array.isArray(e)?e:[];this.color=d instanceof THREE.Color?d:new THREE.Color;this.vertexColors=Array.isArray(d)?d:[];this.materialIndex=void 0!==g?g:0};
THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a=a.a;this.b=a.b;this.c=a.c;this.normal.copy(a.normal);this.color.copy(a.color);this.materialIndex=a.materialIndex;for(var b=0,c=a.vertexNormals.length;b<c;b++)this.vertexNormals[b]=a.vertexNormals[b].clone();b=0;for(c=a.vertexColors.length;b<c;b++)this.vertexColors[b]=a.vertexColors[b].clone();return this}};
THREE.BufferAttribute=function(a,b){this.uuid=THREE.Math.generateUUID();this.array=a;this.itemSize=b;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0};
THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get count(){return this.array.length/this.itemSize},set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.itemSize=a.itemSize;this.dynamic=a.dynamic;return this},copyAt:function(a,b,c){a*=this.itemSize;c*=b.itemSize;for(var e=0,d=this.itemSize;e<d;e++)this.array[a+e]=b.array[c+e];return this},copyArray:function(a){this.array.set(a);
return this},copyColorsArray:function(a){for(var b=this.array,c=0,e=0,d=a.length;e<d;e++){var g=a[e];void 0===g&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",e),g=new THREE.Color);b[c++]=g.r;b[c++]=g.g;b[c++]=g.b}return this},copyIndicesArray:function(a){for(var b=this.array,c=0,e=0,d=a.length;e<d;e++){var g=a[e];b[c++]=g.a;b[c++]=g.b;b[c++]=g.c}return this},copyVector2sArray:function(a){for(var b=this.array,c=0,e=0,d=a.length;e<d;e++){var g=a[e];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",
e),g=new THREE.Vector2);b[c++]=g.x;b[c++]=g.y}return this},copyVector3sArray:function(a){for(var b=this.array,c=0,e=0,d=a.length;e<d;e++){var g=a[e];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",e),g=new THREE.Vector3);b[c++]=g.x;b[c++]=g.y;b[c++]=g.z}return this},copyVector4sArray:function(a){for(var b=this.array,c=0,e=0,d=a.length;e<d;e++){var g=a[e];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",e),g=new THREE.Vector4);
b[c++]=g.x;b[c++]=g.y;b[c++]=g.z;b[c++]=g.w}return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},getX:function(a){return this.array[a*this.itemSize]},setX:function(a,b){this.array[a*this.itemSize]=b;return this},getY:function(a){return this.array[a*this.itemSize+1]},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},getZ:function(a){return this.array[a*this.itemSize+2]},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},getW:function(a){return this.array[a*
this.itemSize+3]},setW:function(a,b){this.array[a*this.itemSize+3]=b;return this},setXY:function(a,b,c){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;return this},setXYZ:function(a,b,c,e){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=e;return this},setXYZW:function(a,b,c,e,d){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=e;this.array[a+3]=d;return this},clone:function(){return(new this.constructor).copy(this)}};
THREE.Int8Attribute=function(a,b){return new THREE.BufferAttribute(new Int8Array(a),b)};THREE.Uint8Attribute=function(a,b){return new THREE.BufferAttribute(new Uint8Array(a),b)};THREE.Uint8ClampedAttribute=function(a,b){return new THREE.BufferAttribute(new Uint8ClampedArray(a),b)};THREE.Int16Attribute=function(a,b){return new THREE.BufferAttribute(new Int16Array(a),b)};THREE.Uint16Attribute=function(a,b){return new THREE.BufferAttribute(new Uint16Array(a),b)};
THREE.Int32Attribute=function(a,b){return new THREE.BufferAttribute(new Int32Array(a),b)};THREE.Uint32Attribute=function(a,b){return new THREE.BufferAttribute(new Uint32Array(a),b)};THREE.Float32Attribute=function(a,b){return new THREE.BufferAttribute(new Float32Array(a),b)};THREE.Float64Attribute=function(a,b){return new THREE.BufferAttribute(new Float64Array(a),b)};
THREE.DynamicBufferAttribute=function(a,b){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");return(new THREE.BufferAttribute(a,b)).setDynamic(!0)};THREE.InstancedBufferAttribute=function(a,b,c){THREE.BufferAttribute.call(this,a,b);this.meshPerAttribute=c||1};THREE.InstancedBufferAttribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.InstancedBufferAttribute.prototype.constructor=THREE.InstancedBufferAttribute;
THREE.InstancedBufferAttribute.prototype.copy=function(a){THREE.BufferAttribute.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};THREE.InterleavedBuffer=function(a,b){this.uuid=THREE.Math.generateUUID();this.array=a;this.stride=b;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0};
THREE.InterleavedBuffer.prototype={constructor:THREE.InterleavedBuffer,get length(){return this.array.length},get count(){return this.array.length/this.stride},set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.stride=a.stride;this.dynamic=a.dynamic;return this},copyAt:function(a,b,c){a*=this.stride;c*=b.stride;for(var e=0,d=this.stride;e<d;e++)this.array[a+e]=b.array[c+e];return this},set:function(a,
b){void 0===b&&(b=0);this.array.set(a,b);return this},clone:function(){return(new this.constructor).copy(this)}};THREE.InstancedInterleavedBuffer=function(a,b,c){THREE.InterleavedBuffer.call(this,a,b);this.meshPerAttribute=c||1};THREE.InstancedInterleavedBuffer.prototype=Object.create(THREE.InterleavedBuffer.prototype);THREE.InstancedInterleavedBuffer.prototype.constructor=THREE.InstancedInterleavedBuffer;
THREE.InstancedInterleavedBuffer.prototype.copy=function(a){THREE.InterleavedBuffer.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};THREE.InterleavedBufferAttribute=function(a,b,c){this.uuid=THREE.Math.generateUUID();this.data=a;this.itemSize=b;this.offset=c};
THREE.InterleavedBufferAttribute.prototype={constructor:THREE.InterleavedBufferAttribute,get length(){console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count.");return this.array.length},get count(){return this.data.count},setX:function(a,b){this.data.array[a*this.data.stride+this.offset]=b;return this},setY:function(a,b){this.data.array[a*this.data.stride+this.offset+1]=b;return this},setZ:function(a,b){this.data.array[a*this.data.stride+this.offset+2]=b;return this},
setW:function(a,b){this.data.array[a*this.data.stride+this.offset+3]=b;return this},getX:function(a){return this.data.array[a*this.data.stride+this.offset]},getY:function(a){return this.data.array[a*this.data.stride+this.offset+1]},getZ:function(a){return this.data.array[a*this.data.stride+this.offset+2]},getW:function(a){return this.data.array[a*this.data.stride+this.offset+3]},setXY:function(a,b,c){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;return this},setXYZ:function(a,
b,c,e){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=e;return this},setXYZW:function(a,b,c,e,d){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=e;this.data.array[a+3]=d;return this}};
THREE.Geometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=
this.verticesNeedUpdate=!1};
THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(a){for(var b=(new THREE.Matrix3).getNormalMatrix(a),c=0,e=this.vertices.length;c<e;c++)this.vertices[c].applyMatrix4(a);c=0;for(e=this.faces.length;c<e;c++){a=this.faces[c];a.normal.applyMatrix3(b).normalize();for(var d=0,g=a.vertexNormals.length;d<g;d++)a.vertexNormals[d].applyMatrix3(b).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();this.normalsNeedUpdate=
this.verticesNeedUpdate=!0;return this},rotateX:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationX(b);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationY(b);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(b,c,e){void 0===a&&
(a=new THREE.Matrix4);a.makeTranslation(b,c,e);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(b,c,e){void 0===a&&(a=new THREE.Matrix4);a.makeScale(b,c,e);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(b){void 0===a&&(a=new THREE.Object3D);a.lookAt(b);a.updateMatrix();this.applyMatrix(a.matrix)}}(),fromBufferGeometry:function(a){function b(a,b,d,e){var g=void 0!==f?[n[a].clone(),n[b].clone(),n[d].clone()]:[],p=void 0!==h?[c.colors[a].clone(),
c.colors[b].clone(),c.colors[d].clone()]:[];e=new THREE.Face3(a,b,d,g,p,e);c.faces.push(e);void 0!==k&&c.faceVertexUvs[0].push([q[a].clone(),q[b].clone(),q[d].clone()]);void 0!==l&&c.faceVertexUvs[1].push([m[a].clone(),m[b].clone(),m[d].clone()])}var c=this,e=null!==a.index?a.index.array:void 0,d=a.attributes,g=d.position.array,f=void 0!==d.normal?d.normal.array:void 0,h=void 0!==d.color?d.color.array:void 0,k=void 0!==d.uv?d.uv.array:void 0,l=void 0!==d.uv2?d.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=
[]);for(var n=[],q=[],m=[],p=d=0;d<g.length;d+=3,p+=2)c.vertices.push(new THREE.Vector3(g[d],g[d+1],g[d+2])),void 0!==f&&n.push(new THREE.Vector3(f[d],f[d+1],f[d+2])),void 0!==h&&c.colors.push(new THREE.Color(h[d],h[d+1],h[d+2])),void 0!==k&&q.push(new THREE.Vector2(k[p],k[p+1])),void 0!==l&&m.push(new THREE.Vector2(l[p],l[p+1]));if(void 0!==e)if(g=a.groups,0<g.length)for(d=0;d<g.length;d++)for(var r=g[d],u=r.start,t=r.count,p=u,u=u+t;p<u;p+=3)b(e[p],e[p+1],e[p+2],r.materialIndex);else for(d=0;d<
e.length;d+=3)b(e[d],e[d+1],e[d+2]);else for(d=0;d<g.length/3;d+=3)b(d,d+1,d+2);this.computeFaceNormals();null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());return this},center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.translate(a.x,a.y,a.z);return a},normalize:function(){this.computeBoundingSphere();var a=this.boundingSphere.center,b=this.boundingSphere.radius,b=0===b?1:1/
b,c=new THREE.Matrix4;c.set(b,0,0,-b*a.x,0,b,0,-b*a.y,0,0,b,-b*a.z,0,0,0,1);this.applyMatrix(c);return this},computeFaceNormals:function(){for(var a=new THREE.Vector3,b=new THREE.Vector3,c=0,e=this.faces.length;c<e;c++){var d=this.faces[c],g=this.vertices[d.a],f=this.vertices[d.b];a.subVectors(this.vertices[d.c],f);b.subVectors(g,f);a.cross(b);a.normalize();d.normal.copy(a)}},computeVertexNormals:function(a){void 0===a&&(a=!0);var b,c,e;e=Array(this.vertices.length);b=0;for(c=this.vertices.length;b<
c;b++)e[b]=new THREE.Vector3;if(a){var d,g,f,h=new THREE.Vector3,k=new THREE.Vector3;a=0;for(b=this.faces.length;a<b;a++)c=this.faces[a],d=this.vertices[c.a],g=this.vertices[c.b],f=this.vertices[c.c],h.subVectors(f,g),k.subVectors(d,g),h.cross(k),e[c.a].add(h),e[c.b].add(h),e[c.c].add(h)}else for(a=0,b=this.faces.length;a<b;a++)c=this.faces[a],e[c.a].add(c.normal),e[c.b].add(c.normal),e[c.c].add(c.normal);b=0;for(c=this.vertices.length;b<c;b++)e[b].normalize();a=0;for(b=this.faces.length;a<b;a++)c=
this.faces[a],d=c.vertexNormals,3===d.length?(d[0].copy(e[c.a]),d[1].copy(e[c.b]),d[2].copy(e[c.c])):(d[0]=e[c.a].clone(),d[1]=e[c.b].clone(),d[2]=e[c.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var a,b,c,e,d;c=0;for(e=this.faces.length;c<e;c++)for(d=this.faces[c],d.__originalFaceNormal?d.__originalFaceNormal.copy(d.normal):d.__originalFaceNormal=d.normal.clone(),d.__originalVertexNormals||(d.__originalVertexNormals=[]),a=0,b=d.vertexNormals.length;a<
b;a++)d.__originalVertexNormals[a]?d.__originalVertexNormals[a].copy(d.vertexNormals[a]):d.__originalVertexNormals[a]=d.vertexNormals[a].clone();var g=new THREE.Geometry;g.faces=this.faces;a=0;for(b=this.morphTargets.length;a<b;a++){if(!this.morphNormals[a]){this.morphNormals[a]={};this.morphNormals[a].faceNormals=[];this.morphNormals[a].vertexNormals=[];d=this.morphNormals[a].faceNormals;var f=this.morphNormals[a].vertexNormals,h,k;c=0;for(e=this.faces.length;c<e;c++)h=new THREE.Vector3,k={a:new THREE.Vector3,
b:new THREE.Vector3,c:new THREE.Vector3},d.push(h),f.push(k)}f=this.morphNormals[a];g.vertices=this.morphTargets[a].vertices;g.computeFaceNormals();g.computeVertexNormals();c=0;for(e=this.faces.length;c<e;c++)d=this.faces[c],h=f.faceNormals[c],k=f.vertexNormals[c],h.copy(d.normal),k.a.copy(d.vertexNormals[0]),k.b.copy(d.vertexNormals[1]),k.c.copy(d.vertexNormals[2])}c=0;for(e=this.faces.length;c<e;c++)d=this.faces[c],d.normal=d.__originalFaceNormal,d.vertexNormals=d.__originalVertexNormals},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},
computeLineDistances:function(){for(var a=0,b=this.vertices,c=0,e=b.length;c<e;c++)0<c&&(a+=b[c].distanceTo(b[c-1])),this.lineDistances[c]=a},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,b,c){if(!1===a instanceof THREE.Geometry)console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",
a);else{var e,d=this.vertices.length,g=this.vertices,f=a.vertices,h=this.faces,k=a.faces,l=this.faceVertexUvs[0];a=a.faceVertexUvs[0];void 0===c&&(c=0);void 0!==b&&(e=(new THREE.Matrix3).getNormalMatrix(b));for(var n=0,q=f.length;n<q;n++){var m=f[n].clone();void 0!==b&&m.applyMatrix4(b);g.push(m)}n=0;for(q=k.length;n<q;n++){var f=k[n],p,r=f.vertexNormals,u=f.vertexColors,m=new THREE.Face3(f.a+d,f.b+d,f.c+d);m.normal.copy(f.normal);void 0!==e&&m.normal.applyMatrix3(e).normalize();b=0;for(g=r.length;b<
g;b++)p=r[b].clone(),void 0!==e&&p.applyMatrix3(e).normalize(),m.vertexNormals.push(p);m.color.copy(f.color);b=0;for(g=u.length;b<g;b++)p=u[b],m.vertexColors.push(p.clone());m.materialIndex=f.materialIndex+c;h.push(m)}n=0;for(q=a.length;n<q;n++)if(c=a[n],e=[],void 0!==c){b=0;for(g=c.length;b<g;b++)e.push(c[b].clone());l.push(e)}}},mergeMesh:function(a){!1===a instanceof THREE.Mesh?console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",a):(a.matrixAutoUpdate&&a.updateMatrix(),
this.merge(a.geometry,a.matrix))},mergeVertices:function(){var a={},b=[],c=[],e,d=Math.pow(10,4),g,f;g=0;for(f=this.vertices.length;g<f;g++)e=this.vertices[g],e=Math.round(e.x*d)+"_"+Math.round(e.y*d)+"_"+Math.round(e.z*d),void 0===a[e]?(a[e]=g,b.push(this.vertices[g]),c[g]=b.length-1):c[g]=c[a[e]];a=[];g=0;for(f=this.faces.length;g<f;g++)for(d=this.faces[g],d.a=c[d.a],d.b=c[d.b],d.c=c[d.c],d=[d.a,d.b,d.c],e=0;3>e;e++)if(d[e]===d[(e+1)%3]){a.push(g);break}for(g=a.length-1;0<=g;g--)for(d=a[g],this.faces.splice(d,
1),c=0,f=this.faceVertexUvs.length;c<f;c++)this.faceVertexUvs[c].splice(d,1);g=this.vertices.length-b.length;this.vertices=b;return g},sortFacesByMaterialIndex:function(){for(var a=this.faces,b=a.length,c=0;c<b;c++)a[c]._id=c;a.sort(function(a,b){return a.materialIndex-b.materialIndex});var e=this.faceVertexUvs[0],d=this.faceVertexUvs[1],g,f;e&&e.length===b&&(g=[]);d&&d.length===b&&(f=[]);for(c=0;c<b;c++){var h=a[c]._id;g&&g.push(e[h]);f&&f.push(d[h])}g&&(this.faceVertexUvs[0]=g);f&&(this.faceVertexUvs[1]=
f)},toJSON:function(){function a(a,b,c){return c?a|1<<b:a&~(1<<b)}function b(a){var b=a.x.toString()+a.y.toString()+a.z.toString();if(void 0!==l[b])return l[b];l[b]=k.length/3;k.push(a.x,a.y,a.z);return l[b]}function c(a){var b=a.r.toString()+a.g.toString()+a.b.toString();if(void 0!==q[b])return q[b];q[b]=n.length;n.push(a.getHex());return q[b]}function e(a){var b=a.x.toString()+a.y.toString();if(void 0!==p[b])return p[b];p[b]=m.length/2;m.push(a.x,a.y);return p[b]}var d={metadata:{version:4.4,type:"Geometry",
generator:"Geometry.toJSON"}};d.uuid=this.uuid;d.type=this.type;""!==this.name&&(d.name=this.name);if(void 0!==this.parameters){var g=this.parameters,f;for(f in g)void 0!==g[f]&&(d[f]=g[f]);return d}g=[];for(f=0;f<this.vertices.length;f++){var h=this.vertices[f];g.push(h.x,h.y,h.z)}var h=[],k=[],l={},n=[],q={},m=[],p={};for(f=0;f<this.faces.length;f++){var r=this.faces[f],u=void 0!==this.faceVertexUvs[0][f],t=0<r.normal.length(),v=0<r.vertexNormals.length,x=1!==r.color.r||1!==r.color.g||1!==r.color.b,
A=0<r.vertexColors.length,w=0,w=a(w,0,0),w=a(w,1,!0),w=a(w,2,!1),w=a(w,3,u),w=a(w,4,t),w=a(w,5,v),w=a(w,6,x),w=a(w,7,A);h.push(w);h.push(r.a,r.b,r.c);h.push(r.materialIndex);u&&(u=this.faceVertexUvs[0][f],h.push(e(u[0]),e(u[1]),e(u[2])));t&&h.push(b(r.normal));v&&(t=r.vertexNormals,h.push(b(t[0]),b(t[1]),b(t[2])));x&&h.push(c(r.color));A&&(r=r.vertexColors,h.push(c(r[0]),c(r[1]),c(r[2])))}d.data={};d.data.vertices=g;d.data.normals=k;0<n.length&&(d.data.colors=n);0<m.length&&(d.data.uvs=[m]);d.data.faces=
h;return d},clone:function(){return(new THREE.Geometry).copy(this)},copy:function(a){this.vertices=[];this.faces=[];this.faceVertexUvs=[[]];for(var b=a.vertices,c=0,e=b.length;c<e;c++)this.vertices.push(b[c].clone());b=a.faces;c=0;for(e=b.length;c<e;c++)this.faces.push(b[c].clone());c=0;for(e=a.faceVertexUvs.length;c<e;c++){b=a.faceVertexUvs[c];void 0===this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]);for(var d=0,g=b.length;d<g;d++){for(var f=b[d],h=[],k=0,l=f.length;k<l;k++)h.push(f[k].clone());
this.faceVertexUvs[c].push(h)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype);THREE.GeometryIdCount=0;
THREE.DirectGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="DirectGeometry";this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1};
THREE.DirectGeometry.prototype={constructor:THREE.DirectGeometry,computeBoundingBox:THREE.Geometry.prototype.computeBoundingBox,computeBoundingSphere:THREE.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},computeGroups:function(a){var b,c=[],
e;a=a.faces;for(var d=0;d<a.length;d++){var g=a[d];g.materialIndex!==e&&(e=g.materialIndex,void 0!==b&&(b.count=3*d-b.start,c.push(b)),b={start:3*d,materialIndex:e})}void 0!==b&&(b.count=3*d-b.start,c.push(b));this.groups=c},fromGeometry:function(a){var b=a.faces,c=a.vertices,e=a.faceVertexUvs,d=e[0]&&0<e[0].length,g=e[1]&&0<e[1].length,f=a.morphTargets,h=f.length,k;if(0<h){k=[];for(var l=0;l<h;l++)k[l]=[];this.morphTargets.position=k}var n=a.morphNormals,q=n.length,m;if(0<q){m=[];for(l=0;l<q;l++)m[l]=
[];this.morphTargets.normal=m}for(var p=a.skinIndices,r=a.skinWeights,u=p.length===c.length,t=r.length===c.length,l=0;l<b.length;l++){var v=b[l];this.vertices.push(c[v.a],c[v.b],c[v.c]);var x=v.vertexNormals;3===x.length?this.normals.push(x[0],x[1],x[2]):(x=v.normal,this.normals.push(x,x,x));x=v.vertexColors;3===x.length?this.colors.push(x[0],x[1],x[2]):(x=v.color,this.colors.push(x,x,x));!0===d&&(x=e[0][l],void 0!==x?this.uvs.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",
l),this.uvs.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2)));!0===g&&(x=e[1][l],void 0!==x?this.uvs2.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",l),this.uvs2.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2)));for(x=0;x<h;x++){var A=f[x].vertices;k[x].push(A[v.a],A[v.b],A[v.c])}for(x=0;x<q;x++)A=n[x].vertexNormals[l],m[x].push(A.a,A.b,A.c);u&&this.skinIndices.push(p[v.a],p[v.b],p[v.c]);t&&this.skinWeights.push(r[v.a],r[v.b],
r[v.c])}this.computeGroups(a);this.verticesNeedUpdate=a.verticesNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=a.colorsNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.DirectGeometry.prototype);
THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity}};
THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,getIndex:function(){return this.index},setIndex:function(a){this.index=a},addAttribute:function(a,b,c){if(!1===b instanceof THREE.BufferAttribute&&!1===b instanceof THREE.InterleavedBufferAttribute)console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(a,new THREE.BufferAttribute(b,c));else if("index"===a)console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),
this.setIndex(b);else return this.attributes[a]=b,this},getAttribute:function(a){return this.attributes[a]},removeAttribute:function(a){delete this.attributes[a];return this},addGroup:function(a,b,c){this.groups.push({start:a,count:b,materialIndex:void 0!==c?c:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(a,b){this.drawRange.start=a;this.drawRange.count=b},applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),b.needsUpdate=!0);b=this.attributes.normal;
void 0!==b&&((new THREE.Matrix3).getNormalMatrix(a).applyToVector3Array(b.array),b.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return this},rotateX:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationX(b);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationY(b);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;
return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(b,c,e){void 0===a&&(a=new THREE.Matrix4);a.makeTranslation(b,c,e);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(b,c,e){void 0===a&&(a=new THREE.Matrix4);a.makeScale(b,c,e);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(b){void 0===a&&(a=new THREE.Object3D);a.lookAt(b);a.updateMatrix();this.applyMatrix(a.matrix)}}(),
center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.translate(a.x,a.y,a.z);return a},setFromObject:function(a){var b=a.geometry;if(a instanceof THREE.Points||a instanceof THREE.Line){a=new THREE.Float32Attribute(3*b.vertices.length,3);var c=new THREE.Float32Attribute(3*b.colors.length,3);this.addAttribute("position",a.copyVector3sArray(b.vertices));this.addAttribute("color",c.copyColorsArray(b.colors));b.lineDistances&&b.lineDistances.length===b.vertices.length&&
(a=new THREE.Float32Attribute(b.lineDistances.length,1),this.addAttribute("lineDistance",a.copyArray(b.lineDistances)));null!==b.boundingSphere&&(this.boundingSphere=b.boundingSphere.clone());null!==b.boundingBox&&(this.boundingBox=b.boundingBox.clone())}else a instanceof THREE.Mesh&&b instanceof THREE.Geometry&&this.fromGeometry(b);return this},updateFromObject:function(a){var b=a.geometry;if(a instanceof THREE.Mesh){var c=b.__directGeometry;if(void 0===c)return this.fromGeometry(b);c.verticesNeedUpdate=
b.verticesNeedUpdate;c.normalsNeedUpdate=b.normalsNeedUpdate;c.colorsNeedUpdate=b.colorsNeedUpdate;c.uvsNeedUpdate=b.uvsNeedUpdate;c.groupsNeedUpdate=b.groupsNeedUpdate;b.verticesNeedUpdate=!1;b.normalsNeedUpdate=!1;b.colorsNeedUpdate=!1;b.uvsNeedUpdate=!1;b.groupsNeedUpdate=!1;b=c}!0===b.verticesNeedUpdate&&(c=this.attributes.position,void 0!==c&&(c.copyVector3sArray(b.vertices),c.needsUpdate=!0),b.verticesNeedUpdate=!1);!0===b.normalsNeedUpdate&&(c=this.attributes.normal,void 0!==c&&(c.copyVector3sArray(b.normals),
c.needsUpdate=!0),b.normalsNeedUpdate=!1);!0===b.colorsNeedUpdate&&(c=this.attributes.color,void 0!==c&&(c.copyColorsArray(b.colors),c.needsUpdate=!0),b.colorsNeedUpdate=!1);b.uvsNeedUpdate&&(c=this.attributes.uv,void 0!==c&&(c.copyVector2sArray(b.uvs),c.needsUpdate=!0),b.uvsNeedUpdate=!1);b.lineDistancesNeedUpdate&&(c=this.attributes.lineDistance,void 0!==c&&(c.copyArray(b.lineDistances),c.needsUpdate=!0),b.lineDistancesNeedUpdate=!1);b.groupsNeedUpdate&&(b.computeGroups(a.geometry),this.groups=
b.groups,b.groupsNeedUpdate=!1);return this},fromGeometry:function(a){a.__directGeometry=(new THREE.DirectGeometry).fromGeometry(a);return this.fromDirectGeometry(a.__directGeometry)},fromDirectGeometry:function(a){var b=new Float32Array(3*a.vertices.length);this.addAttribute("position",(new THREE.BufferAttribute(b,3)).copyVector3sArray(a.vertices));0<a.normals.length&&(b=new Float32Array(3*a.normals.length),this.addAttribute("normal",(new THREE.BufferAttribute(b,3)).copyVector3sArray(a.normals)));
0<a.colors.length&&(b=new Float32Array(3*a.colors.length),this.addAttribute("color",(new THREE.BufferAttribute(b,3)).copyColorsArray(a.colors)));0<a.uvs.length&&(b=new Float32Array(2*a.uvs.length),this.addAttribute("uv",(new THREE.BufferAttribute(b,2)).copyVector2sArray(a.uvs)));0<a.uvs2.length&&(b=new Float32Array(2*a.uvs2.length),this.addAttribute("uv2",(new THREE.BufferAttribute(b,2)).copyVector2sArray(a.uvs2)));0<a.indices.length&&(b=new (65535<a.vertices.length?Uint32Array:Uint16Array)(3*a.indices.length),
this.setIndex((new THREE.BufferAttribute(b,1)).copyIndicesArray(a.indices)));this.groups=a.groups;for(var c in a.morphTargets){for(var b=[],e=a.morphTargets[c],d=0,g=e.length;d<g;d++){var f=e[d],h=new THREE.Float32Attribute(3*f.length,3);b.push(h.copyVector3sArray(f))}this.morphAttributes[c]=b}0<a.skinIndices.length&&(c=new THREE.Float32Attribute(4*a.skinIndices.length,4),this.addAttribute("skinIndex",c.copyVector4sArray(a.skinIndices)));0<a.skinWeights.length&&(c=new THREE.Float32Attribute(4*a.skinWeights.length,
4),this.addAttribute("skinWeight",c.copyVector4sArray(a.skinWeights)));null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());return this},computeBoundingBox:function(){new THREE.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var a=this.attributes.position.array;a&&this.boundingBox.setFromArray(a);if(void 0===a||0===a.length)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,
0,0);(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}(),computeBoundingSphere:function(){var a=new THREE.Box3,b=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var c=this.attributes.position.array;if(c){var e=this.boundingSphere.center;a.setFromArray(c);
a.center(e);for(var d=0,g=0,f=c.length;g<f;g+=3)b.fromArray(c,g),d=Math.max(d,e.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(d);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var a=this.index,b=this.attributes,c=this.groups;if(b.position){var e=b.position.array;if(void 0===b.normal)this.addAttribute("normal",
new THREE.BufferAttribute(new Float32Array(e.length),3));else for(var d=b.normal.array,g=0,f=d.length;g<f;g++)d[g]=0;var d=b.normal.array,h,k,l,n=new THREE.Vector3,q=new THREE.Vector3,m=new THREE.Vector3,p=new THREE.Vector3,r=new THREE.Vector3;if(a){a=a.array;0===c.length&&this.addGroup(0,a.length);for(var u=0,t=c.length;u<t;++u)for(g=c[u],f=g.start,h=g.count,g=f,f+=h;g<f;g+=3)h=3*a[g+0],k=3*a[g+1],l=3*a[g+2],n.fromArray(e,h),q.fromArray(e,k),m.fromArray(e,l),p.subVectors(m,q),r.subVectors(n,q),p.cross(r),
d[h]+=p.x,d[h+1]+=p.y,d[h+2]+=p.z,d[k]+=p.x,d[k+1]+=p.y,d[k+2]+=p.z,d[l]+=p.x,d[l+1]+=p.y,d[l+2]+=p.z}else for(g=0,f=e.length;g<f;g+=9)n.fromArray(e,g),q.fromArray(e,g+3),m.fromArray(e,g+6),p.subVectors(m,q),r.subVectors(n,q),p.cross(r),d[g]=p.x,d[g+1]=p.y,d[g+2]=p.z,d[g+3]=p.x,d[g+4]=p.y,d[g+5]=p.z,d[g+6]=p.x,d[g+7]=p.y,d[g+8]=p.z;this.normalizeNormals();b.normal.needsUpdate=!0}},merge:function(a,b){if(!1===a instanceof THREE.BufferGeometry)console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",
a);else{void 0===b&&(b=0);var c=this.attributes,e;for(e in c)if(void 0!==a.attributes[e])for(var d=c[e].array,g=a.attributes[e],f=g.array,h=0,g=g.itemSize*b;h<f.length;h++,g++)d[g]=f[h];return this}},normalizeNormals:function(){for(var a=this.attributes.normal.array,b,c,e,d=0,g=a.length;d<g;d+=3)b=a[d],c=a[d+1],e=a[d+2],b=1/Math.sqrt(b*b+c*c+e*e),a[d]*=b,a[d+1]*=b,a[d+2]*=b},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),
this;var a=new THREE.BufferGeometry,b=this.index.array,c=this.attributes,e;for(e in c){for(var d=c[e],g=d.array,d=d.itemSize,f=new g.constructor(b.length*d),h,k=0,l=0,n=b.length;l<n;l++){h=b[l]*d;for(var q=0;q<d;q++)f[k++]=g[h++]}a.addAttribute(e,new THREE.BufferAttribute(f,d))}return a},toJSON:function(){var a={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};a.uuid=this.uuid;a.type=this.type;""!==this.name&&(a.name=this.name);if(void 0!==this.parameters){var b=this.parameters,
c;for(c in b)void 0!==b[c]&&(a[c]=b[c]);return a}a.data={attributes:{}};var e=this.index;null!==e&&(b=Array.prototype.slice.call(e.array),a.data.index={type:e.array.constructor.name,array:b});e=this.attributes;for(c in e){var d=e[c],b=Array.prototype.slice.call(d.array);a.data.attributes[c]={itemSize:d.itemSize,type:d.array.constructor.name,array:b}}c=this.groups;0<c.length&&(a.data.groups=JSON.parse(JSON.stringify(c)));c=this.boundingSphere;null!==c&&(a.data.boundingSphere={center:c.center.toArray(),
radius:c.radius});return a},clone:function(){return(new THREE.BufferGeometry).copy(this)},copy:function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var b=a.attributes,c;for(c in b)this.addAttribute(c,b[c].clone());a=a.groups;c=0;for(b=a.length;c<b;c++){var e=a[c];this.addGroup(e.start,e.count)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);THREE.BufferGeometry.MaxIndex=65535;
THREE.InstancedBufferGeometry=function(){THREE.BufferGeometry.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=void 0};THREE.InstancedBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.InstancedBufferGeometry.prototype.constructor=THREE.InstancedBufferGeometry;THREE.InstancedBufferGeometry.prototype.addGroup=function(a,b,c){this.groups.push({start:a,count:b,instances:c})};
THREE.InstancedBufferGeometry.prototype.copy=function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var b=a.attributes,c;for(c in b)this.addAttribute(c,b[c].clone());a=a.groups;c=0;for(b=a.length;c<b;c++){var e=a[c];this.addGroup(e.start,e.count,e.instances)}return this};THREE.EventDispatcher.prototype.apply(THREE.InstancedBufferGeometry.prototype);THREE.Uniform=function(a,b){this.type=a;this.value=b;this.dynamic=!1};
THREE.Uniform.prototype={constructor:THREE.Uniform,onUpdate:function(a){this.dynamic=!0;this.onUpdateCallback=a;return this}};THREE.AnimationClip=function(a,b,c){this.name=a||THREE.Math.generateUUID();this.tracks=c;this.duration=void 0!==b?b:-1;0>this.duration&&this.resetDuration();this.trim();this.optimize()};
THREE.AnimationClip.prototype={constructor:THREE.AnimationClip,resetDuration:function(){for(var a=0,b=0,c=this.tracks.length;b!==c;++b)var e=this.tracks[b],a=Math.max(a,e.times[e.times.length-1]);this.duration=a},trim:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this},optimize:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}};
Object.assign(THREE.AnimationClip,{parse:function(a){for(var b=[],c=a.tracks,e=1/(a.fps||1),d=0,g=c.length;d!==g;++d)b.push(THREE.KeyframeTrack.parse(c[d]).scale(e));return new THREE.AnimationClip(a.name,a.duration,b)},toJSON:function(a){var b=[],c=a.tracks;a={name:a.name,duration:a.duration,tracks:b};for(var e=0,d=c.length;e!==d;++e)b.push(THREE.KeyframeTrack.toJSON(c[e]));return a},CreateFromMorphTargetSequence:function(a,b,c){for(var e=b.length,d=[],g=0;g<e;g++){var f=[],h=[];f.push((g+e-1)%e,
g,(g+1)%e);h.push(0,1,0);var k=THREE.AnimationUtils.getKeyframeOrder(f),f=THREE.AnimationUtils.sortedArray(f,1,k),h=THREE.AnimationUtils.sortedArray(h,1,k);0===f[0]&&(f.push(e),h.push(h[0]));d.push((new THREE.NumberKeyframeTrack(".morphTargetInfluences["+b[g].name+"]",f,h)).scale(1/c))}return new THREE.AnimationClip(a,-1,d)},findByName:function(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return a[c];return null},CreateClipsFromMorphTargetSequences:function(a,b){for(var c={},e=/^([\w-]*?)([\d]+)$/,
d=0,g=a.length;d<g;d++){var f=a[d],h=f.name.match(e);if(h&&1<h.length){var k=h[1];(h=c[k])||(c[k]=h=[]);h.push(f)}}e=[];for(k in c)e.push(THREE.AnimationClip.CreateFromMorphTargetSequence(k,c[k],b));return e},parseAnimation:function(a,b,c){if(!a)return console.error("  no animation in JSONLoader data"),null;c=function(a,b,c,d,e){if(0!==c.length){var f=[],g=[];THREE.AnimationUtils.flattenJSON(c,f,g,d);0!==f.length&&e.push(new a(b,f,g))}};var e=[],d=a.name||"default",g=a.length||-1,f=a.fps||30;a=a.hierarchy||
[];for(var h=0;h<a.length;h++){var k=a[h].keys;if(k&&0!=k.length)if(k[0].morphTargets){for(var g={},l=0;l<k.length;l++)if(k[l].morphTargets)for(var n=0;n<k[l].morphTargets.length;n++)g[k[l].morphTargets[n]]=-1;for(var q in g){for(var m=[],p=[],n=0;n!==k[l].morphTargets.length;++n){var r=k[l];m.push(r.time);p.push(r.morphTarget===q?1:0)}e.push(new THREE.NumberKeyframeTrack(".morphTargetInfluence["+q+"]",m,p))}g=g.length*(f||1)}else l=".bones["+b[h].name+"]",c(THREE.VectorKeyframeTrack,l+".position",
k,"pos",e),c(THREE.QuaternionKeyframeTrack,l+".quaternion",k,"rot",e),c(THREE.VectorKeyframeTrack,l+".scale",k,"scl",e)}return 0===e.length?null:new THREE.AnimationClip(d,g,e)}});THREE.AnimationMixer=function(a){this._root=a;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1};
THREE.AnimationMixer.prototype={constructor:THREE.AnimationMixer,clipAction:function(a,b){var c=(b||this._root).uuid,e="string"===typeof a?a:a.name,d=a!==e?a:null,g=this._actionsByClip[e],f;if(void 0!==g){f=g.actionByRoot[c];if(void 0!==f)return f;f=g.knownActions[0];d=f._clip;if(a!==e&&a!==d)throw Error("Different clips with the same name detected!");}if(null===d)return null;g=new THREE.AnimationMixer._Action(this,d,b);this._bindAction(g,f);this._addInactiveAction(g,e,c);return g},existingAction:function(a,
b){var c=(b||this._root).uuid,e=this._actionsByClip["string"===typeof a?a:a.name];return void 0!==e?e.actionByRoot[c]||null:null},stopAllAction:function(){for(var a=this._actions,b=this._nActiveActions,c=this._bindings,e=this._nActiveBindings,d=this._nActiveBindings=this._nActiveActions=0;d!==b;++d)a[d].reset();for(d=0;d!==e;++d)c[d].useCount=0;return this},update:function(a){a*=this.timeScale;for(var b=this._actions,c=this._nActiveActions,e=this.time+=a,d=Math.sign(a),g=this._accuIndex^=1,f=0;f!==
c;++f){var h=b[f];h.enabled&&h._update(e,a,d,g)}a=this._bindings;b=this._nActiveBindings;for(f=0;f!==b;++f)a[f].apply(g);return this},getRoot:function(){return this._root},uncacheClip:function(a){var b=this._actions;a=a.name;var c=this._actionsByClip,e=c[a];if(void 0!==e){for(var e=e.knownActions,d=0,g=e.length;d!==g;++d){var f=e[d];this._deactivateAction(f);var h=f._cacheIndex,k=b[b.length-1];f._cacheIndex=null;f._byClipCacheIndex=null;k._cacheIndex=h;b[h]=k;b.pop();this._removeInactiveBindingsForAction(f)}delete c[a]}},
uncacheRoot:function(a){a=a.uuid;var b=this._actionsByClip,c;for(c in b){var e=b[c].actionByRoot[a];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}c=this._bindingsByRootAndName[a];if(void 0!==c)for(var d in c)a=c[d],a.restoreOriginalState(),this._removeInactiveBinding(a)},uncacheAction:function(a,b){var c=this.existingAction(a,b);null!==c&&(this._deactivateAction(c),this._removeInactiveAction(c))}};THREE.EventDispatcher.prototype.apply(THREE.AnimationMixer.prototype);
THREE.AnimationMixer._Action=function(a,b,c){this._mixer=a;this._clip=b;this._localRoot=c||null;a=b.tracks;b=a.length;c=Array(b);for(var e={endingStart:THREE.ZeroCurvatureEnding,endingEnd:THREE.ZeroCurvatureEnding},d=0;d!==b;++d){var g=a[d].createInterpolant(null);c[d]=g;g.settings=e}this._interpolantSettings=e;this._interpolants=c;this._propertyBindings=Array(b);this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null;this.loop=THREE.LoopRepeat;this._loopCount=
-1;this._startTime=null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0};
THREE.AnimationMixer._Action.prototype={constructor:THREE.AnimationMixer._Action,play:function(){this._mixer._activateAction(this);return this},stop:function(){this._mixer._deactivateAction(this);return this.reset()},reset:function(){this.paused=!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},
startAt:function(a){this._startTime=a;return this},setLoop:function(a,b){this.loop=a;this.repetitions=b;return this},setEffectiveWeight:function(a){this.weight=a;this._effectiveWeight=this.enabled?a:0;return this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(a){return this._scheduleFading(a,0,1)},fadeOut:function(a){return this._scheduleFading(a,1,0)},crossFadeFrom:function(a,b,c){a.fadeOut(b);this.fadeIn(b);if(c){c=this._clip.duration;var e=a._clip.duration,
d=c/e;a.warp(1,e/c,b);this.warp(d,1,b)}return this},crossFadeTo:function(a,b,c){return a.crossFadeFrom(this,b,c)},stopFading:function(){var a=this._weightInterpolant;null!==a&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},setEffectiveTimeScale:function(a){this.timeScale=a;this._effectiveTimeScale=this.paused?0:a;return this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(a){this.timeScale=this._clip.duration/
a;return this.stopWarping()},syncWith:function(a){this.time=a.time;this.timeScale=a.timeScale;return this.stopWarping()},halt:function(a){return this.warp(this._currentTimeScale,0,a)},warp:function(a,b,c){var e=this._mixer,d=e.time,g=this._timeScaleInterpolant,f=this.timeScale;null===g&&(this._timeScaleInterpolant=g=e._lendControlInterpolant());e=g.parameterPositions;g=g.sampleValues;e[0]=d;e[1]=d+c;g[0]=a/f;g[1]=b/f;return this},stopWarping:function(){var a=this._timeScaleInterpolant;null!==a&&(this._timeScaleInterpolant=
null,this._mixer._takeBackControlInterpolant(a));return this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(a,b,c,e){var d=this._startTime;if(null!==d){b=(a-d)*c;if(0>b||0===c)return;this._startTime=null;b*=c}b*=this._updateTimeScale(a);c=this._updateTime(b);a=this._updateWeight(a);if(0<a){b=this._interpolants;for(var d=this._propertyBindings,g=0,f=b.length;g!==f;++g)b[g].evaluate(c),d[g].accumulate(e,
a)}},_updateWeight:function(a){var b=0;if(this.enabled){var b=this.weight,c=this._weightInterpolant;if(null!==c){var e=c.evaluate(a)[0],b=b*e;a>c.parameterPositions[1]&&(this.stopFading(),0===e&&(this.enabled=!1))}}return this._effectiveWeight=b},_updateTimeScale:function(a){var b=0;if(!this.paused){var b=this.timeScale,c=this._timeScaleInterpolant;if(null!==c){var e=c.evaluate(a)[0],b=b*e;a>c.parameterPositions[1]&&(this.stopWarping(),0===b?this.pause=!0:this.timeScale=b)}}return this._effectiveTimeScale=
b},_updateTime:function(a){var b=this.time+a;if(0===a)return b;var c=this._clip.duration,e=this.loop,d=this._loopCount,g=!1;switch(e){case THREE.LoopOnce:-1===d&&(this.loopCount=0,this._setEndings(!0,!0,!1));if(b>=c)b=c;else if(0>b)b=0;else break;this.clampWhenFinished?this.pause=!0:this.enabled=!1;this._mixer.dispatchEvent({type:"finished",action:this,direction:0>a?-1:1});break;case THREE.LoopPingPong:g=!0;case THREE.LoopRepeat:-1===d&&(0<a?(d=0,this._setEndings(!0,0===this.repetitions,g)):this._setEndings(0===
this.repetitions,!0,g));if(b>=c||0>b){var f=Math.floor(b/c),b=b-c*f,d=d+Math.abs(f),h=this.repetitions-d;if(0>h){this.clampWhenFinished?this.paused=!0:this.enabled=!1;b=0<a?c:0;this._mixer.dispatchEvent({type:"finished",action:this,direction:0<a?1:-1});break}else 0===h?(a=0>a,this._setEndings(a,!a,g)):this._setEndings(!1,!1,g);this._loopCount=d;this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:f})}if(e===THREE.LoopPingPong&&1===(d&1))return this.time=b,c-b}return this.time=b},_setEndings:function(a,
b,c){var e=this._interpolantSettings;c?(e.endingStart=THREE.ZeroSlopeEnding,e.endingEnd=THREE.ZeroSlopeEnding):(e.endingStart=a?this.zeroSlopeAtStart?THREE.ZeroSlopeEnding:THREE.ZeroCurvatureEnding:THREE.WrapAroundEnding,e.endingEnd=b?this.zeroSlopeAtEnd?THREE.ZeroSlopeEnding:THREE.ZeroCurvatureEnding:THREE.WrapAroundEnding)},_scheduleFading:function(a,b,c){var e=this._mixer,d=e.time,g=this._weightInterpolant;null===g&&(this._weightInterpolant=g=e._lendControlInterpolant());e=g.parameterPositions;
g=g.sampleValues;e[0]=d;g[0]=b;e[1]=d+a;g[1]=c;return this}};
Object.assign(THREE.AnimationMixer.prototype,{_bindAction:function(a,b){var c=a._localRoot||this._root,e=a._clip.tracks,d=e.length,g=a._propertyBindings,f=a._interpolants,h=c.uuid,k=this._bindingsByRootAndName,l=k[h];void 0===l&&(l={},k[h]=l);for(k=0;k!==d;++k){var n=e[k],q=n.name,m=l[q];if(void 0===m){m=g[k];if(void 0!==m){null===m._cacheIndex&&(++m.referenceCount,this._addInactiveBinding(m,h,q));continue}m=new THREE.PropertyMixer(THREE.PropertyBinding.create(c,q,b&&b._propertyBindings[k].binding.parsedPath),
n.ValueTypeName,n.getValueSize());++m.referenceCount;this._addInactiveBinding(m,h,q)}g[k]=m;f[k].resultBuffer=m.buffer}},_activateAction:function(a){if(!this._isActiveAction(a)){if(null===a._cacheIndex){var b=(a._localRoot||this._root).uuid,c=a._clip.name,e=this._actionsByClip[c];this._bindAction(a,e&&e.knownActions[0]);this._addInactiveAction(a,c,b)}b=a._propertyBindings;c=0;for(e=b.length;c!==e;++c){var d=b[c];0===d.useCount++&&(this._lendBinding(d),d.saveOriginalState())}this._lendAction(a)}},
_deactivateAction:function(a){if(this._isActiveAction(a)){for(var b=a._propertyBindings,c=0,e=b.length;c!==e;++c){var d=b[c];0===--d.useCount&&(d.restoreOriginalState(),this._takeBackBinding(d))}this._takeBackAction(a)}},_initMemoryManager:function(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var a=this;this.stats={actions:{get total(){return a._actions.length},
get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}},_isActiveAction:function(a){a=a._cacheIndex;return null!==a&&a<this._nActiveActions},_addInactiveAction:function(a,b,c){var e=this._actions,d=this._actionsByClip,g=d[b];void 0===g?(g={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,d[b]=g):(b=
g.knownActions,a._byClipCacheIndex=b.length,b.push(a));a._cacheIndex=e.length;e.push(a);g.actionByRoot[c]=a},_removeInactiveAction:function(a){var b=this._actions,c=b[b.length-1],e=a._cacheIndex;c._cacheIndex=e;b[e]=c;b.pop();a._cacheIndex=null;var c=a._clip.name,e=this._actionsByClip,d=e[c],g=d.knownActions,f=g[g.length-1],h=a._byClipCacheIndex;f._byClipCacheIndex=h;g[h]=f;g.pop();a._byClipCacheIndex=null;delete d.actionByRoot[(b._localRoot||this._root).uuid];0===g.length&&delete e[c];this._removeInactiveBindingsForAction(a)},
_removeInactiveBindingsForAction:function(a){a=a._propertyBindings;for(var b=0,c=a.length;b!==c;++b){var e=a[b];0===--e.referenceCount&&this._removeInactiveBinding(e)}},_lendAction:function(a){var b=this._actions,c=a._cacheIndex,e=this._nActiveActions++,d=b[e];a._cacheIndex=e;b[e]=a;d._cacheIndex=c;b[c]=d},_takeBackAction:function(a){var b=this._actions,c=a._cacheIndex,e=--this._nActiveActions,d=b[e];a._cacheIndex=e;b[e]=a;d._cacheIndex=c;b[c]=d},_addInactiveBinding:function(a,b,c){var e=this._bindingsByRootAndName,
d=e[b],g=this._bindings;void 0===d&&(d={},e[b]=d);d[c]=a;a._cacheIndex=g.length;g.push(a)},_removeInactiveBinding:function(a){var b=this._bindings,c=a.binding,e=c.rootNode.uuid,c=c.path,d=this._bindingsByRootAndName,g=d[e],f=b[b.length-1];a=a._cacheIndex;f._cacheIndex=a;b[a]=f;b.pop();delete g[c];a:{for(var h in g)break a;delete d[e]}},_lendBinding:function(a){var b=this._bindings,c=a._cacheIndex,e=this._nActiveBindings++,d=b[e];a._cacheIndex=e;b[e]=a;d._cacheIndex=c;b[c]=d},_takeBackBinding:function(a){var b=
this._bindings,c=a._cacheIndex,e=--this._nActiveBindings,d=b[e];a._cacheIndex=e;b[e]=a;d._cacheIndex=c;b[c]=d},_lendControlInterpolant:function(){var a=this._controlInterpolants,b=this._nActiveControlInterpolants++,c=a[b];void 0===c&&(c=new THREE.LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),c.__cacheIndex=b,a[b]=c);return c},_takeBackControlInterpolant:function(a){var b=this._controlInterpolants,c=a.__cacheIndex,e=--this._nActiveControlInterpolants,
d=b[e];a.__cacheIndex=e;b[e]=a;d.__cacheIndex=c;b[c]=d},_controlInterpolantsResultBuffer:new Float32Array(1)});
THREE.AnimationObjectGroup=function(a){this.uuid=THREE.Math.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var b={};this._indicesByUUID=b;for(var c=0,e=arguments.length;c!==e;++c)b[arguments[c].uuid]=c;this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var d=this;this.stats={objects:{get total(){return d._objects.length},get inUse(){return this.total-d.nCachedObjects_}},get bindingsPerObject(){return d._bindings.length}}};
THREE.AnimationObjectGroup.prototype={constructor:THREE.AnimationObjectGroup,add:function(a){for(var b=this._objects,c=b.length,e=this.nCachedObjects_,d=this._indicesByUUID,g=this._paths,f=this._parsedPaths,h=this._bindings,k=h.length,l=0,n=arguments.length;l!==n;++l){var q=arguments[l],m=q.uuid,p=d[m];if(void 0===p){p=c++;d[m]=p;b.push(q);for(var m=0,r=k;m!==r;++m)h[m].push(new THREE.PropertyBinding(q,g[m],f[m]))}else if(p<e){var u=b[p],t=--e,r=b[t];d[r.uuid]=p;b[p]=r;d[m]=t;b[t]=q;m=0;for(r=k;m!==
r;++m){var v=h[m],x=v[p];v[p]=v[t];void 0===x&&(x=new THREE.PropertyBinding(q,g[m],f[m]));v[t]=x}}else b[p]!==u&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=e},remove:function(a){for(var b=this._objects,c=this.nCachedObjects_,e=this._indicesByUUID,d=this._bindings,g=d.length,f=0,h=arguments.length;f!==h;++f){var k=arguments[f],l=k.uuid,n=e[l];if(void 0!==n&&n>=c){var q=c++,m=b[q];e[m.uuid]=
n;b[n]=m;e[l]=q;b[q]=k;k=0;for(l=g;k!==l;++k){var m=d[k],p=m[n];m[n]=m[q];m[q]=p}}}this.nCachedObjects_=c},uncache:function(a){for(var b=this._objects,c=b.length,e=this.nCachedObjects_,d=this._indicesByUUID,g=this._bindings,f=g.length,h=0,k=arguments.length;h!==k;++h){var l=arguments[h].uuid,n=d[l];if(void 0!==n)if(delete d[l],n<e){var l=--e,q=b[l],m=--c,p=b[m];d[q.uuid]=n;b[n]=q;d[p.uuid]=l;b[l]=p;b.pop();q=0;for(p=f;q!==p;++q){var r=g[q],u=r[m];r[n]=r[l];r[l]=u;r.pop()}}else for(m=--c,p=b[m],d[p.uuid]=
n,b[n]=p,b.pop(),q=0,p=f;q!==p;++q)r=g[q],r[n]=r[m],r.pop()}this.nCachedObjects_=e},subscribe_:function(a,b){var c=this._bindingsIndicesByPath,e=c[a],d=this._bindings;if(void 0!==e)return d[e];var g=this._paths,f=this._parsedPaths,h=this._objects,k=this.nCachedObjects_,l=Array(h.length),e=d.length;c[a]=e;g.push(a);f.push(b);d.push(l);c=k;for(e=h.length;c!==e;++c)l[c]=new THREE.PropertyBinding(h[c],a,b);return l},unsubscribe_:function(a){var b=this._bindingsIndicesByPath,c=b[a];if(void 0!==c){var e=
this._paths,d=this._parsedPaths,g=this._bindings,f=g.length-1,h=g[f];b[a[f]]=c;g[c]=h;g.pop();d[c]=d[f];d.pop();e[c]=e[f];e.pop()}}};
THREE.AnimationUtils={arraySlice:function(a,b,c){return THREE.AnimationUtils.isTypedArray(a)?new a.constructor(a.subarray(b,c)):a.slice(b,c)},convertArray:function(a,b,c){return!a||!c&&a.constructor===b?a:"number"===typeof b.BYTES_PER_ELEMENT?new b(a):Array.prototype.slice.call(a)},isTypedArray:function(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)},getKeyframeOrder:function(a){for(var b=a.length,c=Array(b),e=0;e!==b;++e)c[e]=e;c.sort(function(b,c){return a[b]-a[c]});return c},sortedArray:function(a,
b,c){for(var e=a.length,d=new a.constructor(e),g=0,f=0;f!==e;++g)for(var h=c[g]*b,k=0;k!==b;++k)d[f++]=a[h+k];return d},flattenJSON:function(a,b,c,e){for(var d=1,g=a[0];void 0!==g&&void 0===g[e];)g=a[d++];if(void 0!==g){var f=g[e];if(void 0!==f)if(Array.isArray(f)){do f=g[e],void 0!==f&&(b.push(g.time),c.push.apply(c,f)),g=a[d++];while(void 0!==g)}else if(void 0!==f.toArray){do f=g[e],void 0!==f&&(b.push(g.time),f.toArray(c,c.length)),g=a[d++];while(void 0!==g)}else{do f=g[e],void 0!==f&&(b.push(g.time),
c.push(f)),g=a[d++];while(void 0!==g)}}}};THREE.KeyframeTrack=function(a,b,c,e){if(void 0===a)throw Error("track name is undefined");if(void 0===b||0===b.length)throw Error("no keyframes in track named "+a);this.name=a;this.times=THREE.AnimationUtils.convertArray(b,this.TimeBufferType);this.values=THREE.AnimationUtils.convertArray(c,this.ValueBufferType);this.setInterpolation(e||this.DefaultInterpolation);this.validate();this.optimize()};
THREE.KeyframeTrack.prototype={constructor:THREE.KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:THREE.InterpolateLinear,InterpolantFactoryMethodDiscrete:function(a){return new THREE.DiscreteInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodLinear:function(a){return new THREE.LinearInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:function(a){return new THREE.CubicInterpolant(this.times,
this.values,this.getValueSize(),a)},setInterpolation:function(a){var b=void 0;switch(a){case THREE.InterpolateDiscrete:b=this.InterpolantFactoryMethodDiscrete;break;case THREE.InterpolateLinear:b=this.InterpolantFactoryMethodLinear;break;case THREE.InterpolateSmooth:b=this.InterpolantFactoryMethodSmooth}if(void 0===b){b="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);
else throw Error(b);console.warn(b)}else this.createInterpolant=b},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return THREE.InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return THREE.InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return THREE.InterpolateSmooth}},getValueSize:function(){return this.values.length/this.times.length},shift:function(a){if(0!==a)for(var b=this.times,c=0,e=b.length;c!==e;++c)b[c]+=a;return this},
scale:function(a){if(1!==a)for(var b=this.times,c=0,e=b.length;c!==e;++c)b[c]*=a;return this},trim:function(a,b){for(var c=this.times,e=c.length,d=0,g=e-1;d!==e&&c[d]<a;)++d;for(;-1!==g&&c[g]>b;)--g;++g;if(0!==d||g!==e)d>=g&&(g=Math.max(g,1),d=g-1),e=this.getValueSize(),this.times=THREE.AnimationUtils.arraySlice(c,d,g),this.values=THREE.AnimationUtils.arraySlice(this.values,d*e,g*e);return this},validate:function(){var a=!0,b=this.getValueSize();0!==b-Math.floor(b)&&(console.error("invalid value size in track",
this),a=!1);var c=this.times,b=this.values,e=c.length;0===e&&(console.error("track is empty",this),a=!1);for(var d=null,g=0;g!==e;g++){var f=c[g];if("number"===typeof f&&isNaN(f)){console.error("time is not a valid number",this,g,f);a=!1;break}if(null!==d&&d>f){console.error("out of order keys",this,g,f,d);a=!1;break}d=f}if(void 0!==b&&THREE.AnimationUtils.isTypedArray(b))for(g=0,c=b.length;g!==c;++g)if(e=b[g],isNaN(e)){console.error("value is not a valid number",this,g,e);a=!1;break}return a},optimize:function(){for(var a=
this.times,b=this.values,c=this.getValueSize(),e=1,d=1,g=a.length-1;d<=g;++d){var f=!1,h=a[d];if(h!==a[d+1]&&(1!==d||h!==h[0]))for(var k=d*c,l=k-c,n=k+c,h=0;h!==c;++h){var q=b[k+h];if(q!==b[l+h]||q!==b[n+h]){f=!0;break}}if(f){if(d!==e)for(a[e]=a[d],f=d*c,k=e*c,h=0;h!==c;++h)b[k+h]=b[f+h];++e}}e!==a.length&&(this.times=THREE.AnimationUtils.arraySlice(a,0,e),this.values=THREE.AnimationUtils.arraySlice(b,0,e*c));return this}};
Object.assign(THREE.KeyframeTrack,{parse:function(a){if(void 0===a.type)throw Error("track type undefined, can not parse");var b=THREE.KeyframeTrack._getTrackTypeForValueTypeName(a.type);if(void 0===a.times){console.warn("legacy JSON format detected, converting");var c=[],e=[];THREE.AnimationUtils.flattenJSON(a.keys,c,e,"value");a.times=c;a.values=e}return void 0!==b.parse?b.parse(a):new b(a.name,a.times,a.values,a.interpolation)},toJSON:function(a){var b=a.constructor;if(void 0!==b.toJSON)b=b.toJSON(a);
else{var b={name:a.name,times:THREE.AnimationUtils.convertArray(a.times,Array),values:THREE.AnimationUtils.convertArray(a.values,Array)},c=a.getInterpolation();c!==a.DefaultInterpolation&&(b.interpolation=c)}b.type=a.ValueTypeName;return b},_getTrackTypeForValueTypeName:function(a){switch(a.toLowerCase()){case "scalar":case "double":case "float":case "number":case "integer":return THREE.NumberKeyframeTrack;case "vector":case "vector2":case "vector3":case "vector4":return THREE.VectorKeyframeTrack;
case "color":return THREE.ColorKeyframeTrack;case "quaternion":return THREE.QuaternionKeyframeTrack;case "bool":case "boolean":return THREE.BooleanKeyframeTrack;case "string":return THREE.StringKeyframeTrack}throw Error("Unsupported typeName: "+a);}});THREE.PropertyBinding=function(a,b,c){this.path=b;this.parsedPath=c||THREE.PropertyBinding.parseTrackName(b);this.node=THREE.PropertyBinding.findNode(a,this.parsedPath.nodeName)||a;this.rootNode=a};
THREE.PropertyBinding.prototype={constructor:THREE.PropertyBinding,getValue:function(a,b){this.bind();this.getValue(a,b)},setValue:function(a,b){this.bind();this.setValue(a,b)},bind:function(){var a=this.node,b=this.parsedPath,c=b.objectName,e=b.propertyName,d=b.propertyIndex;a||(this.node=a=THREE.PropertyBinding.findNode(this.rootNode,b.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(a){if(c){var g=b.objectIndex;switch(c){case "materials":if(!a.material){console.error("  can not bind to material as node does not have a material",
this);return}if(!a.material.materials){console.error("  can not bind to material.materials as node.material does not have a materials array",this);return}a=a.material.materials;break;case "bones":if(!a.skeleton){console.error("  can not bind to bones as node does not have a skeleton",this);return}a=a.skeleton.bones;for(c=0;c<a.length;c++)if(a[c].name===g){g=c;break}break;default:if(void 0===a[c]){console.error("  can not bind to objectName of node, undefined",this);return}a=a[c]}if(void 0!==g){if(void 0===
a[g]){console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,a);return}a=a[g]}}if(g=a[e]){b=this.Versioning.None;void 0!==a.needsUpdate?(b=this.Versioning.NeedsUpdate,this.targetObject=a):void 0!==a.matrixWorldNeedsUpdate&&(b=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=a);c=this.BindingType.Direct;if(void 0!==d){if("morphTargetInfluences"===e){if(!a.geometry){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",
this);return}if(!a.geometry.morphTargets){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);return}for(c=0;c<this.node.geometry.morphTargets.length;c++)if(a.geometry.morphTargets[c].name===d){d=c;break}}c=this.BindingType.ArrayElement;this.resolvedProperty=g;this.propertyIndex=d}else void 0!==g.fromArray&&void 0!==g.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=g):void 0!==g.length?(c=this.BindingType.EntireArray,this.resolvedProperty=
g):this.propertyName=e;this.getValue=this.GetterByBindingType[c];this.setValue=this.SetterByBindingTypeAndVersioning[c][b]}else console.error("  trying to update property for track: "+b.nodeName+"."+e+" but it wasn't found.",a)}else console.error("  trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}};
Object.assign(THREE.PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:THREE.PropertyBinding.prototype.getValue,_setValue_unbound:THREE.PropertyBinding.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(a,b){a[b]=this.node[this.propertyName]},function(a,b){for(var c=this.resolvedProperty,e=0,d=c.length;e!==d;++e)a[b++]=
c[e]},function(a,b){a[b]=this.resolvedProperty[this.propertyIndex]},function(a,b){this.resolvedProperty.toArray(a,b)}],SetterByBindingTypeAndVersioning:[[function(a,b){this.node[this.propertyName]=a[b]},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){for(var c=this.resolvedProperty,e=0,d=c.length;e!==d;++e)c[e]=a[b++]},function(a,b){for(var c=this.resolvedProperty,
e=0,d=c.length;e!==d;++e)c[e]=a[b++];this.targetObject.needsUpdate=!0},function(a,b){for(var c=this.resolvedProperty,e=0,d=c.length;e!==d;++e)c[e]=a[b++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty[this.propertyIndex]=a[b]},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty.fromArray(a,
b)},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.matrixWorldNeedsUpdate=!0}]]});THREE.PropertyBinding.Composite=function(a,b,c){c=c||THREE.PropertyBinding.parseTrackName(b);this._targetGroup=a;this._bindings=a.subscribe_(b,c)};
THREE.PropertyBinding.Composite.prototype={constructor:THREE.PropertyBinding.Composite,getValue:function(a,b){this.bind();var c=this._bindings[this._targetGroup.nCachedObjects_];void 0!==c&&c.getValue(a,b)},setValue:function(a,b){for(var c=this._bindings,e=this._targetGroup.nCachedObjects_,d=c.length;e!==d;++e)c[e].setValue(a,b)},bind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].bind()},unbind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,
c=a.length;b!==c;++b)a[b].unbind()}};THREE.PropertyBinding.create=function(a,b,c){return a instanceof THREE.AnimationObjectGroup?new THREE.PropertyBinding.Composite(a,b,c):new THREE.PropertyBinding(a,b,c)};
THREE.PropertyBinding.parseTrackName=function(a){var b=/^(([\w]+\/)*)([\w-\d]+)?(\.([\w]+)(\[([\w\d\[\]\_.:\- ]+)\])?)?(\.([\w.]+)(\[([\w\d\[\]\_. ]+)\])?)$/,c=b.exec(a);if(!c)throw Error("cannot parse trackName at all: "+a);c.index===b.lastIndex&&b.lastIndex++;b={nodeName:c[3],objectName:c[5],objectIndex:c[7],propertyName:c[9],propertyIndex:c[11]};if(null===b.propertyName||0===b.propertyName.length)throw Error("can not parse propertyName from trackName: "+a);return b};
THREE.PropertyBinding.findNode=function(a,b){if(!b||""===b||"root"===b||"."===b||-1===b||b===a.name||b===a.uuid)return a;if(a.skeleton){var c=function(a){for(var c=0;c<a.bones.length;c++){var d=a.bones[c];if(d.name===b)return d}return null}(a.skeleton);if(c)return c}if(a.children){var e=function(a){for(var c=0;c<a.length;c++){var d=a[c];if(d.name===b||d.uuid===b||(d=e(d.children)))return d}return null};if(c=e(a.children))return c}return null};
THREE.PropertyMixer=function(a,b,c){this.binding=a;this.valueSize=c;a=Float64Array;switch(b){case "quaternion":b=this._slerp;break;case "string":case "bool":a=Array;b=this._select;break;default:b=this._lerp}this.buffer=new a(4*c);this._mixBufferRegion=b;this.referenceCount=this.useCount=this.cumulativeWeight=0};
THREE.PropertyMixer.prototype={constructor:THREE.PropertyMixer,accumulate:function(a,b){var c=this.buffer,e=this.valueSize,d=a*e+e,g=this.cumulativeWeight;if(0===g){for(g=0;g!==e;++g)c[d+g]=c[g];g=b}else g+=b,this._mixBufferRegion(c,d,0,b/g,e);this.cumulativeWeight=g},apply:function(a){var b=this.valueSize,c=this.buffer;a=a*b+b;var e=this.cumulativeWeight,d=this.binding;this.cumulativeWeight=0;1>e&&this._mixBufferRegion(c,a,3*b,1-e,b);for(var e=b,g=b+b;e!==g;++e)if(c[e]!==c[e+b]){d.setValue(c,a);
break}},saveOriginalState:function(){var a=this.buffer,b=this.valueSize,c=3*b;this.binding.getValue(a,c);for(var e=b;e!==c;++e)a[e]=a[c+e%b];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(a,b,c,e,d){if(.5<=e)for(e=0;e!==d;++e)a[b+e]=a[c+e]},_slerp:function(a,b,c,e,d){THREE.Quaternion.slerpFlat(a,b,a,b,a,c,e)},_lerp:function(a,b,c,e,d){for(var g=1-e,f=0;f!==d;++f){var h=b+f;a[h]=a[h]*g+a[c+f]*e}}};
THREE.BooleanKeyframeTrack=function(a,b,c){THREE.KeyframeTrack.call(this,a,b,c)};THREE.BooleanKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:THREE.IntepolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});THREE.NumberKeyframeTrack=function(a,b,c,e){THREE.KeyframeTrack.call(this,a,b,c,e)};
THREE.NumberKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.NumberKeyframeTrack,ValueTypeName:"number"});THREE.QuaternionKeyframeTrack=function(a,b,c,e){THREE.KeyframeTrack.call(this,a,b,c,e)};
THREE.QuaternionKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:THREE.InterpolateLinear,InterpolantFactoryMethodLinear:function(a){return new THREE.QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:void 0});THREE.StringKeyframeTrack=function(a,b,c,e){THREE.KeyframeTrack.call(this,a,b,c,e)};
THREE.StringKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:THREE.IntepolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});THREE.VectorKeyframeTrack=function(a,b,c,e){THREE.KeyframeTrack.call(this,a,b,c,e)};
THREE.VectorKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.VectorKeyframeTrack,ValueTypeName:"vector"});
THREE.Audio=function(a){THREE.Object3D.call(this);this.type="Audio";this.context=a.context;this.source=this.context.createBufferSource();this.source.onended=this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(a.getInput());this.autoplay=!1;this.startTime=0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=!0;this.sourceType="empty";this.filter=null};THREE.Audio.prototype=Object.create(THREE.Object3D.prototype);THREE.Audio.prototype.constructor=THREE.Audio;
THREE.Audio.prototype.getOutput=function(){return this.gain};THREE.Audio.prototype.load=function(a){var b=new THREE.AudioBuffer(this.context);b.load(a);this.setBuffer(b);return this};THREE.Audio.prototype.setNodeSource=function(a){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=a;this.connect();return this};THREE.Audio.prototype.setBuffer=function(a){var b=this;a.onReady(function(a){b.source.buffer=a;b.sourceType="buffer";b.autoplay&&b.play()});return this};
THREE.Audio.prototype.play=function(){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else{var a=this.context.createBufferSource();a.buffer=this.source.buffer;a.loop=this.source.loop;a.onended=this.source.onended;a.start(0,this.startTime);a.playbackRate.value=this.playbackRate;this.isPlaying=!0;this.source=a;this.connect()}};
THREE.Audio.prototype.pause=function(){!1===this.hasPlaybackControl?console.warn("THREE.Audio: this Audio has no playback control."):(this.source.stop(),this.startTime=this.context.currentTime)};THREE.Audio.prototype.stop=function(){!1===this.hasPlaybackControl?console.warn("THREE.Audio: this Audio has no playback control."):(this.source.stop(),this.startTime=0)};THREE.Audio.prototype.connect=function(){null!==this.filter?(this.source.connect(this.filter),this.filter.connect(this.getOutput())):this.source.connect(this.getOutput())};
THREE.Audio.prototype.disconnect=function(){null!==this.filter?(this.source.disconnect(this.filter),this.filter.disconnect(this.getOutput())):this.source.disconnect(this.getOutput())};THREE.Audio.prototype.getFilter=function(){return this.filter};THREE.Audio.prototype.setFilter=function(a){void 0===a&&(a=null);!0===this.isPlaying?(this.disconnect(),this.filter=a,this.connect()):this.filter=a};
THREE.Audio.prototype.setPlaybackRate=function(a){!1===this.hasPlaybackControl?console.warn("THREE.Audio: this Audio has no playback control."):(this.playbackRate=a,!0===this.isPlaying&&(this.source.playbackRate.value=this.playbackRate))};THREE.Audio.prototype.getPlaybackRate=function(){return this.playbackRate};THREE.Audio.prototype.onEnded=function(){this.isPlaying=!1};
THREE.Audio.prototype.setLoop=function(a){!1===this.hasPlaybackControl?console.warn("THREE.Audio: this Audio has no playback control."):this.source.loop=a};THREE.Audio.prototype.getLoop=function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.source.loop};THREE.Audio.prototype.setVolume=function(a){this.gain.gain.value=a};THREE.Audio.prototype.getVolume=function(){return this.gain.gain.value};
THREE.AudioAnalyser=function(a,b){this.analyser=a.context.createAnalyser();this.analyser.fftSize=void 0!==b?b:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);a.getOutput().connect(this.analyser)};THREE.AudioAnalyser.prototype={constructor:THREE.AudioAnalyser,getData:function(){this.analyser.getByteFrequencyData(this.data);return this.data}};THREE.AudioBuffer=function(a){this.context=a;this.ready=!1;this.readyCallbacks=[]};
THREE.AudioBuffer.prototype.load=function(a){var b=this,c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="arraybuffer";c.onload=function(a){b.context.decodeAudioData(this.response,function(a){b.buffer=a;b.ready=!0;for(a=0;a<b.readyCallbacks.length;a++)b.readyCallbacks[a](b.buffer);b.readyCallbacks=[]})};c.send();return this};THREE.AudioBuffer.prototype.onReady=function(a){this.ready?a(this.buffer):this.readyCallbacks.push(a)};
THREE.PositionalAudio=function(a){THREE.Audio.call(this,a);this.panner=this.context.createPanner();this.panner.connect(this.gain)};THREE.PositionalAudio.prototype=Object.create(THREE.Audio.prototype);THREE.PositionalAudio.prototype.constructor=THREE.PositionalAudio;THREE.PositionalAudio.prototype.getOutput=function(){return this.panner};THREE.PositionalAudio.prototype.setRefDistance=function(a){this.panner.refDistance=a};THREE.PositionalAudio.prototype.getRefDistance=function(){return this.panner.refDistance};
THREE.PositionalAudio.prototype.setRolloffFactor=function(a){this.panner.rolloffFactor=a};THREE.PositionalAudio.prototype.getRolloffFactor=function(){return this.panner.rolloffFactor};THREE.PositionalAudio.prototype.setDistanceModel=function(a){this.panner.distanceModel=a};THREE.PositionalAudio.prototype.getDistanceModel=function(){return this.panner.distanceModel};THREE.PositionalAudio.prototype.setMaxDistance=function(a){this.panner.maxDistance=a};
THREE.PositionalAudio.prototype.getMaxDistance=function(){return this.panner.maxDistance};THREE.PositionalAudio.prototype.updateMatrixWorld=function(){var a=new THREE.Vector3;return function(b){THREE.Object3D.prototype.updateMatrixWorld.call(this,b);a.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(a.x,a.y,a.z)}}();
THREE.AudioListener=function(){THREE.Object3D.call(this);this.type="AudioListener";this.context=new (window.AudioContext||window.webkitAudioContext);this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null};THREE.AudioListener.prototype=Object.create(THREE.Object3D.prototype);THREE.AudioListener.prototype.constructor=THREE.AudioListener;THREE.AudioListener.prototype.getInput=function(){return this.gain};
THREE.AudioListener.prototype.removeFilter=function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)};THREE.AudioListener.prototype.setFilter=function(a){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination);this.filter=a;this.gain.connect(this.filter);this.filter.connect(this.context.destination)};
THREE.AudioListener.prototype.getFilter=function(){return this.filter};THREE.AudioListener.prototype.setMasterVolume=function(a){this.gain.gain.value=a};THREE.AudioListener.prototype.getMasterVolume=function(){return this.gain.gain.value};
THREE.AudioListener.prototype.updateMatrixWorld=function(){var a=new THREE.Vector3,b=new THREE.Quaternion,c=new THREE.Vector3,e=new THREE.Vector3;return function(d){THREE.Object3D.prototype.updateMatrixWorld.call(this,d);d=this.context.listener;var g=this.up;this.matrixWorld.decompose(a,b,c);e.set(0,0,-1).applyQuaternion(b);d.setPosition(a.x,a.y,a.z);d.setOrientation(e.x,e.y,e.z,g.x,g.y,g.z)}}();
THREE.Camera=function(){THREE.Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.getWorldDirection=function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,-1).applyQuaternion(a)}}();
THREE.Camera.prototype.lookAt=function(){var a=new THREE.Matrix4;return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();THREE.Camera.prototype.clone=function(){return(new this.constructor).copy(this)};THREE.Camera.prototype.copy=function(a){THREE.Object3D.prototype.copy.call(this,a);this.matrixWorldInverse.copy(a.matrixWorldInverse);this.projectionMatrix.copy(a.projectionMatrix);return this};
THREE.CubeCamera=function(a,b,c){THREE.Object3D.call(this);this.type="CubeCamera";var e=new THREE.PerspectiveCamera(90,1,a,b);e.up.set(0,-1,0);e.lookAt(new THREE.Vector3(1,0,0));this.add(e);var d=new THREE.PerspectiveCamera(90,1,a,b);d.up.set(0,-1,0);d.lookAt(new THREE.Vector3(-1,0,0));this.add(d);var g=new THREE.PerspectiveCamera(90,1,a,b);g.up.set(0,0,1);g.lookAt(new THREE.Vector3(0,1,0));this.add(g);var f=new THREE.PerspectiveCamera(90,1,a,b);f.up.set(0,0,-1);f.lookAt(new THREE.Vector3(0,-1,0));
this.add(f);var h=new THREE.PerspectiveCamera(90,1,a,b);h.up.set(0,-1,0);h.lookAt(new THREE.Vector3(0,0,1));this.add(h);var k=new THREE.PerspectiveCamera(90,1,a,b);k.up.set(0,-1,0);k.lookAt(new THREE.Vector3(0,0,-1));this.add(k);this.renderTarget=new THREE.WebGLRenderTargetCube(c,c,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(a,b){null===this.parent&&this.updateMatrixWorld();var c=this.renderTarget,m=c.texture.generateMipmaps;c.texture.generateMipmaps=
!1;c.activeCubeFace=0;a.render(b,e,c);c.activeCubeFace=1;a.render(b,d,c);c.activeCubeFace=2;a.render(b,g,c);c.activeCubeFace=3;a.render(b,f,c);c.activeCubeFace=4;a.render(b,h,c);c.texture.generateMipmaps=m;c.activeCubeFace=5;a.render(b,k,c);a.setRenderTarget(null)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CubeCamera.prototype.constructor=THREE.CubeCamera;
THREE.OrthographicCamera=function(a,b,c,e,d,g){THREE.Camera.call(this);this.type="OrthographicCamera";this.zoom=1;this.left=a;this.right=b;this.top=c;this.bottom=e;this.near=void 0!==d?d:.1;this.far=void 0!==g?g:2E3;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera;
THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,e=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(c-a,c+a,e+b,e-b,this.near,this.far)};THREE.OrthographicCamera.prototype.copy=function(a){THREE.Camera.prototype.copy.call(this,a);this.left=a.left;this.right=a.right;this.top=a.top;this.bottom=a.bottom;this.near=a.near;this.far=a.far;this.zoom=a.zoom;return this};
THREE.OrthographicCamera.prototype.toJSON=function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.zoom=this.zoom;a.object.left=this.left;a.object.right=this.right;a.object.top=this.top;a.object.bottom=this.bottom;a.object.near=this.near;a.object.far=this.far;return a};
THREE.PerspectiveCamera=function(a,b,c,e){THREE.Camera.call(this);this.type="PerspectiveCamera";this.focalLength=10;this.zoom=1;this.fov=void 0!==a?a:50;this.aspect=void 0!==b?b:1;this.near=void 0!==c?c:.1;this.far=void 0!==e?e:2E3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera;
THREE.PerspectiveCamera.prototype.setLens=function(a,b){void 0===b&&(b=24);this.fov=2*THREE.Math.radToDeg(Math.atan(b/(2*a)));this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,e,d,g){this.fullWidth=a;this.fullHeight=b;this.x=c;this.y=e;this.width=d;this.height=g;this.updateProjectionMatrix()};
THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var a=THREE.Math.radToDeg(2*Math.atan(Math.tan(.5*THREE.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var b=this.fullWidth/this.fullHeight,a=Math.tan(THREE.Math.degToRad(.5*a))*this.near,c=-a,e=b*c,b=Math.abs(b*a-e),c=Math.abs(a-c);this.projectionMatrix.makeFrustum(e+this.x*b/this.fullWidth,e+(this.x+this.width)*b/this.fullWidth,a-(this.y+this.height)*c/this.fullHeight,a-this.y*c/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(a,
this.aspect,this.near,this.far)};THREE.PerspectiveCamera.prototype.copy=function(a){THREE.Camera.prototype.copy.call(this,a);this.focalLength=a.focalLength;this.zoom=a.zoom;this.fov=a.fov;this.aspect=a.aspect;this.near=a.near;this.far=a.far;return this};
THREE.PerspectiveCamera.prototype.toJSON=function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.focalLength=this.focalLength;a.object.zoom=this.zoom;a.object.fov=this.fov;a.object.aspect=this.aspect;a.object.near=this.near;a.object.far=this.far;return a};
THREE.StereoCamera=function(){this.type="StereoCamera";this.aspect=1;this.cameraL=new THREE.PerspectiveCamera;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new THREE.PerspectiveCamera;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=!1};
THREE.StereoCamera.prototype={constructor:THREE.StereoCamera,update:function(){var a,b,c,e,d,g=new THREE.Matrix4,f=new THREE.Matrix4;return function(h){if(a!==h.focalLength||b!==h.fov||c!==h.aspect*this.aspect||e!==h.near||d!==h.far){a=h.focalLength;b=h.fov;c=h.aspect*this.aspect;e=h.near;d=h.far;var k=h.projectionMatrix.clone(),l=.032*e/a,n=e*Math.tan(THREE.Math.degToRad(.5*b)),q,m;f.elements[12]=-.032;g.elements[12]=.032;q=-n*c+l;m=n*c+l;k.elements[0]=2*e/(m-q);k.elements[8]=(m+q)/(m-q);this.cameraL.projectionMatrix.copy(k);
q=-n*c-l;m=n*c-l;k.elements[0]=2*e/(m-q);k.elements[8]=(m+q)/(m-q);this.cameraR.projectionMatrix.copy(k)}this.cameraL.matrixWorld.copy(h.matrixWorld).multiply(f);this.cameraR.matrixWorld.copy(h.matrixWorld).multiply(g)}}()};THREE.Light=function(a,b){THREE.Object3D.call(this);this.type="Light";this.color=new THREE.Color(a);this.intensity=void 0!==b?b:1;this.receiveShadow=void 0};THREE.Light.prototype=Object.create(THREE.Object3D.prototype);THREE.Light.prototype.constructor=THREE.Light;
THREE.Light.prototype.copy=function(a){THREE.Object3D.prototype.copy.call(this,a);this.color.copy(a.color);this.intensity=a.intensity;return this};
THREE.Light.prototype.toJSON=function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.color=this.color.getHex();a.object.intensity=this.intensity;void 0!==this.groundColor&&(a.object.groundColor=this.groundColor.getHex());void 0!==this.distance&&(a.object.distance=this.distance);void 0!==this.angle&&(a.object.angle=this.angle);void 0!==this.decay&&(a.object.decay=this.decay);void 0!==this.penumbra&&(a.object.penumbra=this.penumbra);return a};
THREE.LightShadow=function(a){this.camera=a;this.bias=0;this.radius=1;this.mapSize=new THREE.Vector2(512,512);this.map=null;this.matrix=new THREE.Matrix4};THREE.LightShadow.prototype={constructor:THREE.LightShadow,copy:function(a){this.camera=a.camera.clone();this.bias=a.bias;this.radius=a.radius;this.mapSize.copy(a.mapSize);return this},clone:function(){return(new this.constructor).copy(this)}};THREE.AmbientLight=function(a,b){THREE.Light.call(this,a,b);this.type="AmbientLight";this.castShadow=void 0};
THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype);THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(a,b){THREE.Light.call(this,a,b);this.type="DirectionalLight";this.position.set(0,1,0);this.updateMatrix();this.target=new THREE.Object3D;this.shadow=new THREE.LightShadow(new THREE.OrthographicCamera(-5,5,5,-5,.5,500))};THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;
THREE.DirectionalLight.prototype.copy=function(a){THREE.Light.prototype.copy.call(this,a);this.target=a.target.clone();this.shadow=a.shadow.clone();return this};THREE.HemisphereLight=function(a,b,c){THREE.Light.call(this,a,c);this.type="HemisphereLight";this.castShadow=void 0;this.position.set(0,1,0);this.updateMatrix();this.groundColor=new THREE.Color(b)};THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype);THREE.HemisphereLight.prototype.constructor=THREE.HemisphereLight;
THREE.HemisphereLight.prototype.copy=function(a){THREE.Light.prototype.copy.call(this,a);this.groundColor.copy(a.groundColor);return this};THREE.PointLight=function(a,b,c,e){THREE.Light.call(this,a,b);this.type="PointLight";this.distance=void 0!==c?c:0;this.decay=void 0!==e?e:1;this.shadow=new THREE.LightShadow(new THREE.PerspectiveCamera(90,1,.5,500))};THREE.PointLight.prototype=Object.create(THREE.Light.prototype);THREE.PointLight.prototype.constructor=THREE.PointLight;
Object.defineProperty(THREE.PointLight.prototype,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(a){this.intensity=a/(4*Math.PI)}});THREE.PointLight.prototype.copy=function(a){THREE.Light.prototype.copy.call(this,a);this.distance=a.distance;this.decay=a.decay;this.shadow=a.shadow.clone();return this};
THREE.SpotLight=function(a,b,c,e,d,g){THREE.Light.call(this,a,b);this.type="SpotLight";this.position.set(0,1,0);this.updateMatrix();this.target=new THREE.Object3D;this.distance=void 0!==c?c:0;this.angle=void 0!==e?e:Math.PI/3;this.penumbra=void 0!==d?d:0;this.decay=void 0!==g?g:1;this.shadow=new THREE.LightShadow(new THREE.PerspectiveCamera(50,1,.5,500))};THREE.SpotLight.prototype=Object.create(THREE.Light.prototype);THREE.SpotLight.prototype.constructor=THREE.SpotLight;
Object.defineProperty(THREE.SpotLight.prototype,"power",{get:function(){return this.intensity*Math.PI},set:function(a){this.intensity=a/Math.PI}});THREE.SpotLight.prototype.copy=function(a){THREE.Light.prototype.copy.call(this,a);this.distance=a.distance;this.angle=a.angle;this.penumbra=a.penumbra;this.decay=a.decay;this.target=a.target.clone();this.shadow=a.shadow.clone();return this};
THREE.Cache={enabled:!1,files:{},add:function(a,b){!1!==this.enabled&&(this.files[a]=b)},get:function(a){if(!1!==this.enabled)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}};THREE.Loader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};
THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:void 0,extractUrlBase:function(a){a=a.split("/");if(1===a.length)return"./";a.pop();return a.join("/")+"/"},initMaterials:function(a,b,c){for(var e=[],d=0;d<a.length;++d)e[d]=this.createMaterial(a[d],b,c);return e},createMaterial:function(){var a,b,c;return function(e,d,g){function f(a,c,e,f,k){a=d+a;var m=THREE.Loader.Handlers.get(a);null!==m?a=m.load(a):(b.setCrossOrigin(g),a=b.load(a));void 0!==c&&(a.repeat.fromArray(c),1!==c[0]&&(a.wrapS=
THREE.RepeatWrapping),1!==c[1]&&(a.wrapT=THREE.RepeatWrapping));void 0!==e&&a.offset.fromArray(e);void 0!==f&&("repeat"===f[0]&&(a.wrapS=THREE.RepeatWrapping),"mirror"===f[0]&&(a.wrapS=THREE.MirroredRepeatWrapping),"repeat"===f[1]&&(a.wrapT=THREE.RepeatWrapping),"mirror"===f[1]&&(a.wrapT=THREE.MirroredRepeatWrapping));void 0!==k&&(a.anisotropy=k);c=THREE.Math.generateUUID();h[c]=a;return c}void 0===a&&(a=new THREE.Color);void 0===b&&(b=new THREE.TextureLoader);void 0===c&&(c=new THREE.MaterialLoader);
var h={},k={uuid:THREE.Math.generateUUID(),type:"MeshLambertMaterial"},l;for(l in e){var n=e[l];switch(l){case "DbgColor":case "DbgIndex":case "opticalDensity":case "illumination":break;case "DbgName":k.name=n;break;case "blending":k.blending=THREE[n];break;case "colorAmbient":case "mapAmbient":console.warn("THREE.Loader.createMaterial:",l,"is no longer supported.");break;case "colorDiffuse":k.color=a.fromArray(n).getHex();break;case "colorSpecular":k.specular=a.fromArray(n).getHex();break;case "colorEmissive":k.emissive=
a.fromArray(n).getHex();break;case "specularCoef":k.shininess=n;break;case "shading":"basic"===n.toLowerCase()&&(k.type="MeshBasicMaterial");"phong"===n.toLowerCase()&&(k.type="MeshPhongMaterial");break;case "mapDiffuse":k.map=f(n,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy);break;case "mapDiffuseRepeat":case "mapDiffuseOffset":case "mapDiffuseWrap":case "mapDiffuseAnisotropy":break;case "mapLight":k.lightMap=f(n,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy);
break;case "mapLightRepeat":case "mapLightOffset":case "mapLightWrap":case "mapLightAnisotropy":break;case "mapAO":k.aoMap=f(n,e.mapAORepeat,e.mapAOOffset,e.mapAOWrap,e.mapAOAnisotropy);break;case "mapAORepeat":case "mapAOOffset":case "mapAOWrap":case "mapAOAnisotropy":break;case "mapBump":k.bumpMap=f(n,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy);break;case "mapBumpScale":k.bumpScale=n;break;case "mapBumpRepeat":case "mapBumpOffset":case "mapBumpWrap":case "mapBumpAnisotropy":break;
case "mapNormal":k.normalMap=f(n,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy);break;case "mapNormalFactor":k.normalScale=[n,n];break;case "mapNormalRepeat":case "mapNormalOffset":case "mapNormalWrap":case "mapNormalAnisotropy":break;case "mapSpecular":k.specularMap=f(n,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy);break;case "mapSpecularRepeat":case "mapSpecularOffset":case "mapSpecularWrap":case "mapSpecularAnisotropy":break;case "mapAlpha":k.alphaMap=
f(n,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy);break;case "mapAlphaRepeat":case "mapAlphaOffset":case "mapAlphaWrap":case "mapAlphaAnisotropy":break;case "flipSided":k.side=THREE.BackSide;break;case "doubleSided":k.side=THREE.DoubleSide;break;case "transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity");k.opacity=n;break;case "depthTest":case "depthWrite":case "colorWrite":case "opacity":case "reflectivity":case "transparent":case "visible":case "wireframe":k[l]=
n;break;case "vertexColors":!0===n&&(k.vertexColors=THREE.VertexColors);"face"===n&&(k.vertexColors=THREE.FaceColors);break;default:console.error("THREE.Loader.createMaterial: Unsupported",l,n)}}"MeshBasicMaterial"===k.type&&delete k.emissive;"MeshPhongMaterial"!==k.type&&delete k.specular;1>k.opacity&&(k.transparent=!0);c.setTextures(h);return c.parse(k)}}()};
THREE.Loader.Handlers={handlers:[],add:function(a,b){this.handlers.push(a,b)},get:function(a){for(var b=this.handlers,c=0,e=b.length;c<e;c+=2){var d=b[c+1];if(b[c].test(a))return d}return null}};THREE.XHRLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(a,b,c,e){void 0!==this.path&&(a=this.path+a);var d=this,g=THREE.Cache.get(a);if(void 0!==g)return b&&setTimeout(function(){b(g)},0),g;var f=new XMLHttpRequest;f.overrideMimeType("text/plain");f.open("GET",a,!0);f.addEventListener("load",function(c){var f=c.target.response;THREE.Cache.add(a,f);200===this.status?(b&&b(f),d.manager.itemEnd(a)):0===this.status?(console.warn("THREE.XHRLoader: HTTP Status 0 received."),b&&b(f),d.manager.itemEnd(a)):
(e&&e(c),d.manager.itemError(a))},!1);void 0!==c&&f.addEventListener("progress",function(a){c(a)},!1);f.addEventListener("error",function(b){e&&e(b);d.manager.itemError(a)},!1);void 0!==this.responseType&&(f.responseType=this.responseType);void 0!==this.withCredentials&&(f.withCredentials=this.withCredentials);f.send(null);d.manager.itemStart(a);return f},setPath:function(a){this.path=a},setResponseType:function(a){this.responseType=a},setWithCredentials:function(a){this.withCredentials=a}};
THREE.FontLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};THREE.FontLoader.prototype={constructor:THREE.FontLoader,load:function(a,b,c,e){(new THREE.XHRLoader(this.manager)).load(a,function(a){b(new THREE.Font(JSON.parse(a.substring(65,a.length-2))))},c,e)}};THREE.ImageLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(a,b,c,e){void 0!==this.path&&(a=this.path+a);var d=this,g=THREE.Cache.get(a);if(void 0!==g)return d.manager.itemStart(a),b?setTimeout(function(){b(g);d.manager.itemEnd(a)},0):d.manager.itemEnd(a),g;var f=document.createElement("img");f.addEventListener("load",function(c){THREE.Cache.add(a,this);b&&b(this);d.manager.itemEnd(a)},!1);void 0!==c&&f.addEventListener("progress",function(a){c(a)},!1);f.addEventListener("error",function(b){e&&
e(b);d.manager.itemError(a)},!1);void 0!==this.crossOrigin&&(f.crossOrigin=this.crossOrigin);d.manager.itemStart(a);f.src=a;return f},setCrossOrigin:function(a){this.crossOrigin=a},setPath:function(a){this.path=a}};THREE.JSONLoader=function(a){"boolean"===typeof a&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),a=void 0);this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.withCredentials=!1};
THREE.JSONLoader.prototype={constructor:THREE.JSONLoader,get statusDomElement(){void 0===this._statusDomElement&&(this._statusDomElement=document.createElement("div"));console.warn("THREE.JSONLoader: .statusDomElement has been removed.");return this._statusDomElement},load:function(a,b,c,e){var d=this,g=this.texturePath&&"string"===typeof this.texturePath?this.texturePath:THREE.Loader.prototype.extractUrlBase(a),f=new THREE.XHRLoader(this.manager);f.setWithCredentials(this.withCredentials);f.load(a,
function(c){c=JSON.parse(c);var e=c.metadata;if(void 0!==e&&(e=e.type,void 0!==e)){if("object"===e.toLowerCase()){console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.ObjectLoader instead.");return}if("scene"===e.toLowerCase()){console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.SceneLoader instead.");return}}c=d.parse(c,g);b(c.geometry,c.materials)},c,e)},setTexturePath:function(a){this.texturePath=a},parse:function(a,b){var c=new THREE.Geometry,e=void 0!==a.scale?1/
a.scale:1;(function(b){var d,e,h,k,l,n,q,m,p,r,u,t,v,x=a.faces;n=a.vertices;var A=a.normals,w=a.colors,D=0;if(void 0!==a.uvs){for(d=0;d<a.uvs.length;d++)a.uvs[d].length&&D++;for(d=0;d<D;d++)c.faceVertexUvs[d]=[]}k=0;for(l=n.length;k<l;)d=new THREE.Vector3,d.x=n[k++]*b,d.y=n[k++]*b,d.z=n[k++]*b,c.vertices.push(d);k=0;for(l=x.length;k<l;)if(b=x[k++],p=b&1,h=b&2,d=b&8,q=b&16,r=b&32,n=b&64,b&=128,p){p=new THREE.Face3;p.a=x[k];p.b=x[k+1];p.c=x[k+3];u=new THREE.Face3;u.a=x[k+1];u.b=x[k+2];u.c=x[k+3];k+=
4;h&&(h=x[k++],p.materialIndex=h,u.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<D;d++)for(t=a.uvs[d],c.faceVertexUvs[d][h]=[],c.faceVertexUvs[d][h+1]=[],e=0;4>e;e++)m=x[k++],v=t[2*m],m=t[2*m+1],v=new THREE.Vector2(v,m),2!==e&&c.faceVertexUvs[d][h].push(v),0!==e&&c.faceVertexUvs[d][h+1].push(v);q&&(q=3*x[k++],p.normal.set(A[q++],A[q++],A[q]),u.normal.copy(p.normal));if(r)for(d=0;4>d;d++)q=3*x[k++],r=new THREE.Vector3(A[q++],A[q++],A[q]),2!==d&&p.vertexNormals.push(r),0!==d&&u.vertexNormals.push(r);
n&&(n=x[k++],n=w[n],p.color.setHex(n),u.color.setHex(n));if(b)for(d=0;4>d;d++)n=x[k++],n=w[n],2!==d&&p.vertexColors.push(new THREE.Color(n)),0!==d&&u.vertexColors.push(new THREE.Color(n));c.faces.push(p);c.faces.push(u)}else{p=new THREE.Face3;p.a=x[k++];p.b=x[k++];p.c=x[k++];h&&(h=x[k++],p.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<D;d++)for(t=a.uvs[d],c.faceVertexUvs[d][h]=[],e=0;3>e;e++)m=x[k++],v=t[2*m],m=t[2*m+1],v=new THREE.Vector2(v,m),c.faceVertexUvs[d][h].push(v);q&&(q=3*x[k++],p.normal.set(A[q++],
A[q++],A[q]));if(r)for(d=0;3>d;d++)q=3*x[k++],r=new THREE.Vector3(A[q++],A[q++],A[q]),p.vertexNormals.push(r);n&&(n=x[k++],p.color.setHex(w[n]));if(b)for(d=0;3>d;d++)n=x[k++],p.vertexColors.push(new THREE.Color(w[n]));c.faces.push(p)}})(e);(function(){var b=void 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var e=0,f=a.skinWeights.length;e<f;e+=b)c.skinWeights.push(new THREE.Vector4(a.skinWeights[e],1<b?a.skinWeights[e+1]:0,2<b?a.skinWeights[e+2]:0,3<b?a.skinWeights[e+3]:
0));if(a.skinIndices)for(e=0,f=a.skinIndices.length;e<f;e+=b)c.skinIndices.push(new THREE.Vector4(a.skinIndices[e],1<b?a.skinIndices[e+1]:0,2<b?a.skinIndices[e+2]:0,3<b?a.skinIndices[e+3]:0));c.bones=a.bones;c.bones&&0<c.bones.length&&(c.skinWeights.length!==c.skinIndices.length||c.skinIndices.length!==c.vertices.length)&&console.warn("When skinning, number of vertices ("+c.vertices.length+"), skinIndices ("+c.skinIndices.length+"), and skinWeights ("+c.skinWeights.length+") should match.")})();(function(b){if(void 0!==
a.morphTargets)for(var d=0,e=a.morphTargets.length;d<e;d++){c.morphTargets[d]={};c.morphTargets[d].name=a.morphTargets[d].name;c.morphTargets[d].vertices=[];for(var h=c.morphTargets[d].vertices,k=a.morphTargets[d].vertices,l=0,n=k.length;l<n;l+=3){var q=new THREE.Vector3;q.x=k[l]*b;q.y=k[l+1]*b;q.z=k[l+2]*b;h.push(q)}}if(void 0!==a.morphColors&&0<a.morphColors.length)for(console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.'),b=c.faces,h=a.morphColors[0].colors,
d=0,e=b.length;d<e;d++)b[d].color.fromArray(h,3*d)})(e);(function(){var b=[],e=[];void 0!==a.animation&&e.push(a.animation);void 0!==a.animations&&(a.animations.length?e=e.concat(a.animations):e.push(a.animations));for(var f=0;f<e.length;f++){var h=THREE.AnimationClip.parseAnimation(e[f],c.bones);h&&b.push(h)}c.morphTargets&&(e=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(c.morphTargets,10),b=b.concat(e));0<b.length&&(c.animations=b)})();c.computeFaceNormals();c.computeBoundingSphere();
if(void 0===a.materials||0===a.materials.length)return{geometry:c};e=THREE.Loader.prototype.initMaterials(a.materials,b,this.crossOrigin);return{geometry:c,materials:e}}};
THREE.LoadingManager=function(a,b,c){var e=this,d=!1,g=0,f=0;this.onStart=void 0;this.onLoad=a;this.onProgress=b;this.onError=c;this.itemStart=function(a){f++;if(!1===d&&void 0!==e.onStart)e.onStart(a,g,f);d=!0};this.itemEnd=function(a){g++;if(void 0!==e.onProgress)e.onProgress(a,g,f);if(g===f&&(d=!1,void 0!==e.onLoad))e.onLoad()};this.itemError=function(a){if(void 0!==e.onError)e.onError(a)}};THREE.DefaultLoadingManager=new THREE.LoadingManager;
THREE.BufferGeometryLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(a,b,c,e){var d=this;(new THREE.XHRLoader(d.manager)).load(a,function(a){b(d.parse(JSON.parse(a)))},c,e)},parse:function(a){var b=new THREE.BufferGeometry,c=a.data.index,e={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};void 0!==c&&(c=
new e[c.type](c.array),b.setIndex(new THREE.BufferAttribute(c,1)));var d=a.data.attributes,g;for(g in d){var f=d[g],c=new e[f.type](f.array);b.addAttribute(g,new THREE.BufferAttribute(c,f.itemSize))}e=a.data.groups||a.data.drawcalls||a.data.offsets;if(void 0!==e)for(g=0,c=e.length;g!==c;++g)d=e[g],b.addGroup(d.start,d.count,d.materialIndex);a=a.data.boundingSphere;void 0!==a&&(e=new THREE.Vector3,void 0!==a.center&&e.fromArray(a.center),b.boundingSphere=new THREE.Sphere(e,a.radius));return b}};
THREE.MaterialLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.textures={}};
THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(a,b,c,e){var d=this;(new THREE.XHRLoader(d.manager)).load(a,function(a){b(d.parse(JSON.parse(a)))},c,e)},setTextures:function(a){this.textures=a},getTexture:function(a){var b=this.textures;void 0===b[a]&&console.warn("THREE.MaterialLoader: Undefined texture",a);return b[a]},parse:function(a){var b=new THREE[a.type];void 0!==a.uuid&&(b.uuid=a.uuid);void 0!==a.name&&(b.name=a.name);void 0!==a.color&&b.color.setHex(a.color);
void 0!==a.roughness&&(b.roughness=a.roughness);void 0!==a.metalness&&(b.metalness=a.metalness);void 0!==a.emissive&&b.emissive.setHex(a.emissive);void 0!==a.specular&&b.specular.setHex(a.specular);void 0!==a.shininess&&(b.shininess=a.shininess);void 0!==a.uniforms&&(b.uniforms=a.uniforms);void 0!==a.vertexShader&&(b.vertexShader=a.vertexShader);void 0!==a.fragmentShader&&(b.fragmentShader=a.fragmentShader);void 0!==a.vertexColors&&(b.vertexColors=a.vertexColors);void 0!==a.shading&&(b.shading=a.shading);
void 0!==a.blending&&(b.blending=a.blending);void 0!==a.side&&(b.side=a.side);void 0!==a.opacity&&(b.opacity=a.opacity);void 0!==a.transparent&&(b.transparent=a.transparent);void 0!==a.alphaTest&&(b.alphaTest=a.alphaTest);void 0!==a.depthTest&&(b.depthTest=a.depthTest);void 0!==a.depthWrite&&(b.depthWrite=a.depthWrite);void 0!==a.colorWrite&&(b.colorWrite=a.colorWrite);void 0!==a.wireframe&&(b.wireframe=a.wireframe);void 0!==a.wireframeLinewidth&&(b.wireframeLinewidth=a.wireframeLinewidth);void 0!==
a.size&&(b.size=a.size);void 0!==a.sizeAttenuation&&(b.sizeAttenuation=a.sizeAttenuation);void 0!==a.map&&(b.map=this.getTexture(a.map));void 0!==a.alphaMap&&(b.alphaMap=this.getTexture(a.alphaMap),b.transparent=!0);void 0!==a.bumpMap&&(b.bumpMap=this.getTexture(a.bumpMap));void 0!==a.bumpScale&&(b.bumpScale=a.bumpScale);void 0!==a.normalMap&&(b.normalMap=this.getTexture(a.normalMap));if(void 0!==a.normalScale){var c=a.normalScale;!1===Array.isArray(c)&&(c=[c,c]);b.normalScale=(new THREE.Vector2).fromArray(c)}void 0!==
a.displacementMap&&(b.displacementMap=this.getTexture(a.displacementMap));void 0!==a.displacementScale&&(b.displacementScale=a.displacementScale);void 0!==a.displacementBias&&(b.displacementBias=a.displacementBias);void 0!==a.roughnessMap&&(b.roughnessMap=this.getTexture(a.roughnessMap));void 0!==a.metalnessMap&&(b.metalnessMap=this.getTexture(a.metalnessMap));void 0!==a.emissiveMap&&(b.emissiveMap=this.getTexture(a.emissiveMap));void 0!==a.emissiveIntensity&&(b.emissiveIntensity=a.emissiveIntensity);
void 0!==a.specularMap&&(b.specularMap=this.getTexture(a.specularMap));void 0!==a.envMap&&(b.envMap=this.getTexture(a.envMap),b.combine=THREE.MultiplyOperation);a.reflectivity&&(b.reflectivity=a.reflectivity);void 0!==a.lightMap&&(b.lightMap=this.getTexture(a.lightMap));void 0!==a.lightMapIntensity&&(b.lightMapIntensity=a.lightMapIntensity);void 0!==a.aoMap&&(b.aoMap=this.getTexture(a.aoMap));void 0!==a.aoMapIntensity&&(b.aoMapIntensity=a.aoMapIntensity);if(void 0!==a.materials)for(var c=0,e=a.materials.length;c<
e;c++)b.materials.push(this.parse(a.materials[c]));return b}};THREE.ObjectLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.texturePath=""};
THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(a,b,c,e){""===this.texturePath&&(this.texturePath=a.substring(0,a.lastIndexOf("/")+1));var d=this;(new THREE.XHRLoader(d.manager)).load(a,function(a){d.parse(JSON.parse(a),b)},c,e)},setTexturePath:function(a){this.texturePath=a},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a,b){var c=this.parseGeometries(a.geometries),e=this.parseImages(a.images,function(){void 0!==b&&b(d)}),e=this.parseTextures(a.textures,
e),e=this.parseMaterials(a.materials,e),d=this.parseObject(a.object,c,e);a.animations&&(d.animations=this.parseAnimations(a.animations));void 0!==a.images&&0!==a.images.length||void 0===b||b(d);return d},parseGeometries:function(a){var b={};if(void 0!==a)for(var c=new THREE.JSONLoader,e=new THREE.BufferGeometryLoader,d=0,g=a.length;d<g;d++){var f,h=a[d];switch(h.type){case "PlaneGeometry":case "PlaneBufferGeometry":f=new THREE[h.type](h.width,h.height,h.widthSegments,h.heightSegments);break;case "BoxGeometry":case "BoxBufferGeometry":case "CubeGeometry":f=
new THREE[h.type](h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case "CircleGeometry":case "CircleBufferGeometry":f=new THREE[h.type](h.radius,h.segments,h.thetaStart,h.thetaLength);break;case "CylinderGeometry":case "CylinderBufferGeometry":f=new THREE[h.type](h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case "SphereGeometry":case "SphereBufferGeometry":f=new THREE[h.type](h.radius,h.widthSegments,
h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case "DodecahedronGeometry":f=new THREE.DodecahedronGeometry(h.radius,h.detail);break;case "IcosahedronGeometry":f=new THREE.IcosahedronGeometry(h.radius,h.detail);break;case "OctahedronGeometry":f=new THREE.OctahedronGeometry(h.radius,h.detail);break;case "TetrahedronGeometry":f=new THREE.TetrahedronGeometry(h.radius,h.detail);break;case "RingGeometry":case "RingBufferGeometry":f=new THREE[h.type](h.innerRadius,h.outerRadius,
h.thetaSegments,h.phiSegments,h.thetaStart,h.thetaLength);break;case "TorusGeometry":case "TorusBufferGeometry":f=new THREE[h.type](h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case "TorusKnotGeometry":case "TorusKnotBufferGeometry":f=new THREE[h.type](h.radius,h.tube,h.tubularSegments,h.radialSegments,h.p,h.q);break;case "LatheGeometry":f=new THREE.LatheGeometry(h.points,h.segments,h.phiStart,h.phiLength);break;case "BufferGeometry":f=e.parse(h);break;case "Geometry":f=c.parse(h.data,
this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+h.type+'"');continue}f.uuid=h.uuid;void 0!==h.name&&(f.name=h.name);b[h.uuid]=f}return b},parseMaterials:function(a,b){var c={};if(void 0!==a){var e=new THREE.MaterialLoader;e.setTextures(b);for(var d=0,g=a.length;d<g;d++){var f=e.parse(a[d]);c[f.uuid]=f}}return c},parseAnimations:function(a){for(var b=[],c=0;c<a.length;c++){var e=THREE.AnimationClip.parse(a[c]);b.push(e)}return b},parseImages:function(a,
b){function c(a){e.manager.itemStart(a);return f.load(a,function(){e.manager.itemEnd(a)})}var e=this,d={};if(void 0!==a&&0<a.length){var g=new THREE.LoadingManager(b),f=new THREE.ImageLoader(g);f.setCrossOrigin(this.crossOrigin);for(var g=0,h=a.length;g<h;g++){var k=a[g],l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(k.url)?k.url:e.texturePath+k.url;d[k.uuid]=c(l)}}return d},parseTextures:function(a,b){function c(a){if("number"===typeof a)return a;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",
a);return THREE[a]}var e={};if(void 0!==a)for(var d=0,g=a.length;d<g;d++){var f=a[d];void 0===f.image&&console.warn('THREE.ObjectLoader: No "image" specified for',f.uuid);void 0===b[f.image]&&console.warn("THREE.ObjectLoader: Undefined image",f.image);var h=new THREE.Texture(b[f.image]);h.needsUpdate=!0;h.uuid=f.uuid;void 0!==f.name&&(h.name=f.name);void 0!==f.mapping&&(h.mapping=c(f.mapping));void 0!==f.offset&&(h.offset=new THREE.Vector2(f.offset[0],f.offset[1]));void 0!==f.repeat&&(h.repeat=new THREE.Vector2(f.repeat[0],
f.repeat[1]));void 0!==f.minFilter&&(h.minFilter=c(f.minFilter));void 0!==f.magFilter&&(h.magFilter=c(f.magFilter));void 0!==f.anisotropy&&(h.anisotropy=f.anisotropy);Array.isArray(f.wrap)&&(h.wrapS=c(f.wrap[0]),h.wrapT=c(f.wrap[1]));e[f.uuid]=h}return e},parseObject:function(){var a=new THREE.Matrix4;return function(b,c,e){function d(a){void 0===c[a]&&console.warn("THREE.ObjectLoader: Undefined geometry",a);return c[a]}function g(a){if(void 0!==a)return void 0===e[a]&&console.warn("THREE.ObjectLoader: Undefined material",
a),e[a]}var f;switch(b.type){case "Scene":f=new THREE.Scene;break;case "PerspectiveCamera":f=new THREE.PerspectiveCamera(b.fov,b.aspect,b.near,b.far);break;case "OrthographicCamera":f=new THREE.OrthographicCamera(b.left,b.right,b.top,b.bottom,b.near,b.far);break;case "AmbientLight":f=new THREE.AmbientLight(b.color,b.intensity);break;case "DirectionalLight":f=new THREE.DirectionalLight(b.color,b.intensity);break;case "PointLight":f=new THREE.PointLight(b.color,b.intensity,b.distance,b.decay);break;
case "SpotLight":f=new THREE.SpotLight(b.color,b.intensity,b.distance,b.angle,b.penumbra,b.decay);break;case "HemisphereLight":f=new THREE.HemisphereLight(b.color,b.groundColor,b.intensity);break;case "Mesh":f=d(b.geometry);var h=g(b.material);f=f.bones&&0<f.bones.length?new THREE.SkinnedMesh(f,h):new THREE.Mesh(f,h);break;case "LOD":f=new THREE.LOD;break;case "Line":f=new THREE.Line(d(b.geometry),g(b.material),b.mode);break;case "PointCloud":case "Points":f=new THREE.Points(d(b.geometry),g(b.material));
break;case "Sprite":f=new THREE.Sprite(g(b.material));break;case "Group":f=new THREE.Group;break;default:f=new THREE.Object3D}f.uuid=b.uuid;void 0!==b.name&&(f.name=b.name);void 0!==b.matrix?(a.fromArray(b.matrix),a.decompose(f.position,f.quaternion,f.scale)):(void 0!==b.position&&f.position.fromArray(b.position),void 0!==b.rotation&&f.rotation.fromArray(b.rotation),void 0!==b.scale&&f.scale.fromArray(b.scale));void 0!==b.castShadow&&(f.castShadow=b.castShadow);void 0!==b.receiveShadow&&(f.receiveShadow=
b.receiveShadow);void 0!==b.visible&&(f.visible=b.visible);void 0!==b.userData&&(f.userData=b.userData);if(void 0!==b.children)for(var k in b.children)f.add(this.parseObject(b.children[k],c,e));if("LOD"===b.type)for(b=b.levels,h=0;h<b.length;h++){var l=b[h];k=f.getObjectByProperty("uuid",l.object);void 0!==k&&f.addLevel(k,l.distance)}return f}}()};THREE.TextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(a,b,c,e){var d=new THREE.Texture,g=new THREE.ImageLoader(this.manager);g.setCrossOrigin(this.crossOrigin);g.setPath(this.path);g.load(a,function(a){d.image=a;d.needsUpdate=!0;void 0!==b&&b(d)},c,e);return d},setCrossOrigin:function(a){this.crossOrigin=a},setPath:function(a){this.path=a}};THREE.CubeTextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
THREE.CubeTextureLoader.prototype={constructor:THREE.CubeTextureLoader,load:function(a,b,c,e){function d(c){f.load(a[c],function(a){g.images[c]=a;h++;6===h&&(g.needsUpdate=!0,b&&b(g))},void 0,e)}var g=new THREE.CubeTexture,f=new THREE.ImageLoader(this.manager);f.setCrossOrigin(this.crossOrigin);f.setPath(this.path);var h=0;for(c=0;c<a.length;++c)d(c);return g},setCrossOrigin:function(a){this.crossOrigin=a},setPath:function(a){this.path=a}};
THREE.DataTextureLoader=THREE.BinaryTextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this._parser=null};
THREE.BinaryTextureLoader.prototype={constructor:THREE.BinaryTextureLoader,load:function(a,b,c,e){var d=this,g=new THREE.DataTexture,f=new THREE.XHRLoader(this.manager);f.setResponseType("arraybuffer");f.load(a,function(a){if(a=d._parser(a))void 0!==a.image?g.image=a.image:void 0!==a.data&&(g.image.width=a.width,g.image.height=a.height,g.image.data=a.data),g.wrapS=void 0!==a.wrapS?a.wrapS:THREE.ClampToEdgeWrapping,g.wrapT=void 0!==a.wrapT?a.wrapT:THREE.ClampToEdgeWrapping,g.magFilter=void 0!==a.magFilter?
a.magFilter:THREE.LinearFilter,g.minFilter=void 0!==a.minFilter?a.minFilter:THREE.LinearMipMapLinearFilter,g.anisotropy=void 0!==a.anisotropy?a.anisotropy:1,void 0!==a.format&&(g.format=a.format),void 0!==a.type&&(g.type=a.type),void 0!==a.mipmaps&&(g.mipmaps=a.mipmaps),1===a.mipmapCount&&(g.minFilter=THREE.LinearFilter),g.needsUpdate=!0,b&&b(g,a)},c,e);return g}};THREE.CompressedTextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this._parser=null};
THREE.CompressedTextureLoader.prototype={constructor:THREE.CompressedTextureLoader,load:function(a,b,c,e){function d(d){k.load(a[d],function(a){a=g._parser(a,!0);f[d]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps};l+=1;6===l&&(1===a.mipmapCount&&(h.minFilter=THREE.LinearFilter),h.format=a.format,h.needsUpdate=!0,b&&b(h))},c,e)}var g=this,f=[],h=new THREE.CompressedTexture;h.image=f;var k=new THREE.XHRLoader(this.manager);k.setPath(this.path);k.setResponseType("arraybuffer");if(Array.isArray(a))for(var l=
0,n=0,q=a.length;n<q;++n)d(n);else k.load(a,function(a){a=g._parser(a,!0);if(a.isCubemap)for(var c=a.mipmaps.length/a.mipmapCount,d=0;d<c;d++){f[d]={mipmaps:[]};for(var e=0;e<a.mipmapCount;e++)f[d].mipmaps.push(a.mipmaps[d*a.mipmapCount+e]),f[d].format=a.format,f[d].width=a.width,f[d].height=a.height}else h.image.width=a.width,h.image.height=a.height,h.mipmaps=a.mipmaps;1===a.mipmapCount&&(h.minFilter=THREE.LinearFilter);h.format=a.format;h.needsUpdate=!0;b&&b(h)},c,e);return h},setPath:function(a){this.path=
a}};
THREE.Material=function(){Object.defineProperty(this,"id",{value:THREE.MaterialIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Material";this.side=THREE.FrontSide;this.opacity=1;this.transparent=!1;this.blending=THREE.NormalBlending;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.depthFunc=THREE.LessEqualDepth;this.colorWrite=this.depthWrite=this.depthTest=
!0;this.precision=null;this.polygonOffset=!1;this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.premultipliedAlpha=!1;this.overdraw=0;this._needsUpdate=this.visible=!0};
THREE.Material.prototype={constructor:THREE.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(a){!0===a&&this.update();this._needsUpdate=a},setValues:function(a){if(void 0!==a)for(var b in a){var c=a[b];if(void 0===c)console.warn("THREE.Material: '"+b+"' parameter is undefined.");else{var e=this[b];void 0===e?console.warn("THREE."+this.type+": '"+b+"' is not a property of this material."):e instanceof THREE.Color?e.set(c):e instanceof THREE.Vector3&&c instanceof THREE.Vector3?e.copy(c):
this[b]="overdraw"===b?Number(c):c}}},toJSON:function(a){function b(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var c=void 0===a;c&&(a={textures:{},images:{}});var e={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};e.uuid=this.uuid;e.type=this.type;""!==this.name&&(e.name=this.name);this.color instanceof THREE.Color&&(e.color=this.color.getHex());.5!==this.roughness&&(e.roughness=this.roughness);.5!==this.metalness&&(e.metalness=this.metalness);this.emissive instanceof
THREE.Color&&(e.emissive=this.emissive.getHex());this.specular instanceof THREE.Color&&(e.specular=this.specular.getHex());void 0!==this.shininess&&(e.shininess=this.shininess);this.map instanceof THREE.Texture&&(e.map=this.map.toJSON(a).uuid);this.alphaMap instanceof THREE.Texture&&(e.alphaMap=this.alphaMap.toJSON(a).uuid);this.lightMap instanceof THREE.Texture&&(e.lightMap=this.lightMap.toJSON(a).uuid);this.bumpMap instanceof THREE.Texture&&(e.bumpMap=this.bumpMap.toJSON(a).uuid,e.bumpScale=this.bumpScale);
this.normalMap instanceof THREE.Texture&&(e.normalMap=this.normalMap.toJSON(a).uuid,e.normalScale=this.normalScale.toArray());this.displacementMap instanceof THREE.Texture&&(e.displacementMap=this.displacementMap.toJSON(a).uuid,e.displacementScale=this.displacementScale,e.displacementBias=this.displacementBias);this.roughnessMap instanceof THREE.Texture&&(e.roughnessMap=this.roughnessMap.toJSON(a).uuid);this.metalnessMap instanceof THREE.Texture&&(e.metalnessMap=this.metalnessMap.toJSON(a).uuid);
this.emissiveMap instanceof THREE.Texture&&(e.emissiveMap=this.emissiveMap.toJSON(a).uuid);this.specularMap instanceof THREE.Texture&&(e.specularMap=this.specularMap.toJSON(a).uuid);this.envMap instanceof THREE.Texture&&(e.envMap=this.envMap.toJSON(a).uuid,e.reflectivity=this.reflectivity);void 0!==this.size&&(e.size=this.size);void 0!==this.sizeAttenuation&&(e.sizeAttenuation=this.sizeAttenuation);void 0!==this.vertexColors&&this.vertexColors!==THREE.NoColors&&(e.vertexColors=this.vertexColors);
void 0!==this.shading&&this.shading!==THREE.SmoothShading&&(e.shading=this.shading);void 0!==this.blending&&this.blending!==THREE.NormalBlending&&(e.blending=this.blending);void 0!==this.side&&this.side!==THREE.FrontSide&&(e.side=this.side);1>this.opacity&&(e.opacity=this.opacity);!0===this.transparent&&(e.transparent=this.transparent);0<this.alphaTest&&(e.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(e.premultipliedAlpha=this.premultipliedAlpha);!0===this.wireframe&&(e.wireframe=this.wireframe);
1<this.wireframeLinewidth&&(e.wireframeLinewidth=this.wireframeLinewidth);c&&(c=b(a.textures),a=b(a.images),0<c.length&&(e.textures=c),0<a.length&&(e.images=a));return e},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.name=a.name;this.side=a.side;this.opacity=a.opacity;this.transparent=a.transparent;this.blending=a.blending;this.blendSrc=a.blendSrc;this.blendDst=a.blendDst;this.blendEquation=a.blendEquation;this.blendSrcAlpha=a.blendSrcAlpha;this.blendDstAlpha=a.blendDstAlpha;
this.blendEquationAlpha=a.blendEquationAlpha;this.depthFunc=a.depthFunc;this.depthTest=a.depthTest;this.depthWrite=a.depthWrite;this.colorWrite=a.colorWrite;this.precision=a.precision;this.polygonOffset=a.polygonOffset;this.polygonOffsetFactor=a.polygonOffsetFactor;this.polygonOffsetUnits=a.polygonOffsetUnits;this.alphaTest=a.alphaTest;this.premultipliedAlpha=a.premultipliedAlpha;this.overdraw=a.overdraw;this.visible=a.visible;return this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};
THREE.EventDispatcher.prototype.apply(THREE.Material.prototype);THREE.MaterialIdCount=0;THREE.LineBasicMaterial=function(a){THREE.Material.call(this);this.type="LineBasicMaterial";this.color=new THREE.Color(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.blending=THREE.NormalBlending;this.vertexColors=THREE.NoColors;this.fog=!0;this.setValues(a)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;
THREE.LineBasicMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.linecap=a.linecap;this.linejoin=a.linejoin;this.vertexColors=a.vertexColors;this.fog=a.fog;return this};
THREE.LineDashedMaterial=function(a){THREE.Material.call(this);this.type="LineDashedMaterial";this.color=new THREE.Color(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.blending=THREE.NormalBlending;this.vertexColors=THREE.NoColors;this.fog=!0;this.setValues(a)};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineDashedMaterial.prototype.constructor=THREE.LineDashedMaterial;
THREE.LineDashedMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.scale=a.scale;this.dashSize=a.dashSize;this.gapSize=a.gapSize;this.vertexColors=a.vertexColors;this.fog=a.fog;return this};
THREE.MeshBasicMaterial=function(a){THREE.Material.call(this);this.type="MeshBasicMaterial";this.color=new THREE.Color(16777215);this.aoMap=this.map=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=!0;this.shading=THREE.SmoothShading;this.blending=THREE.NormalBlending;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=
THREE.NoColors;this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;
THREE.MeshBasicMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.fog=a.fog;this.shading=a.shading;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;
this.wireframeLinejoin=a.wireframeLinejoin;this.vertexColors=a.vertexColors;this.skinning=a.skinning;this.morphTargets=a.morphTargets;return this};
THREE.MeshLambertMaterial=function(a){THREE.Material.call(this);this.type="MeshLambertMaterial";this.color=new THREE.Color(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new THREE.Color(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=!0;this.blending=THREE.NormalBlending;this.wireframe=!1;this.wireframeLinewidth=
1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=THREE.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;
THREE.MeshLambertMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=
a.refractionRatio;this.fog=a.fog;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.vertexColors=a.vertexColors;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};
THREE.MeshPhongMaterial=function(a){THREE.Material.call(this);this.type="MeshPhongMaterial";this.color=new THREE.Color(16777215);this.specular=new THREE.Color(1118481);this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new THREE.Color(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=
0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=!0;this.shading=THREE.SmoothShading;this.blending=THREE.NormalBlending;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=THREE.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;
THREE.MeshPhongMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.specular.copy(a.specular);this.shininess=a.shininess;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);
this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.fog=a.fog;this.shading=a.shading;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.vertexColors=
a.vertexColors;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};
THREE.MeshStandardMaterial=function(a){THREE.Material.call(this);this.type="MeshStandardMaterial";this.color=new THREE.Color(16777215);this.metalness=this.roughness=.5;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new THREE.Color(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=
0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.fog=!0;this.shading=THREE.SmoothShading;this.blending=THREE.NormalBlending;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=THREE.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshStandardMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.MeshStandardMaterial.prototype.constructor=THREE.MeshStandardMaterial;
THREE.MeshStandardMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.roughness=a.roughness;this.metalness=a.metalness;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);
this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.roughnessMap=a.roughnessMap;this.metalnessMap=a.metalnessMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.envMapIntensity=a.envMapIntensity;this.refractionRatio=a.refractionRatio;this.fog=a.fog;this.shading=a.shading;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;
this.vertexColors=a.vertexColors;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};THREE.MeshDepthMaterial=function(a){THREE.Material.call(this);this.type="MeshDepthMaterial";this.wireframe=this.morphTargets=!1;this.wireframeLinewidth=1;this.setValues(a)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;
THREE.MeshDepthMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};THREE.MeshNormalMaterial=function(a){THREE.Material.call(this,a);this.type="MeshNormalMaterial";this.wireframe=!1;this.wireframeLinewidth=1;this.morphTargets=!1;this.setValues(a)};THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;
THREE.MeshNormalMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};THREE.MultiMaterial=function(a){this.uuid=THREE.Math.generateUUID();this.type="MultiMaterial";this.materials=a instanceof Array?a:[];this.visible=!0};
THREE.MultiMaterial.prototype={constructor:THREE.MultiMaterial,toJSON:function(a){for(var b={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},c=this.materials,e=0,d=c.length;e<d;e++){var g=c[e].toJSON(a);delete g.metadata;b.materials.push(g)}b.visible=this.visible;return b},clone:function(){for(var a=new this.constructor,b=0;b<this.materials.length;b++)a.materials.push(this.materials[b].clone());a.visible=this.visible;return a}};
THREE.PointsMaterial=function(a){THREE.Material.call(this);this.type="PointsMaterial";this.color=new THREE.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.blending=THREE.NormalBlending;this.vertexColors=THREE.NoColors;this.fog=!0;this.setValues(a)};THREE.PointsMaterial.prototype=Object.create(THREE.Material.prototype);THREE.PointsMaterial.prototype.constructor=THREE.PointsMaterial;
THREE.PointsMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.size=a.size;this.sizeAttenuation=a.sizeAttenuation;this.vertexColors=a.vertexColors;this.fog=a.fog;return this};
THREE.ShaderMaterial=function(a){THREE.Material.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.shading=THREE.SmoothShading;this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.vertexColors=THREE.NoColors;this.morphNormals=this.morphTargets=
this.skinning=!1;this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;void 0!==a&&(void 0!==a.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(a))};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial;
THREE.ShaderMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.fragmentShader=a.fragmentShader;this.vertexShader=a.vertexShader;this.uniforms=THREE.UniformsUtils.clone(a.uniforms);this.defines=a.defines;this.shading=a.shading;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.fog=a.fog;this.lights=a.lights;this.vertexColors=a.vertexColors;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;this.extensions=
a.extensions;return this};THREE.ShaderMaterial.prototype.toJSON=function(a){a=THREE.Material.prototype.toJSON.call(this,a);a.uniforms=this.uniforms;a.vertexShader=this.vertexShader;a.fragmentShader=this.fragmentShader;return a};THREE.RawShaderMaterial=function(a){THREE.ShaderMaterial.call(this,a);this.type="RawShaderMaterial"};THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);THREE.RawShaderMaterial.prototype.constructor=THREE.RawShaderMaterial;
THREE.SpriteMaterial=function(a){THREE.Material.call(this);this.type="SpriteMaterial";this.color=new THREE.Color(16777215);this.map=null;this.rotation=0;this.fog=!1;this.setValues(a)};THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteMaterial.prototype.constructor=THREE.SpriteMaterial;THREE.SpriteMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.rotation=a.rotation;this.fog=a.fog;return this};
THREE.Texture=function(a,b,c,e,d,g,f,h,k){Object.defineProperty(this,"id",{value:THREE.TextureIdCount++});this.uuid=THREE.Math.generateUUID();this.sourceFile=this.name="";this.image=void 0!==a?a:THREE.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==b?b:THREE.Texture.DEFAULT_MAPPING;this.wrapS=void 0!==c?c:THREE.ClampToEdgeWrapping;this.wrapT=void 0!==e?e:THREE.ClampToEdgeWrapping;this.magFilter=void 0!==d?d:THREE.LinearFilter;this.minFilter=void 0!==g?g:THREE.LinearMipMapLinearFilter;
this.anisotropy=void 0!==k?k:1;this.format=void 0!==f?f:THREE.RGBAFormat;this.type=void 0!==h?h:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=THREE.LinearEncoding;this.version=0;this.onUpdate=null};THREE.Texture.DEFAULT_IMAGE=void 0;THREE.Texture.DEFAULT_MAPPING=THREE.UVMapping;
THREE.Texture.prototype={constructor:THREE.Texture,set needsUpdate(a){!0===a&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.image=a.image;this.mipmaps=a.mipmaps.slice(0);this.mapping=a.mapping;this.wrapS=a.wrapS;this.wrapT=a.wrapT;this.magFilter=a.magFilter;this.minFilter=a.minFilter;this.anisotropy=a.anisotropy;this.format=a.format;this.type=a.type;this.offset.copy(a.offset);this.repeat.copy(a.repeat);this.generateMipmaps=a.generateMipmaps;this.premultiplyAlpha=
a.premultiplyAlpha;this.flipY=a.flipY;this.unpackAlignment=a.unpackAlignment;this.encoding=a.encoding;return this},toJSON:function(a){if(void 0!==a.textures[this.uuid])return a.textures[this.uuid];var b={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};
if(void 0!==this.image){var c=this.image;void 0===c.uuid&&(c.uuid=THREE.Math.generateUUID());if(void 0===a.images[c.uuid]){var e=a.images,d=c.uuid,g=c.uuid,f;void 0!==c.toDataURL?f=c:(f=document.createElement("canvas"),f.width=c.width,f.height=c.height,f.getContext("2d").drawImage(c,0,0,c.width,c.height));f=2048<f.width||2048<f.height?f.toDataURL("image/jpeg",.6):f.toDataURL("image/png");e[d]={uuid:g,url:f}}b.image=c.uuid}return a.textures[this.uuid]=b},dispose:function(){this.dispatchEvent({type:"dispose"})},
transformUv:function(a){if(this.mapping===THREE.UVMapping){a.multiply(this.repeat);a.add(this.offset);if(0>a.x||1<a.x)switch(this.wrapS){case THREE.RepeatWrapping:a.x-=Math.floor(a.x);break;case THREE.ClampToEdgeWrapping:a.x=0>a.x?0:1;break;case THREE.MirroredRepeatWrapping:1===Math.abs(Math.floor(a.x)%2)?a.x=Math.ceil(a.x)-a.x:a.x-=Math.floor(a.x)}if(0>a.y||1<a.y)switch(this.wrapT){case THREE.RepeatWrapping:a.y-=Math.floor(a.y);break;case THREE.ClampToEdgeWrapping:a.y=0>a.y?0:1;break;case THREE.MirroredRepeatWrapping:1===
Math.abs(Math.floor(a.y)%2)?a.y=Math.ceil(a.y)-a.y:a.y-=Math.floor(a.y)}this.flipY&&(a.y=1-a.y)}}};THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype);THREE.TextureIdCount=0;THREE.CanvasTexture=function(a,b,c,e,d,g,f,h,k){THREE.Texture.call(this,a,b,c,e,d,g,f,h,k);this.needsUpdate=!0};THREE.CanvasTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CanvasTexture.prototype.constructor=THREE.CanvasTexture;
THREE.CubeTexture=function(a,b,c,e,d,g,f,h,k){a=void 0!==a?a:[];b=void 0!==b?b:THREE.CubeReflectionMapping;THREE.Texture.call(this,a,b,c,e,d,g,f,h,k);this.flipY=!1};THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CubeTexture.prototype.constructor=THREE.CubeTexture;Object.defineProperty(THREE.CubeTexture.prototype,"images",{get:function(){return this.image},set:function(a){this.image=a}});
THREE.CompressedTexture=function(a,b,c,e,d,g,f,h,k,l,n){THREE.Texture.call(this,null,g,f,h,k,l,e,d,n);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.constructor=THREE.CompressedTexture;
THREE.DataTexture=function(a,b,c,e,d,g,f,h,k,l,n){THREE.Texture.call(this,null,g,f,h,k,l,e,d,n);this.image={data:a,width:b,height:c};this.magFilter=void 0!==k?k:THREE.NearestFilter;this.minFilter=void 0!==l?l:THREE.NearestFilter;this.generateMipmaps=this.flipY=!1};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.constructor=THREE.DataTexture;
THREE.VideoTexture=function(a,b,c,e,d,g,f,h,k){function l(){requestAnimationFrame(l);a.readyState===a.HAVE_ENOUGH_DATA&&(n.needsUpdate=!0)}THREE.Texture.call(this,a,b,c,e,d,g,f,h,k);this.generateMipmaps=!1;var n=this;l()};THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype);THREE.VideoTexture.prototype.constructor=THREE.VideoTexture;THREE.Group=function(){THREE.Object3D.call(this);this.type="Group"};THREE.Group.prototype=Object.create(THREE.Object3D.prototype);
THREE.Group.prototype.constructor=THREE.Group;THREE.Points=function(a,b){THREE.Object3D.call(this);this.type="Points";this.geometry=void 0!==a?a:new THREE.Geometry;this.material=void 0!==b?b:new THREE.PointsMaterial({color:16777215*Math.random()})};THREE.Points.prototype=Object.create(THREE.Object3D.prototype);THREE.Points.prototype.constructor=THREE.Points;
THREE.Points.prototype.raycast=function(){var a=new THREE.Matrix4,b=new THREE.Ray,c=new THREE.Sphere;return function(e,d){function g(a,c){var g=b.distanceSqToPoint(a);if(g<n){var h=b.closestPointToPoint(a);h.applyMatrix4(k);var m=e.ray.origin.distanceTo(h);m<e.near||m>e.far||d.push({distance:m,distanceToRay:Math.sqrt(g),point:h.clone(),index:c,face:null,object:f})}}var f=this,h=this.geometry,k=this.matrixWorld,l=e.params.Points.threshold;null===h.boundingSphere&&h.computeBoundingSphere();c.copy(h.boundingSphere);
c.applyMatrix4(k);if(!1!==e.ray.intersectsSphere(c)){a.getInverse(k);b.copy(e.ray).applyMatrix4(a);var l=l/((this.scale.x+this.scale.y+this.scale.z)/3),n=l*l,l=new THREE.Vector3;if(h instanceof THREE.BufferGeometry){var q=h.index,h=h.attributes.position.array;if(null!==q)for(var m=q.array,q=0,p=m.length;q<p;q++){var r=m[q];l.fromArray(h,3*r);g(l,r)}else for(q=0,m=h.length/3;q<m;q++)l.fromArray(h,3*q),g(l,q)}else for(l=h.vertices,q=0,m=l.length;q<m;q++)g(l[q],q)}}}();
THREE.Points.prototype.clone=function(){return(new this.constructor(this.geometry,this.material)).copy(this)};THREE.Line=function(a,b,c){if(1===c)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new THREE.LineSegments(a,b);THREE.Object3D.call(this);this.type="Line";this.geometry=void 0!==a?a:new THREE.Geometry;this.material=void 0!==b?b:new THREE.LineBasicMaterial({color:16777215*Math.random()})};THREE.Line.prototype=Object.create(THREE.Object3D.prototype);
THREE.Line.prototype.constructor=THREE.Line;
THREE.Line.prototype.raycast=function(){var a=new THREE.Matrix4,b=new THREE.Ray,c=new THREE.Sphere;return function(e,d){var g=e.linePrecision,g=g*g,f=this.geometry,h=this.matrixWorld;null===f.boundingSphere&&f.computeBoundingSphere();c.copy(f.boundingSphere);c.applyMatrix4(h);if(!1!==e.ray.intersectsSphere(c)){a.getInverse(h);b.copy(e.ray).applyMatrix4(a);var k=new THREE.Vector3,l=new THREE.Vector3,h=new THREE.Vector3,n=new THREE.Vector3,q=this instanceof THREE.LineSegments?2:1;if(f instanceof THREE.BufferGeometry){var m=
f.index,p=f.attributes.position.array;if(null!==m)for(var m=m.array,f=0,r=m.length-1;f<r;f+=q){var u=m[f+1];k.fromArray(p,3*m[f]);l.fromArray(p,3*u);u=b.distanceSqToSegment(k,l,n,h);u>g||(n.applyMatrix4(this.matrixWorld),u=e.ray.origin.distanceTo(n),u<e.near||u>e.far||d.push({distance:u,point:h.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}else for(f=0,r=p.length/3-1;f<r;f+=q)k.fromArray(p,3*f),l.fromArray(p,3*f+3),u=b.distanceSqToSegment(k,l,n,h),u>g||(n.applyMatrix4(this.matrixWorld),
u=e.ray.origin.distanceTo(n),u<e.near||u>e.far||d.push({distance:u,point:h.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}else if(f instanceof THREE.Geometry)for(k=f.vertices,l=k.length,f=0;f<l-1;f+=q)u=b.distanceSqToSegment(k[f],k[f+1],n,h),u>g||(n.applyMatrix4(this.matrixWorld),u=e.ray.origin.distanceTo(n),u<e.near||u>e.far||d.push({distance:u,point:h.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}}}();
THREE.Line.prototype.clone=function(){return(new this.constructor(this.geometry,this.material)).copy(this)};THREE.LineStrip=0;THREE.LinePieces=1;THREE.LineSegments=function(a,b){THREE.Line.call(this,a,b);this.type="LineSegments"};THREE.LineSegments.prototype=Object.create(THREE.Line.prototype);THREE.LineSegments.prototype.constructor=THREE.LineSegments;
THREE.Mesh=function(a,b){THREE.Object3D.call(this);this.type="Mesh";this.geometry=void 0!==a?a:new THREE.Geometry;this.material=void 0!==b?b:new THREE.MeshBasicMaterial({color:16777215*Math.random()});this.drawMode=THREE.TrianglesDrawMode;this.updateMorphTargets()};THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.setDrawMode=function(a){this.drawMode=a};
THREE.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}};
THREE.Mesh.prototype.getMorphTargetIndexByName=function(a){if(void 0!==this.morphTargetDictionary[a])return this.morphTargetDictionary[a];console.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};
THREE.Mesh.prototype.raycast=function(){function a(a,b,c,d,e,f,g){THREE.Triangle.barycoordFromPoint(a,b,c,d,u);e.multiplyScalar(u.x);f.multiplyScalar(u.y);g.multiplyScalar(u.z);e.add(f).add(g);return e.clone()}function b(a,b,c,d,e,f,g){var h=a.material;if(null===(h.side===THREE.BackSide?c.intersectTriangle(f,e,d,!0,g):c.intersectTriangle(d,e,f,h.side!==THREE.DoubleSide,g)))return null;v.copy(g);v.applyMatrix4(a.matrixWorld);c=b.ray.origin.distanceTo(v);return c<b.near||c>b.far?null:{distance:c,point:v.clone(),
object:a}}function c(c,d,e,g,l,n,q,u){f.fromArray(g,3*n);h.fromArray(g,3*q);k.fromArray(g,3*u);if(c=b(c,d,e,f,h,k,t))l&&(m.fromArray(l,2*n),p.fromArray(l,2*q),r.fromArray(l,2*u),c.uv=a(t,f,h,k,m,p,r)),c.face=new THREE.Face3(n,q,u,THREE.Triangle.normal(f,h,k)),c.faceIndex=n;return c}var e=new THREE.Matrix4,d=new THREE.Ray,g=new THREE.Sphere,f=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector3,n=new THREE.Vector3,q=new THREE.Vector3,m=new THREE.Vector2,p=new THREE.Vector2,
r=new THREE.Vector2,u=new THREE.Vector3,t=new THREE.Vector3,v=new THREE.Vector3;return function(u,v){var x=this.geometry,A=this.material,B=this.matrixWorld;if(void 0!==A&&(null===x.boundingSphere&&x.computeBoundingSphere(),g.copy(x.boundingSphere),g.applyMatrix4(B),!1!==u.ray.intersectsSphere(g)&&(e.getInverse(B),d.copy(u.ray).applyMatrix4(e),null===x.boundingBox||!1!==d.intersectsBox(x.boundingBox)))){var z,F;if(x instanceof THREE.BufferGeometry){var G,C,A=x.index,B=x.attributes,x=B.position.array;
void 0!==B.uv&&(z=B.uv.array);if(null!==A)for(var B=A.array,L=0,K=B.length;L<K;L+=3){if(A=B[L],G=B[L+1],C=B[L+2],F=c(this,u,d,x,z,A,G,C))F.faceIndex=Math.floor(L/3),v.push(F)}else for(L=0,K=x.length;L<K;L+=9)if(A=L/3,G=A+1,C=A+2,F=c(this,u,d,x,z,A,G,C))F.index=A,v.push(F)}else if(x instanceof THREE.Geometry){var H,M,B=A instanceof THREE.MultiMaterial,L=!0===B?A.materials:null,K=x.vertices;G=x.faces;C=x.faceVertexUvs[0];0<C.length&&(z=C);for(var E=0,J=G.length;E<J;E++){var N=G[E];F=!0===B?L[N.materialIndex]:
A;if(void 0!==F){C=K[N.a];H=K[N.b];M=K[N.c];if(!0===F.morphTargets){F=x.morphTargets;var P=this.morphTargetInfluences;f.set(0,0,0);h.set(0,0,0);k.set(0,0,0);for(var Q=0,O=F.length;Q<O;Q++){var S=P[Q];if(0!==S){var I=F[Q].vertices;f.addScaledVector(l.subVectors(I[N.a],C),S);h.addScaledVector(n.subVectors(I[N.b],H),S);k.addScaledVector(q.subVectors(I[N.c],M),S)}}f.add(C);h.add(H);k.add(M);C=f;H=h;M=k}if(F=b(this,u,d,C,H,M,t))z&&(P=z[E],m.copy(P[0]),p.copy(P[1]),r.copy(P[2]),F.uv=a(t,C,H,M,m,p,r)),F.face=
N,F.faceIndex=E,v.push(F)}}}}}}();THREE.Mesh.prototype.clone=function(){return(new this.constructor(this.geometry,this.material)).copy(this)};THREE.Bone=function(a){THREE.Object3D.call(this);this.type="Bone";this.skin=a};THREE.Bone.prototype=Object.create(THREE.Object3D.prototype);THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.copy=function(a){THREE.Object3D.prototype.copy.call(this,a);this.skin=a.skin;return this};
THREE.Skeleton=function(a,b,c){this.useVertexTexture=void 0!==c?c:!0;this.identityMatrix=new THREE.Matrix4;a=a||[];this.bones=a.slice(0);this.useVertexTexture?(a=Math.sqrt(4*this.bones.length),a=THREE.Math.nextPowerOfTwo(Math.ceil(a)),this.boneTextureHeight=this.boneTextureWidth=Math.max(a,4),this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType)):
this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===b)this.calculateInverses();else if(this.bones.length===b.length)this.boneInverses=b.slice(0);else for(console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[],b=0,a=this.bones.length;b<a;b++)this.boneInverses.push(new THREE.Matrix4)};
THREE.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var a=0,b=this.bones.length;a<b;a++){var c=new THREE.Matrix4;this.bones[a]&&c.getInverse(this.bones[a].matrixWorld);this.boneInverses.push(c)}};
THREE.Skeleton.prototype.pose=function(){for(var a,b=0,c=this.bones.length;b<c;b++)(a=this.bones[b])&&a.matrixWorld.getInverse(this.boneInverses[b]);b=0;for(c=this.bones.length;b<c;b++)if(a=this.bones[b])a.parent?(a.matrix.getInverse(a.parent.matrixWorld),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale)};
THREE.Skeleton.prototype.update=function(){var a=new THREE.Matrix4;return function(){for(var b=0,c=this.bones.length;b<c;b++)a.multiplyMatrices(this.bones[b]?this.bones[b].matrixWorld:this.identityMatrix,this.boneInverses[b]),a.flattenToArrayOffset(this.boneMatrices,16*b);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}();THREE.Skeleton.prototype.clone=function(){return new THREE.Skeleton(this.bones,this.boneInverses,this.useVertexTexture)};
THREE.SkinnedMesh=function(a,b,c){THREE.Mesh.call(this,a,b);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new THREE.Matrix4;this.bindMatrixInverse=new THREE.Matrix4;a=[];if(this.geometry&&void 0!==this.geometry.bones){for(var e,d=0,g=this.geometry.bones.length;d<g;++d)e=this.geometry.bones[d],b=new THREE.Bone(this),a.push(b),b.name=e.name,b.position.fromArray(e.pos),b.quaternion.fromArray(e.rotq),void 0!==e.scl&&b.scale.fromArray(e.scl);d=0;for(g=this.geometry.bones.length;d<g;++d)e=
this.geometry.bones[d],-1!==e.parent&&null!==e.parent?a[e.parent].add(a[d]):this.add(a[d])}this.normalizeSkinWeights();this.updateMatrixWorld(!0);this.bind(new THREE.Skeleton(a,void 0,c),this.matrixWorld)};THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;
THREE.SkinnedMesh.prototype.bind=function(a,b){this.skeleton=a;void 0===b&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),b=this.matrixWorld);this.bindMatrix.copy(b);this.bindMatrixInverse.getInverse(b)};THREE.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()};
THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry)for(var a=0;a<this.geometry.skinWeights.length;a++){var b=this.geometry.skinWeights[a],c=1/b.lengthManhattan();Infinity!==c?b.multiplyScalar(c):b.set(1,0,0,0)}else if(this.geometry instanceof THREE.BufferGeometry)for(var b=new THREE.Vector4,e=this.geometry.attributes.skinWeight,a=0;a<e.count;a++)b.x=e.getX(a),b.y=e.getY(a),b.z=e.getZ(a),b.w=e.getW(a),c=1/b.lengthManhattan(),Infinity!==c?b.multiplyScalar(c):
b.set(1,0,0,0),e.setXYZW(a,b.x,b.y,b.z,b.w)};THREE.SkinnedMesh.prototype.updateMatrixWorld=function(a){THREE.Mesh.prototype.updateMatrixWorld.call(this,!0);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)};THREE.SkinnedMesh.prototype.clone=function(){return(new this.constructor(this.geometry,this.material,this.useVertexTexture)).copy(this)};
THREE.LOD=function(){THREE.Object3D.call(this);this.type="LOD";Object.defineProperties(this,{levels:{enumerable:!0,value:[]},objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}})};THREE.LOD.prototype=Object.create(THREE.Object3D.prototype);THREE.LOD.prototype.constructor=THREE.LOD;
THREE.LOD.prototype.addLevel=function(a,b){void 0===b&&(b=0);b=Math.abs(b);for(var c=this.levels,e=0;e<c.length&&!(b<c[e].distance);e++);c.splice(e,0,{distance:b,object:a});this.add(a)};THREE.LOD.prototype.getObjectForDistance=function(a){for(var b=this.levels,c=1,e=b.length;c<e&&!(a<b[c].distance);c++);return b[c-1].object};
THREE.LOD.prototype.raycast=function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var e=b.ray.origin.distanceTo(a);this.getObjectForDistance(e).raycast(b,c)}}();
THREE.LOD.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){var e=this.levels;if(1<e.length){a.setFromMatrixPosition(c.matrixWorld);b.setFromMatrixPosition(this.matrixWorld);c=a.distanceTo(b);e[0].object.visible=!0;for(var d=1,g=e.length;d<g;d++)if(c>=e[d].distance)e[d-1].object.visible=!1,e[d].object.visible=!0;else break;for(;d<g;d++)e[d].object.visible=!1}}}();
THREE.LOD.prototype.copy=function(a){THREE.Object3D.prototype.copy.call(this,a,!1);a=a.levels;for(var b=0,c=a.length;b<c;b++){var e=a[b];this.addLevel(e.object.clone(),e.distance)}return this};THREE.LOD.prototype.toJSON=function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.levels=[];for(var b=this.levels,c=0,e=b.length;c<e;c++){var d=b[c];a.object.levels.push({object:d.object.uuid,distance:d.distance})}return a};
THREE.Sprite=function(){var a=new Uint16Array([0,1,2,0,2,3]),b=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),c=new Float32Array([0,0,1,0,1,1,0,1]),e=new THREE.BufferGeometry;e.setIndex(new THREE.BufferAttribute(a,1));e.addAttribute("position",new THREE.BufferAttribute(b,3));e.addAttribute("uv",new THREE.BufferAttribute(c,2));return function(a){THREE.Object3D.call(this);this.type="Sprite";this.geometry=e;this.material=void 0!==a?a:new THREE.SpriteMaterial}}();THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype);
THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.raycast=function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var e=b.ray.distanceSqToPoint(a);e>this.scale.x*this.scale.y||c.push({distance:Math.sqrt(e),point:this.position,face:null,object:this})}}();THREE.Sprite.prototype.clone=function(){return(new this.constructor(this.material)).copy(this)};THREE.Particle=THREE.Sprite;
THREE.LensFlare=function(a,b,c,e,d){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=void 0;void 0!==a&&this.add(a,b,c,e,d)};THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare.prototype.constructor=THREE.LensFlare;
THREE.LensFlare.prototype.add=function(a,b,c,e,d,g){void 0===b&&(b=-1);void 0===c&&(c=0);void 0===g&&(g=1);void 0===d&&(d=new THREE.Color(16777215));void 0===e&&(e=THREE.NormalBlending);c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:a,size:b,distance:c,x:0,y:0,z:0,scale:1,rotation:0,opacity:g,color:d,blending:e})};
THREE.LensFlare.prototype.updateLensFlares=function(){var a,b=this.lensFlares.length,c,e=2*-this.positionScreen.x,d=2*-this.positionScreen.y;for(a=0;a<b;a++)c=this.lensFlares[a],c.x=this.positionScreen.x+e*c.distance,c.y=this.positionScreen.y+d*c.distance,c.wantedRotation=c.x*Math.PI*.25,c.rotation+=.25*(c.wantedRotation-c.rotation)};
THREE.LensFlare.prototype.copy=function(a){THREE.Object3D.prototype.copy.call(this,a);this.positionScreen.copy(a.positionScreen);this.customUpdateCallback=a.customUpdateCallback;for(var b=0,c=a.lensFlares.length;b<c;b++)this.lensFlares.push(a.lensFlares[b]);return this};THREE.Scene=function(){THREE.Object3D.call(this);this.type="Scene";this.overrideMaterial=this.fog=null;this.autoUpdate=!0};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.constructor=THREE.Scene;
THREE.Scene.prototype.copy=function(a,b){THREE.Object3D.prototype.copy.call(this,a,b);null!==a.fog&&(this.fog=a.fog.clone());null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone());this.autoUpdate=a.autoUpdate;this.matrixAutoUpdate=a.matrixAutoUpdate;return this};THREE.Fog=function(a,b,c){this.name="";this.color=new THREE.Color(a);this.near=void 0!==b?b:1;this.far=void 0!==c?c:1E3};THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)};
THREE.FogExp2=function(a,b){this.name="";this.color=new THREE.Color(a);this.density=void 0!==b?b:2.5E-4};THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)};THREE.ShaderChunk={};THREE.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n";THREE.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n";THREE.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n";
THREE.ShaderChunk.aomap_fragment="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n";THREE.ShaderChunk.aomap_pars_fragment="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif";
THREE.ShaderChunk.begin_vertex="\nvec3 transformed = vec3( position );\n";THREE.ShaderChunk.beginnormal_vertex="\nvec3 objectNormal = vec3( normal );\n";THREE.ShaderChunk.bsdfs="bool testLightInRange( const in float lightDistance, const in float cutoffDistance ) {\n\treturn any( bvec2( cutoffDistance == 0.0, lightDistance < cutoffDistance ) );\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_Smith( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n";
THREE.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n";
THREE.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif";THREE.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n";THREE.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif";THREE.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif";THREE.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\n";
THREE.ShaderChunk.cube_uv_reflection_fragment="#ifdef ENVMAP_TYPE_CUBE_UV\nconst float cubeUV_textureSize = 1024.0;\nint getFaceFromDirection(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    int face = -1;\n    if( absDirection.x > absDirection.z ) {\n        if(absDirection.x > absDirection.y )\n            face = direction.x > 0.0 ? 0 : 3;\n        else\n            face = direction.y > 0.0 ? 1 : 4;\n    }\n    else {\n        if(absDirection.z > absDirection.y )\n            face = direction.z > 0.0 ? 2 : 5;\n        else\n            face = direction.y > 0.0 ? 1 : 4;\n    }\n    return face;\n}\nconst float cubeUV_maxLods1 = log2(cubeUV_textureSize*0.25) - 1.0;\nconst float cubeUV_rangeClamp = exp2((6.0 - 1.0) * 2.0);\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n    float scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n    float dxRoughness = dFdx(roughness);\n    float dyRoughness = dFdy(roughness);\n    vec3 dx = dFdx( vec * scale * dxRoughness );\n    vec3 dy = dFdy( vec * scale * dyRoughness );\n    float d = max( dot( dx, dx ), dot( dy, dy ) );\n    d = clamp(d, 1.0, cubeUV_rangeClamp);\n    float mipLevel = 0.5 * log2(d);\n    return vec2(floor(mipLevel), fract(mipLevel));\n}\nconst float cubeUV_maxLods2 = log2(cubeUV_textureSize*0.25) - 2.0;\nconst float cubeUV_rcpTextureSize = 1.0 / cubeUV_textureSize;\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n    mipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n    float a = 16.0 * cubeUV_rcpTextureSize;\n    vec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n    vec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n    float powScale = exp2_packed.x * exp2_packed.y;\n    float scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n    float mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n    bool bRes = mipLevel == 0.0;\n    scale =  bRes && (scale < a) ? a : scale;\n    vec3 r;\n    vec2 offset;\n    int face = getFaceFromDirection(direction);\n    float rcpPowScale = 1.0 / powScale;\n    if( face == 0) {\n        r = vec3(direction.x, -direction.z, direction.y);\n        offset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n        offset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n    }\n    else if( face == 1) {\n        r = vec3(direction.y, direction.x, direction.z);\n        offset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n        offset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n    }\n    else if( face == 2) {\n        r = vec3(direction.z, direction.x, direction.y);\n        offset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n        offset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n    }\n    else if( face == 3) {\n        r = vec3(direction.x, direction.z, direction.y);\n        offset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n        offset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n    }\n    else if( face == 4) {\n        r = vec3(direction.y, direction.x, -direction.z);\n        offset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n        offset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n    }\n    else {\n        r = vec3(direction.z, -direction.x, direction.y);\n        offset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n        offset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n    }\n    r = normalize(r);\n    float texelOffset = 0.5 * cubeUV_rcpTextureSize;\n    vec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n    vec2 base = offset + vec2( texelOffset );\n    return base + s * ( scale - 2.0 * texelOffset );\n}\nconst float cubeUV_maxLods3 = log2(cubeUV_textureSize*0.25) - 3.0;\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n    float roughnessVal = roughness* cubeUV_maxLods3;\n    float r1 = floor(roughnessVal);\n    float r2 = r1 + 1.0;\n    float t = fract(roughnessVal);\n    vec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n    float s = mipInfo.y;\n    float level0 = mipInfo.x;\n    float level1 = level0 + 1.0;\n    level1 = level1 > 5.0 ? 5.0 : level1;\n    level0 += min( floor( s + 0.5 ), 5.0 );\n    vec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n    vec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n    vec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n    vec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n    vec4 result = mix(color10, color20, t);\n    return vec4(result.rgb, 1.0);\n}\n#endif\n";
THREE.ShaderChunk.defaultnormal_vertex="#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n";THREE.ShaderChunk.displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n";THREE.ShaderChunk.displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n";
THREE.ShaderChunk.emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n";THREE.ShaderChunk.emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n";THREE.ShaderChunk.encodings_pars_fragment="\nvec4 LinearToLinear( in vec4 value ) {\n  return value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n  float maxComponent = max( max( value.r, value.g ), value.b );\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n  float maxRGB = max( value.x, max( value.g, value.b ) );\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n  M            = ceil( M * 255.0 ) / 255.0;\n  return vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n    float maxRGB = max( value.x, max( value.g, value.b ) );\n    float D      = max( maxRange / maxRGB, 1.0 );\n    D            = min( floor( D ) / 255.0, 1.0 );\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n  vec4 vResult;\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n  vResult.w = fract(Le);\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n  return vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n  float Le = value.z * 255.0 + value.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n  return vec4( max(vRGB, 0.0), 1.0 );\n}\n";
THREE.ShaderChunk.encodings_fragment="  gl_FragColor = linearToOutputTexel( gl_FragColor );\n";THREE.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n";
THREE.ShaderChunk.envmap_pars_fragment="#if defined( USE_ENVMAP ) || defined( STANDARD )\n\tuniform float reflectivity;\n\tuniform float envMapIntenstiy;\n#endif\n#ifdef USE_ENVMAP\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( STANDARD )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n";
THREE.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG ) && ! defined( STANDARD )\n\tvarying vec3 vReflect;\n\tuniform float refractionRatio;\n#endif\n";THREE.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG ) && ! defined( STANDARD )\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t#ifdef ENVMAP_MODE_REFLECTION\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t#else\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t#endif\n#endif\n";
THREE.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n";
THREE.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif";THREE.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n";THREE.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif";
THREE.ShaderChunk.lights_lambert_vertex="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tdirectLight = getPointDirectLightIrradiance( pointLights[ i ], geometry );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tdirectLight = getSpotDirectLightIrradiance( spotLights[ i ], geometry );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectLight = getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n";
THREE.ShaderChunk.lights_pars="uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tIncidentLight getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry ) {\n\t\tIncidentLight directLight;\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t\treturn directLight;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tIncidentLight getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry ) {\n\t\tIncidentLight directLight;\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tif ( testLightInRange( lightDistance, pointLight.distance ) ) {\n\t\t\tdirectLight.color = pointLight.color;\n\t\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t\treturn directLight;\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tIncidentLight getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry ) {\n\t\tIncidentLight directLight;\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( all( bvec2( angleCos > spotLight.coneCos, testLightInRange( lightDistance, spotLight.distance ) ) ) ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t\treturn directLight;\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( STANDARD )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#else\n\t\t\tfloat flipNormal = 1.0;\n\t\t#endif\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#else\n\t\t\tfloat flipNormal = 1.0;\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t#endif\n\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n";
THREE.ShaderChunk.lights_phong_fragment="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n";THREE.ShaderChunk.lights_phong_pars_fragment="#ifdef USE_ENVMAP\n\tvarying vec3 vWorldPosition;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n";
THREE.ShaderChunk.lights_phong_pars_vertex="#ifdef USE_ENVMAP\n\tvarying vec3 vWorldPosition;\n#endif\n";THREE.ShaderChunk.lights_phong_vertex="#ifdef USE_ENVMAP\n\tvWorldPosition = worldPosition.xyz;\n#endif\n";THREE.ShaderChunk.lights_standard_fragment="StandardMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\nmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n";
THREE.ShaderChunk.lights_standard_pars_fragment="struct StandardMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n};\nvoid RE_Direct_Standard( const in IncidentLight directLight, const in GeometricContext geometry, const in StandardMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n}\nvoid RE_IndirectDiffuse_Standard( const in vec3 irradiance, const in GeometricContext geometry, const in StandardMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Standard( const in vec3 radiance, const in GeometricContext geometry, const in StandardMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectSpecular += radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Standard\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Standard\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Standard\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n";
THREE.ShaderChunk.lights_template="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tdirectLight = getPointDirectLightIrradiance( pointLight, geometry );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tdirectLight = getSpotDirectLightIrradiance( spotLight, geometry );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tdirectLight = getDirectionalDirectLightIrradiance( directionalLight, geometry );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t \tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\tRE_IndirectSpecular( radiance, geometry, material, reflectedLight );\n#endif\n";
THREE.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif";THREE.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n";THREE.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif";
THREE.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n";THREE.ShaderChunk.map_fragment="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n";
THREE.ShaderChunk.map_pars_fragment="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n";THREE.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n";THREE.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n";THREE.ShaderChunk.metalnessmap_fragment="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.r;\n#endif\n";
THREE.ShaderChunk.metalnessmap_pars_fragment="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif";THREE.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n";
THREE.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif";THREE.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n";
THREE.ShaderChunk.normal_fragment="#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\t#endif\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n";
THREE.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n";
THREE.ShaderChunk.premultiplied_alpha_fragment="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n";THREE.ShaderChunk.project_vertex="#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n";THREE.ShaderChunk.roughnessmap_fragment="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.r;\n#endif\n";
THREE.ShaderChunk.roughnessmap_pars_fragment="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif";THREE.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\treturn dot( rgba_depth, bit_shift );\n\t}\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n";
THREE.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n";
THREE.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n";
THREE.ShaderChunk.shadowmask_pars_fragment="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n";
THREE.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif";THREE.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n";
THREE.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n";THREE.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n";
THREE.ShaderChunk.specularmap_fragment="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif";THREE.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif";THREE.ShaderChunk.tonemapping_fragment="#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n";
THREE.ShaderChunk.tonemapping_pars_fragment="#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n  return toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  color = max( vec3( 0.0 ), color - 0.004 );\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n";
THREE.ShaderChunk.uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif";THREE.ShaderChunk.uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif";THREE.ShaderChunk.uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif";THREE.ShaderChunk.uv_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif";
THREE.ShaderChunk.uv_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n";THREE.ShaderChunk.uv_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif";
THREE.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( STANDARD ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n";
THREE.UniformsUtils={merge:function(a){for(var b={},c=0;c<a.length;c++){var e=this.clone(a[c]),d;for(d in e)b[d]=e[d]}return b},clone:function(a){var b={},c;for(c in a){b[c]={};for(var e in a[c]){var d=a[c][e];d instanceof THREE.Color||d instanceof THREE.Vector2||d instanceof THREE.Vector3||d instanceof THREE.Vector4||d instanceof THREE.Matrix3||d instanceof THREE.Matrix4||d instanceof THREE.Texture?b[c][e]=d.clone():Array.isArray(d)?b[c][e]=d.slice():b[c][e]=d}}return b}};
THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98}},aomap:{aoMap:{type:"t",value:null},aoMapIntensity:{type:"f",value:1}},lightmap:{lightMap:{type:"t",value:null},lightMapIntensity:{type:"f",
value:1}},emissivemap:{emissiveMap:{type:"t",value:null}},bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},displacementmap:{displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:1},displacementBias:{type:"f",value:0}},roughnessmap:{roughnessMap:{type:"t",value:null}},metalnessmap:{metalnessMap:{type:"t",value:null}},fog:{fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",
value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLights:{type:"sa",value:[],properties:{direction:{type:"v3"},color:{type:"c"},shadow:{type:"i"},shadowBias:{type:"f"},shadowRadius:{type:"f"},shadowMapSize:{type:"v2"}}},directionalShadowMap:{type:"tv",value:[]},directionalShadowMatrix:{type:"m4v",value:[]},spotLights:{type:"sa",value:[],properties:{color:{type:"c"},position:{type:"v3"},direction:{type:"v3"},
distance:{type:"f"},coneCos:{type:"f"},penumbraCos:{type:"f"},decay:{type:"f"},shadow:{type:"i"},shadowBias:{type:"f"},shadowRadius:{type:"f"},shadowMapSize:{type:"v2"}}},spotShadowMap:{type:"tv",value:[]},spotShadowMatrix:{type:"m4v",value:[]},pointLights:{type:"sa",value:[],properties:{color:{type:"c"},position:{type:"v3"},decay:{type:"f"},distance:{type:"f"},shadow:{type:"i"},shadowBias:{type:"f"},shadowRadius:{type:"f"},shadowMapSize:{type:"v2"}}},pointShadowMap:{type:"tv",value:[]},pointShadowMatrix:{type:"m4v",
value:[]},hemisphereLights:{type:"sa",value:[],properties:{direction:{type:"v3"},skyColor:{type:"c"},groundColor:{type:"c"}}}},points:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)}}};THREE.ShaderChunk.cube_frag="uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\t#include <logdepthbuf_fragment>\n}\n";
THREE.ShaderChunk.cube_vert="varying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t#include <logdepthbuf_vertex>\n}\n";THREE.ShaderChunk.depth_frag="uniform float mNear;\nuniform float mFar;\nuniform float opacity;\n#include <common>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );\n\tgl_FragColor = vec4( vec3( color ), opacity );\n}\n";
THREE.ShaderChunk.depth_vert="#include <common>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n}\n";THREE.ShaderChunk.depthRGBA_frag="#include <common>\n#include <logdepthbuf_pars_fragment>\nvec4 pack_depth( const in float depth ) {\n\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\n\t#else\n\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n\t#endif\n}\n";
THREE.ShaderChunk.depthRGBA_vert="#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n}\n";THREE.ShaderChunk.distanceRGBA_frag="uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\nvec4 pack1K ( float depth ) {\n\tdepth /= 1000.0;\n\tconst vec4 bitSh = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n\tconst vec4 bitMsk = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\tvec4 res = mod( depth * bitSh * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n\tres -= res.xxyz * bitMsk;\n\treturn res;\n}\nfloat unpack1K ( vec4 color ) {\n\tconst vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\treturn dot( color, bitSh ) * 1000.0;\n}\nvoid main () {\n\tgl_FragColor = pack1K( length( vWorldPosition.xyz - lightPos.xyz ) );\n}\n";
THREE.ShaderChunk.distanceRGBA_vert="varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\tvWorldPosition = worldPosition;\n}\n";THREE.ShaderChunk.equirect_frag="uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <logdepthbuf_fragment>\n}\n";
THREE.ShaderChunk.equirect_vert="varying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t#include <logdepthbuf_vertex>\n}\n";THREE.ShaderChunk.linedashed_frag="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
THREE.ShaderChunk.linedashed_vert="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n}\n";THREE.ShaderChunk.meshbasic_frag="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight;\n\treflectedLight.directDiffuse = vec3( 0.0 );\n\treflectedLight.directSpecular = vec3( 0.0 );\n\treflectedLight.indirectDiffuse = diffuseColor.rgb;\n\treflectedLight.indirectSpecular = vec3( 0.0 );\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
THREE.ShaderChunk.meshbasic_vert="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n}\n";
THREE.ShaderChunk.meshlambert_frag="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
THREE.ShaderChunk.meshlambert_vert="#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n}\n";
THREE.ShaderChunk.meshphong_frag="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
THREE.ShaderChunk.meshphong_vert="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <lights_phong_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_phong_vertex>\n\t#include <shadowmap_vertex>\n}\n";
THREE.ShaderChunk.meshstandard_frag="#define STANDARD\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float envMapIntensity;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_standard_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_standard_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
THREE.ShaderChunk.meshstandard_vert="#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n}\n";
THREE.ShaderChunk.normal_frag="uniform float opacity;\nvarying vec3 vNormal;\n#include <common>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n\t#include <logdepthbuf_fragment>\n}\n";THREE.ShaderChunk.normal_vert="varying vec3 vNormal;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\tvNormal = normalize( normalMatrix * normal );\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n}\n";
THREE.ShaderChunk.points_frag="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
THREE.ShaderChunk.points_vert="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n";
THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.fog]),vertexShader:THREE.ShaderChunk.meshbasic_vert,fragmentShader:THREE.ShaderChunk.meshbasic_frag},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{type:"c",value:new THREE.Color(0)}}]),vertexShader:THREE.ShaderChunk.meshlambert_vert,
fragmentShader:THREE.ShaderChunk.meshlambert_frag},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.bumpmap,THREE.UniformsLib.normalmap,THREE.UniformsLib.displacementmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:THREE.ShaderChunk.meshphong_vert,
fragmentShader:THREE.ShaderChunk.meshphong_frag},standard:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.bumpmap,THREE.UniformsLib.normalmap,THREE.UniformsLib.displacementmap,THREE.UniformsLib.roughnessmap,THREE.UniformsLib.metalnessmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{type:"c",value:new THREE.Color(0)},roughness:{type:"f",value:.5},metalness:{type:"f",value:0},
envMapIntensity:{type:"f",value:1}}]),vertexShader:THREE.ShaderChunk.meshstandard_vert,fragmentShader:THREE.ShaderChunk.meshstandard_frag},points:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.points,THREE.UniformsLib.fog]),vertexShader:THREE.ShaderChunk.points_vert,fragmentShader:THREE.ShaderChunk.points_frag},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:THREE.ShaderChunk.linedashed_vert,
fragmentShader:THREE.ShaderChunk.linedashed_frag},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2E3},opacity:{type:"f",value:1}},vertexShader:THREE.ShaderChunk.depth_vert,fragmentShader:THREE.ShaderChunk.depth_frag},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:THREE.ShaderChunk.normal_vert,fragmentShader:THREE.ShaderChunk.normal_frag},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:THREE.ShaderChunk.cube_vert,fragmentShader:THREE.ShaderChunk.cube_frag},
equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:THREE.ShaderChunk.equirect_vert,fragmentShader:THREE.ShaderChunk.equirect_frag},depthRGBA:{uniforms:{},vertexShader:THREE.ShaderChunk.depthRGBA_vert,fragmentShader:THREE.ShaderChunk.depthRGBA_frag},distanceRGBA:{uniforms:{lightPos:{type:"v3",value:new THREE.Vector3(0,0,0)}},vertexShader:THREE.ShaderChunk.distanceRGBA_vert,fragmentShader:THREE.ShaderChunk.distanceRGBA_frag}};
THREE.WebGLRenderer=function(a){function b(a,b,c,d){!0===Q&&(a*=d,b*=d,c*=d);W.clearColor(a,b,c,d)}function c(){W.init();W.scissor(ga.copy(oa).multiplyScalar(sa));W.viewport(pa.copy(wa).multiplyScalar(sa));b(ma.r,ma.g,ma.b,na)}function e(){ha=Y=null;la="";ca=-1;W.reset()}function d(a){a.preventDefault();e();c();ja.clear()}function g(a){a=a.target;a.removeEventListener("dispose",g);a:{var b=ja.get(a);if(a.image&&b.__image__webglTextureCube)y.deleteTexture(b.__image__webglTextureCube);else{if(void 0===
b.__webglInit)break a;y.deleteTexture(b.__webglTexture)}ja["delete"](a)}Ka.textures--}function f(a){a=a.target;a.removeEventListener("dispose",f);var b=ja.get(a),c=ja.get(a.texture);if(a&&void 0!==c.__webglTexture){y.deleteTexture(c.__webglTexture);if(a instanceof THREE.WebGLRenderTargetCube)for(c=0;6>c;c++)y.deleteFramebuffer(b.__webglFramebuffer[c]),y.deleteRenderbuffer(b.__webglDepthbuffer[c]);else y.deleteFramebuffer(b.__webglFramebuffer),y.deleteRenderbuffer(b.__webglDepthbuffer);ja["delete"](a.texture);
ja["delete"](a)}Ka.textures--}function h(a){a=a.target;a.removeEventListener("dispose",h);k(a);ja["delete"](a)}function k(a){var b=ja.get(a).program;a.program=void 0;void 0!==b&&Ha.releaseProgram(b)}function l(a,b){return Math.abs(b[0])-Math.abs(a[0])}function n(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function q(a,b){return a.object.renderOrder!==b.object.renderOrder?
a.object.renderOrder-b.object.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function m(a,b,c,d,e){var f;c.transparent?(d=R,f=++V):(d=I,f=++ba);f=d[f];void 0!==f?(f.id=a.id,f.object=a,f.geometry=b,f.material=c,f.z=ua.z,f.group=e):(f={id:a.id,object:a,geometry:b,material:c,z:ua.z,group:e},d.push(f))}function p(a,b){if(!1!==a.visible){if(a.layers.test(b.layers))if(a instanceof THREE.Light)S.push(a);else if(a instanceof THREE.Sprite)!1!==a.frustumCulled&&!0!==Ja.intersectsObject(a)||aa.push(a);else if(a instanceof
THREE.LensFlare)U.push(a);else if(a instanceof THREE.ImmediateRenderObject)!0===T.sortObjects&&(ua.setFromMatrixPosition(a.matrixWorld),ua.applyProjection(Na)),m(a,null,a.material,ua.z,null);else if(a instanceof THREE.Mesh||a instanceof THREE.Line||a instanceof THREE.Points)if(a instanceof THREE.SkinnedMesh&&a.skeleton.update(),!1===a.frustumCulled||!0===Ja.intersectsObject(a)){var c=a.material;if(!0===c.visible){!0===T.sortObjects&&(ua.setFromMatrixPosition(a.matrixWorld),ua.applyProjection(Na));
var d=La.update(a);if(c instanceof THREE.MultiMaterial)for(var e=d.groups,f=c.materials,c=0,g=e.length;c<g;c++){var h=e[c],k=f[h.materialIndex];!0===k.visible&&m(a,d,k,ua.z,h)}else m(a,d,c,ua.z,null)}}d=a.children;c=0;for(g=d.length;c<g;c++)p(d[c],b)}}function r(a,b,c,d){for(var e=0,f=a.length;e<f;e++){var g=a[e],h=g.object,m=g.geometry,k=void 0===d?g.material:d,g=g.group;h.modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,h.matrixWorld);h.normalMatrix.getNormalMatrix(h.modelViewMatrix);if(h instanceof
THREE.ImmediateRenderObject){u(k);var l=t(b,c,k,h);la="";h.render(function(a){T.renderBufferImmediate(a,l,k)})}else T.renderBufferDirect(b,c,m,k,h,g)}}function u(a){a.side!==THREE.DoubleSide?W.enable(y.CULL_FACE):W.disable(y.CULL_FACE);W.setFlipSided(a.side===THREE.BackSide);!0===a.transparent?W.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,a.blendSrcAlpha,a.blendDstAlpha,a.premultipliedAlpha):W.setBlending(THREE.NoBlending);W.setDepthFunc(a.depthFunc);W.setDepthTest(a.depthTest);
W.setDepthWrite(a.depthWrite);W.setColorWrite(a.colorWrite);W.setPolygonOffset(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}function t(a,b,c,d){va=0;var e=ja.get(c);void 0===e.program&&(c.needsUpdate=!0);void 0!==e.lightsHash&&e.lightsHash!==Z.hash&&(c.needsUpdate=!0);if(c.needsUpdate){a:{var f=ja.get(c),g=Ha.getParameters(c,Z,b,d),m=Ha.getProgramCode(c,g),l=f.program,p=!0;if(void 0===l)c.addEventListener("dispose",h);else if(l.code!==m)k(c);else if(void 0!==g.shaderID)break a;else p=
!1;p&&(g.shaderID?(l=THREE.ShaderLib[g.shaderID],f.__webglShader={name:c.type,uniforms:THREE.UniformsUtils.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}):f.__webglShader={name:c.type,uniforms:c.uniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader},c.__webglShader=f.__webglShader,l=Ha.acquireProgram(c,g,m),f.program=l,c.program=l);g=l.getAttributes();if(c.morphTargets)for(m=c.numSupportedMorphTargets=0;m<T.maxMorphTargets;m++)0<=g["morphTarget"+m]&&
c.numSupportedMorphTargets++;if(c.morphNormals)for(m=c.numSupportedMorphNormals=0;m<T.maxMorphNormals;m++)0<=g["morphNormal"+m]&&c.numSupportedMorphNormals++;f.uniformsList=[];var g=f.__webglShader.uniforms,m=f.program.getUniforms(),r;for(r in g)(l=m[r])&&f.uniformsList.push([f.__webglShader.uniforms[r],l]);if(c instanceof THREE.MeshPhongMaterial||c instanceof THREE.MeshLambertMaterial||c instanceof THREE.MeshStandardMaterial||c.lights)f.lightsHash=Z.hash,g.ambientLightColor.value=Z.ambient,g.directionalLights.value=
Z.directional,g.spotLights.value=Z.spot,g.pointLights.value=Z.point,g.hemisphereLights.value=Z.hemi,g.directionalShadowMap.value=Z.directionalShadowMap,g.directionalShadowMatrix.value=Z.directionalShadowMatrix,g.spotShadowMap.value=Z.spotShadowMap,g.spotShadowMatrix.value=Z.spotShadowMatrix,g.pointShadowMap.value=Z.pointShadowMap,g.pointShadowMatrix.value=Z.pointShadowMatrix;f.hasDynamicUniforms=!1;r=0;for(g=f.uniformsList.length;r<g;r++)if(!0===f.uniformsList[r][0].dynamic){f.hasDynamicUniforms=
!0;break}}c.needsUpdate=!1}l=m=p=!1;f=e.program;r=f.getUniforms();g=e.__webglShader.uniforms;f.id!==Y&&(y.useProgram(f.program),Y=f.id,l=m=p=!0);c.id!==ca&&(ca=c.id,m=!0);if(p||a!==ha)y.uniformMatrix4fv(r.projectionMatrix,!1,a.projectionMatrix.elements),xa.logarithmicDepthBuffer&&y.uniform1f(r.logDepthBufFC,2/(Math.log(a.far+1)/Math.LN2)),a!==ha&&(ha=a,l=m=!0),(c instanceof THREE.ShaderMaterial||c instanceof THREE.MeshPhongMaterial||c instanceof THREE.MeshStandardMaterial||c.envMap)&&void 0!==r.cameraPosition&&
(ua.setFromMatrixPosition(a.matrixWorld),y.uniform3f(r.cameraPosition,ua.x,ua.y,ua.z)),(c instanceof THREE.MeshPhongMaterial||c instanceof THREE.MeshLambertMaterial||c instanceof THREE.MeshBasicMaterial||c instanceof THREE.MeshStandardMaterial||c instanceof THREE.ShaderMaterial||c.skinning)&&void 0!==r.viewMatrix&&y.uniformMatrix4fv(r.viewMatrix,!1,a.matrixWorldInverse.elements),void 0!==r.toneMappingExposure&&y.uniform1f(r.toneMappingExposure,T.toneMappingExposure),void 0!==r.toneMappingWhitePoint&&
y.uniform1f(r.toneMappingWhitePoint,T.toneMappingWhitePoint);c.skinning&&(d.bindMatrix&&void 0!==r.bindMatrix&&y.uniformMatrix4fv(r.bindMatrix,!1,d.bindMatrix.elements),d.bindMatrixInverse&&void 0!==r.bindMatrixInverse&&y.uniformMatrix4fv(r.bindMatrixInverse,!1,d.bindMatrixInverse.elements),xa.floatVertexTextures&&d.skeleton&&d.skeleton.useVertexTexture?(void 0!==r.boneTexture&&(p=v(),y.uniform1i(r.boneTexture,p),T.setTexture(d.skeleton.boneTexture,p)),void 0!==r.boneTextureWidth&&y.uniform1i(r.boneTextureWidth,
d.skeleton.boneTextureWidth),void 0!==r.boneTextureHeight&&y.uniform1i(r.boneTextureHeight,d.skeleton.boneTextureHeight)):d.skeleton&&d.skeleton.boneMatrices&&void 0!==r.boneGlobalMatrices&&y.uniformMatrix4fv(r.boneGlobalMatrices,!1,d.skeleton.boneMatrices));if(m){if(c instanceof THREE.MeshPhongMaterial||c instanceof THREE.MeshLambertMaterial||c instanceof THREE.MeshStandardMaterial||c.lights)m=l,g.ambientLightColor.needsUpdate=m,g.directionalLights.needsUpdate=m,g.pointLights.needsUpdate=m,g.spotLights.needsUpdate=
m,g.hemisphereLights.needsUpdate=m;b&&c.fog&&(g.fogColor.value=b.color,b instanceof THREE.Fog?(g.fogNear.value=b.near,g.fogFar.value=b.far):b instanceof THREE.FogExp2&&(g.fogDensity.value=b.density));if(c instanceof THREE.MeshBasicMaterial||c instanceof THREE.MeshLambertMaterial||c instanceof THREE.MeshPhongMaterial||c instanceof THREE.MeshStandardMaterial){g.opacity.value=c.opacity;g.diffuse.value=c.color;c.emissive&&g.emissive.value.copy(c.emissive).multiplyScalar(c.emissiveIntensity);g.map.value=
c.map;g.specularMap.value=c.specularMap;g.alphaMap.value=c.alphaMap;c.aoMap&&(g.aoMap.value=c.aoMap,g.aoMapIntensity.value=c.aoMapIntensity);var n;c.map?n=c.map:c.specularMap?n=c.specularMap:c.displacementMap?n=c.displacementMap:c.normalMap?n=c.normalMap:c.bumpMap?n=c.bumpMap:c.roughnessMap?n=c.roughnessMap:c.metalnessMap?n=c.metalnessMap:c.alphaMap?n=c.alphaMap:c.emissiveMap&&(n=c.emissiveMap);void 0!==n&&(n instanceof THREE.WebGLRenderTarget&&(n=n.texture),b=n.offset,n=n.repeat,g.offsetRepeat.value.set(b.x,
b.y,n.x,n.y));g.envMap.value=c.envMap;g.flipEnvMap.value=c.envMap instanceof THREE.WebGLRenderTargetCube?1:-1;g.reflectivity.value=c.reflectivity;g.refractionRatio.value=c.refractionRatio}c instanceof THREE.LineBasicMaterial?(g.diffuse.value=c.color,g.opacity.value=c.opacity):c instanceof THREE.LineDashedMaterial?(g.diffuse.value=c.color,g.opacity.value=c.opacity,g.dashSize.value=c.dashSize,g.totalSize.value=c.dashSize+c.gapSize,g.scale.value=c.scale):c instanceof THREE.PointsMaterial?(g.diffuse.value=
c.color,g.opacity.value=c.opacity,g.size.value=c.size*sa,g.scale.value=H.clientHeight/2,g.map.value=c.map,null!==c.map&&(n=c.map.offset,c=c.map.repeat,g.offsetRepeat.value.set(n.x,n.y,c.x,c.y))):c instanceof THREE.MeshLambertMaterial?(c.lightMap&&(g.lightMap.value=c.lightMap,g.lightMapIntensity.value=c.lightMapIntensity),c.emissiveMap&&(g.emissiveMap.value=c.emissiveMap)):c instanceof THREE.MeshPhongMaterial?(g.specular.value=c.specular,g.shininess.value=Math.max(c.shininess,1E-4),c.lightMap&&(g.lightMap.value=
c.lightMap,g.lightMapIntensity.value=c.lightMapIntensity),c.emissiveMap&&(g.emissiveMap.value=c.emissiveMap),c.bumpMap&&(g.bumpMap.value=c.bumpMap,g.bumpScale.value=c.bumpScale),c.normalMap&&(g.normalMap.value=c.normalMap,g.normalScale.value.copy(c.normalScale)),c.displacementMap&&(g.displacementMap.value=c.displacementMap,g.displacementScale.value=c.displacementScale,g.displacementBias.value=c.displacementBias)):c instanceof THREE.MeshStandardMaterial?(g.roughness.value=c.roughness,g.metalness.value=
c.metalness,c.roughnessMap&&(g.roughnessMap.value=c.roughnessMap),c.metalnessMap&&(g.metalnessMap.value=c.metalnessMap),c.lightMap&&(g.lightMap.value=c.lightMap,g.lightMapIntensity.value=c.lightMapIntensity),c.emissiveMap&&(g.emissiveMap.value=c.emissiveMap),c.bumpMap&&(g.bumpMap.value=c.bumpMap,g.bumpScale.value=c.bumpScale),c.normalMap&&(g.normalMap.value=c.normalMap,g.normalScale.value.copy(c.normalScale)),c.displacementMap&&(g.displacementMap.value=c.displacementMap,g.displacementScale.value=
c.displacementScale,g.displacementBias.value=c.displacementBias),c.envMap&&(g.envMapIntensity.value=c.envMapIntensity)):c instanceof THREE.MeshDepthMaterial?(g.mNear.value=a.near,g.mFar.value=a.far,g.opacity.value=c.opacity):c instanceof THREE.MeshNormalMaterial&&(g.opacity.value=c.opacity);A(e.uniformsList)}y.uniformMatrix4fv(r.modelViewMatrix,!1,d.modelViewMatrix.elements);r.normalMatrix&&y.uniformMatrix3fv(r.normalMatrix,!1,d.normalMatrix.elements);void 0!==r.modelMatrix&&y.uniformMatrix4fv(r.modelMatrix,
!1,d.matrixWorld.elements);if(!0===e.hasDynamicUniforms){e=e.uniformsList;c=[];n=0;for(b=e.length;n<b;n++)r=e[n][0],g=r.onUpdateCallback,void 0!==g&&(g.bind(r)(d,a),c.push(e[n]));A(c)}return f}function v(){var a=va;a>=xa.maxTextures&&console.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+xa.maxTextures);va+=1;return a}function x(a,b,c,d){var e;if("1i"===b)y.uniform1i(c,d);else if("1f"===b)y.uniform1f(c,d);else if("2f"===b)y.uniform2f(c,d[0],d[1]);else if("3f"===
b)y.uniform3f(c,d[0],d[1],d[2]);else if("4f"===b)y.uniform4f(c,d[0],d[1],d[2],d[3]);else if("1iv"===b)y.uniform1iv(c,d);else if("3iv"===b)y.uniform3iv(c,d);else if("1fv"===b)y.uniform1fv(c,d);else if("2fv"===b)y.uniform2fv(c,d);else if("3fv"===b)y.uniform3fv(c,d);else if("4fv"===b)y.uniform4fv(c,d);else if("Matrix2fv"===b)y.uniformMatrix2fv(c,!1,d);else if("Matrix3fv"===b)y.uniformMatrix3fv(c,!1,d);else if("Matrix4fv"===b)y.uniformMatrix4fv(c,!1,d);else if("i"===b)y.uniform1i(c,d);else if("f"===b)y.uniform1f(c,
d);else if("v2"===b)y.uniform2f(c,d.x,d.y);else if("v3"===b)y.uniform3f(c,d.x,d.y,d.z);else if("v4"===b)y.uniform4f(c,d.x,d.y,d.z,d.w);else if("c"===b)y.uniform3f(c,d.r,d.g,d.b);else if("s"===b){a=a.properties;for(var f in a){e=a[f];var g=c[f],h=d[f];x(e,e.type,g,h)}}else if("sa"===b){a=a.properties;b=0;for(var m=d.length;b<m;b++)for(f in a)e=a[f],g=c[b][f],h=d[b][f],x(e,e.type,g,h)}else if("iv1"===b)y.uniform1iv(c,d);else if("iv"===b)y.uniform3iv(c,d);else if("fv1"===b)y.uniform1fv(c,d);else if("fv"===
b)y.uniform3fv(c,d);else if("v2v"===b){void 0===a._array&&(a._array=new Float32Array(2*d.length));e=b=0;for(f=d.length;b<f;b++,e+=2)a._array[e+0]=d[b].x,a._array[e+1]=d[b].y;y.uniform2fv(c,a._array)}else if("v3v"===b){void 0===a._array&&(a._array=new Float32Array(3*d.length));e=b=0;for(f=d.length;b<f;b++,e+=3)a._array[e+0]=d[b].x,a._array[e+1]=d[b].y,a._array[e+2]=d[b].z;y.uniform3fv(c,a._array)}else if("v4v"===b){void 0===a._array&&(a._array=new Float32Array(4*d.length));e=b=0;for(f=d.length;b<f;b++,
e+=4)a._array[e+0]=d[b].x,a._array[e+1]=d[b].y,a._array[e+2]=d[b].z,a._array[e+3]=d[b].w;y.uniform4fv(c,a._array)}else if("m2"===b)y.uniformMatrix2fv(c,!1,d.elements);else if("m3"===b)y.uniformMatrix3fv(c,!1,d.elements);else if("m3v"===b){void 0===a._array&&(a._array=new Float32Array(9*d.length));b=0;for(f=d.length;b<f;b++)d[b].flattenToArrayOffset(a._array,9*b);y.uniformMatrix3fv(c,!1,a._array)}else if("m4"===b)y.uniformMatrix4fv(c,!1,d.elements);else if("m4v"===b){void 0===a._array&&(a._array=new Float32Array(16*
d.length));b=0;for(f=d.length;b<f;b++)d[b].flattenToArrayOffset(a._array,16*b);y.uniformMatrix4fv(c,!1,a._array)}else if("t"===b)e=v(),y.uniform1i(c,e),d&&(d instanceof THREE.CubeTexture||Array.isArray(d.image)&&6===d.image.length?z(d,e):d instanceof THREE.WebGLRenderTargetCube?F(d.texture,e):d instanceof THREE.WebGLRenderTarget?T.setTexture(d.texture,e):T.setTexture(d,e));else if("tv"===b){void 0===a._array&&(a._array=[]);b=0;for(f=a.value.length;b<f;b++)a._array[b]=v();y.uniform1iv(c,a._array);
b=0;for(f=a.value.length;b<f;b++)d=a.value[b],e=a._array[b],d&&(d instanceof THREE.CubeTexture||d.image instanceof Array&&6===d.image.length?z(d,e):d instanceof THREE.WebGLRenderTarget?T.setTexture(d.texture,e):d instanceof THREE.WebGLRenderTargetCube?F(d.texture,e):T.setTexture(d,e))}else console.warn("THREE.WebGLRenderer: Unknown uniform type: "+b)}function A(a){for(var b=0,c=a.length;b<c;b++){var d=a[b][0];!1!==d.needsUpdate&&x(d,d.type,a[b][1],d.value)}}function w(a,b,c){c?(y.texParameteri(a,
y.TEXTURE_WRAP_S,K(b.wrapS)),y.texParameteri(a,y.TEXTURE_WRAP_T,K(b.wrapT)),y.texParameteri(a,y.TEXTURE_MAG_FILTER,K(b.magFilter)),y.texParameteri(a,y.TEXTURE_MIN_FILTER,K(b.minFilter))):(y.texParameteri(a,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(a,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),b.wrapS===THREE.ClampToEdgeWrapping&&b.wrapT===THREE.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",
b),y.texParameteri(a,y.TEXTURE_MAG_FILTER,L(b.magFilter)),y.texParameteri(a,y.TEXTURE_MIN_FILTER,L(b.minFilter)),b.minFilter!==THREE.NearestFilter&&b.minFilter!==THREE.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",b));!(c=ea.get("EXT_texture_filter_anisotropic"))||b.type===THREE.FloatType&&null===ea.get("OES_texture_float_linear")||b.type===THREE.HalfFloatType&&null===ea.get("OES_texture_half_float_linear")||
!(1<b.anisotropy||ja.get(b).__currentAnisotropy)||(y.texParameterf(a,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b.anisotropy,T.getMaxAnisotropy())),ja.get(b).__currentAnisotropy=b.anisotropy)}function D(a,b){if(a.width>b||a.height>b){var c=b/Math.max(a.width,a.height),d=document.createElement("canvas");d.width=Math.floor(a.width*c);d.height=Math.floor(a.height*c);d.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,d.width,d.height);console.warn("THREE.WebGLRenderer: image is too big ("+a.width+"x"+
a.height+"). Resized to "+d.width+"x"+d.height,a);return d}return a}function B(a){return THREE.Math.isPowerOfTwo(a.width)&&THREE.Math.isPowerOfTwo(a.height)}function z(a,b){var c=ja.get(a);if(6===a.image.length)if(0<a.version&&c.__version!==a.version){c.__image__webglTextureCube||(a.addEventListener("dispose",g),c.__image__webglTextureCube=y.createTexture(),Ka.textures++);W.activeTexture(y.TEXTURE0+b);W.bindTexture(y.TEXTURE_CUBE_MAP,c.__image__webglTextureCube);y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,
a.flipY);for(var d=a instanceof THREE.CompressedTexture,e=a.image[0]instanceof THREE.DataTexture,f=[],h=0;6>h;h++)f[h]=!T.autoScaleCubemaps||d||e?e?a.image[h].image:a.image[h]:D(a.image[h],xa.maxCubemapSize);var m=B(f[0]),k=K(a.format),l=K(a.type);w(y.TEXTURE_CUBE_MAP,a,m);for(h=0;6>h;h++)if(d)for(var p,r=f[h].mipmaps,n=0,q=r.length;n<q;n++)p=r[n],a.format!==THREE.RGBAFormat&&a.format!==THREE.RGBFormat?-1<W.getCompressedTextureFormats().indexOf(k)?W.compressedTexImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+
h,n,k,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):W.texImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+h,n,k,p.width,p.height,0,k,l,p.data);else e?W.texImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,k,f[h].width,f[h].height,0,k,l,f[h].data):W.texImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,k,k,l,f[h]);a.generateMipmaps&&m&&y.generateMipmap(y.TEXTURE_CUBE_MAP);c.__version=a.version;if(a.onUpdate)a.onUpdate(a)}else W.activeTexture(y.TEXTURE0+
b),W.bindTexture(y.TEXTURE_CUBE_MAP,c.__image__webglTextureCube)}function F(a,b){W.activeTexture(y.TEXTURE0+b);W.bindTexture(y.TEXTURE_CUBE_MAP,ja.get(a).__webglTexture)}function G(a,b,c,d){var e=K(b.texture.format),f=K(b.texture.type);W.texImage2D(d,0,e,b.width,b.height,0,e,f,null);y.bindFramebuffer(y.FRAMEBUFFER,a);y.framebufferTexture2D(y.FRAMEBUFFER,c,d,ja.get(b.texture).__webglTexture,0);y.bindFramebuffer(y.FRAMEBUFFER,null)}function C(a,b){y.bindRenderbuffer(y.RENDERBUFFER,a);b.depthBuffer&&
!b.stencilBuffer?(y.renderbufferStorage(y.RENDERBUFFER,y.DEPTH_COMPONENT16,b.width,b.height),y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,y.RENDERBUFFER,a)):b.depthBuffer&&b.stencilBuffer?(y.renderbufferStorage(y.RENDERBUFFER,y.DEPTH_STENCIL,b.width,b.height),y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_STENCIL_ATTACHMENT,y.RENDERBUFFER,a)):y.renderbufferStorage(y.RENDERBUFFER,y.RGBA4,b.width,b.height);y.bindRenderbuffer(y.RENDERBUFFER,null)}function L(a){return a===THREE.NearestFilter||
a===THREE.NearestMipMapNearestFilter||a===THREE.NearestMipMapLinearFilter?y.NEAREST:y.LINEAR}function K(a){var b;if(a===THREE.RepeatWrapping)return y.REPEAT;if(a===THREE.ClampToEdgeWrapping)return y.CLAMP_TO_EDGE;if(a===THREE.MirroredRepeatWrapping)return y.MIRRORED_REPEAT;if(a===THREE.NearestFilter)return y.NEAREST;if(a===THREE.NearestMipMapNearestFilter)return y.NEAREST_MIPMAP_NEAREST;if(a===THREE.NearestMipMapLinearFilter)return y.NEAREST_MIPMAP_LINEAR;if(a===THREE.LinearFilter)return y.LINEAR;
if(a===THREE.LinearMipMapNearestFilter)return y.LINEAR_MIPMAP_NEAREST;if(a===THREE.LinearMipMapLinearFilter)return y.LINEAR_MIPMAP_LINEAR;if(a===THREE.UnsignedByteType)return y.UNSIGNED_BYTE;if(a===THREE.UnsignedShort4444Type)return y.UNSIGNED_SHORT_4_4_4_4;if(a===THREE.UnsignedShort5551Type)return y.UNSIGNED_SHORT_5_5_5_1;if(a===THREE.UnsignedShort565Type)return y.UNSIGNED_SHORT_5_6_5;if(a===THREE.ByteType)return y.BYTE;if(a===THREE.ShortType)return y.SHORT;if(a===THREE.UnsignedShortType)return y.UNSIGNED_SHORT;
if(a===THREE.IntType)return y.INT;if(a===THREE.UnsignedIntType)return y.UNSIGNED_INT;if(a===THREE.FloatType)return y.FLOAT;b=ea.get("OES_texture_half_float");if(null!==b&&a===THREE.HalfFloatType)return b.HALF_FLOAT_OES;if(a===THREE.AlphaFormat)return y.ALPHA;if(a===THREE.RGBFormat)return y.RGB;if(a===THREE.RGBAFormat)return y.RGBA;if(a===THREE.LuminanceFormat)return y.LUMINANCE;if(a===THREE.LuminanceAlphaFormat)return y.LUMINANCE_ALPHA;if(a===THREE.AddEquation)return y.FUNC_ADD;if(a===THREE.SubtractEquation)return y.FUNC_SUBTRACT;
if(a===THREE.ReverseSubtractEquation)return y.FUNC_REVERSE_SUBTRACT;if(a===THREE.ZeroFactor)return y.ZERO;if(a===THREE.OneFactor)return y.ONE;if(a===THREE.SrcColorFactor)return y.SRC_COLOR;if(a===THREE.OneMinusSrcColorFactor)return y.ONE_MINUS_SRC_COLOR;if(a===THREE.SrcAlphaFactor)return y.SRC_ALPHA;if(a===THREE.OneMinusSrcAlphaFactor)return y.ONE_MINUS_SRC_ALPHA;if(a===THREE.DstAlphaFactor)return y.DST_ALPHA;if(a===THREE.OneMinusDstAlphaFactor)return y.ONE_MINUS_DST_ALPHA;if(a===THREE.DstColorFactor)return y.DST_COLOR;
if(a===THREE.OneMinusDstColorFactor)return y.ONE_MINUS_DST_COLOR;if(a===THREE.SrcAlphaSaturateFactor)return y.SRC_ALPHA_SATURATE;b=ea.get("WEBGL_compressed_texture_s3tc");if(null!==b){if(a===THREE.RGB_S3TC_DXT1_Format)return b.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT1_Format)return b.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT3_Format)return b.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===THREE.RGBA_S3TC_DXT5_Format)return b.COMPRESSED_RGBA_S3TC_DXT5_EXT}b=ea.get("WEBGL_compressed_texture_pvrtc");
if(null!==b){if(a===THREE.RGB_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===THREE.RGB_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===THREE.RGBA_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===THREE.RGBA_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}b=ea.get("WEBGL_compressed_texture_etc1");if(null!==b&&a===THREE.RGB_ETC1_Format)return b.COMPRESSED_RGB_ETC1_WEBGL;b=ea.get("EXT_blend_minmax");if(null!==b){if(a===THREE.MinEquation)return b.MIN_EXT;
if(a===THREE.MaxEquation)return b.MAX_EXT}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION);a=a||{};var H=void 0!==a.canvas?a.canvas:document.createElement("canvas"),M=void 0!==a.context?a.context:null,E=void 0!==a.alpha?a.alpha:!1,J=void 0!==a.depth?a.depth:!0,N=void 0!==a.stencil?a.stencil:!0,P=void 0!==a.antialias?a.antialias:!1,Q=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,O=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,S=[],I=[],ba=-1,R=[],V=-1,X=new Float32Array(8),
aa=[],U=[];this.domElement=H;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1;this.toneMapping=THREE.LinearToneMapping;this.toneMappingWhitePoint=this.toneMappingExposure=1;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=!0;var T=this,Y=null,fa=null,ka=null,ca=-1,la="",ha=null,ga=new THREE.Vector4,qa=null,pa=new THREE.Vector4,va=
0,ma=new THREE.Color(0),na=0,ra=H.width,ya=H.height,sa=1,oa=new THREE.Vector4(0,0,ra,ya),da=!1,wa=new THREE.Vector4(0,0,ra,ya),Ja=new THREE.Frustum,Na=new THREE.Matrix4,ua=new THREE.Vector3,Z={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[],shadowsPointLight:0},Ka={geometries:0,textures:0},ia={calls:0,vertices:0,faces:0,points:0};this.info={render:ia,
memory:Ka,programs:null};var y;try{E={alpha:E,depth:J,stencil:N,antialias:P,premultipliedAlpha:Q,preserveDrawingBuffer:O};y=M||H.getContext("webgl",E)||H.getContext("experimental-webgl",E);if(null===y){if(null!==H.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";throw"Error creating WebGL context.";}void 0===y.getShaderPrecisionFormat&&(y.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});H.addEventListener("webglcontextlost",d,!1)}catch(ta){console.error("THREE.WebGLRenderer: "+
ta)}var ea=new THREE.WebGLExtensions(y);ea.get("OES_texture_float");ea.get("OES_texture_float_linear");ea.get("OES_texture_half_float");ea.get("OES_texture_half_float_linear");ea.get("OES_standard_derivatives");ea.get("ANGLE_instanced_arrays");ea.get("OES_element_index_uint")&&(THREE.BufferGeometry.MaxIndex=4294967296);var xa=new THREE.WebGLCapabilities(y,ea,a),W=new THREE.WebGLState(y,ea,K),ja=new THREE.WebGLProperties,La=new THREE.WebGLObjects(y,ja,this.info),Ha=new THREE.WebGLPrograms(this,xa),
za=new THREE.WebGLLights;this.info.programs=Ha.programs;var Ma=new THREE.WebGLBufferRenderer(y,ea,ia),Ca=new THREE.WebGLIndexedBufferRenderer(y,ea,ia);c();this.context=y;this.capabilities=xa;this.extensions=ea;this.properties=ja;this.state=W;var Ea=new THREE.WebGLShadowMap(this,Z,La);this.shadowMap=Ea;var Hb=new THREE.SpritePlugin(this,aa),Ib=new THREE.LensFlarePlugin(this,U);this.getContext=function(){return y};this.getContextAttributes=function(){return y.getContextAttributes()};this.forceContextLoss=
function(){ea.get("WEBGL_lose_context").loseContext()};this.getMaxAnisotropy=function(){var a;return function(){if(void 0!==a)return a;var b=ea.get("EXT_texture_filter_anisotropic");return a=null!==b?y.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}();this.getPrecision=function(){return xa.precision};this.getPixelRatio=function(){return sa};this.setPixelRatio=function(a){void 0!==a&&(sa=a,this.setSize(wa.z,wa.w,!1))};this.getSize=function(){return{width:ra,height:ya}};this.setSize=function(a,b,
c){ra=a;ya=b;H.width=a*sa;H.height=b*sa;!1!==c&&(H.style.width=a+"px",H.style.height=b+"px");this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){W.viewport(wa.set(a,b,c,d))};this.setScissor=function(a,b,c,d){W.scissor(oa.set(a,b,c,d))};this.setScissorTest=function(a){W.setScissorTest(da=a)};this.getClearColor=function(){return ma};this.setClearColor=function(a,c){ma.set(a);na=void 0!==c?c:1;b(ma.r,ma.g,ma.b,na)};this.getClearAlpha=function(){return na};this.setClearAlpha=function(a){na=
a;b(ma.r,ma.g,ma.b,na)};this.clear=function(a,b,c){var d=0;if(void 0===a||a)d|=y.COLOR_BUFFER_BIT;if(void 0===b||b)d|=y.DEPTH_BUFFER_BIT;if(void 0===c||c)d|=y.STENCIL_BUFFER_BIT;y.clear(d)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.clearTarget=function(a,b,c,d){this.setRenderTarget(a);this.clear(b,c,d)};this.resetGLState=e;this.dispose=function(){H.removeEventListener("webglcontextlost",
d,!1)};this.renderBufferImmediate=function(a,b,c){W.initAttributes();var d=ja.get(a);a.hasPositions&&!d.position&&(d.position=y.createBuffer());a.hasNormals&&!d.normal&&(d.normal=y.createBuffer());a.hasUvs&&!d.uv&&(d.uv=y.createBuffer());a.hasColors&&!d.color&&(d.color=y.createBuffer());b=b.getAttributes();a.hasPositions&&(y.bindBuffer(y.ARRAY_BUFFER,d.position),y.bufferData(y.ARRAY_BUFFER,a.positionArray,y.DYNAMIC_DRAW),W.enableAttribute(b.position),y.vertexAttribPointer(b.position,3,y.FLOAT,!1,
0,0));if(a.hasNormals){y.bindBuffer(y.ARRAY_BUFFER,d.normal);if("MeshPhongMaterial"!==c.type&&"MeshStandardMaterial"!==c.type&&c.shading===THREE.FlatShading)for(var e=0,f=3*a.count;e<f;e+=9){var g=a.normalArray,h=(g[e+0]+g[e+3]+g[e+6])/3,m=(g[e+1]+g[e+4]+g[e+7])/3,k=(g[e+2]+g[e+5]+g[e+8])/3;g[e+0]=h;g[e+1]=m;g[e+2]=k;g[e+3]=h;g[e+4]=m;g[e+5]=k;g[e+6]=h;g[e+7]=m;g[e+8]=k}y.bufferData(y.ARRAY_BUFFER,a.normalArray,y.DYNAMIC_DRAW);W.enableAttribute(b.normal);y.vertexAttribPointer(b.normal,3,y.FLOAT,!1,
0,0)}a.hasUvs&&c.map&&(y.bindBuffer(y.ARRAY_BUFFER,d.uv),y.bufferData(y.ARRAY_BUFFER,a.uvArray,y.DYNAMIC_DRAW),W.enableAttribute(b.uv),y.vertexAttribPointer(b.uv,2,y.FLOAT,!1,0,0));a.hasColors&&c.vertexColors!==THREE.NoColors&&(y.bindBuffer(y.ARRAY_BUFFER,d.color),y.bufferData(y.ARRAY_BUFFER,a.colorArray,y.DYNAMIC_DRAW),W.enableAttribute(b.color),y.vertexAttribPointer(b.color,3,y.FLOAT,!1,0,0));W.disableUnusedAttributes();y.drawArrays(y.TRIANGLES,0,a.count);a.count=0};this.renderBufferDirect=function(a,
b,c,d,e,f){u(d);var g=t(a,b,d,e),h=!1;a=c.id+"_"+g.id+"_"+d.wireframe;a!==la&&(la=a,h=!0);b=e.morphTargetInfluences;if(void 0!==b){a=[];for(var m=0,h=b.length;m<h;m++){var k=b[m];a.push([k,m])}a.sort(l);8<a.length&&(a.length=8);for(var p=c.morphAttributes,m=0,h=a.length;m<h;m++)k=a[m],X[m]=k[0],0!==k[0]?(b=k[1],!0===d.morphTargets&&p.position&&c.addAttribute("morphTarget"+m,p.position[b]),!0===d.morphNormals&&p.normal&&c.addAttribute("morphNormal"+m,p.normal[b])):(!0===d.morphTargets&&c.removeAttribute("morphTarget"+
m),!0===d.morphNormals&&c.removeAttribute("morphNormal"+m));a=g.getUniforms();null!==a.morphTargetInfluences&&y.uniform1fv(a.morphTargetInfluences,X);h=!0}b=c.index;m=c.attributes.position;!0===d.wireframe&&(b=La.getWireframeAttribute(c));null!==b?(a=Ca,a.setIndex(b)):a=Ma;if(h){var h=void 0,r;if(c instanceof THREE.InstancedBufferGeometry&&(r=ea.get("ANGLE_instanced_arrays"),null===r))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");
else{void 0===h&&(h=0);W.initAttributes();var k=c.attributes,g=g.getAttributes(),p=d.defaultAttributeValues,n;for(n in g){var q=g[n];if(0<=q){var v=k[n];if(void 0!==v){var x=v.itemSize,w=La.getAttributeBuffer(v);if(v instanceof THREE.InterleavedBufferAttribute){var A=v.data,z=A.stride,v=v.offset;A instanceof THREE.InstancedInterleavedBuffer?(W.enableAttributeAndDivisor(q,A.meshPerAttribute,r),void 0===c.maxInstancedCount&&(c.maxInstancedCount=A.meshPerAttribute*A.count)):W.enableAttribute(q);y.bindBuffer(y.ARRAY_BUFFER,
w);y.vertexAttribPointer(q,x,y.FLOAT,!1,z*A.array.BYTES_PER_ELEMENT,(h*z+v)*A.array.BYTES_PER_ELEMENT)}else v instanceof THREE.InstancedBufferAttribute?(W.enableAttributeAndDivisor(q,v.meshPerAttribute,r),void 0===c.maxInstancedCount&&(c.maxInstancedCount=v.meshPerAttribute*v.count)):W.enableAttribute(q),y.bindBuffer(y.ARRAY_BUFFER,w),y.vertexAttribPointer(q,x,y.FLOAT,!1,0,h*x*4)}else if(void 0!==p&&(x=p[n],void 0!==x))switch(x.length){case 2:y.vertexAttrib2fv(q,x);break;case 3:y.vertexAttrib3fv(q,
x);break;case 4:y.vertexAttrib4fv(q,x);break;default:y.vertexAttrib1fv(q,x)}}}W.disableUnusedAttributes()}null!==b&&y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,La.getAttributeBuffer(b))}r=Infinity;null!==b?r=b.count:void 0!==m&&(r=m.count);n=c.drawRange.start;b=c.drawRange.count;m=null!==f?f.start:0;h=null!==f?f.count:Infinity;f=Math.max(0,n,m);r=Math.min(0+r,n+b,m+h)-1;r=Math.max(0,r-f+1);if(e instanceof THREE.Mesh)if(!0===d.wireframe)W.setLineWidth(d.wireframeLinewidth*(null===fa?sa:1)),a.setMode(y.LINES);
else switch(e.drawMode){case THREE.TrianglesDrawMode:a.setMode(y.TRIANGLES);break;case THREE.TriangleStripDrawMode:a.setMode(y.TRIANGLE_STRIP);break;case THREE.TriangleFanDrawMode:a.setMode(y.TRIANGLE_FAN)}else e instanceof THREE.Line?(d=d.linewidth,void 0===d&&(d=1),W.setLineWidth(d*(null===fa?sa:1)),e instanceof THREE.LineSegments?a.setMode(y.LINES):a.setMode(y.LINE_STRIP)):e instanceof THREE.Points&&a.setMode(y.POINTS);c instanceof THREE.InstancedBufferGeometry?0<c.maxInstancedCount&&a.renderInstances(c,
f,r):a.render(f,r)};this.render=function(a,b,c,d){if(!1===b instanceof THREE.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var e=a.fog;la="";ca=-1;ha=null;!0===a.autoUpdate&&a.updateMatrixWorld();null===b.parent&&b.updateMatrixWorld();b.matrixWorldInverse.getInverse(b.matrixWorld);Na.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse);Ja.setFromMatrix(Na);S.length=0;V=ba=-1;aa.length=0;U.length=0;p(a,b);I.length=ba+1;R.length=V+1;!0===T.sortObjects&&
(I.sort(n),R.sort(q));var f=S,g,h,m,k=0,l=0,u=0,t,v,x,w=b.matrixWorldInverse,A=0,z=0,G=0,N=0,D=0;g=Z.shadowsPointLight=0;for(h=f.length;g<h;g++)if(m=f[g],t=m.color,v=m.intensity,x=m.distance,m instanceof THREE.AmbientLight)k+=t.r*v,l+=t.g*v,u+=t.b*v;else if(m instanceof THREE.DirectionalLight){var C=za.get(m);C.color.copy(m.color).multiplyScalar(m.intensity);C.direction.setFromMatrixPosition(m.matrixWorld);ua.setFromMatrixPosition(m.target.matrixWorld);C.direction.sub(ua);C.direction.transformDirection(w);
if(C.shadow=m.castShadow)C.shadowBias=m.shadow.bias,C.shadowRadius=m.shadow.radius,C.shadowMapSize=m.shadow.mapSize,Z.shadows[D++]=m;Z.directionalShadowMap[A]=m.shadow.map;Z.directionalShadowMatrix[A]=m.shadow.matrix;Z.directional[A++]=C}else if(m instanceof THREE.SpotLight){C=za.get(m);C.position.setFromMatrixPosition(m.matrixWorld);C.position.applyMatrix4(w);C.color.copy(t).multiplyScalar(v);C.distance=x;C.direction.setFromMatrixPosition(m.matrixWorld);ua.setFromMatrixPosition(m.target.matrixWorld);
C.direction.sub(ua);C.direction.transformDirection(w);C.coneCos=Math.cos(m.angle);C.penumbraCos=Math.cos(m.angle*(1-m.penumbra));C.decay=0===m.distance?0:m.decay;if(C.shadow=m.castShadow)C.shadowBias=m.shadow.bias,C.shadowRadius=m.shadow.radius,C.shadowMapSize=m.shadow.mapSize,Z.shadows[D++]=m;Z.spotShadowMap[G]=m.shadow.map;Z.spotShadowMatrix[G]=m.shadow.matrix;Z.spot[G++]=C}else if(m instanceof THREE.PointLight){C=za.get(m);C.position.setFromMatrixPosition(m.matrixWorld);C.position.applyMatrix4(w);
C.color.copy(m.color).multiplyScalar(m.intensity);C.distance=m.distance;C.decay=0===m.distance?0:m.decay;if(C.shadow=m.castShadow)C.shadowBias=m.shadow.bias,C.shadowRadius=m.shadow.radius,C.shadowMapSize=m.shadow.mapSize,Z.shadows[D++]=m;Z.pointShadowMap[z]=m.shadow.map;void 0===Z.pointShadowMatrix[z]&&(Z.pointShadowMatrix[z]=new THREE.Matrix4);ua.setFromMatrixPosition(m.matrixWorld).negate();Z.pointShadowMatrix[z].identity().setPosition(ua);Z.point[z++]=C}else m instanceof THREE.HemisphereLight&&
(C=za.get(m),C.direction.setFromMatrixPosition(m.matrixWorld),C.direction.transformDirection(w),C.direction.normalize(),C.skyColor.copy(m.color).multiplyScalar(v),C.groundColor.copy(m.groundColor).multiplyScalar(v),Z.hemi[N++]=C);Z.ambient[0]=k;Z.ambient[1]=l;Z.ambient[2]=u;Z.directional.length=A;Z.spot.length=G;Z.point.length=z;Z.hemi.length=N;Z.shadows.length=D;Z.hash=A+","+z+","+G+","+N+","+D;Ea.render(a,b);ia.calls=0;ia.vertices=0;ia.faces=0;ia.points=0;void 0===c&&(c=null);this.setRenderTarget(c);
(this.autoClear||d)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);a.overrideMaterial?(d=a.overrideMaterial,r(I,b,e,d),r(R,b,e,d)):(W.setBlending(THREE.NoBlending),r(I,b,e),r(R,b,e));Hb.render(a,b);Ib.render(a,b,pa);c&&(a=c.texture,a.generateMipmaps&&B(c)&&a.minFilter!==THREE.NearestFilter&&a.minFilter!==THREE.LinearFilter&&(a=c instanceof THREE.WebGLRenderTargetCube?y.TEXTURE_CUBE_MAP:y.TEXTURE_2D,c=ja.get(c.texture).__webglTexture,W.bindTexture(a,c),y.generateMipmap(a),
W.bindTexture(a,null)));W.setDepthTest(!0);W.setDepthWrite(!0);W.setColorWrite(!0)}};this.setFaceCulling=function(a,b){a===THREE.CullFaceNone?W.disable(y.CULL_FACE):(b===THREE.FrontFaceDirectionCW?y.frontFace(y.CW):y.frontFace(y.CCW),a===THREE.CullFaceBack?y.cullFace(y.BACK):a===THREE.CullFaceFront?y.cullFace(y.FRONT):y.cullFace(y.FRONT_AND_BACK),W.enable(y.CULL_FACE))};this.setTexture=function(a,b){var c=ja.get(a);if(0<a.version&&c.__version!==a.version){var d=a.image;if(void 0===d)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",
a);else if(!1===d.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",a);else{void 0===c.__webglInit&&(c.__webglInit=!0,a.addEventListener("dispose",g),c.__webglTexture=y.createTexture(),Ka.textures++);W.activeTexture(y.TEXTURE0+b);W.bindTexture(y.TEXTURE_2D,c.__webglTexture);y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,a.flipY);y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha);y.pixelStorei(y.UNPACK_ALIGNMENT,a.unpackAlignment);var e=D(a.image,xa.maxTextureSize);
if((a.wrapS!==THREE.ClampToEdgeWrapping||a.wrapT!==THREE.ClampToEdgeWrapping||a.minFilter!==THREE.NearestFilter&&a.minFilter!==THREE.LinearFilter)&&!1===B(e))if(d=e,d instanceof HTMLImageElement||d instanceof HTMLCanvasElement){var f=document.createElement("canvas");f.width=THREE.Math.nearestPowerOfTwo(d.width);f.height=THREE.Math.nearestPowerOfTwo(d.height);f.getContext("2d").drawImage(d,0,0,f.width,f.height);console.warn("THREE.WebGLRenderer: image is not power of two ("+d.width+"x"+d.height+"). Resized to "+
f.width+"x"+f.height,d);e=f}else e=d;var d=B(e),f=K(a.format),h=K(a.type);w(y.TEXTURE_2D,a,d);var m=a.mipmaps;if(a instanceof THREE.DataTexture)if(0<m.length&&d){for(var k=0,l=m.length;k<l;k++)e=m[k],W.texImage2D(y.TEXTURE_2D,k,f,e.width,e.height,0,f,h,e.data);a.generateMipmaps=!1}else W.texImage2D(y.TEXTURE_2D,0,f,e.width,e.height,0,f,h,e.data);else if(a instanceof THREE.CompressedTexture)for(k=0,l=m.length;k<l;k++)e=m[k],a.format!==THREE.RGBAFormat&&a.format!==THREE.RGBFormat?-1<W.getCompressedTextureFormats().indexOf(f)?
W.compressedTexImage2D(y.TEXTURE_2D,k,f,e.width,e.height,0,e.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):W.texImage2D(y.TEXTURE_2D,k,f,e.width,e.height,0,f,h,e.data);else if(0<m.length&&d){k=0;for(l=m.length;k<l;k++)e=m[k],W.texImage2D(y.TEXTURE_2D,k,f,f,h,e);a.generateMipmaps=!1}else W.texImage2D(y.TEXTURE_2D,0,f,f,h,e);a.generateMipmaps&&d&&y.generateMipmap(y.TEXTURE_2D);c.__version=a.version;if(a.onUpdate)a.onUpdate(a)}}else W.activeTexture(y.TEXTURE0+
b),W.bindTexture(y.TEXTURE_2D,c.__webglTexture)};this.getCurrentRenderTarget=function(){return fa};this.setRenderTarget=function(a){if((fa=a)&&void 0===ja.get(a).__webglFramebuffer){var b=ja.get(a),c=ja.get(a.texture);a.addEventListener("dispose",f);c.__webglTexture=y.createTexture();Ka.textures++;var d=a instanceof THREE.WebGLRenderTargetCube,e=THREE.Math.isPowerOfTwo(a.width)&&THREE.Math.isPowerOfTwo(a.height);if(d){b.__webglFramebuffer=[];for(var g=0;6>g;g++)b.__webglFramebuffer[g]=y.createFramebuffer()}else b.__webglFramebuffer=
y.createFramebuffer();if(d){W.bindTexture(y.TEXTURE_CUBE_MAP,c.__webglTexture);w(y.TEXTURE_CUBE_MAP,a.texture,e);for(g=0;6>g;g++)G(b.__webglFramebuffer[g],a,y.COLOR_ATTACHMENT0,y.TEXTURE_CUBE_MAP_POSITIVE_X+g);a.texture.generateMipmaps&&e&&y.generateMipmap(y.TEXTURE_CUBE_MAP);W.bindTexture(y.TEXTURE_CUBE_MAP,null)}else W.bindTexture(y.TEXTURE_2D,c.__webglTexture),w(y.TEXTURE_2D,a.texture,e),G(b.__webglFramebuffer,a,y.COLOR_ATTACHMENT0,y.TEXTURE_2D),a.texture.generateMipmaps&&e&&y.generateMipmap(y.TEXTURE_2D),
W.bindTexture(y.TEXTURE_2D,null);if(a.depthBuffer){b=ja.get(a);if(a instanceof THREE.WebGLRenderTargetCube)for(b.__webglDepthbuffer=[],c=0;6>c;c++)y.bindFramebuffer(y.FRAMEBUFFER,b.__webglFramebuffer[c]),b.__webglDepthbuffer[c]=y.createRenderbuffer(),C(b.__webglDepthbuffer[c],a);else y.bindFramebuffer(y.FRAMEBUFFER,b.__webglFramebuffer),b.__webglDepthbuffer=y.createRenderbuffer(),C(b.__webglDepthbuffer,a);y.bindFramebuffer(y.FRAMEBUFFER,null)}}b=a instanceof THREE.WebGLRenderTargetCube;a?(c=ja.get(a),
c=b?c.__webglFramebuffer[a.activeCubeFace]:c.__webglFramebuffer,ga.copy(a.scissor),qa=a.scissorTest,pa.copy(a.viewport)):(c=null,ga.copy(oa).multiplyScalar(sa),qa=da,pa.copy(wa).multiplyScalar(sa));ka!==c&&(y.bindFramebuffer(y.FRAMEBUFFER,c),ka=c);W.scissor(ga);W.setScissorTest(qa);W.viewport(pa);b&&(b=ja.get(a.texture),y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_CUBE_MAP_POSITIVE_X+a.activeCubeFace,b.__webglTexture,a.activeMipMapLevel))};this.readRenderTargetPixels=function(a,
b,c,d,e,f){if(!1===a instanceof THREE.WebGLRenderTarget)console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");else{var g=ja.get(a).__webglFramebuffer;if(g){var h=!1;g!==ka&&(y.bindFramebuffer(y.FRAMEBUFFER,g),h=!0);try{var m=a.texture;m.format!==THREE.RGBAFormat&&K(m.format)!==y.getParameter(y.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):
m.type===THREE.UnsignedByteType||K(m.type)===y.getParameter(y.IMPLEMENTATION_COLOR_READ_TYPE)||m.type===THREE.FloatType&&ea.get("WEBGL_color_buffer_float")||m.type===THREE.HalfFloatType&&ea.get("EXT_color_buffer_half_float")?y.checkFramebufferStatus(y.FRAMEBUFFER)===y.FRAMEBUFFER_COMPLETE?y.readPixels(b,c,d,e,K(m.format),K(m.type),f):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{h&&
y.bindFramebuffer(y.FRAMEBUFFER,ka)}}}}};
THREE.WebGLRenderTarget=function(a,b,c){this.uuid=THREE.Math.generateUUID();this.width=a;this.height=b;this.scissor=new THREE.Vector4(0,0,a,b);this.scissorTest=!1;this.viewport=new THREE.Vector4(0,0,a,b);c=c||{};void 0===c.minFilter&&(c.minFilter=THREE.LinearFilter);this.texture=new THREE.Texture(void 0,void 0,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy);this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0};
THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,setSize:function(a,b){if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.dispose();this.viewport.set(0,0,a,b);this.scissor.set(0,0,a,b)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.width=a.width;this.height=a.height;this.viewport.copy(a.viewport);this.texture=a.texture.clone();this.depthBuffer=a.depthBuffer;this.stencilBuffer=a.stencilBuffer;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};
THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube=function(a,b,c){THREE.WebGLRenderTarget.call(this,a,b,c);this.activeMipMapLevel=this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube;
THREE.WebGLBufferRenderer=function(a,b,c){var e;this.setMode=function(a){e=a};this.render=function(b,g){a.drawArrays(e,b,g);c.calls++;c.vertices+=g;e===a.TRIANGLES&&(c.faces+=g/3)};this.renderInstances=function(d){var g=b.get("ANGLE_instanced_arrays");if(null===g)console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{var f=d.attributes.position,f=f instanceof THREE.InterleavedBufferAttribute?f.data.count:
f.count;g.drawArraysInstancedANGLE(e,0,f,d.maxInstancedCount);c.calls++;c.vertices+=f*d.maxInstancedCount;e===a.TRIANGLES&&(c.faces+=d.maxInstancedCount*f/3)}}};
THREE.WebGLIndexedBufferRenderer=function(a,b,c){var e,d,g;this.setMode=function(a){e=a};this.setIndex=function(c){c.array instanceof Uint32Array&&b.get("OES_element_index_uint")?(d=a.UNSIGNED_INT,g=4):(d=a.UNSIGNED_SHORT,g=2)};this.render=function(b,h){a.drawElements(e,h,d,b*g);c.calls++;c.vertices+=h;e===a.TRIANGLES&&(c.faces+=h/3)};this.renderInstances=function(f,h,k){var l=b.get("ANGLE_instanced_arrays");null===l?console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):
(l.drawElementsInstancedANGLE(e,k,d,h*g,f.maxInstancedCount),c.calls++,c.vertices+=k*f.maxInstancedCount,e===a.TRIANGLES&&(c.faces+=f.maxInstancedCount*k/3))}};
THREE.WebGLExtensions=function(a){var b={};this.get=function(c){if(void 0!==b[c])return b[c];var e;switch(c){case "EXT_texture_filter_anisotropic":e=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":e=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");
break;case "WEBGL_compressed_texture_pvrtc":e=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case "WEBGL_compressed_texture_etc1":e=a.getExtension("WEBGL_compressed_texture_etc1");break;default:e=a.getExtension(c)}null===e&&console.warn("THREE.WebGLRenderer: "+c+" extension not supported.");return b[c]=e}};
THREE.WebGLCapabilities=function(a,b,c){function e(b){if("highp"===b){if(0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision)return"highp";b="mediump"}return"mediump"===b&&0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision?"mediump":"lowp"}this.getMaxPrecision=e;this.precision=void 0!==c.precision?c.precision:"highp";
this.logarithmicDepthBuffer=void 0!==c.logarithmicDepthBuffer?c.logarithmicDepthBuffer:!1;this.maxTextures=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);this.maxVertexTextures=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);this.maxCubemapSize=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);this.maxAttributes=a.getParameter(a.MAX_VERTEX_ATTRIBS);this.maxVertexUniforms=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);this.maxVaryings=a.getParameter(a.MAX_VARYING_VECTORS);
this.maxFragmentUniforms=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS);this.vertexTextures=0<this.maxVertexTextures;this.floatFragmentTextures=!!b.get("OES_texture_float");this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;c=e(this.precision);c!==this.precision&&(console.warn("THREE.WebGLRenderer:",this.precision,"not supported, using",c,"instead."),this.precision=c);this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!b.get("EXT_frag_depth"))};
THREE.WebGLGeometries=function(a,b,c){function e(a){var f=a.target;a=g[f.id];null!==a.index&&d(a.index);var k=a.attributes,l;for(l in k)d(k[l]);f.removeEventListener("dispose",e);delete g[f.id];l=b.get(f);l.wireframe&&d(l.wireframe);b["delete"](f);f=b.get(a);f.wireframe&&d(f.wireframe);b["delete"](a);c.memory.geometries--}function d(c){var d;d=c instanceof THREE.InterleavedBufferAttribute?b.get(c.data).__webglBuffer:b.get(c).__webglBuffer;void 0!==d&&(a.deleteBuffer(d),c instanceof THREE.InterleavedBufferAttribute?
b["delete"](c.data):b["delete"](c))}var g={};this.get=function(a){var b=a.geometry;if(void 0!==g[b.id])return g[b.id];b.addEventListener("dispose",e);var d;b instanceof THREE.BufferGeometry?d=b:b instanceof THREE.Geometry&&(void 0===b._bufferGeometry&&(b._bufferGeometry=(new THREE.BufferGeometry).setFromObject(a)),d=b._bufferGeometry);g[b.id]=d;c.memory.geometries++;return d}};
THREE.WebGLLights=function(){var a={};this.get=function(b){if(void 0!==a[b.id])return a[b.id];var c;switch(b.type){case "DirectionalLight":c={direction:new THREE.Vector3,color:new THREE.Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case "SpotLight":c={position:new THREE.Vector3,direction:new THREE.Vector3,color:new THREE.Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case "PointLight":c=
{position:new THREE.Vector3,color:new THREE.Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case "HemisphereLight":c={direction:new THREE.Vector3,skyColor:new THREE.Color,groundColor:new THREE.Color}}return a[b.id]=c}};
THREE.WebGLObjects=function(a,b,c){function e(c,d){var e=c instanceof THREE.InterleavedBufferAttribute?c.data:c,f=b.get(e);void 0===f.__webglBuffer?(f.__webglBuffer=a.createBuffer(),a.bindBuffer(d,f.__webglBuffer),a.bufferData(d,e.array,e.dynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW),f.version=e.version):f.version!==e.version&&(a.bindBuffer(d,f.__webglBuffer),!1===e.dynamic||-1===e.updateRange.count?a.bufferSubData(d,0,e.array):0===e.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):
(a.bufferSubData(d,e.updateRange.offset*e.array.BYTES_PER_ELEMENT,e.array.subarray(e.updateRange.offset,e.updateRange.offset+e.updateRange.count)),e.updateRange.count=0),f.version=e.version)}function d(a,b,c){if(b>c){var d=b;b=c;c=d}d=a[b];return void 0===d?(a[b]=[c],!0):-1===d.indexOf(c)?(d.push(c),!0):!1}var g=new THREE.WebGLGeometries(a,b,c);this.getAttributeBuffer=function(a){return a instanceof THREE.InterleavedBufferAttribute?b.get(a.data).__webglBuffer:b.get(a).__webglBuffer};this.getWireframeAttribute=
function(c){var f=b.get(c);if(void 0!==f.wireframe)return f.wireframe;var g=[],l=c.index,n=c.attributes;c=n.position;if(null!==l)for(var n={},l=l.array,q=0,m=l.length;q<m;q+=3){var p=l[q+0],r=l[q+1],u=l[q+2];d(n,p,r)&&g.push(p,r);d(n,r,u)&&g.push(r,u);d(n,u,p)&&g.push(u,p)}else for(l=n.position.array,q=0,m=l.length/3-1;q<m;q+=3)p=q+0,r=q+1,u=q+2,g.push(p,r,r,u,u,p);g=new THREE.BufferAttribute(new (65535<c.count?Uint32Array:Uint16Array)(g),1);e(g,a.ELEMENT_ARRAY_BUFFER);return f.wireframe=g};this.update=
function(b){var c=g.get(b);b.geometry instanceof THREE.Geometry&&c.updateFromObject(b);b=c.index;var d=c.attributes;null!==b&&e(b,a.ELEMENT_ARRAY_BUFFER);for(var f in d)e(d[f],a.ARRAY_BUFFER);b=c.morphAttributes;for(f in b)for(var d=b[f],n=0,q=d.length;n<q;n++)e(d[n],a.ARRAY_BUFFER);return c}};
THREE.WebGLProgram=function(){function a(a){switch(a){case THREE.LinearEncoding:return["Linear","( value )"];case THREE.sRGBEncoding:return["sRGB","( value )"];case THREE.RGBEEncoding:return["RGBE","( value )"];case THREE.RGBM7Encoding:return["RGBM","( value, 7.0 )"];case THREE.RGBM16Encoding:return["RGBM","( value, 16.0 )"];case THREE.RGBDEncoding:return["RGBD","( value, 256.0 )"];case THREE.GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+
a);}}function b(b,c){var d=a(c);return"vec4 "+b+"( vec4 value ) { return "+d[0]+"ToLinear"+d[1]+"; }"}function c(b,c){var d=a(c);return"vec4 "+b+"( vec4 value ) { return LinearTo"+d[0]+d[1]+"; }"}function e(a,b){var c;switch(b){case THREE.LinearToneMapping:c="Linear";break;case THREE.ReinhardToneMapping:c="Reinhard";break;case THREE.Uncharted2ToneMapping:c="Uncharted2";break;case THREE.CineonToneMapping:c="OptimizedCineon";break;default:throw Error("unsupported toneMapping: "+b);}return"vec3 "+a+
"( vec3 color ) { return "+c+"ToneMapping( color ); }"}function d(a,b,c){a=a||{};return[a.derivatives||b.envMapCubeUV||b.bumpMap||b.normalMap||b.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(a.fragDepth||b.logarithmicDepthBuffer)&&c.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",a.drawBuffers&&c.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(a.shaderTextureLOD||b.envMap)&&c.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":
""].filter(f).join("\n")}function g(a){var b=[],c;for(c in a){var d=a[c];!1!==d&&b.push("#define "+c+" "+d)}return b.join("\n")}function f(a){return""!==a}function h(a,b){return a.replace(/NUM_DIR_LIGHTS/g,b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,b.numSpotLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,b.numHemiLights)}function k(a){return a.replace(/#include +<([\w\d.]+)>/g,function(a,b){var c=THREE.ShaderChunk[b];if(void 0===c)throw Error("Can not resolve #include <"+
b+">");return k(c)})}function l(a){return a.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(a,b,c,d){a="";for(b=parseInt(b);b<parseInt(c);b++)a+=d.replace(/\[ i \]/g,"[ "+b+" ]");return a})}var n=0,q=/^([\w\d_]+)\.([\w\d_]+)$/,m=/^([\w\d_]+)\[(\d+)\]\.([\w\d_]+)$/,p=/^([\w\d_]+)\[0\]$/;return function(a,u,t,v){var r=a.context,A=t.extensions,w=t.defines,D=t.__webglShader.vertexShader,B=t.__webglShader.fragmentShader,z="SHADOWMAP_TYPE_BASIC";v.shadowMapType===
THREE.PCFShadowMap?z="SHADOWMAP_TYPE_PCF":v.shadowMapType===THREE.PCFSoftShadowMap&&(z="SHADOWMAP_TYPE_PCF_SOFT");var F="ENVMAP_TYPE_CUBE",G="ENVMAP_MODE_REFLECTION",C="ENVMAP_BLENDING_MULTIPLY";if(v.envMap){switch(t.envMap.mapping){case THREE.CubeReflectionMapping:case THREE.CubeRefractionMapping:F="ENVMAP_TYPE_CUBE";break;case THREE.CubeUVReflectionMapping:case THREE.CubeUVRefractionMapping:F="ENVMAP_TYPE_CUBE_UV";break;case THREE.EquirectangularReflectionMapping:case THREE.EquirectangularRefractionMapping:F=
"ENVMAP_TYPE_EQUIREC";break;case THREE.SphericalReflectionMapping:F="ENVMAP_TYPE_SPHERE"}switch(t.envMap.mapping){case THREE.CubeRefractionMapping:case THREE.EquirectangularRefractionMapping:G="ENVMAP_MODE_REFRACTION"}switch(t.combine){case THREE.MultiplyOperation:C="ENVMAP_BLENDING_MULTIPLY";break;case THREE.MixOperation:C="ENVMAP_BLENDING_MIX";break;case THREE.AddOperation:C="ENVMAP_BLENDING_ADD"}}var L=0<a.gammaFactor?a.gammaFactor:1,A=d(A,v,a.extensions),K=g(w),H=r.createProgram();t instanceof
THREE.RawShaderMaterial?a=w="":(w=["precision "+v.precision+" float;","precision "+v.precision+" int;","#define SHADER_NAME "+t.__webglShader.name,K,v.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+L,"#define MAX_BONES "+v.maxBones,v.map?"#define USE_MAP":"",v.envMap?"#define USE_ENVMAP":"",v.envMap?"#define "+G:"",v.lightMap?"#define USE_LIGHTMAP":"",v.aoMap?"#define USE_AOMAP":"",v.emissiveMap?"#define USE_EMISSIVEMAP":"",v.bumpMap?"#define USE_BUMPMAP":"",v.normalMap?
"#define USE_NORMALMAP":"",v.displacementMap&&v.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",v.specularMap?"#define USE_SPECULARMAP":"",v.roughnessMap?"#define USE_ROUGHNESSMAP":"",v.metalnessMap?"#define USE_METALNESSMAP":"",v.alphaMap?"#define USE_ALPHAMAP":"",v.vertexColors?"#define USE_COLOR":"",v.flatShading?"#define FLAT_SHADED":"",v.skinning?"#define USE_SKINNING":"",v.useVertexTexture?"#define BONE_TEXTURE":"",v.morphTargets?"#define USE_MORPHTARGETS":"",v.morphNormals&&!1===v.flatShading?
"#define USE_MORPHNORMALS":"",v.doubleSided?"#define DOUBLE_SIDED":"",v.flipSided?"#define FLIP_SIDED":"",v.shadowMapEnabled?"#define USE_SHADOWMAP":"",v.shadowMapEnabled?"#define "+z:"",0<v.pointLightShadows?"#define POINT_LIGHT_SHADOWS":"",v.sizeAttenuation?"#define USE_SIZEATTENUATION":"",v.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",v.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;",
"uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;",
"\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(f).join("\n"),a=[A,"precision "+v.precision+" float;","precision "+v.precision+" int;","#define SHADER_NAME "+t.__webglShader.name,K,v.alphaTest?"#define ALPHATEST "+
v.alphaTest:"","#define GAMMA_FACTOR "+L,v.useFog&&v.fog?"#define USE_FOG":"",v.useFog&&v.fogExp?"#define FOG_EXP2":"",v.map?"#define USE_MAP":"",v.envMap?"#define USE_ENVMAP":"",v.envMap?"#define "+F:"",v.envMap?"#define "+G:"",v.envMap?"#define "+C:"",v.lightMap?"#define USE_LIGHTMAP":"",v.aoMap?"#define USE_AOMAP":"",v.emissiveMap?"#define USE_EMISSIVEMAP":"",v.bumpMap?"#define USE_BUMPMAP":"",v.normalMap?"#define USE_NORMALMAP":"",v.specularMap?"#define USE_SPECULARMAP":"",v.roughnessMap?"#define USE_ROUGHNESSMAP":
"",v.metalnessMap?"#define USE_METALNESSMAP":"",v.alphaMap?"#define USE_ALPHAMAP":"",v.vertexColors?"#define USE_COLOR":"",v.flatShading?"#define FLAT_SHADED":"",v.doubleSided?"#define DOUBLE_SIDED":"",v.flipSided?"#define FLIP_SIDED":"",v.shadowMapEnabled?"#define USE_SHADOWMAP":"",v.shadowMapEnabled?"#define "+z:"",0<v.pointLightShadows?"#define POINT_LIGHT_SHADOWS":"",v.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",v.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",v.logarithmicDepthBuffer?
"#define USE_LOGDEPTHBUF":"",v.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",v.envMap&&a.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",v.toneMapping!==THREE.NoToneMapping?"#define TONE_MAPPING":"",v.toneMapping!==THREE.NoToneMapping?THREE.ShaderChunk.tonemapping_pars_fragment:"",v.toneMapping!==THREE.NoToneMapping?e("toneMapping",v.toneMapping):"",v.outputEncoding||v.mapEncoding||
v.envMapEncoding||v.emissiveMapEncoding?THREE.ShaderChunk.encodings_pars_fragment:"",v.mapEncoding?b("mapTexelToLinear",v.mapEncoding):"",v.envMapEncoding?b("envMapTexelToLinear",v.envMapEncoding):"",v.emissiveMapEncoding?b("emissiveMapTexelToLinear",v.emissiveMapEncoding):"",v.outputEncoding?c("linearToOutputTexel",v.outputEncoding):"","\n"].filter(f).join("\n"));D=k(D,v);D=h(D,v);B=k(B,v);B=h(B,v);!1===t instanceof THREE.ShaderMaterial&&(D=l(D),B=l(B));B=a+B;D=THREE.WebGLShader(r,r.VERTEX_SHADER,
w+D);B=THREE.WebGLShader(r,r.FRAGMENT_SHADER,B);r.attachShader(H,D);r.attachShader(H,B);void 0!==t.index0AttributeName?r.bindAttribLocation(H,0,t.index0AttributeName):!0===v.morphTargets&&r.bindAttribLocation(H,0,"position");r.linkProgram(H);v=r.getProgramInfoLog(H);z=r.getShaderInfoLog(D);F=r.getShaderInfoLog(B);C=G=!0;if(!1===r.getProgramParameter(H,r.LINK_STATUS))G=!1,console.error("THREE.WebGLProgram: shader error: ",r.getError(),"gl.VALIDATE_STATUS",r.getProgramParameter(H,r.VALIDATE_STATUS),
"gl.getProgramInfoLog",v,z,F);else if(""!==v)console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",v);else if(""===z||""===F)C=!1;C&&(this.diagnostics={runnable:G,material:t,programLog:v,vertexShader:{log:z,prefix:w},fragmentShader:{log:F,prefix:a}});r.deleteShader(D);r.deleteShader(B);var M;this.getUniforms=function(){if(void 0===M){for(var a={},b=r.getProgramParameter(H,r.ACTIVE_UNIFORMS),c=0;c<b;c++){var d=r.getActiveUniform(H,c).name,e=r.getUniformLocation(H,d),f=q.exec(d);if(f){var d=f[1],
f=f[2],g=a[d];g||(g=a[d]={});g[f]=e}else if(f=m.exec(d)){var g=f[1],d=f[2],f=f[3],h=a[g];h||(h=a[g]=[]);(g=h[d])||(g=h[d]={});g[f]=e}else(f=p.exec(d))?(g=f[1],a[g]=e):a[d]=e}M=a}return M};var E;this.getAttributes=function(){if(void 0===E){for(var a={},b=r.getProgramParameter(H,r.ACTIVE_ATTRIBUTES),c=0;c<b;c++){var d=r.getActiveAttrib(H,c).name;a[d]=r.getAttribLocation(H,d)}E=a}return E};this.destroy=function(){r.deleteProgram(H);this.program=void 0};Object.defineProperties(this,{uniforms:{get:function(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");
return this.getUniforms()}},attributes:{get:function(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.id=n++;this.code=u;this.usedTimes=1;this.program=H;this.vertexShader=D;this.fragmentShader=B;return this}}();
THREE.WebGLPrograms=function(a,b){function c(a,b){var c;a?a instanceof THREE.Texture?c=a.encoding:a instanceof THREE.WebGLRenderTarget&&(c=a.texture.encoding):c=THREE.LinearEncoding;c===THREE.LinearEncoding&&b&&(c=THREE.GammaEncoding);return c}var e=[],d={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshStandardMaterial:"standard",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},
g="precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap displacementMap specularMap roughnessMap metalnessMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights shadowMapEnabled pointLightShadows toneMapping physicallyCorrectLights shadowMapType alphaTest doubleSided flipSided".split(" ");
this.getParameters=function(e,g,k,l){var f=d[e.type],h;b.floatVertexTextures&&l&&l.skeleton&&l.skeleton.useVertexTexture?h=1024:(h=Math.floor((b.maxVertexUniforms-20)/4),void 0!==l&&l instanceof THREE.SkinnedMesh&&(h=Math.min(l.skeleton.bones.length,h),h<l.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+l.skeleton.bones.length+", this GPU supports just "+h+" (try OpenGL instead of ANGLE)")));var m=a.getPrecision();null!==e.precision&&(m=b.getMaxPrecision(e.precision),m!==e.precision&&
console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",m,"instead."));return{shaderID:f,precision:m,supportsVertexTextures:b.vertexTextures,outputEncoding:c(a.getCurrentRenderTarget(),a.gammaOutput),map:!!e.map,mapEncoding:c(e.map,a.gammaInput),envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,envMapEncoding:c(e.envMap,a.gammaInput),envMapCubeUV:!!e.envMap&&(e.envMap.mapping===THREE.CubeUVReflectionMapping||e.envMap.mapping===THREE.CubeUVRefractionMapping),lightMap:!!e.lightMap,
aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:c(e.emissiveMap,a.gammaInput),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,combine:e.combine,vertexColors:e.vertexColors,fog:k,useFog:e.fog,fogExp:k instanceof THREE.FogExp2,flatShading:e.shading===THREE.FlatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:b.logarithmicDepthBuffer,
skinning:e.skinning,maxBones:h,useVertexTexture:b.floatVertexTextures&&l&&l.skeleton&&l.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:g.directional.length,numPointLights:g.point.length,numSpotLights:g.spot.length,numHemiLights:g.hemi.length,pointLightShadows:g.shadowsPointLight,shadowMapEnabled:a.shadowMap.enabled&&l.receiveShadow&&0<g.shadows.length,shadowMapType:a.shadowMap.type,
toneMapping:a.toneMapping,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide}};this.getProgramCode=function(a,b){var c=[];b.shaderID?c.push(b.shaderID):(c.push(a.fragmentShader),c.push(a.vertexShader));if(void 0!==a.defines)for(var d in a.defines)c.push(d),c.push(a.defines[d]);for(d=0;d<g.length;d++){var e=g[d];c.push(e);c.push(b[e])}return c.join()};this.acquireProgram=
function(b,c,d){for(var f,g=0,h=e.length;g<h;g++){var m=e[g];if(m.code===d){f=m;++f.usedTimes;break}}void 0===f&&(f=new THREE.WebGLProgram(a,d,b,c),e.push(f));return f};this.releaseProgram=function(a){if(0===--a.usedTimes){var b=e.indexOf(a);e[b]=e[e.length-1];e.pop();a.destroy()}};this.programs=e};THREE.WebGLProperties=function(){var a={};this.get=function(b){b=b.uuid;var c=a[b];void 0===c&&(c={},a[b]=c);return c};this["delete"]=function(b){delete a[b.uuid]};this.clear=function(){a={}}};
THREE.WebGLShader=function(){function a(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+": "+a[b];return a.join("\n")}return function(b,c,e){var d=b.createShader(c);b.shaderSource(d,e);b.compileShader(d);!1===b.getShaderParameter(d,b.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");""!==b.getShaderInfoLog(d)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",c===b.VERTEX_SHADER?"vertex":"fragment",b.getShaderInfoLog(d),a(e));return d}}();
THREE.WebGLShadowMap=function(a,b,c){function e(a,b,c,d){var e=a.geometry,f;f=p;var g=a.customDepthMaterial;c&&(f=r,g=a.customDistanceMaterial);g?f=g:(a=a instanceof THREE.SkinnedMesh&&b.skinning,g=0,void 0!==e.morphTargets&&0<e.morphTargets.length&&b.morphTargets&&(g|=1),a&&(g|=2),f=f[g]);f.visible=b.visible;f.wireframe=b.wireframe;f.wireframeLinewidth=b.wireframeLinewidth;c&&void 0!==f.uniforms.lightPos&&f.uniforms.lightPos.value.copy(d);return f}function d(a,b,c){if(!1!==a.visible){a.layers.test(b.layers)&&
(a instanceof THREE.Mesh||a instanceof THREE.Line||a instanceof THREE.Points)&&a.castShadow&&(!1===a.frustumCulled||!0===h.intersectsObject(a))&&!0===a.material.visible&&(a.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,a.matrixWorld),m.push(a));a=a.children;for(var e=0,f=a.length;e<f;e++)d(a[e],b,c)}}for(var g=a.context,f=a.state,h=new THREE.Frustum,k=new THREE.Matrix4,l=new THREE.Vector2,n=new THREE.Vector3,q=new THREE.Vector3,m=[],p=Array(4),r=Array(4),u=[new THREE.Vector3(1,0,0),new THREE.Vector3(-1,
0,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,-1),new THREE.Vector3(0,1,0),new THREE.Vector3(0,-1,0)],t=[new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,-1)],v=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],x=THREE.ShaderLib.depthRGBA,A=THREE.UniformsUtils.clone(x.uniforms),w=THREE.ShaderLib.distanceRGBA,D=THREE.UniformsUtils.clone(w.uniforms),
B=0;4!==B;++B){var z=0!==(B&1),F=0!==(B&2),G=new THREE.ShaderMaterial({uniforms:A,vertexShader:x.vertexShader,fragmentShader:x.fragmentShader,morphTargets:z,skinning:F});p[B]=G;z=new THREE.ShaderMaterial({defines:{USE_SHADOWMAP:""},uniforms:D,vertexShader:w.vertexShader,fragmentShader:w.fragmentShader,morphTargets:z,skinning:F});r[B]=z}var C=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=THREE.PCFShadowMap;this.cullFace=THREE.CullFaceFront;this.render=function(p,r){var x,w,
A=b.shadows;if(0!==A.length&&!1!==C.enabled&&(!1!==C.autoUpdate||!1!==C.needsUpdate)){f.clearColor(1,1,1,1);f.disable(g.BLEND);f.enable(g.CULL_FACE);g.frontFace(g.CCW);g.cullFace(C.cullFace===THREE.CullFaceFront?g.FRONT:g.BACK);f.setDepthTest(!0);f.setScissorTest(!1);for(var z=0,B=A.length;z<B;z++){var G=A[z],D=G.shadow,F=D.camera;l.copy(D.mapSize);if(G instanceof THREE.PointLight){x=6;w=!0;var K=l.x,I=l.y;v[0].set(2*K,I,K,I);v[1].set(0,I,K,I);v[2].set(3*K,I,K,I);v[3].set(K,I,K,I);v[4].set(3*K,0,
K,I);v[5].set(K,0,K,I);l.x*=4;l.y*=2}else x=1,w=!1;null===D.map&&(D.map=new THREE.WebGLRenderTarget(l.x,l.y,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat}),G instanceof THREE.SpotLight&&(F.aspect=l.x/l.y),F.updateProjectionMatrix());K=D.map;D=D.matrix;q.setFromMatrixPosition(G.matrixWorld);F.position.copy(q);a.setRenderTarget(K);a.clear();for(K=0;K<x;K++){w?(n.copy(F.position),n.add(u[K]),F.up.copy(t[K]),F.lookAt(n),f.viewport(v[K])):(n.setFromMatrixPosition(G.target.matrixWorld),
F.lookAt(n));F.updateMatrixWorld();F.matrixWorldInverse.getInverse(F.matrixWorld);D.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);D.multiply(F.projectionMatrix);D.multiply(F.matrixWorldInverse);k.multiplyMatrices(F.projectionMatrix,F.matrixWorldInverse);h.setFromMatrix(k);m.length=0;d(p,r,F);for(var I=0,L=m.length;I<L;I++){var R=m[I],V=c.update(R),X=R.material;if(X instanceof THREE.MultiMaterial)for(var aa=V.groups,X=X.materials,U=0,T=aa.length;U<T;U++){var Y=aa[U],fa=X[Y.materialIndex];!0===fa.visible&&
(fa=e(R,fa,w,q),a.renderBufferDirect(F,null,V,fa,R,Y))}else fa=e(R,X,w,q),a.renderBufferDirect(F,null,V,fa,R,null)}}}x=a.getClearColor();w=a.getClearAlpha();a.setClearColor(x,w);f.enable(g.BLEND);C.cullFace===THREE.CullFaceFront&&g.cullFace(g.BACK);C.needsUpdate=!1}}};
THREE.WebGLState=function(a,b,c){var e=this,d=new THREE.Vector4,g=new Uint8Array(16),f=new Uint8Array(16),h=new Uint8Array(16),k={},l=null,n=null,q=null,m=null,p=null,r=null,u=null,t=null,v=!1,x=null,A=null,w=null,D=null,B=null,z=null,F=null,G=null,C=null,L=null,K=null,H=null,M=null,E=null,J=null,N=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),P=void 0,Q={},O=new THREE.Vector4,S=null,I=null,ba=new THREE.Vector4,R=new THREE.Vector4,V=a.createTexture();a.bindTexture(a.TEXTURE_2D,V);a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_MIN_FILTER,a.LINEAR);a.texImage2D(a.TEXTURE_2D,0,a.RGB,1,1,0,a.RGB,a.UNSIGNED_BYTE,new Uint8Array(3));this.init=function(){this.clearColor(0,0,0,1);this.clearDepth(1);this.clearStencil(0);this.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.frontFace(a.CCW);a.cullFace(a.BACK);this.enable(a.CULL_FACE);this.enable(a.BLEND);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA)};this.initAttributes=function(){for(var a=0,b=g.length;a<b;a++)g[a]=0};this.enableAttribute=function(c){g[c]=
1;0===f[c]&&(a.enableVertexAttribArray(c),f[c]=1);0!==h[c]&&(b.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(c,0),h[c]=0)};this.enableAttributeAndDivisor=function(b,c,d){g[b]=1;0===f[b]&&(a.enableVertexAttribArray(b),f[b]=1);h[b]!==c&&(d.vertexAttribDivisorANGLE(b,c),h[b]=c)};this.disableUnusedAttributes=function(){for(var b=0,c=f.length;b<c;b++)f[b]!==g[b]&&(a.disableVertexAttribArray(b),f[b]=0)};this.enable=function(b){!0!==k[b]&&(a.enable(b),k[b]=!0)};this.disable=function(b){!1!==k[b]&&
(a.disable(b),k[b]=!1)};this.getCompressedTextureFormats=function(){if(null===l&&(l=[],b.get("WEBGL_compressed_texture_pvrtc")||b.get("WEBGL_compressed_texture_s3tc")||b.get("WEBGL_compressed_texture_etc1")))for(var c=a.getParameter(a.COMPRESSED_TEXTURE_FORMATS),d=0;d<c.length;d++)l.push(c[d]);return l};this.setBlending=function(b,d,e,f,g,h,k,l){b===THREE.NoBlending?this.disable(a.BLEND):this.enable(a.BLEND);if(b!==n||l!==v)b===THREE.AdditiveBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),
a.blendFuncSeparate(a.ONE,a.ONE,a.ONE,a.ONE)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):b===THREE.SubtractiveBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):b===THREE.MultiplyBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.SRC_COLOR,a.SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),
a.blendFunc(a.ZERO,a.SRC_COLOR)):l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),n=b,v=l;if(b===THREE.CustomBlending){g=g||d;h=h||e;k=k||f;if(d!==q||g!==r)a.blendEquationSeparate(c(d),c(g)),q=d,r=g;if(e!==m||f!==p||h!==u||k!==t)a.blendFuncSeparate(c(e),c(f),c(h),c(k)),m=e,p=f,u=h,t=k}else t=
u=r=p=m=q=null};this.setDepthFunc=function(b){if(x!==b){if(b)switch(b){case THREE.NeverDepth:a.depthFunc(a.NEVER);break;case THREE.AlwaysDepth:a.depthFunc(a.ALWAYS);break;case THREE.LessDepth:a.depthFunc(a.LESS);break;case THREE.LessEqualDepth:a.depthFunc(a.LEQUAL);break;case THREE.EqualDepth:a.depthFunc(a.EQUAL);break;case THREE.GreaterEqualDepth:a.depthFunc(a.GEQUAL);break;case THREE.GreaterDepth:a.depthFunc(a.GREATER);break;case THREE.NotEqualDepth:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}else a.depthFunc(a.LEQUAL);
x=b}};this.setDepthTest=function(b){b?this.enable(a.DEPTH_TEST):this.disable(a.DEPTH_TEST)};this.setDepthWrite=function(b){A!==b&&(a.depthMask(b),A=b)};this.setColorWrite=function(b){w!==b&&(a.colorMask(b,b,b,b),w=b)};this.setStencilFunc=function(b,c,d){if(B!==b||z!==c||F!==d)a.stencilFunc(b,c,d),B=b,z=c,F=d};this.setStencilOp=function(b,c,d){if(G!==b||C!==c||L!==d)a.stencilOp(b,c,d),G=b,C=c,L=d};this.setStencilTest=function(b){b?this.enable(a.STENCIL_TEST):this.disable(a.STENCIL_TEST)};this.setStencilWrite=
function(b){D!==b&&(a.stencilMask(b),D=b)};this.setFlipSided=function(b){K!==b&&(b?a.frontFace(a.CW):a.frontFace(a.CCW),K=b)};this.setLineWidth=function(b){b!==H&&(a.lineWidth(b),H=b)};this.setPolygonOffset=function(b,c,d){b?this.enable(a.POLYGON_OFFSET_FILL):this.disable(a.POLYGON_OFFSET_FILL);!b||M===c&&E===d||(a.polygonOffset(c,d),M=c,E=d)};this.getScissorTest=function(){return J};this.setScissorTest=function(b){(J=b)?this.enable(a.SCISSOR_TEST):this.disable(a.SCISSOR_TEST)};this.activeTexture=
function(b){void 0===b&&(b=a.TEXTURE0+N-1);P!==b&&(a.activeTexture(b),P=b)};this.bindTexture=function(b,c){void 0===P&&e.activeTexture();var d=Q[P];void 0===d&&(d={type:void 0,texture:void 0},Q[P]=d);if(d.type!==b||d.texture!==c)a.bindTexture(b,c||V),d.type=b,d.texture=c};this.compressedTexImage2D=function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(X){console.error(X)}};this.texImage2D=function(){try{a.texImage2D.apply(a,arguments)}catch(X){console.error(X)}};this.clearColor=function(b,
c,e,f){d.set(b,c,e,f);!1===O.equals(d)&&(a.clearColor(b,c,e,f),O.copy(d))};this.clearDepth=function(b){S!==b&&(a.clearDepth(b),S=b)};this.clearStencil=function(b){I!==b&&(a.clearStencil(b),I=b)};this.scissor=function(b){!1===ba.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),ba.copy(b))};this.viewport=function(b){!1===R.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),R.copy(b))};this.reset=function(){for(var b=0;b<f.length;b++)1===f[b]&&(a.disableVertexAttribArray(b),f[b]=0);k={};l=null;P=void 0;Q={};K=D=A=w=n=null}};
THREE.LensFlarePlugin=function(a,b){var c,e,d,g,f,h,k,l,n,q,m=a.context,p=a.state,r,u,t,v,x,A;this.render=function(w,D,B){if(0!==b.length){w=new THREE.Vector3;var z=B.w/B.z,F=.5*B.z,G=.5*B.w,C=16/B.w,L=new THREE.Vector2(C*z,C),K=new THREE.Vector3(1,1,0),H=new THREE.Vector2(1,1);if(void 0===t){var C=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),M=new Uint16Array([0,1,2,0,2,3]);r=m.createBuffer();u=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,r);m.bufferData(m.ARRAY_BUFFER,C,m.STATIC_DRAW);
m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,u);m.bufferData(m.ELEMENT_ARRAY_BUFFER,M,m.STATIC_DRAW);x=m.createTexture();A=m.createTexture();p.bindTexture(m.TEXTURE_2D,x);m.texImage2D(m.TEXTURE_2D,0,m.RGB,16,16,0,m.RGB,m.UNSIGNED_BYTE,null);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST);p.bindTexture(m.TEXTURE_2D,
A);m.texImage2D(m.TEXTURE_2D,0,m.RGBA,16,16,0,m.RGBA,m.UNSIGNED_BYTE,null);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST);var C=(v=0<m.getParameter(m.MAX_VERTEX_TEXTURE_IMAGE_UNITS))?{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},
M=m.createProgram(),E=m.createShader(m.FRAGMENT_SHADER),J=m.createShader(m.VERTEX_SHADER),N="precision "+a.getPrecision()+" float;\n";m.shaderSource(E,N+C.fragmentShader);m.shaderSource(J,N+C.vertexShader);m.compileShader(E);m.compileShader(J);m.attachShader(M,E);m.attachShader(M,J);m.linkProgram(M);t=M;n=m.getAttribLocation(t,"position");q=m.getAttribLocation(t,"uv");c=m.getUniformLocation(t,"renderType");e=m.getUniformLocation(t,"map");d=m.getUniformLocation(t,"occlusionMap");g=m.getUniformLocation(t,
"opacity");f=m.getUniformLocation(t,"color");h=m.getUniformLocation(t,"scale");k=m.getUniformLocation(t,"rotation");l=m.getUniformLocation(t,"screenPosition")}m.useProgram(t);p.initAttributes();p.enableAttribute(n);p.enableAttribute(q);p.disableUnusedAttributes();m.uniform1i(d,0);m.uniform1i(e,1);m.bindBuffer(m.ARRAY_BUFFER,r);m.vertexAttribPointer(n,2,m.FLOAT,!1,16,0);m.vertexAttribPointer(q,2,m.FLOAT,!1,16,8);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,u);p.disable(m.CULL_FACE);p.setDepthWrite(!1);M=0;
for(E=b.length;M<E;M++)if(C=16/B.w,L.set(C*z,C),J=b[M],w.set(J.matrixWorld.elements[12],J.matrixWorld.elements[13],J.matrixWorld.elements[14]),w.applyMatrix4(D.matrixWorldInverse),w.applyProjection(D.projectionMatrix),K.copy(w),H.x=K.x*F+F,H.y=K.y*G+G,v||0<H.x&&H.x<B.z&&0<H.y&&H.y<B.w){p.activeTexture(m.TEXTURE0);p.bindTexture(m.TEXTURE_2D,null);p.activeTexture(m.TEXTURE1);p.bindTexture(m.TEXTURE_2D,x);m.copyTexImage2D(m.TEXTURE_2D,0,m.RGB,B.x+H.x-8,B.y+H.y-8,16,16,0);m.uniform1i(c,0);m.uniform2f(h,
L.x,L.y);m.uniform3f(l,K.x,K.y,K.z);p.disable(m.BLEND);p.enable(m.DEPTH_TEST);m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0);p.activeTexture(m.TEXTURE0);p.bindTexture(m.TEXTURE_2D,A);m.copyTexImage2D(m.TEXTURE_2D,0,m.RGBA,B.x+H.x-8,B.y+H.y-8,16,16,0);m.uniform1i(c,1);p.disable(m.DEPTH_TEST);p.activeTexture(m.TEXTURE1);p.bindTexture(m.TEXTURE_2D,x);m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0);J.positionScreen.copy(K);J.customUpdateCallback?J.customUpdateCallback(J):J.updateLensFlares();m.uniform1i(c,
2);p.enable(m.BLEND);for(var N=0,P=J.lensFlares.length;N<P;N++){var Q=J.lensFlares[N];.001<Q.opacity&&.001<Q.scale&&(K.x=Q.x,K.y=Q.y,K.z=Q.z,C=Q.size*Q.scale/B.w,L.x=C*z,L.y=C,m.uniform3f(l,K.x,K.y,K.z),m.uniform2f(h,L.x,L.y),m.uniform1f(k,Q.rotation),m.uniform1f(g,Q.opacity),m.uniform3f(f,Q.color.r,Q.color.g,Q.color.b),p.setBlending(Q.blending,Q.blendEquation,Q.blendSrc,Q.blendDst),a.setTexture(Q.texture,1),m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0))}}p.enable(m.CULL_FACE);p.enable(m.DEPTH_TEST);
p.setDepthWrite(!0);a.resetGLState()}}};
THREE.SpritePlugin=function(a,b){function c(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:b.id-a.id}var e,d,g,f,h,k,l,n,q,m,p,r,u,t,v,x,A,w=a.context,D=a.state,B,z,F,G,C=new THREE.Vector3,L=new THREE.Quaternion,K=new THREE.Vector3;this.render=function(H,M){if(0!==b.length){if(void 0===F){var E=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),J=new Uint16Array([0,1,2,0,2,3]);B=w.createBuffer();z=w.createBuffer();w.bindBuffer(w.ARRAY_BUFFER,B);
w.bufferData(w.ARRAY_BUFFER,E,w.STATIC_DRAW);w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,z);w.bufferData(w.ELEMENT_ARRAY_BUFFER,J,w.STATIC_DRAW);var E=w.createProgram(),J=w.createShader(w.VERTEX_SHADER),N=w.createShader(w.FRAGMENT_SHADER);w.shaderSource(J,["precision "+a.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));
w.shaderSource(N,["precision "+a.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));
w.compileShader(J);w.compileShader(N);w.attachShader(E,J);w.attachShader(E,N);w.linkProgram(E);F=E;x=w.getAttribLocation(F,"position");A=w.getAttribLocation(F,"uv");e=w.getUniformLocation(F,"uvOffset");d=w.getUniformLocation(F,"uvScale");g=w.getUniformLocation(F,"rotation");f=w.getUniformLocation(F,"scale");h=w.getUniformLocation(F,"color");k=w.getUniformLocation(F,"map");l=w.getUniformLocation(F,"opacity");n=w.getUniformLocation(F,"modelViewMatrix");q=w.getUniformLocation(F,"projectionMatrix");m=
w.getUniformLocation(F,"fogType");p=w.getUniformLocation(F,"fogDensity");r=w.getUniformLocation(F,"fogNear");u=w.getUniformLocation(F,"fogFar");t=w.getUniformLocation(F,"fogColor");v=w.getUniformLocation(F,"alphaTest");E=document.createElement("canvas");E.width=8;E.height=8;J=E.getContext("2d");J.fillStyle="white";J.fillRect(0,0,8,8);G=new THREE.Texture(E);G.needsUpdate=!0}w.useProgram(F);D.initAttributes();D.enableAttribute(x);D.enableAttribute(A);D.disableUnusedAttributes();D.disable(w.CULL_FACE);
D.enable(w.BLEND);w.bindBuffer(w.ARRAY_BUFFER,B);w.vertexAttribPointer(x,2,w.FLOAT,!1,16,0);w.vertexAttribPointer(A,2,w.FLOAT,!1,16,8);w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,z);w.uniformMatrix4fv(q,!1,M.projectionMatrix.elements);D.activeTexture(w.TEXTURE0);w.uniform1i(k,0);J=E=0;(N=H.fog)?(w.uniform3f(t,N.color.r,N.color.g,N.color.b),N instanceof THREE.Fog?(w.uniform1f(r,N.near),w.uniform1f(u,N.far),w.uniform1i(m,1),J=E=1):N instanceof THREE.FogExp2&&(w.uniform1f(p,N.density),w.uniform1i(m,2),J=E=2)):
(w.uniform1i(m,0),J=E=0);for(var N=0,P=b.length;N<P;N++){var Q=b[N];Q.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,Q.matrixWorld);Q.z=-Q.modelViewMatrix.elements[14]}b.sort(c);for(var O=[],N=0,P=b.length;N<P;N++){var Q=b[N],S=Q.material;w.uniform1f(v,S.alphaTest);w.uniformMatrix4fv(n,!1,Q.modelViewMatrix.elements);Q.matrixWorld.decompose(C,L,K);O[0]=K.x;O[1]=K.y;Q=0;H.fog&&S.fog&&(Q=J);E!==Q&&(w.uniform1i(m,Q),E=Q);null!==S.map?(w.uniform2f(e,S.map.offset.x,S.map.offset.y),w.uniform2f(d,
S.map.repeat.x,S.map.repeat.y)):(w.uniform2f(e,0,0),w.uniform2f(d,1,1));w.uniform1f(l,S.opacity);w.uniform3f(h,S.color.r,S.color.g,S.color.b);w.uniform1f(g,S.rotation);w.uniform2fv(f,O);D.setBlending(S.blending,S.blendEquation,S.blendSrc,S.blendDst);D.setDepthTest(S.depthTest);D.setDepthWrite(S.depthWrite);S.map&&S.map.image&&S.map.image.width?a.setTexture(S.map,0):a.setTexture(G,0);w.drawElements(w.TRIANGLES,6,w.UNSIGNED_SHORT,0)}D.enable(w.CULL_FACE);a.resetGLState()}}};
Object.defineProperties(THREE.Box2.prototype,{empty:{value:function(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");return this.isEmpty()}},isIntersectionBox:{value:function(a){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)}}});
Object.defineProperties(THREE.Box3.prototype,{empty:{value:function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()}},isIntersectionBox:{value:function(a){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)}},isIntersectionSphere:{value:function(a){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)}}});
Object.defineProperties(THREE.Matrix3.prototype,{multiplyVector3:{value:function(a){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)}},multiplyVector3Array:{value:function(a){console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)}}});
Object.defineProperties(THREE.Matrix4.prototype,{extractPosition:{value:function(a){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(a)}},setRotationFromQuaternion:{value:function(a){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(a)}},multiplyVector3:{value:function(a){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");
return a.applyProjection(this)}},multiplyVector4:{value:function(a){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)}},multiplyVector3Array:{value:function(a){console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)}},rotateAxis:{value:function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");
a.transformDirection(this)}},crossVector:{value:function(a){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)}},translate:{value:function(a){console.error("THREE.Matrix4: .translate() has been removed.")}},rotateX:{value:function(a){console.error("THREE.Matrix4: .rotateX() has been removed.")}},rotateY:{value:function(a){console.error("THREE.Matrix4: .rotateY() has been removed.")}},rotateZ:{value:function(a){console.error("THREE.Matrix4: .rotateZ() has been removed.")}},
rotateByAxis:{value:function(a,b){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")}}});Object.defineProperties(THREE.Plane.prototype,{isIntersectionLine:{value:function(a){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");return this.intersectsLine(a)}}});
Object.defineProperties(THREE.Quaternion.prototype,{multiplyVector3:{value:function(a){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return a.applyQuaternion(this)}}});
Object.defineProperties(THREE.Ray.prototype,{isIntersectionBox:{value:function(a){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)}},isIntersectionPlane:{value:function(a){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");return this.intersectsPlane(a)}},isIntersectionSphere:{value:function(a){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)}}});
Object.defineProperties(THREE.Vector3.prototype,{setEulerFromRotationMatrix:{value:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")}},setEulerFromQuaternion:{value:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")}},getPositionFromMatrix:{value:function(a){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");
return this.setFromMatrixPosition(a)}},getScaleFromMatrix:{value:function(a){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(a)}},getColumnFromMatrix:{value:function(a,b){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(a,b)}}});
THREE.Face4=function(a,b,c,e,d,g,f){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new THREE.Face3(a,b,c,d,g,f)};THREE.Vertex=function(a,b,c){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");return new THREE.Vector3(a,b,c)};
Object.defineProperties(THREE.Object3D.prototype,{eulerOrder:{get:function(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function(a){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=a}},getChildByName:{value:function(a){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(a)}},renderDepth:{set:function(a){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")}},
translate:{value:function(a,b){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(b,a)}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(a){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});
Object.defineProperties(THREE,{PointCloud:{value:function(a,b){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new THREE.Points(a,b)}},ParticleSystem:{value:function(a,b){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new THREE.Points(a,b)}}});
Object.defineProperties(THREE.Light.prototype,{onlyShadow:{set:function(a){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(a){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");this.shadow.camera.fov=a}},shadowCameraLeft:{set:function(a){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=a}},shadowCameraRight:{set:function(a){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");
this.shadow.camera.right=a}},shadowCameraTop:{set:function(a){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");this.shadow.camera.top=a}},shadowCameraBottom:{set:function(a){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");this.shadow.camera.bottom=a}},shadowCameraNear:{set:function(a){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=a}},shadowCameraFar:{set:function(a){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");
this.shadow.camera.far=a}},shadowCameraVisible:{set:function(a){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(a){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");this.shadow.bias=a}},shadowDarkness:{set:function(a){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(a){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");
this.shadow.mapSize.width=a}},shadowMapHeight:{set:function(a){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=a}}});Object.defineProperties(THREE.BufferAttribute.prototype,{length:{get:function(){console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count.");return this.array.length}}});
Object.defineProperties(THREE.BufferGeometry.prototype,{drawcalls:{get:function(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups}},addIndex:{value:function(a){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(a)}},addDrawCall:{value:function(a,b,c){void 0!==c&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.");
console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(a,b)}},clearDrawCalls:{value:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()}},computeTangents:{value:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")}},computeOffsets:{value:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}});
Object.defineProperties(THREE.Material.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(a){console.warn("THREE."+this.type+": .wrapAround has been removed.")}},wrapRGB:{get:function(){console.warn("THREE."+this.type+": .wrapRGB has been removed.");return new THREE.Color}}});
Object.defineProperties(THREE,{PointCloudMaterial:{value:function(a){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new THREE.PointsMaterial(a)}},ParticleBasicMaterial:{value:function(a){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new THREE.PointsMaterial(a)}},ParticleSystemMaterial:{value:function(a){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new THREE.PointsMaterial(a)}}});
Object.defineProperties(THREE.MeshPhongMaterial.prototype,{metal:{get:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.");return!1},set:function(a){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});
Object.defineProperties(THREE.ShaderMaterial.prototype,{derivatives:{get:function(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");return this.extensions.derivatives},set:function(a){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=a}}});
Object.defineProperties(THREE.WebGLRenderer.prototype,{supportsFloatTextures:{value:function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return this.extensions.get("OES_texture_float")}},supportsHalfFloatTextures:{value:function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return this.extensions.get("OES_texture_half_float")}},supportsStandardDerivatives:{value:function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");
return this.extensions.get("OES_standard_derivatives")}},supportsCompressedTextureS3TC:{value:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return this.extensions.get("WEBGL_compressed_texture_s3tc")}},supportsCompressedTexturePVRTC:{value:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")}},
supportsBlendMinMax:{value:function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")}},supportsVertexTextures:{value:function(){return this.capabilities.vertexTextures}},supportsInstancedArrays:{value:function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return this.extensions.get("ANGLE_instanced_arrays")}},enableScissorTest:{value:function(a){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");
this.setScissorTest(a)}},initMaterial:{value:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")}},addPrePlugin:{value:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")}},addPostPlugin:{value:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")}},updateShadowMap:{value:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}},shadowMapEnabled:{get:function(){return this.shadowMap.enabled},
set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=a}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");this.shadowMap.type=a}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.");this.shadowMap.cullFace=a}}});
Object.defineProperties(THREE.WebGLRenderTarget.prototype,{wrapS:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=a}},wrapT:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=
a}},magFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");return this.texture.magFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=a}},minFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=
a}},anisotropy:{get:function(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");return this.texture.anisotropy},set:function(a){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=a}},offset:{get:function(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function(a){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=
a}},repeat:{get:function(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},set:function(a){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=a}},format:{get:function(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function(a){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=a}},type:{get:function(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");
return this.texture.type},set:function(a){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");this.texture.type=a}},generateMipmaps:{get:function(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set:function(a){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=a}}});
THREE.GeometryUtils={merge:function(a,b,c){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var e;b instanceof THREE.Mesh&&(b.matrixAutoUpdate&&b.updateMatrix(),e=b.matrix,b=b.geometry);a.merge(b,e,c)},center:function(a){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return a.center()}};
THREE.ImageUtils={crossOrigin:void 0,loadTexture:function(a,b,c,e){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var d=new THREE.TextureLoader;d.setCrossOrigin(this.crossOrigin);a=d.load(a,c,void 0,e);b&&(a.mapping=b);return a},loadTextureCube:function(a,b,c,e){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var d=new THREE.CubeTextureLoader;d.setCrossOrigin(this.crossOrigin);a=d.load(a,
c,void 0,e);b&&(a.mapping=b);return a},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};
THREE.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};this.pickingRay=function(a,b){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};
THREE.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElement("canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};THREE.MeshFaceMaterial=THREE.MultiMaterial;
THREE.CurveUtils={tangentQuadraticBezier:function(a,b,c,e){return 2*(1-a)*(c-b)+2*a*(e-c)},tangentCubicBezier:function(a,b,c,e,d){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*e*(1-a)-3*a*a*e+3*a*a*d},tangentSpline:function(a,b,c,e,d){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(a,b,c,e,d){a=.5*(c-a);e=.5*(e-b);var g=d*d;return(2*b-2*c+a+e)*d*g+(-3*b+3*c-2*a-e)*g+a*d+b}};
THREE.SceneUtils={createMultiMaterialObject:function(a,b){for(var c=new THREE.Group,e=0,d=b.length;e<d;e++)c.add(new THREE.Mesh(a,b[e]));return c},detach:function(a,b,c){a.applyMatrix(b.matrixWorld);b.remove(a);c.add(a)},attach:function(a,b,c){var e=new THREE.Matrix4;e.getInverse(c.matrixWorld);a.applyMatrix(e);b.remove(a);c.add(a)}};
THREE.ShapeUtils={area:function(a){for(var b=a.length,c=0,e=b-1,d=0;d<b;e=d++)c+=a[e].x*a[d].y-a[d].x*a[e].y;return.5*c},triangulate:function(){return function(a,b){var c=a.length;if(3>c)return null;var e=[],d=[],g=[],f,h,k;if(0<THREE.ShapeUtils.area(a))for(h=0;h<c;h++)d[h]=h;else for(h=0;h<c;h++)d[h]=c-1-h;var l=2*c;for(h=c-1;2<c;){if(0>=l--){console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()");break}f=h;c<=f&&(f=0);h=f+1;c<=h&&(h=0);k=h+1;c<=k&&(k=0);var n;a:{var q,
m,p,r,u,t,v,x;q=a[d[f]].x;m=a[d[f]].y;p=a[d[h]].x;r=a[d[h]].y;u=a[d[k]].x;t=a[d[k]].y;if(Number.EPSILON>(p-q)*(t-m)-(r-m)*(u-q))n=!1;else{var A,w,D,B,z,F,G,C,L,K=void 0;L=C=G=x=v=void 0;A=u-p;w=t-r;D=q-u;B=m-t;z=p-q;F=r-m;for(n=0;n<c;n++)if(v=a[d[n]].x,x=a[d[n]].y,!(v===q&&x===m||v===p&&x===r||v===u&&x===t)&&(G=v-q,C=x-m,L=v-p,K=x-r,v-=u,x-=t,L=A*K-w*L,G=z*C-F*G,C=D*x-B*v,L>=-Number.EPSILON&&C>=-Number.EPSILON&&G>=-Number.EPSILON)){n=!1;break a}n=!0}}if(n){e.push([a[d[f]],a[d[h]],a[d[k]]]);g.push([d[f],
d[h],d[k]]);f=h;for(k=h+1;k<c;f++,k++)d[f]=d[k];c--;l=2*c}}return b?g:e}}(),triangulateShape:function(a,b){function c(a,b,c){return a.x!==b.x?a.x<b.x?a.x<=c.x&&c.x<=b.x:b.x<=c.x&&c.x<=a.x:a.y<b.y?a.y<=c.y&&c.y<=b.y:b.y<=c.y&&c.y<=a.y}function e(a,b,d,e,f){var g=b.x-a.x,h=b.y-a.y,m=e.x-d.x,k=e.y-d.y,l=a.x-d.x,p=a.y-d.y,r=h*m-g*k,n=h*l-g*p;if(Math.abs(r)>Number.EPSILON){if(0<r){if(0>n||n>r)return[];m=k*l-m*p;if(0>m||m>r)return[]}else{if(0<n||n<r)return[];m=k*l-m*p;if(0<m||m<r)return[]}if(0===m)return!f||
0!==n&&n!==r?[a]:[];if(m===r)return!f||0!==n&&n!==r?[b]:[];if(0===n)return[d];if(n===r)return[e];f=m/r;return[{x:a.x+f*g,y:a.y+f*h}]}if(0!==n||k*l!==m*p)return[];h=0===g&&0===h;m=0===m&&0===k;if(h&&m)return a.x!==d.x||a.y!==d.y?[]:[a];if(h)return c(d,e,a)?[a]:[];if(m)return c(a,b,d)?[d]:[];0!==g?(a.x<b.x?(g=a,m=a.x,h=b,a=b.x):(g=b,m=b.x,h=a,a=a.x),d.x<e.x?(b=d,r=d.x,k=e,d=e.x):(b=e,r=e.x,k=d,d=d.x)):(a.y<b.y?(g=a,m=a.y,h=b,a=b.y):(g=b,m=b.y,h=a,a=a.y),d.y<e.y?(b=d,r=d.y,k=e,d=e.y):(b=e,r=e.y,k=d,
d=d.y));return m<=r?a<r?[]:a===r?f?[]:[b]:a<=d?[b,h]:[b,k]:m>d?[]:m===d?f?[]:[g]:a<=d?[g,h]:[g,k]}function d(a,b,c,d){var e=b.x-a.x,f=b.y-a.y;b=c.x-a.x;c=c.y-a.y;var g=d.x-a.x;d=d.y-a.y;a=e*c-f*b;e=e*d-f*g;return Math.abs(a)>Number.EPSILON?(b=g*c-d*b,0<a?0<=e&&0<=b:0<=e||0<=b):0<e}var g,f,h,k,l,n={};h=a.concat();g=0;for(f=b.length;g<f;g++)Array.prototype.push.apply(h,b[g]);g=0;for(f=h.length;g<f;g++)l=h[g].x+":"+h[g].y,void 0!==n[l]&&console.warn("THREE.Shape: Duplicate point",l),n[l]=g;g=function(a,
b){function c(a,b){var c=h.length-1,e=a-1;0>e&&(e=c);var f=a+1;f>c&&(f=0);c=d(h[a],h[e],h[f],m[b]);if(!c)return!1;c=m.length-1;e=b-1;0>e&&(e=c);f=b+1;f>c&&(f=0);return d(m[b],m[e],m[f],h[a])?!0:!1}function f(a,b){var c,d;for(c=0;c<h.length;c++)if(d=c+1,d%=h.length,d=e(a,b,h[c],h[d],!0),0<d.length)return!0;return!1}function g(a,c){var d,f,g,h;for(d=0;d<k.length;d++)for(f=b[k[d]],g=0;g<f.length;g++)if(h=g+1,h%=f.length,h=e(a,c,f[g],f[h],!0),0<h.length)return!0;return!1}var h=a.concat(),m,k=[],l,p,n,
q,F,G=[],C,L,K,H=0;for(l=b.length;H<l;H++)k.push(H);C=0;for(var M=2*k.length;0<k.length;){M--;if(0>M){console.log("Infinite Loop! Holes left:"+k.length+", Probably Hole outside Shape!");break}for(p=C;p<h.length;p++){n=h[p];l=-1;for(H=0;H<k.length;H++)if(q=k[H],F=n.x+":"+n.y+":"+q,void 0===G[F]){m=b[q];for(L=0;L<m.length;L++)if(q=m[L],c(p,L)&&!f(n,q)&&!g(n,q)){l=L;k.splice(H,1);C=h.slice(0,p+1);q=h.slice(p);L=m.slice(l);K=m.slice(0,l+1);h=C.concat(L).concat(K).concat(q);C=p;break}if(0<=l)break;G[F]=
!0}if(0<=l)break}}return h}(a,b);var q=THREE.ShapeUtils.triangulate(g,!1);g=0;for(f=q.length;g<f;g++)for(k=q[g],h=0;3>h;h++)l=k[h].x+":"+k[h].y,l=n[l],void 0!==l&&(k[h]=l);return q.concat()},isClockWise:function(a){return 0>THREE.ShapeUtils.area(a)},b2:function(){return function(a,b,c,e){var d=1-a;return d*d*b+2*(1-a)*a*c+a*a*e}}(),b3:function(){return function(a,b,c,e,d){var g=1-a,f=1-a;return g*g*g*b+3*f*f*a*c+3*(1-a)*a*a*e+a*a*a*d}}()};THREE.Curve=function(){};
THREE.Curve.prototype={constructor:THREE.Curve,getPoint:function(a){console.warn("THREE.Curve: Warning, getPoint() not implemented!");return null},getPointAt:function(a){a=this.getUtoTmapping(a);return this.getPoint(a)},getPoints:function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPoint(b/a));return c},getSpacedPoints:function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPointAt(b/a));return c},getLength:function(){var a=this.getLengths();return a[a.length-1]},getLengths:function(a){a||
(a=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b=[],c,e=this.getPoint(0),d,g=0;b.push(0);for(d=1;d<=a;d++)c=this.getPoint(d/a),g+=c.distanceTo(e),b.push(g),e=c;return this.cacheArcLengths=b},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(a,b){var c=this.getLengths(),e=0,d=c.length,g;g=b?b:a*c[d-1];for(var f=0,h=d-
1,k;f<=h;)if(e=Math.floor(f+(h-f)/2),k=c[e]-g,0>k)f=e+1;else if(0<k)h=e-1;else{h=e;break}e=h;if(c[e]===g)return e/(d-1);f=c[e];return(e+(g-f)/(c[e+1]-f))/(d-1)},getTangent:function(a){var b=a-1E-4;a+=1E-4;0>b&&(b=0);1<a&&(a=1);b=this.getPoint(b);return this.getPoint(a).clone().sub(b).normalize()},getTangentAt:function(a){a=this.getUtoTmapping(a);return this.getTangent(a)}};
THREE.Curve.create=function(a,b){a.prototype=Object.create(THREE.Curve.prototype);a.prototype.constructor=a;a.prototype.getPoint=b;return a};THREE.CurvePath=function(){this.curves=[];this.autoClose=!1};THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype);THREE.CurvePath.prototype.constructor=THREE.CurvePath;THREE.CurvePath.prototype.add=function(a){this.curves.push(a)};
THREE.CurvePath.prototype.closePath=function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new THREE.LineCurve(b,a))};THREE.CurvePath.prototype.getPoint=function(a){for(var b=a*this.getLength(),c=this.getCurveLengths(),e=0;e<c.length;){if(c[e]>=b)return a=this.curves[e],b=1-(c[e]-b)/a.getLength(),a.getPointAt(b);e++}return null};THREE.CurvePath.prototype.getLength=function(){var a=this.getCurveLengths();return a[a.length-1]};
THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var a=[],b=0,c=0,e=this.curves.length;c<e;c++)b+=this.curves[c].getLength(),a.push(b);return this.cacheLengths=a};THREE.CurvePath.prototype.createPointsGeometry=function(a){a=this.getPoints(a);return this.createGeometry(a)};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(a){a=this.getSpacedPoints(a);return this.createGeometry(a)};
THREE.CurvePath.prototype.createGeometry=function(a){for(var b=new THREE.Geometry,c=0,e=a.length;c<e;c++){var d=a[c];b.vertices.push(new THREE.Vector3(d.x,d.y,d.z||0))}return b};THREE.Font=function(a){this.data=a};
THREE.Font.prototype={constructor:THREE.Font,generateShapes:function(a,b,c){void 0===b&&(b=100);void 0===c&&(c=4);var e=this.data;a=String(a).split("");var d=b/e.resolution,g=0;b=[];for(var f=0;f<a.length;f++){var h;h=d;var k=g,l=e.glyphs[a[f]]||e.glyphs["?"];if(l){var n=new THREE.Path,q=[],m=THREE.ShapeUtils.b2,p=THREE.ShapeUtils.b3,r,u,t;u=r=void 0;var v,x=void 0,A=void 0,w=void 0,D=void 0;if(l.o)for(var B=l._cachedOutline||(l._cachedOutline=l.o.split(" ")),z=0,F=B.length;z<F;)switch(B[z++]){case "m":r=
B[z++]*h+k;u=B[z++]*h;n.moveTo(r,u);break;case "l":r=B[z++]*h+k;u=B[z++]*h;n.lineTo(r,u);break;case "q":r=B[z++]*h+k;u=B[z++]*h;x=B[z++]*h+k;A=B[z++]*h;n.quadraticCurveTo(x,A,r,u);if(v=q[q.length-1]){t=v.x;v=v.y;for(var G=1;G<=c;G++){var C=G/c;m(C,t,x,r);m(C,v,A,u)}}break;case "b":if(r=B[z++]*h+k,u=B[z++]*h,x=B[z++]*h+k,A=B[z++]*h,w=B[z++]*h+k,D=B[z++]*h,n.bezierCurveTo(x,A,w,D,r,u),v=q[q.length-1])for(t=v.x,v=v.y,G=1;G<=c;G++)C=G/c,p(C,t,x,w,r),p(C,v,A,D,u)}h={offset:l.ha*h,path:n}}else h=void 0;
g+=h.offset;b.push(h.path)}c=[];e=0;for(a=b.length;e<a;e++)Array.prototype.push.apply(c,b[e].toShapes());return c}};THREE.Path=function(a){THREE.CurvePath.call(this);this.actions=[];a&&this.fromPoints(a)};THREE.Path.prototype=Object.create(THREE.CurvePath.prototype);THREE.Path.prototype.constructor=THREE.Path;THREE.Path.prototype.fromPoints=function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y)};
THREE.Path.prototype.moveTo=function(a,b){this.actions.push({action:"moveTo",args:[a,b]})};THREE.Path.prototype.lineTo=function(a,b){var c=this.actions[this.actions.length-1].args,c=new THREE.LineCurve(new THREE.Vector2(c[c.length-2],c[c.length-1]),new THREE.Vector2(a,b));this.curves.push(c);this.actions.push({action:"lineTo",args:[a,b]})};
THREE.Path.prototype.quadraticCurveTo=function(a,b,c,e){var d=this.actions[this.actions.length-1].args,d=new THREE.QuadraticBezierCurve(new THREE.Vector2(d[d.length-2],d[d.length-1]),new THREE.Vector2(a,b),new THREE.Vector2(c,e));this.curves.push(d);this.actions.push({action:"quadraticCurveTo",args:[a,b,c,e]})};
THREE.Path.prototype.bezierCurveTo=function(a,b,c,e,d,g){var f=this.actions[this.actions.length-1].args,f=new THREE.CubicBezierCurve(new THREE.Vector2(f[f.length-2],f[f.length-1]),new THREE.Vector2(a,b),new THREE.Vector2(c,e),new THREE.Vector2(d,g));this.curves.push(f);this.actions.push({action:"bezierCurveTo",args:[a,b,c,e,d,g]})};
THREE.Path.prototype.splineThru=function(a){var b=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,c=[new THREE.Vector2(c[c.length-2],c[c.length-1])];Array.prototype.push.apply(c,a);c=new THREE.SplineCurve(c);this.curves.push(c);this.actions.push({action:"splineThru",args:b})};THREE.Path.prototype.arc=function(a,b,c,e,d,g){var f=this.actions[this.actions.length-1].args;this.absarc(a+f[f.length-2],b+f[f.length-1],c,e,d,g)};
THREE.Path.prototype.absarc=function(a,b,c,e,d,g){this.absellipse(a,b,c,c,e,d,g)};THREE.Path.prototype.ellipse=function(a,b,c,e,d,g,f,h){var k=this.actions[this.actions.length-1].args;this.absellipse(a+k[k.length-2],b+k[k.length-1],c,e,d,g,f,h)};THREE.Path.prototype.absellipse=function(a,b,c,e,d,g,f,h){var k=[a,b,c,e,d,g,f,h||0];a=new THREE.EllipseCurve(a,b,c,e,d,g,f,h);this.curves.push(a);a=a.getPoint(1);k.push(a.x);k.push(a.y);this.actions.push({action:"ellipse",args:k})};
THREE.Path.prototype.getSpacedPoints=function(a){a||(a=40);for(var b=[],c=0;c<a;c++)b.push(this.getPoint(c/a));this.autoClose&&b.push(b[0]);return b};
THREE.Path.prototype.getPoints=function(a){a=a||12;for(var b=THREE.ShapeUtils.b2,c=THREE.ShapeUtils.b3,e=[],d,g,f,h,k,l,n,q,m,p,r=0,u=this.actions.length;r<u;r++){m=this.actions[r];var t=m.args;switch(m.action){case "moveTo":e.push(new THREE.Vector2(t[0],t[1]));break;case "lineTo":e.push(new THREE.Vector2(t[0],t[1]));break;case "quadraticCurveTo":d=t[2];g=t[3];k=t[0];l=t[1];0<e.length?(m=e[e.length-1],n=m.x,q=m.y):(m=this.actions[r-1].args,n=m[m.length-2],q=m[m.length-1]);for(t=1;t<=a;t++)p=t/a,m=
b(p,n,k,d),p=b(p,q,l,g),e.push(new THREE.Vector2(m,p));break;case "bezierCurveTo":d=t[4];g=t[5];k=t[0];l=t[1];f=t[2];h=t[3];0<e.length?(m=e[e.length-1],n=m.x,q=m.y):(m=this.actions[r-1].args,n=m[m.length-2],q=m[m.length-1]);for(t=1;t<=a;t++)p=t/a,m=c(p,n,k,f,d),p=c(p,q,l,h,g),e.push(new THREE.Vector2(m,p));break;case "splineThru":m=this.actions[r-1].args;p=[new THREE.Vector2(m[m.length-2],m[m.length-1])];m=a*t[0].length;p=p.concat(t[0]);p=new THREE.SplineCurve(p);for(t=1;t<=m;t++)e.push(p.getPointAt(t/
m));break;case "arc":d=t[0];g=t[1];l=t[2];f=t[3];m=t[4];k=!!t[5];n=m-f;q=2*a;for(t=1;t<=q;t++)p=t/q,k||(p=1-p),p=f+p*n,m=d+l*Math.cos(p),p=g+l*Math.sin(p),e.push(new THREE.Vector2(m,p));break;case "ellipse":d=t[0];g=t[1];l=t[2];h=t[3];f=t[4];m=t[5];k=!!t[6];var v=t[7];n=m-f;q=2*a;var x,A;0!==v&&(x=Math.cos(v),A=Math.sin(v));for(t=1;t<=q;t++){p=t/q;k||(p=1-p);p=f+p*n;m=d+l*Math.cos(p);p=g+h*Math.sin(p);if(0!==v){var w=m;m=(w-d)*x-(p-g)*A+d;p=(w-d)*A+(p-g)*x+g}e.push(new THREE.Vector2(m,p))}}}a=e[e.length-
1];Math.abs(a.x-e[0].x)<Number.EPSILON&&Math.abs(a.y-e[0].y)<Number.EPSILON&&e.splice(e.length-1,1);this.autoClose&&e.push(e[0]);return e};
THREE.Path.prototype.toShapes=function(a,b){function c(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c],f=new THREE.Shape;f.actions=e.actions;f.curves=e.curves;b.push(f)}return b}function e(a,b){for(var c=b.length,d=!1,e=c-1,f=0;f<c;e=f++){var g=b[e],h=b[f],m=h.x-g.x,k=h.y-g.y;if(Math.abs(k)>Number.EPSILON){if(0>k&&(g=b[f],m=-m,h=b[e],k=-k),!(a.y<g.y||a.y>h.y))if(a.y===g.y){if(a.x===g.x)return!0}else{e=k*(a.x-g.x)-m*(a.y-g.y);if(0===e)return!0;0>e||(d=!d)}}else if(a.y===g.y&&(h.x<=a.x&&a.x<=g.x||
g.x<=a.x&&a.x<=h.x))return!0}return d}var d=THREE.ShapeUtils.isClockWise,g=function(a){for(var b=[],c=new THREE.Path,d=0,e=a.length;d<e;d++){var f=a[d],g=f.args,f=f.action;"moveTo"===f&&0!==c.actions.length&&(b.push(c),c=new THREE.Path);c[f].apply(c,g)}0!==c.actions.length&&b.push(c);return b}(this.actions);if(0===g.length)return[];if(!0===b)return c(g);var f,h,k,l=[];if(1===g.length)return h=g[0],k=new THREE.Shape,k.actions=h.actions,k.curves=h.curves,l.push(k),l;var n=!d(g[0].getPoints()),n=a?!n:
n;k=[];var q=[],m=[],p=0,r;q[p]=void 0;m[p]=[];for(var u=0,t=g.length;u<t;u++)h=g[u],r=h.getPoints(),f=d(r),(f=a?!f:f)?(!n&&q[p]&&p++,q[p]={s:new THREE.Shape,p:r},q[p].s.actions=h.actions,q[p].s.curves=h.curves,n&&p++,m[p]=[]):m[p].push({h:h,p:r[0]});if(!q[0])return c(g);if(1<q.length){u=!1;h=[];d=0;for(g=q.length;d<g;d++)k[d]=[];d=0;for(g=q.length;d<g;d++)for(f=m[d],n=0;n<f.length;n++){p=f[n];r=!0;for(t=0;t<q.length;t++)e(p.p,q[t].p)&&(d!==t&&h.push({froms:d,tos:t,hole:n}),r?(r=!1,k[t].push(p)):
u=!0);r&&k[d].push(p)}0<h.length&&(u||(m=k))}u=0;for(d=q.length;u<d;u++)for(k=q[u].s,l.push(k),h=m[u],g=0,f=h.length;g<f;g++)k.holes.push(h[g].h);return l};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=Object.create(THREE.Path.prototype);THREE.Shape.prototype.constructor=THREE.Shape;THREE.Shape.prototype.extrude=function(a){return new THREE.ExtrudeGeometry(this,a)};THREE.Shape.prototype.makeGeometry=function(a){return new THREE.ShapeGeometry(this,a)};
THREE.Shape.prototype.getPointsHoles=function(a){for(var b=[],c=0,e=this.holes.length;c<e;c++)b[c]=this.holes[c].getPoints(a);return b};THREE.Shape.prototype.extractAllPoints=function(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}};THREE.Shape.prototype.extractPoints=function(a){return this.extractAllPoints(a)};THREE.LineCurve=function(a,b){this.v1=a;this.v2=b};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.constructor=THREE.LineCurve;
THREE.LineCurve.prototype.getPoint=function(a){var b=this.v2.clone().sub(this.v1);b.multiplyScalar(a).add(this.v1);return b};THREE.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)};THREE.LineCurve.prototype.getTangent=function(a){return this.v2.clone().sub(this.v1).normalize()};THREE.QuadraticBezierCurve=function(a,b,c){this.v0=a;this.v1=b;this.v2=c};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve;
THREE.QuadraticBezierCurve.prototype.getPoint=function(a){var b=THREE.ShapeUtils.b2;return new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))};THREE.QuadraticBezierCurve.prototype.getTangent=function(a){var b=THREE.CurveUtils.tangentQuadraticBezier;return(new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))).normalize()};THREE.CubicBezierCurve=function(a,b,c,e){this.v0=a;this.v1=b;this.v2=c;this.v3=e};
THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve;THREE.CubicBezierCurve.prototype.getPoint=function(a){var b=THREE.ShapeUtils.b3;return new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))};
THREE.CubicBezierCurve.prototype.getTangent=function(a){var b=THREE.CurveUtils.tangentCubicBezier;return(new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))).normalize()};THREE.SplineCurve=function(a){this.points=void 0==a?[]:a};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.constructor=THREE.SplineCurve;
THREE.SplineCurve.prototype.getPoint=function(a){var b=this.points;a*=b.length-1;var c=Math.floor(a);a-=c;var e=b[0===c?c:c-1],d=b[c],g=b[c>b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=THREE.CurveUtils.interpolate;return new THREE.Vector2(c(e.x,d.x,g.x,b.x,a),c(e.y,d.y,g.y,b.y,a))};THREE.EllipseCurve=function(a,b,c,e,d,g,f,h){this.aX=a;this.aY=b;this.xRadius=c;this.yRadius=e;this.aStartAngle=d;this.aEndAngle=g;this.aClockwise=f;this.aRotation=h||0};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);
THREE.EllipseCurve.prototype.constructor=THREE.EllipseCurve;
THREE.EllipseCurve.prototype.getPoint=function(a){var b=this.aEndAngle-this.aStartAngle;0>b&&(b+=2*Math.PI);b>2*Math.PI&&(b-=2*Math.PI);b=!0===this.aClockwise?this.aEndAngle+(1-a)*(2*Math.PI-b):this.aStartAngle+a*b;a=this.aX+this.xRadius*Math.cos(b);var c=this.aY+this.yRadius*Math.sin(b);if(0!==this.aRotation){var b=Math.cos(this.aRotation),e=Math.sin(this.aRotation),d=a;a=(d-this.aX)*b-(c-this.aY)*e+this.aX;c=(d-this.aX)*e+(c-this.aY)*b+this.aY}return new THREE.Vector2(a,c)};
THREE.ArcCurve=function(a,b,c,e,d,g){THREE.EllipseCurve.call(this,a,b,c,c,e,d,g)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.ArcCurve.prototype.constructor=THREE.ArcCurve;THREE.LineCurve3=THREE.Curve.create(function(a,b){this.v1=a;this.v2=b},function(a){var b=new THREE.Vector3;b.subVectors(this.v2,this.v1);b.multiplyScalar(a);b.add(this.v1);return b});
THREE.QuadraticBezierCurve3=THREE.Curve.create(function(a,b,c){this.v0=a;this.v1=b;this.v2=c},function(a){var b=THREE.ShapeUtils.b2;return new THREE.Vector3(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y),b(a,this.v0.z,this.v1.z,this.v2.z))});
THREE.CubicBezierCurve3=THREE.Curve.create(function(a,b,c,e){this.v0=a;this.v1=b;this.v2=c;this.v3=e},function(a){var b=THREE.ShapeUtils.b3;return new THREE.Vector3(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),b(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z))});
THREE.SplineCurve3=THREE.Curve.create(function(a){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3");this.points=void 0==a?[]:a},function(a){var b=this.points;a*=b.length-1;var c=Math.floor(a);a-=c;var e=b[0==c?c:c-1],d=b[c],g=b[c>b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=THREE.CurveUtils.interpolate;return new THREE.Vector3(c(e.x,d.x,g.x,b.x,a),c(e.y,d.y,g.y,b.y,a),c(e.z,d.z,g.z,b.z,a))});
THREE.CatmullRomCurve3=function(){function a(){}var b=new THREE.Vector3,c=new a,e=new a,d=new a;a.prototype.init=function(a,b,c,d){this.c0=a;this.c1=c;this.c2=-3*a+3*b-2*c-d;this.c3=2*a-2*b+c+d};a.prototype.initNonuniformCatmullRom=function(a,b,c,d,e,n,q){this.init(b,c,((b-a)/e-(c-a)/(e+n)+(c-b)/n)*n,((c-b)/n-(d-b)/(n+q)+(d-c)/q)*n)};a.prototype.initCatmullRom=function(a,b,c,d,e){this.init(b,c,e*(c-a),e*(d-b))};a.prototype.calc=function(a){var b=a*a;return this.c0+this.c1*a+this.c2*b+this.c3*b*a};
return THREE.Curve.create(function(a){this.points=a||[];this.closed=!1},function(a){var f=this.points,g,k;k=f.length;2>k&&console.log("duh, you need at least 2 points");a*=k-(this.closed?0:1);g=Math.floor(a);a-=g;this.closed?g+=0<g?0:(Math.floor(Math.abs(g)/f.length)+1)*f.length:0===a&&g===k-1&&(g=k-2,a=1);var l,n,q;this.closed||0<g?l=f[(g-1)%k]:(b.subVectors(f[0],f[1]).add(f[0]),l=b);n=f[g%k];q=f[(g+1)%k];this.closed||g+2<k?f=f[(g+2)%k]:(b.subVectors(f[k-1],f[k-2]).add(f[k-1]),f=b);if(void 0===this.type||
"centripetal"===this.type||"chordal"===this.type){var m="chordal"===this.type?.5:.25;k=Math.pow(l.distanceToSquared(n),m);g=Math.pow(n.distanceToSquared(q),m);m=Math.pow(q.distanceToSquared(f),m);1E-4>g&&(g=1);1E-4>k&&(k=g);1E-4>m&&(m=g);c.initNonuniformCatmullRom(l.x,n.x,q.x,f.x,k,g,m);e.initNonuniformCatmullRom(l.y,n.y,q.y,f.y,k,g,m);d.initNonuniformCatmullRom(l.z,n.z,q.z,f.z,k,g,m)}else"catmullrom"===this.type&&(k=void 0!==this.tension?this.tension:.5,c.initCatmullRom(l.x,n.x,q.x,f.x,k),e.initCatmullRom(l.y,
n.y,q.y,f.y,k),d.initCatmullRom(l.z,n.z,q.z,f.z,k));return new THREE.Vector3(c.calc(a),e.calc(a),d.calc(a))})}();THREE.ClosedSplineCurve3=function(a){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Please use THREE.CatmullRomCurve3.");THREE.CatmullRomCurve3.call(this,a);this.type="catmullrom";this.closed=!0};THREE.ClosedSplineCurve3.prototype=Object.create(THREE.CatmullRomCurve3.prototype);
THREE.BoxGeometry=function(a,b,c,e,d,g){THREE.Geometry.call(this);this.type="BoxGeometry";this.parameters={width:a,height:b,depth:c,widthSegments:e,heightSegments:d,depthSegments:g};this.fromBufferGeometry(new THREE.BoxBufferGeometry(a,b,c,e,d,g));this.mergeVertices()};THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.BoxGeometry.prototype.constructor=THREE.BoxGeometry;THREE.CubeGeometry=THREE.BoxGeometry;
THREE.BoxBufferGeometry=function(a,b,c,e,d,g){function f(a,b,c,d,e,f,g,k,l,K,H){var w=f/l,A=g/K,z=f/2,G=g/2,B=k/2;g=l+1;for(var C=K+1,D=f=0,F=new THREE.Vector3,I=0;I<C;I++)for(var L=I*A-G,R=0;R<g;R++)F[a]=(R*w-z)*d,F[b]=L*e,F[c]=B,q[r]=F.x,q[r+1]=F.y,q[r+2]=F.z,F[a]=0,F[b]=0,F[c]=0<k?1:-1,m[r]=F.x,m[r+1]=F.y,m[r+2]=F.z,p[u]=R/l,p[u+1]=1-I/K,r+=3,u+=2,f+=1;for(I=0;I<K;I++)for(R=0;R<l;R++)a=v+R+g*(I+1),b=v+(R+1)+g*(I+1),c=v+(R+1)+g*I,n[t]=v+R+g*I,n[t+1]=a,n[t+2]=c,n[t+3]=a,n[t+4]=b,n[t+5]=c,t+=6,D+=
6;h.addGroup(x,D,H);x+=D;v+=f}THREE.BufferGeometry.call(this);this.type="BoxBufferGeometry";this.parameters={width:a,height:b,depth:c,widthSegments:e,heightSegments:d,depthSegments:g};var h=this;e=Math.floor(e)||1;d=Math.floor(d)||1;g=Math.floor(g)||1;var k=4*(0+e*d*2+e*g*2+g*d*2),l=k/4*6,n=new (65535<l?Uint32Array:Uint16Array)(l),q=new Float32Array(3*k),m=new Float32Array(3*k),p=new Float32Array(2*k),r=0,u=0,t=0,v=0,x=0;f("z","y","x",-1,-1,c,b,a,g,d,0);f("z","y","x",1,-1,c,b,-a,g,d,1);f("x","z",
"y",1,1,a,c,b,e,g,2);f("x","z","y",1,-1,a,c,-b,e,g,3);f("x","y","z",1,-1,a,b,c,e,d,4);f("x","y","z",-1,-1,a,b,-c,e,d,5);this.setIndex(new THREE.BufferAttribute(n,1));this.addAttribute("position",new THREE.BufferAttribute(q,3));this.addAttribute("normal",new THREE.BufferAttribute(m,3));this.addAttribute("uv",new THREE.BufferAttribute(p,2))};THREE.BoxBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.BoxBufferGeometry.prototype.constructor=THREE.BoxBufferGeometry;
THREE.CircleGeometry=function(a,b,c,e){THREE.Geometry.call(this);this.type="CircleGeometry";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:e};this.fromBufferGeometry(new THREE.CircleBufferGeometry(a,b,c,e))};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CircleGeometry.prototype.constructor=THREE.CircleGeometry;
THREE.CircleBufferGeometry=function(a,b,c,e){THREE.BufferGeometry.call(this);this.type="CircleBufferGeometry";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:e};a=a||50;b=void 0!==b?Math.max(3,b):8;c=void 0!==c?c:0;e=void 0!==e?e:2*Math.PI;var d=b+2,g=new Float32Array(3*d),f=new Float32Array(3*d),d=new Float32Array(2*d);f[2]=1;d[0]=.5;d[1]=.5;for(var h=0,k=3,l=2;h<=b;h++,k+=3,l+=2){var n=c+h/b*e;g[k]=a*Math.cos(n);g[k+1]=a*Math.sin(n);f[k+2]=1;d[l]=(g[k]/a+1)/2;d[l+1]=(g[k+1]/a+1)/2}c=
[];for(k=1;k<=b;k++)c.push(k,k+1,0);this.setIndex(new THREE.BufferAttribute(new Uint16Array(c),1));this.addAttribute("position",new THREE.BufferAttribute(g,3));this.addAttribute("normal",new THREE.BufferAttribute(f,3));this.addAttribute("uv",new THREE.BufferAttribute(d,2));this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a)};THREE.CircleBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.CircleBufferGeometry.prototype.constructor=THREE.CircleBufferGeometry;
THREE.CylinderBufferGeometry=function(a,b,c,e,d,g,f,h){function k(c){var d,g,k;k=new THREE.Vector2;var l=new THREE.Vector3,n=!0===c?a:b,v=!0===c?1:-1;g=u;for(d=1;d<=e;d++)m.setXYZ(u,0,x*v,0),p.setXYZ(u,0,v,0),!0===c?(k.x=d/e,k.y=0):(k.x=(d-1)/e,k.y=1),r.setXY(u,k.x,k.y),u++;k=u;for(d=0;d<=e;d++){var A=d/e;l.x=n*Math.sin(A*h+f);l.y=x*v;l.z=n*Math.cos(A*h+f);m.setXYZ(u,l.x,l.y,l.z);p.setXYZ(u,0,v,0);r.setXY(u,A,!0===c?1:0);u++}for(d=0;d<e;d++)l=g+d,n=k+d,!0===c?(q.setX(t,n),t++,q.setX(t,n+1)):(q.setX(t,
n+1),t++,q.setX(t,n)),t++,q.setX(t,l),t++}THREE.BufferGeometry.call(this);this.type="CylinderBufferGeometry";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:e,heightSegments:d,openEnded:g,thetaStart:f,thetaLength:h};a=void 0!==a?a:20;b=void 0!==b?b:20;c=void 0!==c?c:100;e=Math.floor(e)||8;d=Math.floor(d)||1;g=void 0!==g?g:!1;f=void 0!==f?f:0;h=void 0!==h?h:2*Math.PI;var l=function(){var a=(e+1)*(d+1);!1===g&&(a+=2*(e+1)+2*e);return a}(),n=function(){var a=e*d*6;!1===g&&(a+=6*e);
return a}(),q=new THREE.BufferAttribute(new (65535<n?Uint32Array:Uint16Array)(n),1),m=new THREE.BufferAttribute(new Float32Array(3*l),3),p=new THREE.BufferAttribute(new Float32Array(3*l),3),r=new THREE.BufferAttribute(new Float32Array(2*l),2),u=0,t=0,v=[],x=c/2;(function(){var g,k,l=new THREE.Vector3,n=new THREE.Vector3,z=(b-a)/c;for(k=0;k<=d;k++){var F=[],G=k/d,C=G*(b-a)+a;for(g=0;g<=e;g++){var L=g/e;n.x=C*Math.sin(L*h+f);n.y=-G*c+x;n.z=C*Math.cos(L*h+f);m.setXYZ(u,n.x,n.y,n.z);l.copy(n);if(0===
a&&0===k||0===b&&k===d)l.x=Math.sin(L*h+f),l.z=Math.cos(L*h+f);l.setY(Math.sqrt(l.x*l.x+l.z*l.z)*z).normalize();p.setXYZ(u,l.x,l.y,l.z);r.setXY(u,L,1-G);F.push(u);u++}v.push(F)}for(g=0;g<e;g++)for(k=0;k<d;k++)l=v[k+1][g],n=v[k+1][g+1],z=v[k][g+1],q.setX(t,v[k][g]),t++,q.setX(t,l),t++,q.setX(t,z),t++,q.setX(t,l),t++,q.setX(t,n),t++,q.setX(t,z),t++})();!1===g&&(0<a&&k(!0),0<b&&k(!1));this.setIndex(q);this.addAttribute("position",m);this.addAttribute("normal",p);this.addAttribute("uv",r)};
THREE.CylinderBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.CylinderBufferGeometry.prototype.constructor=THREE.CylinderBufferGeometry;THREE.CylinderGeometry=function(a,b,c,e,d,g,f,h){THREE.Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:e,heightSegments:d,openEnded:g,thetaStart:f,thetaLength:h};this.fromBufferGeometry(new THREE.CylinderBufferGeometry(a,b,c,e,d,g,f,h));this.mergeVertices()};
THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry;
THREE.EdgesGeometry=function(a,b){function c(a,b){return a-b}THREE.BufferGeometry.call(this);var e=Math.cos(THREE.Math.degToRad(void 0!==b?b:1)),d=[0,0],g={},f=["a","b","c"],h;a instanceof THREE.BufferGeometry?(h=new THREE.Geometry,h.fromBufferGeometry(a)):h=a.clone();h.mergeVertices();h.computeFaceNormals();var k=h.vertices;h=h.faces;for(var l=0,n=h.length;l<n;l++)for(var q=h[l],m=0;3>m;m++){d[0]=q[f[m]];d[1]=q[f[(m+1)%3]];d.sort(c);var p=d.toString();void 0===g[p]?g[p]={vert1:d[0],vert2:d[1],face1:l,
face2:void 0}:g[p].face2=l}d=[];for(p in g)if(f=g[p],void 0===f.face2||h[f.face1].normal.dot(h[f.face2].normal)<=e)l=k[f.vert1],d.push(l.x),d.push(l.y),d.push(l.z),l=k[f.vert2],d.push(l.x),d.push(l.y),d.push(l.z);this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(d),3))};THREE.EdgesGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.EdgesGeometry.prototype.constructor=THREE.EdgesGeometry;
THREE.ExtrudeGeometry=function(a,b){"undefined"!==typeof a&&(THREE.Geometry.call(this),this.type="ExtrudeGeometry",a=Array.isArray(a)?a:[a],this.addShapeList(a,b),this.computeFaceNormals())};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry;THREE.ExtrudeGeometry.prototype.addShapeList=function(a,b){for(var c=a.length,e=0;e<c;e++)this.addShape(a[e],b)};
THREE.ExtrudeGeometry.prototype.addShape=function(a,b){function c(a,b,c){b||console.error("THREE.ExtrudeGeometry: vec does not exist");return b.clone().multiplyScalar(c).add(a)}function e(a,b,c){var d;d=a.x-b.x;var e=a.y-b.y,g=c.x-a.x,f=c.y-a.y,h=d*d+e*e;if(Math.abs(d*f-e*g)>Number.EPSILON){var m=Math.sqrt(h),k=Math.sqrt(g*g+f*f),h=b.x-e/m;b=b.y+d/m;g=((c.x-f/k-h)*f-(c.y+g/k-b)*g)/(d*f-e*g);c=h+d*g-a.x;a=b+e*g-a.y;d=c*c+a*a;if(2>=d)return new THREE.Vector2(c,a);d=Math.sqrt(d/2)}else a=!1,d>Number.EPSILON?
g>Number.EPSILON&&(a=!0):d<-Number.EPSILON?g<-Number.EPSILON&&(a=!0):Math.sign(e)===Math.sign(f)&&(a=!0),a?(c=-e,a=d,d=Math.sqrt(h)):(c=d,a=e,d=Math.sqrt(h/2));return new THREE.Vector2(c/d,a/d)}function d(a,b){var c,d;for(I=a.length;0<=--I;){c=I;d=I-1;0>d&&(d=a.length-1);var e,g=p+2*n;for(e=0;e<g;e++){var f=Q*e,h=Q*(e+1),m=b+c+f,f=b+d+f,k=b+d+h,h=b+c+h,m=m+C,f=f+C,k=k+C,h=h+C;G.faces.push(new THREE.Face3(m,f,h,null,null,1));G.faces.push(new THREE.Face3(f,k,h,null,null,1));m=v.generateSideWallUV(G,
m,f,k,h);G.faceVertexUvs[0].push([m[0],m[1],m[3]]);G.faceVertexUvs[0].push([m[1],m[2],m[3]])}}}function g(a,b,c){G.vertices.push(new THREE.Vector3(a,b,c))}function f(a,b,c){a+=C;b+=C;c+=C;G.faces.push(new THREE.Face3(a,b,c,null,null,0));a=v.generateTopUV(G,a,b,c);G.faceVertexUvs[0].push(a)}var h=void 0!==b.amount?b.amount:100,k=void 0!==b.bevelThickness?b.bevelThickness:6,l=void 0!==b.bevelSize?b.bevelSize:k-2,n=void 0!==b.bevelSegments?b.bevelSegments:3,q=void 0!==b.bevelEnabled?b.bevelEnabled:!0,
m=void 0!==b.curveSegments?b.curveSegments:12,p=void 0!==b.steps?b.steps:1,r=b.extrudePath,u,t=!1,v=void 0!==b.UVGenerator?b.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator,x,A,w,D;r&&(u=r.getSpacedPoints(p),t=!0,q=!1,x=void 0!==b.frames?b.frames:new THREE.TubeGeometry.FrenetFrames(r,p,!1),A=new THREE.Vector3,w=new THREE.Vector3,D=new THREE.Vector3);q||(l=k=n=0);var B,z,F,G=this,C=this.vertices.length,r=a.extractPoints(m),m=r.shape,L=r.holes;if(r=!THREE.ShapeUtils.isClockWise(m)){m=m.reverse();
z=0;for(F=L.length;z<F;z++)B=L[z],THREE.ShapeUtils.isClockWise(B)&&(L[z]=B.reverse());r=!1}var K=THREE.ShapeUtils.triangulateShape(m,L),H=m;z=0;for(F=L.length;z<F;z++)B=L[z],m=m.concat(B);var M,E,J,N,P,Q=m.length,O,S=K.length,r=[],I=0;J=H.length;M=J-1;for(E=I+1;I<J;I++,M++,E++)M===J&&(M=0),E===J&&(E=0),r[I]=e(H[I],H[M],H[E]);var ba=[],R,V=r.concat();z=0;for(F=L.length;z<F;z++){B=L[z];R=[];I=0;J=B.length;M=J-1;for(E=I+1;I<J;I++,M++,E++)M===J&&(M=0),E===J&&(E=0),R[I]=e(B[I],B[M],B[E]);ba.push(R);V=
V.concat(R)}for(M=0;M<n;M++){J=M/n;N=k*(1-J);E=l*Math.sin(J*Math.PI/2);I=0;for(J=H.length;I<J;I++)P=c(H[I],r[I],E),g(P.x,P.y,-N);z=0;for(F=L.length;z<F;z++)for(B=L[z],R=ba[z],I=0,J=B.length;I<J;I++)P=c(B[I],R[I],E),g(P.x,P.y,-N)}E=l;for(I=0;I<Q;I++)P=q?c(m[I],V[I],E):m[I],t?(w.copy(x.normals[0]).multiplyScalar(P.x),A.copy(x.binormals[0]).multiplyScalar(P.y),D.copy(u[0]).add(w).add(A),g(D.x,D.y,D.z)):g(P.x,P.y,0);for(J=1;J<=p;J++)for(I=0;I<Q;I++)P=q?c(m[I],V[I],E):m[I],t?(w.copy(x.normals[J]).multiplyScalar(P.x),
A.copy(x.binormals[J]).multiplyScalar(P.y),D.copy(u[J]).add(w).add(A),g(D.x,D.y,D.z)):g(P.x,P.y,h/p*J);for(M=n-1;0<=M;M--){J=M/n;N=k*(1-J);E=l*Math.sin(J*Math.PI/2);I=0;for(J=H.length;I<J;I++)P=c(H[I],r[I],E),g(P.x,P.y,h+N);z=0;for(F=L.length;z<F;z++)for(B=L[z],R=ba[z],I=0,J=B.length;I<J;I++)P=c(B[I],R[I],E),t?g(P.x,P.y+u[p-1].y,u[p-1].x+N):g(P.x,P.y,h+N)}(function(){if(q){var a;a=0*Q;for(I=0;I<S;I++)O=K[I],f(O[2]+a,O[1]+a,O[0]+a);a=p+2*n;a*=Q;for(I=0;I<S;I++)O=K[I],f(O[0]+a,O[1]+a,O[2]+a)}else{for(I=
0;I<S;I++)O=K[I],f(O[2],O[1],O[0]);for(I=0;I<S;I++)O=K[I],f(O[0]+Q*p,O[1]+Q*p,O[2]+Q*p)}})();(function(){var a=0;d(H,a);a+=H.length;z=0;for(F=L.length;z<F;z++)B=L[z],d(B,a),a+=B.length})()};
THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(a,b,c,e){a=a.vertices;b=a[b];c=a[c];e=a[e];return[new THREE.Vector2(b.x,b.y),new THREE.Vector2(c.x,c.y),new THREE.Vector2(e.x,e.y)]},generateSideWallUV:function(a,b,c,e,d){a=a.vertices;b=a[b];c=a[c];e=a[e];d=a[d];return.01>Math.abs(b.y-c.y)?[new THREE.Vector2(b.x,1-b.z),new THREE.Vector2(c.x,1-c.z),new THREE.Vector2(e.x,1-e.z),new THREE.Vector2(d.x,1-d.z)]:[new THREE.Vector2(b.y,1-b.z),new THREE.Vector2(c.y,1-c.z),new THREE.Vector2(e.y,
1-e.z),new THREE.Vector2(d.y,1-d.z)]}};THREE.ShapeGeometry=function(a,b){THREE.Geometry.call(this);this.type="ShapeGeometry";!1===Array.isArray(a)&&(a=[a]);this.addShapeList(a,b);this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.constructor=THREE.ShapeGeometry;THREE.ShapeGeometry.prototype.addShapeList=function(a,b){for(var c=0,e=a.length;c<e;c++)this.addShape(a[c],b);return this};
THREE.ShapeGeometry.prototype.addShape=function(a,b){void 0===b&&(b={});var c=b.material,e=void 0===b.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:b.UVGenerator,d,g,f,h=this.vertices.length;d=a.extractPoints(void 0!==b.curveSegments?b.curveSegments:12);var k=d.shape,l=d.holes;if(!THREE.ShapeUtils.isClockWise(k))for(k=k.reverse(),d=0,g=l.length;d<g;d++)f=l[d],THREE.ShapeUtils.isClockWise(f)&&(l[d]=f.reverse());var n=THREE.ShapeUtils.triangulateShape(k,l);d=0;for(g=l.length;d<g;d++)f=l[d],k=k.concat(f);
l=k.length;g=n.length;for(d=0;d<l;d++)f=k[d],this.vertices.push(new THREE.Vector3(f.x,f.y,0));for(d=0;d<g;d++)l=n[d],k=l[0]+h,f=l[1]+h,l=l[2]+h,this.faces.push(new THREE.Face3(k,f,l,null,null,c)),this.faceVertexUvs[0].push(e.generateTopUV(this,k,f,l))};
THREE.LatheBufferGeometry=function(a,b,c,e){THREE.BufferGeometry.call(this);this.type="LatheBufferGeometry";this.parameters={points:a,segments:b,phiStart:c,phiLength:e};b=Math.floor(b)||12;c=c||0;e=e||2*Math.PI;e=THREE.Math.clamp(e,0,2*Math.PI);for(var d=(b+1)*a.length,g=b*a.length*6,f=new THREE.BufferAttribute(new (65535<g?Uint32Array:Uint16Array)(g),1),h=new THREE.BufferAttribute(new Float32Array(3*d),3),k=new THREE.BufferAttribute(new Float32Array(2*d),2),l=0,n=0,q=1/b,m=new THREE.Vector3,p=new THREE.Vector2,
d=0;d<=b;d++)for(var g=c+d*q*e,r=Math.sin(g),u=Math.cos(g),g=0;g<=a.length-1;g++)m.x=a[g].x*r,m.y=a[g].y,m.z=a[g].x*u,h.setXYZ(l,m.x,m.y,m.z),p.x=d/b,p.y=g/(a.length-1),k.setXY(l,p.x,p.y),l++;for(d=0;d<b;d++)for(g=0;g<a.length-1;g++)c=g+d*a.length,l=c+a.length,q=c+a.length+1,m=c+1,f.setX(n,c),n++,f.setX(n,l),n++,f.setX(n,m),n++,f.setX(n,l),n++,f.setX(n,q),n++,f.setX(n,m),n++;this.setIndex(f);this.addAttribute("position",h);this.addAttribute("uv",k);this.computeVertexNormals();if(e===2*Math.PI)for(e=
this.attributes.normal.array,f=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,c=b*a.length*3,g=d=0;d<a.length;d++,g+=3)f.x=e[g+0],f.y=e[g+1],f.z=e[g+2],h.x=e[c+g+0],h.y=e[c+g+1],h.z=e[c+g+2],k.addVectors(f,h).normalize(),e[g+0]=e[c+g+0]=k.x,e[g+1]=e[c+g+1]=k.y,e[g+2]=e[c+g+2]=k.z};THREE.LatheBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.LatheBufferGeometry.prototype.constructor=THREE.LatheBufferGeometry;
THREE.LatheGeometry=function(a,b,c,e){THREE.Geometry.call(this);this.type="LatheGeometry";this.parameters={points:a,segments:b,phiStart:c,phiLength:e};this.fromBufferGeometry(new THREE.LatheBufferGeometry(a,b,c,e));this.mergeVertices()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry;
THREE.PlaneGeometry=function(a,b,c,e){THREE.Geometry.call(this);this.type="PlaneGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:e};this.fromBufferGeometry(new THREE.PlaneBufferGeometry(a,b,c,e))};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry;
THREE.PlaneBufferGeometry=function(a,b,c,e){THREE.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:e};var d=a/2,g=b/2;c=Math.floor(c)||1;e=Math.floor(e)||1;var f=c+1,h=e+1,k=a/c,l=b/e;b=new Float32Array(f*h*3);a=new Float32Array(f*h*3);for(var n=new Float32Array(f*h*2),q=0,m=0,p=0;p<h;p++)for(var r=p*l-g,u=0;u<f;u++)b[q]=u*k-d,b[q+1]=-r,a[q+2]=1,n[m]=u/c,n[m+1]=1-p/e,q+=3,m+=2;q=0;d=new (65535<b.length/3?Uint32Array:Uint16Array)(c*
e*6);for(p=0;p<e;p++)for(u=0;u<c;u++)g=u+f*(p+1),h=u+1+f*(p+1),k=u+1+f*p,d[q]=u+f*p,d[q+1]=g,d[q+2]=k,d[q+3]=g,d[q+4]=h,d[q+5]=k,q+=6;this.setIndex(new THREE.BufferAttribute(d,1));this.addAttribute("position",new THREE.BufferAttribute(b,3));this.addAttribute("normal",new THREE.BufferAttribute(a,3));this.addAttribute("uv",new THREE.BufferAttribute(n,2))};THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry;
THREE.RingBufferGeometry=function(a,b,c,e,d,g){THREE.BufferGeometry.call(this);this.type="RingBufferGeometry";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:e,thetaStart:d,thetaLength:g};a=a||20;b=b||50;d=void 0!==d?d:0;g=void 0!==g?g:2*Math.PI;c=void 0!==c?Math.max(3,c):8;e=void 0!==e?Math.max(1,e):1;var f=(c+1)*(e+1),h=c*e*6,h=new THREE.BufferAttribute(new (65535<h?Uint32Array:Uint16Array)(h),1),k=new THREE.BufferAttribute(new Float32Array(3*f),3),l=new THREE.BufferAttribute(new Float32Array(3*
f),3),f=new THREE.BufferAttribute(new Float32Array(2*f),2),n=0,q=0,m,p=a,r=(b-a)/e,u=new THREE.Vector3,t=new THREE.Vector2,v;for(a=0;a<=e;a++){for(v=0;v<=c;v++)m=d+v/c*g,u.x=p*Math.cos(m),u.y=p*Math.sin(m),k.setXYZ(n,u.x,u.y,u.z),l.setXYZ(n,0,0,1),t.x=(u.x/b+1)/2,t.y=(u.y/b+1)/2,f.setXY(n,t.x,t.y),n++;p+=r}for(a=0;a<e;a++)for(b=a*(c+1),v=0;v<c;v++)d=m=v+b,g=m+c+1,n=m+c+2,m+=1,h.setX(q,d),q++,h.setX(q,g),q++,h.setX(q,n),q++,h.setX(q,d),q++,h.setX(q,n),q++,h.setX(q,m),q++;this.setIndex(h);this.addAttribute("position",
k);this.addAttribute("normal",l);this.addAttribute("uv",f)};THREE.RingBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.RingBufferGeometry.prototype.constructor=THREE.RingBufferGeometry;THREE.RingGeometry=function(a,b,c,e,d,g){THREE.Geometry.call(this);this.type="RingGeometry";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:e,thetaStart:d,thetaLength:g};this.fromBufferGeometry(new THREE.RingBufferGeometry(a,b,c,e,d,g))};
THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.RingGeometry.prototype.constructor=THREE.RingGeometry;THREE.SphereGeometry=function(a,b,c,e,d,g,f){THREE.Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:e,phiLength:d,thetaStart:g,thetaLength:f};this.fromBufferGeometry(new THREE.SphereBufferGeometry(a,b,c,e,d,g,f))};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry;
THREE.SphereBufferGeometry=function(a,b,c,e,d,g,f){THREE.BufferGeometry.call(this);this.type="SphereBufferGeometry";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:e,phiLength:d,thetaStart:g,thetaLength:f};a=a||50;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||6);e=void 0!==e?e:0;d=void 0!==d?d:2*Math.PI;g=void 0!==g?g:0;f=void 0!==f?f:Math.PI;for(var h=g+f,k=(b+1)*(c+1),l=new THREE.BufferAttribute(new Float32Array(3*k),3),n=new THREE.BufferAttribute(new Float32Array(3*
k),3),k=new THREE.BufferAttribute(new Float32Array(2*k),2),q=0,m=[],p=new THREE.Vector3,r=0;r<=c;r++){for(var u=[],t=r/c,v=0;v<=b;v++){var x=v/b,A=-a*Math.cos(e+x*d)*Math.sin(g+t*f),w=a*Math.cos(g+t*f),D=a*Math.sin(e+x*d)*Math.sin(g+t*f);p.set(A,w,D).normalize();l.setXYZ(q,A,w,D);n.setXYZ(q,p.x,p.y,p.z);k.setXY(q,x,1-t);u.push(q);q++}m.push(u)}e=[];for(r=0;r<c;r++)for(v=0;v<b;v++)d=m[r][v+1],f=m[r][v],q=m[r+1][v],p=m[r+1][v+1],(0!==r||0<g)&&e.push(d,f,p),(r!==c-1||h<Math.PI)&&e.push(f,q,p);this.setIndex(new (65535<
l.count?THREE.Uint32Attribute:THREE.Uint16Attribute)(e,1));this.addAttribute("position",l);this.addAttribute("normal",n);this.addAttribute("uv",k);this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a)};THREE.SphereBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.SphereBufferGeometry.prototype.constructor=THREE.SphereBufferGeometry;
THREE.TextGeometry=function(a,b){b=b||{};var c=b.font;if(!1===c instanceof THREE.Font)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new THREE.Geometry;c=c.generateShapes(a,b.size,b.curveSegments);b.amount=void 0!==b.height?b.height:50;void 0===b.bevelThickness&&(b.bevelThickness=10);void 0===b.bevelSize&&(b.bevelSize=8);void 0===b.bevelEnabled&&(b.bevelEnabled=!1);THREE.ExtrudeGeometry.call(this,c,b);this.type="TextGeometry"};
THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TextGeometry.prototype.constructor=THREE.TextGeometry;
THREE.TorusBufferGeometry=function(a,b,c,e,d){THREE.BufferGeometry.call(this);this.type="TorusBufferGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:e,arc:d};a=a||100;b=b||40;c=Math.floor(c)||8;e=Math.floor(e)||6;d=d||2*Math.PI;var g=(c+1)*(e+1),f=c*e*6,f=new (65535<f?Uint32Array:Uint16Array)(f),h=new Float32Array(3*g),k=new Float32Array(3*g),g=new Float32Array(2*g),l=0,n=0,q=0,m=new THREE.Vector3,p=new THREE.Vector3,r=new THREE.Vector3,u,t;for(u=0;u<=c;u++)for(t=0;t<=e;t++){var v=
t/e*d,x=u/c*Math.PI*2;p.x=(a+b*Math.cos(x))*Math.cos(v);p.y=(a+b*Math.cos(x))*Math.sin(v);p.z=b*Math.sin(x);h[l]=p.x;h[l+1]=p.y;h[l+2]=p.z;m.x=a*Math.cos(v);m.y=a*Math.sin(v);r.subVectors(p,m).normalize();k[l]=r.x;k[l+1]=r.y;k[l+2]=r.z;g[n]=t/e;g[n+1]=u/c;l+=3;n+=2}for(u=1;u<=c;u++)for(t=1;t<=e;t++)a=(e+1)*(u-1)+t-1,b=(e+1)*(u-1)+t,d=(e+1)*u+t,f[q]=(e+1)*u+t-1,f[q+1]=a,f[q+2]=d,f[q+3]=a,f[q+4]=b,f[q+5]=d,q+=6;this.setIndex(new THREE.BufferAttribute(f,1));this.addAttribute("position",new THREE.BufferAttribute(h,
3));this.addAttribute("normal",new THREE.BufferAttribute(k,3));this.addAttribute("uv",new THREE.BufferAttribute(g,2))};THREE.TorusBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.TorusBufferGeometry.prototype.constructor=THREE.TorusBufferGeometry;
THREE.TorusGeometry=function(a,b,c,e,d){THREE.Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:e,arc:d};this.fromBufferGeometry(new THREE.TorusBufferGeometry(a,b,c,e,d))};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry;
THREE.TorusKnotBufferGeometry=function(a,b,c,e,d,g){function f(a,b,c,d,e){var g=Math.cos(a),f=Math.sin(a);a*=c/b;b=Math.cos(a);e.x=d*(2+b)*.5*g;e.y=d*(2+b)*f*.5;e.z=d*Math.sin(a)*.5}THREE.BufferGeometry.call(this);this.type="TorusKnotBufferGeometry";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:e,p:d,q:g};a=a||100;b=b||40;c=Math.floor(c)||64;e=Math.floor(e)||8;d=d||2;g=g||3;var h=(e+1)*(c+1),k=e*c*6,k=new THREE.BufferAttribute(new (65535<k?Uint32Array:Uint16Array)(k),1),l=new THREE.BufferAttribute(new Float32Array(3*
h),3),n=new THREE.BufferAttribute(new Float32Array(3*h),3),h=new THREE.BufferAttribute(new Float32Array(2*h),2),q,m,p=0,r=0,u=new THREE.Vector3,t=new THREE.Vector3,v=new THREE.Vector2,x=new THREE.Vector3,A=new THREE.Vector3,w=new THREE.Vector3,D=new THREE.Vector3,B=new THREE.Vector3;for(q=0;q<=c;++q)for(m=q/c*d*Math.PI*2,f(m,d,g,a,x),f(m+.01,d,g,a,A),D.subVectors(A,x),B.addVectors(A,x),w.crossVectors(D,B),B.crossVectors(w,D),w.normalize(),B.normalize(),m=0;m<=e;++m){var z=m/e*Math.PI*2,F=-b*Math.cos(z),
z=b*Math.sin(z);u.x=x.x+(F*B.x+z*w.x);u.y=x.y+(F*B.y+z*w.y);u.z=x.z+(F*B.z+z*w.z);l.setXYZ(p,u.x,u.y,u.z);t.subVectors(u,x).normalize();n.setXYZ(p,t.x,t.y,t.z);v.x=q/c;v.y=m/e;h.setXY(p,v.x,v.y);p++}for(m=1;m<=c;m++)for(q=1;q<=e;q++)a=(e+1)*m+(q-1),b=(e+1)*m+q,d=(e+1)*(m-1)+q,k.setX(r,(e+1)*(m-1)+(q-1)),r++,k.setX(r,a),r++,k.setX(r,d),r++,k.setX(r,a),r++,k.setX(r,b),r++,k.setX(r,d),r++;this.setIndex(k);this.addAttribute("position",l);this.addAttribute("normal",n);this.addAttribute("uv",h)};
THREE.TorusKnotBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.TorusKnotBufferGeometry.prototype.constructor=THREE.TorusKnotBufferGeometry;
THREE.TorusKnotGeometry=function(a,b,c,e,d,g,f){THREE.Geometry.call(this);this.type="TorusKnotGeometry";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:e,p:d,q:g};void 0!==f&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.");this.fromBufferGeometry(new THREE.TorusKnotBufferGeometry(a,b,c,e,d,g));this.mergeVertices()};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry;
THREE.TubeGeometry=function(a,b,c,e,d,g){THREE.Geometry.call(this);this.type="TubeGeometry";this.parameters={path:a,segments:b,radius:c,radialSegments:e,closed:d,taper:g};b=b||64;c=c||1;e=e||8;d=d||!1;g=g||THREE.TubeGeometry.NoTaper;var f=[],h,k,l=b+1,n,q,m,p,r,u=new THREE.Vector3,t,v,x;t=new THREE.TubeGeometry.FrenetFrames(a,b,d);v=t.normals;x=t.binormals;this.tangents=t.tangents;this.normals=v;this.binormals=x;for(t=0;t<l;t++)for(f[t]=[],n=t/(l-1),r=a.getPointAt(n),h=v[t],k=x[t],m=c*g(n),n=0;n<
e;n++)q=n/e*2*Math.PI,p=-m*Math.cos(q),q=m*Math.sin(q),u.copy(r),u.x+=p*h.x+q*k.x,u.y+=p*h.y+q*k.y,u.z+=p*h.z+q*k.z,f[t][n]=this.vertices.push(new THREE.Vector3(u.x,u.y,u.z))-1;for(t=0;t<b;t++)for(n=0;n<e;n++)g=d?(t+1)%b:t+1,l=(n+1)%e,a=f[t][n],c=f[g][n],g=f[g][l],l=f[t][l],u=new THREE.Vector2(t/b,n/e),v=new THREE.Vector2((t+1)/b,n/e),x=new THREE.Vector2((t+1)/b,(n+1)/e),h=new THREE.Vector2(t/b,(n+1)/e),this.faces.push(new THREE.Face3(a,c,l)),this.faceVertexUvs[0].push([u,v,h]),this.faces.push(new THREE.Face3(c,
g,l)),this.faceVertexUvs[0].push([v.clone(),x,h.clone()]);this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry;THREE.TubeGeometry.NoTaper=function(a){return 1};THREE.TubeGeometry.SinusoidalTaper=function(a){return Math.sin(Math.PI*a)};
THREE.TubeGeometry.FrenetFrames=function(a,b,c){var e=new THREE.Vector3,d=[],g=[],f=[],h=new THREE.Vector3,k=new THREE.Matrix4;b+=1;var l,n,q;this.tangents=d;this.normals=g;this.binormals=f;for(l=0;l<b;l++)n=l/(b-1),d[l]=a.getTangentAt(n),d[l].normalize();g[0]=new THREE.Vector3;f[0]=new THREE.Vector3;a=Number.MAX_VALUE;l=Math.abs(d[0].x);n=Math.abs(d[0].y);q=Math.abs(d[0].z);l<=a&&(a=l,e.set(1,0,0));n<=a&&(a=n,e.set(0,1,0));q<=a&&e.set(0,0,1);h.crossVectors(d[0],e).normalize();g[0].crossVectors(d[0],
h);f[0].crossVectors(d[0],g[0]);for(l=1;l<b;l++)g[l]=g[l-1].clone(),f[l]=f[l-1].clone(),h.crossVectors(d[l-1],d[l]),h.length()>Number.EPSILON&&(h.normalize(),e=Math.acos(THREE.Math.clamp(d[l-1].dot(d[l]),-1,1)),g[l].applyMatrix4(k.makeRotationAxis(h,e))),f[l].crossVectors(d[l],g[l]);if(c)for(e=Math.acos(THREE.Math.clamp(g[0].dot(g[b-1]),-1,1)),e/=b-1,0<d[0].dot(h.crossVectors(g[0],g[b-1]))&&(e=-e),l=1;l<b;l++)g[l].applyMatrix4(k.makeRotationAxis(d[l],e*l)),f[l].crossVectors(d[l],g[l])};
THREE.PolyhedronGeometry=function(a,b,c,e){function d(a){var b=a.normalize().clone();b.index=k.vertices.push(b)-1;var c=Math.atan2(a.z,-a.x)/2/Math.PI+.5;a=Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5;b.uv=new THREE.Vector2(c,1-a);return b}function g(a,b,c,d){d=new THREE.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()],void 0,d);k.faces.push(d);t.copy(a).add(b).add(c).divideScalar(3);d=Math.atan2(t.z,-t.x);k.faceVertexUvs[0].push([h(a.uv,a,d),h(b.uv,b,d),h(c.uv,c,d)])}function f(a,
b){for(var c=Math.pow(2,b),e=d(k.vertices[a.a]),f=d(k.vertices[a.b]),h=d(k.vertices[a.c]),m=[],l=a.materialIndex,p=0;p<=c;p++){m[p]=[];for(var n=d(e.clone().lerp(h,p/c)),r=d(f.clone().lerp(h,p/c)),q=c-p,u=0;u<=q;u++)m[p][u]=0===u&&p===c?n:d(n.clone().lerp(r,u/q))}for(p=0;p<c;p++)for(u=0;u<2*(c-p)-1;u++)e=Math.floor(u/2),0===u%2?g(m[p][e+1],m[p+1][e],m[p][e],l):g(m[p][e+1],m[p+1][e+1],m[p+1][e],l)}function h(a,b,c){0>c&&1===a.x&&(a=new THREE.Vector2(a.x-1,a.y));0===b.x&&0===b.z&&(a=new THREE.Vector2(c/
2/Math.PI+.5,a.y));return a.clone()}THREE.Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:a,indices:b,radius:c,detail:e};c=c||1;e=e||0;for(var k=this,l=0,n=a.length;l<n;l+=3)d(new THREE.Vector3(a[l],a[l+1],a[l+2]));a=this.vertices;for(var q=[],m=l=0,n=b.length;l<n;l+=3,m++){var p=a[b[l]],r=a[b[l+1]],u=a[b[l+2]];q[m]=new THREE.Face3(p.index,r.index,u.index,[p.clone(),r.clone(),u.clone()],void 0,m)}for(var t=new THREE.Vector3,l=0,n=q.length;l<n;l++)f(q[l],e);l=0;for(n=this.faceVertexUvs[0].length;l<
n;l++)b=this.faceVertexUvs[0][l],e=b[0].x,a=b[1].x,q=b[2].x,m=Math.max(e,a,q),p=Math.min(e,a,q),.9<m&&.1>p&&(.2>e&&(b[0].x+=1),.2>a&&(b[1].x+=1),.2>q&&(b[2].x+=1));l=0;for(n=this.vertices.length;l<n;l++)this.vertices[l].multiplyScalar(c);this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry;
THREE.DodecahedronGeometry=function(a,b){var c=(1+Math.sqrt(5))/2,e=1/c;THREE.PolyhedronGeometry.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-e,-c,0,-e,c,0,e,-c,0,e,c,-e,-c,0,-e,c,0,e,-c,0,e,c,0,-c,0,-e,c,0,-e,-c,0,e,c,0,e],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,
12,14,1,14,5,1,5,9],a,b);this.type="DodecahedronGeometry";this.parameters={radius:a,detail:b}};THREE.DodecahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.DodecahedronGeometry.prototype.constructor=THREE.DodecahedronGeometry;
THREE.IcosahedronGeometry=function(a,b){var c=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type="IcosahedronGeometry";this.parameters={radius:a,detail:b}};THREE.IcosahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);
THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry;THREE.OctahedronGeometry=function(a,b){THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,b);this.type="OctahedronGeometry";this.parameters={radius:a,detail:b}};THREE.OctahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry;
THREE.TetrahedronGeometry=function(a,b){THREE.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,b);this.type="TetrahedronGeometry";this.parameters={radius:a,detail:b}};THREE.TetrahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry;
THREE.ParametricGeometry=function(a,b,c){THREE.Geometry.call(this);this.type="ParametricGeometry";this.parameters={func:a,slices:b,stacks:c};var e=this.vertices,d=this.faces,g=this.faceVertexUvs[0],f,h,k,l,n=b+1;for(f=0;f<=c;f++)for(l=f/c,h=0;h<=b;h++)k=h/b,k=a(k,l),e.push(k);var q,m,p,r;for(f=0;f<c;f++)for(h=0;h<b;h++)a=f*n+h,e=f*n+h+1,l=(f+1)*n+h+1,k=(f+1)*n+h,q=new THREE.Vector2(h/b,f/c),m=new THREE.Vector2((h+1)/b,f/c),p=new THREE.Vector2((h+1)/b,(f+1)/c),r=new THREE.Vector2(h/b,(f+1)/c),d.push(new THREE.Face3(a,
e,k)),g.push([q,m,r]),d.push(new THREE.Face3(e,l,k)),g.push([m.clone(),p,r.clone()]);this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry;
THREE.WireframeGeometry=function(a){function b(a,b){return a-b}THREE.BufferGeometry.call(this);var c=[0,0],e={},d=["a","b","c"];if(a instanceof THREE.Geometry){var g=a.vertices,f=a.faces,h=0,k=new Uint32Array(6*f.length);a=0;for(var l=f.length;a<l;a++)for(var n=f[a],q=0;3>q;q++){c[0]=n[d[q]];c[1]=n[d[(q+1)%3]];c.sort(b);var m=c.toString();void 0===e[m]&&(k[2*h]=c[0],k[2*h+1]=c[1],e[m]=!0,h++)}c=new Float32Array(6*h);a=0;for(l=h;a<l;a++)for(q=0;2>q;q++)e=g[k[2*a+q]],h=6*a+3*q,c[h+0]=e.x,c[h+1]=e.y,
c[h+2]=e.z;this.addAttribute("position",new THREE.BufferAttribute(c,3))}else if(a instanceof THREE.BufferGeometry){if(null!==a.index){l=a.index.array;g=a.attributes.position;d=a.groups;h=0;0===d.length&&a.addGroup(0,l.length);k=new Uint32Array(2*l.length);f=0;for(n=d.length;f<n;++f){a=d[f];q=a.start;m=a.count;a=q;for(var p=q+m;a<p;a+=3)for(q=0;3>q;q++)c[0]=l[a+q],c[1]=l[a+(q+1)%3],c.sort(b),m=c.toString(),void 0===e[m]&&(k[2*h]=c[0],k[2*h+1]=c[1],e[m]=!0,h++)}c=new Float32Array(6*h);a=0;for(l=h;a<
l;a++)for(q=0;2>q;q++)h=6*a+3*q,e=k[2*a+q],c[h+0]=g.getX(e),c[h+1]=g.getY(e),c[h+2]=g.getZ(e)}else for(g=a.attributes.position.array,h=g.length/3,k=h/3,c=new Float32Array(6*h),a=0,l=k;a<l;a++)for(q=0;3>q;q++)h=18*a+6*q,k=9*a+3*q,c[h+0]=g[k],c[h+1]=g[k+1],c[h+2]=g[k+2],e=9*a+(q+1)%3*3,c[h+3]=g[e],c[h+4]=g[e+1],c[h+5]=g[e+2];this.addAttribute("position",new THREE.BufferAttribute(c,3))}};THREE.WireframeGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);
THREE.WireframeGeometry.prototype.constructor=THREE.WireframeGeometry;THREE.AxisHelper=function(a){a=a||1;var b=new Float32Array([0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a]),c=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.BufferAttribute(b,3));a.addAttribute("color",new THREE.BufferAttribute(c,3));b=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.LineSegments.call(this,a,b)};THREE.AxisHelper.prototype=Object.create(THREE.LineSegments.prototype);
THREE.AxisHelper.prototype.constructor=THREE.AxisHelper;
THREE.ArrowHelper=function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var b=new THREE.CylinderGeometry(0,.5,1,5,1);b.translate(0,-.5,0);return function(c,e,d,g,f,h){THREE.Object3D.call(this);void 0===g&&(g=16776960);void 0===d&&(d=1);void 0===f&&(f=.2*d);void 0===h&&(h=.2*f);this.position.copy(e);this.line=new THREE.Line(a,new THREE.LineBasicMaterial({color:g}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new THREE.Mesh(b,new THREE.MeshBasicMaterial({color:g}));
this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(c);this.setLength(d,f,h)}}();THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper;THREE.ArrowHelper.prototype.setDirection=function(){var a=new THREE.Vector3,b;return function(c){.99999<c.y?this.quaternion.set(0,0,0,1):-.99999>c.y?this.quaternion.set(1,0,0,0):(a.set(c.z,0,-c.x).normalize(),b=Math.acos(c.y),this.quaternion.setFromAxisAngle(a,b))}}();
THREE.ArrowHelper.prototype.setLength=function(a,b,c){void 0===b&&(b=.2*a);void 0===c&&(c=.2*b);this.line.scale.set(1,Math.max(0,a-b),1);this.line.updateMatrix();this.cone.scale.set(c,b,c);this.cone.position.y=a;this.cone.updateMatrix()};THREE.ArrowHelper.prototype.setColor=function(a){this.line.material.color.set(a);this.cone.material.color.set(a)};
THREE.BoxHelper=function(a){var b=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),c=new Float32Array(24),e=new THREE.BufferGeometry;e.setIndex(new THREE.BufferAttribute(b,1));e.addAttribute("position",new THREE.BufferAttribute(c,3));THREE.LineSegments.call(this,e,new THREE.LineBasicMaterial({color:16776960}));void 0!==a&&this.update(a)};THREE.BoxHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.BoxHelper.prototype.constructor=THREE.BoxHelper;
THREE.BoxHelper.prototype.update=function(){var a=new THREE.Box3;return function(b){a.setFromObject(b);if(!a.isEmpty()){b=a.min;var c=a.max,e=this.geometry.attributes.position,d=e.array;d[0]=c.x;d[1]=c.y;d[2]=c.z;d[3]=b.x;d[4]=c.y;d[5]=c.z;d[6]=b.x;d[7]=b.y;d[8]=c.z;d[9]=c.x;d[10]=b.y;d[11]=c.z;d[12]=c.x;d[13]=c.y;d[14]=b.z;d[15]=b.x;d[16]=c.y;d[17]=b.z;d[18]=b.x;d[19]=b.y;d[20]=b.z;d[21]=c.x;d[22]=b.y;d[23]=b.z;e.needsUpdate=!0;this.geometry.computeBoundingSphere()}}}();
THREE.BoundingBoxHelper=function(a,b){var c=void 0!==b?b:8947848;this.object=a;this.box=new THREE.Box3;THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:c,wireframe:!0}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.constructor=THREE.BoundingBoxHelper;THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};
THREE.CameraHelper=function(a){function b(a,b,d){c(a,d);c(b,d)}function c(a,b){e.vertices.push(new THREE.Vector3);e.colors.push(new THREE.Color(b));void 0===g[a]&&(g[a]=[]);g[a].push(e.vertices.length-1)}var e=new THREE.Geometry,d=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),g={};b("n1","n2",16755200);b("n2","n4",16755200);b("n4","n3",16755200);b("n3","n1",16755200);b("f1","f2",16755200);b("f2","f4",16755200);b("f4","f3",16755200);b("f3","f1",16755200);b("n1","f1",16755200);
b("n2","f2",16755200);b("n3","f3",16755200);b("n4","f4",16755200);b("p","n1",16711680);b("p","n2",16711680);b("p","n3",16711680);b("p","n4",16711680);b("u1","u2",43775);b("u2","u3",43775);b("u3","u1",43775);b("c","t",16777215);b("p","c",3355443);b("cn1","cn2",3355443);b("cn3","cn4",3355443);b("cf1","cf2",3355443);b("cf3","cf4",3355443);THREE.LineSegments.call(this,e,d);this.camera=a;this.camera.updateProjectionMatrix();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=g;this.update()};
THREE.CameraHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.CameraHelper.prototype.constructor=THREE.CameraHelper;
THREE.CameraHelper.prototype.update=function(){function a(a,f,h,k){e.set(f,h,k).unproject(d);a=c[a];if(void 0!==a)for(f=0,h=a.length;f<h;f++)b.vertices[a[f]].copy(e)}var b,c,e=new THREE.Vector3,d=new THREE.Camera;return function(){b=this.geometry;c=this.pointMap;d.projectionMatrix.copy(this.camera.projectionMatrix);a("c",0,0,-1);a("t",0,0,1);a("n1",-1,-1,-1);a("n2",1,-1,-1);a("n3",-1,1,-1);a("n4",1,1,-1);a("f1",-1,-1,1);a("f2",1,-1,1);a("f3",-1,1,1);a("f4",1,1,1);a("u1",.7,1.1,-1);a("u2",-.7,1.1,
-1);a("u3",0,2,-1);a("cf1",-1,0,1);a("cf2",1,0,1);a("cf3",0,-1,1);a("cf4",0,1,1);a("cn1",-1,0,-1);a("cn2",1,0,-1);a("cn3",0,-1,-1);a("cn4",0,1,-1);b.verticesNeedUpdate=!0}}();
THREE.DirectionalLightHelper=function(a,b){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;b=b||1;var c=new THREE.Geometry;c.vertices.push(new THREE.Vector3(-b,b,0),new THREE.Vector3(b,b,0),new THREE.Vector3(b,-b,0),new THREE.Vector3(-b,-b,0),new THREE.Vector3(-b,b,0));var e=new THREE.LineBasicMaterial({fog:!1});e.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new THREE.Line(c,e);this.add(this.lightPlane);
c=new THREE.Geometry;c.vertices.push(new THREE.Vector3,new THREE.Vector3);e=new THREE.LineBasicMaterial({fog:!1});e.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new THREE.Line(c,e);this.add(this.targetLine);this.update()};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.DirectionalLightHelper.prototype.constructor=THREE.DirectionalLightHelper;
THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};
THREE.DirectionalLightHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);c.subVectors(b,a);this.lightPlane.lookAt(c);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(c);this.targetLine.geometry.verticesNeedUpdate=!0;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();
THREE.EdgesHelper=function(a,b,c){b=void 0!==b?b:16777215;THREE.LineSegments.call(this,new THREE.EdgesGeometry(a.geometry,c),new THREE.LineBasicMaterial({color:b}));this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1};THREE.EdgesHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.EdgesHelper.prototype.constructor=THREE.EdgesHelper;
THREE.FaceNormalsHelper=function(a,b,c,e){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16776960;e=void 0!==e?e:1;b=0;c=this.object.geometry;c instanceof THREE.Geometry?b=c.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");c=new THREE.BufferGeometry;b=new THREE.Float32Attribute(6*b,3);c.addAttribute("position",b);THREE.LineSegments.call(this,c,new THREE.LineBasicMaterial({color:a,linewidth:e}));this.matrixAutoUpdate=
!1;this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.FaceNormalsHelper.prototype.constructor=THREE.FaceNormalsHelper;
THREE.FaceNormalsHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(){this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);for(var e=this.object.matrixWorld,d=this.geometry.attributes.position,g=this.object.geometry,f=g.vertices,g=g.faces,h=0,k=0,l=g.length;k<l;k++){var n=g[k],q=n.normal;a.copy(f[n.a]).add(f[n.b]).add(f[n.c]).divideScalar(3).applyMatrix4(e);b.copy(q).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);
d.setXYZ(h,a.x,a.y,a.z);h+=1;d.setXYZ(h,b.x,b.y,b.z);h+=1}d.needsUpdate=!0;return this}}();
THREE.GridHelper=function(a,b){var c=new THREE.Geometry,e=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924);this.color2=new THREE.Color(8947848);for(var d=-a;d<=a;d+=b){c.vertices.push(new THREE.Vector3(-a,0,d),new THREE.Vector3(a,0,d),new THREE.Vector3(d,0,-a),new THREE.Vector3(d,0,a));var g=0===d?this.color1:this.color2;c.colors.push(g,g,g,g)}THREE.LineSegments.call(this,c,e)};THREE.GridHelper.prototype=Object.create(THREE.LineSegments.prototype);
THREE.GridHelper.prototype.constructor=THREE.GridHelper;THREE.GridHelper.prototype.setColors=function(a,b){this.color1.set(a);this.color2.set(b);this.geometry.colorsNeedUpdate=!0};
THREE.HemisphereLightHelper=function(a,b){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.colors=[new THREE.Color,new THREE.Color];var c=new THREE.SphereGeometry(b,4,2);c.rotateX(-Math.PI/2);for(var e=0;8>e;e++)c.faces[e].color=this.colors[4>e?0:1];e=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(c,e);this.add(this.lightSphere);this.update()};
THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.constructor=THREE.HemisphereLightHelper;THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};
THREE.HemisphereLightHelper.prototype.update=function(){var a=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=!0}}();
THREE.PointLightHelper=function(a,b){this.light=a;this.light.updateMatrixWorld();var c=new THREE.SphereGeometry(b,4,2),e=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});e.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,c,e);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.constructor=THREE.PointLightHelper;
THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};
THREE.SkeletonHelper=function(a){this.bones=this.getBoneList(a);for(var b=new THREE.Geometry,c=0;c<this.bones.length;c++)this.bones[c].parent instanceof THREE.Bone&&(b.vertices.push(new THREE.Vector3),b.vertices.push(new THREE.Vector3),b.colors.push(new THREE.Color(0,0,1)),b.colors.push(new THREE.Color(0,1,0)));b.dynamic=!0;c=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});THREE.LineSegments.call(this,b,c);this.root=a;this.matrix=a.matrixWorld;
this.matrixAutoUpdate=!1;this.update()};THREE.SkeletonHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.SkeletonHelper.prototype.constructor=THREE.SkeletonHelper;THREE.SkeletonHelper.prototype.getBoneList=function(a){var b=[];a instanceof THREE.Bone&&b.push(a);for(var c=0;c<a.children.length;c++)b.push.apply(b,this.getBoneList(a.children[c]));return b};
THREE.SkeletonHelper.prototype.update=function(){for(var a=this.geometry,b=(new THREE.Matrix4).getInverse(this.root.matrixWorld),c=new THREE.Matrix4,e=0,d=0;d<this.bones.length;d++){var g=this.bones[d];g.parent instanceof THREE.Bone&&(c.multiplyMatrices(b,g.matrixWorld),a.vertices[e].setFromMatrixPosition(c),c.multiplyMatrices(b,g.parent.matrixWorld),a.vertices[e+1].setFromMatrixPosition(c),e+=2)}a.verticesNeedUpdate=!0;a.computeBoundingSphere()};
THREE.SpotLightHelper=function(a){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;a=new THREE.CylinderGeometry(0,1,1,8,1,!0);a.translate(0,-.5,0);a.rotateX(-Math.PI/2);var b=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new THREE.Mesh(a,b);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.SpotLightHelper.prototype.constructor=THREE.SpotLightHelper;
THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};THREE.SpotLightHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){var c=this.light.distance?this.light.distance:1E4,e=c*Math.tan(this.light.angle);this.cone.scale.set(e,e,c);a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(b.sub(a));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();
THREE.VertexNormalsHelper=function(a,b,c,e){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16711680;e=void 0!==e?e:1;b=0;c=this.object.geometry;c instanceof THREE.Geometry?b=3*c.faces.length:c instanceof THREE.BufferGeometry&&(b=c.attributes.normal.count);c=new THREE.BufferGeometry;b=new THREE.Float32Attribute(6*b,3);c.addAttribute("position",b);THREE.LineSegments.call(this,c,new THREE.LineBasicMaterial({color:a,linewidth:e}));this.matrixAutoUpdate=!1;this.update()};
THREE.VertexNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.VertexNormalsHelper.prototype.constructor=THREE.VertexNormalsHelper;
THREE.VertexNormalsHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(){var e=["a","b","c"];this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);var d=this.object.matrixWorld,g=this.geometry.attributes.position,f=this.object.geometry;if(f instanceof THREE.Geometry)for(var h=f.vertices,k=f.faces,l=f=0,n=k.length;l<n;l++)for(var q=k[l],m=0,p=q.vertexNormals.length;m<p;m++){var r=q.vertexNormals[m];a.copy(h[q[e[m]]]).applyMatrix4(d);
b.copy(r).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);g.setXYZ(f,a.x,a.y,a.z);f+=1;g.setXYZ(f,b.x,b.y,b.z);f+=1}else if(f instanceof THREE.BufferGeometry)for(e=f.attributes.position,h=f.attributes.normal,m=f=0,p=e.count;m<p;m++)a.set(e.getX(m),e.getY(m),e.getZ(m)).applyMatrix4(d),b.set(h.getX(m),h.getY(m),h.getZ(m)),b.applyMatrix3(c).normalize().multiplyScalar(this.size).add(a),g.setXYZ(f,a.x,a.y,a.z),f+=1,g.setXYZ(f,b.x,b.y,b.z),f+=1;g.needsUpdate=!0;return this}}();
THREE.WireframeHelper=function(a,b){var c=void 0!==b?b:16777215;THREE.LineSegments.call(this,new THREE.WireframeGeometry(a.geometry),new THREE.LineBasicMaterial({color:c}));this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1};THREE.WireframeHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.WireframeHelper.prototype.constructor=THREE.WireframeHelper;THREE.ImmediateRenderObject=function(a){THREE.Object3D.call(this);this.material=a;this.render=function(a){}};
THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject;THREE.MorphBlendMesh=function(a,b){THREE.Mesh.call(this,a,b);this.animationsMap={};this.animationsList=[];var c=this.geometry.morphTargets.length;this.createAnimation("__default",0,c-1,c/1);this.setAnimationWeight("__default",1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh;
THREE.MorphBlendMesh.prototype.createAnimation=function(a,b,c,e){b={start:b,end:c,length:c-b+1,fps:e,duration:(c-b)/e,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[a]=b;this.animationsList.push(b)};
THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(a){for(var b=/([a-z]+)_?(\d+)/i,c,e={},d=this.geometry,g=0,f=d.morphTargets.length;g<f;g++){var h=d.morphTargets[g].name.match(b);if(h&&1<h.length){var k=h[1];e[k]||(e[k]={start:Infinity,end:-Infinity});h=e[k];g<h.start&&(h.start=g);g>h.end&&(h.end=g);c||(c=k)}}for(k in e)h=e[k],this.createAnimation(k,h.start,h.end,a);this.firstAnimation=c};
THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){if(a=this.animationsMap[a])a.direction=1,a.directionBackwards=!1};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(a){if(a=this.animationsMap[a])a.direction=-1,a.directionBackwards=!0};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];c&&(c.fps=b,c.duration=(c.end-c.start)/c.fps)};
THREE.MorphBlendMesh.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];c&&(c.duration=b,c.fps=(c.end-c.start)/c.duration)};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];c&&(c.weight=b)};THREE.MorphBlendMesh.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];c&&(c.time=b)};THREE.MorphBlendMesh.prototype.getAnimationTime=function(a){var b=0;if(a=this.animationsMap[a])b=a.time;return b};
THREE.MorphBlendMesh.prototype.getAnimationDuration=function(a){var b=-1;if(a=this.animationsMap[a])b=a.duration;return b};THREE.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];b?(b.time=0,b.active=!0):console.warn("THREE.MorphBlendMesh: animation["+a+"] undefined in .playAnimation()")};THREE.MorphBlendMesh.prototype.stopAnimation=function(a){if(a=this.animationsMap[a])a.active=!1};
THREE.MorphBlendMesh.prototype.update=function(a){for(var b=0,c=this.animationsList.length;b<c;b++){var e=this.animationsList[b];if(e.active){var d=e.duration/e.length;e.time+=e.direction*a;if(e.mirroredLoop){if(e.time>e.duration||0>e.time)e.direction*=-1,e.time>e.duration&&(e.time=e.duration,e.directionBackwards=!0),0>e.time&&(e.time=0,e.directionBackwards=!1)}else e.time%=e.duration,0>e.time&&(e.time+=e.duration);var g=e.start+THREE.Math.clamp(Math.floor(e.time/d),0,e.length-1),f=e.weight;g!==e.currentFrame&&
(this.morphTargetInfluences[e.lastFrame]=0,this.morphTargetInfluences[e.currentFrame]=1*f,this.morphTargetInfluences[g]=0,e.lastFrame=e.currentFrame,e.currentFrame=g);d=e.time%d/d;e.directionBackwards&&(d=1-d);e.currentFrame!==e.lastFrame?(this.morphTargetInfluences[e.currentFrame]=d*f,this.morphTargetInfluences[e.lastFrame]=(1-d)*f):this.morphTargetInfluences[e.currentFrame]=f}}};
Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(a){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");a.id="webgl-error-message";a.style.fontFamily="monospace";a.style.fontSize="13px";a.style.fontWeight="normal";a.style.textAlign="center";a.style.background=
"#fff";a.style.color="#000";a.style.padding="1.5em";a.style.width="400px";a.style.margin="5em auto 0";this.webgl||(a.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return a},addGetWebGLMessage:function(a){var b,c;a=a||{};b=void 0!==a.parent?a.parent:document.body;a=void 0!==a.id?a.id:"oldie";c=Detector.getWebGLErrorMessage();c.id=a;b.appendChild(c)}};
function TimeSeries(a){a=a||{};a.resetBoundsInterval=a.resetBoundsInterval||3E3;a.resetBounds=void 0===a.resetBounds?!0:a.resetBounds;this.options=a;this.data=[];this.label=a.label||"";this.maxDataLength=a.maxDataLength||1E3;this.dataPool=[];this.minValue=this.maxValue=Number.NaN;a.resetBounds&&(this.boundsTimer=setInterval(function(a){return function(){a.resetBounds()}}(this),a.resetBoundsInterval))}
TimeSeries.prototype.resetBounds=function(){this.minValue=this.maxValue=Number.NaN;for(var a=0;a<this.data.length;a++)this.maxValue=isNaN(this.maxValue)?this.data[a][1]:Math.max(this.maxValue,this.data[a][1]),this.minValue=isNaN(this.minValue)?this.data[a][1]:Math.min(this.minValue,this.data[a][1])};
TimeSeries.prototype.append=function(a,b){this.lastTimeStamp=a;var c=this.dataPool.length?this.dataPool.pop():[a,b];c[0]=a;c[1]=b;this.data.push(c);this.maxValue=isNaN(this.maxValue)?b:Math.max(this.maxValue,b);for(this.minValue=isNaN(this.minValue)?b:Math.min(this.minValue,b);this.data.length>this.maxDataLength;)this.dataPool.push(this.data.shift())};
function SmoothieChart(a){a=a||{};a.grid=a.grid||{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:1,millisPerLine:1E3,verticalSections:2};a.millisPerPixel=a.millisPerPixel||20;a.fps=a.fps||50;a.maxValueScale=a.maxValueScale||1;a.minValue=a.minValue;a.maxValue=a.maxValue;a.labels=a.labels||{fillStyle:"#ffffff"};a.interpolation=a.interpolation||"bezier";a.scaleSmoothing=a.scaleSmoothing||.125;a.maxDataSetLength=a.maxDataSetLength||2;a.timestampFormatter=a.timestampFormatter||null;this.options=a;
this.seriesSet=[];this.currentValueRange=1;this.currentVisMinValue=0}SmoothieChart.prototype.addTimeSeries=function(a,b){this.seriesSet.push({timeSeries:a,options:b||{}})};SmoothieChart.prototype.removeTimeSeries=function(a){this.seriesSet.splice(this.seriesSet.indexOf(a),1)};SmoothieChart.prototype.streamTo=function(a,b){var c=this;this.render_on_tick=function(){c.render(a,c.seriesSet[0].timeSeries.lastTimeStamp)};this.start()};
SmoothieChart.prototype.start=function(){this.timer||(this.timer=setInterval(this.render_on_tick,1E3/this.options.fps))};SmoothieChart.prototype.stop=function(){this.timer&&(clearInterval(this.timer),this.timer=void 0)};SmoothieChart.timeFormatter=function(a){function b(a){return(10>a?"0":"")+a}return b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())};
SmoothieChart.prototype.render=function(a,b){var c=a.getContext("2d"),e=this.options,d=a.clientWidth,g=a.clientHeight;c.save();b-=b%e.millisPerPixel;c.translate(0,0);c.beginPath();c.rect(0,0,d,g);c.clip();c.save();c.fillStyle=e.grid.fillStyle;c.clearRect(0,0,d,g);c.fillRect(0,0,d,g);c.restore();c.save();c.lineWidth=e.grid.lineWidth||1;c.strokeStyle=e.grid.strokeStyle||"#ffffff";if(0<e.grid.millisPerLine)for(var f=b-b%e.grid.millisPerLine;f>=b-d*e.millisPerPixel;f-=e.grid.millisPerLine){c.beginPath();
var h=Math.round(d-(b-f)/e.millisPerPixel);c.moveTo(h,0);c.lineTo(h,g);c.stroke();if(e.timestampFormatter){var k=e.timestampFormatter(new Date(f)),l=c.measureText(k).width/2+c.measureText(x).width+4;h<d-l&&(c.fillStyle=e.labels.fillStyle,c.fillText(k,h-c.measureText(k).width/2,g-2))}c.closePath()}for(x=1;x<e.grid.verticalSections;x++)f=Math.round(x*g/e.grid.verticalSections),c.beginPath(),c.moveTo(0,f),c.lineTo(d,f),c.stroke(),c.closePath();c.beginPath();c.strokeRect(0,0,d,g);c.closePath();c.restore();
x=h=Number.NaN;for(k=0;k<this.seriesSet.length;k++){var n=this.seriesSet[k].timeSeries;isNaN(n.maxValue)||(h=isNaN(h)?n.maxValue:Math.max(h,n.maxValue));isNaN(n.minValue)||(x=isNaN(x)?n.minValue:Math.min(x,n.minValue))}if(!isNaN(h)||!isNaN(x)){h=null!=e.maxValue?e.maxValue:h*e.maxValueScale;null!=e.minValue&&(x=e.minValue);this.currentValueRange+=e.scaleSmoothing*(h-x-this.currentValueRange);this.currentVisMinValue+=e.scaleSmoothing*(x-this.currentVisMinValue);for(var l=this.currentValueRange,q=this.currentVisMinValue,
k=0;k<this.seriesSet.length;k++){c.save();for(var n=this.seriesSet[k].timeSeries,n=n.data,m=this.seriesSet[k].options;n.length>=e.maxDataSetLength&&n[1][0]<b-d*e.millisPerPixel;)n.splice(0,1);c.lineWidth=m.lineWidth||1;c.fillStyle=m.fillStyle;c.strokeStyle=m.strokeStyle||"#ffffff";c.beginPath();for(var p=0,r=0,u=0,f=0;f<n.length;f++){var t=Math.round(d-(b-n[f][0])/e.millisPerPixel),v=n[f][1]-q,v=Math.max(Math.min(g-(l?Math.round(v/l*g):0),g-1),1);if(0==f)p=t,c.moveTo(t,v);else switch(e.interpolation){case "line":c.lineTo(t,
v);break;default:c.bezierCurveTo(Math.round((r+t)/2),u,Math.round(r+t)/2,v,t,v)}r=t;u=v}0<n.length&&m.fillStyle&&(c.lineTo(d+m.lineWidth+1,u),c.lineTo(d+m.lineWidth+1,g+m.lineWidth+1),c.lineTo(p,g+m.lineWidth),c.fill());c.stroke();c.closePath();c.restore()}if(!e.labels.disabled){e.labelOffsetY||(e.labelOffsetY=0);c.fillStyle=e.labels.fillStyle;var f=parseFloat(h).toFixed(2),x=parseFloat(x).toFixed(2);c.fillText(f,d-c.measureText(f).width-2,10);c.fillText(x,d-c.measureText(x).width-2,g-2);for(f=0;f<
this.seriesSet.length;f++)n=this.seriesSet[f].timeSeries,d=n.label,c.fillStyle=n.options.fillStyle||"rgb(255,255,255)",d&&c.fillText(d,2,10*(f+1)+e.labelOffsetY)}}c.restore()};
var Stats=function(){var a,b,c=0,e=0,d=Date.now(),g=d,f=d,h=0,k=1E3,l=0,n,q,m,p=[[16,16,48],[0,255,255]],r=0,u=1E3,t=0,v,x,A,w=[[16,48,16],[0,255,0]];a=document.createElement("div");a.style.cursor="pointer";a.style.width="80px";a.style.opacity="0.9";a.style.zIndex="10001";a.addEventListener("mousedown",function(a){a.preventDefault();c=(c+1)%2;0==c?(n.style.display="block",v.style.display="none"):(n.style.display="none",v.style.display="block")},!1);n=document.createElement("div");n.style.textAlign=
"left";n.style.lineHeight="1.2em";n.style.backgroundColor="rgb("+Math.floor(p[0][0]/2)+","+Math.floor(p[0][1]/2)+","+Math.floor(p[0][2]/2)+")";n.style.padding="0 0 3px 3px";a.appendChild(n);q=document.createElement("div");q.style.fontFamily="Helvetica, Arial, sans-serif";q.style.fontSize="9px";q.style.color="rgb("+p[1][0]+","+p[1][1]+","+p[1][2]+")";q.style.fontWeight="bold";q.innerHTML="FPS";n.appendChild(q);m=document.createElement("div");m.style.position="relative";m.style.width="74px";m.style.height=
"30px";m.style.backgroundColor="rgb("+p[1][0]+","+p[1][1]+","+p[1][2]+")";for(n.appendChild(m);74>m.children.length;)b=document.createElement("span"),b.style.width="1px",b.style.height="30px",b.style.cssFloat="left",b.style.backgroundColor="rgb("+p[0][0]+","+p[0][1]+","+p[0][2]+")",m.appendChild(b);v=document.createElement("div");v.style.textAlign="left";v.style.lineHeight="1.2em";v.style.backgroundColor="rgb("+Math.floor(w[0][0]/2)+","+Math.floor(w[0][1]/2)+","+Math.floor(w[0][2]/2)+")";v.style.padding=
"0 0 3px 3px";v.style.display="none";a.appendChild(v);x=document.createElement("div");x.style.fontFamily="Helvetica, Arial, sans-serif";x.style.fontSize="9px";x.style.color="rgb("+w[1][0]+","+w[1][1]+","+w[1][2]+")";x.style.fontWeight="bold";x.innerHTML="MS";v.appendChild(x);A=document.createElement("div");A.style.position="relative";A.style.width="74px";A.style.height="30px";A.style.backgroundColor="rgb("+w[1][0]+","+w[1][1]+","+w[1][2]+")";for(v.appendChild(A);74>A.children.length;)b=document.createElement("span"),
b.style.width="1px",b.style.height=30*Math.random()+"px",b.style.cssFloat="left",b.style.backgroundColor="rgb("+w[0][0]+","+w[0][1]+","+w[0][2]+")",A.appendChild(b);return{domElement:a,update:function(){d=Date.now();r=d-g;u=Math.min(u,r);t=Math.max(t,r);x.textContent=r+" MS ("+u+"-"+t+")";var a=Math.min(30,30-r/200*30);A.appendChild(A.firstChild).style.height=a+"px";g=d;e++;d>f+1E3&&(h=Math.round(1E3*e/(d-f)),k=Math.min(k,h),l=Math.max(l,h),q.textContent=h+" FPS ("+k+"-"+l+")",a=Math.min(30,30-h/
100*30),m.appendChild(m.firstChild).style.height=a+"px",f=d,e=0)}}};
THREE.TrackballControls=function(a,b){function c(a){!1!==f.enabled&&(window.removeEventListener("keydown",c),n=l,l===h.NONE)&&(a.keyCode!==f.keys[h.ROTATE]||f.noRotate?a.keyCode!==f.keys[h.ZOOM]||f.noZoom?a.keyCode!==f.keys[h.PAN]||f.noPan||(l=h.PAN):l=h.ZOOM:l=h.ROTATE)}function e(a){!1!==f.enabled&&(a.preventDefault(),a.stopPropagation(),l!==h.ROTATE||f.noRotate?l!==h.ZOOM||f.noZoom?l!==h.PAN||f.noPan||A.copy(z(a.pageX,a.pageY)):u.copy(z(a.pageX,a.pageY)):p.copy(F(a.pageX,a.pageY)))}function d(a){!1!==
f.enabled&&(a.preventDefault(),a.stopPropagation(),l=h.NONE,document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",d),f.dispatchEvent(B))}function g(a){if(!1!==f.enabled){a.preventDefault();a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3);r.y+=.01*b;f.dispatchEvent(D);f.dispatchEvent(B)}}var f=this,h={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=a;this.domElement=void 0!==b?b:document;this.enabled=!0;this.screen=
{left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.staticMoving=this.noRoll=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3;var k=new THREE.Vector3,l=h.NONE,n=h.NONE,q=new THREE.Vector3,m=new THREE.Vector3,p=new THREE.Vector3,r=new THREE.Vector2,u=new THREE.Vector2,t=0,v=0,x=new THREE.Vector2,A=new THREE.Vector2;this.target0=this.target.clone();
this.position0=this.object.position.clone();this.up0=this.object.up.clone();var w={type:"change"},D={type:"start"},B={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),b=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-b.clientLeft;this.screen.top=a.top+window.pageYOffset-b.clientTop;
this.screen.width=a.width;this.screen.height=a.height}};this.handleEvent=function(a){if("function"==typeof this[a.type])this[a.type](a)};var z=function(){var a=new THREE.Vector2;return function(b,c){a.set((b-f.screen.left)/f.screen.width,(c-f.screen.top)/f.screen.height);return a}}(),F=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e){c.set((d-.5*f.screen.width-f.screen.left)/(.5*f.screen.width),(.5*f.screen.height+f.screen.top-e)/(.5*f.screen.height),
0);var g=c.length();f.noRoll?c.z=g<Math.SQRT1_2?Math.sqrt(1-g*g):.5/g:1<g?c.normalize():c.z=Math.sqrt(1-g*g);q.copy(f.object.position).sub(f.target);a.copy(f.object.up).setLength(c.y);a.add(b.copy(f.object.up).cross(q).setLength(c.x));a.add(q.setLength(c.z));return a}}();this.rotateCamera=function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(){var c=Math.acos(m.dot(p)/m.length()/p.length());c&&(a.crossVectors(m,p).normalize(),c*=f.rotateSpeed,b.setFromAxisAngle(a,-c),q.applyQuaternion(b),
f.object.up.applyQuaternion(b),p.applyQuaternion(b),f.staticMoving?m.copy(p):(b.setFromAxisAngle(a,c*(f.dynamicDampingFactor-1)),m.applyQuaternion(b)))}}();this.zoomCamera=function(){if(l===h.TOUCH_ZOOM_PAN){var a=t/v;t=v;q.multiplyScalar(a)}else a=1+(u.y-r.y)*f.zoomSpeed,1!==a&&0<a&&(q.multiplyScalar(a),f.staticMoving?r.copy(u):r.y+=(u.y-r.y)*this.dynamicDampingFactor)};this.panCamera=function(){var a=new THREE.Vector2,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.copy(A).sub(x);a.lengthSq()&&
(a.multiplyScalar(q.length()*f.panSpeed),c.copy(q).cross(f.object.up).setLength(a.x),c.add(b.copy(f.object.up).setLength(a.y)),f.object.position.add(c),f.target.add(c),f.staticMoving?x.copy(A):x.add(a.subVectors(A,x).multiplyScalar(f.dynamicDampingFactor)))}}();this.checkDistances=function(){f.noZoom&&f.noPan||(q.lengthSq()>f.maxDistance*f.maxDistance&&f.object.position.addVectors(f.target,q.setLength(f.maxDistance)),q.lengthSq()<f.minDistance*f.minDistance&&f.object.position.addVectors(f.target,
q.setLength(f.minDistance)))};this.update=function(){q.subVectors(f.object.position,f.target);f.noRotate||f.rotateCamera();f.noZoom||f.zoomCamera();f.noPan||f.panCamera();f.object.position.addVectors(f.target,q);f.checkDistances();f.object.lookAt(f.target);1E-6<k.distanceToSquared(f.object.position)&&(f.dispatchEvent(w),k.copy(f.object.position))};this.reset=function(){n=l=h.NONE;f.target.copy(f.target0);f.object.position.copy(f.position0);f.object.up.copy(f.up0);q.subVectors(f.object.position,f.target);
f.object.lookAt(f.target);f.dispatchEvent(w);k.copy(f.object.position)};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(a){!1!==f.enabled&&(a.preventDefault(),a.stopPropagation(),l===h.NONE&&(l=a.button),l!==h.ROTATE||f.noRotate?l!==h.ZOOM||f.noZoom?l!==h.PAN||f.noPan||(x.copy(z(a.pageX,a.pageY)),A.copy(x)):(r.copy(z(a.pageX,a.pageY)),u.copy(r)):(m.copy(F(a.pageX,a.pageY)),p.copy(m)),document.addEventListener("mousemove",
e,!1),document.addEventListener("mouseup",d,!1),f.dispatchEvent(D))},!1);this.domElement.addEventListener("mousewheel",g,!1);this.domElement.addEventListener("DOMMouseScroll",g,!1);this.domElement.addEventListener("touchstart",function(a){if(!1!==f.enabled){switch(a.touches.length){case 1:l=h.TOUCH_ROTATE;m.copy(F(a.touches[0].pageX,a.touches[0].pageY));p.copy(m);break;case 2:l=h.TOUCH_ZOOM_PAN;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;v=t=Math.sqrt(b*b+c*
c);x.copy(z((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));A.copy(x);break;default:l=h.NONE}f.dispatchEvent(D)}},!1);this.domElement.addEventListener("touchend",function(a){if(!1!==f.enabled){switch(a.touches.length){case 1:p.copy(F(a.touches[0].pageX,a.touches[0].pageY));m.copy(p);break;case 2:t=v=0,A.copy(z((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2)),x.copy(A)}l=h.NONE;f.dispatchEvent(B)}},!1);this.domElement.addEventListener("touchmove",
function(a){if(!1!==f.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:p.copy(F(a.touches[0].pageX,a.touches[0].pageY));break;case 2:var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;v=Math.sqrt(b*b+c*c);A.copy(z((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));break;default:l=h.NONE}},!1);window.addEventListener("keydown",c,!1);window.addEventListener("keyup",function(a){!1!==f.enabled&&(l=n,window.addEventListener("keydown",
c,!1))},!1);this.handleResize();this.update()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);var dat=dat||{};dat.gui=dat.gui||{};dat.utils=dat.utils||{};dat.controllers=dat.controllers||{};dat.dom=dat.dom||{};dat.color=dat.color||{};
dat.utils.css=function(){return{load:function(a,b){b=b||document;var c=b.createElement("link");c.type="text/css";c.rel="stylesheet";c.href=a;b.getElementsByTagName("head")[0].appendChild(c)},inject:function(a,b){b=b||document;var c=document.createElement("style");c.type="text/css";c.innerHTML=a;b.getElementsByTagName("head")[0].appendChild(c)}}}();
dat.utils.common=function(){var a=Array.prototype.forEach,b=Array.prototype.slice;return{BREAK:{},extend:function(a){this.each(b.call(arguments,1),function(b){for(var c in b)this.isUndefined(b[c])||(a[c]=b[c])},this);return a},defaults:function(a){this.each(b.call(arguments,1),function(b){for(var c in b)this.isUndefined(a[c])&&(a[c]=b[c])},this);return a},compose:function(){var a=b.call(arguments);return function(){for(var c=b.call(arguments),d=a.length-1;0<=d;d--)c=[a[d].apply(this,c)];return c[0]}},
each:function(b,e,d){if(a&&b.forEach===a)b.forEach(e,d);else if(b.length===b.length+0)for(var c=0,f=b.length;c<f&&!(c in b&&e.call(d,b[c],c)===this.BREAK);c++);else for(c in b)if(e.call(d,b[c],c)===this.BREAK)break},defer:function(a){setTimeout(a,0)},toArray:function(a){return a.toArray?a.toArray():b.call(a)},isUndefined:function(a){return void 0===a},isNull:function(a){return null===a},isNaN:function(a){return a!==a},isArray:Array.isArray||function(a){return a.constructor===Array},isObject:function(a){return a===
Object(a)},isNumber:function(a){return a===a+0},isString:function(a){return a===a+""},isBoolean:function(a){return!1===a||!0===a},isFunction:function(a){return"[object Function]"===Object.prototype.toString.call(a)}}}();
dat.controllers.Controller=function(a){var b=function(a,b){this.initialValue=a[b];this.domElement=document.createElement("div");this.object=a;this.property=b;this.__onFinishChange=this.__onChange=void 0};a.extend(b.prototype,{onChange:function(a){this.__onChange=a;return this},onFinishChange:function(a){this.__onFinishChange=a;return this},setValue:function(a){this.object[this.property]=a;this.__onChange&&this.__onChange.call(this,a);this.updateDisplay();return this},getValue:function(){return this.object[this.property]},
updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}});return b}(dat.utils.common);
dat.dom.dom=function(a){function b(b){if("0"===b||a.isUndefined(b))return 0;b=b.match(e);return a.isNull(b)?0:parseFloat(b[1])}var c={};a.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(b,d){a.each(b,function(a){c[a]=d})});var e=/(\d+(\.\d+)?)px/,d={makeSelectable:function(a,b){void 0!==a&&void 0!==a.style&&(a.onselectstart=b?function(){return!1}:function(){},a.style.MozUserSelect=b?"auto":"none",a.style.KhtmlUserSelect=
b?"auto":"none",a.unselectable=b?"on":"off")},makeFullscreen:function(b,c,d){a.isUndefined(c)&&(c=!0);a.isUndefined(d)&&(d=!0);b.style.position="absolute";c&&(b.style.left=0,b.style.right=0);d&&(b.style.top=0,b.style.bottom=0)},fakeEvent:function(b,d,e,k){e=e||{};var g=c[d];if(!g)throw Error("Event type "+d+" not supported.");var f=document.createEvent(g);switch(g){case "MouseEvents":f.initMouseEvent(d,e.bubbles||!1,e.cancelable||!0,window,e.clickCount||1,0,0,e.x||e.clientX||0,e.y||e.clientY||0,!1,
!1,!1,!1,0,null);break;case "KeyboardEvents":g=f.initKeyboardEvent||f.initKeyEvent;a.defaults(e,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0});g(d,e.bubbles||!1,e.cancelable,window,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.keyCode,e.charCode);break;default:f.initEvent(d,e.bubbles||!1,e.cancelable||!0)}a.defaults(f,k);b.dispatchEvent(f)},bind:function(a,b,c,e){a.addEventListener?a.addEventListener(b,c,e||!1):a.attachEvent&&a.attachEvent("on"+b,c);return d},
unbind:function(a,b,c,e){a.removeEventListener?a.removeEventListener(b,c,e||!1):a.detachEvent&&a.detachEvent("on"+b,c);return d},addClass:function(a,b){if(void 0===a.className)a.className=b;else if(a.className!==b){var c=a.className.split(/ +/);-1==c.indexOf(b)&&(c.push(b),a.className=c.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return d},removeClass:function(a,b){if(b){if(void 0!==a.className)if(a.className===b)a.removeAttribute("class");else{var c=a.className.split(/ +/),e=c.indexOf(b);-1!=
e&&(c.splice(e,1),a.className=c.join(" "))}}else a.className=void 0;return d},hasClass:function(a,b){return(new RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)")).test(a.className)||!1},getWidth:function(a){a=getComputedStyle(a);return b(a["border-left-width"])+b(a["border-right-width"])+b(a["padding-left"])+b(a["padding-right"])+b(a.width)},getHeight:function(a){a=getComputedStyle(a);return b(a["border-top-width"])+b(a["border-bottom-width"])+b(a["padding-top"])+b(a["padding-bottom"])+b(a.height)},getOffset:function(a){var b=
{left:0,top:0};if(a.offsetParent){do b.left+=a.offsetLeft,b.top+=a.offsetTop;while(a=a.offsetParent)}return b},isActive:function(a){return a===document.activeElement&&(a.type||a.href)}};return d}(dat.utils.common);
dat.controllers.OptionController=function(a,b,c){var e=function(a,g,f){e.superclass.call(this,a,g);var d=this;this.__select=document.createElement("select");if(c.isArray(f)){var k={};c.each(f,function(a){k[a]=a});f=k}c.each(f,function(a,b){var c=document.createElement("option");c.innerHTML=b;c.setAttribute("value",a);d.__select.appendChild(c)});this.updateDisplay();b.bind(this.__select,"change",function(){d.setValue(this.options[this.selectedIndex].value)});this.domElement.appendChild(this.__select)};
e.superclass=a;c.extend(e.prototype,a.prototype,{setValue:function(a){a=e.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());return a},updateDisplay:function(){this.__select.value=this.getValue();return e.superclass.prototype.updateDisplay.call(this)}});return e}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.NumberController=function(a,b){var c=function(a,d,g){c.superclass.call(this,a,d);g=g||{};this.__min=g.min;this.__max=g.max;this.__step=g.step;b.isUndefined(this.__step)?this.__impliedStep=0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__impliedStep=this.__step;a=this.__impliedStep;a=a.toString();a=-1<a.indexOf(".")?a.length-a.indexOf(".")-1:0;this.__precision=a};c.superclass=a;b.extend(c.prototype,a.prototype,{setValue:function(a){void 0!==
this.__min&&a<this.__min?a=this.__min:void 0!==this.__max&&a>this.__max&&(a=this.__max);void 0!==this.__step&&0!=a%this.__step&&(a=Math.round(a/this.__step)*this.__step);return c.superclass.prototype.setValue.call(this,a)},min:function(a){this.__min=a;return this},max:function(a){this.__max=a;return this},step:function(a){this.__step=a;return this}});return c}(dat.controllers.Controller,dat.utils.common);
dat.controllers.NumberControllerBox=function(a,b,c){var e=function(a,g,f){function d(){var a=parseFloat(n.__input.value);c.isNaN(a)||n.setValue(a)}function k(a){var b=q-a.clientY;n.setValue(n.getValue()+b*n.__impliedStep);q=a.clientY}function l(){b.unbind(window,"mousemove",k);b.unbind(window,"mouseup",l)}this.__truncationSuspended=!1;e.superclass.call(this,a,g,f);var n=this,q;this.__input=document.createElement("input");this.__input.setAttribute("type","text");b.bind(this.__input,"change",d);b.bind(this.__input,
"blur",function(){d();n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())});b.bind(this.__input,"mousedown",function(a){b.bind(window,"mousemove",k);b.bind(window,"mouseup",l);q=a.clientY});b.bind(this.__input,"keydown",function(a){13===a.keyCode&&(n.__truncationSuspended=!0,this.blur(),n.__truncationSuspended=!1)});this.updateDisplay();this.domElement.appendChild(this.__input)};e.superclass=a;c.extend(e.prototype,a.prototype,{updateDisplay:function(){var a=this.__input,b;if(this.__truncationSuspended)b=
this.getValue();else{b=this.getValue();var c=Math.pow(10,this.__precision);b=Math.round(b*c)/c}a.value=b;return e.superclass.prototype.updateDisplay.call(this)}});return e}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common);
dat.controllers.NumberControllerSlider=function(a,b,c,e,d){function g(a,b,c,d,e){return d+(a-b)/(c-b)*(e-d)}var f=function(a,c,d,e,q){function h(a){a.preventDefault();var c=b.getOffset(l.__background),d=b.getWidth(l.__background);l.setValue(g(a.clientX,c.left,c.left+d,l.__min,l.__max));return!1}function k(){b.unbind(window,"mousemove",h);b.unbind(window,"mouseup",k);l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}f.superclass.call(this,a,c,{min:d,max:e,step:q});var l=this;this.__background=
document.createElement("div");this.__foreground=document.createElement("div");b.bind(this.__background,"mousedown",function(a){b.bind(window,"mousemove",h);b.bind(window,"mouseup",k);h(a)});b.addClass(this.__background,"slider");b.addClass(this.__foreground,"slider-fg");this.updateDisplay();this.__background.appendChild(this.__foreground);this.domElement.appendChild(this.__background)};f.superclass=a;f.useDefaultStyles=function(){c.inject(d)};e.extend(f.prototype,a.prototype,{updateDisplay:function(){var a=
(this.getValue()-this.__min)/(this.__max-this.__min);this.__foreground.style.width=100*a+"%";return f.superclass.prototype.updateDisplay.call(this)}});return f}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");
dat.controllers.FunctionController=function(a,b,c){var e=function(a,c,f){e.superclass.call(this,a,c);var d=this;this.__button=document.createElement("div");this.__button.innerHTML=void 0===f?"Fire":f;b.bind(this.__button,"click",function(a){a.preventDefault();d.fire();return!1});b.addClass(this.__button,"button");this.domElement.appendChild(this.__button)};e.superclass=a;c.extend(e.prototype,a.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this);this.__onFinishChange&&this.__onFinishChange.call(this,
this.getValue());this.getValue().call(this.object)}});return e}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.BooleanController=function(a,b,c){var e=function(a,c){e.superclass.call(this,a,c);var d=this;this.__prev=this.getValue();this.__checkbox=document.createElement("input");this.__checkbox.setAttribute("type","checkbox");b.bind(this.__checkbox,"change",function(){d.setValue(!d.__prev)},!1);this.domElement.appendChild(this.__checkbox);this.updateDisplay()};e.superclass=a;c.extend(e.prototype,a.prototype,{setValue:function(a){a=e.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&
this.__onFinishChange.call(this,this.getValue());this.__prev=this.getValue();return a},updateDisplay:function(){!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1;return e.superclass.prototype.updateDisplay.call(this)}});return e}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.color.toString=function(a){return function(b){if(1==b.a||a.isUndefined(b.a)){for(b=b.hex.toString(16);6>b.length;)b="0"+b;return"#"+b}return"rgba("+Math.round(b.r)+","+Math.round(b.g)+","+Math.round(b.b)+","+b.a+")"}}(dat.utils.common);
dat.color.interpret=function(a,b){var c,e,d=[{litmus:b.isString,conversions:{THREE_CHAR_HEX:{read:function(a){a=a.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString()+a[1].toString()+a[2].toString()+a[2].toString()+a[3].toString()+a[3].toString())}},write:a},SIX_CHAR_HEX:{read:function(a){a=a.match(/^#([A-F0-9]{6})$/i);return null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString())}},write:a},CSS_RGB:{read:function(a){a=a.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);
return null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3])}},write:a},CSS_RGBA:{read:function(a){a=a.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3]),a:parseFloat(a[4])}},write:a}}},{litmus:b.isNumber,conversions:{HEX:{read:function(a){return{space:"HEX",hex:a,conversionName:"HEX"}},write:function(a){return a.hex}}}},{litmus:b.isArray,conversions:{RGB_ARRAY:{read:function(a){return 3!=
a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2]}},write:function(a){return[a.r,a.g,a.b]}},RGBA_ARRAY:{read:function(a){return 4!=a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2],a:a[3]}},write:function(a){return[a.r,a.g,a.b,a.a]}}}},{litmus:b.isObject,conversions:{RGBA_OBJ:{read:function(a){return b.isNumber(a.r)&&b.isNumber(a.g)&&b.isNumber(a.b)&&b.isNumber(a.a)?{space:"RGB",r:a.r,g:a.g,b:a.b,a:a.a}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b,a:a.a}}},RGB_OBJ:{read:function(a){return b.isNumber(a.r)&&
b.isNumber(a.g)&&b.isNumber(a.b)?{space:"RGB",r:a.r,g:a.g,b:a.b}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b}}},HSVA_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)&&b.isNumber(a.a)?{space:"HSV",h:a.h,s:a.s,v:a.v,a:a.a}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v,a:a.a}}},HSV_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)?{space:"HSV",h:a.h,s:a.s,v:a.v}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v}}}}}];return function(){e=!1;
var a=1<arguments.length?b.toArray(arguments):arguments[0];b.each(d,function(d){if(d.litmus(a))return b.each(d.conversions,function(d,f){c=d.read(a);if(!1===e&&!1!==c)return e=c,c.conversionName=f,c.conversion=d,b.BREAK}),b.BREAK});return e}}(dat.color.toString,dat.utils.common);
dat.GUI=dat.gui.GUI=function(a,b,c,e,d,g,f,h,k,l,n,q,m,p,r){function u(a,b,c,f){if(void 0===b[c])throw Error("Object "+b+' has no property "'+c+'"');f.color?b=new n(b,c):(b=[b,c].concat(f.factoryArgs),b=e.apply(a,b));f.before instanceof d&&(f.before=f.before.__li);x(a,b);p.addClass(b.domElement,"c");c=document.createElement("span");p.addClass(c,"property-name");c.innerHTML=b.property;var g=document.createElement("div");g.appendChild(c);g.appendChild(b.domElement);f=t(a,g,f.before);p.addClass(f,J.CLASS_CONTROLLER_ROW);
p.addClass(f,typeof b.getValue());v(a,f,b);a.__controllers.push(b);return b}function t(a,b,c){var d=document.createElement("li");b&&d.appendChild(b);c?a.__ul.insertBefore(d,params.before):a.__ul.appendChild(d);a.onResize();return d}function v(a,b,c){c.__li=b;c.__gui=a;r.extend(c,{options:function(b){if(1<arguments.length)return c.remove(),u(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[r.toArray(arguments)]});if(r.isArray(b)||r.isObject(b))return c.remove(),u(a,c.object,c.property,
{before:c.__li.nextElementSibling,factoryArgs:[b]})},name:function(a){c.__li.firstElementChild.firstElementChild.innerHTML=a;return c},listen:function(){c.__gui.listen(c);return c},remove:function(){c.__gui.remove(c);return c}});if(c instanceof k){var d=new h(c.object,c.property,{min:c.__min,max:c.__max,step:c.__step});r.each(["updateDisplay","onChange","onFinishChange"],function(a){var b=c[a],e=d[a];c[a]=d[a]=function(){var a=Array.prototype.slice.call(arguments);b.apply(c,a);return e.apply(d,a)}});
p.addClass(b,"has-slider");c.domElement.insertBefore(d.domElement,c.domElement.firstElementChild)}else if(c instanceof h){var e=function(b){return r.isNumber(c.__min)&&r.isNumber(c.__max)?(c.remove(),u(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[c.__min,c.__max,c.__step]})):b};c.min=r.compose(e,c.min);c.max=r.compose(e,c.max)}else c instanceof g?(p.bind(b,"click",function(){p.fakeEvent(c.__checkbox,"click")}),p.bind(c.__checkbox,"click",function(a){a.stopPropagation()})):
c instanceof f?(p.bind(b,"click",function(){p.fakeEvent(c.__button,"click")}),p.bind(b,"mouseover",function(){p.addClass(c.__button,"hover")}),p.bind(b,"mouseout",function(){p.removeClass(c.__button,"hover")})):c instanceof n&&(p.addClass(b,"color"),c.updateDisplay=r.compose(function(a){b.style.borderLeftColor=c.__color.toString();return a},c.updateDisplay),c.updateDisplay());c.setValue=r.compose(function(b){a.getRoot().__preset_select&&c.isModified()&&F(a.getRoot(),!0);return b},c.setValue)}function x(a,
b){var c=a.getRoot(),d=c.__rememberedObjects.indexOf(b.object);if(-1!=d){var e=c.__rememberedObjectIndecesToControllers[d];void 0===e&&(e={},c.__rememberedObjectIndecesToControllers[d]=e);e[b.property]=b;if(c.load&&c.load.remembered){c=c.load.remembered;if(c[a.preset])c=c[a.preset];else if(c.Default)c=c.Default;else return;c[d]&&void 0!==c[d][b.property]&&(d=c[d][b.property],b.initialValue=d,b.setValue(d))}}}function A(a){var b=a.__save_row=document.createElement("li");p.addClass(a.domElement,"has-save");
a.__ul.insertBefore(b,a.__ul.firstChild);p.addClass(b,"save-row");var c=document.createElement("span");c.innerHTML="&nbsp;";p.addClass(c,"button gears");var d=document.createElement("span");d.innerHTML="Save";p.addClass(d,"button");p.addClass(d,"save");var e=document.createElement("span");e.innerHTML="New";p.addClass(e,"button");p.addClass(e,"save-as");var f=document.createElement("span");f.innerHTML="Revert";p.addClass(f,"button");p.addClass(f,"revert");var g=a.__preset_select=document.createElement("select");
a.load&&a.load.remembered?r.each(a.load.remembered,function(b,c){z(a,c,c==a.preset)}):z(a,"Default",!1);p.bind(g,"change",function(){for(var b=0;b<a.__preset_select.length;b++)a.__preset_select[b].innerHTML=a.__preset_select[b].value;a.preset=this.value});b.appendChild(g);b.appendChild(c);b.appendChild(d);b.appendChild(e);b.appendChild(f);if(C){var h=function(){m.style.display=a.useLocalStorage?"block":"none"},b=document.getElementById("dg-save-locally"),m=document.getElementById("dg-local-explain");
b.style.display="block";b=document.getElementById("dg-local-storage");"true"===localStorage.getItem(document.location.href+".isLocal")&&b.setAttribute("checked","checked");h();p.bind(b,"change",function(){a.useLocalStorage=!a.useLocalStorage;h()})}var k=document.getElementById("dg-new-constructor");p.bind(k,"keydown",function(a){!a.metaKey||67!==a.which&&67!=a.keyCode||L.hide()});p.bind(c,"click",function(){k.innerHTML=JSON.stringify(a.getSaveObject(),void 0,2);L.show();k.focus();k.select()});p.bind(d,
"click",function(){a.save()});p.bind(e,"click",function(){var b=prompt("Enter a new preset name.");b&&a.saveAs(b)});p.bind(f,"click",function(){a.revert()})}function w(a){function b(b){b.preventDefault();e=b.clientX;p.addClass(a.__closeButton,J.CLASS_DRAG);p.bind(window,"mousemove",c);p.bind(window,"mouseup",d);return!1}function c(b){b.preventDefault();a.width+=e-b.clientX;a.onResize();e=b.clientX;return!1}function d(){p.removeClass(a.__closeButton,J.CLASS_DRAG);p.unbind(window,"mousemove",c);p.unbind(window,
"mouseup",d)}a.__resize_handle=document.createElement("div");r.extend(a.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var e;p.bind(a.__resize_handle,"mousedown",b);p.bind(a.__closeButton,"mousedown",b);a.domElement.insertBefore(a.__resize_handle,a.domElement.firstElementChild)}function D(a,b){a.domElement.style.width=b+"px";a.__save_row&&a.autoPlace&&(a.__save_row.style.width=b+"px");a.__closeButton&&(a.__closeButton.style.width=b+"px")}
function B(a,b){var c={};r.each(a.__rememberedObjects,function(d,e){var f={};r.each(a.__rememberedObjectIndecesToControllers[e],function(a,c){f[c]=b?a.initialValue:a.getValue()});c[e]=f});return c}function z(a,b,c){var d=document.createElement("option");d.innerHTML=b;d.value=b;a.__preset_select.appendChild(d);c&&(a.__preset_select.selectedIndex=a.__preset_select.length-1)}function F(a,b){var c=a.__preset_select[a.__preset_select.selectedIndex];c.innerHTML=b?c.value+"*":c.value}function G(a){0!=a.length&&
q(function(){G(a)});r.each(a,function(a){a.updateDisplay()})}a.inject(c);var C;try{C="localStorage"in window&&null!==window.localStorage}catch(N){C=!1}var L,K=!0,H,M=!1,E=[],J=function(a){function b(){localStorage.setItem(document.location.href+".gui",JSON.stringify(d.getSaveObject()))}function c(){var a=d.getRoot();a.width+=1;r.defer(function(){--a.width})}var d=this;this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);p.addClass(this.domElement,
"dg");this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];a=a||{};a=r.defaults(a,{autoPlace:!0,width:J.DEFAULT_WIDTH});a=r.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace});r.isUndefined(a.load)?a.load={preset:"Default"}:a.preset&&(a.load.preset=a.preset);r.isUndefined(a.parent)&&a.hideable&&E.push(this);a.resizable=r.isUndefined(a.parent)&&a.resizable;a.autoPlace&&r.isUndefined(a.scrollable)&&(a.scrollable=
!0);var e=C&&"true"===localStorage.getItem(document.location.href+".isLocal");Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},preset:{get:function(){return d.parent?d.getRoot().preset:a.load.preset},set:function(b){d.parent?d.getRoot().preset=b:a.load.preset=b;for(b=0;b<this.__preset_select.length;b++)this.__preset_select[b].value==this.preset&&(this.__preset_select.selectedIndex=
b);d.revert()}},width:{get:function(){return a.width},set:function(b){a.width=b;D(d,b)}},name:{get:function(){return a.name},set:function(b){a.name=b;g&&(g.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(b){a.closed=b;a.closed?p.addClass(d.__ul,J.CLASS_CLOSED):p.removeClass(d.__ul,J.CLASS_CLOSED);this.onResize();d.__closeButton&&(d.__closeButton.innerHTML=b?J.TEXT_OPEN:J.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return e},set:function(a){C&&
((e=a)?p.bind(window,"unload",b):p.unbind(window,"unload",b),localStorage.setItem(document.location.href+".isLocal",a))}}});if(r.isUndefined(a.parent)){a.closed=!1;p.addClass(this.domElement,J.CLASS_MAIN);p.makeSelectable(this.domElement,!1);if(C&&e){d.useLocalStorage=!0;var f=localStorage.getItem(document.location.href+".gui");f&&(a.load=JSON.parse(f))}this.__closeButton=document.createElement("div");this.__closeButton.innerHTML=J.TEXT_CLOSED;p.addClass(this.__closeButton,J.CLASS_CLOSE_BUTTON);this.domElement.appendChild(this.__closeButton);
p.bind(this.__closeButton,"click",function(){d.closed=!d.closed})}else{void 0===a.closed&&(a.closed=!0);var g=document.createTextNode(a.name);p.addClass(g,"controller-name");f=t(d,g);p.addClass(this.__ul,J.CLASS_CLOSED);p.addClass(f,"title");p.bind(f,"click",function(a){a.preventDefault();d.closed=!d.closed;return!1});a.closed||(this.closed=!1)}a.autoPlace&&(r.isUndefined(a.parent)&&(K&&(H=document.createElement("div"),p.addClass(H,"dg"),p.addClass(H,J.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(H),
K=!1),H.appendChild(this.domElement),p.addClass(this.domElement,J.CLASS_AUTO_PLACE)),this.parent||D(d,a.width));p.bind(window,"resize",function(){d.onResize()});p.bind(this.__ul,"webkitTransitionEnd",function(){d.onResize()});p.bind(this.__ul,"transitionend",function(){d.onResize()});p.bind(this.__ul,"oTransitionEnd",function(){d.onResize()});this.onResize();a.resizable&&w(this);d.getRoot();a.parent||c()};J.toggleHide=function(){M=!M;r.each(E,function(a){a.domElement.style.zIndex=M?-999:999;a.domElement.style.opacity=
M?0:1})};J.CLASS_AUTO_PLACE="a";J.CLASS_AUTO_PLACE_CONTAINER="ac";J.CLASS_MAIN="main";J.CLASS_CONTROLLER_ROW="cr";J.CLASS_TOO_TALL="taller-than-window";J.CLASS_CLOSED="closed";J.CLASS_CLOSE_BUTTON="close-button";J.CLASS_DRAG="drag";J.DEFAULT_WIDTH=245;J.TEXT_CLOSED="Close Controls";J.TEXT_OPEN="Open Controls";p.bind(window,"keydown",function(a){"text"===document.activeElement.type||72!==a.which&&72!=a.keyCode||J.toggleHide()},!1);r.extend(J.prototype,{add:function(a,b){return u(this,a,b,{factoryArgs:Array.prototype.slice.call(arguments,
2)})},addColor:function(a,b){return u(this,a,b,{color:!0})},remove:function(a){this.__ul.removeChild(a.__li);this.__controllers.slice(this.__controllers.indexOf(a),1);var b=this;r.defer(function(){b.onResize()})},destroy:function(){this.autoPlace&&H.removeChild(this.domElement)},addFolder:function(a){if(void 0!==this.__folders[a])throw Error('You already have a folder in this GUI by the name "'+a+'"');var b={name:a,parent:this};b.autoPlace=this.autoPlace;this.load&&this.load.folders&&this.load.folders[a]&&
(b.closed=this.load.folders[a].closed,b.load=this.load.folders[a]);b=new J(b);this.__folders[a]=b;a=t(this,b.domElement);p.addClass(a,"folder");return b},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var a=this.getRoot();if(a.scrollable){var b=p.getOffset(a.__ul).top,c=0;r.each(a.__ul.childNodes,function(b){a.autoPlace&&b===a.__save_row||(c+=p.getHeight(b))});window.innerHeight-b-20<c?(p.addClass(a.domElement,J.CLASS_TOO_TALL),a.__ul.style.height=window.innerHeight-
b-20+"px"):(p.removeClass(a.domElement,J.CLASS_TOO_TALL),a.__ul.style.height="auto")}a.__resize_handle&&r.defer(function(){a.__resize_handle.style.height=a.__ul.offsetHeight+"px"});a.__closeButton&&(a.__closeButton.style.width=a.width+"px")},remember:function(){r.isUndefined(L)&&(L=new m,L.domElement.innerHTML=b);if(this.parent)throw Error("You can only call remember on a top level GUI.");var a=this;r.each(Array.prototype.slice.call(arguments),function(b){0==a.__rememberedObjects.length&&A(a);-1==
a.__rememberedObjects.indexOf(b)&&a.__rememberedObjects.push(b)});this.autoPlace&&D(this,this.width)},getRoot:function(){for(var a=this;a.parent;)a=a.parent;return a},getSaveObject:function(){var a=this.load;a.closed=this.closed;0<this.__rememberedObjects.length&&(a.preset=this.preset,a.remembered||(a.remembered={}),a.remembered[this.preset]=B(this));a.folders={};r.each(this.__folders,function(b,c){a.folders[c]=b.getSaveObject()});return a},save:function(){this.load.remembered||(this.load.remembered=
{});this.load.remembered[this.preset]=B(this);F(this,!1)},saveAs:function(a){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=B(this,!0));this.load.remembered[a]=B(this);this.preset=a;z(this,a,!0)},revert:function(a){r.each(this.__controllers,function(b){this.getRoot().load.remembered?x(a||this.getRoot(),b):b.setValue(b.initialValue)},this);r.each(this.__folders,function(a){a.revert(a)});a||F(this.getRoot(),!1)},listen:function(a){var b=0==this.__listening.length;this.__listening.push(a);
b&&G(this.__listening)}});return J}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',
".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",
dat.controllers.factory=function(a,b,c,e,d,g,f){return function(h,k,l,n){var q=h[k];if(f.isArray(l)||f.isObject(l))return new a(h,k,l);if(f.isNumber(q))return f.isNumber(l)&&f.isNumber(n)?new c(h,k,l,n):new b(h,k,{min:l,max:n});if(f.isString(q))return new e(h,k);if(f.isFunction(q))return new d(h,k,"");if(f.isBoolean(q))return new g(h,k)}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(a,b,c){var e=
function(a,c){function d(){g.setValue(g.__input.value)}e.superclass.call(this,a,c);var g=this;this.__input=document.createElement("input");this.__input.setAttribute("type","text");b.bind(this.__input,"keyup",d);b.bind(this.__input,"change",d);b.bind(this.__input,"blur",function(){g.__onFinishChange&&g.__onFinishChange.call(g,g.getValue())});b.bind(this.__input,"keydown",function(a){13===a.keyCode&&this.blur()});this.updateDisplay();this.domElement.appendChild(this.__input)};e.superclass=a;c.extend(e.prototype,
a.prototype,{updateDisplay:function(){b.isActive(this.__input)||(this.__input.value=this.getValue());return e.superclass.prototype.updateDisplay.call(this)}});return e}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,
dat.controllers.ColorController=function(a,b,c,e,d){function g(a,b,c,e){a.style.background="";d.each(k,function(d){a.style.cssText+="background: "+d+"linear-gradient("+b+", "+c+" 0%, "+e+" 100%); "})}function f(a){a.style.background="";a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";
a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var h=function(a,k){function l(a){u(a);b.bind(window,"mousemove",u);b.bind(window,
"mouseup",m)}function m(){b.unbind(window,"mousemove",u);b.unbind(window,"mouseup",m)}function p(){var a=e(this.value);!1!==a?(v.__color.__state=a,v.setValue(v.__color.toOriginal())):this.value=v.__color.toString()}function n(){b.unbind(window,"mousemove",t);b.unbind(window,"mouseup",n)}function u(a){a.preventDefault();var c=b.getWidth(v.__saturation_field),d=b.getOffset(v.__saturation_field),e=(a.clientX-d.left+document.body.scrollLeft)/c;a=1-(a.clientY-d.top+document.body.scrollTop)/c;1<a?a=1:0>
a&&(a=0);1<e?e=1:0>e&&(e=0);v.__color.v=a;v.__color.s=e;v.setValue(v.__color.toOriginal());return!1}function t(a){a.preventDefault();var c=b.getHeight(v.__hue_field),d=b.getOffset(v.__hue_field);a=1-(a.clientY-d.top+document.body.scrollTop)/c;1<a?a=1:0>a&&(a=0);v.__color.h=360*a;v.setValue(v.__color.toOriginal());return!1}h.superclass.call(this,a,k);this.__color=new c(this.getValue());this.__temp=new c(0);var v=this;this.domElement=document.createElement("div");b.makeSelectable(this.domElement,!1);
this.__selector=document.createElement("div");this.__selector.className="selector";this.__saturation_field=document.createElement("div");this.__saturation_field.className="saturation-field";this.__field_knob=document.createElement("div");this.__field_knob.className="field-knob";this.__field_knob_border="2px solid ";this.__hue_knob=document.createElement("div");this.__hue_knob.className="hue-knob";this.__hue_field=document.createElement("div");this.__hue_field.className="hue-field";this.__input=document.createElement("input");
this.__input.type="text";this.__input_textShadow="0 1px 1px ";b.bind(this.__input,"keydown",function(a){13===a.keyCode&&p.call(this)});b.bind(this.__input,"blur",p);b.bind(this.__selector,"mousedown",function(a){b.addClass(this,"drag").bind(window,"mouseup",function(a){b.removeClass(v.__selector,"drag")})});var x=document.createElement("div");d.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});d.extend(this.__field_knob.style,
{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(.5>this.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});d.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});d.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});d.extend(x.style,{width:"100%",height:"100%",
background:"none"});g(x,"top","rgba(0,0,0,0)","#000");d.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"});f(this.__hue_field);d.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"});b.bind(this.__saturation_field,"mousedown",l);b.bind(this.__field_knob,"mousedown",l);b.bind(this.__hue_field,"mousedown",function(a){t(a);b.bind(window,
"mousemove",t);b.bind(window,"mouseup",n)});this.__saturation_field.appendChild(x);this.__selector.appendChild(this.__field_knob);this.__selector.appendChild(this.__saturation_field);this.__selector.appendChild(this.__hue_field);this.__hue_field.appendChild(this.__hue_knob);this.domElement.appendChild(this.__input);this.domElement.appendChild(this.__selector);this.updateDisplay()};h.superclass=a;d.extend(h.prototype,a.prototype,{updateDisplay:function(){var a=e(this.getValue());if(!1!==a){var b=!1;
d.each(c.COMPONENTS,function(c){if(!d.isUndefined(a[c])&&!d.isUndefined(this.__color.__state[c])&&a[c]!==this.__color.__state[c])return b=!0,{}},this);b&&d.extend(this.__color.__state,a)}d.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var f=.5>this.__color.v||.5<this.__color.s?255:0,h=255-f;d.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+f+
","+f+","+f+")"});this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px";this.__temp.s=1;this.__temp.v=1;g(this.__saturation_field,"left","#fff",this.__temp.toString());d.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+f+","+f+","+f+")",textShadow:this.__input_textShadow+"rgba("+h+","+h+","+h+",.7)"})}});var k=["-moz-","-o-","-webkit-","-ms-",""];return h}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(a,b,c,e){function d(a,
b,c){Object.defineProperty(a,b,{get:function(){if("RGB"===this.__state.space)return this.__state[b];f(this,b,c);return this.__state[b]},set:function(a){"RGB"!==this.__state.space&&(f(this,b,c),this.__state.space="RGB");this.__state[b]=a}})}function g(a,b){Object.defineProperty(a,b,{get:function(){if("HSV"===this.__state.space)return this.__state[b];h(this);return this.__state[b]},set:function(a){"HSV"!==this.__state.space&&(h(this),this.__state.space="HSV");this.__state[b]=a}})}function f(a,c,d){if("HEX"===
a.__state.space)a.__state[c]=b.component_from_hex(a.__state.hex,d);else if("HSV"===a.__state.space)e.extend(a.__state,b.hsv_to_rgb(a.__state.h,a.__state.s,a.__state.v));else throw"Corrupted color state";}function h(a){var c=b.rgb_to_hsv(a.r,a.g,a.b);e.extend(a.__state,{s:c.s,v:c.v});e.isNaN(c.h)?e.isUndefined(a.__state.h)&&(a.__state.h=0):a.__state.h=c.h}var k=function(){this.__state=a.apply(this,arguments);if(!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||
1};k.COMPONENTS="r g b h s v hex a".split(" ");e.extend(k.prototype,{toString:function(){return c(this)},toOriginal:function(){return this.__state.conversion.write(this)}});d(k.prototype,"r",2);d(k.prototype,"g",1);d(k.prototype,"b",0);g(k.prototype,"h");g(k.prototype,"s");g(k.prototype,"v");Object.defineProperty(k.prototype,"a",{get:function(){return this.__state.a},set:function(a){this.__state.a=a}});Object.defineProperty(k.prototype,"hex",{get:function(){this.__state.hex=b.rgb_to_hex(this.r,this.g,
this.b);return this.__state.hex},set:function(a){this.__state.space="HEX";this.__state.hex=a}});return k}(dat.color.interpret,dat.color.math=function(){var a;return{hsv_to_rgb:function(a,c,e){var b=a/60-Math.floor(a/60),g=e*(1-c),f=e*(1-b*c);c=e*(1-(1-b)*c);a=[[e,c,g],[f,e,g],[g,e,c],[g,f,e],[c,g,e],[e,g,f]][Math.floor(a/60)%6];return{r:255*a[0],g:255*a[1],b:255*a[2]}},rgb_to_hsv:function(a,c,e){var b=Math.max(a,c,e),g=b-Math.min(a,c,e);if(0==b)return{h:NaN,s:0,v:0};a=(a==b?(c-e)/g:c==b?2+(e-a)/g:
4+(a-c)/g)/6;0>a&&(a+=1);return{h:360*a,s:g/b,v:b/255}},rgb_to_hex:function(a,c,e){a=this.hex_with_component(0,2,a);a=this.hex_with_component(a,1,c);return a=this.hex_with_component(a,0,e)},component_from_hex:function(a,c){return a>>8*c&255},hex_with_component:function(b,c,e){return e<<(a=8*c)|b&~(255<<a)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1E3/60)}}(),dat.dom.CenteredDiv=function(a,b){var c=function(){this.backgroundElement=document.createElement("div");b.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"});a.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=document.createElement("div");
b.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var c=this;a.bind(this.backgroundElement,"click",function(){c.hide()})};c.prototype.show=function(){var a=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=0;this.domElement.style.webkitTransform=
"scale(1.1)";this.layout();b.defer(function(){a.backgroundElement.style.opacity=1;a.domElement.style.opacity=1;a.domElement.style.webkitTransform="scale(1)"})};c.prototype.hide=function(){var b=this,c=function(){b.domElement.style.display="none";b.backgroundElement.style.display="none";a.unbind(b.domElement,"webkitTransitionEnd",c);a.unbind(b.domElement,"transitionend",c);a.unbind(b.domElement,"oTransitionEnd",c)};a.bind(this.domElement,"webkitTransitionEnd",c);a.bind(this.domElement,"transitionend",
c);a.bind(this.domElement,"oTransitionEnd",c);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};c.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-a.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-a.getHeight(this.domElement)/2+"px"};return c}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);
(function(){function a(){}function b(){}function c(){this.skinIndices=[];this.skinWeights=[];this.matrices=[]}function e(){this.hierarchy=[]}function d(){this.id=this.name=this.node=null;this.vertices=[];this.indices=[];this.normals=[];this.uvs=[];this.bones=[];this.skins=null}function g(){this.index=this.node=this.ref=this.map=this.uv=null}function f(){this.index=this.node=this.ref=this.map=this.normal=null}function h(){this.attrData=this.attrFlag=this.values=this.times=this.internalId=this.id=this.version=
null}function k(){this.attr=this.id=null;this.attrZ=this.attrY=this.attrX=!1;this.curveIdx=this.containerBoneId=this.containerInternalId=this.internalId=null;this.curves=[]}function l(){this.curves={};this.length=0;this.fps=30;this.frames=0}function n(){this.textures=[];this.perGeoMap={}}function q(){this.name=this.fileName="";this.id=null;this.parentIds=[]}THREE.FBXLoader=function(a,b){THREE.Loader.call(this,a);this.manager=void 0!==b?b:THREE.DefaultLoadingManager;this.textureBasePath=this.textureLoader=
null};THREE.FBXLoader.prototype=Object.create(THREE.Loader.prototype);THREE.FBXLoader.prototype.constructor=THREE.FBXLoader;THREE.FBXLoader.prototype.load=function(a,b,c,d){var e=this;(new THREE.XHRLoader(e.manager)).load(a,function(c){e.isFbxFormatASCII(c)?e.isFbxVersionSupported(c)?(e.textureBasePath=e.extractUrlBase(a),b(e.parse(c))):console.warn("FBXLoader: !!! FBX Version below 7 not supported !!!"):console.warn("FBXLoader: !!! FBX Binary format not supported !!!")},c,d)};THREE.FBXLoader.prototype.setCrossOrigin=
function(a){this.crossOrigin=a};THREE.FBXLoader.prototype.isFbxFormatASCII=function(a){CORRECT="Kaydara\\FBX\\Binary\\\\".split("");for(var b=0,c=0;c<CORRECT.length;++c){var d=a[0];a=a.slice(b+1);b++;num=d;if(num==CORRECT[c])return!1}return!0};THREE.FBXLoader.prototype.isFbxVersionSupported=function(a){return(match=a.match(/FBXVersion: (\d+)/))?(a=parseInt(match[1]),console.log("FBXLoader: FBX version "+a),7E3<=a):!1};THREE.FBXLoader.prototype.parse=function(a){console.time("FBXLoader");console.time("FBXLoader: TextParser");
a=(new b).parse(a);console.timeEnd("FBXLoader: TextParser");console.time("FBXLoader: ObjectParser");this.hierarchy=(new e).parseHierarchy(a);this.weights=(new c).parse(a,this.hierarchy);this.animations=(new l).parse(a,this.hierarchy);this.textures=(new n).parse(a,this.hierarchy);console.timeEnd("FBXLoader: ObjectParser");console.time("FBXLoader: GeometryParser");geometries=this.parseGeometries(a);console.timeEnd("FBXLoader: GeometryParser");a=new THREE.Group;for(var d=0;d<geometries.length;++d)void 0!==
geometries[d]&&a.add(geometries[d]);console.timeEnd("FBXLoader");return a};THREE.FBXLoader.prototype.parseGeometries=function(a){if(!("Geometry"in a.Objects.subNodes))return[];var b=0,c;for(c in a.Objects.subNodes.Geometry)c.match(/^\d+$/)&&b++;var d=[];if(0<b)for(c in a.Objects.subNodes.Geometry)"Mesh"===a.Objects.subNodes.Geometry[c].attrType&&d.push(this.parseGeometry(a.Objects.subNodes.Geometry[c],a));else d.push(this.parseGeometry(a.Objects.subNodes.Geometry,a));return d};THREE.FBXLoader.prototype.parseGeometry=
function(a,b){geo=(new d).parse(a);geo.addBones(this.hierarchy.hierarchy);var c=new THREE.BufferGeometry;c.name=geo.name;c.addAttribute("position",new THREE.BufferAttribute(new Float32Array(geo.vertices),3));void 0!==geo.normals&&0<geo.normals.length&&c.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(geo.normals),3));void 0!==geo.uvs&&0<geo.uvs.length&&c.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(geo.uvs),2));void 0!==geo.indices&&65535<geo.indices.length?c.setIndex(new THREE.BufferAttribute(new Uint32Array(geo.indices),
1)):void 0!==geo.indices&&c.setIndex(new THREE.BufferAttribute(new Uint16Array(geo.indices),1));c.verticesNeedUpdate=!0;c.computeBoundingSphere();c.computeBoundingBox();var e,f=this.textures.getById(b.searchConnectionParent(geo.id));void 0!==f&&0<f.length&&(null===this.textureLoader&&(this.textureLoader=new THREE.TextureLoader),e=this.textureLoader.load(this.textureBasePath+"/"+f[0].fileName));e=void 0!==e?new THREE.MeshBasicMaterial({map:e}):new THREE.MeshBasicMaterial({color:3342591});c=(new THREE.Geometry).fromBufferGeometry(c);
c.bones=geo.bones;c.skinIndices=this.weights.skinIndices;c.skinWeights=this.weights.skinWeights;if(void 0===geo.bones||void 0===geo.skins||void 0===this.animations||0===this.animations.length){var c=new THREE.Mesh(c,e),f=b.Connections.properties.connections,g=b.Objects.subNodes.Model;for(e=0;e<f.length;e++)if(f[e][0]===a.id){c.name=g[f[e][1]].attrName;if(g[f[e][1]].properties.Lcl_Translation){f=g[f[e][1]].properties.Lcl_Translation.value.split(",");for(e=0;e<f.length;e++)f[e]=parseFloat(f[e]);c.position.x=
f[0];c.position.y=f[1];c.position.z=f[2]}break}}else e.skinning=!0,c=new THREE.SkinnedMesh(c,e),this.addAnimation(c,this.weights.matrices,this.animations);return c};THREE.FBXLoader.prototype.addAnimation=function(a,b,c){b={name:"animationtest",fps:30,length:c.length,hierarchy:[]};for(var d=0;d<a.geometry.bones.length;++d){var e=a.geometry.bones[d].name,e=e.replace(/.*:/,"");b.hierarchy.push({parent:a.geometry.bones[d].parent,name:e,keys:[]})}var f=function(a,b){if(void 0===a)return!1;var c;switch(b){case "S":if(void 0===
a.S)return!1;c=a.S;break;case "R":if(void 0===a.R)return!1;c=a.R;break;case "T":if(void 0===a.T)return!1;c=a.T}return void 0===c.curves.x||void 0===c.curves.y||void 0===c.curves.z?!1:!0},g=function(a,b){var c=void 0!==a.curves.y.values[b],d=void 0!==a.curves.z.values[b];return void 0!==a.curves.x.values[b]&&c&&d},e=function(a,b){var d={};d.time=frame/c.fps;d.pos=b.pos;d.rot=b.rotq;d.scl=b.scl;if(void 0===a)return d;try{if(f(a,"T")&&g(a.T,frame)){var e=new THREE.Vector3(a.T.curves.x.values[frame],
a.T.curves.y.values[frame],a.T.curves.z.values[frame]);d.pos=[e.x,e.y,e.z]}else delete d.pos;if(f(a,"R")&&g(a.R,frame)){var h=degToRad(a.R.curves.x.values[frame]),m=degToRad(a.R.curves.y.values[frame]),k=degToRad(a.R.curves.z.values[frame]),l=new THREE.Vector3(h,m,k),p=quatFromVec(l.x,l.y,l.z);d.rot=[p.x,p.y,p.z,p.w]}else delete d.rot;if(f(a,"S")&&g(a.S,frame)){var n=new THREE.Vector3(a.S.curves.x.values[frame],a.S.curves.y.values[frame],a.S.curves.z.values[frame]);d.scl=[n.x,n.y,n.z]}else delete d.scl}catch(N){console.log(b),
console.log(N)}return d},h=a.geometry.bones;for(frame=0;frame<c.frames;frame++)for(d=0;d<h.length;d++)for(var m=h[d],k=c.curves[d],l=0;l<b.hierarchy.length;l++)b.hierarchy[l].name===m.name&&b.hierarchy[l].keys.push(e(k,m));void 0===a.geometry.animations&&(a.geometry.animations=[]);a.geometry.animations.push(THREE.AnimationClip.parseAnimation(b,a.geometry.bones))};THREE.FBXLoader.prototype.parseMaterials=function(a){if(!("Material"in a.subNodes))return[];var b=0,c;for(c in a.subNodes.Materials)c.match(/^\d+$/)&&
b++;var d=[];if(0<b)for(c in a.subNodes.Material)d.push(parseMaterial(a.subNodes.Material[c]));else d.push(parseMaterial(a.subNodes.Material));return d};THREE.FBXLoader.prototype.parseMaterial=function(a){};THREE.FBXLoader.prototype.loadFile=function(a,b,c,d,e){var f=new THREE.XHRLoader(this.manager);f.setResponseType(e);return f.load(a,function(a){b(a)},c,d)};THREE.FBXLoader.prototype.loadFileAsBuffer=function(a,b,c,d){this.loadFile(a,onLoad,c,d,"arraybuffer")};THREE.FBXLoader.prototype.loadFileAsText=
function(a,b,c,d){this.loadFile(a,b,c,d,"text")};a.prototype.add=function(a,b){this[a]=b};a.prototype.searchConnectionParent=function(a){void 0===this.__cache_search_connection_parent&&(this.__cache_search_connection_parent=[]);if(void 0!==this.__cache_search_connection_parent[a])return this.__cache_search_connection_parent[a];this.__cache_search_connection_parent[a]=[];for(var b=this.Connections.properties.connections,c=[],d=0;d<b.length;++d)b[d][0]==a&&c.push(0===b[d][1]?-1:b[d][1]);if(0<c.length)return this.__cache_search_connection_parent[a]=
this.__cache_search_connection_parent[a].concat(c),c;this.__cache_search_connection_parent[a]=[-1];return[-1]};a.prototype.searchConnectionChildren=function(a){void 0===this.__cache_search_connection_children&&(this.__cache_search_connection_children=[]);if(void 0!==this.__cache_search_connection_children[a])return this.__cache_search_connection_children[a];this.__cache_search_connection_children[a]=[];for(var b=this.Connections.properties.connections,c=[],d=0;d<b.length;++d)b[d][1]==a&&c.push(0===
b[d][0]?-1:b[d][0]);if(0<c.length)return this.__cache_search_connection_children[a]=this.__cache_search_connection_children[a].concat(c),c;this.__cache_search_connection_children[a]=[-1];return[-1]};a.prototype.searchConnectionType=function(a,b){var c=a+","+b;void 0===this.__cache_search_connection_type&&(this.__cache_search_connection_type="");if(void 0!==this.__cache_search_connection_type[c])return this.__cache_search_connection_type[c];this.__cache_search_connection_type[c]="";for(var d=this.Connections.properties.connections,
e=0;e<d.length;++e)if(d[e][0]==a&&d[e][1]==b)return this.__cache_search_connection_type[c]=d[e][2],d[e][2];return this.__cache_search_connection_type[a]=null};b.prototype={getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(a){this.nodeStack.push(a);this.currentIndent+=1},popStack:function(){this.nodeStack.pop();--this.currentIndent},setCurrentProp:function(a,
b){this.currentProp=a;this.currentPropName=b},parse:function(b){this.currentIndent=0;this.allNodes=new a;this.nodeStack=[];this.currentProp=[];this.currentPropName="";b=b.split("\n");for(var c in b){var d=b[c];if(!d.match(/^[\s\t]*;/)&&!d.match(/^[\s\t]*$/))if(match=d.match(new RegExp("^\\t{"+this.currentIndent+"}(\\w+):(.*){",""))){var e=match[1].trim().replace(/^"/,"").replace(/"$/,""),f=match[2].split(",").map(function(a){return a.trim().replace(/^"/,"").replace(/"$/,"")});this.parseNodeBegin(d,
e,f||null)}else(match=d.match(new RegExp("^\\t{"+this.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)")))?(e=match[1].replace(/^"/,"").replace(/"$/,"").trim(),f=match[2].replace(/^"/,"").replace(/"$/,"").trim(),this.parseNodeProperty(d,e,f)):d.match(new RegExp("^\\t{"+(this.currentIndent-1)+"}}"))?this.nodeEnd():d.match(/^[^\s\t}]/)&&this.parseNodePropertyContinued(d)}return this.allNodes},parseNodeBegin:function(a,b,c){a={name:b,properties:{},subNodes:{}};var d=this.parseNodeAttr(c),e=this.getCurrentNode();
if(0===this.currentIndent)this.allNodes.add(b,a);else if(b in e.subNodes){var f=e.subNodes[b];this.isFlattenNode(e.subNodes[b])&&(""===d.id?(e.subNodes[b]=[],e.subNodes[b].push(f)):(e.subNodes[b]={},e.subNodes[b][f.id]=f));""===d.id?e.subNodes[b].push(a):e.subNodes[b][d.id]=a}else e.subNodes[b]=a;c&&(a.id=d.id,a.attrName=d.name,a.attrType=d.type);this.pushStack(a)},parseNodeAttr:function(a){var b=a[0];""!==a[0]&&(b=parseInt(a[0]),isNaN(b)&&(b=a[0]));var c,d;1<a.length&&(c=a[1].replace(/^(\w+)::/,
""),d=a[2]);return{id:b,name:c||"",type:d||""}},parseNodeProperty:function(a,b,c){var d=this.getCurrentNode(),e=d.name;if(void 0!==e&&e.match(/Properties(\d)+/))this.parseNodeSpecialProperty(a,b,c);else{if("C"==b){b=c.split(",").slice(1);a=parseInt(b[0]);var e=parseInt(b[1]),f=c.split(",").slice(3);b="connections";c=[a,e];c=c.concat(f);void 0===d.properties[b]&&(d.properties[b]=[])}"Node"==b&&(a=parseInt(c),d.properties.id=a,d.id=a);b in d.properties?Array.isArray(d.properties[b])?d.properties[b].push(c):
d.properties[b]+=c:Array.isArray(d.properties[b])?d.properties[b].push(c):d.properties[b]=c;this.setCurrentProp(d.properties,b)}},parseNodePropertyContinued:function(a){this.currentProp[this.currentPropName]+=a},parseNodeSpecialProperty:function(a,b,c){var d=c.split('",').map(function(a){return a.trim().replace(/^\"/,"").replace(/\s/,"_")});a=d[0];b=d[1];c=d[2];var e=d[3],d=d[4];switch(b){case "int":d=parseInt(d);break;case "double":d=parseFloat(d);break;case "ColorRGB":case "Vector3D":d=d.split(","),
d=new THREE.Vector3(d[0],d[1],d[2])}this.getPrevNode().properties[a]={type:b,type2:c,flag:e,value:d};this.setCurrentProp(this.getPrevNode().properties,a)},nodeEnd:function(a){this.popStack()},isFlattenNode:function(a){return"subNodes"in a&&"properties"in a?!0:!1}};c.prototype.parseCluster=function(a,b,c){a=a.searchConnectionParent(b);var d=toInt(c.subNodes.Indexes.properties.a.split(",")),e=toFloat(c.subNodes.Weights.properties.a.split(",")),f=toMat44(toFloat(c.subNodes.Transform.properties.a.split(","))),
g=toMat44(toFloat(c.subNodes.TransformLink.properties.a.split(",")));return{parent:a,id:parseInt(b),indices:d,weights:e,transform:f,transformlink:g,linkMode:c.properties.Mode}};c.prototype.parse=function(a,b){this.skinIndices=[];this.skinWeights=[];this.matrices=[];var c=a.Objects.subNodes.Deformer,d={},e;for(e in c)if("Cluster"===c[e].attrType&&"Indexes"in c[e].subNodes){var f=this.parseCluster(a,e,c[e]),g=a.searchConnectionChildren(f.id)[0];d[g]=f}c=[];e=b.hierarchy;for(f=0;f<e.length;++f)if(g=
e[f].internalId,void 0===d[g])this.matrices.push(new THREE.Matrix4);else{g=d[g];this.matrices.push(g.transform);for(var h=0;h<g.indices.length;++h){void 0===c[g.indices[h]]&&(c[g.indices[h]]={},c[g.indices[h]].joint=[],c[g.indices[h]].weight=[]);var m=a.searchConnectionChildren(g.id);1<m.length&&console.warn("FBXLoader: node "+g.id+" have many weight kids: "+m);c[g.indices[h]].joint.push(b.getBoneIdfromInternalId(a,m[0]));c[g.indices[h]].weight.push(g.weights[h])}}for(d=0;d<c.length;d++)e=new THREE.Vector4(c[d].joint[0]?
c[d].joint[0]:0,c[d].joint[1]?c[d].joint[1]:0,c[d].joint[2]?c[d].joint[2]:0,c[d].joint[3]?c[d].joint[3]:0),f=new THREE.Vector4(c[d].weight[0]?c[d].weight[0]:0,c[d].weight[1]?c[d].weight[1]:0,c[d].weight[2]?c[d].weight[2]:0,c[d].weight[3]?c[d].weight[3]:0),this.skinIndices.push(e),this.skinWeights.push(f);return this};e.prototype.parseHierarchy=function(a){var b=a.Objects.subNodes.Model,c=[],d;for(d in b)void 0!==b[d].attrType&&c.push(b[d]);this.hierarchy=[];for(b=0;b<c.length;++b){d=c[b];var e=a.searchConnectionParent(d.id)[0],
f=[0,0,0],g=[0,0,0,1],h=[1,1,1];"Lcl_Translation"in d.properties&&(f=toFloat(d.properties.Lcl_Translation.value.split(",")));if("Lcl_Rotation"in d.properties){var g=toRad(toFloat(d.properties.Lcl_Rotation.value.split(","))),m=new THREE.Quaternion;m.setFromEuler(new THREE.Euler(g[0],g[1],g[2],"ZYX"));g=[m.x,m.y,m.z,m.w]}"Lcl_Scaling"in d.properties&&(h=toFloat(d.properties.Lcl_Scaling.value.split(",")));m=d.attrName;m=m.replace(/:/,"");m=m.replace(/_/,"");m=m.replace(/-/,"");this.hierarchy.push({parent:e,
name:m,pos:f,rotq:g,scl:h,internalId:d.id})}this.reindexParentId();this.restoreBindPose(a);return this};e.prototype.reindexParentId=function(){for(var a=0;a<this.hierarchy.length;a++)for(var b=0;b<this.hierarchy.length;++b)if(this.hierarchy[a].parent==this.hierarchy[b].internalId){this.hierarchy[a].parent=b;break}};e.prototype.restoreBindPose=function(a){var b=a.Objects.subNodes.Pose;if(void 0!==b){for(var c=b.subNodes.PoseNode,b={},d={},e=0;e<c.length;++e){var f=toMat44(c[e].subNodes.Matrix.properties.a.split(",")),
g=toMat44(c[e].subNodes.Matrix.properties.a.split(","));b[c[e].id]=f;d[c[e].id]=g}for(c=0;c<this.hierarchy.length;++c)if(e=this.hierarchy[c],f=e.internalId,void 0!==d[f]){for(var g=new THREE.Vector3(0,0,0),h=new THREE.Quaternion,m=new THREE.Vector3(1,1,1),k,l=a.searchConnectionParent(f),n=0;n<l.length;++n)if(this.isBoneNode(l[n])){k=l[n];break}void 0!==k&&void 0!==b[k]&&(l=new THREE.Matrix4,l.getInverse(d[k]),l.multiply(b[f]),b[f]=l);b[f].decompose(g,h,m);e.pos=[g.x,g.y,g.z];e.rotq=[h.x,h.y,h.z,h.w];
e.scl=[m.x,m.y,m.z]}}};e.prototype.searchRealId=function(a){for(var b=0;b<this.hierarchy.length;b++)if(a==this.hierarchy[b].internalId)return b;return-1};e.prototype.getByInternalId=function(a){for(var b=0;b<this.hierarchy.length;b++)if(a==this.hierarchy[b].internalId)return this.hierarchy[b];return null};e.prototype.isBoneNode=function(a){for(var b=0;b<this.hierarchy.length;++b)if(a===this.hierarchy[b].internalId)return!0;return!1};e.prototype.getBoneIdfromInternalId=function(a,b){void 0===a.__cache_get_boneid_from_internalid&&
(a.__cache_get_boneid_from_internalid=[]);if(void 0!==a.__cache_get_boneid_from_internalid[b])return a.__cache_get_boneid_from_internalid[b];for(var c=0;c<this.hierarchy.length;++c)if(this.hierarchy[c].internalId==b)return a.__cache_get_boneid_from_internalid[b]=c;return-1};d.prototype.parse=function(a){this.node=a;this.name=a.attrName;this.id=a.id;this.vertices=this.getVertices();if(void 0===this.vertices)console.log("FBXLoader: Geometry.parse(): pass"+this.node.id);else return this.indices=this.getPolygonVertexIndices(),
this.uvs=(new g).parse(this.node,this),this.normals=(new f).parse(this.node,this),3<this.getPolygonTopologyMax()&&(this.indices=this.convertPolyIndicesToTri(this.indices,this.getPolygonTopologyArray())),this};d.prototype.getVertices=function(){if(this.node.__cache_vertices)return this.node.__cache_vertices;if(void 0===this.node.subNodes.Vertices)return console.warn("this.node: "+this.node.attrName+"("+this.node.id+") does not have Vertices"),this.node.__cache_vertices=void 0,null;var a=this.node.subNodes.Vertices.properties.a.split(",").map(function(a){return parseFloat(a)});
this.node.__cache_vertices=a;return this.node.__cache_vertices};d.prototype.getPolygonVertexIndices=function(){if(this.node.__cache_indices&&this.node.__cache_poly_topology_max)return this.node.__cache_indices;if(void 0===this.node.subNodes)console.error("this.node.subNodes undefined"),console.log(this.node);else if(void 0===this.node.subNodes.PolygonVertexIndex)console.warn("this.node: "+this.node.attrName+"("+this.node.id+") does not have PolygonVertexIndex "),this.node.__cache_indices=void 0;else{for(var a=
this.node.subNodes.PolygonVertexIndex.properties.a.split(","),b=1,c=null,d=[],e=0;e<a.length;++e){var f=parseInt(a[e]);0>f?(b>c&&(c=b),a[e]=f^-1,d.push(b),b=1):(a[e]=f,b++)}null===c&&(console.warn("FBXLoader: topology N not found: "+this.node.attrName),console.warn(this.node),c=3);this.node.__cache_poly_topology_max=c;this.node.__cache_poly_topology_arr=d;this.node.__cache_indices=a;return this.node.__cache_indices}};d.prototype.getPolygonTopologyMax=function(){if(this.node.__cache_indices&&this.node.__cache_poly_topology_max)return this.node.__cache_poly_topology_max;
this.getPolygonVertexIndices(this.node);return this.node.__cache_poly_topology_max};d.prototype.getPolygonTopologyArray=function(){if(this.node.__cache_indices&&this.node.__cache_poly_topology_max)return this.node.__cache_poly_topology_arr;this.getPolygonVertexIndices(this.node);return this.node.__cache_poly_topology_arr};d.prototype.convertPolyIndicesToTri=function(a,b){for(var c=[],d=0,e=0,f;d<a.length;){f=b[e];for(var g=0;g<=f-3;g++)c.push(a[d]),c.push(a[d+(f-2-g)]),c.push(a[d+(f-1-g)]);e++;d+=
f}return c};d.prototype.addBones=function(a){this.bones=a};g.prototype.getUV=function(a){return this.node&&this.uv&&this.map&&this.ref?this.uv:this._parseText(a)};g.prototype.getMap=function(a){this.node&&this.uv&&this.map&&this.ref||this._parseText(a);return this.map};g.prototype.getRef=function(a){this.node&&this.uv&&this.map&&this.ref||this._parseText(a);return this.ref};g.prototype.getIndex=function(a){this.node&&this.uv&&this.map&&this.ref||this._parseText(a);return this.index};g.prototype.getNode=
function(a){return null!==this.node?this.node:this.node=a.subNodes.LayerElementUV};g.prototype._parseText=function(a){a=this.getNode(a);if(void 0===a)return[];var b=0,c;for(c in a)c.match(/^\d+$/)&&b++;0<b&&(console.warn("multi uv not supported"),a=a[c]);c=a.subNodes.UVIndex.properties.a;var b=a.properties.MappingInformationType,d=a.properties.ReferenceInformationType;this.uv=toFloat(a.subNodes.UV.properties.a.split(","));this.index=toInt(c.split(","));this.map=b;this.ref=d;return this.uv};g.prototype.parse=
function(a,b){this.uvNode=this.getNode(a);this.uv=this.getUV(a);var c=this.getMap(a),d=this.getRef(a),e=this.getIndex(a),f=b.getPolygonTopologyArray();switch(c){case "ByPolygonVertex":switch(d){case "Direct":this.uv=this.parseUV_ByPolygonVertex_Direct(this.uv,e,f,2);break;case "IndexToDirect":this.uv=this.parseUV_ByPolygonVertex_IndexToDirect(this.uv,e)}for(var g=this.uv,h=b.getPolygonVertexIndices(a),c={},d=[],f=e=0;f<h.length;++f)if(!(h[f]in c)){c[h[f]]={};for(var k=0;2>k;++k)c[h[f]][k]=g[2*f+k];
e=e<h[f]?h[f]:e}try{for(f=0;f<=e;f++)for(g=0;2>g;g++)d.push(c[f][g])}catch(D){}this.uv=d;break;case "ByPolygon":switch(d){case "Direct":this.uv=this.parseUV_ByPolygon_Direct();break;case "IndexToDirect":this.uv=this.parseUV_ByPolygon_IndexToDirect()}}return this.uv};g.prototype.parseUV_ByPolygonVertex_Direct=function(a,b,c,d){return parse_Data_ByPolygonVertex_Direct(a,b,c,d)};g.prototype.parseUV_ByPolygonVertex_IndexToDirect=function(a,b){for(var c=[],d=0;d<b.length;++d)for(var e=0;2>e;++e)c.push(a[2*
b[d]+e]);return c};g.prototype.parseUV_ByPolygon_Direct=function(a){console.warn("not implemented");return a};g.prototype.parseUV_ByPolygon_IndexToDirect=function(a){console.warn("not implemented");return a};g.prototype.parseUV_ByVertex_Direct=function(a){console.warn("not implemented");return a};f.prototype.getNormal=function(a){this.node&&this.normal&&this.map&&this.ref||this._parseText(a);return this.normal};f.prototype.getMap=function(a){this.node&&this.normal&&this.map&&this.ref||this._parseText(a);
return this.map};f.prototype.getRef=function(a){this.node&&this.normal&&this.map&&this.ref||this._parseText(a);return this.ref};f.prototype.getNode=function(a){return this.node?this.node:this.node=a.subNodes.LayerElementNormal};f.prototype._parseText=function(a){var b=this.getNode(a);if(void 0===b)console.warn("node: "+a.attrName+"("+a.id+") does not have LayerElementNormal");else{a=b.properties.MappingInformationType;var c=b.properties.ReferenceInformationType;this.normal=toFloat(b.subNodes.Normals.properties.a.split(","));
this.map=a;this.ref=c}};f.prototype.parse=function(a,b){var c=this.getNormal(a);this.getNode(a);var d=this.getMap(a),e=this.getRef(a),f=b.getPolygonVertexIndices(a),g=b.getPolygonTopologyArray(a);switch(d){case "ByPolygonVertex":switch(e){case "Direct":c=this.parseNormal_ByPolygonVertex_Direct(c,f,g,3);break;case "IndexToDirect":c=this.parseNormal_ByPolygonVertex_IndexToDirect()}break;case "ByPolygon":switch(e){case "Direct":c=this.parseNormal_ByPolygon_Direct();break;case "IndexToDirect":c=this.parseNormal_ByPolygon_IndexToDirect()}}return c};
f.prototype.parseNormal_ByPolygonVertex_Direct=function(a,b,c,d){return parse_Data_ByPolygonVertex_Direct(a,b,c,d)};f.prototype.parseNormal_ByPolygonVertex_IndexToDirect=function(a){console.warn("not implemented");return a};f.prototype.parseNormal_ByPolygon_Direct=function(a){console.warn("not implemented");return a};f.prototype.parseNormal_ByPolygon_IndexToDirect=function(a){console.warn("not implemented");return a};f.prototype.parseNormal_ByVertex_Direct=function(a){console.warn("not implemented");
return a};h.prototype.fromNode=function(a){this.internalId=this.id=a.id;this.times=a.subNodes.KeyTime.properties.a;this.values=a.subNodes.KeyValueFloat.properties.a;this.attrFlag=a.subNodes.KeyAttrFlags.properties.a;this.attrData=a.subNodes.KeyAttrDataFloat.properties.a;this.times=toFloat(this.times.split(","));this.values=toFloat(this.values.split(","));this.attrData=toFloat(this.attrData.split(","));this.attrFlag=toInt(this.attrFlag.split(","));this.times=this.times.map(function(a){return a/46186158E3});
return this};h.prototype.getLength=function(){return this.times[this.times.length-1]};k.prototype.fromNode=function(a,b,c){this.id=b.id;this.attr=b.attrName;this.internalId=b.id;if(this.attr.match(/S|R|T/))for(var d in b.properties)d.match(/X/)&&(this.attrX=!0),d.match(/Y/)&&(this.attrY=!0),d.match(/Z/)&&(this.attrZ=!0);else return null;this.containerIndices=a.searchConnectionParent(this.id);this.curveIdx=a.searchConnectionChildren(this.id);for(a=this.containerIndices.length-1;0<=a&&!(b=c.searchRealId(this.containerIndices[a]),
0<=b&&(this.containerBoneId=b,this.containerId=this.containerIndices[a]),0<=b);--a);return this};k.prototype.setCurve=function(a){this.curves.push(a)};l.prototype.parse=function(a,b){var c=a.Objects.subNodes.AnimationCurveNode,d=a.Objects.subNodes.AnimationCurve,e=[],f;for(f in c)if(f.match(/\d+/)){var g=(new k).fromNode(a,c[f],b);e.push(g)}c={};for(g=0;g<e.length;++g)null!==e[g]&&(c[e[g].id]=e[g]);g=[];e=0;for(f in d)if(f.match(/\d+/)){var m=(new h).fromNode(d[f]);g.push(m);var e=m.getLength()?m.getLength():
e,l=a.searchConnectionParent(m.id)[0],n=a.searchConnectionType(m.id,l);n.match(/X/)&&(n="x");n.match(/Y/)&&(n="y");n.match(/Z/)&&(n="z");c[l].curves[n]=m}for(var p in c)d=c[p].containerBoneId,void 0===this.curves[d]&&(this.curves[d]={}),this.curves[d][c[p].attr]=c[p];this.length=e;this.frames=this.length*this.fps;return this};n.prototype.add=function(a){void 0===this.textures&&(this.textures=[]);this.textures.push(a);for(var b=0;b<a.parentIds.length;++b)void 0===this.perGeoMap[a.parentIds[b]]&&(this.perGeoMap[a.parentIds[b]]=
[]),this.perGeoMap[a.parentIds[b]].push(this.textures[this.textures.length-1])};n.prototype.parse=function(a,b){var c=a.Objects.subNodes.Texture,d;for(d in c){var e=(new q).parse(c[d],a);this.add(e)}return this};n.prototype.getById=function(a){return this.perGeoMap[a]};q.prototype.parse=function(a,b){this.id=a.id;this.name=a.attrName;this.fileName=this.parseFileName(a.properties.FileName);this.parentIds=this.searchParents(this.id,b);return this};q.prototype.parseFileName=function(a){if(void 0===a)return"";
var b=a.split(/[\\\/]/);return 0<b.length?b[b.length-1]:a};q.prototype.searchParents=function(a,b){return b.searchConnectionParent(a)};parse_Data_ByPolygonVertex_Direct=function(a,b,c,d){c=[];for(var e=0,f=0;f<b.length;++f){c[b[f]]=[];for(var g=0;g<d;++g)c[b[f]][g]=a[e+g];e+=d}a=[];for(b=0;b<c.length;++b)if(void 0!==c[b])for(e=0;e<d;++e)void 0!==c[b][e]&&a.push(c[b][e]);return a};degToRad=function(a){return a*Math.PI/180};radToDeg=function(a){return 180*a/Math.PI};quatFromVec=function(a,b,c){a=new THREE.Euler(a,
b,c,"ZYX");b=new THREE.Quaternion;b.setFromEuler(a);return b};toInt=function(a){return a.map(function(a){return parseInt(a)})};toFloat=function(a){return a.map(function(a){return parseFloat(a)})};toRad=function(a){return a.map(function(a){return degToRad(a)})};toMat44=function(a){var b=new THREE.Matrix4;b.set(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]);return b}})();
THREE.SpriteCanvasMaterial=function(a){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(a,c){};this.setValues(a)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;THREE.SpriteCanvasMaterial.prototype.clone=function(){var a=new THREE.SpriteCanvasMaterial;a.copy(this);a.color.copy(this.color);a.program=this.program;return a};
THREE.CanvasRenderer=function(a){function b(a,b,c,d){k(b);l(c);n(d);q(a.getStyle());H.stroke();wa.expandByScalar(2*b)}function c(a){m(a.getStyle());H.fill()}function e(a){if(0===a.version||a instanceof THREE.CompressedTexture||a instanceof THREE.DataTexture)return{canvas:void 0,version:a.version};var b=a.image;if(!1===b.complete)return{canvas:void 0,version:0};var c=document.createElement("canvas");c.width=b.width;c.height=b.height;var d=c.getContext("2d");d.setTransform(1,0,0,-1,0,b.height);d.drawImage(b,
0,0);var b=a.wrapS===THREE.RepeatWrapping,d=a.wrapT===THREE.RepeatWrapping,e="no-repeat";!0===b&&!0===d?e="repeat":!0===b?e="repeat-x":!0===d&&(e="repeat-y");c=H.createPattern(c,e);if(a.onUpdate)a.onUpdate(a);return{canvas:c,version:a.version}}function d(a,b,c,d,f,g,h,k,l,n,p,q,r){var t=qa[r.id];if(void 0===t||t.version!==r.version)t=e(r),qa[r.id]=t;if(void 0!==t.canvas){m(t.canvas);var t=r.offset.x/r.repeat.x,u=r.offset.y/r.repeat.y,v=r.image.width*r.repeat.x;r=r.image.height*r.repeat.y;h=(h+t)*
v;k=(k+u)*r;c-=a;d-=b;f-=a;g-=b;l=(l+t)*v-h;n=(n+u)*r-k;p=(p+t)*v-h;q=(q+u)*r-k;r=l*q-p*n;0!==r&&(t=1/r,r=(q*c-n*f)*t,n=(q*d-n*g)*t,c=(l*f-p*c)*t,d=(l*g-p*d)*t,a=a-r*h-c*k,b=b-n*h-d*k,H.save(),H.transform(r,n,c,d,a,b),H.fill(),H.restore())}else m("rgba( 0, 0, 0, 1)"),H.fill()}function g(a,b,c){var d=b.x-a.x,e=b.y-a.y,f=d*d+e*e;0!==f&&(c/=Math.sqrt(f),d*=c,e*=c,b.x+=d,b.y+=e,a.x-=d,a.y-=e)}function f(a){J!==a&&(J=H.globalAlpha=a)}function h(a){N!==a&&(a===THREE.NormalBlending?H.globalCompositeOperation=
"source-over":a===THREE.AdditiveBlending?H.globalCompositeOperation="lighter":a===THREE.SubtractiveBlending&&(H.globalCompositeOperation="darker"),N=a)}function k(a){O!==a&&(O=H.lineWidth=a)}function l(a){S!==a&&(S=H.lineCap=a)}function n(a){I!==a&&(I=H.lineJoin=a)}function q(a){P!==a&&(P=H.strokeStyle=a)}function m(a){Q!==a&&(Q=H.fillStyle=a)}function p(a){ba.length!==a.length&&(H.setLineDash(a),ba=a)}console.log("THREE.CanvasRenderer",THREE.REVISION);a=a||{};var r=this,u,t,v,x=new THREE.Projector,
A=void 0!==a.canvas?a.canvas:document.createElement("canvas"),w=A.width,D=A.height,B=Math.floor(w/2),z=Math.floor(D/2),F=0,G=0,C=w,L=D,K=1,H=A.getContext("2d",{alpha:!0===a.alpha}),M=new THREE.Color(0),E=!0===a.alpha?0:1,J=1,N=0,P=null,Q=null,O=null,S=null,I=null,ba=[],R,V,X;new THREE.RenderableVertex;new THREE.RenderableVertex;var aa,U,T,Y,fa,ka,ca=new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;var la=new THREE.Color,ha=new THREE.Color,ga=new THREE.Color,qa={},pa,
va,ma,na,ra,ya,sa,oa=new THREE.Box2,da=new THREE.Box2,wa=new THREE.Box2,Ja=new THREE.Color,Na=new THREE.Color,ua=new THREE.Color,Z=new THREE.Vector3,Ka=new THREE.Vector3,ia=new THREE.Vector3,y=new THREE.Matrix3;void 0===H.setLineDash&&(H.setLineDash=function(){});this.domElement=A;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getContext=function(){return H};this.getContextAttributes=
function(){return H.getContextAttributes()};this.getPixelRatio=function(){return K};this.setPixelRatio=function(a){void 0!==a&&(K=a)};this.setSize=function(a,b,c){w=a*K;D=b*K;A.width=w;A.height=D;B=Math.floor(w/2);z=Math.floor(D/2);!1!==c&&(A.style.width=a+"px",A.style.height=b+"px");oa.min.set(-B,-z);oa.max.set(B,z);da.min.set(-B,-z);da.max.set(B,z);J=1;N=0;I=S=O=Q=P=null;this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){F=a*K;G=b*K;C=c*K;L=d*K};this.setScissor=function(){};this.setScissorTest=
function(){};this.setClearColor=function(a,b){M.set(a);E=void 0!==b?b:1;da.min.set(-B,-z);da.max.set(B,z)};this.setClearColorHex=function(a,b){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(a,b)};this.getClearColor=function(){return M};this.getClearAlpha=function(){return E};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===da.isEmpty()&&(da.intersect(oa),da.expandByScalar(2),da.min.x+=B,da.min.y=-da.min.y+
z,da.max.x+=B,da.max.y=-da.max.y+z,1>E&&H.clearRect(da.min.x|0,da.max.y|0,da.max.x-da.min.x|0,da.min.y-da.max.y|0),0<E&&(h(THREE.NormalBlending),f(1),m("rgba("+Math.floor(255*M.r)+","+Math.floor(255*M.g)+","+Math.floor(255*M.b)+","+E+")"),H.fillRect(da.min.x|0,da.max.y|0,da.max.x-da.min.x|0,da.min.y-da.max.y|0)),da.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(a,A){if(!1===A instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");
else{!0===this.autoClear&&this.clear();r.info.render.vertices=0;r.info.render.faces=0;H.setTransform(C/w,0,0,-L/D,F,D-G);H.translate(B,z);u=x.projectScene(a,A,this.sortObjects,this.sortElements);t=u.elements;v=u.lights;y.getNormalMatrix(A.matrixWorldInverse);Ja.setRGB(0,0,0);Na.setRGB(0,0,0);ua.setRGB(0,0,0);for(var K=0,E=v.length;K<E;K++){var I=v[K],J=I.color;I instanceof THREE.AmbientLight?Ja.add(J):I instanceof THREE.DirectionalLight?Na.add(J):I instanceof THREE.PointLight&&ua.add(J)}K=0;for(E=
t.length;K<E;K++){var M=t[K],O=M.material;if(void 0!==O&&0!==O.opacity){wa.makeEmpty();if(M instanceof THREE.RenderableSprite){R=M;R.x*=B;R.y*=z;var I=R,N=M,J=O;f(J.opacity);h(J.blending);var Q=N.scale.x*B,N=N.scale.y*z,M=.5*Math.sqrt(Q*Q+N*N);wa.min.set(I.x-M,I.y-M);wa.max.set(I.x+M,I.y+M);if(J instanceof THREE.SpriteMaterial){var P=J.map;if(null!==P){M=qa[P.id];if(void 0===M||M.version!==P.version)M=e(P),qa[P.id]=M;if(void 0!==M.canvas){m(M.canvas);var S=P.image,M=S.width*P.offset.x,O=S.height*
P.offset.y,ea=S.width*P.repeat.x,P=S.height*P.repeat.y,S=Q/ea,ba=N/P;H.save();H.translate(I.x,I.y);0!==J.rotation&&H.rotate(J.rotation);H.translate(-Q/2,-N/2);H.scale(S,ba);H.translate(-M,-O);H.fillRect(M,O,ea,P);H.restore()}}else m(J.color.getStyle()),H.save(),H.translate(I.x,I.y),0!==J.rotation&&H.rotate(J.rotation),H.scale(Q,-N),H.fillRect(-.5,-.5,1,1),H.restore()}else J instanceof THREE.SpriteCanvasMaterial&&(q(J.color.getStyle()),m(J.color.getStyle()),H.save(),H.translate(I.x,I.y),0!==J.rotation&&
H.rotate(J.rotation),H.scale(Q,N),J.program(H),H.restore())}else if(M instanceof THREE.RenderableLine){if(R=M.v1,V=M.v2,R.positionScreen.x*=B,R.positionScreen.y*=z,V.positionScreen.x*=B,V.positionScreen.y*=z,wa.setFromPoints([R.positionScreen,V.positionScreen]),!0===oa.intersectsBox(wa))if(I=R,J=V,Q=M,N=O,f(N.opacity),h(N.blending),H.beginPath(),H.moveTo(I.positionScreen.x,I.positionScreen.y),H.lineTo(J.positionScreen.x,J.positionScreen.y),N instanceof THREE.LineBasicMaterial){k(N.linewidth);l(N.linecap);
n(N.linejoin);if(N.vertexColors!==THREE.VertexColors)q(N.color.getStyle());else if(M=Q.vertexColors[0].getStyle(),Q=Q.vertexColors[1].getStyle(),M===Q)q(M);else{try{var xa=H.createLinearGradient(I.positionScreen.x,I.positionScreen.y,J.positionScreen.x,J.positionScreen.y);xa.addColorStop(0,M);xa.addColorStop(1,Q)}catch(vc){xa=M}q(xa)}H.stroke();wa.expandByScalar(2*N.linewidth)}else N instanceof THREE.LineDashedMaterial&&(k(N.linewidth),l(N.linecap),n(N.linejoin),q(N.color.getStyle()),p([N.dashSize,
N.gapSize]),H.stroke(),wa.expandByScalar(2*N.linewidth),p([]))}else if(M instanceof THREE.RenderableFace){R=M.v1;V=M.v2;X=M.v3;if(-1>R.positionScreen.z||1<R.positionScreen.z)continue;if(-1>V.positionScreen.z||1<V.positionScreen.z)continue;if(-1>X.positionScreen.z||1<X.positionScreen.z)continue;R.positionScreen.x*=B;R.positionScreen.y*=z;V.positionScreen.x*=B;V.positionScreen.y*=z;X.positionScreen.x*=B;X.positionScreen.y*=z;0<O.overdraw&&(g(R.positionScreen,V.positionScreen,O.overdraw),g(V.positionScreen,
X.positionScreen,O.overdraw),g(X.positionScreen,R.positionScreen,O.overdraw));wa.setFromPoints([R.positionScreen,V.positionScreen,X.positionScreen]);if(!0===oa.intersectsBox(wa)){J=R;Q=V;N=X;I=O;r.info.render.vertices+=3;r.info.render.faces++;f(I.opacity);h(I.blending);aa=J.positionScreen.x;U=J.positionScreen.y;T=Q.positionScreen.x;Y=Q.positionScreen.y;fa=N.positionScreen.x;ka=N.positionScreen.y;var O=aa,ea=U,P=T,S=Y,ba=fa,tc=ka;H.beginPath();H.moveTo(O,ea);H.lineTo(P,S);H.lineTo(ba,tc);H.closePath();
if((I instanceof THREE.MeshLambertMaterial||I instanceof THREE.MeshPhongMaterial)&&null===I.map){la.copy(I.color);ha.copy(I.emissive);I.vertexColors===THREE.FaceColors&&la.multiply(M.color);ca.copy(Ja);Ka.copy(J.positionWorld).add(Q.positionWorld).add(N.positionWorld).divideScalar(3);J=Ka;Q=M.normalModel;N=ca;M=0;for(O=v.length;M<O;M++)ea=v[M],ga.copy(ea.color),ea instanceof THREE.DirectionalLight?(P=Z.setFromMatrixPosition(ea.matrixWorld).normalize(),S=Q.dot(P),0>=S||(S*=ea.intensity,N.add(ga.multiplyScalar(S)))):
ea instanceof THREE.PointLight&&(P=Z.setFromMatrixPosition(ea.matrixWorld),S=Q.dot(Z.subVectors(P,J).normalize()),0>=S||(S*=0==ea.distance?1:1-Math.min(J.distanceTo(P)/ea.distance,1),0!=S&&(S*=ea.intensity,N.add(ga.multiplyScalar(S)))));ca.multiply(la).add(ha);!0===I.wireframe?b(ca,I.wireframeLinewidth,I.wireframeLinecap,I.wireframeLinejoin):c(ca)}else I instanceof THREE.MeshBasicMaterial||I instanceof THREE.MeshLambertMaterial||I instanceof THREE.MeshPhongMaterial?null!==I.map?I.map.mapping===THREE.UVMapping&&
(pa=M.uvs,d(aa,U,T,Y,fa,ka,pa[0].x,pa[0].y,pa[1].x,pa[1].y,pa[2].x,pa[2].y,I.map)):null!==I.envMap?I.envMap.mapping===THREE.SphericalReflectionMapping&&(ia.copy(M.vertexNormalsModel[0]).applyMatrix3(y),va=.5*ia.x+.5,ma=.5*ia.y+.5,ia.copy(M.vertexNormalsModel[1]).applyMatrix3(y),na=.5*ia.x+.5,ra=.5*ia.y+.5,ia.copy(M.vertexNormalsModel[2]).applyMatrix3(y),ya=.5*ia.x+.5,sa=.5*ia.y+.5,d(aa,U,T,Y,fa,ka,va,ma,na,ra,ya,sa,I.envMap)):(ca.copy(I.color),I.vertexColors===THREE.FaceColors&&ca.multiply(M.color),
!0===I.wireframe?b(ca,I.wireframeLinewidth,I.wireframeLinecap,I.wireframeLinejoin):c(ca)):(I instanceof THREE.MeshNormalMaterial?(ia.copy(M.normalModel).applyMatrix3(y),ca.setRGB(ia.x,ia.y,ia.z).multiplyScalar(.5).addScalar(.5)):ca.setRGB(1,1,1),!0===I.wireframe?b(ca,I.wireframeLinewidth,I.wireframeLinecap,I.wireframeLinejoin):c(ca))}}da.union(wa)}}H.setTransform(1,0,0,1,0,0)}}};
THREE.SoftwareRenderer=function(a){function b(){for(var a=p*r*4,b=0;b<a;b+=4)G[b]=255*z.r|0,G[b+1]=255*z.g|0,G[b+2]=255*z.b|0,G[b+3]=255;n.fillStyle=z.getStyle();n.fillRect(0,0,p,r)}function c(a,b){var c=0,d=0,e=255*a.color.r,f=255*a.color.g,g=255*a.color.b,h=new Uint8Array(768);if(b){for(;204>c;)h[d++]=Math.min(c*e/204,255),h[d++]=Math.min(c*f/204,255),h[d++]=Math.min(c*g/204,255),++c;for(;256>c;)h[d++]=Math.min(e+(c-204)*(255-e)/82,255),h[d++]=Math.min(f+(c-204)*(255-f)/82,255),h[d++]=Math.min(g+
(c-204)*(255-g)/82,255),++c}else for(;256>c;)h[d++]=Math.min(c*e/255,255),h[d++]=Math.min(c*f/255,255),h[d++]=Math.min(c*g/255,255),++c;return h}function e(a,b,c,d,e,f,g,h,k){g=4*c;h=m[k.map.id];if(h.data){var l=h.width,n=l-1;h=h.data;e=4*((f*l&n)*l+(e*l&n));if(k.transparent){f=h[e+1];var l=h[e+2],n=h[e+3]*k.opacity/255,p=a[g+1],q=a[g+2];a[g]=h[e]*n+a[g]*(1-n);a[g+1]=f*n+p*(1-n);a[g+2]=l*n+q*(1-n);a[g+3]=(k.opacity<<8)-1;255==a[g+3]&&(b[c]=d)}else a[g]=h[e],a[g+1]=h[e+1],a[g+2]=h[e+2],a[g+3]=(k.opacity<<
8)-1,b[c]=d}}function d(a,b,c,d,e,f,g,h,k){h=4*c;var l=m[k.map.id];if(l.data){var n=l.width;g=3*(0<g?~~g:0);var p=n-1,l=l.data;e=4*((f*n&p)*n+(e*n&p));if(k.transparent){f=k.palette[g+1]*l[e+1];var n=k.palette[g+2]*l[e+2],p=l[e+3]*k.opacity/256,q=a[h+1],r=a[h+2];a[h]=k.palette[g]*l[e]*p+a[h]*(1-p);a[h+1]=f*p+q*(1-p);a[h+2]=n*p+r*(1-p);a[h+3]=(k.opacity<<8)-1;255==a[h+3]&&(b[c]=d)}else a[h]=k.palette[g]*l[e]>>8,a[h+1]=k.palette[g+1]*l[e+1]>>8,a[h+2]=k.palette[g+2]*l[e+2]>>8,a[h+3]=(k.opacity<<8)-1,
b[c]=d}}function g(a){a=a.target;a.removeEventListener("update",g);delete q[a.id]}function f(a){var b=a.id,f=q[b];f&&a.map&&!m[a.map.id]&&delete q[b];if(void 0===q[b]){a.addEventListener("update",g);if(a instanceof THREE.MeshBasicMaterial||a instanceof THREE.MeshLambertMaterial||a instanceof THREE.MeshPhongMaterial||a instanceof THREE.SpriteMaterial)if(a instanceof THREE.MeshLambertMaterial?a.palette||(a.palette=c(a,!1)):a instanceof THREE.MeshPhongMaterial&&!a.palette&&(a.palette=c(a,!0)),a.map){f=
new THREE.SoftwareRenderer.Texture;f.fromImage(a.map.image);if(!f.data)return;m[a.map.id]=f;f=a instanceof THREE.MeshBasicMaterial||a instanceof THREE.SpriteMaterial?e:d}else a=a.vertexColors===THREE.FaceColors?"var colorOffset = offset * 4;\nbuffer[ colorOffset ] = face.color.r * 255;\nbuffer[ colorOffset + 1 ] = face.color.g * 255;\nbuffer[ colorOffset + 2 ] = face.color.b * 255;\nbuffer[ colorOffset + 3 ] = material.opacity * 255;\ndepthBuf[ offset ] = depth;":"var colorOffset = offset * 4;\nbuffer[ colorOffset ] = material.color.r * 255;\nbuffer[ colorOffset + 1 ] = material.color.g * 255;\nbuffer[ colorOffset + 2 ] = material.color.b * 255;\nbuffer[ colorOffset + 3 ] = material.opacity * 255;\ndepthBuf[ offset ] = depth;",
f=new Function("buffer, depthBuf, offset, depth, u, v, n, face, material",a);else f=a instanceof THREE.LineBasicMaterial?new Function("buffer, depthBuf, offset, depth, color1, color2, material","var colorOffset = offset * 4;\nbuffer[ colorOffset ] = material.color.r * (color1.r+color2.r) * 0.5 * 255;\nbuffer[ colorOffset + 1 ] = material.color.g * (color1.g+color2.g) * 0.5 * 255;\nbuffer[ colorOffset + 2 ] = material.color.b * (color1.b+color2.b) * 0.5 * 255;\nbuffer[ colorOffset + 3 ] = 255;\ndepthBuf[ offset ] = depth;"):
new Function("buffer, depthBuf, offset, depth, u, v, n, face, material","var colorOffset = offset * 4;\nbuffer[ colorOffset ] = u * 255;\nbuffer[ colorOffset + 1 ] = v * 255;\nbuffer[ colorOffset + 2 ] = 0;\nbuffer[ colorOffset + 3 ] = 255;\ndepthBuf[ offset ] = depth;");q[b]=f}return f}function h(a,b,c,d,e,f,g,l,m){if(!(-1>a.z||1<a.z||-1>b.z||1<b.z||-1>c.z||1<c.z)){var n=a.x*v+w|0,q=b.x*v+w|0,t=c.x*v+w|0,z=a.y*x+D|0,F=b.y*x+D|0,y=c.y*x+D|0,J=l.vertexNormalsModel&&l.vertexNormalsModel.length,L=d&&
e&&f,N=Math.max(Math.sqrt((n-q)*(n-q)+(z-F)*(z-F)),Math.sqrt((q-t)*(q-t)+(F-y)*(F-y)),Math.sqrt((t-n)*(t-n)+(y-z)*(y-z)));if(!(l instanceof THREE.RenderableSprite)&&1600<N){var T={vertexNormalsModel:[],color:l.color},ca,P,R;if(L){va===pa.length?(ca=new THREE.Vector2,pa.push(ca),++va,P=new THREE.Vector2,pa.push(P),++va,R=new THREE.Vector2,pa.push(R)):(ca=pa[va],++va,P=pa[va],++va,R=pa[va]);++va;var V;V=b.w/a.w*(1+b.z)/(1+a.z);ca.copy(d).multiplyScalar(V).add(e).multiplyScalar(1/(V+1));V=c.w/b.w*(1+
c.z)/(1+b.z);P.copy(e).multiplyScalar(V).add(f).multiplyScalar(1/(V+1));V=a.w/c.w*(1+a.z)/(1+c.z);R.copy(f).multiplyScalar(V).add(d).multiplyScalar(1/(V+1))}var Y,X,U;ha===la.length?(Y=new THREE.Vector4,la.push(Y),++ha,X=new THREE.Vector4,la.push(X),++ha,U=new THREE.Vector4,la.push(U)):(Y=la[ha],++ha,X=la[ha],++ha,U=la[ha]);++ha;Y.copy(a).add(b).multiplyScalar(.5);X.copy(b).add(c).multiplyScalar(.5);U.copy(c).add(a).multiplyScalar(.5);var ka,fa,oa;J&&(qa===ga.length?(ka=new THREE.Vector3,ga.push(ka),
++qa,fa=new THREE.Vector3,ga.push(fa),++qa,oa=new THREE.Vector3,ga.push(oa)):(ka=ga[qa],++qa,fa=ga[qa],++qa,oa=ga[qa]),++qa,ka.copy(l.vertexNormalsModel[0]).add(l.vertexNormalsModel[1]).normalize(),fa.copy(l.vertexNormalsModel[1]).add(l.vertexNormalsModel[2]).normalize(),oa.copy(l.vertexNormalsModel[2]).add(l.vertexNormalsModel[0]).normalize());J&&(T.vertexNormalsModel[0]=l.vertexNormalsModel[0],T.vertexNormalsModel[1]=ka,T.vertexNormalsModel[2]=oa);h(a,Y,U,d,ca,R,g,T,m);J&&(T.vertexNormalsModel[0]=
l.vertexNormalsModel[1],T.vertexNormalsModel[1]=fa,T.vertexNormalsModel[2]=ka);h(b,X,Y,e,P,ca,g,T,m);J&&(T.vertexNormalsModel[0]=ka,T.vertexNormalsModel[1]=fa,T.vertexNormalsModel[2]=oa);h(Y,X,U,ca,P,R,g,T,m);J&&(T.vertexNormalsModel[0]=l.vertexNormalsModel[2],T.vertexNormalsModel[1]=oa,T.vertexNormalsModel[2]=fa);h(c,U,X,f,R,P,g,T,m)}else{var da=a.z*A+B|0,aa=b.z*A+B|0,ba=c.z*A+B|0,L=!1,ra,wa,ma,sa,ya,na;d&&e&&f&&(L=!0,ra=d.x,wa=1-d.y,ma=e.x,sa=1-e.y,ya=f.x,na=1-f.y);var Ja,ac,bc,Jb,cc,dc;J&&(Ja=
l.vertexNormalsModel[0],ac=l.vertexNormalsModel[1],bc=l.vertexNormalsModel[2],Jb=255*Ja.z,cc=255*ac.z,dc=255*bc.z);var Fa=n-q,Da=F-z,Ta=q-t,Qa=y-F,Ia=t-n,Ga=z-y,Za=Math.max(Math.min(n,q,t)+15>>4,0),Ub=Math.min(Math.max(n,q,t)+15>>4,p),pb=Math.max(Math.min(z,F,y)+15>>4,0),ec=Math.min(Math.max(z,F,y)+15>>4,r);Q=Math.min(Za,Q);S=Math.max(Ub,S);O=Math.min(pb,O);I=Math.max(ec,I);var Aa=E,Za=Za&~(Aa-1),pb=pb&~(Aa-1),$a=Za<<4,ab=pb<<4,Kb=Da*($a-n)+Fa*(ab-z),Lb=Qa*($a-q)+Ta*(ab-F),Mb=Ga*($a-t)+Ia*(ab-y);
(0<Da||0==Da&&0<Fa)&&Kb++;(0<Qa||0==Qa&&0<Ta)&&Lb++;(0<Ga||0==Ga&&0<Ia)&&Mb++;var Kb=Kb-1>>4,Lb=Lb-1>>4,Mb=Mb-1>>4,fc=da-aa,gc=ba-da,Ua=1/(Fa*Ga-Ia*Da),Ra=Ua*(fc*Ga-gc*Da),Sa=Ua*(fc*Ia-Fa*gc),uc=da+($a-n)*Ra+(ab-z)*Sa|0,Ra=16*Ra|0,Sa=16*Sa|0,db,eb,fb,gb;if(L){var hc=ra-ma,ic=ya-ra,qb=Ua*(hc*Ga-ic*Da),rb=Ua*(hc*Ia-Fa*ic),jc=wa-sa,kc=na-wa;db=Ua*(jc*Ga-kc*Da);eb=Ua*(jc*Ia-Fa*kc);fb=ra+($a-n)*qb+(ab-z)*rb;gb=wa+($a-n)*db+(ab-z)*eb;qb*=16;rb*=16;db*=16;eb*=16}var hb,ib;if(J){var lc=Jb-cc,mc=dc-Jb,sb=
Ua*(lc*Ga-mc*Da);hb=Ua*(lc*Ia-Fa*mc);ib=Jb+($a-n)*sb+(ab-z)*hb;sb*=16;hb*=16}var Ba=Aa-1,Vb=0,Nb=0,Wb=0,Ob=0,Xb=0,Pb=0,Yb=0,Zb=0;0<=Fa?Nb-=Ba*Fa:Vb-=Ba*Fa;0<=Da?Nb-=Ba*Da:Vb-=Ba*Da;0<=Ta?Ob-=Ba*Ta:Wb-=Ba*Ta;0<=Qa?Ob-=Ba*Qa:Wb-=Ba*Qa;0<=Ia?Pb-=Ba*Ia:Xb-=Ba*Ia;0<=Ga?Pb-=Ba*Ga:Xb-=Ba*Ga;0<=Ra?Zb+=Ba*Ra:Yb+=Ba*Ra;0<=Sa?Zb+=Ba*Sa:Yb+=Ba*Sa;var nc=p-Aa,Va=Kb,Wa=Lb,bb=Mb,cb=uc,Oa=-Aa,tb=Oa*Da,ub=Oa*Qa,vb=Oa*Ga,Qb=Oa*Ra,wb,xb;L&&(wb=Oa*qb,xb=Oa*db);var yb;J&&(yb=Oa*sb);for(var Xa=Za,Rb=pb;Rb<ec;Rb+=Aa){for(;Xa>=
Za&&Xa<Ub&&Va>=Nb&&Wa>=Ob&&bb>=Pb;)Xa+=Oa,Va+=tb,Wa+=ub,bb+=vb,cb+=Qb,L&&(fb+=wb,gb+=xb),J&&(ib+=yb);Oa=-Oa;tb=-tb;ub=-ub;vb=-vb;Qb=-Qb;L&&(wb=-wb,xb=-xb);for(J&&(yb=-yb);;){Xa+=Oa;Va+=tb;Wa+=ub;bb+=vb;cb+=Qb;L&&(fb+=wb,gb+=xb);J&&(ib+=yb);if(Xa<Za||Xa>=Ub)break;if(Va<Nb)if(0>tb)break;else continue;if(Wa<Ob)if(0>ub)break;else continue;if(bb<Pb)if(0>vb)break;else continue;var oc=Xa>>M,pc=Rb>>M,zb=oc+pc*u;if(!(K[zb]<cb+Yb)){var qc=H[zb];qc&2&&k(oc,pc);H[zb]=qc&-4;var Ya=Xa+Rb*p;if(Va>=Vb&&Wa>=Wb&&bb>=
Xb){K[zb]=Math.min(K[zb],cb+Zb);var Ab=Va,Bb=Wa,Cb=cb,jb,kb;L&&(jb=fb,kb=gb);var lb;J&&(lb=ib);for(var Db=0;Db<Aa;Db++){var Sb=Ab,Tb=Bb,Eb=Cb,mb,nb;L&&(mb=jb,nb=kb);var ob;J&&(ob=lb);for(var Fb=0;Fb<Aa;Fb++){var Gb=Eb;Gb<C[Ya]&&g(G,C,Ya,Gb,mb,nb,ob,l,m);Sb+=Da;Tb+=Qa;Eb+=Ra;L&&(mb+=qb,nb+=db);J&&(ob+=sb);Ya++}Ab+=Fa;Bb+=Ta;Cb+=Sa;L&&(jb+=rb,kb+=eb);J&&(lb+=hb);Ya+=nc}}else{var Ab=Va,Bb=Wa,rc=bb,Cb=cb;L&&(jb=fb,kb=gb);J&&(lb=ib);for(Db=0;Db<Aa;Db++){var Sb=Ab,Tb=Bb,sc=rc,Eb=Cb;L&&(mb=jb,nb=kb);J&&
(ob=lb);for(Fb=0;Fb<Aa;Fb++)0<=(Sb|Tb|sc)&&(Gb=Eb,Gb<C[Ya]&&g(G,C,Ya,Gb,mb,nb,ob,l,m)),Sb+=Da,Tb+=Qa,sc+=Ga,Eb+=Ra,L&&(mb+=qb,nb+=db),J&&(ob+=sb),Ya++;Ab+=Fa;Bb+=Ta;rc+=Ia;Cb+=Sa;L&&(jb+=rb,kb+=eb);J&&(lb+=hb);Ya+=nc}}}}Va+=Aa*Fa;Wa+=Aa*Ta;bb+=Aa*Ia;cb+=Aa*Sa;L&&(fb+=Aa*rb,gb+=Aa*eb);J&&(ib+=Aa*hb)}}}}function k(a,b){for(var c=a*E+b*E*p,d=4*c,e=p-E,f=4*e,g=0;g<E;g++){for(var h=0;h<E;h++)C[c++]=16777216,G[d++]=255*z.r|0,G[d++]=255*z.g|0,G[d++]=255*z.b|0,G[d++]=255;c+=e;d+=f}}console.log("THREE.SoftwareRenderer",
THREE.REVISION);a=a||{};var l=void 0!==a.canvas?a.canvas:document.createElement("canvas"),n=l.getContext("2d",{alpha:!0===a.alpha}),q={},m={},p,r,u,t,v,x,A,w,D,B,z=new THREE.Color(0),F,G,C,L,K,H,M=3,E=1<<M,J=!1,N=new THREE.Vector3(0,0,1),P=new THREE.Vector3,Q=Infinity,O=Infinity,S=0,I=0,ba=Infinity,R=Infinity,V=0,X=0,aa=new THREE.Projector,U=new THREE.Vector4,T=new THREE.Vector4,Y=new THREE.Vector4,fa=new THREE.Vector2,ka=new THREE.Vector2,ca=new THREE.Vector2,la=[],ha=0,ga=[],qa=0,pa=[],va=0;this.domElement=
l;this.autoClear=!0;this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.setClearColor=function(a,c){z.set(a);b()};this.setPixelRatio=function(){};this.setSize=function(a,c){u=Math.floor(a/E);t=Math.floor(c/E);p=u*E;r=t*E;v=16*p/2;x=-16*r/2;A=8388608;w=16*p/2+.5;D=16*r/2+.5;B=8388608.5;l.width=p;l.height=r;n.fillStyle=z.getStyle();n.fillRect(0,0,p,r);F=n.getImageData(0,0,p,r);G=F.data;C=new Int32Array(G.length/4);L=u*t;K=new Int32Array(L);H=new Uint8Array(L);for(var d=0,
e=C.length;d<e;d++)C[d]=16777216;for(d=0;d<L;d++)H[d]=1;b()};this.setSize(l.width,l.height);this.clear=function(){O=Q=Infinity;for(var a=va=qa=ha=I=S=0;a<L;a++)K[a]=16777216,H[a]=H[a]&1?1:2};this.render=function(a,c){!0===this.autoClear&&this.clear();for(var d=aa.projectScene(a,c,!1,!1).elements,e=0,g=d.length;e<g;e++){var m=d[e],q=m.material,la=f(q);if(la)if(m instanceof THREE.RenderableFace)m.uvs?h(m.v1.positionScreen,m.v2.positionScreen,m.v3.positionScreen,m.uvs[0],m.uvs[1],m.uvs[2],la,m,q):h(m.v1.positionScreen,
m.v2.positionScreen,m.v3.positionScreen,null,null,null,la,m,q);else if(m instanceof THREE.RenderableSprite){var ha=.5*m.scale.x,ga=.5*m.scale.y;U.copy(m);U.x-=ha;U.y+=ga;T.copy(m);T.x-=ha;T.y-=ga;Y.copy(m);Y.x+=ha;Y.y+=ga;q.map?(fa.set(0,1),ka.set(0,0),ca.set(1,1),h(U,T,Y,fa,ka,ca,la,m,q)):h(U,T,Y,null,null,null,la,m,q);U.copy(m);U.x+=ha;U.y+=ga;T.copy(m);T.x-=ha;T.y-=ga;Y.copy(m);Y.x+=ha;Y.y-=ga;q.map?(fa.set(1,1),ka.set(0,0),ca.set(1,0),h(U,T,Y,fa,ka,ca,la,m,q)):h(U,T,Y,null,null,null,la,m,q)}else if(m instanceof
THREE.RenderableLine){la=f(q);var qa=m.v1.positionScreen,Z=m.v2.positionScreen,ha=m.vertexColors[0],m=m.vertexColors[1];if(!J){J=!0;M=0;E=1<<M;ga=l.height;u=Math.floor(l.width/E);t=Math.floor(ga/E);p=u*E;r=t*E;v=16*p/2;x=-16*r/2;A=8388608;w=16*p/2+.5;D=16*r/2+.5;B=8388608.5;l.width=p;l.height=r;n.fillStyle=z.getStyle();n.fillRect(0,0,p,r);F=n.getImageData(0,0,p,r);G=F.data;C=new Int32Array(G.length/4);L=u*t;K=new Int32Array(L);H=new Uint8Array(L);for(var ga=0,pa=C.length;ga<pa;ga++)C[ga]=16777216;
for(ga=0;ga<L;ga++)H[ga]=1;b()}if(!(-1>qa.z||1<qa.z||-1>Z.z||1<Z.z)){var ga=Math.floor(.5*(q.linewidth-1)),ia=qa.x*v+w|0,pa=Z.x*v+w|0,y=qa.y*x+D|0,ea=Z.y*x+D|0,va=qa.z*A+B|0,Z=Z.z*A+B|0,W=ia-pa,ja=y-ea,ma=Math.min(Math.max(ia,pa)+15>>4,p),na=Math.max(Math.min(y,ea)+15>>4,0),za=Math.min(Math.max(y,ea)+15>>4,r),qa=Math.max(Math.min(va,Z)+15>>4,0),y=Math.max(va,Z)+15>>4;Q=Math.min(Math.max(Math.min(ia,pa)+15>>4,0),Q);S=Math.max(ma,S);O=Math.min(na,O);I=Math.max(za,I);var ia=Math.sqrt(ja*ja+W*W),W=W/
ia,ja=ja/ia,va=(va-Z)/ia,Ma,Ca;P.set(W,ja,va);P.cross(N);for(P.normalize();0<ia;){for(var ma=pa+ia*W,na=ea+ia*ja,za=Z+ia*va,ma=ma+15>>4,na=na+15>>4,za=za+15>>4,Ea=-ga;Ea<=ga;++Ea)if(Ma=Math.floor(ma+P.x*Ea),Ca=Math.floor(na+P.y*Ea),!(Q>=Ma||S<=Ma||O>=Ca||I<=Ca)){var Hb=Ma>>M,Ib=Ca>>M,ta=Hb+Ib*u;if(!(K[ta]<qa)){K[ta]=Math.min(K[ta],y);var $b=H[ta];$b&2&&k(Hb,Ib);H[ta]=$b&-4;Ma+=Ca*p;za<C[Ma]&&la(G,C,Ma,za,ha,m,q)}}--ia}}}}for(e=d=0;e<t;e++)for(g=0;g<u;g++)H[d]&2&&(k(g,e),H[d]=1),d++;d=Math.min(Q,ba);
e=Math.min(O,R);g=Math.max(S,V)-d;ha=Math.max(I,X)-e;Infinity!==d&&n.putImageData(F,0,0,d,e,g,ha);ba=Q;R=O;V=S;X=I}};
THREE.SoftwareRenderer.Texture=function(){var a;this.fromImage=function(b){if(!(!b||0>=b.width||0>=b.height)){void 0===a&&(a=document.createElement("canvas"));var c=b.width>b.height?b.width:b.height,c=THREE.Math.nextPowerOfTwo(c);if(a.width!=c||a.height!=c)a.width=c,a.height=c;var e=a.getContext("2d");e.clearRect(0,0,c,c);e.drawImage(b,0,0,c,c);this.data=e.getImageData(0,0,c,c).data;this.height=this.width=c;this.srcUrl=b.src}}};
THREE.RenderableObject=function(){this.id=0;this.object=null;this.renderOrder=this.z=0};
THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.renderOrder=this.z=0};
THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.renderOrder=this.z=0};
THREE.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new THREE.Vector2;this.material=null;this.renderOrder=0};
THREE.Projector=function(){function a(){if(q===p){var a=new THREE.RenderableVertex;m.push(a);p++;q++;return a}return m[q++]}function b(){if(u===v){var a=new THREE.RenderableFace;t.push(a);v++;u++;return a}return t[u++]}function c(){if(A===D){var a=new THREE.RenderableLine;w.push(a);D++;A++;return a}return w[A++]}function e(){if(z===G){var a=new THREE.RenderableSprite;F.push(a);G++;z++;return a}return F[z++]}function d(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?
b.z-a.z:a.id!==b.id?a.id-b.id:0}function g(a,b){var c=0,d=1,e=a.z+a.w,f=b.z+b.w,g=-a.z+a.w,h=-b.z+b.w;if(0<=e&&0<=f&&0<=g&&0<=h)return!0;if(0>e&&0>f||0>g&&0>h)return!1;0>e?c=Math.max(c,e/(e-f)):0>f&&(d=Math.min(d,e/(e-f)));0>g?c=Math.max(c,g/(g-h)):0>h&&(d=Math.min(d,g/(g-h)));if(d<c)return!1;a.lerp(b,c);b.lerp(a,1-d);return!0}var f,h,k=[],l=0,n,q,m=[],p=0,r,u,t=[],v=0,x,A,w=[],D=0,B,z,F=[],G=0,C={objects:[],lights:[],elements:[]},L=new THREE.Vector3,K=new THREE.Vector4,H=new THREE.Box3(new THREE.Vector3(-1,
-1,-1),new THREE.Vector3(1,1,1)),M=new THREE.Box3,E=Array(3),J=new THREE.Matrix4,N=new THREE.Matrix4,P,Q=new THREE.Matrix4,O=new THREE.Matrix3,S=new THREE.Frustum,I=new THREE.Vector4,ba=new THREE.Vector4;this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};this.pickingRay=function(a,b){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};
var R=new function(){function d(a){var b=a.positionWorld,c=a.positionScreen;b.copy(a.position).applyMatrix4(P);c.copy(b).applyMatrix4(N);b=1/c.w;c.x*=b;c.y*=b;c.z*=b;a.visible=-1<=c.x&&1>=c.x&&-1<=c.y&&1>=c.y&&-1<=c.z&&1>=c.z}function e(a,b,c){if(!0===a.visible||!0===b.visible||!0===c.visible)return!0;E[0]=a.positionScreen;E[1]=b.positionScreen;E[2]=c.positionScreen;return H.intersectsBox(M.setFromPoints(E))}function f(a,b,c){return 0>(c.positionScreen.x-a.positionScreen.x)*(b.positionScreen.y-a.positionScreen.y)-
(c.positionScreen.y-a.positionScreen.y)*(b.positionScreen.x-a.positionScreen.x)}var g=[],h=[],k=null,l=null,p=new THREE.Matrix3;return{setObject:function(a){k=a;l=k.material;p.getNormalMatrix(k.matrixWorld);g.length=0;h.length=0},projectVertex:d,checkTriangleVisibility:e,checkBackfaceCulling:f,pushVertex:function(b,c,e){n=a();n.position.set(b,c,e);d(n)},pushNormal:function(a,b,c){g.push(a,b,c)},pushUv:function(a,b){h.push(a,b)},pushLine:function(a,b){var d=m[a],e=m[b];x=c();x.id=k.id;x.v1.copy(d);
x.v2.copy(e);x.z=(d.positionScreen.z+e.positionScreen.z)/2;x.renderOrder=k.renderOrder;x.material=k.material;C.elements.push(x)},pushTriangle:function(a,c,d){var n=m[a],q=m[c],t=m[d];if(!1!==e(n,q,t)&&(l.side===THREE.DoubleSide||!0===f(n,q,t))){r=b();r.id=k.id;r.v1.copy(n);r.v2.copy(q);r.v3.copy(t);r.z=(n.positionScreen.z+q.positionScreen.z+t.positionScreen.z)/3;r.renderOrder=k.renderOrder;r.normalModel.fromArray(g,3*a);r.normalModel.applyMatrix3(p).normalize();for(n=0;3>n;n++)q=r.vertexNormalsModel[n],
q.fromArray(g,3*arguments[n]),q.applyMatrix3(p).normalize(),r.uvs[n].fromArray(h,2*arguments[n]);r.vertexNormalsLength=3;r.material=k.material;C.elements.push(r)}}}};this.projectScene=function(n,p,t,v){z=A=u=0;C.elements.length=0;!0===n.autoUpdate&&n.updateMatrixWorld();null===p.parent&&p.updateMatrixWorld();J.copy(p.matrixWorldInverse.getInverse(p.matrixWorld));N.multiplyMatrices(p.projectionMatrix,J);S.setFromMatrix(N);h=0;C.objects.length=0;C.lights.length=0;n.traverseVisible(function(a){if(a instanceof
THREE.Light)C.lights.push(a);else if((a instanceof THREE.Mesh||a instanceof THREE.Line||a instanceof THREE.Sprite)&&!1!==a.material.visible&&(!1===a.frustumCulled||!0===S.intersectsObject(a))){if(h===l){var b=new THREE.RenderableObject;k.push(b);l++;h++;f=b}else f=k[h++];f.id=a.id;f.object=a;L.setFromMatrixPosition(a.matrixWorld);L.applyProjection(N);f.z=L.z;f.renderOrder=a.renderOrder;C.objects.push(f)}});!0===t&&C.objects.sort(d);n=0;for(t=C.objects.length;n<t;n++){var w=C.objects[n].object,D=w.geometry;
R.setObject(w);P=w.matrixWorld;q=0;if(w instanceof THREE.Mesh)if(D instanceof THREE.BufferGeometry){var F=D.attributes,w=D.groups;if(void 0!==F.position){for(var H=F.position.array,E=0,G=H.length;E<G;E+=3)R.pushVertex(H[E],H[E+1],H[E+2]);if(void 0!==F.normal)for(var M=F.normal.array,E=0,G=M.length;E<G;E+=3)R.pushNormal(M[E],M[E+1],M[E+2]);if(void 0!==F.uv)for(F=F.uv.array,E=0,G=F.length;E<G;E+=2)R.pushUv(F[E],F[E+1]);if(null!==D.index)if(H=D.index.array,0<w.length)for(n=0;n<w.length;n++)for(G=w[n],
E=G.start,G=G.start+G.count;E<G;E+=3)R.pushTriangle(H[E],H[E+1],H[E+2]);else for(E=0,G=H.length;E<G;E+=3)R.pushTriangle(H[E],H[E+1],H[E+2]);else for(E=0,G=H.length/3;E<G;E+=3)R.pushTriangle(E,E+1,E+2)}}else{if(D instanceof THREE.Geometry){var U=D.vertices,E=D.faces,G=D.faceVertexUvs[0];O.getNormalMatrix(P);for(var H=w.material,F=H instanceof THREE.MultiMaterial,M=!0===F?w.material:null,V=0,X=U.length;V<X;V++){var aa=U[V];L.copy(aa);if(!0===H.morphTargets)for(var ma=D.morphTargets,na=w.morphTargetInfluences,
ra=0,ya=ma.length;ra<ya;ra++){var sa=na[ra];if(0!==sa){var oa=ma[ra].vertices[V];L.x+=(oa.x-aa.x)*sa;L.y+=(oa.y-aa.y)*sa;L.z+=(oa.z-aa.z)*sa}}R.pushVertex(L.x,L.y,L.z)}U=0;for(V=E.length;U<V;U++)if(X=E[U],H=!0===F?M.materials[X.materialIndex]:w.material,void 0!==H&&(na=H.side,D=m[X.a],aa=m[X.b],ma=m[X.c],!1!==R.checkTriangleVisibility(D,aa,ma))){ra=R.checkBackfaceCulling(D,aa,ma);if(na!==THREE.DoubleSide){if(na===THREE.FrontSide&&!1===ra)continue;if(na===THREE.BackSide&&!0===ra)continue}r=b();r.id=
w.id;r.v1.copy(D);r.v2.copy(aa);r.v3.copy(ma);r.normalModel.copy(X.normal);!1!==ra||na!==THREE.BackSide&&na!==THREE.DoubleSide||r.normalModel.negate();r.normalModel.applyMatrix3(O).normalize();ya=X.vertexNormals;sa=0;for(oa=Math.min(ya.length,3);sa<oa;sa++){var da=r.vertexNormalsModel[sa];da.copy(ya[sa]);!1!==ra||na!==THREE.BackSide&&na!==THREE.DoubleSide||da.negate();da.applyMatrix3(O).normalize()}r.vertexNormalsLength=ya.length;na=G[U];if(void 0!==na)for(ra=0;3>ra;ra++)r.uvs[ra].copy(na[ra]);r.color=
X.color;r.material=H;r.z=(D.positionScreen.z+aa.positionScreen.z+ma.positionScreen.z)/3;r.renderOrder=w.renderOrder;C.elements.push(r)}}}else if(w instanceof THREE.Line)if(D instanceof THREE.BufferGeometry){if(F=D.attributes,void 0!==F.position){H=F.position.array;E=0;for(G=H.length;E<G;E+=3)R.pushVertex(H[E],H[E+1],H[E+2]);if(null!==D.index)for(H=D.index.array,E=0,G=H.length;E<G;E+=2)R.pushLine(H[E],H[E+1]);else for(F=w instanceof THREE.LineSegments?2:1,E=0,G=H.length/3-1;E<G;E+=F)R.pushLine(E,E+
1)}}else{if(D instanceof THREE.Geometry&&(Q.multiplyMatrices(N,P),U=w.geometry.vertices,0!==U.length))for(D=a(),D.positionScreen.copy(U[0]).applyMatrix4(Q),F=w instanceof THREE.LineSegments?2:1,V=1,X=U.length;V<X;V++)D=a(),D.positionScreen.copy(U[V]).applyMatrix4(Q),0<(V+1)%F||(aa=m[q-2],I.copy(D.positionScreen),ba.copy(aa.positionScreen),!0===g(I,ba)&&(I.multiplyScalar(1/I.w),ba.multiplyScalar(1/ba.w),x=c(),x.id=w.id,x.v1.positionScreen.copy(I),x.v2.positionScreen.copy(ba),x.z=Math.max(I.z,ba.z),
x.renderOrder=w.renderOrder,x.material=w.material,w.material.vertexColors===THREE.VertexColors&&(x.vertexColors[0].copy(w.geometry.colors[V]),x.vertexColors[1].copy(w.geometry.colors[V-1])),C.elements.push(x)))}else w instanceof THREE.Sprite&&(K.set(P.elements[12],P.elements[13],P.elements[14],1),K.applyMatrix4(N),E=1/K.w,K.z*=E,-1<=K.z&&1>=K.z&&(B=e(),B.id=w.id,B.x=K.x*E,B.y=K.y*E,B.z=K.z,B.renderOrder=w.renderOrder,B.object=w,B.rotation=w.rotation,B.scale.x=w.scale.x*Math.abs(B.x-(K.x+p.projectionMatrix.elements[0])/
(K.w+p.projectionMatrix.elements[12])),B.scale.y=w.scale.y*Math.abs(B.y-(K.y+p.projectionMatrix.elements[5])/(K.w+p.projectionMatrix.elements[13])),B.material=w.material,C.elements.push(B)))}!0===v&&C.elements.sort(d);return C}};THREE.OBJLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.materials=null};
THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(a,b,c,e){var d=this,g=new THREE.XHRLoader(d.manager);g.setPath(this.path);g.load(a,function(a){b(d.parse(a))},c,e)},setPath:function(a){this.path=a},setMaterials:function(a){this.materials=a},parse:function(a){function b(a){n={name:a,geometry:{vertices:[],normals:[],uvs:[]},material:{name:"",smooth:!0}};l.push(n)}function c(a){a=parseInt(a);return 3*(0<=a?a-1:a+m.length/3)}function e(a){a=parseInt(a);return 3*(0<=a?a-1:a+p.length/
3)}function d(a){a=parseInt(a);return 2*(0<=a?a-1:a+r.length/2)}function g(a,b,c){n.geometry.vertices.push(m[a],m[a+1],m[a+2],m[b],m[b+1],m[b+2],m[c],m[c+1],m[c+2])}function f(a,b,c){n.geometry.normals.push(p[a],p[a+1],p[a+2],p[b],p[b+1],p[b+2],p[c],p[c+1],p[c+2])}function h(a,b,c){n.geometry.uvs.push(r[a],r[a+1],r[b],r[b+1],r[c],r[c+1])}function k(a,b,k,l,m,n,p,q,r,t,u,v){a=c(a);b=c(b);k=c(k);var w;void 0===l?g(a,b,k):(w=c(l),g(a,b,w),g(b,k,w));void 0!==m&&(a=d(m),b=d(n),k=d(p),void 0===l?h(a,b,
k):(w=d(q),h(a,b,w),h(b,k,w)));void 0!==r&&(a=e(r),b=e(t),k=e(u),void 0===l?f(a,b,k):(w=e(v),f(a,b,w),f(b,k,w)))}console.time("OBJLoader");var l=[],n,q=!1,m=[],p=[],r=[];b("");var u=/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,t=/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,v=/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,x=/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,A=/^f\s+((-?\d+)\/(-?\d+))\s+((-?\d+)\/(-?\d+))\s+((-?\d+)\/(-?\d+))(?:\s+((-?\d+)\/(-?\d+)))?/,
w=/^f\s+((-?\d+)\/(-?\d+)\/(-?\d+))\s+((-?\d+)\/(-?\d+)\/(-?\d+))\s+((-?\d+)\/(-?\d+)\/(-?\d+))(?:\s+((-?\d+)\/(-?\d+)\/(-?\d+)))?/,D=/^f\s+((-?\d+)\/\/(-?\d+))\s+((-?\d+)\/\/(-?\d+))\s+((-?\d+)\/\/(-?\d+))(?:\s+((-?\d+)\/\/(-?\d+)))?/,B=/^[og]\s*(.+)?/,z=/^s\s+(\d+|on|off)/,F=a.split("\n");for(a=0;a<F.length;a++){var G=F[a],G=G.trim(),C;if(0!==G.length&&"#"!==G.charAt(0))if(null!==(C=u.exec(G)))m.push(parseFloat(C[1]),parseFloat(C[2]),parseFloat(C[3]));else if(null!==(C=t.exec(G)))p.push(parseFloat(C[1]),
parseFloat(C[2]),parseFloat(C[3]));else if(null!==(C=v.exec(G)))r.push(parseFloat(C[1]),parseFloat(C[2]));else if(null!==(C=x.exec(G)))k(C[1],C[2],C[3],C[4]);else if(null!==(C=A.exec(G)))k(C[2],C[5],C[8],C[11],C[3],C[6],C[9],C[12]);else if(null!==(C=w.exec(G)))k(C[2],C[6],C[10],C[14],C[3],C[7],C[11],C[15],C[4],C[8],C[12],C[16]);else if(null!==(C=D.exec(G)))k(C[2],C[5],C[8],C[11],void 0,void 0,void 0,void 0,C[3],C[6],C[9],C[12]);else if(null!==(C=B.exec(G)))G=C[0].substr(1).trim(),!1===q?(q=!0,n.name=
G):b(G);else if(/^usemtl /.test(G))n.material.name=G.substring(7).trim();else if(!/^mtllib /.test(G))if(null!==(C=z.exec(G)))n.material.smooth="1"===C[1]||"on"===C[1];else throw Error("Unexpected line: "+G);}q=new THREE.Group;a=0;for(u=l.length;a<u;a++){n=l[a];t=n.geometry;v=new THREE.BufferGeometry;v.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t.vertices),3));0<t.normals.length?v.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(t.normals),3)):v.computeVertexNormals();
0<t.uvs.length&&v.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(t.uvs),2));var L;null!==this.materials&&(L=this.materials.create(n.material.name));L||(L=new THREE.MeshPhongMaterial,L.name=n.material.name);L.shading=n.material.smooth?THREE.SmoothShading:THREE.FlatShading;t=new THREE.Mesh(v,L);t.name=n.name;q.add(t)}console.timeEnd("OBJLoader");return q}};
function CVector2(a,b){var c,e;this._init=function(a,b){c=a;e=b};this.add=function(a,b){c+=a;e+=b};this.addV=function(a){c+=a.getX();e+=a.getY()};this.scalarDivision=function(a){c/=a;e/=a};this.subV=function(a){c-=a.getX();e-=a.getY()};this.scalarProduct=function(a){c*=a;e*=a};this.invert=function(){c*=-1;e*=-1};this.dotProduct=function(a){return c*a.getX()+e*a.getY()};this.set=function(a,b){c=a;e=b};this.setV=function(a){c=a.getX();e=a.getY()};this.length=function(){return Math.sqrt(c*c+e*e)};this.length2=
function(){return c*c+e*e};this.normalize=function(){var a=this.length();0<a&&(c/=a,e/=a)};this.distance=function(a){var b=c-a.x;a=e-a.y;return Math.sqrt(b*b+a*a)};this.angleBetweenVectors=function(a){a=Math.acos(this.dotProduct(a)/(this.length()*a.length()));return!0===isNaN(a)?0:a};this.getNormalize=function(a){this.length();a.set(c,e);a.normalize()};this.rot90CCW=function(){var a=c;c=-e;e=a};this.rot90CW=function(){var a=c;c=e;e=-a};this.getRotCCW=function(a){a.set(c,e);a.rot90CCW()};this.getRotCW=
function(a){a.set(c,e);a.rot90CW()};this.ceil=function(){c=Math.ceil(c);e=Math.ceil(e)};this.round=function(){c=Math.round(c);e=Math.round(e)};this.toString=function(){return"Vector2: "+c+", "+e};this.print=function(){trace("Vector2: "+c+", "+e+"")};this.getX=function(){return c};this.getY=function(){return e};this.rotate=function(a){var b=c,d=e;c=b*Math.cos(a)+d*Math.sin(a);e=b*-Math.sin(a)+d*Math.cos(a)};this._init(a,b)}
function CBackground(a,b){var c,e,d,g;this._init=function(a,b){d=new createjs.Container;b.addChild(d);g={width:3*CANVAS_WIDTH,height:3*CANVAS_HEIGHT};for(var c=a+1,e=0,f=0,h=0;18>h;h++){var m=s_oSpriteLibrary.getSprite("level_"+c+"_bg_"+h),p=createBitmap(m),e=e+m.width;0===h%6&&(e=0,0!==h&&(f+=m.height));p.x=e;p.y=f;d.addChild(p)}d.regX=2400;d.regY=1452;null!==CAUSTICS_POS[a]&&(m=s_oSpriteLibrary.getSprite("caustics"),c=m.width/5,e=m.height/2,m=new createjs.SpriteSheet({framerate:FPS/3,images:[m],
frames:{width:c,height:e,regX:c/2,regY:e/2},animations:{idle:[0,9]}}),m=createSprite(m,"idle",c/2,e/2,c,e),m.x=CAUSTICS_POS[a].x+2400,m.y=CAUSTICS_POS[a].y+1452,m.scaleX=m.scaleY=CAUSTICS_POS[a].scale,d.addChild(m));d.on("mousedown",this._startPan);d.on("pressmove",this._movePan);d.on("pressup",this._endPan)};this.unload=function(){d.off();b.removeChild(d)};this._startPan=function(a){c=a.stageX;e=a.stageY;s_oInterface.setCenterBallViewVisible(!0)};this._movePan=function(a){var b=a.stageX;a=a.stageY;
var d=2*(b-c),f=2*(a-e);c=b;e=a;s_oGame.setPanPoint(d,f)};this._endPan=function(a){};this.setPos=function(a,b){d.x=a;d.y=b};this.getPos=function(){return{x:d.x,y:d.y}};this.getSize=function(){return g};this._init(a,b)}
function CMsgBox(a,b){var c,e,d,g,f,h;this._init=function(a){f=new createjs.Container;h.addChild(f);var b;b=new createjs.Shape;b.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);b.alpha=.5;b.on("click",function(){});f.addChild(b);b=s_oSpriteLibrary.getSprite("msg_box");var g=createBitmap(b);g.x=.5*CANVAS_WIDTH;g.y=.5*CANVAS_HEIGHT;g.regX=.5*b.width;g.regY=.5*b.height;f.addChild(g);c=new createjs.Text(a,"23px "+PRIMARY_FONT,"#000");c.x=CANVAS_WIDTH/2;c.y=260;c.textAlign="center";
c.textBaseline="middle";c.lineWidth=790;c.outline=2;f.addChild(c);e=new createjs.Text(c.text,"23px "+PRIMARY_FONT,"#ffd800");e.x=c.x;e.y=c.y;e.textAlign="center";e.textBaseline="middle";e.lineWidth=790;f.addChild(e);d=new CGfxButton(CANVAS_WIDTH/2,650,s_oSpriteLibrary.getSprite("but_yes"),f);d.addEventListener(ON_MOUSE_UP,this._onButOk,this)};this._onButOk=function(){g.unload()};this.unload=function(){d.unload();h.removeChild(f)};g=this;h=b;this._init(a)};
